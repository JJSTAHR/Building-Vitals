
<!doctype html>
<html lang="en">

<head>
    <title>Code coverage report for Building Vitals/Building-Vitals/build/js/components-DaeLY-_K.js</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="../../../../prettify.css" />
    <link rel="stylesheet" href="../../../../base.css" />
    <link rel="shortcut icon" type="image/x-icon" href="../../../../favicon.png" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style type='text/css'>
        .coverage-summary .sorter {
            background-image: url(../../../../sort-arrow-sprite.png);
        }
    </style>
</head>
    
<body>
<div class='wrapper'>
    <div class='pad1'>
        <h1><a href="../../../../index.html">All files</a> / <a href="index.html">Building Vitals/Building-Vitals/build/js</a> components-DaeLY-_K.js</h1>
        <div class='clearfix'>
            
            <div class='fl pad1y space-right2'>
                <span class="strong">0% </span>
                <span class="quiet">Statements</span>
                <span class='fraction'>0/153</span>
            </div>
        
            
            <div class='fl pad1y space-right2'>
                <span class="strong">0% </span>
                <span class="quiet">Branches</span>
                <span class='fraction'>0/1</span>
            </div>
        
            
            <div class='fl pad1y space-right2'>
                <span class="strong">0% </span>
                <span class="quiet">Functions</span>
                <span class='fraction'>0/1</span>
            </div>
        
            
            <div class='fl pad1y space-right2'>
                <span class="strong">0% </span>
                <span class="quiet">Lines</span>
                <span class='fraction'>0/153</span>
            </div>
        
            
        </div>
        <p class="quiet">
            Press <em>n</em> or <em>j</em> to go to the next uncovered block, <em>b</em>, <em>p</em> or <em>k</em> for the previous block.
        </p>
        <template id="filterTemplate">
            <div class="quiet">
                Filter:
                <input type="search" id="fileSearch">
            </div>
        </template>
    </div>
    <div class='status-line low'></div>
    <pre><table class="coverage">
<tr><td class="line-count quiet"><a name='L1'></a><a href='#L1'>1</a>
<a name='L2'></a><a href='#L2'>2</a>
<a name='L3'></a><a href='#L3'>3</a>
<a name='L4'></a><a href='#L4'>4</a>
<a name='L5'></a><a href='#L5'>5</a>
<a name='L6'></a><a href='#L6'>6</a>
<a name='L7'></a><a href='#L7'>7</a>
<a name='L8'></a><a href='#L8'>8</a>
<a name='L9'></a><a href='#L9'>9</a>
<a name='L10'></a><a href='#L10'>10</a>
<a name='L11'></a><a href='#L11'>11</a>
<a name='L12'></a><a href='#L12'>12</a>
<a name='L13'></a><a href='#L13'>13</a>
<a name='L14'></a><a href='#L14'>14</a>
<a name='L15'></a><a href='#L15'>15</a>
<a name='L16'></a><a href='#L16'>16</a>
<a name='L17'></a><a href='#L17'>17</a>
<a name='L18'></a><a href='#L18'>18</a>
<a name='L19'></a><a href='#L19'>19</a>
<a name='L20'></a><a href='#L20'>20</a>
<a name='L21'></a><a href='#L21'>21</a>
<a name='L22'></a><a href='#L22'>22</a>
<a name='L23'></a><a href='#L23'>23</a>
<a name='L24'></a><a href='#L24'>24</a>
<a name='L25'></a><a href='#L25'>25</a>
<a name='L26'></a><a href='#L26'>26</a>
<a name='L27'></a><a href='#L27'>27</a>
<a name='L28'></a><a href='#L28'>28</a>
<a name='L29'></a><a href='#L29'>29</a>
<a name='L30'></a><a href='#L30'>30</a>
<a name='L31'></a><a href='#L31'>31</a>
<a name='L32'></a><a href='#L32'>32</a>
<a name='L33'></a><a href='#L33'>33</a>
<a name='L34'></a><a href='#L34'>34</a>
<a name='L35'></a><a href='#L35'>35</a>
<a name='L36'></a><a href='#L36'>36</a>
<a name='L37'></a><a href='#L37'>37</a>
<a name='L38'></a><a href='#L38'>38</a>
<a name='L39'></a><a href='#L39'>39</a>
<a name='L40'></a><a href='#L40'>40</a>
<a name='L41'></a><a href='#L41'>41</a>
<a name='L42'></a><a href='#L42'>42</a>
<a name='L43'></a><a href='#L43'>43</a>
<a name='L44'></a><a href='#L44'>44</a>
<a name='L45'></a><a href='#L45'>45</a>
<a name='L46'></a><a href='#L46'>46</a>
<a name='L47'></a><a href='#L47'>47</a>
<a name='L48'></a><a href='#L48'>48</a>
<a name='L49'></a><a href='#L49'>49</a>
<a name='L50'></a><a href='#L50'>50</a>
<a name='L51'></a><a href='#L51'>51</a>
<a name='L52'></a><a href='#L52'>52</a>
<a name='L53'></a><a href='#L53'>53</a>
<a name='L54'></a><a href='#L54'>54</a>
<a name='L55'></a><a href='#L55'>55</a>
<a name='L56'></a><a href='#L56'>56</a>
<a name='L57'></a><a href='#L57'>57</a>
<a name='L58'></a><a href='#L58'>58</a>
<a name='L59'></a><a href='#L59'>59</a>
<a name='L60'></a><a href='#L60'>60</a>
<a name='L61'></a><a href='#L61'>61</a>
<a name='L62'></a><a href='#L62'>62</a>
<a name='L63'></a><a href='#L63'>63</a>
<a name='L64'></a><a href='#L64'>64</a>
<a name='L65'></a><a href='#L65'>65</a>
<a name='L66'></a><a href='#L66'>66</a>
<a name='L67'></a><a href='#L67'>67</a>
<a name='L68'></a><a href='#L68'>68</a>
<a name='L69'></a><a href='#L69'>69</a>
<a name='L70'></a><a href='#L70'>70</a>
<a name='L71'></a><a href='#L71'>71</a>
<a name='L72'></a><a href='#L72'>72</a>
<a name='L73'></a><a href='#L73'>73</a>
<a name='L74'></a><a href='#L74'>74</a>
<a name='L75'></a><a href='#L75'>75</a>
<a name='L76'></a><a href='#L76'>76</a>
<a name='L77'></a><a href='#L77'>77</a>
<a name='L78'></a><a href='#L78'>78</a>
<a name='L79'></a><a href='#L79'>79</a>
<a name='L80'></a><a href='#L80'>80</a>
<a name='L81'></a><a href='#L81'>81</a>
<a name='L82'></a><a href='#L82'>82</a>
<a name='L83'></a><a href='#L83'>83</a>
<a name='L84'></a><a href='#L84'>84</a>
<a name='L85'></a><a href='#L85'>85</a>
<a name='L86'></a><a href='#L86'>86</a>
<a name='L87'></a><a href='#L87'>87</a>
<a name='L88'></a><a href='#L88'>88</a>
<a name='L89'></a><a href='#L89'>89</a>
<a name='L90'></a><a href='#L90'>90</a>
<a name='L91'></a><a href='#L91'>91</a>
<a name='L92'></a><a href='#L92'>92</a>
<a name='L93'></a><a href='#L93'>93</a>
<a name='L94'></a><a href='#L94'>94</a>
<a name='L95'></a><a href='#L95'>95</a>
<a name='L96'></a><a href='#L96'>96</a>
<a name='L97'></a><a href='#L97'>97</a>
<a name='L98'></a><a href='#L98'>98</a>
<a name='L99'></a><a href='#L99'>99</a>
<a name='L100'></a><a href='#L100'>100</a>
<a name='L101'></a><a href='#L101'>101</a>
<a name='L102'></a><a href='#L102'>102</a>
<a name='L103'></a><a href='#L103'>103</a>
<a name='L104'></a><a href='#L104'>104</a>
<a name='L105'></a><a href='#L105'>105</a>
<a name='L106'></a><a href='#L106'>106</a>
<a name='L107'></a><a href='#L107'>107</a>
<a name='L108'></a><a href='#L108'>108</a>
<a name='L109'></a><a href='#L109'>109</a>
<a name='L110'></a><a href='#L110'>110</a>
<a name='L111'></a><a href='#L111'>111</a>
<a name='L112'></a><a href='#L112'>112</a>
<a name='L113'></a><a href='#L113'>113</a>
<a name='L114'></a><a href='#L114'>114</a>
<a name='L115'></a><a href='#L115'>115</a>
<a name='L116'></a><a href='#L116'>116</a>
<a name='L117'></a><a href='#L117'>117</a>
<a name='L118'></a><a href='#L118'>118</a>
<a name='L119'></a><a href='#L119'>119</a>
<a name='L120'></a><a href='#L120'>120</a>
<a name='L121'></a><a href='#L121'>121</a>
<a name='L122'></a><a href='#L122'>122</a>
<a name='L123'></a><a href='#L123'>123</a>
<a name='L124'></a><a href='#L124'>124</a>
<a name='L125'></a><a href='#L125'>125</a>
<a name='L126'></a><a href='#L126'>126</a>
<a name='L127'></a><a href='#L127'>127</a>
<a name='L128'></a><a href='#L128'>128</a>
<a name='L129'></a><a href='#L129'>129</a>
<a name='L130'></a><a href='#L130'>130</a>
<a name='L131'></a><a href='#L131'>131</a>
<a name='L132'></a><a href='#L132'>132</a>
<a name='L133'></a><a href='#L133'>133</a>
<a name='L134'></a><a href='#L134'>134</a>
<a name='L135'></a><a href='#L135'>135</a>
<a name='L136'></a><a href='#L136'>136</a>
<a name='L137'></a><a href='#L137'>137</a>
<a name='L138'></a><a href='#L138'>138</a>
<a name='L139'></a><a href='#L139'>139</a>
<a name='L140'></a><a href='#L140'>140</a>
<a name='L141'></a><a href='#L141'>141</a>
<a name='L142'></a><a href='#L142'>142</a>
<a name='L143'></a><a href='#L143'>143</a>
<a name='L144'></a><a href='#L144'>144</a>
<a name='L145'></a><a href='#L145'>145</a>
<a name='L146'></a><a href='#L146'>146</a>
<a name='L147'></a><a href='#L147'>147</a>
<a name='L148'></a><a href='#L148'>148</a>
<a name='L149'></a><a href='#L149'>149</a>
<a name='L150'></a><a href='#L150'>150</a>
<a name='L151'></a><a href='#L151'>151</a>
<a name='L152'></a><a href='#L152'>152</a>
<a name='L153'></a><a href='#L153'>153</a>
<a name='L154'></a><a href='#L154'>154</a></td><td class="line-coverage quiet"><span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js"><span class="cstat-no" title="statement not covered" ><span class="fstat-no" title="function not covered" ><span class="branch-0 cbranch-no" title="branch not covered" >const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["js/app-core-rH6lZf1X.js","js/vendor-CFMRQ_Yt.js","js/data-vendor-DBrFxduC.js","js/echarts-vendor-xTKhTmAz.js","assets/vendor-BOltB2Hq.css","js/services-B0KkmCks.js","js/firebase-vendor-DFJ8_Xw5.js","js/utils-CrQ8UdBz.js","js/date-vendor-BU9txqBG.js"])))=&gt;i.map(i=&gt;d[i]);</span></span></span>
<span class="cstat-no" title="statement not covered" >var __defProp=Object.defineProperty,__publicField=(obj,key,value)=&gt;((obj,key,value)=&gt;key in obj?__defProp(obj,key,{enumerable:!0,configurable:!0,writable:!0,value:value}):obj[key]=value)(obj,"symbol"!=typeof key?key+"":key,value);import{n as reactExports,q as jsxRuntimeExports,D as Dialog,C as DialogTitle,E as Box,W as BuildIcon,T as Typography$1,G as DialogContent,A as Alert,X as List,Y as ListItem,Z as ListItemIcon,_ as CheckCircleIcon,$ as ListItemText,a0 as LinearProgress,Q as Chip,a1 as WarningIcon,a2 as ErrorIcon,U as DialogActions,V as Button,I as Paper,a3 as ErrorIcon$1,a4 as ExpandMoreIcon,a5 as Collapse,a6 as Refresh,a7 as HomeIcon,o as useTheme,a8 as Slide,a9 as Card,v as alpha,aa as CardContent,ab as PhoneIcon,ac as DesktopIcon,ad as ExportIcon,ae as IconButton,af as Close,ag as AlertTitle,ah as CircularProgress,ai as Info,S as Snackbar,aj as Tooltip,ak as SyncIcon,al as SyncDisabledIcon,am as AccessTime,an as ExpandLess,ao as FormControlLabel,ap as Switch,aq as Select,ar as MenuItem,as as Stack,z as useNavigate,at as useLocation,au as MenuIcon,av as CollapseIcon,aw as Divider,ax as ListItemButton,O as React,ay as Avatar,az as LogoutIcon,aA as Dashboard,aB as AnalyticsIcon,aC as SettingsIcon,aD as HelpIcon,a as useSelector,aE as Fade,aF as Speed,aG as ScheduleIcon,aH as Wifi,aI as WifiOff,aJ as Link,aK as NavigateNextIcon,aL as FolderIcon,aM as Assessment,aN as BarChart,aO as PersonIcon,aP as ApiIcon,aQ as SecurityIcon,aR as AdminPanelSettings,aS as TrendingUp,aT as NotificationsIcon,aU as StorageIcon,aV as ArrowDownIcon,t as useMediaQuery,w as useQueryClient,aW as FullscreenExitIcon,aX as FullscreenIcon,b as createTheme,aY as CloudDownloadIcon,aZ as Portal,a_ as styled,K as Keyboard,a$ as AccessibilityIcon,b0 as ThemeProvider,b1 as CssBaseline,b2 as Texture2D,b3 as Vector3,b4 as Vector2,b5 as Node$1,b6 as Shader,b7 as utilShaderCode,b8 as prezGLSL,b9 as Scene,ba as Material,bb as Renderer,bc as Mesh,bd as Texture,be as Geometry,bf as Sphere,bg as Plane,bh as Cube,bi as AmbientLight,bj as DirectionalLight,bk as PointLight,bl as SpotLight,bm as Perspective,bn as Orthographic,bo as Vector4,bp as Quaternion,bq as Matrix2,br as Matrix2d,bs as Matrix3,bt as Matrix4,bu as Plane$1,bv as Ray,bw as BoundingBox,bx as Frustum,by as textureUtil,bz as AmbientCubemapLight,bA as AmbientSHLight,bB as sh,bC as RayPicking,bD as notifier,bE as Base,bF as glmatrix,bG as Skybox,bH as Pass,bI as FrameBuffer,bJ as cubemapUtil,bK as createCompositor,bL as blurCode,bM as lutCode,bN as outputCode,bO as brightCode,bP as downsampleCode,bQ as upsampleCode,bR as hdrCode,bS as blendCode,bT as fxaaCode,bU as ShadowMapPass,bV as Checkbox,bW as CheckBoxIcon,bX as CheckBoxOutlineBlankIcon,bY as LockIcon,bZ as Email,b_ as GoogleIcon,b$ as BusinessIcon,c0 as LightbulbIcon,c1 as Check,c2 as Stepper,c3 as Step,c4 as StepLabel,c5 as StepContent,c6 as AddIcon,c7 as Share,c8 as Zoom,c9 as CelebrationIcon,ca as ArrowBack,cb as PlayIcon,cc as ArrowForward,cd as keyframes,B as useHotkeys,ce as ArrowUpIcon,cf as CardHeader,cg as Skeleton,ch as isEqual,ci as ContentCopy,cj as BugReportIcon,ck as CompressIcon,cl as ResetIcon,cm as DateRange,cn as GridIcon,co as FilterIcon,cp as TransformIcon,cq as EChartsReact,cr as ImageIcon,cs as CsvIcon,ct as JsonIcon,cu as ButtonGroup,cv as Menu,cw as motion,cx as AnimatePresence,cy as Badge,cz as ToggleButtonGroup,cA as ToggleButton,cB as FilterIcon$1,H as TableContainer,J as Table,cC as TableHead,M as TableRow,N as TableCell,L as TableBody,cD as Download,cE as Tabs,cF as Tab,cG as Grid,cH as LocalFireDepartment,cI as Thermostat,cJ as AcUnit,cK as SkipPreviousIcon,cL as PauseIcon,cM as PlayArrowIcon,cN as SkipNextIcon,cO as Slider,cP as PanelIcon,cQ as OverlayIcon,cR as Category,cS as TextField,cT as InputAdornment,cU as ClearIcon,cV as SearchIcon,cW as DeviceThermostat,cX as WaterDrop,cY as Air,cZ as TrendingDownIcon,c_ as FormControl,c$ as InputLabel,d0 as Battery4Bar,d1 as Calculate,d2 as Whatshot,d3 as ThermostatAuto,d4 as CompareArrows,d5 as useInView,d6 as lodashExports,d7 as Edit,d8 as Delete,d9 as reactGridLayoutExports,da as SpeedDial,db as SpeedDialAction,dc as SpeedDialIcon,dd as CameraAlt,de as SaveIcon,df as SignalIcon,dg as CloudIcon,dh as BatteryIcon,di as NetworkCheckIcon,dj as TimerIcon,dk as Accordion,dl as AccordionSummary,dm as AccordionDetails,dn as FormGroup,dp as MoneyIcon,dq as DataUsageIcon,dr as Navigate,ds as ReactEChartsCore,dt as TablePagination,x as useQuery,du as Container,dv as VisibilityOffIcon,dw as VisibilityIcon,dx as CachedOutlined,dy as FlashOn,dz as MemoryIcon,dA as FixedSizeList,dB as ElectricBolt,dC as QueryStats,dD as HelpOutlineIcon,dE as ShowChart,dF as AutoFixHighIcon,dG as TipsAndUpdates,dH as WbCloudy,dI as DeviceHub,dJ as Timeline,dK as BubbleChart,dL as AccountTree,dM as Popover,dN as FormLabel,dO as RadioGroup,dP as Radio,dQ as Tune,dR as LinkIcon,dS as GridOn,dT as CreateNewFolder,dU as DragDropContext,dV as FolderOpen,dW as MoreVert,dX as ConnectedDroppable,dY as PublicDraggable,dZ as DragIndicator,d_ as CardActions,d$ as RestoreFromTrash}from"./vendor-CFMRQ_Yt.js";import{u as useAppSelector,g as glassEffect,f as featureFlags,a as useGlobalTimeRangeStore,b as useAppDispatch,c as auth,l as logout,d as useInstallPrompt,e as useSupportsTouch,h as usePullToRefresh,i as useTokenStatus,j as useDialogFocusTrap,s as sesColorPalette,k as useFaultDetection,m as useBaseChartOptions,n as useChartDataSimple,o as useBarChartClick,p as mergeChartOptions,q as createBarChartClickEvent,r as useChartKeyboardShortcuts$1,t as usePoints,v as useMobileDetection,w as useDashboardContext,_ as __vitePreload,x as db,y as usePointData,z as useWizardStatePersistence,A as useWizardAutoSave,B as useSitePoints,C as useSnackbar,D as firebaseFunctions}from"./app-core-rH6lZf1X.js";import{l as fixInvalidChartTypes,m as cleanupInvalidMonitors,p as enhancedErrorHandler,q as getCircuitBreakerState,s as getCircuitBreakerStats,u as CircuitState,x as resetCircuitBreaker,y as getAuthErrorMessage,z as chartResizeDebugger,A as isSeriesArray,B as createSafeEChartsOption,D as createEnhancedTooltip,E as handleEmptyChartData,F as addChartErrorBoundaries,G as optimizeChartPerformance,H as applyResponsiveConfig,I as applyLargeDataOptimizations,J as generateDeviationBands,K as generateDeviationZones,L as calculateDeviation$2,M as createRangeZones,N as getRangeComplianceColor,O as enhanceChartWithProfessionalTheme,P as fixChartInteractions,Z as Z_INDEX_CONFIG,Q as exportTimeseriesAsJSON,R as exportChartWithCalculations,U as exportTimeseriesAsCSV,V as exportChartAsImage,W as applyVisualEnhancements,X as GRADIENT_PRESETS,Y as formatNumberForDisplay,_ as getOptimizedChartOptions,$ as getRecommendedSettings,a0 as createKeyboardNavState,a1 as generateDataPointAnnouncement,a2 as handleKeyboardNav,a3 as HIGH_CONTRAST_COLORS,a4 as buildChartTitle,a5 as buildXAxis,a6 as buildYAxis,a7 as combineOptions,a8 as transformToTimeSeries,a9 as formatPointWithTags,aa as getAdaptiveSymbolSize,ab as getAdaptiveLineWidth,ac as createThresholdLine,ad as createThresholdZones,C as CHART_DESIGN_TOKENS,ae as buildTooltip,c as calculateGridTop,af as buildLegend,ag as createEChartsAriaConfig,ah as enhanceChart,ai as srOnlyStyles,aj as chartFocusStyles,ak as generateChartAriaLabel,al as DARK_THEME_COLORS,am as getDistinctColors,an as HEATMAP_COLOR_SCALES,ao as ChartStatistics,ap as buildVisualMap,aq as generateColorScale,ar as SeriesBuilders,as as TimeAggregation,at as DeviationCalculations,au as transformToGauge,av as createGaugeThresholds,aw as transformToScatter,ax as getTimeAxisConfig,ay as validateSeriesForInterpolation,az as getAllTimestamps,aA as generateSamplingTimestamps,aB as interpolateValue,aC as calculatePsychrometricProperties,aD as generateConstantEnthalpyLines,aE as generateConstantWetBulbLines,g as getPointDisplayLabel,aF as calculateDewPoint,aG as calculateWetBulbTemperature,aH as generateASHRAE55ComfortZone,aI as getComfortColor,aJ as transformToEconomizer,aK as getHVACModeColor,aL as getTooltipBorder,aM as getTooltipBackground,aN as analyzeAlignmentQuality,aO as alignTimeSeries,aP as ChartTimeFormatter,aQ as getHeatmapRenderingStrategy,aR as optimizeHeatmapForECharts,aS as DEVIATION_COLORS,aT as transformToRadar,aU as DataValidation,aV as registerChartForActions,aW as addChartToGroup,aX as DEVIATION_COLOR_SCHEMES,aY as chartActionDispatcher,aZ as detectComprehensiveFaults,a_ as analyzeSensorReliability,a$ as generateSystemHealthReport,b0 as detectLowAirflowAlarm,b1 as calculateCoolingSATResetRequests,b2 as calculateStaticPressureResetRequests,b3 as calculateHotWaterResetRequests,b4 as getStatColor,b5 as createNumericInputProps}from"./utils-CrQ8UdBz.js";import{t as tokenMigrationService,n as pointPreloadService,o as debugService,q as fetchMetrics,r as fetchHistoricalMetrics,u as fetchErrorLogs,w as fetchCacheAnalytics,x as fetchSystemStatus}from"./services-B0KkmCks.js";import{t as signOut,m as getDoc,l as doc,s as setDoc}from"./firebase-vendor-DFJ8_Xw5.js";import{m as map,i as isArray,A as Animator,L as LRU,p as parse,R as Rect,g as getECData,r as requestAnimationFrame$1,e as each,a as indexOf,b as registerPostInit,c as registerPostUpdate,d as registerPreprocessor,Z as ZRImage,C as ComponentModel,f as merge,h as defaults,j as init,k as brushSingle,M as Model,l as ZRText,n as createTextStyle,o as ComponentView,q as getPrecisionSafe,s as Cartesian,t as inherits,u as Axis,v as getLayoutRect,w as createScale,x as mixinAxisModelCommonMethods,y as clone,O as OrdinalMeta,z as curry,B as use,D as getMap,E as createDimensions,S as SeriesData,F as lift,G as BoundingRect,H as parseGeoJSON,I as fixTextCoords,J as fixGeoCoords,K as reduce,N as parseDate,P as dataStack,Q as formatTpl,T as encodeHTML,U as addCommas,V as isObject,W as getTooltipMarker,X as formatTime,Y as getCoordinateSystemDimensions,_ as SeriesModel,$ as ChartView,a0 as containStroke,a1 as createSymbol,a2 as round,a3 as createList$1,a4 as create$1,a5 as invert,a6 as applyTransform,a7 as Graph,a8 as linkSeriesData,a9 as linearMap,aa as extend,ab as concatArray,ac as echarts,ad as install$g,ae as LinearGradient,af as echarts$1,ag as install$h,ah as install$i,ai as install$j,aj as install$k,ak as install$l,al as install$m,am as install$n,an as install$o,ao as install$p}from"./echarts-vendor-xTKhTmAz.js";import{f as format$1}from"./date-vendor-BU9txqBG.js";const MonitorRepairDialog=({open:open,onClose:onClose,onRepairComplete:onRepairComplete})=&gt;{const[isRepairing,setIsRepairing]=reactExports.useState(!1),[repairResults,setRepairResults]=reactExports.useState(null),[error,setError]=reactExports.useState(null),userId=useAppSelector(state=&gt;{var _a;return null==(_a=state.auth.user)?void 0:_a.uid}),handleClose=()=&gt;{isRepairing||(onClose(),setRepairResults(null),setError(null))};return jsxRuntimeExports.jsxs(Dialog,{open:open,onClose:handleClose,maxWidth:"sm",fullWidth:!0,disableEscapeKeyDown:isRepairing,children:[jsxRuntimeExports.jsx(DialogTitle,{children:jsxRuntimeExports.jsxs(Box,{display:"flex",alignItems:"center",gap:1,children:[jsxRuntimeExports.jsx(BuildIcon,{color:"primary"}),jsxRuntimeExports.jsx(Typography$1,{variant:"h6",children:"Repair Dashboard"})]})}),jsxRuntimeExports.jsxs(DialogContent,{children:[!repairResults&amp;&amp;!isRepairing&amp;&amp;jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsxs(Alert,{severity:"warning",sx:{mb:2},children:[jsxRuntimeExports.jsx(Typography$1,{variant:"body2",gutterBottom:!0,children:jsxRuntimeExports.jsx("strong",{children:"Dashboard Issue Detected"})}),jsxRuntimeExports.jsx(Typography$1,{variant:"body2",children:"Some charts in your dashboard have invalid configurations that prevent them from displaying properly."})]}),jsxRuntimeExports.jsx(Typography$1,{variant:"body1",paragraph:!0,children:"The repair tool will:"}),jsxRuntimeExports.jsxs(List,{dense:!0,children:[jsxRuntimeExports.jsxs(ListItem,{children:[jsxRuntimeExports.jsx(ListItemIcon,{children:jsxRuntimeExports.jsx(CheckCircleIcon,{color:"success",fontSize:"small"})}),jsxRuntimeExports.jsx(ListItemText,{primary:"Fix charts with invalid types",secondary:"Converts invalid chart types to working defaults"})]}),jsxRuntimeExports.jsxs(ListItem,{children:[jsxRuntimeExports.jsx(ListItemIcon,{children:jsxRuntimeExports.jsx(CheckCircleIcon,{color:"success",fontSize:"small"})}),jsxRuntimeExports.jsx(ListItemText,{primary:"Remove corrupted charts",secondary:"Removes charts that cannot be repaired"})]}),jsxRuntimeExports.jsxs(ListItem,{children:[jsxRuntimeExports.jsx(ListItemIcon,{children:jsxRuntimeExports.jsx(CheckCircleIcon,{color:"success",fontSize:"small"})}),jsxRuntimeExports.jsx(ListItemText,{primary:"Preserve your data",secondary:"Your settings and configurations will be maintained"})]})]})]}),isRepairing&amp;&amp;jsxRuntimeExports.jsxs(Box,{textAlign:"center",py:3,children:[jsxRuntimeExports.jsx(Typography$1,{variant:"body1",gutterBottom:!0,children:"Repairing your dashboard..."}),jsxRuntimeExports.jsx(LinearProgress,{sx:{mt:2}})]}),repairResults&amp;&amp;jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(Alert,{severity:repairResults.fixed&gt;0||repairResults.removed&gt;0?"success":"info",sx:{mb:2},children:jsxRuntimeExports.jsx(Typography$1,{variant:"body2",children:"Repair completed successfully!"})}),jsxRuntimeExports.jsxs(Box,{sx:{mb:2},children:[jsxRuntimeExports.jsxs(Box,{display:"flex",gap:2,justifyContent:"center",mb:2,children:[jsxRuntimeExports.jsx(Chip,{icon:jsxRuntimeExports.jsx(CheckCircleIcon,{}),label:`${repairResults.fixed} Fixed`,color:"success",variant:"outlined"}),jsxRuntimeExports.jsx(Chip,{icon:jsxRuntimeExports.jsx(WarningIcon,{}),label:`${repairResults.removed} Removed`,color:"warning",variant:"outlined"})]}),repairResults.errors.length&gt;0&amp;&amp;jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(Typography$1,{variant:"subtitle2",gutterBottom:!0,children:"Issues found and fixed:"}),jsxRuntimeExports.jsx(List,{dense:!0,sx:{maxHeight:200,overflow:"auto"},children:repairResults.errors.map((item,index2)=&gt;jsxRuntimeExports.jsxs(ListItem,{children:[jsxRuntimeExports.jsx(ListItemIcon,{children:jsxRuntimeExports.jsx(ErrorIcon,{color:"action",fontSize:"small"})}),jsxRuntimeExports.jsx(ListItemText,{primary:item.name||"Unnamed chart",secondary:item.errors.join(", ")})]},index2))})]})]}),(repairResults.fixed&gt;0||repairResults.removed&gt;0)&amp;&amp;jsxRuntimeExports.jsx(Alert,{severity:"info",children:jsxRuntimeExports.jsx(Typography$1,{variant:"body2",children:"The page will reload in a moment to apply the fixes..."})})]}),error&amp;&amp;jsxRuntimeExports.jsx(Alert,{severity:"error",sx:{mt:2},children:error})]}),jsxRuntimeExports.jsxs(DialogActions,{children:[!repairResults&amp;&amp;jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(Button,{onClick:handleClose,disabled:isRepairing,children:"Cancel"}),jsxRuntimeExports.jsx(Button,{onClick:async()=&gt;{if(userId){setIsRepairing(!0),setError(null),setRepairResults(null);try{const fixedCount=await fixInvalidChartTypes(userId),cleanupResult=await cleanupInvalidMonitors(userId);setRepairResults({fixed:fixedCount,removed:cleanupResult.cleaned,errors:cleanupResult.errors}),(fixedCount&gt;0||cleanupResult.cleaned&gt;0)&amp;&amp;setTimeout(()=&gt;{null==onRepairComplete||onRepairComplete(),window.location.reload()},2e3)}catch(err){console.error("Error repairing monitors:",err),setError(err instanceof Error?err.message:"Failed to repair monitors")}finally{setIsRepairing(!1)}}else setError("No user logged in")},variant:"contained",disabled:isRepairing,startIcon:isRepairing?null:jsxRuntimeExports.jsx(BuildIcon,{}),children:isRepairing?"Repairing...":"Start Repair"})]}),repairResults&amp;&amp;jsxRuntimeExports.jsx(Button,{onClick:handleClose,variant:"contained",children:"Close"})]})]})};class ErrorBoundary extends reactExports.Component{constructor(){super(...arguments),__publicField(this,"state",{hasError:!1,error:null,errorInfo:null,showDetails:!1,showRepairDialog:!1,isChartError:!1}),__publicField(this,"isChartRelatedError",(error,errorInfo)=&gt;{var _a;const errorMessage=error.message.toLowerCase(),stackTrace=(null==(_a=error.stack)?void 0:_a.toLowerCase())||"",componentStack=errorInfo.componentStack.toLowerCase();return["charttype","enhancechart","echarts","chart","monitor","realchartrenderer","chartwidget","chartframe"].some(pattern=&gt;errorMessage.includes(pattern)||stackTrace.includes(pattern)||componentStack.includes(pattern))}),__publicField(this,"logErrorToService",(error,errorInfo)=&gt;{const errorData={message:error.message,stack:error.stack,componentStack:errorInfo.componentStack,timestamp:(new Date).toISOString(),userAgent:navigator.userAgent,url:window.location.href};try{const errors=JSON.parse(sessionStorage.getItem("app_errors")||"[]");errors.push(errorData),errors.length&gt;10&amp;&amp;errors.shift(),sessionStorage.setItem("app_errors",JSON.stringify(errors))}catch{}}),__publicField(this,"handleReset",()=&gt;{this.setState({hasError:!1,error:null,errorInfo:null,showDetails:!1,showRepairDialog:!1,isChartError:!1})}),__publicField(this,"toggleDetails",()=&gt;{this.setState(prev=&gt;({showDetails:!prev.showDetails}))}),__publicField(this,"navigateHome",()=&gt;{window.location.href="/"}),__publicField(this,"handleOpenRepair",()=&gt;{this.setState({showRepairDialog:!0})}),__publicField(this,"handleCloseRepair",()=&gt;{this.setState({showRepairDialog:!1})}),__publicField(this,"handleRepairComplete",()=&gt;{})}static getDerivedStateFromError(error){return{hasError:!0,error:error,errorInfo:null}}componentDidCatch(error,errorInfo){enhancedErrorHandler(error,errorInfo),this.logErrorToService(error,errorInfo);const isChartError=this.isChartRelatedError(error,errorInfo);this.setState({error:error,errorInfo:errorInfo,isChartError:isChartError})}render(){if(this.state.hasError){if(this.props.fallback)return jsxRuntimeExports.jsx(jsxRuntimeExports.Fragment,{children:this.props.fallback});const isDevelopment=!1;return jsxRuntimeExports.jsxs(Box,{sx:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"100vh",background:"linear-gradient(135deg, #0a0a0a 0%, #1a1a1a 100%)",padding:3},children:[jsxRuntimeExports.jsxs(Paper,{elevation:0,sx:{padding:4,maxWidth:700,textAlign:"center",...glassEffect.strong,border:"1px solid rgba(255, 255, 255, 0.1)"},children:[jsxRuntimeExports.jsx(ErrorIcon$1,{sx:{fontSize:72,color:"#FF4081",mb:3,filter:"drop-shadow(0 0 24px rgba(255, 64, 129, 0.5))"}}),jsxRuntimeExports.jsx(Typography$1,{gutterBottom:!0,sx:{background:"linear-gradient(135deg, #FF4081 0%, #FF79B0 100%)",backgroundClip:"text",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",fontWeight:600},variant:"h4",children:"Oops! Something went wrong"}),jsxRuntimeExports.jsx(Typography$1,{paragraph:!0,color:"text.secondary",sx:{mb:3,px:2},variant:"body1",children:"We encountered an unexpected error. Don't worry, your data is safe. You can try refreshing the page or returning to the dashboard."}),this.state.isChartError&amp;&amp;jsxRuntimeExports.jsx(Box,{sx:{mb:3,px:2},children:jsxRuntimeExports.jsx(Typography$1,{variant:"body2",sx:{color:"#FFA726",backgroundColor:"rgba(255, 167, 38, 0.1)",p:2,borderRadius:1,border:"1px solid rgba(255, 167, 38, 0.3)"},children:"This appears to be a chart configuration issue. Try using the Repair Dashboard tool to automatically fix any invalid charts."})}),this.state.showDetails&amp;&amp;this.state.error&amp;&amp;jsxRuntimeExports.jsxs(Box,{sx:{mb:3},children:[jsxRuntimeExports.jsxs(Button,{size:"small",startIcon:jsxRuntimeExports.jsx(ExpandMoreIcon,{sx:{transform:this.state.showDetails?"rotate(180deg)":"none",transition:"transform 0.3s"}}),sx:{mb:2},onClick:this.toggleDetails,children:[this.state.showDetails?"Hide":"Show"," Error Details"]}),jsxRuntimeExports.jsx(Collapse,{in:this.state.showDetails,children:jsxRuntimeExports.jsxs(Box,{sx:{mt:2,p:2,...glassEffect.light,borderRadius:2,textAlign:"left",maxHeight:400,overflow:"auto","&amp;::-webkit-scrollbar":{width:8},"&amp;::-webkit-scrollbar-track":{background:"rgba(255, 255, 255, 0.05)"},"&amp;::-webkit-scrollbar-thumb":{background:"rgba(255, 255, 255, 0.2)",borderRadius:4}},children:[jsxRuntimeExports.jsxs(Typography$1,{gutterBottom:!0,color:"error",sx:{fontFamily:"monospace"},variant:"subtitle2",children:[this.state.error.name,": ",this.state.error.message]}),this.state.error.stack&amp;&amp;jsxRuntimeExports.jsxs(Box,{sx:{mt:2},children:[jsxRuntimeExports.jsx(Typography$1,{gutterBottom:!0,color:"text.secondary",display:"block",variant:"caption",children:"Stack Trace:"}),jsxRuntimeExports.jsx(Typography$1,{component:"pre",sx:{overflow:"auto",fontSize:"0.75rem",fontFamily:"monospace",color:"rgba(255, 255, 255, 0.7)",whiteSpace:"pre-wrap",wordBreak:"break-word"},variant:"caption",children:this.state.error.stack})]}),this.state.errorInfo&amp;&amp;jsxRuntimeExports.jsxs(Box,{sx:{mt:2},children:[jsxRuntimeExports.jsx(Typography$1,{gutterBottom:!0,color:"text.secondary",display:"block",variant:"caption",children:"Component Stack:"}),jsxRuntimeExports.jsx(Typography$1,{component:"pre",sx:{overflow:"auto",fontSize:"0.75rem",fontFamily:"monospace",color:"rgba(255, 255, 255, 0.7)",whiteSpace:"pre-wrap",wordBreak:"break-word"},variant:"caption",children:this.state.errorInfo.componentStack})]})]})})]}),jsxRuntimeExports.jsxs(Box,{sx:{display:"flex",gap:2,justifyContent:"center",flexWrap:"wrap"},children:[this.state.isChartError&amp;&amp;jsxRuntimeExports.jsx(Button,{startIcon:jsxRuntimeExports.jsx(BuildIcon,{}),sx:{background:"linear-gradient(135deg, #FFA726 0%, #FF6F00 100%)","&amp;:hover":{background:"linear-gradient(135deg, #FF6F00 0%, #FFA726 100%)"}},variant:"contained",onClick:this.handleOpenRepair,children:"Repair Dashboard"}),jsxRuntimeExports.jsx(Button,{startIcon:jsxRuntimeExports.jsx(Refresh,{}),sx:{background:"linear-gradient(135deg, #00E5FF 0%, #00BFA5 100%)","&amp;:hover":{background:"linear-gradient(135deg, #00BFA5 0%, #00E5FF 100%)"}},variant:"contained",onClick:()=&gt;window.location.reload(),children:"Refresh Page"}),jsxRuntimeExports.jsx(Button,{startIcon:jsxRuntimeExports.jsx(HomeIcon,{}),sx:{borderColor:"rgba(255, 255, 255, 0.2)",color:"rgba(255, 255, 255, 0.9)","&amp;:hover":{borderColor:"rgba(255, 255, 255, 0.4)",backgroundColor:"rgba(255, 255, 255, 0.05)"}},variant:"outlined",onClick:this.navigateHome,children:"Go to Dashboard"}),isDevelopment]}),isDevelopment]}),jsxRuntimeExports.jsx(MonitorRepairDialog,{open:this.state.showRepairDialog,onClose:this.handleCloseRepair,onRepairComplete:this.handleRepairComplete})]})}return this.props.children}}const PWAInstallPrompt=({onInstall:onInstall,onDismiss:onDismiss})=&gt;{const theme=useTheme(),[deferredPrompt,setDeferredPrompt]=reactExports.useState(null),[showPrompt,setShowPrompt]=reactExports.useState(!1),[isInstalled,setIsInstalled]=reactExports.useState(!1),[platform,setPlatform]=reactExports.useState("unknown");reactExports.useEffect(()=&gt;{const isStandalone=window.matchMedia("(display-mode: standalone)").matches,isInApp=window.navigator.standalone;if(isStandalone||isInApp)return void setIsInstalled(!0);const isMobile=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);setPlatform(isMobile?"mobile":"desktop");const handleBeforeInstallPrompt=e2=&gt;{e2.preventDefault();setDeferredPrompt(e2);const lastDismissed=localStorage.getItem("pwa-install-dismissed"),threeDaysAgo=Date.now()-2592e5;(!lastDismissed||parseInt(lastDismissed)&lt;threeDaysAgo)&amp;&amp;setTimeout(()=&gt;{setShowPrompt(!0)},1e4)},handleAppInstalled=()=&gt;{setIsInstalled(!0),setShowPrompt(!1),null==onInstall||onInstall(),console.log("[PWA] App was installed successfully")};return window.addEventListener("beforeinstallprompt",handleBeforeInstallPrompt),window.addEventListener("appinstalled",handleAppInstalled),()=&gt;{window.removeEventListener("beforeinstallprompt",handleBeforeInstallPrompt),window.removeEventListener("appinstalled",handleAppInstalled)}},[onInstall]);const handleDismiss=()=&gt;{setShowPrompt(!1),localStorage.setItem("pwa-install-dismissed",Date.now().toString()),null==onDismiss||onDismiss()};return!isInstalled&amp;&amp;showPrompt&amp;&amp;deferredPrompt?jsxRuntimeExports.jsx(Slide,{direction:"up",in:showPrompt,mountOnEnter:!0,unmountOnExit:!0,children:jsxRuntimeExports.jsx(Box,{sx:{position:"fixed",bottom:16,left:16,right:16,zIndex:theme.zIndex.snackbar,maxWidth:400,margin:"0 auto"},children:jsxRuntimeExports.jsx(Card,{sx:{background:`linear-gradient(135deg, ${theme.palette.primary.dark}F0 0%, ${theme.palette.primary.main}F0 100%)`,backdropFilter:"blur(20px)",WebkitBackdropFilter:"blur(20px)",border:`1px solid ${alpha(theme.palette.primary.main,.3)}`,boxShadow:`0 8px 32px ${alpha(theme.palette.primary.dark,.4)}`,color:theme.palette.primary.contrastText},children:jsxRuntimeExports.jsx(CardContent,{children:jsxRuntimeExports.jsxs(Box,{sx:{display:"flex",alignItems:"flex-start",gap:2},children:[jsxRuntimeExports.jsxs(Box,{sx:{flexGrow:1},children:[jsxRuntimeExports.jsxs(Box,{sx:{display:"flex",alignItems:"center",gap:1,mb:1},children:["mobile"===platform?jsxRuntimeExports.jsx(PhoneIcon,{sx:{fontSize:20,opacity:.8}}):jsxRuntimeExports.jsx(DesktopIcon,{sx:{fontSize:20,opacity:.8}}),jsxRuntimeExports.jsx(Typography$1,{variant:"h6",sx:{fontSize:"1.1rem",fontWeight:600},children:"Install Building Vitals"})]}),jsxRuntimeExports.jsx(Typography$1,{variant:"body2",sx:{mb:2,opacity:.9,lineHeight:1.4},children:"Get faster access to your building data with our app. Works offline and provides native-like experience."}),jsxRuntimeExports.jsx(Typography$1,{variant:"caption",sx:{display:"block",opacity:.7,mb:2,fontSize:"0.75rem"},children:(()=&gt;{const isIOS=/iPad|iPhone|iPod/.test(navigator.userAgent),isSafari=/^((?!chrome|android).)*safari/i.test(navigator.userAgent);return isIOS&amp;&amp;isSafari?'Tap the share button and select "Add to Home Screen"':"mobile"===platform?'Tap "Add to Home Screen" in your browser menu':"Click the install button in your browser's address bar"})()}),jsxRuntimeExports.jsxs(Box,{sx:{display:"flex",gap:1},children:[jsxRuntimeExports.jsx(Button,{variant:"contained",size:"small",startIcon:jsxRuntimeExports.jsx(ExportIcon,{}),onClick:async()=&gt;{if(deferredPrompt)try{await deferredPrompt.prompt();const{outcome:outcome}=await deferredPrompt.userChoice;"accepted"===outcome?console.log("[PWA] User accepted the install prompt"):console.log("[PWA] User dismissed the install prompt"),setDeferredPrompt(null),setShowPrompt(!1)}catch(error){console.error("[PWA] Error during installation:",error)}},sx:{background:alpha(theme.palette.background.paper,.2),color:theme.palette.primary.contrastText,fontWeight:500,textTransform:"none","&amp;:hover":{background:alpha(theme.palette.background.paper,.3)}},children:"Install"}),jsxRuntimeExports.jsx(Button,{variant:"text",size:"small",onClick:handleDismiss,sx:{color:alpha(theme.palette.primary.contrastText,.7),textTransform:"none","&amp;:hover":{color:theme.palette.primary.contrastText,background:alpha(theme.palette.background.paper,.1)}},children:"Not now"})]})]}),jsxRuntimeExports.jsx(IconButton,{size:"small",onClick:handleDismiss,sx:{color:alpha(theme.palette.primary.contrastText,.7),"&amp;:hover":{color:theme.palette.primary.contrastText,background:alpha(theme.palette.background.paper,.1)}},children:jsxRuntimeExports.jsx(Close,{fontSize:"small"})})]})})})})}):null},CircuitBreakerStatus=()=&gt;{const[_isOpen,setIsOpen]=reactExports.useState(!1),[stats,setStats]=reactExports.useState(null),[showAlert,setShowAlert]=reactExports.useState(!1);reactExports.useEffect(()=&gt;{const checkStatus=()=&gt;{const state=getCircuitBreakerState(),currentStats=getCircuitBreakerStats();setIsOpen(state===CircuitState.OPEN),setStats(currentStats),setShowAlert(state===CircuitState.OPEN)};checkStatus();const interval=setInterval(checkStatus,5e3);return()=&gt;clearInterval(interval)},[]),reactExports.useEffect(()=&gt;{if(showAlert){const timeout=setTimeout(()=&gt;{setShowAlert(!1)},3e4);return()=&gt;clearTimeout(timeout)}},[showAlert]);return showAlert?jsxRuntimeExports.jsx(Collapse,{in:showAlert,children:jsxRuntimeExports.jsxs(Alert,{action:jsxRuntimeExports.jsx(Button,{color:"inherit",size:"small",startIcon:jsxRuntimeExports.jsx(Refresh,{}),onClick:()=&gt;{const lastResetTime=sessionStorage.getItem("circuit_breaker_reset"),now=Date.now();if(lastResetTime&amp;&amp;now-parseInt(lastResetTime)&lt;1e4)return console.warn("[CircuitBreaker] Reset loop detected! Skipping reload."),resetCircuitBreaker(),void setShowAlert(!1);sessionStorage.setItem("circuit_breaker_reset",now.toString()),resetCircuitBreaker(),setShowAlert(!1),setTimeout(()=&gt;{window.location.reload()},500)},children:"Reset &amp; Retry"}),severity:"error",sx:{position:"fixed",top:80,left:"50%",transform:"translateX(-50%)",zIndex:1300,maxWidth:600,boxShadow:3,pointerEvents:"auto","&amp; .MuiAlert-message":{pointerEvents:"auto"}},onClose:()=&gt;setShowAlert(!1),children:[jsxRuntimeExports.jsx(AlertTitle,{children:"API Service Temporarily Unavailable"}),"The API service has been temporarily disabled due to multiple failures.",stats&amp;&amp;jsxRuntimeExports.jsxs("div",{style:{marginTop:8,fontSize:"0.875rem"},children:["Failed attempts: ",stats.failureCount]})]})}):null},MigrationBanner=()=&gt;{const{firebaseUser:firebaseUser}=useAppSelector(state=&gt;state.auth),[status,setStatus]=reactExports.useState(null),[loading,setLoading]=reactExports.useState(!0),[migrating,setMigrating]=reactExports.useState(!1),[dismissed,setDismissed]=reactExports.useState(!1),[error,setError]=reactExports.useState(null),[successMessage,setSuccessMessage]=reactExports.useState(null),shouldShowBanner=featureFlags.SHOW_MIGRATION_BANNER&amp;&amp;!dismissed&amp;&amp;(null==status?void 0:status.needsMigration);reactExports.useEffect(()=&gt;{firebaseUser?checkMigrationStatus():setLoading(!1)},[firebaseUser]),reactExports.useEffect(()=&gt;{const dismissedKey=`migration_banner_dismissed_${null==firebaseUser?void 0:firebaseUser.uid}`,wasDismissed="true"===localStorage.getItem(dismissedKey);setDismissed(wasDismissed)},[firebaseUser]);const checkMigrationStatus=async()=&gt;{if(firebaseUser)try{setLoading(!0);const migrationStatus=await tokenMigrationService.checkMigrationStatus(firebaseUser.uid);setStatus(migrationStatus)}catch(err){console.error("Failed to check migration status:",err)}finally{setLoading(!1)}},handleDismiss=()=&gt;{if(setDismissed(!0),firebaseUser){const dismissedKey=`migration_banner_dismissed_${firebaseUser.uid}`;localStorage.setItem(dismissedKey,"true")}};return loading||!shouldShowBanner?null:jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(Collapse,{in:!dismissed,children:jsxRuntimeExports.jsxs(Alert,{severity:"info",icon:jsxRuntimeExports.jsx(Info,{}),action:jsxRuntimeExports.jsxs(Box,{display:"flex",gap:1,alignItems:"center",children:[jsxRuntimeExports.jsx(Button,{color:"inherit",size:"small",variant:"outlined",onClick:async()=&gt;{if(firebaseUser)try{setMigrating(!0),setError(null),await tokenMigrationService.migrateUser(firebaseUser.uid,{preserveLegacy:featureFlags.PRESERVE_LEGACY_TOKENS,autoMigrate:!1}),setSuccessMessage("Your token has been successfully migrated to the new system!"),await checkMigrationStatus(),setTimeout(()=&gt;{handleDismiss()},3e3)}catch(err){const errorMsg=err instanceof Error?err.message:"Migration failed";setError(errorMsg)}finally{setMigrating(!1)}},disabled:migrating,startIcon:migrating?jsxRuntimeExports.jsx(CircularProgress,{size:16}):void 0,children:migrating?"Migrating...":"Migrate Now"}),jsxRuntimeExports.jsx(IconButton,{"aria-label":"close",color:"inherit",size:"small",onClick:handleDismiss,disabled:migrating,children:jsxRuntimeExports.jsx(Close,{fontSize:"inherit"})})]}),sx:{mb:2,borderRadius:2,"&amp; .MuiAlert-message":{width:"100%"}},children:[jsxRuntimeExports.jsx(AlertTitle,{children:"Token System Upgrade Available"}),jsxRuntimeExports.jsxs(Typography$1,{variant:"body2",children:['We\'ve upgraded our token management system to support multiple sites. Click "Migrate Now" to upgrade your token to the new system.',featureFlags.PRESERVE_LEGACY_TOKENS&amp;&amp;jsxRuntimeExports.jsx(jsxRuntimeExports.Fragment,{children:" Your existing token will be preserved as a backup."})]}),(null==status?void 0:status.errors)&amp;&amp;status.errors.length&gt;0&amp;&amp;jsxRuntimeExports.jsx(Box,{mt:1,children:jsxRuntimeExports.jsx(Typography$1,{variant:"caption",color:"error",children:status.errors.join(", ")})})]})}),jsxRuntimeExports.jsx(Snackbar,{open:!!successMessage,autoHideDuration:6e3,onClose:()=&gt;setSuccessMessage(null),anchorOrigin:{vertical:"top",horizontal:"center"},children:jsxRuntimeExports.jsx(Alert,{onClose:()=&gt;setSuccessMessage(null),severity:"success",icon:jsxRuntimeExports.jsx(CheckCircleIcon,{}),sx:{width:"100%"},children:successMessage})}),jsxRuntimeExports.jsx(Snackbar,{open:!!error,autoHideDuration:6e3,onClose:()=&gt;setError(null),anchorOrigin:{vertical:"top",horizontal:"center"},children:jsxRuntimeExports.jsxs(Alert,{onClose:()=&gt;setError(null),severity:"error",icon:jsxRuntimeExports.jsx(ErrorIcon,{}),sx:{width:"100%"},children:[jsxRuntimeExports.jsx(AlertTitle,{children:"Migration Failed"}),error]})})]})},TIME_RANGE_PRESETS=[{label:"Last 15 Minutes",value:"15m",group:"Real-time"},{label:"Last Hour",value:"1h",group:"Real-time"},{label:"Last 3 Hours",value:"3h",group:"Real-time"},{label:"Last 24 Hours",value:"24h",group:"Daily"},{label:"Yesterday",value:"yesterday",group:"Daily"},{label:"Last 7 Days",value:"7d",group:"Weekly"},{label:"Last 30 Days",value:"30d",group:"Monthly"},{label:"Last 90 Days",value:"90d",group:"Monthly"},{label:"Last 6 Months",value:"180d",group:"Long-term"},{label:"Last Year",value:"365d",group:"Long-term"},{label:"Custom Range...",value:"custom",group:"Custom"}],GlobalTimeRangePanelSimple=({collapsed:collapsed})=&gt;{var _a,_b;const theme=useTheme(),{globalTimeRange:globalTimeRange,setGlobalTimeRangeEnabled:setGlobalTimeRangeEnabled,setGlobalTimeRange:setGlobalTimeRange,setSyncedChartIds:setSyncedChartIds,restoreIndividualSettings:restoreIndividualSettings}=useGlobalTimeRangeStore(),[expanded,setExpanded]=reactExports.useState(!0),[isUpdating,setIsUpdating]=reactExports.useState(!1),[hovered,setHovered]=reactExports.useState(!1),enabled=globalTimeRange.enabled,timeRange=globalTimeRange.timeRange;return!enabled&amp;&amp;globalTimeRange.lastAppliedTimeRange,null==(_a=globalTimeRange.lastAppliedTimeRange)||_a.timeRange,collapsed?jsxRuntimeExports.jsx(Tooltip,{title:`Global Time: ${(null==(_b=TIME_RANGE_PRESETS.find(p=&gt;p.value===timeRange))?void 0:_b.label)||timeRange}${enabled?" (Active)":" (Inactive)"}`,placement:"right",arrow:!0,children:jsxRuntimeExports.jsx(Box,{onMouseEnter:()=&gt;setHovered(!0),onMouseLeave:()=&gt;setHovered(!1),sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",borderRadius:2,mb:1,minHeight:48,px:1,cursor:"pointer",position:"relative",transition:"all 0.2s ease",backgroundColor:enabled?alpha(theme.palette.primary.main,.1):"transparent","&amp;:hover":{backgroundColor:alpha(theme.palette.primary.main,enabled?.15:.05)}},children:jsxRuntimeExports.jsx(Box,{sx:{minWidth:0,display:"flex",justifyContent:"center",alignItems:"center",color:enabled?theme.palette.primary.main:theme.palette.text.secondary},children:enabled?jsxRuntimeExports.jsx(SyncIcon,{}):jsxRuntimeExports.jsx(SyncDisabledIcon,{})})})}):jsxRuntimeExports.jsxs(Box,{onMouseEnter:()=&gt;setHovered(!0),onMouseLeave:()=&gt;setHovered(!1),sx:{borderRadius:2,mb:1,px:2.5,py:1,position:"relative",transition:"all 0.2s ease",backgroundColor:expanded||enabled?alpha(theme.palette.primary.main,.1):"transparent","&amp;:hover":{backgroundColor:alpha(theme.palette.primary.main,expanded||enabled?.15:.05)}},children:[jsxRuntimeExports.jsxs(Box,{sx:{display:"flex",alignItems:"center",mb:expanded?theme.spacing(1):0,cursor:"pointer",minHeight:48},onClick:()=&gt;setExpanded(!expanded),children:[jsxRuntimeExports.jsx(Box,{sx:{minWidth:0,mr:3,display:"flex",justifyContent:"center",alignItems:"center",color:enabled?theme.palette.primary.main:theme.palette.text.secondary},children:jsxRuntimeExports.jsx(AccessTime,{})}),jsxRuntimeExports.jsx(Typography$1,{variant:"body1",sx:{flexGrow:1,fontSize:"0.875rem",fontWeight:enabled||expanded?600:400,color:enabled||expanded?theme.palette.primary.main:theme.palette.text.primary},children:"Global Time"}),jsxRuntimeExports.jsx(IconButton,{size:"small",sx:{p:.5,color:theme.palette.text.secondary,"&amp;:hover":{backgroundColor:"transparent"}},children:expanded?jsxRuntimeExports.jsx(ExpandLess,{fontSize:"small"}):jsxRuntimeExports.jsx(ExpandMoreIcon,{fontSize:"small"})})]}),jsxRuntimeExports.jsxs(Collapse,{in:expanded,timeout:300,children:[jsxRuntimeExports.jsx(FormControlLabel,{control:jsxRuntimeExports.jsx(Switch,{size:"small",checked:enabled,onChange:async()=&gt;{setIsUpdating(!0),setGlobalTimeRangeEnabled(!enabled),enabled||console.log("[GlobalTimeRangePanel] Enabling global time sync"),setTimeout(()=&gt;setIsUpdating(!1),500)},disabled:isUpdating,color:"primary",sx:{"&amp; .MuiSwitch-switchBase":{color:theme.palette.text.secondary,"&amp;.Mui-checked":{color:theme.palette.primary.main,"&amp; + .MuiSwitch-track":{backgroundColor:alpha(theme.palette.primary.main,.5)}}},"&amp; .MuiSwitch-track":{backgroundColor:alpha(theme.palette.text.disabled,.3)}}}),label:jsxRuntimeExports.jsx(Typography$1,{variant:"body2",sx:{color:theme.palette.text.primary,fontSize:"0.8rem",fontWeight:500},children:"Sync All Charts"}),sx:{mb:theme.spacing(1.5),ml:0,"&amp; .MuiFormControlLabel-label":{ml:theme.spacing(.5)}}}),jsxRuntimeExports.jsx(Select,{size:"small",fullWidth:!0,value:timeRange,onChange:async event=&gt;{const newRange=event.target.value;setIsUpdating(!0),"custom"===newRange?console.log("[GlobalTimeRangePanel] Custom range picker not yet implemented"):(setGlobalTimeRange(newRange),console.log("[GlobalTimeRangePanel] Time range changed to:",newRange)),setTimeout(()=&gt;setIsUpdating(!1),800)},disabled:!enabled||isUpdating,sx:{mb:theme.spacing(1),"&amp; .MuiSelect-select":{py:theme.spacing(.75),fontSize:"0.875rem",color:enabled?theme.palette.text.primary:theme.palette.text.disabled},"&amp; .MuiOutlinedInput-notchedOutline":{borderColor:alpha(theme.palette.divider,.2)},"&amp;:hover .MuiOutlinedInput-notchedOutline":{borderColor:enabled?theme.palette.primary.main:alpha(theme.palette.divider,.3)},"&amp;.Mui-focused .MuiOutlinedInput-notchedOutline":{borderColor:theme.palette.primary.main,borderWidth:1}},MenuProps:{PaperProps:{sx:{mt:theme.spacing(.5),border:`1px solid ${alpha(theme.palette.divider,.1)}`}}},children:TIME_RANGE_PRESETS.map(preset=&gt;jsxRuntimeExports.jsx(MenuItem,{value:preset.value,sx:{fontSize:"0.8rem","&amp;:hover":{backgroundColor:alpha(theme.palette.primary.main,.08)},"&amp;.Mui-selected":{backgroundColor:alpha(theme.palette.primary.main,.12),"&amp;:hover":{backgroundColor:alpha(theme.palette.primary.main,.16)}}},children:jsxRuntimeExports.jsxs(Stack,{direction:"row",spacing:1,alignItems:"center",width:"100%",children:[jsxRuntimeExports.jsx(Typography$1,{variant:"body2",sx:{fontSize:"0.8rem",fontWeight:500},children:preset.label}),jsxRuntimeExports.jsx(Typography$1,{variant:"caption",sx:{color:theme.palette.text.secondary,fontSize:"0.7rem",ml:"auto"},children:preset.group})]})},preset.value))}),!enabled&amp;&amp;jsxRuntimeExports.jsx(Button,{size:"small",variant:"text",fullWidth:!0,onClick:()=&gt;{setIsUpdating(!0),setGlobalTimeRangeEnabled(!0),console.log("[GlobalTimeRangePanel] Applied time range to all charts"),setTimeout(()=&gt;setIsUpdating(!1),500)},disabled:isUpdating,startIcon:jsxRuntimeExports.jsx(SyncIcon,{fontSize:"small"}),sx:{mt:theme.spacing(.5),fontSize:"0.875rem",textTransform:"none",color:theme.palette.primary.main,"&amp;:hover":{backgroundColor:alpha(theme.palette.primary.main,.08)}},children:"Apply to All"}),enabled&amp;&amp;jsxRuntimeExports.jsx(Typography$1,{variant:"caption",sx:{mt:theme.spacing(.5),color:theme.palette.text.secondary,fontSize:"0.75rem",display:"block"},children:"All charts synchronized"})]})]})},ModernSidebar=({collapsed:collapsed,onToggleCollapse:onToggleCollapse})=&gt;{var _a,_b;const theme=useTheme(),navigate=useNavigate(),location=useLocation(),dispatch=useAppDispatch(),user=useAppSelector(state=&gt;state.auth.firebaseUser);console.log("[ModernSidebar] Rendering with collapsed:",collapsed);const navigationItems=[{title:"Dashboard",icon:jsxRuntimeExports.jsx(Dashboard,{}),path:"/dashboard"},{title:"Monitoring",icon:jsxRuntimeExports.jsx(AnalyticsIcon,{}),path:"/monitoring"},{title:"API Config",icon:jsxRuntimeExports.jsx(SettingsIcon,{}),path:"/settings"},{title:"Help &amp; Tips",icon:jsxRuntimeExports.jsx(HelpIcon,{}),path:"/help"}];return jsxRuntimeExports.jsxs(Box,{sx:{width:collapsed?64:240,height:"100vh",position:"fixed",left:0,top:0,backgroundColor:"dark"===theme.palette.mode?alpha(theme.palette.background.paper,.8):alpha(theme.palette.background.paper,.95),backdropFilter:"blur(20px)",WebkitBackdropFilter:"blur(20px)",borderRight:`1px solid ${alpha(theme.palette.primary.main,.1)}`,transition:"width 0.3s cubic-bezier(0.4, 0, 0.2, 1)",display:"flex",flexDirection:"column",overflow:"hidden",zIndex:theme.zIndex.drawer},children:[jsxRuntimeExports.jsx(Box,{sx:{p:2,display:"flex",alignItems:"center",justifyContent:collapsed?"center":"space-between",minHeight:64,flexShrink:0},children:collapsed?jsxRuntimeExports.jsx(IconButton,{onClick:onToggleCollapse,sx:{color:theme.palette.primary.main,"&amp;:hover":{backgroundColor:alpha(theme.palette.primary.main,.1)}},children:jsxRuntimeExports.jsx(MenuIcon,{})}):jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsxs(Box,{sx:{display:"flex",flexDirection:"column",alignItems:"center",gap:.5},children:[jsxRuntimeExports.jsx("img",{src:"/logo-white.png",alt:"SES Logo",style:{height:36,width:"auto",filter:"dark"===theme.palette.mode?"none":"invert(1)"}}),jsxRuntimeExports.jsx(Typography$1,{variant:"h6",sx:{fontWeight:600,color:"dark"===theme.palette.mode?"#ffffff":theme.palette.primary.main,whiteSpace:"nowrap",fontFamily:'"JetBrains Mono", monospace',fontSize:"0.875rem",textAlign:"center"},children:"Building Vitals"})]}),jsxRuntimeExports.jsx(IconButton,{onClick:onToggleCollapse,size:"small",sx:{ml:1,color:theme.palette.text.secondary,"&amp;:hover":{backgroundColor:alpha(theme.palette.primary.main,.1)}},children:jsxRuntimeExports.jsx(CollapseIcon,{})})]})}),jsxRuntimeExports.jsx(Divider,{sx:{opacity:.1,flexShrink:0}}),jsxRuntimeExports.jsx(List,{sx:{flex:1,px:1,py:2,overflowY:"auto",overflowX:"hidden",minHeight:0},children:navigationItems.map((item,index2)=&gt;{const active=(path=item.path,location.pathname===path);var path;const isHelpItem="Help &amp; Tips"===item.title,ListItem2=jsxRuntimeExports.jsxs(ListItemButton,{onClick:()=&gt;navigate(item.path),sx:{borderRadius:2,mb:1,minHeight:48,justifyContent:collapsed?"center":"initial",px:collapsed?1:2.5,backgroundColor:active?alpha(theme.palette.primary.main,.1):"transparent","&amp;:hover":{backgroundColor:alpha(theme.palette.primary.main,active?.15:.05)},transition:"all 0.2s ease"},children:[jsxRuntimeExports.jsx(ListItemIcon,{sx:{minWidth:0,mr:collapsed?0:3,justifyContent:"center",color:active?theme.palette.primary.main:theme.palette.text.secondary},children:item.icon}),!collapsed&amp;&amp;jsxRuntimeExports.jsx(ListItemText,{primary:item.title,primaryTypographyProps:{fontSize:"0.875rem",fontWeight:active?600:400,color:active?theme.palette.primary.main:theme.palette.text.primary}})]}),WrappedListItem=collapsed?jsxRuntimeExports.jsx(Tooltip,{title:item.title,placement:"right",arrow:!0,sx:{"&amp; .MuiTooltip-tooltip":{backgroundColor:alpha(theme.palette.background.paper,.95),backdropFilter:"blur(10px)",WebkitBackdropFilter:"blur(10px)",border:`1px solid ${alpha(theme.palette.primary.main,.1)}`,color:theme.palette.text.primary,fontSize:"0.75rem"},"&amp; .MuiTooltip-arrow":{color:alpha(theme.palette.background.paper,.95),"&amp;::before":{border:`1px solid ${alpha(theme.palette.primary.main,.1)}`}}},children:ListItem2},item.path):jsxRuntimeExports.jsx(React.Fragment,{children:ListItem2},item.path);return isHelpItem?jsxRuntimeExports.jsxs(React.Fragment,{children:[WrappedListItem,jsxRuntimeExports.jsx(Divider,{sx:{opacity:.1,my:1,mx:2}}),jsxRuntimeExports.jsx(Box,{sx:{px:1},children:jsxRuntimeExports.jsx(GlobalTimeRangePanelSimple,{collapsed:collapsed})})]},item.path):WrappedListItem})}),jsxRuntimeExports.jsx(Divider,{sx:{opacity:.1,flexShrink:0}}),jsxRuntimeExports.jsxs(Box,{sx:{p:1.5,pb:1,display:"flex",flexDirection:"column",gap:1,flexShrink:0},children:[jsxRuntimeExports.jsxs(Box,{sx:{display:"flex",alignItems:"center",justifyContent:collapsed?"center":"flex-start"},children:[jsxRuntimeExports.jsx(Avatar,{sx:{width:collapsed?32:40,height:collapsed?32:40,backgroundColor:theme.palette.primary.main,fontSize:collapsed?"0.875rem":"1rem",transition:"all 0.3s ease"},children:(null==(_b=null==(_a=null==user?void 0:user.email)?void 0:_a[0])?void 0:_b.toUpperCase())||"U"}),!collapsed&amp;&amp;jsxRuntimeExports.jsxs(Box,{sx:{ml:2,overflow:"hidden",flex:1},children:[jsxRuntimeExports.jsx(Typography$1,{variant:"body2",sx:{fontWeight:600,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",fontSize:"0.8rem",maxWidth:"180px"},children:(null==user?void 0:user.displayName)||"User"}),jsxRuntimeExports.jsx(Typography$1,{variant:"caption",sx:{color:theme.palette.text.secondary,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",display:"block",fontSize:"0.7rem",maxWidth:"180px"},children:(null==user?void 0:user.email)||"user@example.com"})]})]}),jsxRuntimeExports.jsx(Box,{sx:{display:"flex",justifyContent:collapsed?"center":"flex-start"},children:jsxRuntimeExports.jsx(Tooltip,{title:"Logout",placement:"right",children:jsxRuntimeExports.jsxs(IconButton,{onClick:async()=&gt;{try{await signOut(auth),dispatch(logout()),navigate("/login")}catch(error){console.error("Logout failed:",error)}},size:collapsed?"small":"medium",sx:{color:theme.palette.text.secondary,backgroundColor:alpha(theme.palette.primary.main,.05),"&amp;:hover":{color:theme.palette.error.main,backgroundColor:alpha(theme.palette.error.main,.1)},width:collapsed?40:"auto",transition:"all 0.2s ease"},children:[jsxRuntimeExports.jsx(LogoutIcon,{fontSize:collapsed?"small":"medium"}),!collapsed&amp;&amp;jsxRuntimeExports.jsx(Typography$1,{sx:{ml:1,fontSize:"0.875rem"},children:"Logout"})]})})})]})]})},StatusBar=({sidebarCollapsed:sidebarCollapsed=!1,focusMode:focusMode=!1})=&gt;{const theme=useTheme(),{autoRefresh:autoRefresh,refreshInterval:refreshInterval}=useSelector(state=&gt;state.ui),[connectionStatus,setConnectionStatus]=reactExports.useState({status:"connected",lastApiCall:null,latency:null,nextRefresh:null}),[countdown,setCountdown]=reactExports.useState(0);reactExports.useEffect(()=&gt;{const checkApiHealth=()=&gt;{const startTime=Date.now();setTimeout(()=&gt;{const latency=Date.now()-startTime;setConnectionStatus(prev=&gt;({...prev,status:"connected",lastApiCall:new Date,latency:latency,nextRefresh:autoRefresh?new Date(Date.now()+1e3*refreshInterval):null}))},200*Math.random()+100)};checkApiHealth();const healthCheckInterval=setInterval(checkApiHealth,3e4);return()=&gt;clearInterval(healthCheckInterval)},[autoRefresh,refreshInterval]),reactExports.useEffect(()=&gt;{if(!autoRefresh||!connectionStatus.nextRefresh)return void setCountdown(0);const updateCountdown=()=&gt;{const now=Date.now(),nextRefresh=connectionStatus.nextRefresh.getTime(),remaining=Math.max(0,Math.ceil((nextRefresh-now)/1e3));setCountdown(remaining)};updateCountdown();const countdownInterval=setInterval(updateCountdown,1e3);return()=&gt;clearInterval(countdownInterval)},[autoRefresh,connectionStatus.nextRefresh]);const getStatusColor=()=&gt;{switch(connectionStatus.status){case"connected":return theme.palette.success.main;case"connecting":return theme.palette.warning.main;case"disconnected":return theme.palette.error.main;default:return theme.palette.text.secondary}};return jsxRuntimeExports.jsx(Fade,{in:!0,timeout:500,children:jsxRuntimeExports.jsxs(Box,{sx:{position:"fixed",bottom:0,left:focusMode?0:sidebarCollapsed?64:240,right:0,height:32,transition:"left 0.3s cubic-bezier(0.4, 0, 0.2, 1)",display:"flex",alignItems:"center",justifyContent:"space-between",px:2,py:.5,backgroundColor:"rgba(10, 10, 11, 0.98)",backdropFilter:"blur(10px)",WebkitBackdropFilter:"blur(10px)",borderTop:`1px solid ${theme.palette.divider}`,zIndex:theme.zIndex.drawer+2},children:[jsxRuntimeExports.jsxs(Box,{sx:{display:"flex",alignItems:"center",gap:2},children:[jsxRuntimeExports.jsx(Tooltip,{title:"connected"===connectionStatus.status?"Connected to ACE IoT API. Data is being received normally.":"connecting"===connectionStatus.status?"Establishing connection to ACE IoT API. Please wait...":"Disconnected from ACE IoT API. Check your network connection and API token.",children:jsxRuntimeExports.jsx(Chip,{icon:(()=&gt;{switch(connectionStatus.status){case"connected":default:return jsxRuntimeExports.jsx(Wifi,{sx:{fontSize:"1rem"}});case"connecting":return jsxRuntimeExports.jsx(SyncIcon,{sx:{fontSize:"1rem",animation:"spin 1s linear infinite"}});case"disconnected":return jsxRuntimeExports.jsx(WifiOff,{sx:{fontSize:"1rem"}})}})(),label:connectionStatus.status,size:"small",sx:{backgroundColor:`${getStatusColor()}20`,color:getStatusColor(),border:`1px solid ${getStatusColor()}40`,fontWeight:500,textTransform:"capitalize",fontSize:"0.75rem",height:24,"&amp; .MuiChip-icon":{color:getStatusColor()}}})}),connectionStatus.latency&amp;&amp;jsxRuntimeExports.jsx(Tooltip,{title:`API response time. Good: &lt;100ms, Acceptable: 100-300ms, Slow: &gt;300ms. Current: ${connectionStatus.latency}ms`,children:jsxRuntimeExports.jsxs(Box,{sx:{display:"flex",alignItems:"center",gap:.5},children:[jsxRuntimeExports.jsx(Speed,{sx:{fontSize:"0.9rem",color:theme.palette.text.secondary}}),jsxRuntimeExports.jsxs(Typography$1,{sx:{color:theme.palette.text.secondary,fontSize:"0.75rem"},variant:"caption",children:[connectionStatus.latency,"ms"]})]})})]}),jsxRuntimeExports.jsxs(Box,{sx:{display:"flex",alignItems:"center",gap:3},children:[connectionStatus.lastApiCall&amp;&amp;jsxRuntimeExports.jsx(Box,{sx:{display:"flex",alignItems:"center",gap:.5},children:jsxRuntimeExports.jsxs(Typography$1,{sx:{color:theme.palette.text.secondary,fontSize:"0.75rem"},variant:"caption",children:["Last update: ",(date=connectionStatus.lastApiCall,date?date.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0}):"--:--")]})}),autoRefresh&amp;&amp;countdown&gt;0&amp;&amp;jsxRuntimeExports.jsxs(Box,{sx:{display:"flex",alignItems:"center",gap:.5},children:[jsxRuntimeExports.jsx(ScheduleIcon,{sx:{fontSize:"0.9rem",color:theme.palette.primary.main}}),jsxRuntimeExports.jsxs(Typography$1,{sx:{color:theme.palette.primary.main,fontSize:"0.75rem",fontWeight:500},variant:"caption",children:["Next refresh: ",(seconds=countdown,`${Math.floor(seconds/60)}:${(seconds%60).toString().padStart(2,"0")}`)]})]})]}),jsxRuntimeExports.jsx(Box,{sx:{display:"flex",alignItems:"center",gap:1},children:jsxRuntimeExports.jsx(Typography$1,{sx:{color:theme.palette.text.secondary,fontSize:"0.75rem"},variant:"caption",children:"Building Vitals v1.0.0"})})]})});var seconds,date},InstallBanner=()=&gt;{const{canInstall:canInstall,promptInstall:promptInstall}=useInstallPrompt(),[dismissed,setDismissed]=reactExports.useState(!1),[isInstalling,setIsInstalling]=reactExports.useState(!1);if(!canInstall||dismissed)return null;return jsxRuntimeExports.jsx(Slide,{direction:"up",in:canInstall&amp;&amp;!dismissed,children:jsxRuntimeExports.jsx(Alert,{action:jsxRuntimeExports.jsxs(Box,{display:"flex",gap:1,children:[jsxRuntimeExports.jsx(Button,{color:"inherit",disabled:isInstalling,size:"small",startIcon:jsxRuntimeExports.jsx(ExportIcon,{}),sx:{textTransform:"none",fontWeight:600},onClick:async()=&gt;{setIsInstalling(!0),await promptInstall(),setIsInstalling(!1)},children:"Install App"}),jsxRuntimeExports.jsx(IconButton,{"aria-label":"dismiss",color:"inherit",size:"small",onClick:()=&gt;{setDismissed(!0),sessionStorage.setItem("installBannerDismissed","true")},children:jsxRuntimeExports.jsx(Close,{fontSize:"small"})})]}),icon:jsxRuntimeExports.jsx(PhoneIcon,{}),severity:"info",sx:{position:"fixed",bottom:{xs:60,sm:20},left:20,right:20,maxWidth:600,margin:"0 auto",boxShadow:3,"&amp; .MuiAlert-message":{flex:1,pr:2}},children:jsxRuntimeExports.jsxs(Box,{children:[jsxRuntimeExports.jsx(Typography$1,{fontWeight:600,variant:"subtitle2",children:"Install Building Vitals"}),jsxRuntimeExports.jsx(Typography$1,{display:"block",variant:"caption",children:"Get quick access and offline support"})]})})})},ROUTE_CONFIG=[{path:"/",label:"Home",icon:jsxRuntimeExports.jsx(HomeIcon,{}),description:"Main dashboard"},{path:"/dashboard",label:"Dashboard",icon:jsxRuntimeExports.jsx(Dashboard,{}),description:"Main dashboard"},{path:"/settings",label:"Settings",icon:jsxRuntimeExports.jsx(SettingsIcon,{}),description:"Application settings"},{path:"/settings/profile",label:"Profile",icon:jsxRuntimeExports.jsx(PersonIcon,{}),parent:"/settings",description:"User profile settings"},{path:"/settings/api",label:"API Configuration",icon:jsxRuntimeExports.jsx(ApiIcon,{}),parent:"/settings",description:"API token configuration"},{path:"/settings/security",label:"Security",icon:jsxRuntimeExports.jsx(SecurityIcon,{}),parent:"/settings",description:"Security settings"},{path:"/admin",label:"Admin",icon:jsxRuntimeExports.jsx(AdminPanelSettings,{}),description:"Administration panel"},{path:"/admin/users",label:"User Management",icon:jsxRuntimeExports.jsx(PersonIcon,{}),parent:"/admin",description:"Manage users"},{path:"/admin/system",label:"System Settings",icon:jsxRuntimeExports.jsx(SettingsIcon,{}),parent:"/admin",description:"System configuration"},{path:"/help",label:"Help",icon:jsxRuntimeExports.jsx(HelpIcon,{}),description:"Help and documentation"},{path:"/analytics",label:"Analytics",icon:jsxRuntimeExports.jsx(TrendingUp,{}),description:"Data analytics"},{path:"/reports",label:"Reports",icon:jsxRuntimeExports.jsx(Assessment,{}),description:"Generated reports"},{path:"/alerts",label:"Alerts",icon:jsxRuntimeExports.jsx(NotificationsIcon,{}),description:"System alerts"},{path:"/storage",label:"Storage",icon:jsxRuntimeExports.jsx(StorageIcon,{}),description:"Data storage"},{path:"/m",label:"Mobile",icon:jsxRuntimeExports.jsx(Dashboard,{}),description:"Mobile dashboard"},{path:"/m/dashboard",label:"Mobile Dashboard",icon:jsxRuntimeExports.jsx(Dashboard,{}),parent:"/m",description:"Mobile dashboard"},{path:"/m/alerts",label:"Mobile Alerts",icon:jsxRuntimeExports.jsx(NotificationsIcon,{}),parent:"/m",description:"Mobile alerts"},{path:"/m/analytics",label:"Mobile Analytics",icon:jsxRuntimeExports.jsx(BarChart,{}),parent:"/m",description:"Mobile analytics"},{path:"/m/settings",label:"Mobile Settings",icon:jsxRuntimeExports.jsx(SettingsIcon,{}),parent:"/m",description:"Mobile settings"}],getRouteConfig=path=&gt;ROUTE_CONFIG.find(route=&gt;route.path===path)||null,getRouteIcon=path=&gt;{const config=getRouteConfig(path);return config?config.icon:path.includes("/folder")?jsxRuntimeExports.jsx(FolderIcon,{}):path.includes("/report")?jsxRuntimeExports.jsx(Assessment,{}):path.includes("/analytics")?jsxRuntimeExports.jsx(AnalyticsIcon,{}):path.includes("/chart")?jsxRuntimeExports.jsx(BarChart,{}):jsxRuntimeExports.jsx(Dashboard,{})};function useSetBreadcrumbs(items){React.useEffect(()=&gt;{const event=new CustomEvent("set-breadcrumbs",{detail:items});window.dispatchEvent(event)},[items])}const MobileBreadcrumbs=({items:items})=&gt;{const theme=useTheme(),navigate=useNavigate(),location=useLocation(),breadcrumbItems=items||(pathname=&gt;{const paths=pathname.split("/").filter(Boolean),items=[];pathname.startsWith("/m")||items.push({label:"Dashboard",path:"/dashboard",icon:jsxRuntimeExports.jsx(Dashboard,{}),description:"Main dashboard"});let currentPath="";return paths.forEach((segment,index2)=&gt;{currentPath+=`/${segment}`;const isLast=index2===paths.length-1;if("dashboard"===segment&amp;&amp;0===index2&amp;&amp;!pathname.startsWith("/m"))return;const routeConfig=getRouteConfig(currentPath);let label=(null==routeConfig?void 0:routeConfig.label)||segment.split("-").map(word=&gt;word.charAt(0).toUpperCase()+word.slice(1)).join(" ");"m"===segment&amp;&amp;0===index2&amp;&amp;(label="Mobile"),items.push({label:label,path:isLast?void 0:currentPath,icon:(null==routeConfig?void 0:routeConfig.icon)||getRouteIcon(currentPath),current:isLast,description:null==routeConfig?void 0:routeConfig.description})}),items})(location.pathname),currentItem=breadcrumbItems[breadcrumbItems.length-1],previousItem=breadcrumbItems[breadcrumbItems.length-2];return previousItem?jsxRuntimeExports.jsxs(Box,{sx:{display:"flex",alignItems:"center",gap:1,px:2,py:1.5,background:`linear-gradient(135deg, \n          ${alpha(theme.palette.background.paper,.95)} 0%, \n          ${alpha(theme.palette.background.paper,.85)} 100%)`,backdropFilter:"blur(20px)",WebkitBackdropFilter:"blur(20px)",borderBottom:`1px solid ${alpha(theme.palette.divider,.2)}`,boxShadow:`0 2px 8px ${alpha(theme.palette.common.black,.06)}`},children:[jsxRuntimeExports.jsx(Tooltip,{title:previousItem.description||`Go back to ${previousItem.label}`,arrow:!0,children:jsxRuntimeExports.jsxs(Link,{color:"primary",component:"button",sx:{display:"flex",alignItems:"center",gap:.5,fontSize:"0.875rem",fontWeight:500,transition:"all 0.2s ease-in-out",borderRadius:1,px:1,py:.5,"&amp;:hover":{backgroundColor:alpha(theme.palette.primary.main,.08),transform:"translateX(-2px)"},"&amp;:active":{transform:"translateX(0)"}},underline:"none",onClick:()=&gt;navigate(previousItem.path||"/"),children:[jsxRuntimeExports.jsx(NavigateNextIcon,{fontSize:"small",sx:{transform:"rotate(180deg)",transition:"transform 0.2s ease-in-out"}}),previousItem.icon,previousItem.label]})}),jsxRuntimeExports.jsx(NavigateNextIcon,{fontSize:"small",sx:{color:alpha(theme.palette.text.secondary,.6),mx:.5}}),jsxRuntimeExports.jsxs(Box,{sx:{display:"flex",alignItems:"center",gap:.5},children:[currentItem.icon,jsxRuntimeExports.jsx(Typography$1,{sx:{fontWeight:600,color:theme.palette.primary.main,textShadow:`0 1px 2px ${alpha(theme.palette.common.black,.1)}`},variant:"body2",children:currentItem.label})]})]}):null},PullToRefresh=({children:children,onRefresh:onRefresh,disabled:disabled=!1,refreshMessage:refreshMessage="Refreshing...",pullMessage:pullMessage="Pull to refresh",releaseMessage:releaseMessage="Release to refresh"})=&gt;{const theme=useTheme(),supportsTouch=useSupportsTouch(),{containerRef:containerRef,isRefreshing:isRefreshing,pullDistance:pullDistance,isPulling:isPulling,releaseToRefresh:releaseToRefresh,pullProgress:pullProgress}=usePullToRefresh({onRefresh:onRefresh,disabled:disabled||!supportsTouch});if(!supportsTouch)return jsxRuntimeExports.jsx(Box,{ref:containerRef,children:children});const indicatorOpacity=Math.min(pullProgress,1),indicatorScale=.5+.5*pullProgress,arrowRotation=releaseToRefresh?180:0;return jsxRuntimeExports.jsxs(Box,{ref:containerRef,sx:{position:"relative",width:"100%",height:"100%",overflow:"auto",WebkitOverflowScrolling:"touch"},children:[jsxRuntimeExports.jsx(Box,{sx:{position:"absolute",top:0,left:0,right:0,height:80,display:"flex",alignItems:"center",justifyContent:"center",transform:`translateY(${pullDistance-80}px)`,transition:isPulling?"none":"transform 0.3s ease",backgroundColor:alpha(theme.palette.background.paper,.9),borderBottom:`1px solid ${alpha(theme.palette.divider,.1)}`,zIndex:1,opacity:indicatorOpacity,pointerEvents:"none"},children:jsxRuntimeExports.jsxs(Box,{sx:{display:"flex",flexDirection:"column",alignItems:"center",gap:1,transform:`scale(${indicatorScale})`,transition:"transform 0.2s ease"},children:[isRefreshing?jsxRuntimeExports.jsx(CircularProgress,{size:32,sx:{color:theme.palette.primary.main},thickness:3}):jsxRuntimeExports.jsx(ArrowDownIcon,{sx:{fontSize:32,color:releaseToRefresh?theme.palette.primary.main:theme.palette.text.secondary,transform:`rotate(${arrowRotation}deg)`,transition:"transform 0.3s ease, color 0.3s ease"}}),jsxRuntimeExports.jsx(Typography$1,{sx:{color:theme.palette.text.secondary,fontWeight:500,textAlign:"center"},variant:"caption",children:isRefreshing?refreshMessage:releaseToRefresh?releaseMessage:pullMessage})]})}),jsxRuntimeExports.jsx(Fade,{in:isPulling||isRefreshing,timeout:200,children:jsxRuntimeExports.jsx(Box,{sx:{position:"absolute",top:0,left:0,right:0,height:pullDistance,background:`linear-gradient(to bottom, \n              ${alpha(theme.palette.primary.main,.1)} 0%, \n              transparent 100%)`,pointerEvents:"none",zIndex:0}})}),jsxRuntimeExports.jsx(Box,{sx:{position:"relative",zIndex:2,backgroundColor:theme.palette.background.default,minHeight:"100%"},children:children})]})},DashboardPullToRefresh=({children:children,onRefresh:onRefresh})=&gt;jsxRuntimeExports.jsx(PullToRefresh,{pullMessage:"Pull to refresh dashboard",refreshMessage:"Refreshing dashboard...",releaseMessage:"Release to refresh",onRefresh:async()=&gt;{try{"vibrate"in navigator&amp;&amp;navigator.vibrate(10),await onRefresh(),"vibrate"in navigator&amp;&amp;navigator.vibrate([10,50,10])}catch(_error){"vibrate"in navigator&amp;&amp;navigator.vibrate([50,50,50])}},children:children}),TokenExpirationBanner=({showAlways:showAlways=!1,onNavigateToSettings:onNavigateToSettings})=&gt;{const navigate=useNavigate(),status=useTokenStatus(),tokenExpiresAt=useAppSelector(state=&gt;state.auth.tokenExpiresAt);if(status.isLoading||!status.isExpiring&amp;&amp;!showAlways)return null;const handleNavigateToSettings=()=&gt;{onNavigateToSettings?onNavigateToSettings():navigate("/settings")};if(!status.isValid&amp;&amp;status.token)return jsxRuntimeExports.jsx(Alert,{action:jsxRuntimeExports.jsx(Button,{color:"inherit",size:"small",onClick:handleNavigateToSettings,children:"Update Token"}),severity:"error",sx:{mb:2},children:"Your ACE IoT API token has expired. Data access is currently unavailable."});const expirationCheck=(()=&gt;{if(!tokenExpiresAt)return null;const now=Date.now(),daysUntilExpiry=Math.ceil((tokenExpiresAt-now)/864e5);return daysUntilExpiry&lt;=7&amp;&amp;daysUntilExpiry&gt;0?{isExpiring:!0,days:daysUntilExpiry}:null})();if(status.isExpiring&amp;&amp;null!==status.daysUntilExpiration||(null==expirationCheck?void 0:expirationCheck.isExpiring)){const days=status.daysUntilExpiration??(null==expirationCheck?void 0:expirationCheck.days)??0,daysText=1===days?"1 day":`${days} days`;return jsxRuntimeExports.jsxs(Alert,{action:jsxRuntimeExports.jsx(Button,{color:"inherit",size:"small",onClick:handleNavigateToSettings,children:"Update Token"}),severity:"warning",sx:{mb:2},children:["Your ACE IoT API token will expire in ",daysText,". Please update it soon to avoid service interruption."]})}return!status.token&amp;&amp;showAlways?jsxRuntimeExports.jsx(Alert,{action:jsxRuntimeExports.jsx(Button,{color:"inherit",size:"small",onClick:handleNavigateToSettings,children:"Configure Token"}),severity:"info",sx:{mb:2},children:"No ACE IoT API token configured. Please add your token to access data."}):showAlways&amp;&amp;status.isValid&amp;&amp;!status.isExpiring?jsxRuntimeExports.jsx(Alert,{severity:"success",sx:{mb:2},children:jsxRuntimeExports.jsxs(Box,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",width:"100%"},children:[jsxRuntimeExports.jsx(Typography$1,{variant:"body2",children:"Your ACE IoT API token is valid and configured correctly."}),status.expiresAt&amp;&amp;jsxRuntimeExports.jsxs(Typography$1,{sx:{ml:2},variant:"caption",children:["Expires: ",new Date(status.expiresAt).toLocaleDateString()]})]})}):null},ModernLayout=({children:children})=&gt;{const theme=useTheme(),isMobile=useMediaQuery(theme.breakpoints.down("md")),queryClient=useQueryClient(),[sidebarCollapsed,setSidebarCollapsed]=reactExports.useState(()=&gt;{const saved=localStorage.getItem("sidebarCollapsed");return!!saved&amp;&amp;JSON.parse(saved)}),[focusMode,setFocusMode]=reactExports.useState(!1);reactExports.useEffect(()=&gt;{localStorage.setItem("sidebarCollapsed",JSON.stringify(sidebarCollapsed))},[sidebarCollapsed]);const handleRefresh=async()=&gt;{await queryClient.invalidateQueries()};return isMobile?jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(PullToRefresh,{onRefresh:handleRefresh,children:jsxRuntimeExports.jsxs(Box,{component:"main",sx:{minHeight:"100vh",pb:2,backgroundColor:theme.palette.background.default},children:[jsxRuntimeExports.jsx(MobileBreadcrumbs,{}),jsxRuntimeExports.jsxs(Box,{sx:{p:2},children:[jsxRuntimeExports.jsx(TokenExpirationBanner,{}),children]})]})}),jsxRuntimeExports.jsx(StatusBar,{}),jsxRuntimeExports.jsx(InstallBanner,{})]}):(console.log("[ModernLayout] Rendering desktop layout with focusMode:",focusMode,"sidebarCollapsed:",sidebarCollapsed),jsxRuntimeExports.jsxs(Box,{sx:{display:"flex",minHeight:"100vh",position:"relative"},children:[jsxRuntimeExports.jsx(Box,{sx:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"dark"===theme.palette.mode?`\n              radial-gradient(at 0% 0%, ${alpha(theme.palette.primary.main,.02)} 0, transparent 50%),\n              radial-gradient(at 100% 100%, ${alpha(theme.palette.secondary.main,.01)} 0, transparent 50%)\n            `:`\n              radial-gradient(at 0% 0%, ${alpha(theme.palette.primary.main,.01)} 0, transparent 50%),\n              radial-gradient(at 100% 100%, ${alpha(theme.palette.secondary.main,.005)} 0, transparent 50%)\n            `,pointerEvents:"none",zIndex:0}}),focusMode?console.log("[ModernLayout] NOT rendering ModernSidebar because focusMode is true"):jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[console.log("[ModernLayout] Rendering ModernSidebar because focusMode is false"),jsxRuntimeExports.jsx(ModernSidebar,{collapsed:sidebarCollapsed,onToggleCollapse:()=&gt;setSidebarCollapsed(!sidebarCollapsed)})]}),jsxRuntimeExports.jsxs(Box,{component:"main",sx:{flexGrow:1,display:"flex",flexDirection:"column",marginLeft:focusMode?0:sidebarCollapsed?"64px":"240px",transition:"margin-left 0.3s cubic-bezier(0.4, 0, 0.2, 1)",minHeight:"100vh",position:"relative",zIndex:1},children:[jsxRuntimeExports.jsxs(Box,{sx:{flexGrow:1,p:3,paddingTop:3,minHeight:"100vh",position:"relative",display:"flex",flexDirection:"column"},children:[jsxRuntimeExports.jsx(TokenExpirationBanner,{}),jsxRuntimeExports.jsx(Box,{sx:{flex:1,position:"relative"},children:children})]}),jsxRuntimeExports.jsx(IconButton,{onClick:()=&gt;{setFocusMode(!focusMode)},sx:{position:"fixed",bottom:60,right:24,backgroundColor:alpha(theme.palette.background.paper,.9),backdropFilter:"blur(10px)",WebkitBackdropFilter:"blur(10px)",border:`1px solid ${alpha(theme.palette.primary.main,.1)}`,boxShadow:`0 4px 16px ${alpha("#000000",.2)}`,zIndex:1049,"&amp;:hover":{backgroundColor:alpha(theme.palette.background.paper,.95),transform:"scale(1.05)"},transition:"all 0.2s ease"},title:focusMode?"Exit Focus Mode":"Enter Focus Mode",children:focusMode?jsxRuntimeExports.jsx(FullscreenExitIcon,{}):jsxRuntimeExports.jsx(FullscreenIcon,{})})]}),jsxRuntimeExports.jsx(StatusBar,{sidebarCollapsed:sidebarCollapsed,focusMode:focusMode}),jsxRuntimeExports.jsx(InstallBanner,{})]}))},Layout=({children:children})=&gt;jsxRuntimeExports.jsx(ModernLayout,{children:children}),accessibleColors_light={primary:{main:"#0277BD",light:"#039BE5",dark:"#014A7F",contrastText:"#FFFFFF"},secondary:{main:"#C2185B",light:"#E91E63",dark:"#8C0032",contrastText:"#FFFFFF"},error:{main:"#D32F2F",light:"#EF5350",dark:"#C62828",contrastText:"#FFFFFF"},warning:{main:"#F57C00",light:"#FFB74D",dark:"#E65100",contrastText:"#FFFFFF"},info:{main:"#0288D1",light:"#03A9F4",dark:"#01579B",contrastText:"#FFFFFF"},success:{main:"#388E3C",light:"#66BB6A",dark:"#2E7D32",contrastText:"#FFFFFF"},background:{default:"#FFFFFF",paper:"#F5F5F5"},text:{primary:"#000000",secondary:"#424242",disabled:"#757575"}},accessibleDarkTheme=createTheme({palette:{mode:"dark",...{primary:{main:"#00E5FF",light:"#6EFFFF",dark:"#00ACC1",contrastText:"#000000"},secondary:{main:"#00BFA5",light:"#52C7B8",dark:"#00897B",contrastText:"#000000"},error:{main:"#FF5252",light:"#FF867F",dark:"#C50E29",contrastText:"#FFFFFF"},warning:{main:"#FFB74D",light:"#FFE97D",dark:"#C88719",contrastText:"#000000"},info:{main:"#29B6F6",light:"#73E8FF",dark:"#0086C3",contrastText:"#000000"},success:{main:"#66BB6A",light:"#98EE99",dark:"#338A3E",contrastText:"#000000"},background:{default:"#121212",paper:"#1E1E1E"},text:{primary:"#FFFFFF",secondary:"#B3B3B3",disabled:"#666666"}},divider:"rgba(255, 255, 255, 0.12)",action:{active:"#FFFFFF",hover:alpha("#FFFFFF",.08),selected:alpha("#FFFFFF",.16),disabled:alpha("#FFFFFF",.3),disabledBackground:alpha("#FFFFFF",.12)}},typography:{fontFamily:'"Inter", "Roboto", "Helvetica", "Arial", sans-serif',fontSize:16,h1:{fontSize:"2.5rem",fontWeight:600,lineHeight:1.2},h2:{fontSize:"2rem",fontWeight:600,lineHeight:1.3},h3:{fontSize:"1.75rem",fontWeight:600,lineHeight:1.3},h4:{fontSize:"1.5rem",fontWeight:500,lineHeight:1.4},h5:{fontSize:"1.25rem",fontWeight:500,lineHeight:1.4},h6:{fontSize:"1.125rem",fontWeight:500,lineHeight:1.4},body1:{fontSize:"1rem",lineHeight:1.6},body2:{fontSize:"0.875rem",lineHeight:1.6},button:{fontSize:"0.875rem",fontWeight:500,letterSpacing:"0.02857em",textTransform:"none"}},shape:{borderRadius:8},components:{MuiButton:{styleOverrides:{root:{minHeight:"44px",minWidth:"44px",padding:"12px 24px","&amp;:focus-visible":{outline:"3px solid #40C4FF",outlineOffset:"2px"}},text:{"&amp;:hover":{backgroundColor:alpha("#FFFFFF",.08)}}}},MuiIconButton:{styleOverrides:{root:{minHeight:"44px",minWidth:"44px","&amp;:focus-visible":{outline:"3px solid #40C4FF",outlineOffset:"2px"}}}},MuiTextField:{styleOverrides:{root:{"&amp; .MuiInputBase-root":{minHeight:"44px"},"&amp; .MuiOutlinedInput-root":{"&amp;:hover .MuiOutlinedInput-notchedOutline":{borderColor:"#B3B3B3",borderWidth:"2px"},"&amp;.Mui-focused .MuiOutlinedInput-notchedOutline":{borderColor:"#40C4FF",borderWidth:"2px"}}}}},MuiLink:{styleOverrides:{root:{color:"#40C4FF",textDecorationLine:"underline","&amp;:hover":{color:"#80D4FF"},"&amp;:focus-visible":{outline:"3px solid #40C4FF",outlineOffset:"2px"}}}},MuiTooltip:{styleOverrides:{tooltip:{fontSize:"0.875rem",backgroundColor:"#000000",color:"#FFFFFF",padding:"8px 12px"}}},MuiAlert:{styleOverrides:{root:{fontSize:"0.875rem"}}}}}),accessibleLightTheme=createTheme({palette:{mode:"light",...accessibleColors_light,divider:"rgba(0, 0, 0, 0.12)",action:{active:"#000000",hover:alpha("#000000",.04),selected:alpha("#000000",.08),disabled:alpha("#000000",.26),disabledBackground:alpha("#000000",.12)}},typography:accessibleDarkTheme.typography,shape:accessibleDarkTheme.shape,components:{...accessibleDarkTheme.components,MuiButton:{styleOverrides:{root:{minHeight:"44px",minWidth:"44px",padding:"12px 24px","&amp;:focus-visible":{outline:"3px solid #0277BD",outlineOffset:"2px"}},text:{"&amp;:hover":{backgroundColor:alpha("#000000",.04)}}}},MuiIconButton:{styleOverrides:{root:{minHeight:"44px",minWidth:"44px","&amp;:focus-visible":{outline:"3px solid #0277BD",outlineOffset:"2px"}}}},MuiTextField:{styleOverrides:{root:{"&amp; .MuiInputBase-root":{minHeight:"44px"},"&amp; .MuiOutlinedInput-root":{"&amp;:hover .MuiOutlinedInput-notchedOutline":{borderColor:"#424242",borderWidth:"2px"},"&amp;.Mui-focused .MuiOutlinedInput-notchedOutline":{borderColor:"#0277BD",borderWidth:"2px"}}}}},MuiLink:{styleOverrides:{root:{color:"#0277BD",textDecorationLine:"underline","&amp;:hover":{color:"#014A7F"},"&amp;:focus-visible":{outline:"3px solid #0277BD",outlineOffset:"2px"}}}},MuiTooltip:{styleOverrides:{tooltip:{fontSize:"0.875rem",backgroundColor:"#424242",color:"#FFFFFF",padding:"8px 12px"}}}}}),highContrastTheme=createTheme({palette:{mode:"dark",primary:{main:"#FFFF00",contrastText:"#000000"},secondary:{main:"#00FFFF",contrastText:"#000000"},error:{main:"#FF0000",contrastText:"#FFFFFF"},warning:{main:"#FFFF00",contrastText:"#000000"},info:{main:"#00FFFF",contrastText:"#000000"},success:{main:"#00FF00",contrastText:"#000000"},background:{default:"#000000",paper:"#000000"},text:{primary:"#FFFFFF",secondary:"#FFFFFF",disabled:"#808080"}},typography:{...accessibleDarkTheme.typography,allVariants:{color:"#FFFFFF"}},components:{...accessibleDarkTheme.components,MuiPaper:{styleOverrides:{root:{border:"2px solid #FFFFFF"}}},MuiButton:{styleOverrides:{root:{border:"2px solid currentColor","&amp;:hover":{backgroundColor:"#FFFFFF",color:"#000000"}}}}}}),NetworkStatus=()=&gt;{const[isOnline,setIsOnline]=reactExports.useState(navigator.onLine),[showAlert,setShowAlert]=reactExports.useState(!1);return reactExports.useEffect(()=&gt;{const handleOnline=()=&gt;{setIsOnline(!0),setShowAlert(!0),setTimeout(()=&gt;setShowAlert(!1),3e3)},handleOffline=()=&gt;{setIsOnline(!1),setShowAlert(!0),setTimeout(()=&gt;setShowAlert(!1),5e3)};return window.addEventListener("online",handleOnline),window.addEventListener("offline",handleOffline),navigator.onLine||handleOffline(),()=&gt;{window.removeEventListener("online",handleOnline),window.removeEventListener("offline",handleOffline)}},[]),showAlert?jsxRuntimeExports.jsx(Slide,{mountOnEnter:!0,unmountOnExit:!0,direction:"down",in:showAlert,children:jsxRuntimeExports.jsx(Alert,{action:jsxRuntimeExports.jsx(IconButton,{"aria-label":"close",color:"inherit",size:"small",onClick:()=&gt;setShowAlert(!1),children:jsxRuntimeExports.jsx(Close,{fontSize:"small"})}),icon:isOnline?jsxRuntimeExports.jsx(Wifi,{}):jsxRuntimeExports.jsx(WifiOff,{}),severity:isOnline?"success":"error",sx:{position:"fixed",top:0,left:0,right:0,zIndex:9999,borderRadius:0},children:isOnline?"Back online":"No internet connection"})}):null},PointPreloadIndicator=()=&gt;{const[progress,setProgress]=reactExports.useState(null),[visible,setVisible]=reactExports.useState(!1),[minimized,setMinimized]=reactExports.useState(!1);if(reactExports.useEffect(()=&gt;{let interval;const checkProgress=()=&gt;{if(pointPreloadService.isLoading()){const currentProgress=pointPreloadService.getProgress();setProgress(currentProgress),setVisible(!0),currentProgress.loadedSites&gt;0&amp;&amp;!minimized&amp;&amp;setTimeout(()=&gt;setMinimized(!0),5e3)}else{const finalProgress=pointPreloadService.getProgress();"complete"===finalProgress.status&amp;&amp;finalProgress.totalSites&gt;0&amp;&amp;(setProgress(finalProgress),setTimeout(()=&gt;setVisible(!1),1e4))}};return checkProgress(),interval=setInterval(checkProgress,1e3),()=&gt;clearInterval(interval)},[minimized]),!visible||!progress)return null;const progressPercent=progress.totalSites&gt;0?progress.loadedSites/progress.totalSites*100:0,getStatusIcon=()=&gt;{switch(progress.status){case"complete":return jsxRuntimeExports.jsx(CheckCircleIcon,{sx:{fontSize:16,color:"success.main"}});case"error":return jsxRuntimeExports.jsx(ErrorIcon,{sx:{fontSize:16,color:"error.main"}});case"loading":return jsxRuntimeExports.jsx(CloudDownloadIcon,{sx:{fontSize:16,color:"primary.main"}});default:return null}},getStatusMessage=()=&gt;{switch(progress.status){case"complete":return`Preloaded ${progress.totalPoints.toLocaleString()} points from ${progress.totalSites} sites`;case"error":return`Preloading failed: ${progress.errors[0]||"Unknown error"}`;case"loading":return minimized?`Loading points... ${progress.loadedSites}/${progress.totalSites}`:`Loading points from ${progress.currentSite||"sites"}...`;default:return"Preparing to load points..."}};return minimized?jsxRuntimeExports.jsx(Box,{sx:{position:"fixed",bottom:16,right:16,zIndex:1e3},children:jsxRuntimeExports.jsx(Tooltip,{title:getStatusMessage(),children:jsxRuntimeExports.jsx(Chip,{icon:getStatusIcon(),label:`${progress.loadedSites}/${progress.totalSites} sites`,onClick:()=&gt;setMinimized(!1),onDelete:()=&gt;setVisible(!1),deleteIcon:jsxRuntimeExports.jsx(Close,{}),color:"error"===progress.status?"error":"primary",variant:"filled",sx:{cursor:"pointer","&amp; .MuiChip-label":{fontSize:"0.75rem"}}})})}):jsxRuntimeExports.jsx(Collapse,{in:!minimized,children:jsxRuntimeExports.jsxs(Box,{sx:{position:"fixed",bottom:16,right:16,width:320,bgcolor:"background.paper",boxShadow:3,borderRadius:2,p:2,zIndex:1e3},children:[jsxRuntimeExports.jsxs(Box,{sx:{display:"flex",alignItems:"center",mb:1},children:[jsxRuntimeExports.jsxs(Box,{sx:{display:"flex",alignItems:"center",flex:1},children:[getStatusIcon(),jsxRuntimeExports.jsx(Typography$1,{variant:"subtitle2",sx:{ml:1},children:"Optimizing Point Selection"})]}),jsxRuntimeExports.jsx(IconButton,{size:"small",onClick:()=&gt;setMinimized(!0),sx:{ml:1},children:jsxRuntimeExports.jsx(Close,{fontSize:"small"})})]}),jsxRuntimeExports.jsx(Typography$1,{variant:"caption",color:"text.secondary",sx:{display:"block",mb:1},children:getStatusMessage()}),"loading"===progress.status&amp;&amp;jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(LinearProgress,{variant:"determinate",value:progressPercent,sx:{mb:1}}),jsxRuntimeExports.jsxs(Box,{sx:{display:"flex",justifyContent:"space-between"},children:[jsxRuntimeExports.jsxs(Typography$1,{variant:"caption",color:"text.secondary",children:[progress.loadedSites," of ",progress.totalSites," sites"]}),jsxRuntimeExports.jsxs(Typography$1,{variant:"caption",color:"text.secondary",children:[progress.totalPoints.toLocaleString()," points"]})]})]}),"complete"===progress.status&amp;&amp;jsxRuntimeExports.jsx(Typography$1,{variant:"caption",color:"success.main",children:" Points cached for instant searching"}),"error"===progress.status&amp;&amp;progress.errors.length&gt;0&amp;&amp;jsxRuntimeExports.jsx(Typography$1,{variant:"caption",color:"error.main",children:progress.errors[0]})]})})},ParticleBackground=()=&gt;{const canvasRef=reactExports.useRef(null),animationRef=reactExports.useRef(),particlesRef=reactExports.useRef([]);return reactExports.useEffect(()=&gt;{const canvas=canvasRef.current;if(!canvas)return;const ctx=canvas.getContext("2d");if(!ctx)return;const resizeCanvas=()=&gt;{canvas.width=window.innerWidth,canvas.height=window.innerHeight};resizeCanvas(),window.addEventListener("resize",resizeCanvas);const colors=["rgba(69, 113, 175, 0.6)","rgba(25, 67, 127, 0.7)","rgba(0, 191, 165, 0.5)"],particleCount=Math.floor(canvas.width*canvas.height/15e3);particlesRef.current=Array.from({length:particleCount},()=&gt;({x:Math.random()*canvas.width,y:Math.random()*canvas.height,size:3*Math.random()+1,speedY:-(.5*Math.random()+.2),speedX:.2*(Math.random()-.5),opacity:.5*Math.random()+.3,color:colors[Math.floor(Math.random()*colors.length)]}));const animate=()=&gt;{ctx.clearRect(0,0,canvas.width,canvas.height),particlesRef.current.forEach(particle=&gt;{particle.y+=particle.speedY,particle.x+=particle.speedX,particle.y&lt;-10&amp;&amp;(particle.y=canvas.height+10,particle.x=Math.random()*canvas.width),(particle.x&lt;-10||particle.x&gt;canvas.width+10)&amp;&amp;(particle.x=particle.x&lt;0?canvas.width+10:-10),ctx.beginPath();const gradient=ctx.createRadialGradient(particle.x,particle.y,0,particle.x,particle.y,3*particle.size);gradient.addColorStop(0,particle.color.replace(/[\d.]+\)$/,`${particle.opacity})`)),gradient.addColorStop(1,particle.color.replace(/[\d.]+\)$/,"0)")),ctx.fillStyle=gradient,ctx.arc(particle.x,particle.y,3*particle.size,0,2*Math.PI),ctx.fill(),ctx.beginPath(),ctx.fillStyle=particle.color.replace(/[\d.]+\)$/,1.5*particle.opacity+")"),ctx.arc(particle.x,particle.y,particle.size,0,2*Math.PI),ctx.fill()}),animationRef.current=requestAnimationFrame(animate)};return animate(),()=&gt;{window.removeEventListener("resize",resizeCanvas),animationRef.current&amp;&amp;cancelAnimationFrame(animationRef.current)}},[]),jsxRuntimeExports.jsx(Box,{sx:{position:"fixed",top:0,left:0,width:"100%",height:"100%",pointerEvents:"none",zIndex:1,opacity:.7},children:jsxRuntimeExports.jsx("canvas",{ref:canvasRef,style:{width:"100%",height:"100%"}})})},SlideTransition$1=React.forwardRef(function Transition(props,ref){return jsxRuntimeExports.jsx(Slide,{direction:"up",ref:ref,...props})}),NotificationContext=React.createContext(null),NotificationProvider=({children:children,maxNotifications:maxNotifications=5,defaultPosition:defaultPosition="top-right",defaultDuration:defaultDuration=5e3})=&gt;{const[notifications,setNotifications]=reactExports.useState([]),showNotification=reactExports.useCallback(config=&gt;{const id=config.id||`notification-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,notification={id:id,type:config.type,title:config.title||"",message:config.message,duration:config.duration??defaultDuration,position:config.position||defaultPosition,showProgress:config.showProgress??!0,timestamp:Date.now(),progress:0,actions:config.actions,metadata:config.metadata};return setNotifications(prev=&gt;{const filtered=prev.filter(n=&gt;n.id!==id);return[notification,...filtered].slice(0,maxNotifications)}),id},[defaultPosition,defaultDuration,maxNotifications]),hideNotification=reactExports.useCallback(id=&gt;{setNotifications(prev=&gt;prev.filter(n=&gt;n.id!==id))},[]),hideAllNotifications=reactExports.useCallback(()=&gt;{setNotifications([])},[]);reactExports.useEffect(()=&gt;{const intervals={};return notifications.forEach(notification=&gt;{if(notification.duration&amp;&amp;notification.duration&gt;0){const startTime=Date.now();intervals[notification.id]=setInterval(()=&gt;{const elapsed=Date.now()-startTime,progress=Math.min(elapsed/notification.duration*100,100);setNotifications(prev=&gt;prev.map(n=&gt;n.id===notification.id?{...n,progress:progress}:n)),progress&gt;=100&amp;&amp;hideNotification(notification.id)},50)}}),()=&gt;{Object.values(intervals).forEach(clearInterval)}},[notifications,hideNotification]);const contextValue={showNotification:showNotification,hideNotification:hideNotification,hideAllNotifications:hideAllNotifications,notifications:notifications};return jsxRuntimeExports.jsxs(NotificationContext.Provider,{value:contextValue,children:[children,jsxRuntimeExports.jsx(NotificationContainer,{})]})},NotificationContainer=()=&gt;{const{notifications:notifications,hideNotification:hideNotification}=(()=&gt;{const context=React.useContext(NotificationContext);if(!context)throw new Error("useNotification must be used within a NotificationProvider");return context})(),notificationGroups=notifications.reduce((groups,notification)=&gt;{const position=notification.position;return groups[position]||(groups[position]=[]),groups[position].push(notification),groups},{}),getPositionStyles=position=&gt;({"top-left":{top:24,left:24},"top-center":{top:24,left:"50%",transform:"translateX(-50%)"},"top-right":{top:24,right:24},"bottom-left":{bottom:24,left:24},"bottom-center":{bottom:24,left:"50%",transform:"translateX(-50%)"},"bottom-right":{bottom:24,right:24}}[position]),getNotificationIcon=type=&gt;({success:jsxRuntimeExports.jsx(CheckCircleIcon,{}),error:jsxRuntimeExports.jsx(ErrorIcon,{}),warning:jsxRuntimeExports.jsx(WarningIcon,{}),info:jsxRuntimeExports.jsx(Info,{})}[type]);return jsxRuntimeExports.jsx(Portal,{children:Object.entries(notificationGroups).map(([position,groupNotifications])=&gt;jsxRuntimeExports.jsx(Box,{sx:{position:"fixed",zIndex:2e3,pointerEvents:"none",...getPositionStyles(position)},children:jsxRuntimeExports.jsx(Stack,{spacing:2,sx:{width:400,maxWidth:"90vw"},children:groupNotifications.map(notification=&gt;{var _a;const colors={success:{primary:"#4CAF50",secondary:"#81C784",bg:"rgba(76, 175, 80, 0.1)"},error:{primary:"#FF5252",secondary:"#FF8A80",bg:"rgba(255, 82, 82, 0.1)"},warning:{primary:"#FF9800",secondary:"#FFB74D",bg:"rgba(255, 152, 0, 0.1)"},info:{primary:"#00E5FF",secondary:"#40C4FF",bg:"rgba(0, 229, 255, 0.1)"}}[notification.type];return jsxRuntimeExports.jsx(Snackbar,{open:!0,TransitionComponent:SlideTransition$1,sx:{position:"relative","&amp; .MuiSnackbar-root":{position:"static",transform:"none"}},children:jsxRuntimeExports.jsxs(Alert,{severity:notification.type,icon:getNotificationIcon(notification.type),sx:{width:"100%",pointerEvents:"auto",...glassEffect.strong,backgroundColor:colors.bg,border:`1px solid ${colors.primary}40`,backdropFilter:"blur(20px)","&amp; .MuiAlert-icon":{color:colors.primary,filter:`drop-shadow(0 0 8px ${colors.primary}60)`},"&amp; .MuiAlert-message":{flex:1},position:"relative",overflow:"hidden"},action:jsxRuntimeExports.jsxs(Box,{sx:{display:"flex",alignItems:"center",gap:1},children:[null==(_a=notification.actions)?void 0:_a.map((action,index2)=&gt;jsxRuntimeExports.jsx(Chip,{label:action.label,size:"small",onClick:action.action,sx:{backgroundColor:`${colors.primary}20`,color:colors.primary,"&amp;:hover":{backgroundColor:`${colors.primary}30`}}},index2)),jsxRuntimeExports.jsx(IconButton,{size:"small",onClick:()=&gt;hideNotification(notification.id),sx:{color:"rgba(255, 255, 255, 0.7)","&amp;:hover":{color:"rgba(255, 255, 255, 0.9)",backgroundColor:"rgba(255, 255, 255, 0.1)"}},children:jsxRuntimeExports.jsx(Close,{fontSize:"small"})})]}),children:[notification.title&amp;&amp;jsxRuntimeExports.jsx(AlertTitle,{sx:{color:colors.primary,fontWeight:600},children:notification.title}),jsxRuntimeExports.jsx(Typography$1,{variant:"body2",sx:{color:"rgba(255, 255, 255, 0.9)"},children:notification.message}),notification.showProgress&amp;&amp;notification.duration&amp;&amp;void 0!==notification.progress&amp;&amp;jsxRuntimeExports.jsx(LinearProgress,{variant:"determinate",value:notification.progress,sx:{position:"absolute",bottom:0,left:0,right:0,height:2,backgroundColor:"transparent","&amp; .MuiLinearProgress-bar":{backgroundColor:colors.secondary,boxShadow:`0 0 8px ${colors.secondary}60`}}})]})},notification.id)})})},position))})},AnnouncerContainer=styled(Box)({position:"absolute",left:"-10000px",width:"1px",height:"1px",overflow:"hidden",clip:"rect(0 0 0 0)",clipPath:"inset(50%)",whiteSpace:"nowrap"}),_AnnouncementManager=class _AnnouncementManager{constructor(){__publicField(this,"announcements",[]),__publicField(this,"listeners",[]),__publicField(this,"isProcessing",!1)}static getInstance(){return _AnnouncementManager.instance||(_AnnouncementManager.instance=new _AnnouncementManager),_AnnouncementManager.instance}addListener(listener){return this.listeners.push(listener),()=&gt;{this.listeners=this.listeners.filter(l=&gt;l!==listener)}}announce(message,options={}){if(!message.trim())return;const announcement={message:message,options:{priority:"polite",atomic:!0,delay:100,clearAfter:2e3,...options},timestamp:Date.now()};this.announcements.push(announcement),this.processQueue()}async processQueue(){if(!this.isProcessing&amp;&amp;0!==this.announcements.length){for(this.isProcessing=!0;this.announcements.length&gt;0;){const announcement=this.announcements.shift();this.listeners.forEach(listener=&gt;listener(announcement)),await new Promise(resolve=&gt;setTimeout(resolve,announcement.options.delay||100))}this.isProcessing=!1}}clear(){this.announcements=[]}getQueueStatus(){return{pending:this.announcements.length,isProcessing:this.isProcessing}}};__publicField(_AnnouncementManager,"instance");let AnnouncementManager=_AnnouncementManager;const ScreenReaderAnnouncer=({id:id="global-announcer",defaultOptions:defaultOptions={},multipleRegions:multipleRegions=!0,className:className})=&gt;{const politeRegionRef=reactExports.useRef(null),assertiveRegionRef=reactExports.useRef(null),statusRegionRef=reactExports.useRef(null),[currentMessage,setCurrentMessage]=reactExports.useState(""),[currentPriority,setCurrentPriority]=reactExports.useState("polite"),manager=AnnouncementManager.getInstance(),handleAnnouncement=reactExports.useCallback(announcement=&gt;{const{message:message,options:options}=announcement,priority=options.priority||"polite";setCurrentMessage(message),setCurrentPriority(priority);const region="assertive"===priority?assertiveRegionRef.current:politeRegionRef.current;region&amp;&amp;(region.textContent="",setTimeout(()=&gt;{region&amp;&amp;(region.textContent=message)},options.delay||100),options.clearAfter&amp;&amp;setTimeout(()=&gt;{region&amp;&amp;region.textContent===message&amp;&amp;(region.textContent="",setCurrentMessage(""))},options.clearAfter))},[]);return reactExports.useEffect(()=&gt;manager.addListener(handleAnnouncement),[handleAnnouncement,manager]),jsxRuntimeExports.jsxs(AnnouncerContainer,{className:className,role:"log","aria-label":"Screen reader announcements",children:[jsxRuntimeExports.jsx("div",{ref:politeRegionRef,role:"status","aria-live":"polite","aria-atomic":"true","aria-relevant":"text",id:`${id}-polite`}),jsxRuntimeExports.jsx("div",{ref:assertiveRegionRef,role:"alert","aria-live":"assertive","aria-atomic":"true","aria-relevant":"text",id:`${id}-assertive`}),multipleRegions&amp;&amp;jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("div",{ref:statusRegionRef,role:"status","aria-live":"polite","aria-atomic":"false","aria-relevant":"additions text",id:`${id}-status`}),jsxRuntimeExports.jsx("div",{role:"log","aria-live":"polite","aria-atomic":"false","aria-relevant":"additions",id:`${id}-log`})]})]})},useScreenReaderAnnouncer=()=&gt;{const manager=AnnouncementManager.getInstance(),announce=reactExports.useCallback((message,options={})=&gt;{manager.announce(message,options)},[manager]),announcePolite=reactExports.useCallback((message,delay)=&gt;{announce(message,{priority:"polite",delay:delay})},[announce]),announceAssertive=reactExports.useCallback((message,delay)=&gt;{announce(message,{priority:"assertive",delay:delay})},[announce]),announceStatus=reactExports.useCallback(message=&gt;{announce(message,{priority:"polite",atomic:!1})},[announce]),announceError=reactExports.useCallback(message=&gt;{announce(`Error: ${message}`,{priority:"assertive",clearAfter:5e3})},[announce]),announceSuccess=reactExports.useCallback(message=&gt;{announce(`Success: ${message}`,{priority:"polite",clearAfter:3e3})},[announce]),announceLoading=reactExports.useCallback((message="Loading, please wait")=&gt;{announce(message,{priority:"polite",atomic:!1})},[announce]),announceLoadingComplete=reactExports.useCallback((message="Loading complete")=&gt;{announce(message,{priority:"polite"})},[announce]),clear=reactExports.useCallback(()=&gt;{manager.clear()},[manager]),getQueueStatus=reactExports.useCallback(()=&gt;manager.getQueueStatus(),[manager]);return{announce:announce,announcePolite:announcePolite,announceAssertive:announceAssertive,announceStatus:announceStatus,announceError:announceError,announceSuccess:announceSuccess,announceLoading:announceLoading,announceLoadingComplete:announceLoadingComplete,clear:clear,getQueueStatus:getQueueStatus}},ScreenReaderContext=React.createContext(null),ScreenReaderProvider=({children:children})=&gt;{const announcer=useScreenReaderAnnouncer();return jsxRuntimeExports.jsxs(ScreenReaderContext.Provider,{value:announcer,children:[jsxRuntimeExports.jsx(ScreenReaderAnnouncer,{}),children]})},SkipLinksContainer=styled(Box)(({theme:theme})=&gt;({position:"absolute",top:0,left:0,zIndex:theme.zIndex.tooltip+100,"&amp; .skip-link":{position:"absolute",top:"-40px",left:"6px",background:theme.palette.primary.main,color:theme.palette.primary.contrastText,padding:"8px 16px",textDecoration:"none",borderRadius:"0 0 4px 4px",fontSize:"14px",fontWeight:600,boxShadow:theme.shadows[8],border:`2px solid ${theme.palette.primary.dark}`,opacity:0,transform:"translateY(-10px)",transition:"all 0.2s ease-in-out","&amp;:focus":{top:"6px",opacity:1,transform:"translateY(0)",outline:`3px solid ${theme.palette.warning.main}`,outlineOffset:"2px"},"&amp;:hover:focus":{backgroundColor:theme.palette.primary.dark},"@media (prefers-contrast: high)":{border:"3px solid white",backgroundColor:"black",color:"white","&amp;:focus":{outline:"3px solid yellow"}},"@media (prefers-reduced-motion: reduce)":{transition:"none",transform:"none","&amp;:focus":{transform:"none"}}}})),defaultLinks=[{id:"skip-to-main",label:"Skip to main content",target:"#main-content",description:"Jump directly to the main dashboard content"},{id:"skip-to-navigation",label:"Skip to navigation",target:"#navigation",description:"Jump to the main navigation menu"},{id:"skip-to-dashboard-controls",label:"Skip to dashboard controls",target:"#dashboard-controls",description:"Jump to dashboard control buttons and filters"},{id:"skip-to-charts",label:"Skip to charts",target:"#charts-container",description:"Jump directly to the data visualization charts"},{id:"skip-to-search",label:"Skip to search",target:"#search-input",description:"Jump to the search input field"},{id:"skip-to-footer",label:"Skip to footer",target:"#footer",description:"Jump to the page footer"}],SkipLinks=({links:links=defaultLinks,className:className})=&gt;jsxRuntimeExports.jsx(SkipLinksContainer,{className:className,role:"navigation","aria-label":"Skip links",children:links.map(link=&gt;jsxRuntimeExports.jsxs(Link,{href:link.target,className:"skip-link",onClick:event=&gt;((event,target)=&gt;{event.preventDefault();const targetElement=document.querySelector(target);if(targetElement){targetElement.hasAttribute("tabindex")||targetElement.setAttribute("tabindex","-1"),targetElement.focus(),targetElement.scrollIntoView({behavior:"smooth",block:"start",inline:"start"});const announcement=`Skipped to ${targetElement.getAttribute("aria-label")||target}`,announcer=document.createElement("div");announcer.setAttribute("role","status"),announcer.setAttribute("aria-live","polite"),announcer.style.position="absolute",announcer.style.left="-10000px",announcer.style.width="1px",announcer.style.height="1px",announcer.style.overflow="hidden",document.body.appendChild(announcer),setTimeout(()=&gt;{announcer.textContent=announcement},100),setTimeout(()=&gt;{document.body.removeChild(announcer)},2e3)}})(event,link.target),"aria-describedby":link.description?`${link.id}-description`:void 0,children:[link.label,link.description&amp;&amp;jsxRuntimeExports.jsx("span",{id:`${link.id}-description`,style:{position:"absolute",left:"-10000px",width:"1px",height:"1px",overflow:"hidden"},children:link.description})]},link.id))}),DashboardSkipLinks=()=&gt;jsxRuntimeExports.jsx(SkipLinks,{links:[{id:"skip-to-main",label:"Skip to dashboard",target:"#dashboard-main",description:"Jump directly to the main dashboard content"},{id:"skip-to-controls",label:"Skip to controls",target:"#dashboard-controls",description:"Jump to time range and filter controls"},{id:"skip-to-charts",label:"Skip to charts",target:"#charts-grid",description:"Jump to the data visualization charts"},{id:"skip-to-sidebar",label:"Skip to navigation",target:"#sidebar-navigation",description:"Jump to the navigation sidebar"}]}),defaultShortcuts=[{key:"?",description:"Show this help dialog",category:"Global"},{key:"/",description:"Focus search input",category:"Global"},{key:"Escape",description:"Close modal or dialog",category:"Global"},{key:"Tab",description:"Navigate to next interactive element",category:"Navigation"},{key:"Tab",modifiers:["Shift"],description:"Navigate to previous interactive element",category:"Navigation"},{key:"Arrow Keys",description:"Navigate through lists and menus",category:"Navigation"},{key:"Enter",description:"Activate button or link",category:"Navigation"},{key:"Space",description:"Activate button or checkbox",category:"Navigation"},{key:"r",modifiers:["Ctrl"],description:"Refresh dashboard data",category:"Dashboard",context:"Dashboard page"},{key:"n",modifiers:["Ctrl"],description:"Add new widget",category:"Dashboard",context:"Dashboard page"},{key:"s",modifiers:["Ctrl"],description:"Save dashboard",category:"Dashboard",context:"Dashboard page"},{key:"c",modifiers:["Ctrl"],description:"Enter chart navigation mode",category:"Charts",context:"When chart is focused"},{key:"+",description:"Zoom in chart",category:"Charts",context:"Chart navigation mode"},{key:"-",description:"Zoom out chart",category:"Charts",context:"Chart navigation mode"},{key:"0",description:"Reset chart zoom",category:"Charts",context:"Chart navigation mode"},{key:"Arrow Keys",description:"Navigate through data points",category:"Charts",context:"Chart navigation mode"},{key:"t",description:"Toggle data table",category:"Charts",context:"Chart navigation mode"},{key:"d",description:"Read all chart data",category:"Charts",context:"Chart navigation mode"},{key:"i",description:"Get chart information",category:"Charts",context:"Chart navigation mode"},{key:"Alt",modifiers:["Shift"],description:"Toggle high contrast mode",category:"Accessibility"},{key:"r",modifiers:["Alt"],description:"Toggle reduced motion",category:"Accessibility"},{key:"f",modifiers:["Alt"],description:"Increase font size",category:"Accessibility"}],formatKeyCombo=shortcut=&gt;{const{key:key,modifiers:modifiers=[]}=shortcut,modifierSymbols={Ctrl:"",Alt:"",Shift:"",Meta:""};return[...modifiers.map(mod=&gt;modifierSymbols[mod]||mod),key].join(" + ")},KeyboardShortcutsDialog$1=({open:open,onClose:onClose,shortcuts:shortcuts=defaultShortcuts,title:title="Keyboard Shortcuts"})=&gt;{const theme=useTheme(),isMobile=useMediaQuery(theme.breakpoints.down("sm")),{announce:announce}=React.useContext(ScreenReaderContext)||useScreenReaderAnnouncer(),{containerRef:containerRef}=useDialogFocusTrap(open,onClose),groupedShortcuts=React.useMemo(()=&gt;shortcuts.reduce((acc,shortcut)=&gt;(acc[shortcut.category]||(acc[shortcut.category]=[]),acc[shortcut.category].push(shortcut),acc),{}),[shortcuts]),categories=Object.keys(groupedShortcuts);return React.useEffect(()=&gt;{open&amp;&amp;announce(`${title} dialog opened. ${shortcuts.length} shortcuts available.`)},[open,announce,title,shortcuts.length]),jsxRuntimeExports.jsxs(Dialog,{ref:containerRef,open:open,onClose:onClose,maxWidth:"md",fullWidth:!0,fullScreen:isMobile,"aria-labelledby":"keyboard-shortcuts-title","aria-describedby":"keyboard-shortcuts-description",PaperProps:{sx:{maxHeight:"90vh",...isMobile&amp;&amp;{margin:0,maxHeight:"100vh",borderRadius:0}}},children:[jsxRuntimeExports.jsxs(DialogTitle,{id:"keyboard-shortcuts-title",sx:{display:"flex",alignItems:"center",justifyContent:"space-between",pb:1},children:[jsxRuntimeExports.jsxs(Box,{sx:{display:"flex",alignItems:"center",gap:1},children:[jsxRuntimeExports.jsx(Keyboard,{color:"primary"}),jsxRuntimeExports.jsx(Typography$1,{variant:"h6",component:"h2",children:title})]}),jsxRuntimeExports.jsx(IconButton,{onClick:onClose,"aria-label":"Close keyboard shortcuts dialog",sx:{ml:1},children:jsxRuntimeExports.jsx(Close,{})})]}),jsxRuntimeExports.jsxs(DialogContent,{sx:{px:3,py:1},children:[jsxRuntimeExports.jsx(Typography$1,{id:"keyboard-shortcuts-description",variant:"body2",color:"text.secondary",sx:{mb:3},children:"Use these keyboard shortcuts to navigate and interact with the application more efficiently. Screen reader users can benefit from the chart navigation shortcuts to explore data."}),categories.map((category,categoryIndex)=&gt;jsxRuntimeExports.jsxs(Box,{sx:{mb:3},children:[jsxRuntimeExports.jsxs(Box,{sx:{display:"flex",alignItems:"center",gap:1,mb:2},children:["Accessibility"===category&amp;&amp;jsxRuntimeExports.jsx(AccessibilityIcon,{color:"primary"}),jsxRuntimeExports.jsx(Typography$1,{variant:"h6",component:"h3",color:"primary",sx:{fontWeight:600},children:category})]}),jsxRuntimeExports.jsx(List,{dense:!0,sx:{py:0},children:groupedShortcuts[category].map((shortcut,index2)=&gt;jsxRuntimeExports.jsx(ListItem,{sx:{px:0,py:1,alignItems:"flex-start"},children:jsxRuntimeExports.jsx(ListItemText,{primary:jsxRuntimeExports.jsxs(Box,{sx:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",gap:2,flexWrap:"wrap"},children:[jsxRuntimeExports.jsxs(Box,{sx:{flex:1,minWidth:0},children:[jsxRuntimeExports.jsx(Typography$1,{variant:"body2",sx:{mb:.5},children:shortcut.description}),shortcut.context&amp;&amp;jsxRuntimeExports.jsx(Typography$1,{variant:"caption",color:"text.secondary",sx:{fontStyle:"italic"},children:shortcut.context})]}),jsxRuntimeExports.jsx(Chip,{label:formatKeyCombo(shortcut),size:"small",variant:"outlined",sx:{fontFamily:"Monaco, Consolas, monospace",fontSize:"0.75rem",borderColor:"primary.main",color:"primary.main",backgroundColor:"primary.50",flexShrink:0}})]})})},`${category}-${index2}`))}),categoryIndex&lt;categories.length-1&amp;&amp;jsxRuntimeExports.jsx(Divider,{sx:{my:2}})]},category)),jsxRuntimeExports.jsxs(Box,{sx:{mt:4,p:2,backgroundColor:"info.50",borderRadius:1,border:1,borderColor:"info.200"},children:[jsxRuntimeExports.jsx(Typography$1,{variant:"body2",sx:{fontWeight:600,mb:1},children:"Accessibility Tips:"}),jsxRuntimeExports.jsx(Typography$1,{variant:"body2",component:"div",children:jsxRuntimeExports.jsxs("ul",{style:{margin:0,paddingLeft:"20px"},children:[jsxRuntimeExports.jsx("li",{children:"Use Tab and Shift+Tab to navigate between interactive elements"}),jsxRuntimeExports.jsx("li",{children:"Press Enter or Space to activate buttons and links"}),jsxRuntimeExports.jsx("li",{children:"Use arrow keys to navigate within menus and lists"}),jsxRuntimeExports.jsx("li",{children:"Charts can be navigated with keyboard - press Ctrl+C when focused on a chart"}),jsxRuntimeExports.jsx("li",{children:"Screen readers will announce chart data and interactions"}),jsxRuntimeExports.jsx("li",{children:"Press Alt+Shift to toggle high contrast mode for better visibility"})]})})]})]}),jsxRuntimeExports.jsx(DialogActions,{sx:{px:3,py:2},children:jsxRuntimeExports.jsx(Button,{onClick:onClose,variant:"contained",autoFocus:!0,sx:{minWidth:"100px"},children:"Got it"})})]})},defaultSettings={theme:"light",reducedMotion:!1,focusIndicators:"prominent",fontSize:"medium",verboseDescriptions:!1,keyboardShortcuts:!0,chartDataTables:!0,chartSonification:!1},AccessibilityContext=reactExports.createContext(null),AccessibilityProvider=({children:children,initialSettings:initialSettings={},showSkipLinks:showSkipLinks=!0,skipLinksVariant:skipLinksVariant="global",customSkipLinks:CustomSkipLinks})=&gt;{const[settings,setSettings]=reactExports.useState(()=&gt;{const savedSettings=localStorage.getItem("accessibility-settings"),parsed=savedSettings?JSON.parse(savedSettings):{},systemPreferences=detectSystemPreferences();return{...defaultSettings,...systemPreferences,...parsed,...initialSettings}}),[isInitialized,setIsInitialized]=reactExports.useState(!1);function detectSystemPreferences(){if("undefined"==typeof window)return{};const preferences={};window.matchMedia("(prefers-reduced-motion: reduce)").matches&amp;&amp;(preferences.reducedMotion=!0);const prefersHighContrast=window.matchMedia("(prefers-contrast: high)").matches;prefersHighContrast&amp;&amp;(preferences.theme="highContrast",preferences.focusIndicators="high-contrast");return window.matchMedia("(prefers-color-scheme: dark)").matches&amp;&amp;!prefersHighContrast&amp;&amp;(preferences.theme="dark"),preferences}const updateSetting=(key,value)=&gt;{setSettings(prev=&gt;{const newSettings={...prev,[key]:value};return localStorage.setItem("accessibility-settings",JSON.stringify(newSettings)),newSettings})};reactExports.useEffect(()=&gt;{const mediaQueries=[window.matchMedia("(prefers-reduced-motion: reduce)"),window.matchMedia("(prefers-contrast: high)"),window.matchMedia("(prefers-color-scheme: dark)")],handleMediaQueryChange=()=&gt;{if(isInitialized){const systemPreferences=detectSystemPreferences();setSettings(prev=&gt;({...prev,...systemPreferences}))}};return mediaQueries.forEach(mq=&gt;{mq.addEventListener?mq.addEventListener("change",handleMediaQueryChange):mq.addListener(handleMediaQueryChange)}),setIsInitialized(!0),()=&gt;{mediaQueries.forEach(mq=&gt;{mq.removeEventListener?mq.removeEventListener("change",handleMediaQueryChange):mq.removeListener(handleMediaQueryChange)})}},[isInitialized]),reactExports.useEffect(()=&gt;{const root=document.documentElement;root.style.fontSize={small:"14px",medium:"16px",large:"18px","x-large":"20px"}[settings.fontSize],settings.reducedMotion?(root.style.setProperty("--animation-duration","0.01ms"),root.style.setProperty("--transition-duration","0.01ms")):(root.style.removeProperty("--animation-duration"),root.style.removeProperty("--transition-duration")),"highContrast"===settings.theme?root.classList.add("high-contrast-mode"):root.classList.remove("high-contrast-mode"),root.setAttribute("data-focus-style",settings.focusIndicators)},[settings]);const keyboardShortcuts=(()=&gt;{const[isOpen,setIsOpen]=React.useState(!1),openDialog=React.useCallback(()=&gt;{setIsOpen(!0)},[]),closeDialog=React.useCallback(()=&gt;{setIsOpen(!1)},[]);return React.useEffect(()=&gt;{const handleKeyDown=event=&gt;{if("?"===event.key&amp;&amp;!event.ctrlKey&amp;&amp;!event.altKey&amp;&amp;!event.metaKey){const target=event.target;"INPUT"===target.tagName||"TEXTAREA"===target.tagName||target.isContentEditable||(event.preventDefault(),openDialog())}};return document.addEventListener("keydown",handleKeyDown),()=&gt;document.removeEventListener("keydown",handleKeyDown)},[openDialog]),{isOpen:isOpen,openDialog:openDialog,closeDialog:closeDialog}})();reactExports.useEffect(()=&gt;{if(!settings.keyboardShortcuts)return;const handleGlobalKeyDown=event=&gt;{if(event.altKey&amp;&amp;event.shiftKey&amp;&amp;!event.ctrlKey&amp;&amp;!event.metaKey){event.preventDefault();const newTheme="highContrast"===settings.theme?"light":"highContrast";updateSetting("theme",newTheme);const message="highContrast"===newTheme?"High contrast mode enabled":"High contrast mode disabled",announcer=document.createElement("div");announcer.setAttribute("aria-live","assertive"),announcer.setAttribute("aria-atomic","true"),announcer.style.position="absolute",announcer.style.left="-10000px",document.body.appendChild(announcer),setTimeout(()=&gt;{announcer.textContent=message},100),setTimeout(()=&gt;{document.body.removeChild(announcer)},2e3)}if(!event.altKey||"r"!==event.key||event.ctrlKey||event.metaKey||(event.preventDefault(),updateSetting("reducedMotion",!settings.reducedMotion)),event.altKey&amp;&amp;("+"===event.key||"="===event.key)&amp;&amp;!event.ctrlKey&amp;&amp;!event.metaKey){event.preventDefault();const sizes=["small","medium","large","x-large"],currentIndex=sizes.indexOf(settings.fontSize);currentIndex&lt;sizes.length-1&amp;&amp;updateSetting("fontSize",sizes[currentIndex+1])}if(event.altKey&amp;&amp;"-"===event.key&amp;&amp;!event.ctrlKey&amp;&amp;!event.metaKey){event.preventDefault();const sizes=["small","medium","large","x-large"],currentIndex=sizes.indexOf(settings.fontSize);currentIndex&gt;0&amp;&amp;updateSetting("fontSize",sizes[currentIndex-1])}};return document.addEventListener("keydown",handleGlobalKeyDown),()=&gt;document.removeEventListener("keydown",handleGlobalKeyDown)},[settings,updateSetting]);const currentTheme=React.useMemo(()=&gt;{switch(settings.theme){case"dark":return accessibleDarkTheme;case"highContrast":return highContrastTheme;default:return accessibleLightTheme}},[settings.theme]),contextValue={settings:settings,updateSetting:updateSetting,resetSettings:()=&gt;{const systemPreferences=detectSystemPreferences(),newSettings={...defaultSettings,...systemPreferences};setSettings(newSettings),localStorage.setItem("accessibility-settings",JSON.stringify(newSettings))},isHighContrastMode:"highContrast"===settings.theme,isReducedMotionMode:settings.reducedMotion,currentTheme:currentTheme};return jsxRuntimeExports.jsx(AccessibilityContext.Provider,{value:contextValue,children:jsxRuntimeExports.jsxs(ThemeProvider,{theme:currentTheme,children:[jsxRuntimeExports.jsx(CssBaseline,{}),jsxRuntimeExports.jsxs(ScreenReaderProvider,{children:[showSkipLinks?CustomSkipLinks?jsxRuntimeExports.jsx(CustomSkipLinks,{}):"dashboard"===skipLinksVariant?jsxRuntimeExports.jsx(DashboardSkipLinks,{}):jsxRuntimeExports.jsx(SkipLinks,{}):null,children,settings.keyboardShortcuts&amp;&amp;jsxRuntimeExports.jsx(KeyboardShortcutsDialog$1,{open:keyboardShortcuts.isOpen,onClose:keyboardShortcuts.closeDialog})]})]})})};var events=["mousedown","mouseup","mousemove","mouseover","mouseout","click","dblclick","contextmenu"];function makeHandlerName(eventName){return"_on"+eventName}var p02,p12,p22,uv0,uv1,uv2,uv,vCross,EChartsSurface=function(chart){var self2=this;this._texture=new Texture2D({anisotropic:32,flipY:!1,surface:this,dispose:function(renderer){self2.dispose(),Texture2D.prototype.dispose.call(this,renderer)}}),events.forEach(function(eventName){this[makeHandlerName(eventName)]=function(eveObj){eveObj.triangle&amp;&amp;this._meshes.forEach(function(mesh){this.dispatchEvent(eventName,mesh,eveObj.triangle,eveObj.point)},this)}},this),this._meshes=[],chart&amp;&amp;this.setECharts(chart),this.onupdate=null};EChartsSurface.prototype={constructor:EChartsSurface,getTexture:function(){return this._texture},setECharts:function(chart){this._chart=chart;var canvas=chart.getDom();if(canvas instanceof HTMLCanvasElement){var self2=this,zr=chart.getZr(),oldRefreshImmediately=zr.__oldRefreshImmediately||zr.refreshImmediately;zr.refreshImmediately=function(){oldRefreshImmediately.call(this),self2._texture.dirty(),self2.onupdate&amp;&amp;self2.onupdate()},zr.__oldRefreshImmediately=oldRefreshImmediately}else console.error("ECharts must init on canvas if it is used as texture."),canvas=document.createElement("canvas");this._texture.image=canvas,this._texture.dirty(),this.onupdate&amp;&amp;this.onupdate()},dispatchEvent:(p02=new Vector3,p12=new Vector3,p22=new Vector3,uv0=new Vector2,uv1=new Vector2,uv2=new Vector2,uv=new Vector2,vCross=new Vector3,function(eventName,attachedMesh,triangle,point){var geo=attachedMesh.geometry,position=geo.attributes.position,texcoord=geo.attributes.texcoord0,dot=Vector3.dot,cross2=Vector3.cross;position.get(triangle[0],p02.array),position.get(triangle[1],p12.array),position.get(triangle[2],p22.array),texcoord.get(triangle[0],uv0.array),texcoord.get(triangle[1],uv1.array),texcoord.get(triangle[2],uv2.array),cross2(vCross,p12,p22);var det=dot(p02,vCross),t=dot(point,vCross)/det;cross2(vCross,p22,p02);var u=dot(point,vCross)/det;cross2(vCross,p02,p12);var v=dot(point,vCross)/det;Vector2.scale(uv,uv0,t),Vector2.scaleAndAdd(uv,uv,uv1,u),Vector2.scaleAndAdd(uv,uv,uv2,v);var x=uv.x*this._chart.getWidth(),y=uv.y*this._chart.getHeight();this._chart.getZr().handler.dispatch(eventName,{zrX:x,zrY:y})}),attachToMesh:function(mesh){this._meshes.indexOf(mesh)&gt;=0||(events.forEach(function(eventName){mesh.on(eventName,this[makeHandlerName(eventName)],this)},this),this._meshes.push(mesh))},detachFromMesh:function(mesh){var idx=this._meshes.indexOf(mesh);idx&gt;=0&amp;&amp;this._meshes.splice(idx,1),events.forEach(function(eventName){mesh.off(eventName,this[makeHandlerName(eventName)])},this)},dispose:function(){this._meshes.forEach(function(mesh){this.detachFromMesh(mesh)},this)}};var retrieve_firstNotNull=function(){for(var i=0,len=arguments.length;i&lt;len;i++)if(null!=arguments[i])return arguments[i]},retrieve_queryDataIndex=function(data,payload){return null!=payload.dataIndexInside?payload.dataIndexInside:null!=payload.dataIndex?isArray(payload.dataIndex)?map(payload.dataIndex,function(value){return data.indexOfRawIndex(value)}):data.indexOfRawIndex(payload.dataIndex):null!=payload.name?isArray(payload.name)?map(payload.name,function(value){return data.indexOfName(value)}):data.indexOfName(payload.name):void 0},animatableMixin={_animators:null,getAnimators:function(){return this._animators=this._animators||[],this._animators},animate:function(path,opts){this._animators=this._animators||[];var target;if(path){for(var pathSplitted=path.split("."),prop=this,i=0,l=pathSplitted.length;i&lt;l;i++)prop&amp;&amp;(prop=prop[pathSplitted[i]]);prop&amp;&amp;(target=prop)}else target=this;if(null==target)throw new Error("Target "+path+" not exists");var animators=this._animators,animator=new Animator(target,opts),self2=this;return animator.during(function(){self2.__zr&amp;&amp;self2.__zr.refresh()}).done(function(){var idx=animators.indexOf(animator);idx&gt;=0&amp;&amp;animators.splice(idx,1)}),animators.push(animator),this.__zr&amp;&amp;this.__zr.animation.addAnimator(animator),animator},stopAnimation:function(forwardToLast){this._animators=this._animators||[];for(var animators=this._animators,len=animators.length,i=0;i&lt;len;i++)animators[i].stop(forwardToLast);return animators.length=0,this},addAnimatorsToZr:function(zr){if(this._animators)for(var i=0;i&lt;this._animators.length;i++)zr.animation.addAnimator(this._animators[i])},removeAnimatorsFromZr:function(zr){if(this._animators)for(var i=0;i&lt;this._animators.length;i++)zr.animation.removeAnimator(this._animators[i])}};function isValueImage(value){return value instanceof HTMLCanvasElement||value instanceof HTMLImageElement||value instanceof Image}Object.assign(Node$1.prototype,animatableMixin),Shader.import(utilShaderCode),Shader.import(prezGLSL),Shader.import("\n@export ecgl.common.transformUniforms\nuniform mat4 worldViewProjection : WORLDVIEWPROJECTION;\nuniform mat4 worldInverseTranspose : WORLDINVERSETRANSPOSE;\nuniform mat4 world : WORLD;\n@end\n\n@export ecgl.common.attributes\nattribute vec3 position : POSITION;\nattribute vec2 texcoord : TEXCOORD_0;\nattribute vec3 normal : NORMAL;\n@end\n\n@export ecgl.common.uv.header\nuniform vec2 uvRepeat : [1.0, 1.0];\nuniform vec2 uvOffset : [0.0, 0.0];\nuniform vec2 detailUvRepeat : [1.0, 1.0];\nuniform vec2 detailUvOffset : [0.0, 0.0];\n\nvarying vec2 v_Texcoord;\nvarying vec2 v_DetailTexcoord;\n@end\n\n@export ecgl.common.uv.main\nv_Texcoord = texcoord * uvRepeat + uvOffset;\nv_DetailTexcoord = texcoord * detailUvRepeat + detailUvOffset;\n@end\n\n@export ecgl.common.uv.fragmentHeader\nvarying vec2 v_Texcoord;\nvarying vec2 v_DetailTexcoord;\n@end\n\n\n@export ecgl.common.albedo.main\n\n vec4 albedoTexel = vec4(1.0);\n#ifdef DIFFUSEMAP_ENABLED\n albedoTexel = texture2D(diffuseMap, v_Texcoord);\n #ifdef SRGB_DECODE\n albedoTexel = sRGBToLinear(albedoTexel);\n #endif\n#endif\n\n#ifdef DETAILMAP_ENABLED\n vec4 detailTexel = texture2D(detailMap, v_DetailTexcoord);\n #ifdef SRGB_DECODE\n detailTexel = sRGBToLinear(detailTexel);\n #endif\n albedoTexel.rgb = mix(albedoTexel.rgb, detailTexel.rgb, detailTexel.a);\n albedoTexel.a = detailTexel.a + (1.0 - detailTexel.a) * albedoTexel.a;\n#endif\n\n@end\n\n@export ecgl.common.wireframe.vertexHeader\n\n#ifdef WIREFRAME_QUAD\nattribute vec4 barycentric;\nvarying vec4 v_Barycentric;\n#elif defined(WIREFRAME_TRIANGLE)\nattribute vec3 barycentric;\nvarying vec3 v_Barycentric;\n#endif\n\n@end\n\n@export ecgl.common.wireframe.vertexMain\n\n#if defined(WIREFRAME_QUAD) || defined(WIREFRAME_TRIANGLE)\n v_Barycentric = barycentric;\n#endif\n\n@end\n\n\n@export ecgl.common.wireframe.fragmentHeader\n\nuniform float wireframeLineWidth : 1;\nuniform vec4 wireframeLineColor: [0, 0, 0, 0.5];\n\n#ifdef WIREFRAME_QUAD\nvarying vec4 v_Barycentric;\nfloat edgeFactor () {\n vec4 d = fwidth(v_Barycentric);\n vec4 a4 = smoothstep(vec4(0.0), d * wireframeLineWidth, v_Barycentric);\n return min(min(min(a4.x, a4.y), a4.z), a4.w);\n}\n#elif defined(WIREFRAME_TRIANGLE)\nvarying vec3 v_Barycentric;\nfloat edgeFactor () {\n vec3 d = fwidth(v_Barycentric);\n vec3 a3 = smoothstep(vec3(0.0), d * wireframeLineWidth, v_Barycentric);\n return min(min(a3.x, a3.y), a3.z);\n}\n#endif\n\n@end\n\n\n@export ecgl.common.wireframe.fragmentMain\n\n#if defined(WIREFRAME_QUAD) || defined(WIREFRAME_TRIANGLE)\n if (wireframeLineWidth &gt; 0.) {\n vec4 lineColor = wireframeLineColor;\n#ifdef SRGB_DECODE\n lineColor = sRGBToLinear(lineColor);\n#endif\n\n gl_FragColor.rgb = mix(gl_FragColor.rgb, lineColor.rgb, (1.0 - edgeFactor()) * lineColor.a);\n }\n#endif\n@end\n\n\n\n\n@export ecgl.common.bumpMap.header\n\n#ifdef BUMPMAP_ENABLED\nuniform sampler2D bumpMap;\nuniform float bumpScale : 1.0;\n\n\nvec3 bumpNormal(vec3 surfPos, vec3 surfNormal, vec3 baseNormal)\n{\n vec2 dSTdx = dFdx(v_Texcoord);\n vec2 dSTdy = dFdy(v_Texcoord);\n\n float Hll = bumpScale * texture2D(bumpMap, v_Texcoord).x;\n float dHx = bumpScale * texture2D(bumpMap, v_Texcoord + dSTdx).x - Hll;\n float dHy = bumpScale * texture2D(bumpMap, v_Texcoord + dSTdy).x - Hll;\n\n vec3 vSigmaX = dFdx(surfPos);\n vec3 vSigmaY = dFdy(surfPos);\n vec3 vN = surfNormal;\n\n vec3 R1 = cross(vSigmaY, vN);\n vec3 R2 = cross(vN, vSigmaX);\n\n float fDet = dot(vSigmaX, R1);\n\n vec3 vGrad = sign(fDet) * (dHx * R1 + dHy * R2);\n return normalize(abs(fDet) * baseNormal - vGrad);\n\n}\n#endif\n\n@end\n\n@export ecgl.common.normalMap.vertexHeader\n\n#ifdef NORMALMAP_ENABLED\nattribute vec4 tangent : TANGENT;\nvarying vec3 v_Tangent;\nvarying vec3 v_Bitangent;\n#endif\n\n@end\n\n@export ecgl.common.normalMap.vertexMain\n\n#ifdef NORMALMAP_ENABLED\n if (dot(tangent, tangent) &gt; 0.0) {\n v_Tangent = normalize((worldInverseTranspose * vec4(tangent.xyz, 0.0)).xyz);\n v_Bitangent = normalize(cross(v_Normal, v_Tangent) * tangent.w);\n }\n#endif\n\n@end\n\n\n@export ecgl.common.normalMap.fragmentHeader\n\n#ifdef NORMALMAP_ENABLED\nuniform sampler2D normalMap;\nvarying vec3 v_Tangent;\nvarying vec3 v_Bitangent;\n#endif\n\n@end\n\n@export ecgl.common.normalMap.fragmentMain\n#ifdef NORMALMAP_ENABLED\n if (dot(v_Tangent, v_Tangent) &gt; 0.0) {\n vec3 normalTexel = texture2D(normalMap, v_DetailTexcoord).xyz;\n if (dot(normalTexel, normalTexel) &gt; 0.0) { N = normalTexel * 2.0 - 1.0;\n mat3 tbn = mat3(v_Tangent, v_Bitangent, v_Normal);\n N = normalize(tbn * N);\n }\n }\n#endif\n@end\n\n\n\n@export ecgl.common.vertexAnimation.header\n\n#ifdef VERTEX_ANIMATION\nattribute vec3 prevPosition;\nattribute vec3 prevNormal;\nuniform float percent;\n#endif\n\n@end\n\n@export ecgl.common.vertexAnimation.main\n\n#ifdef VERTEX_ANIMATION\n vec3 pos = mix(prevPosition, position, percent);\n vec3 norm = mix(prevNormal, normal, percent);\n#else\n vec3 pos = position;\n vec3 norm = normal;\n#endif\n\n@end\n\n\n@export ecgl.common.ssaoMap.header\n#ifdef SSAOMAP_ENABLED\nuniform sampler2D ssaoMap;\nuniform vec4 viewport : VIEWPORT;\n#endif\n@end\n\n@export ecgl.common.ssaoMap.main\n float ao = 1.0;\n#ifdef SSAOMAP_ENABLED\n ao = texture2D(ssaoMap, (gl_FragCoord.xy - viewport.xy) / viewport.zw).r;\n#endif\n@end\n\n\n\n\n@export ecgl.common.diffuseLayer.header\n\n#if (LAYER_DIFFUSEMAP_COUNT &gt; 0)\nuniform float layerDiffuseIntensity[LAYER_DIFFUSEMAP_COUNT];\nuniform sampler2D layerDiffuseMap[LAYER_DIFFUSEMAP_COUNT];\n#endif\n\n@end\n\n@export ecgl.common.emissiveLayer.header\n\n#if (LAYER_EMISSIVEMAP_COUNT &gt; 0)\nuniform float layerEmissionIntensity[LAYER_EMISSIVEMAP_COUNT];\nuniform sampler2D layerEmissiveMap[LAYER_EMISSIVEMAP_COUNT];\n#endif\n\n@end\n\n@export ecgl.common.layers.header\n@import ecgl.common.diffuseLayer.header\n@import ecgl.common.emissiveLayer.header\n@end\n\n@export ecgl.common.diffuseLayer.main\n\n#if (LAYER_DIFFUSEMAP_COUNT &gt; 0)\n for (int _idx_ = 0; _idx_ &lt; LAYER_DIFFUSEMAP_COUNT; _idx_++) {{\n float intensity = layerDiffuseIntensity[_idx_];\n vec4 texel2 = texture2D(layerDiffuseMap[_idx_], v_Texcoord);\n #ifdef SRGB_DECODE\n texel2 = sRGBToLinear(texel2);\n #endif\n albedoTexel.rgb = mix(albedoTexel.rgb, texel2.rgb * intensity, texel2.a);\n albedoTexel.a = texel2.a + (1.0 - texel2.a) * albedoTexel.a;\n }}\n#endif\n\n@end\n\n@export ecgl.common.emissiveLayer.main\n\n#if (LAYER_EMISSIVEMAP_COUNT &gt; 0)\n for (int _idx_ = 0; _idx_ &lt; LAYER_EMISSIVEMAP_COUNT; _idx_++)\n {{\n vec4 texel2 = texture2D(layerEmissiveMap[_idx_], v_Texcoord) * layerEmissionIntensity[_idx_];\n #ifdef SRGB_DECODE\n texel2 = sRGBToLinear(texel2);\n #endif\n float intensity = layerEmissionIntensity[_idx_];\n gl_FragColor.rgb += texel2.rgb * texel2.a * intensity;\n }}\n#endif\n\n@end\n"),Shader.import("@export ecgl.color.vertex\n\nuniform mat4 worldViewProjection : WORLDVIEWPROJECTION;\n\n@import ecgl.common.uv.header\n\nattribute vec2 texcoord : TEXCOORD_0;\nattribute vec3 position: POSITION;\n\n@import ecgl.common.wireframe.vertexHeader\n\n#ifdef VERTEX_COLOR\nattribute vec4 a_Color : COLOR;\nvarying vec4 v_Color;\n#endif\n\n#ifdef VERTEX_ANIMATION\nattribute vec3 prevPosition;\nuniform float percent : 1.0;\n#endif\n\n#ifdef ATMOSPHERE_ENABLED\nattribute vec3 normal: NORMAL;\nuniform mat4 worldInverseTranspose : WORLDINVERSETRANSPOSE;\nvarying vec3 v_Normal;\n#endif\n\nvoid main()\n{\n#ifdef VERTEX_ANIMATION\n vec3 pos = mix(prevPosition, position, percent);\n#else\n vec3 pos = position;\n#endif\n\n gl_Position = worldViewProjection * vec4(pos, 1.0);\n\n @import ecgl.common.uv.main\n\n#ifdef VERTEX_COLOR\n v_Color = a_Color;\n#endif\n\n#ifdef ATMOSPHERE_ENABLED\n v_Normal = normalize((worldInverseTranspose * vec4(normal, 0.0)).xyz);\n#endif\n\n @import ecgl.common.wireframe.vertexMain\n\n}\n\n@end\n\n@export ecgl.color.fragment\n\n#define LAYER_DIFFUSEMAP_COUNT 0\n#define LAYER_EMISSIVEMAP_COUNT 0\n\nuniform sampler2D diffuseMap;\nuniform sampler2D detailMap;\n\nuniform vec4 color : [1.0, 1.0, 1.0, 1.0];\n\n#ifdef ATMOSPHERE_ENABLED\nuniform mat4 viewTranspose: VIEWTRANSPOSE;\nuniform vec3 glowColor;\nuniform float glowPower;\nvarying vec3 v_Normal;\n#endif\n\n#ifdef VERTEX_COLOR\nvarying vec4 v_Color;\n#endif\n\n@import ecgl.common.layers.header\n\n@import ecgl.common.uv.fragmentHeader\n\n@import ecgl.common.wireframe.fragmentHeader\n\n@import clay.util.srgb\n\nvoid main()\n{\n#ifdef SRGB_DECODE\n gl_FragColor = sRGBToLinear(color);\n#else\n gl_FragColor = color;\n#endif\n\n#ifdef VERTEX_COLOR\n gl_FragColor *= v_Color;\n#endif\n\n @import ecgl.common.albedo.main\n\n @import ecgl.common.diffuseLayer.main\n\n gl_FragColor *= albedoTexel;\n\n#ifdef ATMOSPHERE_ENABLED\n float atmoIntensity = pow(1.0 - dot(v_Normal, (viewTranspose * vec4(0.0, 0.0, 1.0, 0.0)).xyz), glowPower);\n gl_FragColor.rgb += glowColor * atmoIntensity;\n#endif\n\n @import ecgl.common.emissiveLayer.main\n\n @import ecgl.common.wireframe.fragmentMain\n\n}\n@end"),Shader.import("/**\n * http: */\n\n@export ecgl.lambert.vertex\n\n@import ecgl.common.transformUniforms\n\n@import ecgl.common.uv.header\n\n\n@import ecgl.common.attributes\n\n@import ecgl.common.wireframe.vertexHeader\n\n#ifdef VERTEX_COLOR\nattribute vec4 a_Color : COLOR;\nvarying vec4 v_Color;\n#endif\n\n\n@import ecgl.common.vertexAnimation.header\n\n\nvarying vec3 v_Normal;\nvarying vec3 v_WorldPosition;\n\nvoid main()\n{\n @import ecgl.common.uv.main\n\n @import ecgl.common.vertexAnimation.main\n\n\n gl_Position = worldViewProjection * vec4(pos, 1.0);\n\n v_Normal = normalize((worldInverseTranspose * vec4(norm, 0.0)).xyz);\n v_WorldPosition = (world * vec4(pos, 1.0)).xyz;\n\n#ifdef VERTEX_COLOR\n v_Color = a_Color;\n#endif\n\n @import ecgl.common.wireframe.vertexMain\n}\n\n@end\n\n\n@export ecgl.lambert.fragment\n\n#define LAYER_DIFFUSEMAP_COUNT 0\n#define LAYER_EMISSIVEMAP_COUNT 0\n\n#define NORMAL_UP_AXIS 1\n#define NORMAL_FRONT_AXIS 2\n\n@import ecgl.common.uv.fragmentHeader\n\nvarying vec3 v_Normal;\nvarying vec3 v_WorldPosition;\n\nuniform sampler2D diffuseMap;\nuniform sampler2D detailMap;\n\n@import ecgl.common.layers.header\n\nuniform float emissionIntensity: 1.0;\n\nuniform vec4 color : [1.0, 1.0, 1.0, 1.0];\n\nuniform mat4 viewInverse : VIEWINVERSE;\n\n#ifdef ATMOSPHERE_ENABLED\nuniform mat4 viewTranspose: VIEWTRANSPOSE;\nuniform vec3 glowColor;\nuniform float glowPower;\n#endif\n\n#ifdef AMBIENT_LIGHT_COUNT\n@import clay.header.ambient_light\n#endif\n#ifdef AMBIENT_SH_LIGHT_COUNT\n@import clay.header.ambient_sh_light\n#endif\n\n#ifdef DIRECTIONAL_LIGHT_COUNT\n@import clay.header.directional_light\n#endif\n\n#ifdef VERTEX_COLOR\nvarying vec4 v_Color;\n#endif\n\n\n@import ecgl.common.ssaoMap.header\n\n@import ecgl.common.bumpMap.header\n\n@import clay.util.srgb\n\n@import ecgl.common.wireframe.fragmentHeader\n\n@import clay.plugin.compute_shadow_map\n\nvoid main()\n{\n#ifdef SRGB_DECODE\n gl_FragColor = sRGBToLinear(color);\n#else\n gl_FragColor = color;\n#endif\n\n#ifdef VERTEX_COLOR\n #ifdef SRGB_DECODE\n gl_FragColor *= sRGBToLinear(v_Color);\n #else\n gl_FragColor *= v_Color;\n #endif\n#endif\n\n @import ecgl.common.albedo.main\n\n @import ecgl.common.diffuseLayer.main\n\n gl_FragColor *= albedoTexel;\n\n vec3 N = v_Normal;\n#ifdef DOUBLE_SIDED\n vec3 eyePos = viewInverse[3].xyz;\n vec3 V = normalize(eyePos - v_WorldPosition);\n\n if (dot(N, V) &lt; 0.0) {\n N = -N;\n }\n#endif\n\n float ambientFactor = 1.0;\n\n#ifdef BUMPMAP_ENABLED\n N = bumpNormal(v_WorldPosition, v_Normal, N);\n ambientFactor = dot(v_Normal, N);\n#endif\n\n vec3 N2 = vec3(N.x, N[NORMAL_UP_AXIS], N[NORMAL_FRONT_AXIS]);\n\n vec3 diffuseColor = vec3(0.0, 0.0, 0.0);\n\n @import ecgl.common.ssaoMap.main\n\n#ifdef AMBIENT_LIGHT_COUNT\n for(int i = 0; i &lt; AMBIENT_LIGHT_COUNT; i++)\n {\n diffuseColor += ambientLightColor[i] * ambientFactor * ao;\n }\n#endif\n#ifdef AMBIENT_SH_LIGHT_COUNT\n for(int _idx_ = 0; _idx_ &lt; AMBIENT_SH_LIGHT_COUNT; _idx_++)\n {{\n diffuseColor += calcAmbientSHLight(_idx_, N2) * ambientSHLightColor[_idx_] * ao;\n }}\n#endif\n#ifdef DIRECTIONAL_LIGHT_COUNT\n#if defined(DIRECTIONAL_LIGHT_SHADOWMAP_COUNT)\n float shadowContribsDir[DIRECTIONAL_LIGHT_COUNT];\n if(shadowEnabled)\n {\n computeShadowOfDirectionalLights(v_WorldPosition, shadowContribsDir);\n }\n#endif\n for(int i = 0; i &lt; DIRECTIONAL_LIGHT_COUNT; i++)\n {\n vec3 lightDirection = -directionalLightDirection[i];\n vec3 lightColor = directionalLightColor[i];\n\n float shadowContrib = 1.0;\n#if defined(DIRECTIONAL_LIGHT_SHADOWMAP_COUNT)\n if (shadowEnabled)\n {\n shadowContrib = shadowContribsDir[i];\n }\n#endif\n\n float ndl = dot(N, normalize(lightDirection)) * shadowContrib;\n\n diffuseColor += lightColor * clamp(ndl, 0.0, 1.0);\n }\n#endif\n\n gl_FragColor.rgb *= diffuseColor;\n\n#ifdef ATMOSPHERE_ENABLED\n float atmoIntensity = pow(1.0 - dot(v_Normal, (viewTranspose * vec4(0.0, 0.0, 1.0, 0.0)).xyz), glowPower);\n gl_FragColor.rgb += glowColor * atmoIntensity;\n#endif\n\n @import ecgl.common.emissiveLayer.main\n\n @import ecgl.common.wireframe.fragmentMain\n}\n\n@end"),Shader.import("@export ecgl.realistic.vertex\n\n@import ecgl.common.transformUniforms\n\n@import ecgl.common.uv.header\n\n@import ecgl.common.attributes\n\n\n@import ecgl.common.wireframe.vertexHeader\n\n#ifdef VERTEX_COLOR\nattribute vec4 a_Color : COLOR;\nvarying vec4 v_Color;\n#endif\n\n#ifdef NORMALMAP_ENABLED\nattribute vec4 tangent : TANGENT;\nvarying vec3 v_Tangent;\nvarying vec3 v_Bitangent;\n#endif\n\n@import ecgl.common.vertexAnimation.header\n\nvarying vec3 v_Normal;\nvarying vec3 v_WorldPosition;\n\nvoid main()\n{\n\n @import ecgl.common.uv.main\n\n @import ecgl.common.vertexAnimation.main\n\n gl_Position = worldViewProjection * vec4(pos, 1.0);\n\n v_Normal = normalize((worldInverseTranspose * vec4(norm, 0.0)).xyz);\n v_WorldPosition = (world * vec4(pos, 1.0)).xyz;\n\n#ifdef VERTEX_COLOR\n v_Color = a_Color;\n#endif\n\n#ifdef NORMALMAP_ENABLED\n v_Tangent = normalize((worldInverseTranspose * vec4(tangent.xyz, 0.0)).xyz);\n v_Bitangent = normalize(cross(v_Normal, v_Tangent) * tangent.w);\n#endif\n\n @import ecgl.common.wireframe.vertexMain\n\n}\n\n@end\n\n\n\n@export ecgl.realistic.fragment\n\n#define LAYER_DIFFUSEMAP_COUNT 0\n#define LAYER_EMISSIVEMAP_COUNT 0\n#define PI 3.14159265358979\n#define ROUGHNESS_CHANEL 0\n#define METALNESS_CHANEL 1\n\n#define NORMAL_UP_AXIS 1\n#define NORMAL_FRONT_AXIS 2\n\n#ifdef VERTEX_COLOR\nvarying vec4 v_Color;\n#endif\n\n@import ecgl.common.uv.fragmentHeader\n\nvarying vec3 v_Normal;\nvarying vec3 v_WorldPosition;\n\nuniform sampler2D diffuseMap;\n\nuniform sampler2D detailMap;\nuniform sampler2D metalnessMap;\nuniform sampler2D roughnessMap;\n\n@import ecgl.common.layers.header\n\nuniform float emissionIntensity: 1.0;\n\nuniform vec4 color : [1.0, 1.0, 1.0, 1.0];\n\nuniform float metalness : 0.0;\nuniform float roughness : 0.5;\n\nuniform mat4 viewInverse : VIEWINVERSE;\n\n#ifdef ATMOSPHERE_ENABLED\nuniform mat4 viewTranspose: VIEWTRANSPOSE;\nuniform vec3 glowColor;\nuniform float glowPower;\n#endif\n\n#ifdef AMBIENT_LIGHT_COUNT\n@import clay.header.ambient_light\n#endif\n\n#ifdef AMBIENT_SH_LIGHT_COUNT\n@import clay.header.ambient_sh_light\n#endif\n\n#ifdef AMBIENT_CUBEMAP_LIGHT_COUNT\n@import clay.header.ambient_cubemap_light\n#endif\n\n#ifdef DIRECTIONAL_LIGHT_COUNT\n@import clay.header.directional_light\n#endif\n\n@import ecgl.common.normalMap.fragmentHeader\n\n@import ecgl.common.ssaoMap.header\n\n@import ecgl.common.bumpMap.header\n\n@import clay.util.srgb\n\n@import clay.util.rgbm\n\n@import ecgl.common.wireframe.fragmentHeader\n\n@import clay.plugin.compute_shadow_map\n\nvec3 F_Schlick(float ndv, vec3 spec) {\n return spec + (1.0 - spec) * pow(1.0 - ndv, 5.0);\n}\n\nfloat D_Phong(float g, float ndh) {\n float a = pow(8192.0, g);\n return (a + 2.0) / 8.0 * pow(ndh, a);\n}\n\nvoid main()\n{\n vec4 albedoColor = color;\n\n vec3 eyePos = viewInverse[3].xyz;\n vec3 V = normalize(eyePos - v_WorldPosition);\n#ifdef VERTEX_COLOR\n #ifdef SRGB_DECODE\n albedoColor *= sRGBToLinear(v_Color);\n #else\n albedoColor *= v_Color;\n #endif\n#endif\n\n @import ecgl.common.albedo.main\n\n @import ecgl.common.diffuseLayer.main\n\n albedoColor *= albedoTexel;\n\n float m = metalness;\n\n#ifdef METALNESSMAP_ENABLED\n float m2 = texture2D(metalnessMap, v_DetailTexcoord)[METALNESS_CHANEL];\n m = clamp(m2 + (m - 0.5) * 2.0, 0.0, 1.0);\n#endif\n\n vec3 baseColor = albedoColor.rgb;\n albedoColor.rgb = baseColor * (1.0 - m);\n vec3 specFactor = mix(vec3(0.04), baseColor, m);\n\n float g = 1.0 - roughness;\n\n#ifdef ROUGHNESSMAP_ENABLED\n float g2 = 1.0 - texture2D(roughnessMap, v_DetailTexcoord)[ROUGHNESS_CHANEL];\n g = clamp(g2 + (g - 0.5) * 2.0, 0.0, 1.0);\n#endif\n\n vec3 N = v_Normal;\n\n#ifdef DOUBLE_SIDED\n if (dot(N, V) &lt; 0.0) {\n N = -N;\n }\n#endif\n\n float ambientFactor = 1.0;\n\n#ifdef BUMPMAP_ENABLED\n N = bumpNormal(v_WorldPosition, v_Normal, N);\n ambientFactor = dot(v_Normal, N);\n#endif\n\n@import ecgl.common.normalMap.fragmentMain\n\n vec3 N2 = vec3(N.x, N[NORMAL_UP_AXIS], N[NORMAL_FRONT_AXIS]);\n\n vec3 diffuseTerm = vec3(0.0);\n vec3 specularTerm = vec3(0.0);\n\n float ndv = clamp(dot(N, V), 0.0, 1.0);\n vec3 fresnelTerm = F_Schlick(ndv, specFactor);\n\n @import ecgl.common.ssaoMap.main\n\n#ifdef AMBIENT_LIGHT_COUNT\n for(int _idx_ = 0; _idx_ &lt; AMBIENT_LIGHT_COUNT; _idx_++)\n {{\n diffuseTerm += ambientLightColor[_idx_] * ambientFactor * ao;\n }}\n#endif\n\n#ifdef AMBIENT_SH_LIGHT_COUNT\n for(int _idx_ = 0; _idx_ &lt; AMBIENT_SH_LIGHT_COUNT; _idx_++)\n {{\n diffuseTerm += calcAmbientSHLight(_idx_, N2) * ambientSHLightColor[_idx_] * ao;\n }}\n#endif\n\n#ifdef DIRECTIONAL_LIGHT_COUNT\n#if defined(DIRECTIONAL_LIGHT_SHADOWMAP_COUNT)\n float shadowContribsDir[DIRECTIONAL_LIGHT_COUNT];\n if(shadowEnabled)\n {\n computeShadowOfDirectionalLights(v_WorldPosition, shadowContribsDir);\n }\n#endif\n for(int _idx_ = 0; _idx_ &lt; DIRECTIONAL_LIGHT_COUNT; _idx_++)\n {{\n vec3 L = -directionalLightDirection[_idx_];\n vec3 lc = directionalLightColor[_idx_];\n\n vec3 H = normalize(L + V);\n float ndl = clamp(dot(N, normalize(L)), 0.0, 1.0);\n float ndh = clamp(dot(N, H), 0.0, 1.0);\n\n float shadowContrib = 1.0;\n#if defined(DIRECTIONAL_LIGHT_SHADOWMAP_COUNT)\n if (shadowEnabled)\n {\n shadowContrib = shadowContribsDir[_idx_];\n }\n#endif\n\n vec3 li = lc * ndl * shadowContrib;\n\n diffuseTerm += li;\n specularTerm += li * fresnelTerm * D_Phong(g, ndh);\n }}\n#endif\n\n\n#ifdef AMBIENT_CUBEMAP_LIGHT_COUNT\n vec3 L = reflect(-V, N);\n L = vec3(L.x, L[NORMAL_UP_AXIS], L[NORMAL_FRONT_AXIS]);\n float rough2 = clamp(1.0 - g, 0.0, 1.0);\n float bias2 = rough2 * 5.0;\n vec2 brdfParam2 = texture2D(ambientCubemapLightBRDFLookup[0], vec2(rough2, ndv)).xy;\n vec3 envWeight2 = specFactor * brdfParam2.x + brdfParam2.y;\n vec3 envTexel2;\n for(int _idx_ = 0; _idx_ &lt; AMBIENT_CUBEMAP_LIGHT_COUNT; _idx_++)\n {{\n envTexel2 = RGBMDecode(textureCubeLodEXT(ambientCubemapLightCubemap[_idx_], L, bias2), 8.12);\n specularTerm += ambientCubemapLightColor[_idx_] * envTexel2 * envWeight2 * ao;\n }}\n#endif\n\n gl_FragColor.rgb = albedoColor.rgb * diffuseTerm + specularTerm;\n gl_FragColor.a = albedoColor.a;\n\n#ifdef ATMOSPHERE_ENABLED\n float atmoIntensity = pow(1.0 - dot(v_Normal, (viewTranspose * vec4(0.0, 0.0, 1.0, 0.0)).xyz), glowPower);\n gl_FragColor.rgb += glowColor * atmoIntensity;\n#endif\n\n#ifdef SRGB_ENCODE\n gl_FragColor = linearTosRGB(gl_FragColor);\n#endif\n\n @import ecgl.common.emissiveLayer.main\n\n @import ecgl.common.wireframe.fragmentMain\n}\n\n@end"),Shader.import("@export ecgl.hatching.vertex\n\n@import ecgl.realistic.vertex\n\n@end\n\n\n@export ecgl.hatching.fragment\n\n#define NORMAL_UP_AXIS 1\n#define NORMAL_FRONT_AXIS 2\n\n@import ecgl.common.uv.fragmentHeader\n\nvarying vec3 v_Normal;\nvarying vec3 v_WorldPosition;\n\nuniform vec4 color : [0.0, 0.0, 0.0, 1.0];\nuniform vec4 paperColor : [1.0, 1.0, 1.0, 1.0];\n\nuniform mat4 viewInverse : VIEWINVERSE;\n\n#ifdef AMBIENT_LIGHT_COUNT\n@import clay.header.ambient_light\n#endif\n#ifdef AMBIENT_SH_LIGHT_COUNT\n@import clay.header.ambient_sh_light\n#endif\n\n#ifdef DIRECTIONAL_LIGHT_COUNT\n@import clay.header.directional_light\n#endif\n\n#ifdef VERTEX_COLOR\nvarying vec4 v_Color;\n#endif\n\n\n@import ecgl.common.ssaoMap.header\n\n@import ecgl.common.bumpMap.header\n\n@import clay.util.srgb\n\n@import ecgl.common.wireframe.fragmentHeader\n\n@import clay.plugin.compute_shadow_map\n\nuniform sampler2D hatch1;\nuniform sampler2D hatch2;\nuniform sampler2D hatch3;\nuniform sampler2D hatch4;\nuniform sampler2D hatch5;\nuniform sampler2D hatch6;\n\nfloat shade(in float tone) {\n vec4 c = vec4(1. ,1., 1., 1.);\n float step = 1. / 6.;\n vec2 uv = v_DetailTexcoord;\n if (tone &lt;= step / 2.0) {\n c = mix(vec4(0.), texture2D(hatch6, uv), 12. * tone);\n }\n else if (tone &lt;= step) {\n c = mix(texture2D(hatch6, uv), texture2D(hatch5, uv), 6. * tone);\n }\n if(tone &gt; step &amp;&amp; tone &lt;= 2. * step){\n c = mix(texture2D(hatch5, uv), texture2D(hatch4, uv) , 6. * (tone - step));\n }\n if(tone &gt; 2. * step &amp;&amp; tone &lt;= 3. * step){\n c = mix(texture2D(hatch4, uv), texture2D(hatch3, uv), 6. * (tone - 2. * step));\n }\n if(tone &gt; 3. * step &amp;&amp; tone &lt;= 4. * step){\n c = mix(texture2D(hatch3, uv), texture2D(hatch2, uv), 6. * (tone - 3. * step));\n }\n if(tone &gt; 4. * step &amp;&amp; tone &lt;= 5. * step){\n c = mix(texture2D(hatch2, uv), texture2D(hatch1, uv), 6. * (tone - 4. * step));\n }\n if(tone &gt; 5. * step){\n c = mix(texture2D(hatch1, uv), vec4(1.), 6. * (tone - 5. * step));\n }\n\n return c.r;\n}\n\nconst vec3 w = vec3(0.2125, 0.7154, 0.0721);\n\nvoid main()\n{\n#ifdef SRGB_DECODE\n vec4 inkColor = sRGBToLinear(color);\n#else\n vec4 inkColor = color;\n#endif\n\n#ifdef VERTEX_COLOR\n #ifdef SRGB_DECODE\n inkColor *= sRGBToLinear(v_Color);\n #else\n inkColor *= v_Color;\n #endif\n#endif\n\n vec3 N = v_Normal;\n#ifdef DOUBLE_SIDED\n vec3 eyePos = viewInverse[3].xyz;\n vec3 V = normalize(eyePos - v_WorldPosition);\n\n if (dot(N, V) &lt; 0.0) {\n N = -N;\n }\n#endif\n\n float tone = 0.0;\n\n float ambientFactor = 1.0;\n\n#ifdef BUMPMAP_ENABLED\n N = bumpNormal(v_WorldPosition, v_Normal, N);\n ambientFactor = dot(v_Normal, N);\n#endif\n\n vec3 N2 = vec3(N.x, N[NORMAL_UP_AXIS], N[NORMAL_FRONT_AXIS]);\n\n @import ecgl.common.ssaoMap.main\n\n#ifdef AMBIENT_LIGHT_COUNT\n for(int i = 0; i &lt; AMBIENT_LIGHT_COUNT; i++)\n {\n tone += dot(ambientLightColor[i], w) * ambientFactor * ao;\n }\n#endif\n#ifdef AMBIENT_SH_LIGHT_COUNT\n for(int _idx_ = 0; _idx_ &lt; AMBIENT_SH_LIGHT_COUNT; _idx_++)\n {{\n tone += dot(calcAmbientSHLight(_idx_, N2) * ambientSHLightColor[_idx_], w) * ao;\n }}\n#endif\n#ifdef DIRECTIONAL_LIGHT_COUNT\n#if defined(DIRECTIONAL_LIGHT_SHADOWMAP_COUNT)\n float shadowContribsDir[DIRECTIONAL_LIGHT_COUNT];\n if(shadowEnabled)\n {\n computeShadowOfDirectionalLights(v_WorldPosition, shadowContribsDir);\n }\n#endif\n for(int i = 0; i &lt; DIRECTIONAL_LIGHT_COUNT; i++)\n {\n vec3 lightDirection = -directionalLightDirection[i];\n float lightTone = dot(directionalLightColor[i], w);\n\n float shadowContrib = 1.0;\n#if defined(DIRECTIONAL_LIGHT_SHADOWMAP_COUNT)\n if (shadowEnabled)\n {\n shadowContrib = shadowContribsDir[i];\n }\n#endif\n\n float ndl = dot(N, normalize(lightDirection)) * shadowContrib;\n\n tone += lightTone * clamp(ndl, 0.0, 1.0);\n }\n#endif\n\n gl_FragColor = mix(inkColor, paperColor, shade(clamp(tone, 0.0, 1.0)));\n }\n@end\n"),Shader.import("@export ecgl.sm.depth.vertex\n\nuniform mat4 worldViewProjection : WORLDVIEWPROJECTION;\n\nattribute vec3 position : POSITION;\nattribute vec2 texcoord : TEXCOORD_0;\n\n#ifdef VERTEX_ANIMATION\nattribute vec3 prevPosition;\nuniform float percent : 1.0;\n#endif\n\nvarying vec4 v_ViewPosition;\nvarying vec2 v_Texcoord;\n\nvoid main(){\n\n#ifdef VERTEX_ANIMATION\n vec3 pos = mix(prevPosition, position, percent);\n#else\n vec3 pos = position;\n#endif\n\n v_ViewPosition = worldViewProjection * vec4(pos, 1.0);\n gl_Position = v_ViewPosition;\n\n v_Texcoord = texcoord;\n\n}\n@end\n\n\n\n@export ecgl.sm.depth.fragment\n\n@import clay.sm.depth.fragment\n\n@end");var oldAddToScene=Scene.prototype.addToScene,oldRemoveFromScene=Scene.prototype.removeFromScene;Scene.prototype.addToScene=function(node){if(oldAddToScene.call(this,node),this.__zr){var zr=this.__zr;node.traverse(function(child){child.__zr=zr,child.addAnimatorsToZr&amp;&amp;child.addAnimatorsToZr(zr)})}},Scene.prototype.removeFromScene=function(node){oldRemoveFromScene.call(this,node),node.traverse(function(child){var zr=child.__zr;child.__zr=null,zr&amp;&amp;child.removeAnimatorsFromZr&amp;&amp;child.removeAnimatorsFromZr(zr)})},Material.prototype.setTextureImage=function(textureName,imgValue,api,textureOpts){if(this.shader){var texture,zr=api.getZr(),material=this;return material.autoUpdateTextureStatus=!1,material.disableTexture(textureName),function isValueNone(value){return!value||"none"===value}(imgValue)||(texture=graphicGL.loadTexture(imgValue,api,textureOpts,function(texture2){material.enableTexture(textureName),zr&amp;&amp;zr.refresh()}),material.set(textureName,texture)),texture}};var graphicGL={};graphicGL.Renderer=Renderer,graphicGL.Node=Node$1,graphicGL.Mesh=Mesh,graphicGL.Shader=Shader,graphicGL.Material=Material,graphicGL.Texture=Texture,graphicGL.Texture2D=Texture2D,graphicGL.Geometry=Geometry,graphicGL.SphereGeometry=Sphere,graphicGL.PlaneGeometry=Plane,graphicGL.CubeGeometry=Cube,graphicGL.AmbientLight=AmbientLight,graphicGL.DirectionalLight=DirectionalLight,graphicGL.PointLight=PointLight,graphicGL.SpotLight=SpotLight,graphicGL.PerspectiveCamera=Perspective,graphicGL.OrthographicCamera=Orthographic,graphicGL.Vector2=Vector2,graphicGL.Vector3=Vector3,graphicGL.Vector4=Vector4,graphicGL.Quaternion=Quaternion,graphicGL.Matrix2=Matrix2,graphicGL.Matrix2d=Matrix2d,graphicGL.Matrix3=Matrix3,graphicGL.Matrix4=Matrix4,graphicGL.Plane=Plane$1,graphicGL.Ray=Ray,graphicGL.BoundingBox=BoundingBox,graphicGL.Frustum=Frustum;var blankImage=null;function nearestPowerOfTwo(val){return Math.pow(2,Math.round(Math.log(val)/Math.LN2))}function convertTextureToPowerOfTwo(texture){if((texture.wrapS===Texture.REPEAT||texture.wrapT===Texture.REPEAT)&amp;&amp;texture.image){var width=nearestPowerOfTwo(texture.width),height=nearestPowerOfTwo(texture.height);if(width!==texture.width||height!==texture.height){var canvas=document.createElement("canvas");canvas.width=width,canvas.height=height,canvas.getContext("2d").drawImage(texture.image,0,0,width,height),texture.image=canvas}}}graphicGL.loadTexture=function(imgValue,api,textureOpts,cb){"function"==typeof textureOpts&amp;&amp;(cb=textureOpts,textureOpts={}),textureOpts=textureOpts||{};for(var keys=Object.keys(textureOpts).sort(),prefix="",i=0;i&lt;keys.length;i++)prefix+=keys[i]+"_"+textureOpts[keys[i]]+"_";var textureCache=api.__textureCache=api.__textureCache||new LRU(20);if(function isECharts(value){return value.getZr&amp;&amp;value.setOption}(imgValue)){var id=imgValue.__textureid__;if(textureObj=textureCache.get(prefix+id))textureObj.texture.surface.setECharts(imgValue),cb&amp;&amp;cb(textureObj.texture);else{var surface=new EChartsSurface(imgValue);surface.onupdate=function(){api.getZr().refresh()},textureObj={texture:surface.getTexture()};for(i=0;i&lt;keys.length;i++)textureObj.texture[keys[i]]=textureOpts[keys[i]];id=imgValue.__textureid__||"__ecgl_ec__"+textureObj.texture.__uid__,imgValue.__textureid__=id,textureCache.put(prefix+id,textureObj),cb&amp;&amp;cb(textureObj.texture)}return textureObj.texture}if(isValueImage(imgValue)){var textureObj;id=imgValue.__textureid__;if(!(textureObj=textureCache.get(prefix+id))){textureObj={texture:new graphicGL.Texture2D({image:imgValue})};for(i=0;i&lt;keys.length;i++)textureObj.texture[keys[i]]=textureOpts[keys[i]];id=imgValue.__textureid__||"__ecgl_image__"+textureObj.texture.__uid__,imgValue.__textureid__=id,textureCache.put(prefix+id,textureObj),convertTextureToPowerOfTwo(textureObj.texture),cb&amp;&amp;cb(textureObj.texture)}return textureObj.texture}if(textureObj=textureCache.get(prefix+imgValue))textureObj.callbacks?textureObj.callbacks.push(cb):cb&amp;&amp;cb(textureObj.texture);else if(imgValue.match(/.hdr$|^data:application\/octet-stream/)){textureObj={callbacks:[cb]};var texture=textureUtil.loadTexture(imgValue,{exposure:textureOpts.exposure,fileType:"hdr"},function(){texture.dirty(),textureObj.callbacks.forEach(function(cb2){cb2&amp;&amp;cb2(texture)}),textureObj.callbacks=null});textureObj.texture=texture,textureCache.put(prefix+imgValue,textureObj)}else{for(texture=new graphicGL.Texture2D({image:new Image}),i=0;i&lt;keys.length;i++)texture[keys[i]]=textureOpts[keys[i]];textureObj={texture:texture,callbacks:[cb]};var originalImage=texture.image;originalImage.onload=function(){texture.image=originalImage,convertTextureToPowerOfTwo(texture),texture.dirty(),textureObj.callbacks.forEach(function(cb2){cb2&amp;&amp;cb2(texture)}),textureObj.callbacks=null},originalImage.crossOrigin="Anonymous",originalImage.src=imgValue,texture.image=function getBlankImage(){return null!==blankImage?blankImage:blankImage=textureUtil.createBlank("rgba(255,255,255,0)").image}(),textureCache.put(prefix+imgValue,textureObj)}return textureObj.texture},graphicGL.createAmbientCubemap=function(opt,renderer,api,cb){var textureUrl=(opt=opt||{}).texture,exposure=retrieve_firstNotNull(opt.exposure,1),ambientCubemap=new AmbientCubemapLight({intensity:retrieve_firstNotNull(opt.specularIntensity,1)}),ambientSH=new AmbientSHLight({intensity:retrieve_firstNotNull(opt.diffuseIntensity,1),coefficients:[.844,.712,.691,-.037,.083,.167,.343,.288,.299,-.041,-.021,-.009,-.003,-.041,-.064,-.011,-.007,-.004,-.031,.034,.081,-.06,-.049,-.06,.046,.056,.05]});return ambientCubemap.cubemap=graphicGL.loadTexture(textureUrl,api,{exposure:exposure},function(){ambientCubemap.cubemap.flipY=!1,ambientCubemap.prefilter(renderer,32),ambientSH.coefficients=sh.projectEnvironmentMap(renderer,ambientCubemap.cubemap,{lod:1}),cb&amp;&amp;cb()}),{specular:ambientCubemap,diffuse:ambientSH}},graphicGL.createBlankTexture=textureUtil.createBlank,graphicGL.isImage=isValueImage,graphicGL.additiveBlend=function(gl){gl.blendEquation(gl.FUNC_ADD),gl.blendFunc(gl.SRC_ALPHA,gl.ONE)},graphicGL.parseColor=function(colorStr,rgba){return colorStr instanceof Array?(rgba||(rgba=[]),rgba[0]=colorStr[0],rgba[1]=colorStr[1],rgba[2]=colorStr[2],colorStr.length&gt;3?rgba[3]=colorStr[3]:rgba[3]=1,rgba):((rgba=parse(colorStr||"#000",rgba)||[0,0,0,0])[0]/=255,rgba[1]/=255,rgba[2]/=255,rgba)},graphicGL.directionFromAlphaBeta=function(alpha2,beta){var theta=alpha2/180*Math.PI+Math.PI/2,phi=-beta/180*Math.PI+Math.PI/2,dir=[],r=Math.sin(theta);return dir[0]=r*Math.cos(phi),dir[1]=-Math.cos(theta),dir[2]=r*Math.sin(phi),dir},graphicGL.getShadowResolution=function(shadowQuality){var shadowResolution=1024;switch(shadowQuality){case"low":shadowResolution=512;break;case"medium":break;case"high":shadowResolution=2048;break;case"ultra":shadowResolution=4096}return shadowResolution},graphicGL.COMMON_SHADERS=["lambert","color","realistic","hatching","shadow"],graphicGL.createShader=function(prefix){"ecgl.shadow"===prefix&amp;&amp;(prefix="ecgl.displayShadow");var vertexShaderStr=Shader.source(prefix+".vertex"),fragmentShaderStr=Shader.source(prefix+".fragment");vertexShaderStr||console.error("Vertex shader of '%s' not exits",prefix),fragmentShaderStr||console.error("Fragment shader of '%s' not exits",prefix);var shader=new Shader(vertexShaderStr,fragmentShaderStr);return shader.name=prefix,shader},graphicGL.createMaterial=function(prefix,defines){defines instanceof Array||(defines=[defines]);var shader=graphicGL.createShader(prefix),material=new Material({shader:shader});return defines.forEach(function(defineName){"string"==typeof defineName&amp;&amp;material.define(defineName)}),material},graphicGL.setMaterialFromModel=function(shading,material,model,api){material.autoUpdateTextureStatus=!1;var materialModel=model.getModel(shading+"Material"),detailTexture=materialModel.get("detailTexture"),uvRepeat=retrieve_firstNotNull(materialModel.get("textureTiling"),1),uvOffset=retrieve_firstNotNull(materialModel.get("textureOffset"),0);"number"==typeof uvRepeat&amp;&amp;(uvRepeat=[uvRepeat,uvRepeat]),"number"==typeof uvOffset&amp;&amp;(uvOffset=[uvOffset,uvOffset]);var repeatParam=uvRepeat[0]&gt;1||uvRepeat[1]&gt;1?graphicGL.Texture.REPEAT:graphicGL.Texture.CLAMP_TO_EDGE,textureOpt={anisotropic:8,wrapS:repeatParam,wrapT:repeatParam};if("realistic"===shading){var roughness=materialModel.get("roughness"),metalness=materialModel.get("metalness");null!=metalness?isNaN(metalness)&amp;&amp;(material.setTextureImage("metalnessMap",metalness,api,textureOpt),metalness=retrieve_firstNotNull(materialModel.get("metalnessAdjust"),.5)):metalness=0,null!=roughness?isNaN(roughness)&amp;&amp;(material.setTextureImage("roughnessMap",roughness,api,textureOpt),roughness=retrieve_firstNotNull(materialModel.get("roughnessAdjust"),.5)):roughness=.5;var normalTextureVal=materialModel.get("normalTexture");material.setTextureImage("detailMap",detailTexture,api,textureOpt),material.setTextureImage("normalMap",normalTextureVal,api,textureOpt),material.set({roughness:roughness,metalness:metalness,detailUvRepeat:uvRepeat,detailUvOffset:uvOffset})}else if("lambert"===shading)material.setTextureImage("detailMap",detailTexture,api,textureOpt),material.set({detailUvRepeat:uvRepeat,detailUvOffset:uvOffset});else if("color"===shading)material.setTextureImage("detailMap",detailTexture,api,textureOpt),material.set({detailUvRepeat:uvRepeat,detailUvOffset:uvOffset});else if("hatching"===shading){var tams=materialModel.get("hatchingTextures")||[];tams.length;for(var i=0;i&lt;6;i++)material.setTextureImage("hatch"+(i+1),tams[i],api,{anisotropic:8,wrapS:graphicGL.Texture.REPEAT,wrapT:graphicGL.Texture.REPEAT});material.set({detailUvRepeat:uvRepeat,detailUvOffset:uvOffset})}},graphicGL.updateVertexAnimation=function(mappingAttributes,previousMesh,currentMesh,seriesModel){var enableAnimation=seriesModel.get("animation"),duration=seriesModel.get("animationDurationUpdate"),easing=seriesModel.get("animationEasingUpdate"),shadowDepthMaterial=currentMesh.shadowDepthMaterial;if(enableAnimation&amp;&amp;previousMesh&amp;&amp;duration&gt;0&amp;&amp;previousMesh.geometry.vertexCount===currentMesh.geometry.vertexCount){currentMesh.material.define("vertex","VERTEX_ANIMATION"),currentMesh.ignorePreZ=!0,shadowDepthMaterial&amp;&amp;shadowDepthMaterial.define("vertex","VERTEX_ANIMATION");for(var i=0;i&lt;mappingAttributes.length;i++)currentMesh.geometry.attributes[mappingAttributes[i][0]].value=previousMesh.geometry.attributes[mappingAttributes[i][1]].value;currentMesh.geometry.dirty(),currentMesh.__percent=0,currentMesh.material.set("percent",0),currentMesh.stopAnimation(),currentMesh.animate().when(duration,{__percent:1}).during(function(){currentMesh.material.set("percent",currentMesh.__percent),shadowDepthMaterial&amp;&amp;shadowDepthMaterial.set("percent",currentMesh.__percent)}).done(function(){currentMesh.ignorePreZ=!1,currentMesh.material.undefine("vertex","VERTEX_ANIMATION"),shadowDepthMaterial&amp;&amp;shadowDepthMaterial.undefine("vertex","VERTEX_ANIMATION")}).start(easing)}else currentMesh.material.undefine("vertex","VERTEX_ANIMATION"),shadowDepthMaterial&amp;&amp;shadowDepthMaterial.undefine("vertex","VERTEX_ANIMATION")};var LayerGL=function(id,zr){this.id=id,this.zr=zr;try{this.renderer=new Renderer({clearBit:0,devicePixelRatio:zr.painter.dpr,preserveDrawingBuffer:!0,premultipliedAlpha:!0}),this.renderer.resize(zr.painter.getWidth(),zr.painter.getHeight())}catch(e2){return this.renderer=null,this.dom=document.createElement("div"),this.dom.style.cssText="position:absolute; left: 0; top: 0; right: 0; bottom: 0;",this.dom.className="ecgl-nowebgl",this.dom.innerHTML="Sorry, your browser does not support WebGL",void console.error(e2)}this.onglobalout=this.onglobalout.bind(this),zr.on("globalout",this.onglobalout),this.dom=this.renderer.canvas;var style=this.dom.style;style.position="absolute",style.left="0",style.top="0",this.views=[],this._picking=new RayPicking({renderer:this.renderer}),this._viewsToDispose=[],this._accumulatingId=0,this._zrEventProxy=new Rect({shape:{x:-1,y:-1,width:2,height:2},__isGLToZRProxy:!0}),this._backgroundColor=null,this._disposed=!1};function removeFromZr(node){var zr=node.__zr;node.__zr=null,zr&amp;&amp;node.removeAnimatorsFromZr&amp;&amp;node.removeAnimatorsFromZr(zr)}LayerGL.prototype.setUnpainted=function(){},LayerGL.prototype.addView=function(view){if(view.layer!==this){var idx=this._viewsToDispose.indexOf(view);idx&gt;=0&amp;&amp;this._viewsToDispose.splice(idx,1),this.views.push(view),view.layer=this;var zr=this.zr;view.scene.traverse(function(node){node.__zr=zr,node.addAnimatorsToZr&amp;&amp;node.addAnimatorsToZr(zr)})}},LayerGL.prototype.removeView=function(view){if(view.layer===this){var idx=this.views.indexOf(view);idx&gt;=0&amp;&amp;(this.views.splice(idx,1),view.scene.traverse(removeFromZr,this),view.layer=null,this._viewsToDispose.push(view))}},LayerGL.prototype.removeViewsAll=function(){this.views.forEach(function(view){view.scene.traverse(removeFromZr,this),view.layer=null,this._viewsToDispose.push(view)},this),this.views.length=0},LayerGL.prototype.resize=function(width,height){this.renderer.resize(width,height)},LayerGL.prototype.clear=function(){var gl=this.renderer.gl,clearColor=this._backgroundColor||[0,0,0,0];gl.clearColor(clearColor[0],clearColor[1],clearColor[2],clearColor[3]),gl.depthMask(!0),gl.colorMask(!0,!0,!0,!0),gl.clear(gl.DEPTH_BUFFER_BIT|gl.COLOR_BUFFER_BIT)},LayerGL.prototype.clearDepth=function(){var gl=this.renderer.gl;gl.clear(gl.DEPTH_BUFFER_BIT)},LayerGL.prototype.clearColor=function(){var gl=this.renderer.gl;gl.clearColor(0,0,0,0),gl.clear(gl.COLOR_BUFFER_BIT)},LayerGL.prototype.needsRefresh=function(){this.zr.refresh()},LayerGL.prototype.refresh=function(bgColor){this._backgroundColor=bgColor?graphicGL.parseColor(bgColor):[0,0,0,0],this.renderer.clearColor=this._backgroundColor;for(var i=0;i&lt;this.views.length;i++)this.views[i].prepareRender(this.renderer);this._doRender(!1),this._trackAndClean();for(i=0;i&lt;this._viewsToDispose.length;i++)this._viewsToDispose[i].dispose(this.renderer);this._viewsToDispose.length=0,this._startAccumulating()},LayerGL.prototype.renderToCanvas=function(ctx){this._startAccumulating(!0),ctx.drawImage(this.dom,0,0,ctx.canvas.width,ctx.canvas.height)},LayerGL.prototype._doRender=function(accumulating){this.clear(),this.renderer.saveViewport();for(var i=0;i&lt;this.views.length;i++)this.views[i].render(this.renderer,accumulating);this.renderer.restoreViewport()},LayerGL.prototype._stopAccumulating=function(){this._accumulatingId=0,clearTimeout(this._accumulatingTimeout)};var accumulatingId=1;function markUnused(resourceList){for(var i=0;i&lt;resourceList.length;i++)resourceList[i].__used__=0}function checkAndDispose(renderer,resourceList){for(var i=0;i&lt;resourceList.length;i++)resourceList[i].__used__||resourceList[i].dispose(renderer)}function updateUsed(resource,list){resource.__used__=resource.__used__||0,resource.__used__++,1===resource.__used__&amp;&amp;list.push(resource)}function collectResources(scene,textureResourceList,geometryResourceList){var prevMaterial,prevGeometry;scene.traverse(function(renderable){if(renderable.isRenderable()){var geometry=renderable.geometry,material=renderable.material;if(material!==prevMaterial)for(var textureUniforms=material.getTextureUniforms(),u=0;u&lt;textureUniforms.length;u++){var uniformName=textureUniforms[u],val=material.uniforms[uniformName].value;if(val)if(val instanceof Texture)updateUsed(val,textureResourceList);else if(val instanceof Array)for(var k2=0;k2&lt;val.length;k2++)val[k2]instanceof Texture&amp;&amp;updateUsed(val[k2],textureResourceList)}geometry!==prevGeometry&amp;&amp;updateUsed(geometry,geometryResourceList),prevMaterial=material,prevGeometry=geometry}});for(var k=0;k&lt;scene.lights.length;k++)scene.lights[k].cubemap&amp;&amp;updateUsed(scene.lights[k].cubemap,textureResourceList)}LayerGL.prototype._startAccumulating=function(immediate){var self2=this;this._stopAccumulating();for(var needsAccumulate=!1,i=0;i&lt;this.views.length;i++)needsAccumulate=this.views[i].needsAccumulate()||needsAccumulate;function accumulate(id){if(self2._accumulatingId&amp;&amp;id===self2._accumulatingId){for(var isFinished=!0,i2=0;i2&lt;self2.views.length;i2++)isFinished=self2.views[i2].isAccumulateFinished()&amp;&amp;needsAccumulate;isFinished||(self2._doRender(!0),immediate?accumulate(id):requestAnimationFrame$1(function(){accumulate(id)}))}}needsAccumulate&amp;&amp;(this._accumulatingId=accumulatingId++,immediate?accumulate(self2._accumulatingId):this._accumulatingTimeout=setTimeout(function(){accumulate(self2._accumulatingId)},50))},LayerGL.prototype._trackAndClean=function(){var textureList=[],geometriesList=[];this._textureList&amp;&amp;(markUnused(this._textureList),markUnused(this._geometriesList));for(var i=0;i&lt;this.views.length;i++)collectResources(this.views[i].scene,textureList,geometriesList);this._textureList&amp;&amp;(checkAndDispose(this.renderer,this._textureList),checkAndDispose(this.renderer,this._geometriesList)),this._textureList=textureList,this._geometriesList=geometriesList},LayerGL.prototype.dispose=function(){this._disposed||(this._stopAccumulating(),this._textureList&amp;&amp;(markUnused(this._textureList),markUnused(this._geometriesList),checkAndDispose(this.renderer,this._textureList),checkAndDispose(this.renderer,this._geometriesList)),this.zr.off("globalout",this.onglobalout),this._disposed=!0)},LayerGL.prototype.onmousedown=function(e2){if(!e2.target||!e2.target.__isGLToZRProxy){e2=e2.event;var obj=this.pickObject(e2.offsetX,e2.offsetY);obj&amp;&amp;(this._dispatchEvent("mousedown",e2,obj),this._dispatchDataEvent("mousedown",e2,obj)),this._downX=e2.offsetX,this._downY=e2.offsetY}},LayerGL.prototype.onmousemove=function(e2){if(!e2.target||!e2.target.__isGLToZRProxy){e2=e2.event;var obj=this.pickObject(e2.offsetX,e2.offsetY),target=obj&amp;&amp;obj.target,lastHovered=this._hovered;this._hovered=obj,lastHovered&amp;&amp;target!==lastHovered.target&amp;&amp;(lastHovered.relatedTarget=target,this._dispatchEvent("mouseout",e2,lastHovered),this.zr.setCursorStyle("default")),this._dispatchEvent("mousemove",e2,obj),obj&amp;&amp;(this.zr.setCursorStyle("pointer"),lastHovered&amp;&amp;target===lastHovered.target||this._dispatchEvent("mouseover",e2,obj)),this._dispatchDataEvent("mousemove",e2,obj)}},LayerGL.prototype.onmouseup=function(e2){if(!e2.target||!e2.target.__isGLToZRProxy){e2=e2.event;var obj=this.pickObject(e2.offsetX,e2.offsetY);obj&amp;&amp;(this._dispatchEvent("mouseup",e2,obj),this._dispatchDataEvent("mouseup",e2,obj)),this._upX=e2.offsetX,this._upY=e2.offsetY}},LayerGL.prototype.onclick=LayerGL.prototype.dblclick=function(e2){if(!e2.target||!e2.target.__isGLToZRProxy){var dx=this._upX-this._downX,dy=this._upY-this._downY;if(!(Math.sqrt(dx*dx+dy*dy)&gt;20)){e2=e2.event;var obj=this.pickObject(e2.offsetX,e2.offsetY);obj&amp;&amp;(this._dispatchEvent(e2.type,e2,obj),this._dispatchDataEvent(e2.type,e2,obj));var result=this._clickToSetFocusPoint(e2);if(result)result.view.setDOFFocusOnPoint(result.distance)&amp;&amp;this.zr.refresh()}}},LayerGL.prototype._clickToSetFocusPoint=function(e2){for(var renderer=this.renderer,oldViewport=renderer.viewport,i=this.views.length-1;i&gt;=0;i--){var viewGL=this.views[i];if(viewGL.hasDOF()&amp;&amp;viewGL.containPoint(e2.offsetX,e2.offsetY)){this._picking.scene=viewGL.scene,this._picking.camera=viewGL.camera,renderer.viewport=viewGL.viewport;var result=this._picking.pick(e2.offsetX,e2.offsetY,!0);if(result)return result.view=viewGL,result}}renderer.viewport=oldViewport},LayerGL.prototype.onglobalout=function(e2){var lastHovered=this._hovered;lastHovered&amp;&amp;this._dispatchEvent("mouseout",e2,{target:lastHovered.target})},LayerGL.prototype.pickObject=function(x,y){for(var output=[],renderer=this.renderer,oldViewport=renderer.viewport,i=0;i&lt;this.views.length;i++){var viewGL=this.views[i];viewGL.containPoint(x,y)&amp;&amp;(this._picking.scene=viewGL.scene,this._picking.camera=viewGL.camera,renderer.viewport=viewGL.viewport,this._picking.pickAll(x,y,output))}return renderer.viewport=oldViewport,output.sort(function(a,b){return a.distance-b.distance}),output[0]},LayerGL.prototype._dispatchEvent=function(eveName,originalEvent,newEvent){newEvent||(newEvent={});var current=newEvent.target;for(newEvent.cancelBubble=!1,newEvent.event=originalEvent,newEvent.type=eveName,newEvent.offsetX=originalEvent.offsetX,newEvent.offsetY=originalEvent.offsetY;current&amp;&amp;(current.trigger(eveName,newEvent),current=current.getParent(),!newEvent.cancelBubble););this._dispatchToView(eveName,newEvent)},LayerGL.prototype._dispatchDataEvent=function(eveName,originalEvent,newEvent){var mesh=newEvent&amp;&amp;newEvent.target,dataIndex=mesh&amp;&amp;mesh.dataIndex,seriesIndex=mesh&amp;&amp;mesh.seriesIndex,eventData=mesh&amp;&amp;mesh.eventData,elChangedInMouseMove=!1,eventProxy=this._zrEventProxy;eventProxy.x=originalEvent.offsetX,eventProxy.y=originalEvent.offsetY,eventProxy.update();var targetInfo={target:eventProxy};const ecData=getECData(eventProxy);"mousemove"===eveName&amp;&amp;(null!=dataIndex?dataIndex!==this._lastDataIndex&amp;&amp;(parseInt(this._lastDataIndex,10)&gt;=0&amp;&amp;(ecData.dataIndex=this._lastDataIndex,ecData.seriesIndex=this._lastSeriesIndex,this.zr.handler.dispatchToElement(targetInfo,"mouseout",originalEvent)),elChangedInMouseMove=!0):null!=eventData&amp;&amp;eventData!==this._lastEventData&amp;&amp;(null!=this._lastEventData&amp;&amp;(ecData.eventData=this._lastEventData,this.zr.handler.dispatchToElement(targetInfo,"mouseout",originalEvent)),elChangedInMouseMove=!0),this._lastEventData=eventData,this._lastDataIndex=dataIndex,this._lastSeriesIndex=seriesIndex),ecData.eventData=eventData,ecData.dataIndex=dataIndex,ecData.seriesIndex=seriesIndex,(null!=eventData||parseInt(dataIndex,10)&gt;=0&amp;&amp;parseInt(seriesIndex,10)&gt;=0)&amp;&amp;(this.zr.handler.dispatchToElement(targetInfo,eveName,originalEvent),elChangedInMouseMove&amp;&amp;this.zr.handler.dispatchToElement(targetInfo,"mouseover",originalEvent))},LayerGL.prototype._dispatchToView=function(eventName,e2){for(var i=0;i&lt;this.views.length;i++)this.views[i].containPoint(e2.offsetX,e2.offsetY)&amp;&amp;this.views[i].trigger(eventName,e2)},Object.assign(LayerGL.prototype,notifier);var GL_SERIES=["bar3D","line3D","map3D","scatter3D","surface","lines3D","scatterGL","scatter3D"];function convertNormalEmphasis(option,optType){if(option&amp;&amp;option[optType]&amp;&amp;(option[optType].normal||option[optType].emphasis)){var normalOpt=option[optType].normal,emphasisOpt=option[optType].emphasis;normalOpt&amp;&amp;(option[optType]=normalOpt),emphasisOpt&amp;&amp;(option.emphasis=option.emphasis||{},option.emphasis[optType]=emphasisOpt)}}function removeTextStyleInAxis(axesOpt){axesOpt&amp;&amp;(axesOpt instanceof Array||(axesOpt=[axesOpt]),each(axesOpt,function(axisOpt){if(axisOpt.axisLabel){var labelOpt=axisOpt.axisLabel;Object.assign(labelOpt,labelOpt.textStyle),labelOpt.textStyle=null}}))}function EChartsGL(zr){this._layers={},this._zr=zr}EChartsGL.prototype.update=function(ecModel,api){var self2=this,zr=api.getZr();if(zr.getWidth()&amp;&amp;zr.getHeight()){for(var zlevel in this._layers)this._layers[zlevel].removeViewsAll();ecModel.eachComponent(function(componentType,componentModel){if("series"!==componentType){var view=api.getViewOfComponentModel(componentModel),coordSys=componentModel.coordinateSystem;if(view.__ecgl__){if(coordSys){if(!coordSys.viewGL)return void console.error("Can't find viewGL in coordinateSystem of component "+componentModel.id);viewGL=coordSys.viewGL}else{if(!componentModel.viewGL)return void console.error("Can't find viewGL of component "+componentModel.id);viewGL=coordSys.viewGL}var viewGL=coordSys.viewGL,layerGL=getLayerGL(componentModel);layerGL.addView(viewGL),view.afterRender&amp;&amp;view.afterRender(componentModel,ecModel,api,layerGL),setSilent(view.groupGL,componentModel.get("silent"))}}}),ecModel.eachSeries(function(seriesModel){var chartView=api.getViewOfSeriesModel(seriesModel),coordSys=seriesModel.coordinateSystem;if(chartView.__ecgl__){if(coordSys&amp;&amp;!coordSys.viewGL&amp;&amp;!chartView.viewGL)return void console.error("Can't find viewGL of series "+chartView.id);var viewGL=coordSys&amp;&amp;coordSys.viewGL||chartView.viewGL,layerGL=getLayerGL(seriesModel);layerGL.addView(viewGL),chartView.afterRender&amp;&amp;chartView.afterRender(seriesModel,ecModel,api,layerGL),setSilent(chartView.groupGL,seriesModel.get("silent"))}})}else console.warn("Dom has no width or height");function getLayerGL(model){var zlevel2;zr.setSleepAfterStill(0),zlevel2=(model.coordinateSystem&amp;&amp;model.coordinateSystem.model,model.get("zlevel"));var layers=self2._layers,layerGL=layers[zlevel2];if(!layerGL){if(layerGL=layers[zlevel2]=new LayerGL("gl-"+zlevel2,zr),zr.painter.isSingleCanvas()){layerGL.virtual=!0;var img=new ZRImage({z:1e4,style:{image:layerGL.renderer.canvas},silent:!0});layerGL.__hostImage=img,zr.add(img)}zr.painter.insertLayer(zlevel2,layerGL)}return layerGL.__hostImage&amp;&amp;layerGL.__hostImage.setStyle({width:layerGL.renderer.getWidth(),height:layerGL.renderer.getHeight()}),layerGL}function setSilent(groupGL,silent){groupGL&amp;&amp;groupGL.traverse(function(mesh){mesh.isRenderable&amp;&amp;mesh.isRenderable()&amp;&amp;(mesh.ignorePicking=null!=mesh.$ignorePicking?mesh.$ignorePicking:silent)})}},registerPostInit(function(chart){var zr=chart.getZr(),oldDispose=zr.painter.dispose;zr.painter.dispose=function(){"function"==typeof this.eachOtherLayer&amp;&amp;this.eachOtherLayer(function(layer){layer instanceof LayerGL&amp;&amp;layer.dispose()}),oldDispose.call(this)},zr.painter.getRenderedCanvas=function(opts){if(opts=opts||{},this._singleCanvas)return this._layers[0].dom;var canvas=document.createElement("canvas"),dpr=opts.pixelRatio||this.dpr;canvas.width=this.getWidth()*dpr,canvas.height=this.getHeight()*dpr;var ctx=canvas.getContext("2d");ctx.dpr=dpr,ctx.clearRect(0,0,canvas.width,canvas.height),opts.backgroundColor&amp;&amp;(ctx.fillStyle=opts.backgroundColor,ctx.fillRect(0,0,canvas.width,canvas.height));var zlevel,displayList=this.storage.getDisplayList(!0),scope={},self2=this;function findAndDrawOtherLayer(smaller,larger){var intermediateLayer,zlevelList=self2._zlevelList;null==smaller&amp;&amp;(smaller=-1/0);for(var i2=0;i2&lt;zlevelList.length;i2++){var z=zlevelList[i2],layer2=self2._layers[z];if(!layer2.__builtin__&amp;&amp;z&gt;smaller&amp;&amp;z&lt;larger){intermediateLayer=layer2;break}}intermediateLayer&amp;&amp;intermediateLayer.renderToCanvas&amp;&amp;(ctx.save(),intermediateLayer.renderToCanvas(ctx),ctx.restore())}for(var layer={ctx:ctx},i=0;i&lt;displayList.length;i++){var el=displayList[i];el.zlevel!==zlevel&amp;&amp;(findAndDrawOtherLayer(zlevel,el.zlevel),zlevel=el.zlevel),this._doPaintEl(el,layer,!0,null,scope)}return findAndDrawOtherLayer(zlevel,1/0),canvas}}),registerPostUpdate(function(ecModel,api){var zr=api.getZr();(zr.__egl=zr.__egl||new EChartsGL(zr)).update(ecModel,api)}),registerPreprocessor(function backwardCompat(option){each(option.series,function(series){indexOf(GL_SERIES,series.type)&gt;=0&amp;&amp;(!function convertNormalEmphasisForEach(option){convertNormalEmphasis(option,"itemStyle"),convertNormalEmphasis(option,"lineStyle"),convertNormalEmphasis(option,"areaStyle"),convertNormalEmphasis(option,"label")}(series),"mapbox"===series.coordinateSystem&amp;&amp;(series.coordinateSystem="mapbox3D",option.mapbox3D=option.mapbox))}),removeTextStyleInAxis(option.xAxis3D),removeTextStyleInAxis(option.yAxis3D),removeTextStyleInAxis(option.zAxis3D),removeTextStyleInAxis(option.grid3D),convertNormalEmphasis(option.geo3D)});const componentViewControlMixin={defaultOption:{viewControl:{projection:"perspective",autoRotate:!1,autoRotateDirection:"cw",autoRotateSpeed:10,autoRotateAfterStill:3,damping:.8,rotateSensitivity:1,zoomSensitivity:1,panSensitivity:1,panMouseButton:"middle",rotateMouseButton:"left",distance:150,minDistance:40,maxDistance:400,orthographicSize:150,maxOrthographicSize:400,minOrthographicSize:20,center:[0,0,0],alpha:0,beta:0,minAlpha:-90,maxAlpha:90}},setView:function(opts){opts=opts||{},this.option.viewControl=this.option.viewControl||{},null!=opts.alpha&amp;&amp;(this.option.viewControl.alpha=opts.alpha),null!=opts.beta&amp;&amp;(this.option.viewControl.beta=opts.beta),null!=opts.distance&amp;&amp;(this.option.viewControl.distance=opts.distance),null!=opts.center&amp;&amp;(this.option.viewControl.center=opts.center)}},componentPostEffectMixin={defaultOption:{postEffect:{enable:!1,bloom:{enable:!0,intensity:.1},depthOfField:{enable:!1,focalRange:20,focalDistance:50,blurRadius:10,fstop:2.8,quality:"medium"},screenSpaceAmbientOcclusion:{enable:!1,radius:2,quality:"medium",intensity:1},screenSpaceReflection:{enable:!1,quality:"medium",maxRoughness:.8},colorCorrection:{enable:!0,exposure:0,brightness:0,contrast:1,saturation:1,lookupTexture:""},edge:{enable:!1},FXAA:{enable:!1}},temporalSuperSampling:{enable:"auto"}}},componentLightMixin={defaultOption:{light:{main:{shadow:!1,shadowQuality:"high",color:"#fff",intensity:1,alpha:0,beta:0},ambient:{color:"#fff",intensity:.2},ambientCubemap:{texture:null,exposure:1,diffuseIntensity:.5,specularIntensity:.5}}}};var Grid3DModel=ComponentModel.extend({type:"grid3D",dependencies:["xAxis3D","yAxis3D","zAxis3D"],defaultOption:{show:!0,zlevel:-10,left:0,top:0,width:"100%",height:"100%",environment:"auto",boxWidth:100,boxHeight:100,boxDepth:100,axisPointer:{show:!0,lineStyle:{color:"rgba(0, 0, 0, 0.8)",width:1},label:{show:!0,formatter:null,margin:8,textStyle:{fontSize:14,color:"#fff",backgroundColor:"rgba(0,0,0,0.5)",padding:3,borderRadius:3}}},axisLine:{show:!0,lineStyle:{color:"#333",width:2,type:"solid"}},axisTick:{show:!0,inside:!1,length:3,lineStyle:{width:1}},axisLabel:{show:!0,inside:!1,rotate:0,margin:8,textStyle:{fontSize:12}},splitLine:{show:!0,lineStyle:{color:["#ccc"],width:1,type:"solid"}},splitArea:{show:!1,areaStyle:{color:["rgba(250,250,250,0.3)","rgba(200,200,200,0.3)"]}},light:{main:{alpha:30,beta:40},ambient:{intensity:.4}},viewControl:{alpha:20,beta:40,autoRotate:!1,distance:200,minDistance:40,maxDistance:400}}});merge(Grid3DModel.prototype,componentViewControlMixin),merge(Grid3DModel.prototype,componentPostEffectMixin),merge(Grid3DModel.prototype,componentLightMixin);var firstNotNull$3=retrieve_firstNotNull,MOUSE_BUTTON_KEY_MAP={left:0,middle:1,right:2};function convertToArray(val){return val instanceof Array||(val=[val,val]),val}var OrbitControl=Base.extend(function(){return{zr:null,viewGL:null,_center:new Vector3,minDistance:.5,maxDistance:1.5,maxOrthographicSize:300,minOrthographicSize:30,minAlpha:-90,maxAlpha:90,minBeta:-1/0,maxBeta:1/0,autoRotateAfterStill:0,autoRotateDirection:"cw",autoRotateSpeed:60,damping:.8,rotateSensitivity:1,zoomSensitivity:1,panSensitivity:1,panMouseButton:"middle",rotateMouseButton:"left",_mode:"rotate",_camera:null,_needsUpdate:!1,_rotating:!1,_phi:0,_theta:0,_mouseX:0,_mouseY:0,_rotateVelocity:new Vector2,_panVelocity:new Vector2,_distance:500,_zoomSpeed:0,_stillTimeout:0,_animators:[]}},function(){["_mouseDownHandler","_mouseWheelHandler","_mouseMoveHandler","_mouseUpHandler","_pinchHandler","_contextMenuHandler","_update"].forEach(function(hdlName){this[hdlName]=this[hdlName].bind(this)},this)},{init:function(){var zr=this.zr;zr&amp;&amp;(zr.on("mousedown",this._mouseDownHandler),zr.on("globalout",this._mouseUpHandler),zr.on("mousewheel",this._mouseWheelHandler),zr.on("pinch",this._pinchHandler),zr.animation.on("frame",this._update),zr.dom.addEventListener("contextmenu",this._contextMenuHandler))},dispose:function(){var zr=this.zr;zr&amp;&amp;(zr.off("mousedown",this._mouseDownHandler),zr.off("mousemove",this._mouseMoveHandler),zr.off("mouseup",this._mouseUpHandler),zr.off("mousewheel",this._mouseWheelHandler),zr.off("pinch",this._pinchHandler),zr.off("globalout",this._mouseUpHandler),zr.dom.removeEventListener("contextmenu",this._contextMenuHandler),zr.animation.off("frame",this._update)),this.stopAllAnimation()},getDistance:function(){return this._distance},setDistance:function(distance){this._distance=distance,this._needsUpdate=!0},getOrthographicSize:function(){return this._orthoSize},setOrthographicSize:function(size){this._orthoSize=size,this._needsUpdate=!0},getAlpha:function(){return this._theta/Math.PI*180},getBeta:function(){return-this._phi/Math.PI*180},getCenter:function(){return this._center.toArray()},setAlpha:function(alpha2){alpha2=Math.max(Math.min(this.maxAlpha,alpha2),this.minAlpha),this._theta=alpha2/180*Math.PI,this._needsUpdate=!0},setBeta:function(beta){beta=Math.max(Math.min(this.maxBeta,beta),this.minBeta),this._phi=-beta/180*Math.PI,this._needsUpdate=!0},setCenter:function(centerArr){this._center.setArray(centerArr)},setViewGL:function(viewGL){this.viewGL=viewGL},getCamera:function(){return this.viewGL.camera},setFromViewControlModel:function(viewControlModel,extraOpts){var baseDistance=(extraOpts=extraOpts||{}).baseDistance||0,baseOrthoSize=extraOpts.baseOrthoSize||1,projection=viewControlModel.get("projection");"perspective"!==projection&amp;&amp;"orthographic"!==projection&amp;&amp;"isometric"!==projection&amp;&amp;(projection="perspective"),this._projection=projection,this.viewGL.setProjection(projection);var targetDistance=viewControlModel.get("distance")+baseDistance,targetOrthographicSize=viewControlModel.get("orthographicSize")+baseOrthoSize;[["damping",.8],["autoRotate",!1],["autoRotateAfterStill",3],["autoRotateDirection","cw"],["autoRotateSpeed",10],["minDistance",30],["maxDistance",400],["minOrthographicSize",30],["maxOrthographicSize",300],["minAlpha",-90],["maxAlpha",90],["minBeta",-1/0],["maxBeta",1/0],["rotateSensitivity",1],["zoomSensitivity",1],["panSensitivity",1],["panMouseButton","left"],["rotateMouseButton","middle"]].forEach(function(prop){this[prop[0]]=firstNotNull$3(viewControlModel.get(prop[0]),prop[1])},this),this.minDistance+=baseDistance,this.maxDistance+=baseDistance,this.minOrthographicSize+=baseOrthoSize,this.maxOrthographicSize+=baseOrthoSize;var ecModel=viewControlModel.ecModel,animationOpts={};["animation","animationDurationUpdate","animationEasingUpdate"].forEach(function(key){animationOpts[key]=firstNotNull$3(viewControlModel.get(key),ecModel&amp;&amp;ecModel.get(key))});var alpha2=firstNotNull$3(extraOpts.alpha,viewControlModel.get("alpha"))||0,beta=firstNotNull$3(extraOpts.beta,viewControlModel.get("beta"))||0,center=firstNotNull$3(extraOpts.center,viewControlModel.get("center"))||[0,0,0];animationOpts.animation&amp;&amp;animationOpts.animationDurationUpdate&gt;0&amp;&amp;this._notFirst?this.animateTo({alpha:alpha2,beta:beta,center:center,distance:targetDistance,orthographicSize:targetOrthographicSize,easing:animationOpts.animationEasingUpdate,duration:animationOpts.animationDurationUpdate}):(this.setDistance(targetDistance),this.setAlpha(alpha2),this.setBeta(beta),this.setCenter(center),this.setOrthographicSize(targetOrthographicSize)),this._notFirst=!0,this._validateProperties()},_validateProperties:function(){},animateTo:function(opts){var zr=this.zr,self2=this,obj={},target={};return null!=opts.distance&amp;&amp;(obj.distance=this.getDistance(),target.distance=opts.distance),null!=opts.orthographicSize&amp;&amp;(obj.orthographicSize=this.getOrthographicSize(),target.orthographicSize=opts.orthographicSize),null!=opts.alpha&amp;&amp;(obj.alpha=this.getAlpha(),target.alpha=opts.alpha),null!=opts.beta&amp;&amp;(obj.beta=this.getBeta(),target.beta=opts.beta),null!=opts.center&amp;&amp;(obj.center=this.getCenter(),target.center=opts.center),this._addAnimator(zr.animation.animate(obj).when(opts.duration||1e3,target).during(function(){null!=obj.alpha&amp;&amp;self2.setAlpha(obj.alpha),null!=obj.beta&amp;&amp;self2.setBeta(obj.beta),null!=obj.distance&amp;&amp;self2.setDistance(obj.distance),null!=obj.center&amp;&amp;self2.setCenter(obj.center),null!=obj.orthographicSize&amp;&amp;self2.setOrthographicSize(obj.orthographicSize),self2._needsUpdate=!0})).start(opts.easing||"linear")},stopAllAnimation:function(){for(var i=0;i&lt;this._animators.length;i++)this._animators[i].stop();this._animators.length=0},update:function(){this._needsUpdate=!0,this._update(20)},_isAnimating:function(){return this._animators.length&gt;0},_update:function(deltaTime){if(this._rotating){var radian=("cw"===this.autoRotateDirection?1:-1)*this.autoRotateSpeed/180*Math.PI;this._phi-=radian*deltaTime/1e3,this._needsUpdate=!0}else this._rotateVelocity.len()&gt;0&amp;&amp;(this._needsUpdate=!0);(Math.abs(this._zoomSpeed)&gt;.1||this._panVelocity.len()&gt;0)&amp;&amp;(this._needsUpdate=!0),this._needsUpdate&amp;&amp;(deltaTime=Math.min(deltaTime,50),this._updateDistanceOrSize(deltaTime),this._updatePan(deltaTime),this._updateRotate(deltaTime),this._updateTransform(),this.getCamera().update(),this.zr&amp;&amp;this.zr.refresh(),this.trigger("update"),this._needsUpdate=!1)},_updateRotate:function(deltaTime){var velocity=this._rotateVelocity;this._phi=velocity.y*deltaTime/20+this._phi,this._theta=velocity.x*deltaTime/20+this._theta,this.setAlpha(this.getAlpha()),this.setBeta(this.getBeta()),this._vectorDamping(velocity,Math.pow(this.damping,deltaTime/16))},_updateDistanceOrSize:function(deltaTime){"perspective"===this._projection?this._setDistance(this._distance+this._zoomSpeed*deltaTime/20):this._setOrthoSize(this._orthoSize+this._zoomSpeed*deltaTime/20),this._zoomSpeed*=Math.pow(this.damping,deltaTime/16)},_setDistance:function(distance){this._distance=Math.max(Math.min(distance,this.maxDistance),this.minDistance)},_setOrthoSize:function(size){this._orthoSize=Math.max(Math.min(size,this.maxOrthographicSize),this.minOrthographicSize);var camera=this.getCamera(),cameraHeight=this._orthoSize,cameraWidth=cameraHeight/this.viewGL.viewport.height*this.viewGL.viewport.width;camera.left=-cameraWidth/2,camera.right=cameraWidth/2,camera.top=cameraHeight/2,camera.bottom=-cameraHeight/2},_updatePan:function(deltaTime){var velocity=this._panVelocity,len=this._distance,target=this.getCamera(),yAxis=target.worldTransform.y,xAxis=target.worldTransform.x;this._center.scaleAndAdd(xAxis,-velocity.x*len/200).scaleAndAdd(yAxis,-velocity.y*len/200),this._vectorDamping(velocity,0)},_updateTransform:function(){var camera=this.getCamera(),dir=new Vector3,theta=this._theta+Math.PI/2,phi=this._phi+Math.PI/2,r=Math.sin(theta);dir.x=r*Math.cos(phi),dir.y=-Math.cos(theta),dir.z=r*Math.sin(phi),camera.position.copy(this._center).scaleAndAdd(dir,this._distance),camera.rotation.identity().rotateY(-this._phi).rotateX(-this._theta)},_startCountingStill:function(){clearTimeout(this._stillTimeout);var time=this.autoRotateAfterStill,self2=this;!isNaN(time)&amp;&amp;time&gt;0&amp;&amp;(this._stillTimeout=setTimeout(function(){self2._rotating=!0},1e3*time))},_vectorDamping:function(v,damping){var speed=v.len();(speed*=damping)&lt;1e-4&amp;&amp;(speed=0),v.normalize().scale(speed)},_decomposeTransform:function(){if(this.getCamera()){this.getCamera().updateWorldTransform();var forward=this.getCamera().worldTransform.z,alpha2=Math.asin(forward.y),beta=Math.atan2(forward.x,forward.z);this._theta=alpha2,this._phi=-beta,this.setBeta(this.getBeta()),this.setAlpha(this.getAlpha()),this.getCamera().aspect?this._setDistance(this.getCamera().position.dist(this._center)):this._setOrthoSize(this.getCamera().top-this.getCamera().bottom)}},_mouseDownHandler:function(e2){if(!e2.target&amp;&amp;!this._isAnimating()){var x=e2.offsetX,y=e2.offsetY;this.viewGL&amp;&amp;!this.viewGL.containPoint(x,y)||(this.zr.on("mousemove",this._mouseMoveHandler),this.zr.on("mouseup",this._mouseUpHandler),e2.event.targetTouches?1===e2.event.targetTouches.length&amp;&amp;(this._mode="rotate"):e2.event.button===MOUSE_BUTTON_KEY_MAP[this.rotateMouseButton]?this._mode="rotate":e2.event.button===MOUSE_BUTTON_KEY_MAP[this.panMouseButton]?this._mode="pan":this._mode="",this._rotateVelocity.set(0,0),this._rotating=!1,this.autoRotate&amp;&amp;this._startCountingStill(),this._mouseX=e2.offsetX,this._mouseY=e2.offsetY)}},_mouseMoveHandler:function(e2){if(!(e2.target&amp;&amp;e2.target.__isGLToZRProxy||this._isAnimating())){var panSensitivity=convertToArray(this.panSensitivity),rotateSensitivity=convertToArray(this.rotateSensitivity);"rotate"===this._mode?(this._rotateVelocity.y=(e2.offsetX-this._mouseX)/this.zr.getHeight()*2*rotateSensitivity[0],this._rotateVelocity.x=(e2.offsetY-this._mouseY)/this.zr.getWidth()*2*rotateSensitivity[1]):"pan"===this._mode&amp;&amp;(this._panVelocity.x=(e2.offsetX-this._mouseX)/this.zr.getWidth()*panSensitivity[0]*400,this._panVelocity.y=(-e2.offsetY+this._mouseY)/this.zr.getHeight()*panSensitivity[1]*400),this._mouseX=e2.offsetX,this._mouseY=e2.offsetY,e2.event.preventDefault()}},_mouseWheelHandler:function(e2){if(!this._isAnimating()){var delta=e2.event.wheelDelta||-e2.event.detail;this._zoomHandler(e2,delta)}},_pinchHandler:function(e2){this._isAnimating()||(this._zoomHandler(e2,e2.pinchScale&gt;1?1:-1),this._mode="")},_zoomHandler:function(e2,delta){if(0!==delta){var speed,x=e2.offsetX,y=e2.offsetY;if(!this.viewGL||this.viewGL.containPoint(x,y))speed="perspective"===this._projection?Math.max(Math.max(Math.min(this._distance-this.minDistance,this.maxDistance-this._distance))/20,.5):Math.max(Math.max(Math.min(this._orthoSize-this.minOrthographicSize,this.maxOrthographicSize-this._orthoSize))/20,.5),this._zoomSpeed=(delta&gt;0?-1:1)*speed*this.zoomSensitivity,this._rotating=!1,this.autoRotate&amp;&amp;"rotate"===this._mode&amp;&amp;this._startCountingStill(),e2.event.preventDefault()}},_mouseUpHandler:function(){this.zr.off("mousemove",this._mouseMoveHandler),this.zr.off("mouseup",this._mouseUpHandler)},_isRightMouseButtonUsed:function(){return"right"===this.rotateMouseButton||"right"===this.panMouseButton},_contextMenuHandler:function(e2){this._isRightMouseButtonUsed()&amp;&amp;e2.preventDefault()},_addAnimator:function(animator){var animators=this._animators;return animators.push(animator),animator.done(function(){var idx=animators.indexOf(animator);idx&gt;=0&amp;&amp;animators.splice(idx,1)}),animator}});Object.defineProperty(OrbitControl.prototype,"autoRotate",{get:function(val){return this._autoRotate},set:function(val){this._autoRotate=val,this._rotating=val}});const dynamicConvertMixin={convertToDynamicArray:function(clear){clear&amp;&amp;this.resetOffset();var attributes=this.attributes;for(var name in attributes)clear||!attributes[name].value?attributes[name].value=[]:attributes[name].value=Array.prototype.slice.call(attributes[name].value);clear||!this.indices?this.indices=[]:this.indices=Array.prototype.slice.call(this.indices)},convertToTypedArray:function(){var attributes=this.attributes;for(var name in attributes)attributes[name].value&amp;&amp;attributes[name].value.length&gt;0?attributes[name].value=new Float32Array(attributes[name].value):attributes[name].value=null;this.indices&amp;&amp;this.indices.length&gt;0&amp;&amp;(this.indices=this.vertexCount&gt;65535?new Uint32Array(this.indices):new Uint16Array(this.indices)),this.dirty()}};var vec3$e=glmatrix.vec3,sampleLinePoints$1=[[0,0],[1,1]],LinesGeometry$2=Geometry.extend(function(){return{segmentScale:1,dynamic:!0,useNativeLine:!0,attributes:{position:new Geometry.Attribute("position","float",3,"POSITION"),positionPrev:new Geometry.Attribute("positionPrev","float",3),positionNext:new Geometry.Attribute("positionNext","float",3),prevPositionPrev:new Geometry.Attribute("prevPositionPrev","float",3),prevPosition:new Geometry.Attribute("prevPosition","float",3),prevPositionNext:new Geometry.Attribute("prevPositionNext","float",3),offset:new Geometry.Attribute("offset","float",1),color:new Geometry.Attribute("color","float",4,"COLOR")}}},{resetOffset:function(){this._vertexOffset=0,this._triangleOffset=0,this._itemVertexOffsets=[]},setVertexCount:function(nVertex){var attributes=this.attributes;this.vertexCount!==nVertex&amp;&amp;(attributes.position.init(nVertex),attributes.color.init(nVertex),this.useNativeLine||(attributes.positionPrev.init(nVertex),attributes.positionNext.init(nVertex),attributes.offset.init(nVertex)),nVertex&gt;65535?this.indices instanceof Uint16Array&amp;&amp;(this.indices=new Uint32Array(this.indices)):this.indices instanceof Uint32Array&amp;&amp;(this.indices=new Uint16Array(this.indices)))},setTriangleCount:function(nTriangle){this.triangleCount!==nTriangle&amp;&amp;(this.indices=0===nTriangle?null:this.vertexCount&gt;65535?new Uint32Array(3*nTriangle):new Uint16Array(3*nTriangle))},_getCubicCurveApproxStep:function(p02,p12,p22,p3){return 1/(vec3$e.dist(p02,p12)+vec3$e.dist(p22,p12)+vec3$e.dist(p3,p22)+1)*this.segmentScale},getCubicCurveVertexCount:function(p02,p12,p22,p3){var step=this._getCubicCurveApproxStep(p02,p12,p22,p3),segCount=Math.ceil(1/step);return this.useNativeLine?2*segCount:2*segCount+2},getCubicCurveTriangleCount:function(p02,p12,p22,p3){var step=this._getCubicCurveApproxStep(p02,p12,p22,p3),segCount=Math.ceil(1/step);return this.useNativeLine?0:2*segCount},getLineVertexCount:function(){return this.getPolylineVertexCount(sampleLinePoints$1)},getLineTriangleCount:function(){return this.getPolylineTriangleCount(sampleLinePoints$1)},getPolylineVertexCount:function(points){var pointsLen;"number"==typeof points?pointsLen=points:pointsLen="number"!=typeof points[0]?points.length:points.length/3;return this.useNativeLine?2*(pointsLen-1):2*(pointsLen-1)+2},getPolylineTriangleCount:function(points){var pointsLen;"number"==typeof points?pointsLen=points:pointsLen="number"!=typeof points[0]?points.length:points.length/3;return this.useNativeLine?0:2*Math.max(pointsLen-1,0)},addCubicCurve:function(p02,p12,p22,p3,color,lineWidth){null==lineWidth&amp;&amp;(lineWidth=1);var x0=p02[0],y0=p02[1],z0=p02[2],x1=p12[0],y1=p12[1],z1=p12[2],x2=p22[0],y2=p22[1],z2=p22[2],x3=p3[0],y3=p3[1],z3=p3[2],step=this._getCubicCurveApproxStep(p02,p12,p22,p3),step2=step*step,step3=step2*step,pre1=3*step,pre2=3*step2,pre4=6*step2,pre5=6*step3,tmp1x=x0-2*x1+x2,tmp1y=y0-2*y1+y2,tmp1z=z0-2*z1+z2,tmp2x=3*(x1-x2)-x0+x3,tmp2y=3*(y1-y2)-y0+y3,tmp2z=3*(z1-z2)-z0+z3,fx=x0,fy=y0,fz=z0,dfx=(x1-x0)*pre1+tmp1x*pre2+tmp2x*step3,dfy=(y1-y0)*pre1+tmp1y*pre2+tmp2y*step3,dfz=(z1-z0)*pre1+tmp1z*pre2+tmp2z*step3,ddfx=tmp1x*pre4+tmp2x*pre5,ddfy=tmp1y*pre4+tmp2y*pre5,ddfz=tmp1z*pre4+tmp2z*pre5,dddfx=tmp2x*pre5,dddfy=tmp2y*pre5,dddfz=tmp2z*pre5,t=0,k=0,segCount=Math.ceil(1/step),points=new Float32Array(3*(segCount+1)),offset=(points=[],0);for(k=0;k&lt;segCount+1;k++)points[offset++]=fx,points[offset++]=fy,points[offset++]=fz,fx+=dfx,fy+=dfy,fz+=dfz,dfx+=ddfx,dfy+=ddfy,dfz+=ddfz,ddfx+=dddfx,ddfy+=dddfy,ddfz+=dddfz,(t+=step)&gt;1&amp;&amp;(fx=dfx&gt;0?Math.min(fx,x3):Math.max(fx,x3),fy=dfy&gt;0?Math.min(fy,y3):Math.max(fy,y3),fz=dfz&gt;0?Math.min(fz,z3):Math.max(fz,z3));return this.addPolyline(points,color,lineWidth)},addLine:function(p02,p12,color,lineWidth){return this.addPolyline([p02,p12],color,lineWidth)},addPolyline:function(points,color,lineWidth,startOffset,pointsCount){if(points.length){var is2DArray="number"!=typeof points[0];if(null==pointsCount&amp;&amp;(pointsCount=is2DArray?points.length:points.length/3),!(pointsCount&lt;2)){null==startOffset&amp;&amp;(startOffset=0),null==lineWidth&amp;&amp;(lineWidth=1),this._itemVertexOffsets.push(this._vertexOffset);var point,pointColor,notSharingColor=(is2DArray="number"!=typeof points[0])?"number"!=typeof color[0]:color.length/4===pointsCount,positionAttr=this.attributes.position,positionPrevAttr=this.attributes.positionPrev,positionNextAttr=this.attributes.positionNext,colorAttr=this.attributes.color,offsetAttr=this.attributes.offset,indices=this.indices,vertexOffset=this._vertexOffset;lineWidth=Math.max(lineWidth,.01);for(var k=startOffset;k&lt;pointsCount;k++){if(is2DArray)point=points[k],pointColor=notSharingColor?color[k]:color;else{var k3=3*k;if((point=point||[])[0]=points[k3],point[1]=points[k3+1],point[2]=points[k3+2],notSharingColor){var k4=4*k;(pointColor=pointColor||[])[0]=color[k4],pointColor[1]=color[k4+1],pointColor[2]=color[k4+2],pointColor[3]=color[k4+3]}else pointColor=color}if(this.useNativeLine?k&gt;1&amp;&amp;(positionAttr.copy(vertexOffset,vertexOffset-1),colorAttr.copy(vertexOffset,vertexOffset-1),vertexOffset++):(k&lt;pointsCount-1&amp;&amp;(positionPrevAttr.set(vertexOffset+2,point),positionPrevAttr.set(vertexOffset+3,point)),k&gt;0&amp;&amp;(positionNextAttr.set(vertexOffset-2,point),positionNextAttr.set(vertexOffset-1,point)),positionAttr.set(vertexOffset,point),positionAttr.set(vertexOffset+1,point),colorAttr.set(vertexOffset,pointColor),colorAttr.set(vertexOffset+1,pointColor),offsetAttr.set(vertexOffset,lineWidth/2),offsetAttr.set(vertexOffset+1,-lineWidth/2),vertexOffset+=2),this.useNativeLine)colorAttr.set(vertexOffset,pointColor),positionAttr.set(vertexOffset,point),vertexOffset++;else if(k&gt;0){var idx3=3*this._triangleOffset;(indices=this.indices)[idx3]=vertexOffset-4,indices[idx3+1]=vertexOffset-3,indices[idx3+2]=vertexOffset-2,indices[idx3+3]=vertexOffset-3,indices[idx3+4]=vertexOffset-1,indices[idx3+5]=vertexOffset-2,this._triangleOffset+=2}}if(!this.useNativeLine){var start=this._vertexOffset,end=this._vertexOffset+2*pointsCount;positionPrevAttr.copy(start,start+2),positionPrevAttr.copy(start+1,start+3),positionNextAttr.copy(end-1,end-3),positionNextAttr.copy(end-2,end-4)}return this._vertexOffset=vertexOffset,this._vertexOffset}}},setItemColor:function(idx,color){for(var startOffset=this._itemVertexOffsets[idx],endOffset=idx&lt;this._itemVertexOffsets.length-1?this._itemVertexOffsets[idx+1]:this._vertexOffset,i=startOffset;i&lt;endOffset;i++)this.attributes.color.set(i,color);this.dirty("color")},currentTriangleOffset:function(){return this._triangleOffset},currentVertexOffset:function(){return this._vertexOffset}});function ZRTextureAtlasSurfaceNode(zr,offsetX,offsetY,width,height,gap,dpr){this._zr=zr,this._x=0,this._y=0,this._rowHeight=0,this.width=width,this.height=height,this.offsetX=offsetX,this.offsetY=offsetY,this.dpr=dpr,this.gap=gap}function ZRTextureAtlasSurface(opt){(opt=opt||{}).width=opt.width||512,opt.height=opt.height||512,opt.devicePixelRatio=opt.devicePixelRatio||1,opt.gap=null==opt.gap?2:opt.gap;var canvas=document.createElement("canvas");canvas.width=opt.width*opt.devicePixelRatio,canvas.height=opt.height*opt.devicePixelRatio,this._canvas=canvas,this._texture=new Texture2D({image:canvas,flipY:!1});var self2=this;this._zr=init(canvas);var oldRefreshImmediately=this._zr.refreshImmediately;this._zr.refreshImmediately=function(){oldRefreshImmediately.call(this),self2._texture.dirty(),self2.onupdate&amp;&amp;self2.onupdate()},this._dpr=opt.devicePixelRatio,this._coords={},this.onupdate=opt.onupdate,this._gap=opt.gap,this._textureAtlasNodes=[new ZRTextureAtlasSurfaceNode(this._zr,0,0,opt.width,opt.height,this._gap,this._dpr)],this._nodeWidth=opt.width,this._nodeHeight=opt.height,this._currentNodeIdx=0}function SceneHelper(){}defaults(LinesGeometry$2.prototype,dynamicConvertMixin),ZRTextureAtlasSurfaceNode.prototype={constructor:ZRTextureAtlasSurfaceNode,clear:function(){this._x=0,this._y=0,this._rowHeight=0},add:function(el,width,height){var rect=el.getBoundingRect();null==width&amp;&amp;(width=rect.width),null==height&amp;&amp;(height=rect.height),width*=this.dpr,height*=this.dpr,this._fitElement(el,width,height);var x=this._x,y=this._y,canvasWidth=this.width*this.dpr,canvasHeight=this.height*this.dpr,gap=this.gap;if(x+width+gap&gt;canvasWidth&amp;&amp;(x=this._x=0,y+=this._rowHeight+gap,this._y=y,this._rowHeight=0),this._x+=width+gap,this._rowHeight=Math.max(this._rowHeight,height),y+height+gap&gt;canvasHeight)return null;el.x+=this.offsetX*this.dpr+x,el.y+=this.offsetY*this.dpr+y,this._zr.add(el);var coordsOffset=[this.offsetX/this.width,this.offsetY/this.height];return[[x/canvasWidth+coordsOffset[0],y/canvasHeight+coordsOffset[1]],[(x+width)/canvasWidth+coordsOffset[0],(y+height)/canvasHeight+coordsOffset[1]]]},_fitElement:function(el,spriteWidth,spriteHeight){var rect=el.getBoundingRect(),scaleX=spriteWidth/rect.width,scaleY=spriteHeight/rect.height;el.x=-rect.x*scaleX,el.y=-rect.y*scaleY,el.scaleX=scaleX,el.scaleY=scaleY,el.update()}},ZRTextureAtlasSurface.prototype={clear:function(){for(var i=0;i&lt;this._textureAtlasNodes.length;i++)this._textureAtlasNodes[i].clear();this._currentNodeIdx=0,this._zr.clear(),this._coords={}},getWidth:function(){return this._width},getHeight:function(){return this._height},getTexture:function(){return this._texture},getDevicePixelRatio:function(){return this._dpr},getZr:function(){return this._zr},_getCurrentNode:function(){return this._textureAtlasNodes[this._currentNodeIdx]},_expand:function(){if(this._currentNodeIdx++,this._textureAtlasNodes[this._currentNodeIdx])return this._textureAtlasNodes[this._currentNodeIdx];var maxSize=4096/this._dpr,nodeLen=this._textureAtlasNodes.length,offsetX=nodeLen*this._nodeWidth%maxSize,offsetY=Math.floor(nodeLen*this._nodeWidth/maxSize)*this._nodeHeight;if(!(offsetY&gt;=maxSize)){var width=(offsetX+this._nodeWidth)*this._dpr,height=(offsetY+this._nodeHeight)*this._dpr;try{this._zr.resize({width:width,height:height})}catch(e2){this._canvas.width=width,this._canvas.height=height}var newNode=new ZRTextureAtlasSurfaceNode(this._zr,offsetX,offsetY,this._nodeWidth,this._nodeHeight,this._gap,this._dpr);return this._textureAtlasNodes.push(newNode),newNode}},add:function(el,width,height){if(this._coords[el.id])return this._coords[el.id];var coords=this._getCurrentNode().add(el,width,height);if(!coords){var newNode=this._expand();if(!newNode)return;coords=newNode.add(el,width,height)}return this._coords[el.id]=coords,coords},getCoordsScale:function(){var dpr=this._dpr;return[this._nodeWidth/this._canvas.width*dpr,this._nodeHeight/this._canvas.height*dpr]},getCoords:function(id){return this._coords[id]},dispose:function(){this._zr.dispose()}},SceneHelper.prototype={constructor:SceneHelper,setScene:function(scene){this._scene=scene,this._skybox&amp;&amp;this._skybox.attachScene(this._scene)},initLight:function(rootNode){this._lightRoot=rootNode,this.mainLight=new graphicGL.DirectionalLight({shadowBias:.005}),this.ambientLight=new graphicGL.AmbientLight,rootNode.add(this.mainLight),rootNode.add(this.ambientLight)},dispose:function(){this._lightRoot&amp;&amp;(this._lightRoot.remove(this.mainLight),this._lightRoot.remove(this.ambientLight))},updateLight:function(componentModel){var mainLight=this.mainLight,ambientLight=this.ambientLight,lightModel=componentModel.getModel("light"),mainLightModel=lightModel.getModel("main"),ambientLightModel=lightModel.getModel("ambient");mainLight.intensity=mainLightModel.get("intensity"),ambientLight.intensity=ambientLightModel.get("intensity"),mainLight.color=graphicGL.parseColor(mainLightModel.get("color")).slice(0,3),ambientLight.color=graphicGL.parseColor(ambientLightModel.get("color")).slice(0,3);var alpha2=mainLightModel.get("alpha")||0,beta=mainLightModel.get("beta")||0;mainLight.position.setArray(graphicGL.directionFromAlphaBeta(alpha2,beta)),mainLight.lookAt(graphicGL.Vector3.ZERO),mainLight.castShadow=mainLightModel.get("shadow"),mainLight.shadowResolution=graphicGL.getShadowResolution(mainLightModel.get("shadowQuality"))},updateAmbientCubemap:function(renderer,componentModel,api){var ambientCubemapModel=componentModel.getModel("light.ambientCubemap"),textureUrl=ambientCubemapModel.get("texture");if(textureUrl){this._cubemapLightsCache=this._cubemapLightsCache||{};var lights=this._cubemapLightsCache[textureUrl];if(!lights){var self2=this;lights=this._cubemapLightsCache[textureUrl]=graphicGL.createAmbientCubemap(ambientCubemapModel.option,renderer,api,function(){self2._isSkyboxFromAmbientCubemap&amp;&amp;self2._skybox.setEnvironmentMap(lights.specular.cubemap),api.getZr().refresh()})}this._lightRoot.add(lights.diffuse),this._lightRoot.add(lights.specular),this._currentCubemapLights=lights}else this._currentCubemapLights&amp;&amp;(this._lightRoot.remove(this._currentCubemapLights.diffuse),this._lightRoot.remove(this._currentCubemapLights.specular),this._currentCubemapLights=null)},updateSkybox:function(renderer,componentModel,api){var environmentUrl=componentModel.get("environment"),self2=this;var skybox=function getSkybox(){return self2._skybox=self2._skybox||new Skybox,self2._skybox}();if(environmentUrl&amp;&amp;"none"!==environmentUrl)if("auto"===environmentUrl)if(this._isSkyboxFromAmbientCubemap=!0,this._currentCubemapLights){var cubemap=this._currentCubemapLights.specular.cubemap;skybox.setEnvironmentMap(cubemap),this._scene&amp;&amp;skybox.attachScene(this._scene),skybox.material.set("lod",3)}else this._skybox&amp;&amp;this._skybox.detachScene();else if("object"==typeof environmentUrl&amp;&amp;environmentUrl.colorStops||"string"==typeof environmentUrl&amp;&amp;parse(environmentUrl)){this._isSkyboxFromAmbientCubemap=!1;var texture=new graphicGL.Texture2D({anisotropic:8,flipY:!1});skybox.setEnvironmentMap(texture);var canvas=texture.image=document.createElement("canvas");canvas.width=canvas.height=16;var ctx=canvas.getContext("2d"),rect=new Rect({shape:{x:0,y:0,width:16,height:16},style:{fill:environmentUrl}});brushSingle(ctx,rect),skybox.attachScene(this._scene)}else{this._isSkyboxFromAmbientCubemap=!1;texture=graphicGL.loadTexture(environmentUrl,api,{anisotropic:8,flipY:!1});skybox.setEnvironmentMap(texture),skybox.attachScene(this._scene)}else this._skybox&amp;&amp;this._skybox.detachScene(this._scene),this._skybox=null;var coordSys=componentModel.coordinateSystem;if(this._skybox)if(!coordSys||!coordSys.viewGL||"auto"===environmentUrl||environmentUrl.match&amp;&amp;environmentUrl.match(/.hdr$/))this._skybox.material.undefine("fragment","SRGB_DECODE");else{var srgbDefineMethod=coordSys.viewGL.isLinearSpace()?"define":"undefine";this._skybox.material[srgbDefineMethod]("fragment","SRGB_DECODE")}}};var a,b,normal2,indices,vec3$d=glmatrix.vec3,QuadsGeometry=Geometry.extend(function(){return{segmentScale:1,useNativeLine:!0,attributes:{position:new Geometry.Attribute("position","float",3,"POSITION"),normal:new Geometry.Attribute("normal","float",3,"NORMAL"),color:new Geometry.Attribute("color","float",4,"COLOR")}}},{resetOffset:function(){this._vertexOffset=0,this._faceOffset=0},setQuadCount:function(nQuad){var attributes=this.attributes,vertexCount=this.getQuadVertexCount()*nQuad,triangleCount=this.getQuadTriangleCount()*nQuad;this.vertexCount!==vertexCount&amp;&amp;(attributes.position.init(vertexCount),attributes.normal.init(vertexCount),attributes.color.init(vertexCount)),this.triangleCount!==triangleCount&amp;&amp;(this.indices=vertexCount&gt;65535?new Uint32Array(3*triangleCount):new Uint16Array(3*triangleCount))},getQuadVertexCount:function(){return 4},getQuadTriangleCount:function(){return 2},addQuad:(a=vec3$d.create(),b=vec3$d.create(),normal2=vec3$d.create(),indices=[0,3,1,3,2,1],function(coords,color){var positionAttr=this.attributes.position,normalAttr=this.attributes.normal,colorAttr=this.attributes.color;vec3$d.sub(a,coords[1],coords[0]),vec3$d.sub(b,coords[2],coords[1]),vec3$d.cross(normal2,a,b),vec3$d.normalize(normal2,normal2);for(var i=0;i&lt;4;i++)positionAttr.set(this._vertexOffset+i,coords[i]),colorAttr.set(this._vertexOffset+i,color),normalAttr.set(this._vertexOffset+i,normal2);var idx=3*this._faceOffset;for(i=0;i&lt;6;i++)this.indices[idx+i]=indices[i]+this._vertexOffset;this._vertexOffset+=4,this._faceOffset+=2})});defaults(QuadsGeometry.prototype,dynamicConvertMixin);var firstNotNull$2=retrieve_firstNotNull,dimIndicesMap$2={x:0,y:2,z:1};function Grid3DFace(faceInfo,linesMaterial,quadsMaterial){this.rootNode=new graphicGL.Node;var linesMesh=new graphicGL.Mesh({geometry:new LinesGeometry$2({useNativeLine:!1}),material:linesMaterial,castShadow:!1,ignorePicking:!0,$ignorePicking:!0,renderOrder:1}),quadsMesh=new graphicGL.Mesh({geometry:new QuadsGeometry,material:quadsMaterial,castShadow:!1,culling:!1,ignorePicking:!0,$ignorePicking:!0,renderOrder:0});this.rootNode.add(quadsMesh),this.rootNode.add(linesMesh),this.faceInfo=faceInfo,this.plane=new graphicGL.Plane,this.linesMesh=linesMesh,this.quadsMesh=quadsMesh}Grid3DFace.prototype.update=function(grid3DModel,ecModel,api){var cartesian=grid3DModel.coordinateSystem,axes=[cartesian.getAxis(this.faceInfo[0]),cartesian.getAxis(this.faceInfo[1])],lineGeometry=this.linesMesh.geometry,quadsGeometry=this.quadsMesh.geometry;lineGeometry.convertToDynamicArray(!0),quadsGeometry.convertToDynamicArray(!0),this._updateSplitLines(lineGeometry,axes,grid3DModel,api),this._udpateSplitAreas(quadsGeometry,axes,grid3DModel,api),lineGeometry.convertToTypedArray(),quadsGeometry.convertToTypedArray();var otherAxis=cartesian.getAxis(this.faceInfo[2]);!function updateFacePlane(node,plane,otherAxis,dir){var coord=[0,0,0],distance=dir&lt;0?otherAxis.getExtentMin():otherAxis.getExtentMax();coord[dimIndicesMap$2[otherAxis.dim]]=distance,node.position.setArray(coord),node.rotation.identity(),plane.distance=-Math.abs(distance),plane.normal.set(0,0,0),"x"===otherAxis.dim?(node.rotation.rotateY(dir*Math.PI/2),plane.normal.x=-dir):"z"===otherAxis.dim?(node.rotation.rotateX(-dir*Math.PI/2),plane.normal.y=-dir):(dir&gt;0&amp;&amp;node.rotation.rotateY(Math.PI),plane.normal.z=-dir)}(this.rootNode,this.plane,otherAxis,this.faceInfo[3])},Grid3DFace.prototype._updateSplitLines=function(geometry,axes,grid3DModel,api){var dpr=api.getDevicePixelRatio();axes.forEach(function(axis,idx){var axisModel=axis.model,otherExtent=axes[1-idx].getExtent();if(!axis.scale.isBlank()){var splitLineModel=axisModel.getModel("splitLine",grid3DModel.getModel("splitLine"));if(splitLineModel.get("show")){var lineStyleModel=splitLineModel.getModel("lineStyle"),lineColors=lineStyleModel.get("color"),opacity=firstNotNull$2(lineStyleModel.get("opacity"),1),lineWidth=firstNotNull$2(lineStyleModel.get("width"),1);lineColors=isArray(lineColors)?lineColors:[lineColors];for(var ticksCoords=axis.getTicksCoords({tickModel:splitLineModel}),count=0,i=0;i&lt;ticksCoords.length;i++){var tickCoord=ticksCoords[i].coord,lineColor=graphicGL.parseColor(lineColors[count%lineColors.length]);lineColor[3]*=opacity;var p02=[0,0,0],p12=[0,0,0];p02[idx]=p12[idx]=tickCoord,p02[1-idx]=otherExtent[0],p12[1-idx]=otherExtent[1],geometry.addLine(p02,p12,lineColor,lineWidth*dpr),count++}}}})},Grid3DFace.prototype._udpateSplitAreas=function(geometry,axes,grid3DModel,api){axes.forEach(function(axis,idx){var axisModel=axis.model,otherExtent=axes[1-idx].getExtent();if(!axis.scale.isBlank()){var splitAreaModel=axisModel.getModel("splitArea",grid3DModel.getModel("splitArea"));if(splitAreaModel.get("show")){var areaStyleModel=splitAreaModel.getModel("areaStyle"),colors=areaStyleModel.get("color"),opacity=firstNotNull$2(areaStyleModel.get("opacity"),1);colors=isArray(colors)?colors:[colors];for(var ticksCoords=axis.getTicksCoords({tickModel:splitAreaModel,clamp:!0}),count=0,prevP0=[0,0,0],prevP1=[0,0,0],i=0;i&lt;ticksCoords.length;i++){var tickCoord=ticksCoords[i].coord,p02=[0,0,0],p12=[0,0,0];if(p02[idx]=p12[idx]=tickCoord,p02[1-idx]=otherExtent[0],p12[1-idx]=otherExtent[1],0!==i){var color=graphicGL.parseColor(colors[count%colors.length]);color[3]*=opacity,geometry.addQuad([prevP0,p02,p12,prevP1],color),prevP0=p02,prevP1=p12,count++}else prevP0=p02,prevP1=p12}}}})};var squareTriangles=[0,1,2,0,2,3],SpritesGeometry=Geometry.extend(function(){return{attributes:{position:new Geometry.Attribute("position","float",3,"POSITION"),texcoord:new Geometry.Attribute("texcoord","float",2,"TEXCOORD_0"),offset:new Geometry.Attribute("offset","float",2),color:new Geometry.Attribute("color","float",4,"COLOR")}}},{resetOffset:function(){this._vertexOffset=0,this._faceOffset=0},setSpriteCount:function(spriteCount){this._spriteCount=spriteCount;var vertexCount=4*spriteCount,triangleCount=2*spriteCount;this.vertexCount!==vertexCount&amp;&amp;(this.attributes.position.init(vertexCount),this.attributes.offset.init(vertexCount),this.attributes.color.init(vertexCount)),this.triangleCount!==triangleCount&amp;&amp;(this.indices=vertexCount&gt;65535?new Uint32Array(3*triangleCount):new Uint16Array(3*triangleCount))},setSpriteAlign:function(spriteOffset,size,align,verticalAlign,margin){var leftOffset,topOffset,rightOffset,bottomOffset;switch(null==align&amp;&amp;(align="left"),null==verticalAlign&amp;&amp;(verticalAlign="top"),margin=margin||0,align){case"left":leftOffset=margin,rightOffset=size[0]+margin;break;case"center":case"middle":leftOffset=-size[0]/2,rightOffset=size[0]/2;break;case"right":leftOffset=-size[0]-margin,rightOffset=-margin}switch(verticalAlign){case"bottom":topOffset=margin,bottomOffset=size[1]+margin;break;case"middle":topOffset=-size[1]/2,bottomOffset=size[1]/2;break;case"top":topOffset=-size[1]-margin,bottomOffset=-margin}var vertexOffset=4*spriteOffset,offsetAttr=this.attributes.offset;offsetAttr.set(vertexOffset,[leftOffset,bottomOffset]),offsetAttr.set(vertexOffset+1,[rightOffset,bottomOffset]),offsetAttr.set(vertexOffset+2,[rightOffset,topOffset]),offsetAttr.set(vertexOffset+3,[leftOffset,topOffset])},addSprite:function(position,size,coords,align,verticalAlign,screenMargin){var vertexOffset=this._vertexOffset;this.setSprite(this._vertexOffset/4,position,size,coords,align,verticalAlign,screenMargin);for(var i=0;i&lt;squareTriangles.length;i++)this.indices[3*this._faceOffset+i]=squareTriangles[i]+vertexOffset;return this._faceOffset+=2,this._vertexOffset+=4,vertexOffset/4},setSprite:function(spriteOffset,position,size,coords,align,verticalAlign,screenMargin){for(var vertexOffset=4*spriteOffset,attributes=this.attributes,i=0;i&lt;4;i++)attributes.position.set(vertexOffset+i,position);var texcoordAttr=attributes.texcoord;texcoordAttr.set(vertexOffset,[coords[0][0],coords[0][1]]),texcoordAttr.set(vertexOffset+1,[coords[1][0],coords[0][1]]),texcoordAttr.set(vertexOffset+2,[coords[1][0],coords[1][1]]),texcoordAttr.set(vertexOffset+3,[coords[0][0],coords[1][1]]),this.setSpriteAlign(spriteOffset,size,align,verticalAlign,screenMargin)}});defaults(SpritesGeometry.prototype,dynamicConvertMixin);graphicGL.Shader.import("@export ecgl.labels.vertex\n\nattribute vec3 position: POSITION;\nattribute vec2 texcoord: TEXCOORD_0;\nattribute vec2 offset;\n#ifdef VERTEX_COLOR\nattribute vec4 a_Color : COLOR;\nvarying vec4 v_Color;\n#endif\n\nuniform mat4 worldViewProjection : WORLDVIEWPROJECTION;\nuniform vec4 viewport : VIEWPORT;\n\nvarying vec2 v_Texcoord;\n\nvoid main()\n{\n vec4 proj = worldViewProjection * vec4(position, 1.0);\n\n vec2 screen = (proj.xy / abs(proj.w) + 1.0) * 0.5 * viewport.zw;\n\n screen += offset;\n\n proj.xy = (screen / viewport.zw - 0.5) * 2.0 * abs(proj.w);\n gl_Position = proj;\n#ifdef VERTEX_COLOR\n v_Color = a_Color;\n#endif\n v_Texcoord = texcoord;\n}\n@end\n\n\n@export ecgl.labels.fragment\n\nuniform vec3 color : [1.0, 1.0, 1.0];\nuniform float alpha : 1.0;\nuniform sampler2D textureAtlas;\nuniform vec2 uvScale: [1.0, 1.0];\n\n#ifdef VERTEX_COLOR\nvarying vec4 v_Color;\n#endif\nvarying float v_Miter;\n\nvarying vec2 v_Texcoord;\n\nvoid main()\n{\n gl_FragColor = vec4(color, alpha) * texture2D(textureAtlas, v_Texcoord * uvScale);\n#ifdef VERTEX_COLOR\n gl_FragColor *= v_Color;\n#endif\n}\n\n@end");const LabelsMesh=graphicGL.Mesh.extend(function(){return{geometry:new SpritesGeometry({dynamic:!0}),material:new graphicGL.Material({shader:graphicGL.createShader("ecgl.labels"),transparent:!0,depthMask:!1}),culling:!1,castShadow:!1,ignorePicking:!0}});var firstNotNull$1=retrieve_firstNotNull,dimIndicesMap$1={x:0,y:2,z:1};function Grid3DAxis(dim,linesMaterial){var linesMesh=new graphicGL.Mesh({geometry:new LinesGeometry$2({useNativeLine:!1}),material:linesMaterial,castShadow:!1,ignorePicking:!0,renderOrder:2}),axisLabelsMesh=new LabelsMesh;axisLabelsMesh.material.depthMask=!1;var rootNode=new graphicGL.Node;rootNode.add(linesMesh),rootNode.add(axisLabelsMesh),this.rootNode=rootNode,this.dim=dim,this.linesMesh=linesMesh,this.labelsMesh=axisLabelsMesh,this.axisLineCoords=null,this.labelElements=[]}var otherDim={x:"y",y:"x",z:"y"};Grid3DAxis.prototype.update=function(grid3DModel,axisLabelSurface,api){var axis=grid3DModel.coordinateSystem.getAxis(this.dim),linesGeo=this.linesMesh.geometry,labelsGeo=this.labelsMesh.geometry;linesGeo.convertToDynamicArray(!0),labelsGeo.convertToDynamicArray(!0);var axisModel=axis.model,extent=axis.getExtent(),dpr=api.getDevicePixelRatio(),axisLineModel=axisModel.getModel("axisLine",grid3DModel.getModel("axisLine")),axisTickModel=axisModel.getModel("axisTick",grid3DModel.getModel("axisTick")),axisLabelModel=axisModel.getModel("axisLabel",grid3DModel.getModel("axisLabel")),axisLineColor=axisLineModel.get("lineStyle.color");if(axisLineModel.get("show")){var axisLineStyleModel=axisLineModel.getModel("lineStyle"),p12=[0,0,0];(p02=[0,0,0])[idx=dimIndicesMap$1[axis.dim]]=extent[0],p12[idx]=extent[1],this.axisLineCoords=[p02,p12];var color=graphicGL.parseColor(axisLineColor),lineWidth=firstNotNull$1(axisLineStyleModel.get("width"),1),opacity=firstNotNull$1(axisLineStyleModel.get("opacity"),1);color[3]*=opacity,linesGeo.addLine(p02,p12,color,lineWidth*dpr)}if(axisTickModel.get("show")){var lineStyleModel=axisTickModel.getModel("lineStyle"),lineColor=graphicGL.parseColor(firstNotNull$1(lineStyleModel.get("color"),axisLineColor));lineWidth=firstNotNull$1(lineStyleModel.get("width"),1);lineColor[3]*=firstNotNull$1(lineStyleModel.get("opacity"),1);for(var ticksCoords=axis.getTicksCoords(),tickLength=axisTickModel.get("length"),i=0;i&lt;ticksCoords.length;i++){var tickCoord=ticksCoords[i].coord,p02=[0,0,0],idx=(p12=[0,0,0],dimIndicesMap$1[axis.dim]),otherIdx=dimIndicesMap$1[otherDim[axis.dim]];p02[idx]=p12[idx]=tickCoord,p12[otherIdx]=tickLength,linesGeo.addLine(p02,p12,lineColor,lineWidth*dpr)}}this.labelElements=[];dpr=api.getDevicePixelRatio();if(axisLabelModel.get("show")){ticksCoords=axis.getTicksCoords();var categoryData=axisModel.get("data"),labelMargin=axisLabelModel.get("margin"),labels=axis.getViewLabels();for(i=0;i&lt;labels.length;i++){var tickValue=labels[i].tickValue,formattedLabel=labels[i].formattedLabel,rawLabel=labels[i].rawLabel,p=(tickCoord=axis.dataToCoord(tickValue),[0,0,0]);idx=dimIndicesMap$1[axis.dim],otherIdx=dimIndicesMap$1[otherDim[axis.dim]];p[idx]=p[idx]=tickCoord,p[otherIdx]=labelMargin;var itemTextStyleModel=axisLabelModel;categoryData&amp;&amp;categoryData[tickValue]&amp;&amp;categoryData[tickValue].textStyle&amp;&amp;(itemTextStyleModel=new Model(categoryData[tickValue].textStyle,axisLabelModel,axisModel.ecModel));var textColor=firstNotNull$1(itemTextStyleModel.get("color"),axisLineColor),textEl=new ZRText({style:createTextStyle(itemTextStyleModel,{text:formattedLabel,fill:"function"==typeof textColor?textColor("category"===axis.type?rawLabel:"value"===axis.type?tickValue+"":tickValue,i):textColor,verticalAlign:"top",align:"left"})}),coords=axisLabelSurface.add(textEl),rect=textEl.getBoundingRect();labelsGeo.addSprite(p,[rect.width*dpr,rect.height*dpr],coords),this.labelElements.push(textEl)}}if(axisModel.get("name")){var nameTextStyleModel=axisModel.getModel("nameTextStyle"),labelColor=(p=[0,0,0],idx=dimIndicesMap$1[axis.dim],otherIdx=dimIndicesMap$1[otherDim[axis.dim]],firstNotNull$1(nameTextStyleModel.get("color"),axisLineColor)),strokeColor=nameTextStyleModel.get("borderColor");lineWidth=nameTextStyleModel.get("borderWidth");p[idx]=p[idx]=(extent[0]+extent[1])/2,p[otherIdx]=axisModel.get("nameGap");textEl=new ZRText({style:createTextStyle(nameTextStyleModel,{text:axisModel.get("name"),fill:labelColor,stroke:strokeColor,lineWidth:lineWidth})}),coords=axisLabelSurface.add(textEl),rect=textEl.getBoundingRect();labelsGeo.addSprite(p,[rect.width*dpr,rect.height*dpr],coords),textEl.__idx=this.labelElements.length,this.nameLabelElement=textEl}this.labelsMesh.material.set("textureAtlas",axisLabelSurface.getTexture()),this.labelsMesh.material.set("uvScale",axisLabelSurface.getCoordsScale()),linesGeo.convertToTypedArray(),labelsGeo.convertToTypedArray()},Grid3DAxis.prototype.setSpriteAlign=function(textAlign,textVerticalAlign,api){for(var dpr=api.getDevicePixelRatio(),labelGeo=this.labelsMesh.geometry,i=0;i&lt;this.labelElements.length;i++){var rect=this.labelElements[i].getBoundingRect();labelGeo.setSpriteAlign(i,[rect.width*dpr,rect.height*dpr],textAlign,textVerticalAlign)}var nameLabelEl=this.nameLabelElement;if(nameLabelEl){rect=nameLabelEl.getBoundingRect();labelGeo.setSpriteAlign(nameLabelEl.__idx,[rect.width*dpr,rect.height*dpr],textAlign,textVerticalAlign),labelGeo.dirty()}this.textAlign=textAlign,this.textVerticalAlign=textVerticalAlign};const lines3DGLSL="@export ecgl.lines3D.vertex\n\nuniform mat4 worldViewProjection : WORLDVIEWPROJECTION;\n\nattribute vec3 position: POSITION;\nattribute vec4 a_Color : COLOR;\nvarying vec4 v_Color;\n\nvoid main()\n{\n gl_Position = worldViewProjection * vec4(position, 1.0);\n v_Color = a_Color;\n}\n\n@end\n\n@export ecgl.lines3D.fragment\n\nuniform vec4 color : [1.0, 1.0, 1.0, 1.0];\n\nvarying vec4 v_Color;\n\n@import clay.util.srgb\n\nvoid main()\n{\n#ifdef SRGB_DECODE\n gl_FragColor = sRGBToLinear(color * v_Color);\n#else\n gl_FragColor = color * v_Color;\n#endif\n}\n@end\n\n\n\n@export ecgl.lines3D.clipNear\n\nvec4 clipNear(vec4 p1, vec4 p2) {\n float n = (p1.w - near) / (p1.w - p2.w);\n return vec4(mix(p1.xy, p2.xy, n), -near, near);\n}\n\n@end\n\n@export ecgl.lines3D.expandLine\n#ifdef VERTEX_ANIMATION\n vec4 prevProj = worldViewProjection * vec4(mix(prevPositionPrev, positionPrev, percent), 1.0);\n vec4 currProj = worldViewProjection * vec4(mix(prevPosition, position, percent), 1.0);\n vec4 nextProj = worldViewProjection * vec4(mix(prevPositionNext, positionNext, percent), 1.0);\n#else\n vec4 prevProj = worldViewProjection * vec4(positionPrev, 1.0);\n vec4 currProj = worldViewProjection * vec4(position, 1.0);\n vec4 nextProj = worldViewProjection * vec4(positionNext, 1.0);\n#endif\n\n if (currProj.w &lt; 0.0) {\n if (nextProj.w &gt; 0.0) {\n currProj = clipNear(currProj, nextProj);\n }\n else if (prevProj.w &gt; 0.0) {\n currProj = clipNear(currProj, prevProj);\n }\n }\n\n vec2 prevScreen = (prevProj.xy / abs(prevProj.w) + 1.0) * 0.5 * viewport.zw;\n vec2 currScreen = (currProj.xy / abs(currProj.w) + 1.0) * 0.5 * viewport.zw;\n vec2 nextScreen = (nextProj.xy / abs(nextProj.w) + 1.0) * 0.5 * viewport.zw;\n\n vec2 dir;\n float len = offset;\n if (position == positionPrev) {\n dir = normalize(nextScreen - currScreen);\n }\n else if (position == positionNext) {\n dir = normalize(currScreen - prevScreen);\n }\n else {\n vec2 dirA = normalize(currScreen - prevScreen);\n vec2 dirB = normalize(nextScreen - currScreen);\n\n vec2 tanget = normalize(dirA + dirB);\n\n float miter = 1.0 / max(dot(tanget, dirA), 0.5);\n len *= miter;\n dir = tanget;\n }\n\n dir = vec2(-dir.y, dir.x) * len;\n currScreen += dir;\n\n currProj.xy = (currScreen / viewport.zw - 0.5) * 2.0 * abs(currProj.w);\n@end\n\n\n@export ecgl.meshLines3D.vertex\n\nattribute vec3 position: POSITION;\nattribute vec3 positionPrev;\nattribute vec3 positionNext;\nattribute float offset;\nattribute vec4 a_Color : COLOR;\n\n#ifdef VERTEX_ANIMATION\nattribute vec3 prevPosition;\nattribute vec3 prevPositionPrev;\nattribute vec3 prevPositionNext;\nuniform float percent : 1.0;\n#endif\n\nuniform mat4 worldViewProjection : WORLDVIEWPROJECTION;\nuniform vec4 viewport : VIEWPORT;\nuniform float near : NEAR;\n\nvarying vec4 v_Color;\n\n@import ecgl.common.wireframe.vertexHeader\n\n@import ecgl.lines3D.clipNear\n\nvoid main()\n{\n @import ecgl.lines3D.expandLine\n\n gl_Position = currProj;\n\n v_Color = a_Color;\n\n @import ecgl.common.wireframe.vertexMain\n}\n@end\n\n\n@export ecgl.meshLines3D.fragment\n\nuniform vec4 color : [1.0, 1.0, 1.0, 1.0];\n\nvarying vec4 v_Color;\n\n@import ecgl.common.wireframe.fragmentHeader\n\n@import clay.util.srgb\n\nvoid main()\n{\n#ifdef SRGB_DECODE\n gl_FragColor = sRGBToLinear(color * v_Color);\n#else\n gl_FragColor = color * v_Color;\n#endif\n\n @import ecgl.common.wireframe.fragmentMain\n}\n\n@end";var firstNotNull=retrieve_firstNotNull;graphicGL.Shader.import(lines3DGLSL);var dimIndicesMap={x:0,y:2,z:1};const Grid3DView=ComponentView.extend({type:"grid3D",__ecgl__:!0,init:function(ecModel,api){var quadsMaterial=new graphicGL.Material({shader:graphicGL.createShader("ecgl.color"),depthMask:!1,transparent:!0}),linesMaterial=new graphicGL.Material({shader:graphicGL.createShader("ecgl.meshLines3D"),depthMask:!1,transparent:!0});quadsMaterial.define("fragment","DOUBLE_SIDED"),quadsMaterial.define("both","VERTEX_COLOR"),this.groupGL=new graphicGL.Node,this._control=new OrbitControl({zr:api.getZr()}),this._control.init(),this._faces=[["y","z","x",-1,"left"],["y","z","x",1,"right"],["x","y","z",-1,"bottom"],["x","y","z",1,"top"],["x","z","y",-1,"far"],["x","z","y",1,"near"]].map(function(faceInfo){var face=new Grid3DFace(faceInfo,linesMaterial,quadsMaterial);return this.groupGL.add(face.rootNode),face},this),this._axes=["x","y","z"].map(function(dim){var axis=new Grid3DAxis(dim,linesMaterial);return this.groupGL.add(axis.rootNode),axis},this);var dpr=api.getDevicePixelRatio();this._axisLabelSurface=new ZRTextureAtlasSurface({width:256,height:256,devicePixelRatio:dpr}),this._axisLabelSurface.onupdate=function(){api.getZr().refresh()},this._axisPointerLineMesh=new graphicGL.Mesh({geometry:new LinesGeometry$2({useNativeLine:!1}),material:linesMaterial,castShadow:!1,ignorePicking:!0,renderOrder:3}),this.groupGL.add(this._axisPointerLineMesh),this._axisPointerLabelsSurface=new ZRTextureAtlasSurface({width:128,height:128,devicePixelRatio:dpr}),this._axisPointerLabelsMesh=new LabelsMesh({ignorePicking:!0,renderOrder:4,castShadow:!1}),this._axisPointerLabelsMesh.material.set("textureAtlas",this._axisPointerLabelsSurface.getTexture()),this.groupGL.add(this._axisPointerLabelsMesh),this._lightRoot=new graphicGL.Node,this._sceneHelper=new SceneHelper,this._sceneHelper.initLight(this._lightRoot)},render:function(grid3DModel,ecModel,api){this._model=grid3DModel,this._api=api;var cartesian=grid3DModel.coordinateSystem;cartesian.viewGL.add(this._lightRoot),grid3DModel.get("show")?cartesian.viewGL.add(this.groupGL):cartesian.viewGL.remove(this.groupGL);var control=this._control;control.setViewGL(cartesian.viewGL);var viewControlModel=grid3DModel.getModel("viewControl");control.setFromViewControlModel(viewControlModel,0),this._axisLabelSurface.clear(),control.off("update"),grid3DModel.get("show")&amp;&amp;(this._faces.forEach(function(face){face.update(grid3DModel,ecModel,api)},this),this._axes.forEach(function(axis){axis.update(grid3DModel,this._axisLabelSurface,api)},this)),control.on("update",this._onCameraChange.bind(this,grid3DModel,api),this),this._sceneHelper.setScene(cartesian.viewGL.scene),this._sceneHelper.updateLight(grid3DModel),cartesian.viewGL.setPostEffect(grid3DModel.getModel("postEffect"),api),cartesian.viewGL.setTemporalSuperSampling(grid3DModel.getModel("temporalSuperSampling")),this._initMouseHandler(grid3DModel)},afterRender:function(grid3DModel,ecModel,api,layerGL){var renderer=layerGL.renderer;this._sceneHelper.updateAmbientCubemap(renderer,grid3DModel,api),this._sceneHelper.updateSkybox(renderer,grid3DModel,api)},showAxisPointer:function(grid3dModel,ecModel,api,payload){this._doShowAxisPointer(),this._updateAxisPointer(payload.value)},hideAxisPointer:function(grid3dModel,ecModel,api,payload){this._doHideAxisPointer()},_initMouseHandler:function(grid3DModel){var viewGL=grid3DModel.coordinateSystem.viewGL;grid3DModel.get("show")&amp;&amp;grid3DModel.get("axisPointer.show")?viewGL.on("mousemove",this._updateAxisPointerOnMousePosition,this):viewGL.off("mousemove",this._updateAxisPointerOnMousePosition)},_updateAxisPointerOnMousePosition:function(e2){if(!e2.target){for(var nearestIntersectPoint,cartesian=this._model.coordinateSystem,viewGL=cartesian.viewGL,ray=viewGL.castRay(e2.offsetX,e2.offsetY,new graphicGL.Ray),i=0;i&lt;this._faces.length;i++){var face=this._faces[i];if(!face.rootNode.invisible){face.plane.normal.dot(viewGL.camera.worldTransform.z)&lt;0&amp;&amp;face.plane.normal.negate();var point=ray.intersectPlane(face.plane);if(point){var axis0=cartesian.getAxis(face.faceInfo[0]),axis1=cartesian.getAxis(face.faceInfo[1]),idx0=dimIndicesMap[face.faceInfo[0]],idx1=dimIndicesMap[face.faceInfo[1]];axis0.contain(point.array[idx0])&amp;&amp;axis1.contain(point.array[idx1])&amp;&amp;(nearestIntersectPoint=point)}}}if(nearestIntersectPoint){var data=cartesian.pointToData(nearestIntersectPoint.array,[],!0);this._updateAxisPointer(data),this._doShowAxisPointer()}else this._doHideAxisPointer()}},_onCameraChange:function(grid3DModel,api){grid3DModel.get("show")&amp;&amp;(this._updateFaceVisibility(),this._updateAxisLinePosition());var control=this._control;api.dispatchAction({type:"grid3DChangeCamera",alpha:control.getAlpha(),beta:control.getBeta(),distance:control.getDistance(),center:control.getCenter(),from:this.uid,grid3DId:grid3DModel.id})},_updateFaceVisibility:function(){var camera=this._control.getCamera(),viewSpacePos=new graphicGL.Vector3;camera.update();for(var idx=0;idx&lt;this._faces.length/2;idx++){for(var depths=[],k=0;k&lt;2;k++){this._faces[2*idx+k].rootNode.getWorldPosition(viewSpacePos),viewSpacePos.transformMat4(camera.viewMatrix),depths[k]=viewSpacePos.z}var frontIndex=depths[0]&gt;depths[1]?0:1,frontFace=this._faces[2*idx+frontIndex],backFace=this._faces[2*idx+1-frontIndex];frontFace.rootNode.invisible=!0,backFace.rootNode.invisible=!1}},_updateAxisLinePosition:function(){var cartesian=this._model.coordinateSystem,xAxis=cartesian.getAxis("x"),yAxis=cartesian.getAxis("y"),zAxis=cartesian.getAxis("z"),top=zAxis.getExtentMax(),bottom=zAxis.getExtentMin(),left=xAxis.getExtentMin(),right=xAxis.getExtentMax(),near=yAxis.getExtentMax(),far=yAxis.getExtentMin(),xAxisNode=this._axes[0].rootNode,yAxisNode=this._axes[1].rootNode,zAxisNode=this._axes[2].rootNode,faces=this._faces,xAxisZOffset=faces[4].rootNode.invisible?far:near,xAxisYOffset=faces[2].rootNode.invisible?top:bottom,yAxisXOffset=faces[0].rootNode.invisible?left:right,yAxisYOffset=faces[2].rootNode.invisible?top:bottom,zAxisXOffset=faces[0].rootNode.invisible?right:left,zAxisZOffset=faces[4].rootNode.invisible?far:near;xAxisNode.rotation.identity(),yAxisNode.rotation.identity(),zAxisNode.rotation.identity(),faces[4].rootNode.invisible&amp;&amp;(this._axes[0].flipped=!0,xAxisNode.rotation.rotateX(Math.PI)),faces[0].rootNode.invisible&amp;&amp;(this._axes[1].flipped=!0,yAxisNode.rotation.rotateZ(Math.PI)),faces[4].rootNode.invisible&amp;&amp;(this._axes[2].flipped=!0,zAxisNode.rotation.rotateY(Math.PI)),xAxisNode.position.set(0,xAxisYOffset,xAxisZOffset),yAxisNode.position.set(yAxisXOffset,yAxisYOffset,0),zAxisNode.position.set(zAxisXOffset,0,zAxisZOffset),xAxisNode.update(),yAxisNode.update(),zAxisNode.update(),this._updateAxisLabelAlign()},_updateAxisLabelAlign:function(){var camera=this._control.getCamera(),coords=[new graphicGL.Vector4,new graphicGL.Vector4],center=new graphicGL.Vector4;this.groupGL.getWorldPosition(center),center.w=1,center.transformMat4(camera.viewMatrix).transformMat4(camera.projectionMatrix),center.x/=center.w,center.y/=center.w,this._axes.forEach(function(axisInfo){var lineCoords=axisInfo.axisLineCoords;axisInfo.labelsMesh.geometry;for(var i=0;i&lt;coords.length;i++)coords[i].setArray(lineCoords[i]),coords[i].w=1,coords[i].transformMat4(axisInfo.rootNode.worldTransform).transformMat4(camera.viewMatrix).transformMat4(camera.projectionMatrix),coords[i].x/=coords[i].w,coords[i].y/=coords[i].w;var textAlign,verticalAlign,dx=coords[1].x-coords[0].x,dy=coords[1].y-coords[0].y,cx=(coords[1].x+coords[0].x)/2,cy=(coords[1].y+coords[0].y)/2;Math.abs(dy/dx)&lt;.5?(textAlign="center",verticalAlign=cy&gt;center.y?"bottom":"top"):(verticalAlign="middle",textAlign=cx&gt;center.x?"left":"right"),axisInfo.setSpriteAlign(textAlign,verticalAlign,this._api)},this)},_doShowAxisPointer:function(){this._axisPointerLineMesh.invisible&amp;&amp;(this._axisPointerLineMesh.invisible=!1,this._axisPointerLabelsMesh.invisible=!1,this._api.getZr().refresh())},_doHideAxisPointer:function(){this._axisPointerLineMesh.invisible||(this._axisPointerLineMesh.invisible=!0,this._axisPointerLabelsMesh.invisible=!0,this._api.getZr().refresh())},_updateAxisPointer:function(data){var cartesian=this._model.coordinateSystem,point=cartesian.dataToPoint(data),linesGeo=this._axisPointerLineMesh.geometry,axisPointerParentModel=this._model.getModel("axisPointer"),dpr=this._api.getDevicePixelRatio();function ifShowAxisPointer(axis2){return retrieve_firstNotNull(axis2.model.get("axisPointer.show"),axisPointerParentModel.get("show"))}function getAxisColorAndLineWidth(axis2){var lineStyleModel=axis2.model.getModel("axisPointer",axisPointerParentModel).getModel("lineStyle"),color=graphicGL.parseColor(lineStyleModel.get("color")),lineWidth=firstNotNull(lineStyleModel.get("width"),1),opacity=firstNotNull(lineStyleModel.get("opacity"),1);return color[3]*=opacity,{color:color,lineWidth:lineWidth}}linesGeo.convertToDynamicArray(!0);for(var k=0;k&lt;this._faces.length;k++){var face=this._faces[k];if(!face.rootNode.invisible){for(var faceInfo=face.faceInfo,otherCoord=faceInfo[3]&lt;0?cartesian.getAxis(faceInfo[2]).getExtentMin():cartesian.getAxis(faceInfo[2]).getExtentMax(),otherDimIdx=dimIndicesMap[faceInfo[2]],i=0;i&lt;2;i++){var dim=faceInfo[i],faceOtherDim=faceInfo[1-i],axis=cartesian.getAxis(dim),faceOtherAxis=cartesian.getAxis(faceOtherDim);if(ifShowAxisPointer(axis)){var dimIdx=dimIndicesMap[dim],faceOtherDimIdx=dimIndicesMap[faceOtherDim];(p02=[0,0,0])[dimIdx]=(p12=[0,0,0])[dimIdx]=point[dimIdx],p02[otherDimIdx]=p12[otherDimIdx]=otherCoord,p02[faceOtherDimIdx]=faceOtherAxis.getExtentMin(),p12[faceOtherDimIdx]=faceOtherAxis.getExtentMax();var colorAndLineWidth=getAxisColorAndLineWidth(axis);linesGeo.addLine(p02,p12,colorAndLineWidth.color,colorAndLineWidth.lineWidth*dpr)}}if(ifShowAxisPointer(cartesian.getAxis(faceInfo[2]))){var p12,p02=point.slice();(p12=point.slice())[otherDimIdx]=otherCoord;colorAndLineWidth=getAxisColorAndLineWidth(cartesian.getAxis(faceInfo[2]));linesGeo.addLine(p02,p12,colorAndLineWidth.color,colorAndLineWidth.lineWidth*dpr)}}}linesGeo.convertToTypedArray(),this._updateAxisPointerLabelsMesh(data),this._api.getZr().refresh()},_updateAxisPointerLabelsMesh:function(data){var grid3dModel=this._model,axisPointerLabelsMesh=this._axisPointerLabelsMesh,axisPointerLabelsSurface=this._axisPointerLabelsSurface,cartesian=grid3dModel.coordinateSystem,axisPointerParentModel=grid3dModel.getModel("axisPointer");axisPointerLabelsMesh.geometry.convertToDynamicArray(!0),axisPointerLabelsSurface.clear();var otherDim2={x:"y",y:"x",z:"y"};this._axes.forEach(function(axisInfo,idx){var axis=cartesian.getAxis(axisInfo.dim),axisPointerModel=axis.model.getModel("axisPointer",axisPointerParentModel),labelModel=axisPointerModel.getModel("label"),lineColor=axisPointerModel.get("lineStyle.color");if(labelModel.get("show")&amp;&amp;axisPointerModel.get("show")){var val=data[idx],formatter=labelModel.get("formatter"),text=axis.scale.getLabel({value:val});if(null!=formatter)text=formatter(text,data);else if("interval"===axis.scale.type||"log"===axis.scale.type){var precision=getPrecisionSafe(axis.scale.getTicks()[0]);text=val.toFixed(precision+2)}var labelColor=labelModel.get("color"),textEl=new ZRText({style:createTextStyle(labelModel,{text:text,fill:labelColor||lineColor,align:"left",verticalAlign:"top"})}),coords=axisPointerLabelsSurface.add(textEl),rect=textEl.getBoundingRect(),dpr=this._api.getDevicePixelRatio(),pos=axisInfo.rootNode.position.toArray();pos[dimIndicesMap[otherDim2[axisInfo.dim]]]+=(axisInfo.flipped?-1:1)*labelModel.get("margin"),pos[dimIndicesMap[axisInfo.dim]]=axis.dataToCoord(data[idx]),axisPointerLabelsMesh.geometry.addSprite(pos,[rect.width*dpr,rect.height*dpr],coords,axisInfo.textAlign,axisInfo.textVerticalAlign)}},this),axisPointerLabelsSurface.getZr().refreshImmediately(),axisPointerLabelsMesh.material.set("uvScale",axisPointerLabelsSurface.getCoordsScale()),axisPointerLabelsMesh.geometry.convertToTypedArray()},dispose:function(){this.groupGL.removeAll(),this._control.dispose(),this._axisLabelSurface.dispose(),this._axisPointerLabelsSurface.dispose()}});function Cartesian3D(name){Cartesian.call(this,name),this.type="cartesian3D",this.dimensions=["x","y","z"],this.size=[0,0,0]}function Axis3D(dim,scale,extent){Axis.call(this,dim,scale,extent)}function halton(index2,base){for(var result=0,f=1/base,i=index2;i&gt;0;)result+=f*(i%base),i=Math.floor(i/base),f/=base;return result}Cartesian3D.prototype={constructor:Cartesian3D,model:null,containPoint:function(point){return this.getAxis("x").contain(point[0])&amp;&amp;this.getAxis("y").contain(point[2])&amp;&amp;this.getAxis("z").contain(point[1])},containData:function(data){return this.getAxis("x").containData(data[0])&amp;&amp;this.getAxis("y").containData(data[1])&amp;&amp;this.getAxis("z").containData(data[2])},dataToPoint:function(data,out,clamp){return(out=out||[])[0]=this.getAxis("x").dataToCoord(data[0],clamp),out[2]=this.getAxis("y").dataToCoord(data[1],clamp),out[1]=this.getAxis("z").dataToCoord(data[2],clamp),out},pointToData:function(point,out,clamp){return(out=out||[])[0]=this.getAxis("x").coordToData(point[0],clamp),out[1]=this.getAxis("y").coordToData(point[2],clamp),out[2]=this.getAxis("z").coordToData(point[1],clamp),out}},inherits(Cartesian3D,Cartesian),Axis3D.prototype={constructor:Axis3D,getExtentMin:function(){var extent=this._extent;return Math.min(extent[0],extent[1])},getExtentMax:function(){var extent=this._extent;return Math.max(extent[0],extent[1])},calculateCategoryInterval:function(){return Math.floor(this.scale.count()/8)}},inherits(Axis3D,Axis);function generateNoiseData(size){for(var data=new Uint8Array(size*size*4),n=0,v3=new Vector3,i=0;i&lt;size;i++)for(var j=0;j&lt;size;j++)v3.set(2*Math.random()-1,2*Math.random()-1,0).normalize(),data[n++]=255*(.5*v3.x+.5),data[n++]=255*(.5*v3.y+.5),data[n++]=0,data[n++]=255;return data}function generateNoiseTexture(size){return new Texture2D({pixels:generateNoiseData(size),wrapS:Texture.REPEAT,wrapT:Texture.REPEAT,width:size,height:size})}function generateKernel(size,offset,hemisphere){var kernel=new Float32Array(3*size);offset=offset||0;for(var i=0;i&lt;size;i++){var phi=halton(i+offset,2)*(hemisphere?1:2)*Math.PI,theta=halton(i+offset,3)*Math.PI,r=Math.random(),x=Math.cos(phi)*Math.sin(theta)*r,y=Math.cos(theta)*r,z=Math.sin(phi)*Math.sin(theta)*r;kernel[3*i]=x,kernel[3*i+1]=y,kernel[3*i+2]=z}return kernel}function SSAOPass(opt){opt=opt||{},this._ssaoPass=new Pass({fragment:Shader.source("ecgl.ssao.estimate")}),this._blurPass=new Pass({fragment:Shader.source("ecgl.ssao.blur")}),this._framebuffer=new FrameBuffer({depthBuffer:!1}),this._ssaoTexture=new Texture2D,this._blurTexture=new Texture2D,this._blurTexture2=new Texture2D,this._depthTex=opt.depthTexture,this._normalTex=opt.normalTexture,this.setNoiseSize(4),this.setKernelSize(opt.kernelSize||12),null!=opt.radius&amp;&amp;this.setParameter("radius",opt.radius),null!=opt.power&amp;&amp;this.setParameter("power",opt.power),this._normalTex||(this._ssaoPass.material.disableTexture("normalTex"),this._blurPass.material.disableTexture("normalTex")),this._depthTex||this._blurPass.material.disableTexture("depthTex"),this._blurPass.material.setUniform("normalTex",this._normalTex),this._blurPass.material.setUniform("depthTex",this._depthTex)}Shader.import("@export ecgl.ssao.estimate\n\nuniform sampler2D depthTex;\n\nuniform sampler2D normalTex;\n\nuniform sampler2D noiseTex;\n\nuniform vec2 depthTexSize;\n\nuniform vec2 noiseTexSize;\n\nuniform mat4 projection;\n\nuniform mat4 projectionInv;\n\nuniform mat4 viewInverseTranspose;\n\nuniform vec3 kernel[KERNEL_SIZE];\n\nuniform float radius : 1;\n\nuniform float power : 1;\n\nuniform float bias: 1e-2;\n\nuniform float intensity: 1.0;\n\nvarying vec2 v_Texcoord;\n\nfloat ssaoEstimator(in vec3 originPos, in mat3 kernelBasis) {\n float occlusion = 0.0;\n\n for (int i = 0; i &lt; KERNEL_SIZE; i++) {\n vec3 samplePos = kernel[i];\n#ifdef NORMALTEX_ENABLED\n samplePos = kernelBasis * samplePos;\n#endif\n samplePos = samplePos * radius + originPos;\n\n vec4 texCoord = projection * vec4(samplePos, 1.0);\n texCoord.xy /= texCoord.w;\n\n vec4 depthTexel = texture2D(depthTex, texCoord.xy * 0.5 + 0.5);\n\n float sampleDepth = depthTexel.r * 2.0 - 1.0;\n if (projection[3][3] == 0.0) {\n sampleDepth = projection[3][2] / (sampleDepth * projection[2][3] - projection[2][2]);\n }\n else {\n sampleDepth = (sampleDepth - projection[3][2]) / projection[2][2];\n }\n \n float rangeCheck = smoothstep(0.0, 1.0, radius / abs(originPos.z - sampleDepth));\n occlusion += rangeCheck * step(samplePos.z, sampleDepth - bias);\n }\n#ifdef NORMALTEX_ENABLED\n occlusion = 1.0 - occlusion / float(KERNEL_SIZE);\n#else\n occlusion = 1.0 - clamp((occlusion / float(KERNEL_SIZE) - 0.6) * 2.5, 0.0, 1.0);\n#endif\n return pow(occlusion, power);\n}\n\nvoid main()\n{\n\n vec4 depthTexel = texture2D(depthTex, v_Texcoord);\n\n#ifdef NORMALTEX_ENABLED\n vec4 tex = texture2D(normalTex, v_Texcoord);\n if (dot(tex.rgb, tex.rgb) == 0.0) {\n gl_FragColor = vec4(1.0);\n return;\n }\n vec3 N = tex.rgb * 2.0 - 1.0;\n N = (viewInverseTranspose * vec4(N, 0.0)).xyz;\n\n vec2 noiseTexCoord = depthTexSize / vec2(noiseTexSize) * v_Texcoord;\n vec3 rvec = texture2D(noiseTex, noiseTexCoord).rgb * 2.0 - 1.0;\n vec3 T = normalize(rvec - N * dot(rvec, N));\n vec3 BT = normalize(cross(N, T));\n mat3 kernelBasis = mat3(T, BT, N);\n#else\n if (depthTexel.r &gt; 0.99999) {\n gl_FragColor = vec4(1.0);\n return;\n }\n mat3 kernelBasis;\n#endif\n\n float z = depthTexel.r * 2.0 - 1.0;\n\n vec4 projectedPos = vec4(v_Texcoord * 2.0 - 1.0, z, 1.0);\n vec4 p4 = projectionInv * projectedPos;\n\n vec3 position = p4.xyz / p4.w;\n\n float ao = ssaoEstimator(position, kernelBasis);\n ao = clamp(1.0 - (1.0 - ao) * intensity, 0.0, 1.0);\n gl_FragColor = vec4(vec3(ao), 1.0);\n}\n\n@end\n\n\n@export ecgl.ssao.blur\n#define SHADER_NAME SSAO_BLUR\n\nuniform sampler2D ssaoTexture;\n\n#ifdef NORMALTEX_ENABLED\nuniform sampler2D normalTex;\n#endif\n\nvarying vec2 v_Texcoord;\n\nuniform vec2 textureSize;\nuniform float blurSize : 1.0;\n\nuniform int direction: 0.0;\n\n#ifdef DEPTHTEX_ENABLED\nuniform sampler2D depthTex;\nuniform mat4 projection;\nuniform float depthRange : 0.5;\n\nfloat getLinearDepth(vec2 coord)\n{\n float depth = texture2D(depthTex, coord).r * 2.0 - 1.0;\n return projection[3][2] / (depth * projection[2][3] - projection[2][2]);\n}\n#endif\n\nvoid main()\n{\n float kernel[5];\n kernel[0] = 0.122581;\n kernel[1] = 0.233062;\n kernel[2] = 0.288713;\n kernel[3] = 0.233062;\n kernel[4] = 0.122581;\n\n vec2 off = vec2(0.0);\n if (direction == 0) {\n off[0] = blurSize / textureSize.x;\n }\n else {\n off[1] = blurSize / textureSize.y;\n }\n\n vec2 coord = v_Texcoord;\n\n float sum = 0.0;\n float weightAll = 0.0;\n\n#ifdef NORMALTEX_ENABLED\n vec3 centerNormal = texture2D(normalTex, v_Texcoord).rgb * 2.0 - 1.0;\n#endif\n#if defined(DEPTHTEX_ENABLED)\n float centerDepth = getLinearDepth(v_Texcoord);\n#endif\n\n for (int i = 0; i &lt; 5; i++) {\n vec2 coord = clamp(v_Texcoord + vec2(float(i) - 2.0) * off, vec2(0.0), vec2(1.0));\n\n float w = kernel[i];\n#ifdef NORMALTEX_ENABLED\n vec3 normal = texture2D(normalTex, coord).rgb * 2.0 - 1.0;\n w *= clamp(dot(normal, centerNormal), 0.0, 1.0);\n#endif\n#ifdef DEPTHTEX_ENABLED\n float d = getLinearDepth(coord);\n w *= (1.0 - smoothstep(abs(centerDepth - d) / depthRange, 0.0, 1.0));\n#endif\n\n weightAll += w;\n sum += texture2D(ssaoTexture, coord).r * w;\n }\n\n gl_FragColor = vec4(vec3(sum / weightAll), 1.0);\n}\n\n@end\n"),SSAOPass.prototype.setDepthTexture=function(depthTex){this._depthTex=depthTex},SSAOPass.prototype.setNormalTexture=function(normalTex){this._normalTex=normalTex,this._ssaoPass.material[normalTex?"enableTexture":"disableTexture"]("normalTex"),this.setKernelSize(this._kernelSize)},SSAOPass.prototype.update=function(renderer,camera,frame){var width=renderer.getWidth(),height=renderer.getHeight(),ssaoPass=this._ssaoPass,blurPass=this._blurPass;ssaoPass.setUniform("kernel",this._kernels[frame%this._kernels.length]),ssaoPass.setUniform("depthTex",this._depthTex),null!=this._normalTex&amp;&amp;ssaoPass.setUniform("normalTex",this._normalTex),ssaoPass.setUniform("depthTexSize",[this._depthTex.width,this._depthTex.height]);var viewInverseTranspose=new Matrix4;Matrix4.transpose(viewInverseTranspose,camera.worldTransform),ssaoPass.setUniform("projection",camera.projectionMatrix.array),ssaoPass.setUniform("projectionInv",camera.invProjectionMatrix.array),ssaoPass.setUniform("viewInverseTranspose",viewInverseTranspose.array);var ssaoTexture=this._ssaoTexture,blurTexture=this._blurTexture,blurTexture2=this._blurTexture2;ssaoTexture.width=width/2,ssaoTexture.height=height/2,blurTexture.width=width,blurTexture.height=height,blurTexture2.width=width,blurTexture2.height=height,this._framebuffer.attach(ssaoTexture),this._framebuffer.bind(renderer),renderer.gl.clearColor(1,1,1,1),renderer.gl.clear(renderer.gl.COLOR_BUFFER_BIT),ssaoPass.render(renderer),blurPass.setUniform("textureSize",[width/2,height/2]),blurPass.setUniform("projection",camera.projectionMatrix.array),this._framebuffer.attach(blurTexture),blurPass.setUniform("direction",0),blurPass.setUniform("ssaoTexture",ssaoTexture),blurPass.render(renderer),this._framebuffer.attach(blurTexture2),blurPass.setUniform("textureSize",[width,height]),blurPass.setUniform("direction",1),blurPass.setUniform("ssaoTexture",blurTexture),blurPass.render(renderer),this._framebuffer.unbind(renderer);var clearColor=renderer.clearColor;renderer.gl.clearColor(clearColor[0],clearColor[1],clearColor[2],clearColor[3])},SSAOPass.prototype.getTargetTexture=function(){return this._blurTexture2},SSAOPass.prototype.setParameter=function(name,val){"noiseTexSize"===name?this.setNoiseSize(val):"kernelSize"===name?this.setKernelSize(val):"intensity"===name?this._ssaoPass.material.set("intensity",val):this._ssaoPass.setUniform(name,val)},SSAOPass.prototype.setKernelSize=function(size){this._kernelSize=size,this._ssaoPass.material.define("fragment","KERNEL_SIZE",size),this._kernels=this._kernels||[];for(var i=0;i&lt;30;i++)this._kernels[i]=generateKernel(size,i*size,!!this._normalTex)},SSAOPass.prototype.setNoiseSize=function(size){var texture=this._ssaoPass.getUniform("noiseTex");texture?(texture.data=generateNoiseData(size),texture.width=texture.height=size,texture.dirty()):(texture=generateNoiseTexture(size),this._ssaoPass.setUniform("noiseTex",generateNoiseTexture(size))),this._ssaoPass.setUniform("noiseTexSize",[size,size])},SSAOPass.prototype.dispose=function(renderer){this._blurTexture.dispose(renderer),this._ssaoTexture.dispose(renderer),this._blurTexture2.dispose(renderer)};function SSRPass(opt){opt=opt||{},this._ssrPass=new Pass({fragment:Shader.source("ecgl.ssr.main"),clearColor:[0,0,0,0]}),this._blurPass1=new Pass({fragment:Shader.source("ecgl.ssr.blur"),clearColor:[0,0,0,0]}),this._blurPass2=new Pass({fragment:Shader.source("ecgl.ssr.blur"),clearColor:[0,0,0,0]}),this._blendPass=new Pass({fragment:Shader.source("clay.compositor.blend")}),this._blendPass.material.disableTexturesAll(),this._blendPass.material.enableTexture(["texture1","texture2"]),this._ssrPass.setUniform("gBufferTexture1",opt.normalTexture),this._ssrPass.setUniform("gBufferTexture2",opt.depthTexture),this._blurPass1.setUniform("gBufferTexture1",opt.normalTexture),this._blurPass1.setUniform("gBufferTexture2",opt.depthTexture),this._blurPass2.setUniform("gBufferTexture1",opt.normalTexture),this._blurPass2.setUniform("gBufferTexture2",opt.depthTexture),this._blurPass2.material.define("fragment","VERTICAL"),this._blurPass2.material.define("fragment","BLEND"),this._ssrTexture=new Texture2D({type:Texture.HALF_FLOAT}),this._texture2=new Texture2D({type:Texture.HALF_FLOAT}),this._texture3=new Texture2D({type:Texture.HALF_FLOAT}),this._prevTexture=new Texture2D({type:Texture.HALF_FLOAT}),this._currentTexture=new Texture2D({type:Texture.HALF_FLOAT}),this._frameBuffer=new FrameBuffer({depthBuffer:!1}),this._normalDistribution=null,this._totalSamples=256,this._samplePerFrame=4,this._ssrPass.material.define("fragment","SAMPLE_PER_FRAME",this._samplePerFrame),this._ssrPass.material.define("fragment","TOTAL_SAMPLES",this._totalSamples),this._downScale=1}Shader.import("@export ecgl.ssr.main\n\n#define SHADER_NAME SSR\n#define MAX_ITERATION 20;\n#define SAMPLE_PER_FRAME 5;\n#define TOTAL_SAMPLES 128;\n\nuniform sampler2D sourceTexture;\nuniform sampler2D gBufferTexture1;\nuniform sampler2D gBufferTexture2;\nuniform sampler2D gBufferTexture3;\nuniform samplerCube specularCubemap;\nuniform float specularIntensity: 1;\n\nuniform mat4 projection;\nuniform mat4 projectionInv;\nuniform mat4 toViewSpace;\nuniform mat4 toWorldSpace;\n\nuniform float maxRayDistance: 200;\n\nuniform float pixelStride: 16;\nuniform float pixelStrideZCutoff: 50; \nuniform float screenEdgeFadeStart: 0.9; \nuniform float eyeFadeStart : 0.2; uniform float eyeFadeEnd: 0.8; \nuniform float minGlossiness: 0.2; uniform float zThicknessThreshold: 1;\n\nuniform float nearZ;\nuniform vec2 viewportSize : VIEWPORT_SIZE;\n\nuniform float jitterOffset: 0;\n\nvarying vec2 v_Texcoord;\n\n#ifdef DEPTH_DECODE\n@import clay.util.decode_float\n#endif\n\n#ifdef PHYSICALLY_CORRECT\nuniform sampler2D normalDistribution;\nuniform float sampleOffset: 0;\nuniform vec2 normalDistributionSize;\n\nvec3 transformNormal(vec3 H, vec3 N) {\n vec3 upVector = N.y &gt; 0.999 ? vec3(1.0, 0.0, 0.0) : vec3(0.0, 1.0, 0.0);\n vec3 tangentX = normalize(cross(N, upVector));\n vec3 tangentZ = cross(N, tangentX);\n return normalize(tangentX * H.x + N * H.y + tangentZ * H.z);\n}\nvec3 importanceSampleNormalGGX(float i, float roughness, vec3 N) {\n float p = fract((i + sampleOffset) / float(TOTAL_SAMPLES));\n vec3 H = texture2D(normalDistribution,vec2(roughness, p)).rgb;\n return transformNormal(H, N);\n}\nfloat G_Smith(float g, float ndv, float ndl) {\n float roughness = 1.0 - g;\n float k = roughness * roughness / 2.0;\n float G1V = ndv / (ndv * (1.0 - k) + k);\n float G1L = ndl / (ndl * (1.0 - k) + k);\n return G1L * G1V;\n}\nvec3 F_Schlick(float ndv, vec3 spec) {\n return spec + (1.0 - spec) * pow(1.0 - ndv, 5.0);\n}\n#endif\n\nfloat fetchDepth(sampler2D depthTexture, vec2 uv)\n{\n vec4 depthTexel = texture2D(depthTexture, uv);\n return depthTexel.r * 2.0 - 1.0;\n}\n\nfloat linearDepth(float depth)\n{\n if (projection[3][3] == 0.0) {\n return projection[3][2] / (depth * projection[2][3] - projection[2][2]);\n }\n else {\n return (depth - projection[3][2]) / projection[2][2];\n }\n}\n\nbool rayIntersectDepth(float rayZNear, float rayZFar, vec2 hitPixel)\n{\n if (rayZFar &gt; rayZNear)\n {\n float t = rayZFar; rayZFar = rayZNear; rayZNear = t;\n }\n float cameraZ = linearDepth(fetchDepth(gBufferTexture2, hitPixel));\n return rayZFar &lt;= cameraZ &amp;&amp; rayZNear &gt;= cameraZ - zThicknessThreshold;\n}\n\n\nbool traceScreenSpaceRay(\n vec3 rayOrigin, vec3 rayDir, float jitter,\n out vec2 hitPixel, out vec3 hitPoint, out float iterationCount\n)\n{\n float rayLength = ((rayOrigin.z + rayDir.z * maxRayDistance) &gt; -nearZ)\n ? (-nearZ - rayOrigin.z) / rayDir.z : maxRayDistance;\n\n vec3 rayEnd = rayOrigin + rayDir * rayLength;\n\n vec4 H0 = projection * vec4(rayOrigin, 1.0);\n vec4 H1 = projection * vec4(rayEnd, 1.0);\n\n float k0 = 1.0 / H0.w, k1 = 1.0 / H1.w;\n\n vec3 Q0 = rayOrigin * k0, Q1 = rayEnd * k1;\n\n vec2 P0 = (H0.xy * k0 * 0.5 + 0.5) * viewportSize;\n vec2 P1 = (H1.xy * k1 * 0.5 + 0.5) * viewportSize;\n\n P1 += dot(P1 - P0, P1 - P0) &lt; 0.0001 ? 0.01 : 0.0;\n vec2 delta = P1 - P0;\n\n bool permute = false;\n if (abs(delta.x) &lt; abs(delta.y)) {\n permute = true;\n delta = delta.yx;\n P0 = P0.yx;\n P1 = P1.yx;\n }\n float stepDir = sign(delta.x);\n float invdx = stepDir / delta.x;\n\n vec3 dQ = (Q1 - Q0) * invdx;\n float dk = (k1 - k0) * invdx;\n\n vec2 dP = vec2(stepDir, delta.y * invdx);\n\n float strideScaler = 1.0 - min(1.0, -rayOrigin.z / pixelStrideZCutoff);\n float pixStride = 1.0 + strideScaler * pixelStride;\n\n dP *= pixStride; dQ *= pixStride; dk *= pixStride;\n\n vec4 pqk = vec4(P0, Q0.z, k0);\n vec4 dPQK = vec4(dP, dQ.z, dk);\n\n pqk += dPQK * jitter;\n float rayZFar = (dPQK.z * 0.5 + pqk.z) / (dPQK.w * 0.5 + pqk.w);\n float rayZNear;\n\n bool intersect = false;\n\n vec2 texelSize = 1.0 / viewportSize;\n\n iterationCount = 0.0;\n\n for (int i = 0; i &lt; MAX_ITERATION; i++)\n {\n pqk += dPQK;\n\n rayZNear = rayZFar;\n rayZFar = (dPQK.z * 0.5 + pqk.z) / (dPQK.w * 0.5 + pqk.w);\n\n hitPixel = permute ? pqk.yx : pqk.xy;\n hitPixel *= texelSize;\n\n intersect = rayIntersectDepth(rayZNear, rayZFar, hitPixel);\n\n iterationCount += 1.0;\n\n dPQK *= 1.2;\n\n if (intersect) {\n break;\n }\n }\n\n Q0.xy += dQ.xy * iterationCount;\n Q0.z = pqk.z;\n hitPoint = Q0 / pqk.w;\n\n return intersect;\n}\n\nfloat calculateAlpha(\n float iterationCount, float reflectivity,\n vec2 hitPixel, vec3 hitPoint, float dist, vec3 rayDir\n)\n{\n float alpha = clamp(reflectivity, 0.0, 1.0);\n alpha *= 1.0 - (iterationCount / float(MAX_ITERATION));\n vec2 hitPixelNDC = hitPixel * 2.0 - 1.0;\n float maxDimension = min(1.0, max(abs(hitPixelNDC.x), abs(hitPixelNDC.y)));\n alpha *= 1.0 - max(0.0, maxDimension - screenEdgeFadeStart) / (1.0 - screenEdgeFadeStart);\n\n float _eyeFadeStart = eyeFadeStart;\n float _eyeFadeEnd = eyeFadeEnd;\n if (_eyeFadeStart &gt; _eyeFadeEnd) {\n float tmp = _eyeFadeEnd;\n _eyeFadeEnd = _eyeFadeStart;\n _eyeFadeStart = tmp;\n }\n\n float eyeDir = clamp(rayDir.z, _eyeFadeStart, _eyeFadeEnd);\n alpha *= 1.0 - (eyeDir - _eyeFadeStart) / (_eyeFadeEnd - _eyeFadeStart);\n\n alpha *= 1.0 - clamp(dist / maxRayDistance, 0.0, 1.0);\n\n return alpha;\n}\n\n@import clay.util.rand\n\n@import clay.util.rgbm\n\nvoid main()\n{\n vec4 normalAndGloss = texture2D(gBufferTexture1, v_Texcoord);\n\n if (dot(normalAndGloss.rgb, vec3(1.0)) == 0.0) {\n discard;\n }\n\n float g = normalAndGloss.a;\n#if !defined(PHYSICALLY_CORRECT)\n if (g &lt;= minGlossiness) {\n discard;\n }\n#endif\n\n float reflectivity = (g - minGlossiness) / (1.0 - minGlossiness);\n\n vec3 N = normalize(normalAndGloss.rgb * 2.0 - 1.0);\n N = normalize((toViewSpace * vec4(N, 0.0)).xyz);\n\n vec4 projectedPos = vec4(v_Texcoord * 2.0 - 1.0, fetchDepth(gBufferTexture2, v_Texcoord), 1.0);\n vec4 pos = projectionInv * projectedPos;\n vec3 rayOrigin = pos.xyz / pos.w;\n vec3 V = -normalize(rayOrigin);\n\n float ndv = clamp(dot(N, V), 0.0, 1.0);\n float iterationCount;\n float jitter = rand(fract(v_Texcoord + jitterOffset));\n\n#ifdef PHYSICALLY_CORRECT\n vec4 color = vec4(vec3(0.0), 1.0);\n vec4 albedoMetalness = texture2D(gBufferTexture3, v_Texcoord);\n vec3 albedo = albedoMetalness.rgb;\n float m = albedoMetalness.a;\n vec3 diffuseColor = albedo * (1.0 - m);\n vec3 spec = mix(vec3(0.04), albedo, m);\n\n float jitter2 = rand(fract(v_Texcoord)) * float(TOTAL_SAMPLES);\n\n for (int i = 0; i &lt; SAMPLE_PER_FRAME; i++) {\n vec3 H = importanceSampleNormalGGX(float(i) + jitter2, 1.0 - g, N);\n vec3 rayDir = normalize(reflect(-V, H));\n#else\n vec3 rayDir = normalize(reflect(-V, N));\n#endif\n vec2 hitPixel;\n vec3 hitPoint;\n\n bool intersect = traceScreenSpaceRay(rayOrigin, rayDir, jitter, hitPixel, hitPoint, iterationCount);\n\n float dist = distance(rayOrigin, hitPoint);\n\n vec3 hitNormal = texture2D(gBufferTexture1, hitPixel).rgb * 2.0 - 1.0;\n hitNormal = normalize((toViewSpace * vec4(hitNormal, 0.0)).xyz);\n#ifdef PHYSICALLY_CORRECT\n float ndl = clamp(dot(N, rayDir), 0.0, 1.0);\n float vdh = clamp(dot(V, H), 0.0, 1.0);\n float ndh = clamp(dot(N, H), 0.0, 1.0);\n vec3 litTexel = vec3(0.0);\n if (dot(hitNormal, rayDir) &lt; 0.0 &amp;&amp; intersect) {\n litTexel = texture2D(sourceTexture, hitPixel).rgb;\n litTexel *= pow(clamp(1.0 - dist / 200.0, 0.0, 1.0), 3.0);\n\n }\n else {\n #ifdef SPECULARCUBEMAP_ENABLED\n vec3 rayDirW = normalize(toWorldSpace * vec4(rayDir, 0.0)).rgb;\n litTexel = RGBMDecode(textureCubeLodEXT(specularCubemap, rayDirW, 0.0), 8.12).rgb * specularIntensity;\n#endif\n }\n color.rgb += ndl * litTexel * (\n F_Schlick(ndl, spec) * G_Smith(g, ndv, ndl) * vdh / (ndh * ndv + 0.001)\n );\n }\n color.rgb /= float(SAMPLE_PER_FRAME);\n#else\n #if !defined(SPECULARCUBEMAP_ENABLED)\n if (dot(hitNormal, rayDir) &gt;= 0.0) {\n discard;\n }\n if (!intersect) {\n discard;\n }\n#endif\n float alpha = clamp(calculateAlpha(iterationCount, reflectivity, hitPixel, hitPoint, dist, rayDir), 0.0, 1.0);\n vec4 color = texture2D(sourceTexture, hitPixel);\n color.rgb *= alpha;\n\n#ifdef SPECULARCUBEMAP_ENABLED\n vec3 rayDirW = normalize(toWorldSpace * vec4(rayDir, 0.0)).rgb;\n alpha = alpha * (intersect ? 1.0 : 0.0);\n float bias = (1.0 -g) * 5.0;\n color.rgb += (1.0 - alpha)\n * RGBMDecode(textureCubeLodEXT(specularCubemap, rayDirW, bias), 8.12).rgb\n * specularIntensity;\n#endif\n\n#endif\n\n gl_FragColor = encodeHDR(color);\n}\n@end\n\n@export ecgl.ssr.blur\n\nuniform sampler2D texture;\nuniform sampler2D gBufferTexture1;\nuniform sampler2D gBufferTexture2;\nuniform mat4 projection;\nuniform float depthRange : 0.05;\n\nvarying vec2 v_Texcoord;\n\nuniform vec2 textureSize;\nuniform float blurSize : 1.0;\n\n#ifdef BLEND\n #ifdef SSAOTEX_ENABLED\nuniform sampler2D ssaoTex;\n #endif\nuniform sampler2D sourceTexture;\n#endif\n\nfloat getLinearDepth(vec2 coord)\n{\n float depth = texture2D(gBufferTexture2, coord).r * 2.0 - 1.0;\n return projection[3][2] / (depth * projection[2][3] - projection[2][2]);\n}\n\n@import clay.util.rgbm\n\n\nvoid main()\n{\n @import clay.compositor.kernel.gaussian_9\n\n vec4 centerNTexel = texture2D(gBufferTexture1, v_Texcoord);\n float g = centerNTexel.a;\n float maxBlurSize = clamp(1.0 - g, 0.0, 1.0) * blurSize;\n#ifdef VERTICAL\n vec2 off = vec2(0.0, maxBlurSize / textureSize.y);\n#else\n vec2 off = vec2(maxBlurSize / textureSize.x, 0.0);\n#endif\n\n vec2 coord = v_Texcoord;\n\n vec4 sum = vec4(0.0);\n float weightAll = 0.0;\n\n vec3 cN = centerNTexel.rgb * 2.0 - 1.0;\n float cD = getLinearDepth(v_Texcoord);\n for (int i = 0; i &lt; 9; i++) {\n vec2 coord = clamp((float(i) - 4.0) * off + v_Texcoord, vec2(0.0), vec2(1.0));\n float w = gaussianKernel[i]\n * clamp(dot(cN, texture2D(gBufferTexture1, coord).rgb * 2.0 - 1.0), 0.0, 1.0);\n float d = getLinearDepth(coord);\n w *= (1.0 - smoothstep(abs(cD - d) / depthRange, 0.0, 1.0));\n\n weightAll += w;\n sum += decodeHDR(texture2D(texture, coord)) * w;\n }\n\n#ifdef BLEND\n float aoFactor = 1.0;\n #ifdef SSAOTEX_ENABLED\n aoFactor = texture2D(ssaoTex, v_Texcoord).r;\n #endif\n gl_FragColor = encodeHDR(\n sum / weightAll * aoFactor + decodeHDR(texture2D(sourceTexture, v_Texcoord))\n );\n#else\n gl_FragColor = encodeHDR(sum / weightAll);\n#endif\n}\n\n@end"),SSRPass.prototype.setAmbientCubemap=function(specularCubemap,specularIntensity){this._ssrPass.material.set("specularCubemap",specularCubemap),this._ssrPass.material.set("specularIntensity",specularIntensity);var enableSpecularMap=specularCubemap&amp;&amp;specularIntensity;this._ssrPass.material[enableSpecularMap?"enableTexture":"disableTexture"]("specularCubemap")},SSRPass.prototype.update=function(renderer,camera,sourceTexture,frame){var width=renderer.getWidth(),height=renderer.getHeight(),ssrTexture=this._ssrTexture,texture2=this._texture2,texture3=this._texture3;ssrTexture.width=this._prevTexture.width=this._currentTexture.width=width/this._downScale,ssrTexture.height=this._prevTexture.height=this._currentTexture.height=height/this._downScale,texture2.width=texture3.width=width,texture2.height=texture3.height=height;var frameBuffer=this._frameBuffer,ssrPass=this._ssrPass,blurPass1=this._blurPass1,blurPass2=this._blurPass2,blendPass=this._blendPass,toViewSpace=new Matrix4,toWorldSpace=new Matrix4;Matrix4.transpose(toViewSpace,camera.worldTransform),Matrix4.transpose(toWorldSpace,camera.viewMatrix),ssrPass.setUniform("sourceTexture",sourceTexture),ssrPass.setUniform("projection",camera.projectionMatrix.array),ssrPass.setUniform("projectionInv",camera.invProjectionMatrix.array),ssrPass.setUniform("toViewSpace",toViewSpace.array),ssrPass.setUniform("toWorldSpace",toWorldSpace.array),ssrPass.setUniform("nearZ",camera.near);var percent=frame/this._totalSamples*this._samplePerFrame;if(ssrPass.setUniform("jitterOffset",percent),ssrPass.setUniform("sampleOffset",frame*this._samplePerFrame),blurPass1.setUniform("textureSize",[ssrTexture.width,ssrTexture.height]),blurPass2.setUniform("textureSize",[width,height]),blurPass2.setUniform("sourceTexture",sourceTexture),blurPass1.setUniform("projection",camera.projectionMatrix.array),blurPass2.setUniform("projection",camera.projectionMatrix.array),frameBuffer.attach(ssrTexture),frameBuffer.bind(renderer),ssrPass.render(renderer),this._physicallyCorrect&amp;&amp;(frameBuffer.attach(this._currentTexture),blendPass.setUniform("texture1",this._prevTexture),blendPass.setUniform("texture2",ssrTexture),blendPass.material.set({weight1:frame&gt;=1?.95:0,weight2:frame&gt;=1?.05:1}),blendPass.render(renderer)),frameBuffer.attach(texture2),blurPass1.setUniform("texture",this._physicallyCorrect?this._currentTexture:ssrTexture),blurPass1.render(renderer),frameBuffer.attach(texture3),blurPass2.setUniform("texture",texture2),blurPass2.render(renderer),frameBuffer.unbind(renderer),this._physicallyCorrect){var tmp=this._prevTexture;this._prevTexture=this._currentTexture,this._currentTexture=tmp}},SSRPass.prototype.getTargetTexture=function(){return this._texture3},SSRPass.prototype.setParameter=function(name,val){"maxIteration"===name?this._ssrPass.material.define("fragment","MAX_ITERATION",val):this._ssrPass.setUniform(name,val)},SSRPass.prototype.setPhysicallyCorrect=function(isPhysicallyCorrect){isPhysicallyCorrect?(this._normalDistribution||(this._normalDistribution=cubemapUtil.generateNormalDistribution(64,this._totalSamples)),this._ssrPass.material.define("fragment","PHYSICALLY_CORRECT"),this._ssrPass.material.set("normalDistribution",this._normalDistribution),this._ssrPass.material.set("normalDistributionSize",[64,this._totalSamples])):this._ssrPass.material.undefine("fragment","PHYSICALLY_CORRECT"),this._physicallyCorrect=isPhysicallyCorrect},SSRPass.prototype.setSSAOTexture=function(texture){var blendPass=this._blurPass2;texture?(blendPass.material.enableTexture("ssaoTex"),blendPass.material.set("ssaoTex",texture)):blendPass.material.disableTexture("ssaoTex")},SSRPass.prototype.isFinished=function(frame){return!this._physicallyCorrect||frame&gt;this._totalSamples/this._samplePerFrame},SSRPass.prototype.dispose=function(renderer){this._ssrTexture.dispose(renderer),this._texture2.dispose(renderer),this._texture3.dispose(renderer),this._prevTexture.dispose(renderer),this._currentTexture.dispose(renderer),this._frameBuffer.dispose(renderer)};const poissonKernel=[0,0,-.321585265978,-.154972575841,.458126042375,.188473391593,.842080129861,.527766490688,.147304551086,-.659453822776,-.331943915203,-.940619700594,.0479226680259,.54812163202,.701581552186,-.709825561388,-.295436780218,.940589268233,-.901489676764,.237713156085,.973570876096,-.109899459384,-.866792314779,-.451805525005,.330975007087,.800048655954,-.344275183665,.381779221166,-.386139432542,-.437418421534,-.576478634965,-.0148463392551,.385798197415,-.262426961053,-.666302061145,.682427250835,-.628010632582,-.732836215494,.10163141741,-.987658134403,.711995289051,-.320024291314,.0296005138058,.950296523438,.0130612307608,-.351024443122,-.879596633704,-.10478487883,.435712737232,.504254490347,.779203817497,.206477676721,.388264289969,-.896736162545,-.153106280781,-.629203242522,-.245517550697,.657969239148,.126830499058,.26862328493,-.634888119007,-.302301223431,.617074219636,.779817204925];function attachTextureToSlot(renderer,program,symbol,texture,slot){var gl=renderer.gl;program.setUniform(gl,"1i",symbol,slot),gl.activeTexture(gl.TEXTURE0+slot),texture.isRenderable()?texture.bind(renderer):texture.unbind(renderer)}function getBeforeRenderHook(renderer,defaultNormalMap,defaultBumpMap,defaultRoughnessMap,normalMaterial){var previousNormalMap,previousBumpMap,previousRoughnessMap,previousRenderable,gl=renderer.gl;return function(renderable,normalMaterial2,prevNormalMaterial){if(!previousRenderable||previousRenderable.material!==renderable.material){var material=renderable.material,program=renderable.__program,roughness=material.get("roughness");null==roughness&amp;&amp;(roughness=1);var normalMap=material.get("normalMap")||defaultNormalMap,roughnessMap=material.get("roughnessMap"),bumpMap=material.get("bumpMap"),uvRepeat=material.get("uvRepeat"),uvOffset=material.get("uvOffset"),detailUvRepeat=material.get("detailUvRepeat"),detailUvOffset=material.get("detailUvOffset"),useBumpMap=!!bumpMap&amp;&amp;material.isTextureEnabled("bumpMap"),useRoughnessMap=!!roughnessMap&amp;&amp;material.isTextureEnabled("roughnessMap"),doubleSide=material.isDefined("fragment","DOUBLE_SIDED");bumpMap=bumpMap||defaultBumpMap,roughnessMap=roughnessMap||defaultRoughnessMap,prevNormalMaterial!==normalMaterial2?(normalMaterial2.set("normalMap",normalMap),normalMaterial2.set("bumpMap",bumpMap),normalMaterial2.set("roughnessMap",roughnessMap),normalMaterial2.set("useBumpMap",useBumpMap),normalMaterial2.set("useRoughnessMap",useRoughnessMap),normalMaterial2.set("doubleSide",doubleSide),null!=uvRepeat&amp;&amp;normalMaterial2.set("uvRepeat",uvRepeat),null!=uvOffset&amp;&amp;normalMaterial2.set("uvOffset",uvOffset),null!=detailUvRepeat&amp;&amp;normalMaterial2.set("detailUvRepeat",detailUvRepeat),null!=detailUvOffset&amp;&amp;normalMaterial2.set("detailUvOffset",detailUvOffset),normalMaterial2.set("roughness",roughness)):(program.setUniform(gl,"1f","roughness",roughness),previousNormalMap!==normalMap&amp;&amp;attachTextureToSlot(renderer,program,"normalMap",normalMap,0),previousBumpMap!==bumpMap&amp;&amp;bumpMap&amp;&amp;attachTextureToSlot(renderer,program,"bumpMap",bumpMap,1),previousRoughnessMap!==roughnessMap&amp;&amp;roughnessMap&amp;&amp;attachTextureToSlot(renderer,program,"roughnessMap",roughnessMap,2),null!=uvRepeat&amp;&amp;program.setUniform(gl,"2f","uvRepeat",uvRepeat),null!=uvOffset&amp;&amp;program.setUniform(gl,"2f","uvOffset",uvOffset),null!=detailUvRepeat&amp;&amp;program.setUniform(gl,"2f","detailUvRepeat",detailUvRepeat),null!=detailUvOffset&amp;&amp;program.setUniform(gl,"2f","detailUvOffset",detailUvOffset),program.setUniform(gl,"1i","useBumpMap",+useBumpMap),program.setUniform(gl,"1i","useRoughnessMap",+useRoughnessMap),program.setUniform(gl,"1i","doubleSide",+doubleSide)),previousNormalMap=normalMap,previousBumpMap=bumpMap,previousRoughnessMap=roughnessMap,previousRenderable=renderable}}}function NormalPass(opt){this._depthTex=new Texture2D({format:Texture.DEPTH_COMPONENT,type:Texture.UNSIGNED_INT}),this._normalTex=new Texture2D({type:Texture.HALF_FLOAT}),this._framebuffer=new FrameBuffer,this._framebuffer.attach(this._normalTex),this._framebuffer.attach(this._depthTex,FrameBuffer.DEPTH_ATTACHMENT),this._normalMaterial=new Material({shader:new Shader(Shader.source("ecgl.normal.vertex"),Shader.source("ecgl.normal.fragment"))}),this._normalMaterial.enableTexture(["normalMap","bumpMap","roughnessMap"]),this._defaultNormalMap=textureUtil.createBlank("#000"),this._defaultBumpMap=textureUtil.createBlank("#000"),this._defaultRoughessMap=textureUtil.createBlank("#000"),this._debugPass=new Pass({fragment:Shader.source("clay.compositor.output")}),this._debugPass.setUniform("texture",this._normalTex),this._debugPass.material.undefine("fragment","OUTPUT_ALPHA")}function EdgePass(opt){opt=opt||{},this._edgePass=new Pass({fragment:Shader.source("ecgl.edge")}),this._edgePass.setUniform("normalTexture",opt.normalTexture),this._edgePass.setUniform("depthTexture",opt.depthTexture),this._targetTexture=new Texture2D({type:Texture.HALF_FLOAT}),this._frameBuffer=new FrameBuffer,this._frameBuffer.attach(this._targetTexture)}Shader.import("@export ecgl.normal.vertex\n\n@import ecgl.common.transformUniforms\n\n@import ecgl.common.uv.header\n\n@import ecgl.common.attributes\n\nvarying vec3 v_Normal;\nvarying vec3 v_WorldPosition;\n\n@import ecgl.common.normalMap.vertexHeader\n\n@import ecgl.common.vertexAnimation.header\n\nvoid main()\n{\n\n @import ecgl.common.vertexAnimation.main\n\n @import ecgl.common.uv.main\n\n v_Normal = normalize((worldInverseTranspose * vec4(normal, 0.0)).xyz);\n v_WorldPosition = (world * vec4(pos, 1.0)).xyz;\n\n @import ecgl.common.normalMap.vertexMain\n\n gl_Position = worldViewProjection * vec4(pos, 1.0);\n\n}\n\n\n@end\n\n\n@export ecgl.normal.fragment\n\n#define ROUGHNESS_CHANEL 0\n\nuniform bool useBumpMap;\nuniform bool useRoughnessMap;\nuniform bool doubleSide;\nuniform float roughness;\n\n@import ecgl.common.uv.fragmentHeader\n\nvarying vec3 v_Normal;\nvarying vec3 v_WorldPosition;\n\nuniform mat4 viewInverse : VIEWINVERSE;\n\n@import ecgl.common.normalMap.fragmentHeader\n@import ecgl.common.bumpMap.header\n\nuniform sampler2D roughnessMap;\n\nvoid main()\n{\n vec3 N = v_Normal;\n \n bool flipNormal = false;\n if (doubleSide) {\n vec3 eyePos = viewInverse[3].xyz;\n vec3 V = normalize(eyePos - v_WorldPosition);\n\n if (dot(N, V) &lt; 0.0) {\n flipNormal = true;\n }\n }\n\n @import ecgl.common.normalMap.fragmentMain\n\n if (useBumpMap) {\n N = bumpNormal(v_WorldPosition, v_Normal, N);\n }\n\n float g = 1.0 - roughness;\n\n if (useRoughnessMap) {\n float g2 = 1.0 - texture2D(roughnessMap, v_DetailTexcoord)[ROUGHNESS_CHANEL];\n g = clamp(g2 + (g - 0.5) * 2.0, 0.0, 1.0);\n }\n\n if (flipNormal) {\n N = -N;\n }\n\n gl_FragColor.rgb = (N.xyz + 1.0) * 0.5;\n gl_FragColor.a = g;\n}\n@end"),NormalPass.prototype.getDepthTexture=function(){return this._depthTex},NormalPass.prototype.getNormalTexture=function(){return this._normalTex},NormalPass.prototype.update=function(renderer,scene,camera){var width=renderer.getWidth(),height=renderer.getHeight(),depthTexture=this._depthTex,normalTexture=this._normalTex,normalMaterial=this._normalMaterial;depthTexture.width=width,depthTexture.height=height,normalTexture.width=width,normalTexture.height=height;var opaqueList=scene.getRenderList(camera).opaque;this._framebuffer.bind(renderer),renderer.gl.clearColor(0,0,0,0),renderer.gl.clear(renderer.gl.COLOR_BUFFER_BIT|renderer.gl.DEPTH_BUFFER_BIT),renderer.gl.disable(renderer.gl.BLEND),renderer.renderPass(opaqueList,camera,{getMaterial:function(){return normalMaterial},ifRender:function(object){return object.renderNormal},beforeRender:getBeforeRenderHook(renderer,this._defaultNormalMap,this._defaultBumpMap,this._defaultRoughessMap,this._normalMaterial),sort:renderer.opaqueSortCompare}),this._framebuffer.unbind(renderer)},NormalPass.prototype.renderDebug=function(renderer){this._debugPass.render(renderer)},NormalPass.prototype.dispose=function(renderer){this._depthTex.dispose(renderer),this._normalTex.dispose(renderer)},EdgePass.prototype.update=function(renderer,camera,sourceTexture,frame){var width=renderer.getWidth(),height=renderer.getHeight(),texture=this._targetTexture;texture.width=width,texture.height=height;var frameBuffer=this._frameBuffer;frameBuffer.bind(renderer),this._edgePass.setUniform("projectionInv",camera.invProjectionMatrix.array),this._edgePass.setUniform("textureSize",[width,height]),this._edgePass.setUniform("texture",sourceTexture),this._edgePass.render(renderer),frameBuffer.unbind(renderer)},EdgePass.prototype.getTargetTexture=function(){return this._targetTexture},EdgePass.prototype.setParameter=function(name,val){this._edgePass.setUniform(name,val)},EdgePass.prototype.dispose=function(renderer){this._targetTexture.dispose(renderer),this._frameBuffer.dispose(renderer)};const effectJson={nodes:[{name:"source",type:"texture",outputs:{color:{}}},{name:"source_half",shader:"#source(clay.compositor.downsample)",inputs:{texture:"source"},outputs:{color:{parameters:{width:"expr(width * 1.0 / 2)",height:"expr(height * 1.0 / 2)",type:"HALF_FLOAT"}}},parameters:{textureSize:"expr( [width * 1.0, height * 1.0] )"}},{name:"bright",shader:"#source(clay.compositor.bright)",inputs:{texture:"source_half"},outputs:{color:{parameters:{width:"expr(width * 1.0 / 2)",height:"expr(height * 1.0 / 2)",type:"HALF_FLOAT"}}},parameters:{threshold:2,scale:4,textureSize:"expr([width * 1.0 / 2, height / 2])"}},{name:"bright_downsample_4",shader:"#source(clay.compositor.downsample)",inputs:{texture:"bright"},outputs:{color:{parameters:{width:"expr(width * 1.0 / 4)",height:"expr(height * 1.0 / 4)",type:"HALF_FLOAT"}}},parameters:{textureSize:"expr( [width * 1.0 / 2, height / 2] )"}},{name:"bright_downsample_8",shader:"#source(clay.compositor.downsample)",inputs:{texture:"bright_downsample_4"},outputs:{color:{parameters:{width:"expr(width * 1.0 / 8)",height:"expr(height * 1.0 / 8)",type:"HALF_FLOAT"}}},parameters:{textureSize:"expr( [width * 1.0 / 4, height / 4] )"}},{name:"bright_downsample_16",shader:"#source(clay.compositor.downsample)",inputs:{texture:"bright_downsample_8"},outputs:{color:{parameters:{width:"expr(width * 1.0 / 16)",height:"expr(height * 1.0 / 16)",type:"HALF_FLOAT"}}},parameters:{textureSize:"expr( [width * 1.0 / 8, height / 8] )"}},{name:"bright_downsample_32",shader:"#source(clay.compositor.downsample)",inputs:{texture:"bright_downsample_16"},outputs:{color:{parameters:{width:"expr(width * 1.0 / 32)",height:"expr(height * 1.0 / 32)",type:"HALF_FLOAT"}}},parameters:{textureSize:"expr( [width * 1.0 / 16, height / 16] )"}},{name:"bright_upsample_16_blur_h",shader:"#source(clay.compositor.gaussian_blur)",inputs:{texture:"bright_downsample_32"},outputs:{color:{parameters:{width:"expr(width * 1.0 / 16)",height:"expr(height * 1.0 / 16)",type:"HALF_FLOAT"}}},parameters:{blurSize:1,blurDir:0,textureSize:"expr( [width * 1.0 / 32, height / 32] )"}},{name:"bright_upsample_16_blur_v",shader:"#source(clay.compositor.gaussian_blur)",inputs:{texture:"bright_upsample_16_blur_h"},outputs:{color:{parameters:{width:"expr(width * 1.0 / 16)",height:"expr(height * 1.0 / 16)",type:"HALF_FLOAT"}}},parameters:{blurSize:1,blurDir:1,textureSize:"expr( [width * 1.0 / 16, height * 1.0 / 16] )"}},{name:"bright_upsample_8_blur_h",shader:"#source(clay.compositor.gaussian_blur)",inputs:{texture:"bright_downsample_16"},outputs:{color:{parameters:{width:"expr(width * 1.0 / 8)",height:"expr(height * 1.0 / 8)",type:"HALF_FLOAT"}}},parameters:{blurSize:1,blurDir:0,textureSize:"expr( [width * 1.0 / 16, height * 1.0 / 16] )"}},{name:"bright_upsample_8_blur_v",shader:"#source(clay.compositor.gaussian_blur)",inputs:{texture:"bright_upsample_8_blur_h"},outputs:{color:{parameters:{width:"expr(width * 1.0 / 8)",height:"expr(height * 1.0 / 8)",type:"HALF_FLOAT"}}},parameters:{blurSize:1,blurDir:1,textureSize:"expr( [width * 1.0 / 8, height * 1.0 / 8] )"}},{name:"bright_upsample_8_blend",shader:"#source(clay.compositor.blend)",inputs:{texture1:"bright_upsample_8_blur_v",texture2:"bright_upsample_16_blur_v"},outputs:{color:{parameters:{width:"expr(width * 1.0 / 8)",height:"expr(height * 1.0 / 8)",type:"HALF_FLOAT"}}},parameters:{weight1:.3,weight2:.7}},{name:"bright_upsample_4_blur_h",shader:"#source(clay.compositor.gaussian_blur)",inputs:{texture:"bright_downsample_8"},outputs:{color:{parameters:{width:"expr(width * 1.0 / 4)",height:"expr(height * 1.0 / 4)",type:"HALF_FLOAT"}}},parameters:{blurSize:1,blurDir:0,textureSize:"expr( [width * 1.0 / 8, height * 1.0 / 8] )"}},{name:"bright_upsample_4_blur_v",shader:"#source(clay.compositor.gaussian_blur)",inputs:{texture:"bright_upsample_4_blur_h"},outputs:{color:{parameters:{width:"expr(width * 1.0 / 4)",height:"expr(height * 1.0 / 4)",type:"HALF_FLOAT"}}},parameters:{blurSize:1,blurDir:1,textureSize:"expr( [width * 1.0 / 4, height * 1.0 / 4] )"}},{name:"bright_upsample_4_blend",shader:"#source(clay.compositor.blend)",inputs:{texture1:"bright_upsample_4_blur_v",texture2:"bright_upsample_8_blend"},outputs:{color:{parameters:{width:"expr(width * 1.0 / 4)",height:"expr(height * 1.0 / 4)",type:"HALF_FLOAT"}}},parameters:{weight1:.3,weight2:.7}},{name:"bright_upsample_2_blur_h",shader:"#source(clay.compositor.gaussian_blur)",inputs:{texture:"bright_downsample_4"},outputs:{color:{parameters:{width:"expr(width * 1.0 / 2)",height:"expr(height * 1.0 / 2)",type:"HALF_FLOAT"}}},parameters:{blurSize:1,blurDir:0,textureSize:"expr( [width * 1.0 / 4, height * 1.0 / 4] )"}},{name:"bright_upsample_2_blur_v",shader:"#source(clay.compositor.gaussian_blur)",inputs:{texture:"bright_upsample_2_blur_h"},outputs:{color:{parameters:{width:"expr(width * 1.0 / 2)",height:"expr(height * 1.0 / 2)",type:"HALF_FLOAT"}}},parameters:{blurSize:1,blurDir:1,textureSize:"expr( [width * 1.0 / 2, height * 1.0 / 2] )"}},{name:"bright_upsample_2_blend",shader:"#source(clay.compositor.blend)",inputs:{texture1:"bright_upsample_2_blur_v",texture2:"bright_upsample_4_blend"},outputs:{color:{parameters:{width:"expr(width * 1.0 / 2)",height:"expr(height * 1.0 / 2)",type:"HALF_FLOAT"}}},parameters:{weight1:.3,weight2:.7}},{name:"bright_upsample_full_blur_h",shader:"#source(clay.compositor.gaussian_blur)",inputs:{texture:"bright"},outputs:{color:{parameters:{width:"expr(width * 1.0)",height:"expr(height * 1.0)",type:"HALF_FLOAT"}}},parameters:{blurSize:1,blurDir:0,textureSize:"expr( [width * 1.0 / 2, height * 1.0 / 2] )"}},{name:"bright_upsample_full_blur_v",shader:"#source(clay.compositor.gaussian_blur)",inputs:{texture:"bright_upsample_full_blur_h"},outputs:{color:{parameters:{width:"expr(width * 1.0)",height:"expr(height * 1.0)",type:"HALF_FLOAT"}}},parameters:{blurSize:1,blurDir:1,textureSize:"expr( [width * 1.0, height * 1.0] )"}},{name:"bloom_composite",shader:"#source(clay.compositor.blend)",inputs:{texture1:"bright_upsample_full_blur_v",texture2:"bright_upsample_2_blend"},outputs:{color:{parameters:{width:"expr(width * 1.0)",height:"expr(height * 1.0)",type:"HALF_FLOAT"}}},parameters:{weight1:.3,weight2:.7}},{name:"coc",shader:"#source(ecgl.dof.coc)",outputs:{color:{parameters:{minFilter:"NEAREST",magFilter:"NEAREST",width:"expr(width * 1.0)",height:"expr(height * 1.0)"}}},parameters:{focalDist:50,focalRange:30}},{name:"dof_far_blur",shader:"#source(ecgl.dof.diskBlur)",inputs:{texture:"source",coc:"coc"},outputs:{color:{parameters:{width:"expr(width * 1.0)",height:"expr(height * 1.0)",type:"HALF_FLOAT"}}},parameters:{textureSize:"expr( [width * 1.0, height * 1.0] )"}},{name:"dof_near_blur",shader:"#source(ecgl.dof.diskBlur)",inputs:{texture:"source",coc:"coc"},outputs:{color:{parameters:{width:"expr(width * 1.0)",height:"expr(height * 1.0)",type:"HALF_FLOAT"}}},parameters:{textureSize:"expr( [width * 1.0, height * 1.0] )"},defines:{BLUR_NEARFIELD:null}},{name:"dof_coc_blur",shader:"#source(ecgl.dof.diskBlur)",inputs:{texture:"coc"},outputs:{color:{parameters:{minFilter:"NEAREST",magFilter:"NEAREST",width:"expr(width * 1.0)",height:"expr(height * 1.0)"}}},parameters:{textureSize:"expr( [width * 1.0, height * 1.0] )"},defines:{BLUR_COC:null}},{name:"dof_composite",shader:"#source(ecgl.dof.composite)",inputs:{original:"source",blurred:"dof_far_blur",nearfield:"dof_near_blur",coc:"coc",nearcoc:"dof_coc_blur"},outputs:{color:{parameters:{width:"expr(width * 1.0)",height:"expr(height * 1.0)",type:"HALF_FLOAT"}}}},{name:"composite",shader:"#source(clay.compositor.hdr.composite)",inputs:{texture:"source",bloom:"bloom_composite"},outputs:{color:{parameters:{width:"expr(width * 1.0)",height:"expr(height * 1.0)"}}},defines:{}},{name:"FXAA",shader:"#source(clay.compositor.fxaa)",inputs:{texture:"composite"}}]};function makeCommonOutputs(getWidth,getHeight){return{color:{parameters:{width:getWidth,height:getHeight}}}}Shader.import(blurCode),Shader.import(lutCode),Shader.import(outputCode),Shader.import(brightCode),Shader.import(downsampleCode),Shader.import(upsampleCode),Shader.import(hdrCode),Shader.import(blendCode),Shader.import(fxaaCode),Shader.import("@export ecgl.dof.coc\n\nuniform sampler2D depth;\n\nuniform float zNear: 0.1;\nuniform float zFar: 2000;\n\nuniform float focalDistance: 3;\nuniform float focalRange: 1;\nuniform float focalLength: 30;\nuniform float fstop: 2.8;\n\nvarying vec2 v_Texcoord;\n\n@import clay.util.encode_float\n\nvoid main()\n{\n float z = texture2D(depth, v_Texcoord).r * 2.0 - 1.0;\n\n float dist = 2.0 * zNear * zFar / (zFar + zNear - z * (zFar - zNear));\n\n float aperture = focalLength / fstop;\n\n float coc;\n\n float uppper = focalDistance + focalRange;\n float lower = focalDistance - focalRange;\n if (dist &lt;= uppper &amp;&amp; dist &gt;= lower) {\n coc = 0.5;\n }\n else {\n float focalAdjusted = dist &gt; uppper ? uppper : lower;\n\n coc = abs(aperture * (focalLength * (dist - focalAdjusted)) / (dist * (focalAdjusted - focalLength)));\n coc = clamp(coc, 0.0, 2.0) / 2.00001;\n\n if (dist &lt; lower) {\n coc = -coc;\n }\n coc = coc * 0.5 + 0.5;\n }\n\n gl_FragColor = encodeFloat(coc);\n}\n@end\n\n\n@export ecgl.dof.composite\n\n#define DEBUG 0\n\nuniform sampler2D original;\nuniform sampler2D blurred;\nuniform sampler2D nearfield;\nuniform sampler2D coc;\nuniform sampler2D nearcoc;\nvarying vec2 v_Texcoord;\n\n@import clay.util.rgbm\n@import clay.util.float\n\nvoid main()\n{\n vec4 blurredColor = texture2D(blurred, v_Texcoord);\n vec4 originalColor = texture2D(original, v_Texcoord);\n\n float fCoc = decodeFloat(texture2D(coc, v_Texcoord));\n\n fCoc = abs(fCoc * 2.0 - 1.0);\n\n float weight = smoothstep(0.0, 1.0, fCoc);\n \n#ifdef NEARFIELD_ENABLED\n vec4 nearfieldColor = texture2D(nearfield, v_Texcoord);\n float fNearCoc = decodeFloat(texture2D(nearcoc, v_Texcoord));\n fNearCoc = abs(fNearCoc * 2.0 - 1.0);\n\n gl_FragColor = encodeHDR(\n mix(\n nearfieldColor, mix(originalColor, blurredColor, weight),\n pow(1.0 - fNearCoc, 4.0)\n )\n );\n#else\n gl_FragColor = encodeHDR(mix(originalColor, blurredColor, weight));\n#endif\n\n}\n\n@end\n\n\n\n@export ecgl.dof.diskBlur\n\n#define POISSON_KERNEL_SIZE 16;\n\nuniform sampler2D texture;\nuniform sampler2D coc;\nvarying vec2 v_Texcoord;\n\nuniform float blurRadius : 10.0;\nuniform vec2 textureSize : [512.0, 512.0];\n\nuniform vec2 poissonKernel[POISSON_KERNEL_SIZE];\n\nuniform float percent;\n\nfloat nrand(const in vec2 n) {\n return fract(sin(dot(n.xy ,vec2(12.9898,78.233))) * 43758.5453);\n}\n\n@import clay.util.rgbm\n@import clay.util.float\n\n\nvoid main()\n{\n vec2 offset = blurRadius / textureSize;\n\n float rnd = 6.28318 * nrand(v_Texcoord + 0.07 * percent );\n float cosa = cos(rnd);\n float sina = sin(rnd);\n vec4 basis = vec4(cosa, -sina, sina, cosa);\n\n#if !defined(BLUR_NEARFIELD) &amp;&amp; !defined(BLUR_COC)\n offset *= abs(decodeFloat(texture2D(coc, v_Texcoord)) * 2.0 - 1.0);\n#endif\n\n#ifdef BLUR_COC\n float cocSum = 0.0;\n#else\n vec4 color = vec4(0.0);\n#endif\n\n\n float weightSum = 0.0;\n\n for (int i = 0; i &lt; POISSON_KERNEL_SIZE; i++) {\n vec2 ofs = poissonKernel[i];\n\n ofs = vec2(dot(ofs, basis.xy), dot(ofs, basis.zw));\n\n vec2 uv = v_Texcoord + ofs * offset;\n vec4 texel = texture2D(texture, uv);\n\n float w = 1.0;\n#ifdef BLUR_COC\n float fCoc = decodeFloat(texel) * 2.0 - 1.0;\n cocSum += clamp(fCoc, -1.0, 0.0) * w;\n#else\n texel = texel;\n #if !defined(BLUR_NEARFIELD)\n float fCoc = decodeFloat(texture2D(coc, uv)) * 2.0 - 1.0;\n w *= abs(fCoc);\n #endif\n texel.rgb *= texel.a;\n color += texel * w;\n#endif\n\n weightSum += w;\n }\n\n#ifdef BLUR_COC\n gl_FragColor = encodeFloat(clamp(cocSum / weightSum, -1.0, 0.0) * 0.5 + 0.5);\n#else\n color /= weightSum;\n color.rgb /= (color.a + 0.0001);\n gl_FragColor = color;\n#endif\n}\n\n@end"),Shader.import("@export ecgl.edge\n\nuniform sampler2D texture;\n\nuniform sampler2D normalTexture;\nuniform sampler2D depthTexture;\n\nuniform mat4 projectionInv;\n\nuniform vec2 textureSize;\n\nuniform vec4 edgeColor: [0,0,0,0.8];\n\nvarying vec2 v_Texcoord;\n\nvec3 packColor(vec2 coord) {\n float z = texture2D(depthTexture, coord).r * 2.0 - 1.0;\n vec4 p = vec4(v_Texcoord * 2.0 - 1.0, z, 1.0);\n vec4 p4 = projectionInv * p;\n\n return vec3(\n texture2D(normalTexture, coord).rg,\n -p4.z / p4.w / 5.0\n );\n}\n\nvoid main() {\n vec2 cc = v_Texcoord;\n vec3 center = packColor(cc);\n\n float size = clamp(1.0 - (center.z - 10.0) / 100.0, 0.0, 1.0) * 0.5;\n float dx = size / textureSize.x;\n float dy = size / textureSize.y;\n\n vec2 coord;\n vec3 topLeft = packColor(cc+vec2(-dx, -dy));\n vec3 top = packColor(cc+vec2(0.0, -dy));\n vec3 topRight = packColor(cc+vec2(dx, -dy));\n vec3 left = packColor(cc+vec2(-dx, 0.0));\n vec3 right = packColor(cc+vec2(dx, 0.0));\n vec3 bottomLeft = packColor(cc+vec2(-dx, dy));\n vec3 bottom = packColor(cc+vec2(0.0, dy));\n vec3 bottomRight = packColor(cc+vec2(dx, dy));\n\n vec3 v = -topLeft-2.0*top-topRight+bottomLeft+2.0*bottom+bottomRight;\n vec3 h = -bottomLeft-2.0*left-topLeft+bottomRight+2.0*right+topRight;\n\n float edge = sqrt(dot(h, h) + dot(v, v));\n\n edge = smoothstep(0.8, 1.0, edge);\n\n gl_FragColor = mix(texture2D(texture, v_Texcoord), vec4(edgeColor.rgb, 1.0), edgeColor.a * edge);\n}\n@end");var FINAL_NODES_CHAIN=["composite","FXAA"];function EffectCompositor(){this._width,this._height,this._dpr,this._sourceTexture=new Texture2D({type:Texture.HALF_FLOAT}),this._depthTexture=new Texture2D({format:Texture.DEPTH_COMPONENT,type:Texture.UNSIGNED_INT}),this._framebuffer=new FrameBuffer,this._framebuffer.attach(this._sourceTexture),this._framebuffer.attach(this._depthTexture,FrameBuffer.DEPTH_ATTACHMENT),this._normalPass=new NormalPass,this._compositor=createCompositor(effectJson);var sourceNode=this._compositor.getNodeByName("source");sourceNode.texture=this._sourceTexture;var cocNode=this._compositor.getNodeByName("coc");this._sourceNode=sourceNode,this._cocNode=cocNode,this._compositeNode=this._compositor.getNodeByName("composite"),this._fxaaNode=this._compositor.getNodeByName("FXAA"),this._dofBlurNodes=["dof_far_blur","dof_near_blur","dof_coc_blur"].map(function(name){return this._compositor.getNodeByName(name)},this),this._dofBlurKernel=0,this._dofBlurKernelSize=new Float32Array(0),this._finalNodesChain=FINAL_NODES_CHAIN.map(function(name){return this._compositor.getNodeByName(name)},this);var gBufferObj={normalTexture:this._normalPass.getNormalTexture(),depthTexture:this._normalPass.getDepthTexture()};this._ssaoPass=new SSAOPass(gBufferObj),this._ssrPass=new SSRPass(gBufferObj),this._edgePass=new EdgePass(gBufferObj)}function TemporalSuperSampling(frames){for(var haltonSequence=[],i=0;i&lt;30;i++)haltonSequence.push([halton(i,2),halton(i,3)]);this._haltonSequence=haltonSequence,this._frame=0,this._sourceTex=new Texture2D,this._sourceFb=new FrameBuffer,this._sourceFb.attach(this._sourceTex),this._prevFrameTex=new Texture2D,this._outputTex=new Texture2D;var blendPass=this._blendPass=new Pass({fragment:Shader.source("clay.compositor.blend")});blendPass.material.disableTexturesAll(),blendPass.material.enableTexture(["texture1","texture2"]),this._blendFb=new FrameBuffer({depthBuffer:!1}),this._outputPass=new Pass({fragment:Shader.source("clay.compositor.output"),blendWithPrevious:!0}),this._outputPass.material.define("fragment","OUTPUT_ALPHA"),this._outputPass.material.blend=function(_gl){_gl.blendEquationSeparate(_gl.FUNC_ADD,_gl.FUNC_ADD),_gl.blendFuncSeparate(_gl.ONE,_gl.ONE_MINUS_SRC_ALPHA,_gl.ONE,_gl.ONE_MINUS_SRC_ALPHA)}}function ViewGL(projection){projection=projection||"perspective",this.layer=null,this.scene=new Scene,this.rootNode=this.scene,this.viewport={x:0,y:0,width:0,height:0},this.setProjection(projection),this._compositor=new EffectCompositor,this._temporalSS=new TemporalSuperSampling,this._shadowMapPass=new ShadowMapPass;for(var pcfKernels=[],off=0,i=0;i&lt;30;i++){for(var pcfKernel=[],k=0;k&lt;6;k++)pcfKernel.push(4*halton(off,2)-2),pcfKernel.push(4*halton(off,3)-2),off++;pcfKernels.push(pcfKernel)}this._pcfKernels=pcfKernels,this.scene.on("beforerender",function(renderer,scene,camera){this.needsTemporalSS()&amp;&amp;this._temporalSS.jitterProjection(renderer,camera)},this)}EffectCompositor.prototype.resize=function(width,height,dpr){width*=dpr=dpr||1,height*=dpr;var sourceTexture=this._sourceTexture,depthTexture=this._depthTexture;sourceTexture.width=width,sourceTexture.height=height,depthTexture.width=width,depthTexture.height=height;var rendererMock={getWidth:function(){return width},getHeight:function(){return height},getDevicePixelRatio:function(){return dpr}};function wrapCallback(obj,key){if("function"==typeof obj[key]){var oldFunc=obj[key].__original||obj[key];obj[key]=function(renderer){return oldFunc.call(this,rendererMock)},obj[key].__original=oldFunc}}this._compositor.nodes.forEach(function(node){for(var outKey in node.outputs){var parameters=node.outputs[outKey].parameters;parameters&amp;&amp;(wrapCallback(parameters,"width"),wrapCallback(parameters,"height"))}for(var paramKey in node.parameters)wrapCallback(node.parameters,paramKey)}),this._width=width,this._height=height,this._dpr=dpr},EffectCompositor.prototype.getWidth=function(){return this._width},EffectCompositor.prototype.getHeight=function(){return this._height},EffectCompositor.prototype._ifRenderNormalPass=function(){return this._enableSSAO||this._enableEdge||this._enableSSR},EffectCompositor.prototype._getPrevNode=function(node){for(var idx=FINAL_NODES_CHAIN.indexOf(node.name)-1,prevNode=this._finalNodesChain[idx];prevNode&amp;&amp;!this._compositor.getNodeByName(prevNode.name);)idx-=1,prevNode=this._finalNodesChain[idx];return prevNode},EffectCompositor.prototype._getNextNode=function(node){for(var idx=FINAL_NODES_CHAIN.indexOf(node.name)+1,nextNode=this._finalNodesChain[idx];nextNode&amp;&amp;!this._compositor.getNodeByName(nextNode.name);)idx+=1,nextNode=this._finalNodesChain[idx];return nextNode},EffectCompositor.prototype._addChainNode=function(node){var prevNode=this._getPrevNode(node),nextNode=this._getNextNode(node);prevNode&amp;&amp;(node.inputs.texture=prevNode.name,nextNode?(node.outputs=makeCommonOutputs(this.getWidth.bind(this),this.getHeight.bind(this)),nextNode.inputs.texture=node.name):node.outputs=null,this._compositor.addNode(node))},EffectCompositor.prototype._removeChainNode=function(node){var prevNode=this._getPrevNode(node),nextNode=this._getNextNode(node);prevNode&amp;&amp;(nextNode?(prevNode.outputs=makeCommonOutputs(this.getWidth.bind(this),this.getHeight.bind(this)),nextNode.inputs.texture=prevNode.name):prevNode.outputs=null,this._compositor.removeNode(node))},EffectCompositor.prototype.updateNormal=function(renderer,scene,camera,frame){this._ifRenderNormalPass()&amp;&amp;this._normalPass.update(renderer,scene,camera)},EffectCompositor.prototype.updateSSAO=function(renderer,scene,camera,frame){this._ssaoPass.update(renderer,camera,frame)},EffectCompositor.prototype.enableSSAO=function(){this._enableSSAO=!0},EffectCompositor.prototype.disableSSAO=function(){this._enableSSAO=!1},EffectCompositor.prototype.enableSSR=function(){this._enableSSR=!0},EffectCompositor.prototype.disableSSR=function(){this._enableSSR=!1},EffectCompositor.prototype.getSSAOTexture=function(){return this._ssaoPass.getTargetTexture()},EffectCompositor.prototype.getSourceFrameBuffer=function(){return this._framebuffer},EffectCompositor.prototype.getSourceTexture=function(){return this._sourceTexture},EffectCompositor.prototype.disableFXAA=function(){this._removeChainNode(this._fxaaNode)},EffectCompositor.prototype.enableFXAA=function(){this._addChainNode(this._fxaaNode)},EffectCompositor.prototype.enableBloom=function(){this._compositeNode.inputs.bloom="bloom_composite",this._compositor.dirty()},EffectCompositor.prototype.disableBloom=function(){this._compositeNode.inputs.bloom=null,this._compositor.dirty()},EffectCompositor.prototype.enableDOF=function(){this._compositeNode.inputs.texture="dof_composite",this._compositor.dirty()},EffectCompositor.prototype.disableDOF=function(){this._compositeNode.inputs.texture="source",this._compositor.dirty()},EffectCompositor.prototype.enableColorCorrection=function(){this._compositeNode.define("COLOR_CORRECTION"),this._enableColorCorrection=!0},EffectCompositor.prototype.disableColorCorrection=function(){this._compositeNode.undefine("COLOR_CORRECTION"),this._enableColorCorrection=!1},EffectCompositor.prototype.enableEdge=function(){this._enableEdge=!0},EffectCompositor.prototype.disableEdge=function(){this._enableEdge=!1},EffectCompositor.prototype.setBloomIntensity=function(value){this._compositeNode.setParameter("bloomIntensity",value)},EffectCompositor.prototype.setSSAOParameter=function(name,value){switch(name){case"quality":var kernelSize={low:6,medium:12,high:32,ultra:62}[value]||12;this._ssaoPass.setParameter("kernelSize",kernelSize);break;case"radius":this._ssaoPass.setParameter(name,value),this._ssaoPass.setParameter("bias",value/200);break;case"intensity":this._ssaoPass.setParameter(name,value)}},EffectCompositor.prototype.setDOFParameter=function(name,value){switch(name){case"focalDistance":case"focalRange":case"fstop":this._cocNode.setParameter(name,value);break;case"blurRadius":for(var i=0;i&lt;this._dofBlurNodes.length;i++)this._dofBlurNodes[i].setParameter("blurRadius",value);break;case"quality":var kernelSize={low:4,medium:8,high:16,ultra:32}[value]||8;this._dofBlurKernelSize=kernelSize;for(i=0;i&lt;this._dofBlurNodes.length;i++)this._dofBlurNodes[i].pass.material.define("POISSON_KERNEL_SIZE",kernelSize);this._dofBlurKernel=new Float32Array(2*kernelSize)}},EffectCompositor.prototype.setSSRParameter=function(name,value){if(null!=value)switch(name){case"quality":var maxIteration={low:10,medium:15,high:30,ultra:80}[value]||20,pixelStride={low:32,medium:16,high:8,ultra:4}[value]||16;this._ssrPass.setParameter("maxIteration",maxIteration),this._ssrPass.setParameter("pixelStride",pixelStride);break;case"maxRoughness":this._ssrPass.setParameter("minGlossiness",Math.max(Math.min(1-value,1),0));break;case"physical":this.setPhysicallyCorrectSSR(value);break;default:console.warn("Unkown SSR parameter "+name)}},EffectCompositor.prototype.setPhysicallyCorrectSSR=function(physical){this._ssrPass.setPhysicallyCorrect(physical)},EffectCompositor.prototype.setEdgeColor=function(value){var color=graphicGL.parseColor(value);this._edgePass.setParameter("edgeColor",color)},EffectCompositor.prototype.setExposure=function(value){this._compositeNode.setParameter("exposure",Math.pow(2,value))},EffectCompositor.prototype.setColorLookupTexture=function(image,api){this._compositeNode.pass.material.setTextureImage("lut",this._enableColorCorrection?image:"none",api,{minFilter:graphicGL.Texture.NEAREST,magFilter:graphicGL.Texture.NEAREST,flipY:!1})},EffectCompositor.prototype.setColorCorrection=function(type,value){this._compositeNode.setParameter(type,value)},EffectCompositor.prototype.isSSREnabled=function(){return this._enableSSR},EffectCompositor.prototype.composite=function(renderer,scene,camera,framebuffer,frame){var sourceTexture=this._sourceTexture,targetTexture=sourceTexture;this._enableEdge&amp;&amp;(this._edgePass.update(renderer,camera,sourceTexture,frame),sourceTexture=targetTexture=this._edgePass.getTargetTexture()),this._enableSSR&amp;&amp;(this._ssrPass.update(renderer,camera,sourceTexture,frame),targetTexture=this._ssrPass.getTargetTexture(),this._ssrPass.setSSAOTexture(this._enableSSAO?this._ssaoPass.getTargetTexture():null)),this._sourceNode.texture=targetTexture,this._cocNode.setParameter("depth",this._depthTexture);for(var blurKernel=this._dofBlurKernel,blurKernelSize=this._dofBlurKernelSize,kernelOffset=frame%Math.floor(poissonKernel.length/2/blurKernelSize),i=0;i&lt;2*blurKernelSize;i++)blurKernel[i]=poissonKernel[i+kernelOffset*blurKernelSize*2];for(i=0;i&lt;this._dofBlurNodes.length;i++)this._dofBlurNodes[i].setParameter("percent",frame/30),this._dofBlurNodes[i].setParameter("poissonKernel",blurKernel);this._cocNode.setParameter("zNear",camera.near),this._cocNode.setParameter("zFar",camera.far),this._compositor.render(renderer,framebuffer)},EffectCompositor.prototype.dispose=function(renderer){this._sourceTexture.dispose(renderer),this._depthTexture.dispose(renderer),this._framebuffer.dispose(renderer),this._compositor.dispose(renderer),this._normalPass.dispose(renderer),this._ssaoPass.dispose(renderer)},TemporalSuperSampling.prototype={constructor:TemporalSuperSampling,jitterProjection:function(renderer,camera){var viewport=renderer.viewport,dpr=viewport.devicePixelRatio||renderer.getDevicePixelRatio(),width=viewport.width*dpr,height=viewport.height*dpr,offset=this._haltonSequence[this._frame%this._haltonSequence.length],translationMat=new Matrix4;translationMat.array[12]=(2*offset[0]-1)/width,translationMat.array[13]=(2*offset[1]-1)/height,Matrix4.mul(camera.projectionMatrix,translationMat,camera.projectionMatrix),Matrix4.invert(camera.invProjectionMatrix,camera.projectionMatrix)},resetFrame:function(){this._frame=0},getFrame:function(){return this._frame},getSourceFrameBuffer:function(){return this._sourceFb},getOutputTexture:function(){return this._outputTex},resize:function(width,height){this._prevFrameTex.width=width,this._prevFrameTex.height=height,this._outputTex.width=width,this._outputTex.height=height,this._sourceTex.width=width,this._sourceTex.height=height,this._prevFrameTex.dirty(),this._outputTex.dirty(),this._sourceTex.dirty()},isFinished:function(){return this._frame&gt;=this._haltonSequence.length},render:function(renderer,sourceTex,notOutput){var blendPass=this._blendPass;0===this._frame?(blendPass.setUniform("weight1",0),blendPass.setUniform("weight2",1)):(blendPass.setUniform("weight1",.9),blendPass.setUniform("weight2",.1)),blendPass.setUniform("texture1",this._prevFrameTex),blendPass.setUniform("texture2",sourceTex||this._sourceTex),this._blendFb.attach(this._outputTex),this._blendFb.bind(renderer),blendPass.render(renderer),this._blendFb.unbind(renderer),notOutput||(this._outputPass.setUniform("texture",this._outputTex),this._outputPass.render(renderer));var tmp=this._prevFrameTex;this._prevFrameTex=this._outputTex,this._outputTex=tmp,this._frame++},dispose:function(renderer){this._sourceFb.dispose(renderer),this._blendFb.dispose(renderer),this._prevFrameTex.dispose(renderer),this._outputTex.dispose(renderer),this._sourceTex.dispose(renderer),this._outputPass.dispose(renderer),this._blendPass.dispose(renderer)}},ViewGL.prototype.setProjection=function(projection){var oldCamera=this.camera;oldCamera&amp;&amp;oldCamera.update(),"perspective"===projection?this.camera instanceof Perspective||(this.camera=new Perspective,oldCamera&amp;&amp;this.camera.setLocalTransform(oldCamera.localTransform)):this.camera instanceof Orthographic||(this.camera=new Orthographic,oldCamera&amp;&amp;this.camera.setLocalTransform(oldCamera.localTransform)),this.camera.near=.1,this.camera.far=2e3},ViewGL.prototype.setViewport=function(x,y,width,height,dpr){this.camera instanceof Perspective&amp;&amp;(this.camera.aspect=width/height),dpr=dpr||1,this.viewport.x=x,this.viewport.y=y,this.viewport.width=width,this.viewport.height=height,this.viewport.devicePixelRatio=dpr,this._compositor.resize(width*dpr,height*dpr),this._temporalSS.resize(width*dpr,height*dpr)},ViewGL.prototype.containPoint=function(x,y){var viewport=this.viewport;return y=this.layer.renderer.getHeight()-y,x&gt;=viewport.x&amp;&amp;y&gt;=viewport.y&amp;&amp;x&lt;=viewport.x+viewport.width&amp;&amp;y&lt;=viewport.y+viewport.height};var ndc=new Vector2;function resizeCartesian3D(grid3DModel,api){var boxLayoutOption=grid3DModel.getBoxLayoutParams(),viewport=getLayoutRect(boxLayoutOption,{width:api.getWidth(),height:api.getHeight()});viewport.y=api.getHeight()-viewport.y-viewport.height,this.viewGL.setViewport(viewport.x,viewport.y,viewport.width,viewport.height,api.getDevicePixelRatio());var boxWidth=grid3DModel.get("boxWidth"),boxHeight=grid3DModel.get("boxHeight"),boxDepth=grid3DModel.get("boxDepth");this.getAxis("x").setExtent(-boxWidth/2,boxWidth/2),this.getAxis("y").setExtent(boxDepth/2,-boxDepth/2),this.getAxis("z").setExtent(-boxHeight/2,boxHeight/2),this.size=[boxWidth,boxHeight,boxDepth]}function updateCartesian3D(ecModel,api){var dataExtents={};ecModel.eachSeries(function(seriesModel){if(seriesModel.coordinateSystem===this){var data=seriesModel.getData();["x","y","z"].forEach(function(coordDim){data.mapDimensionsAll(coordDim,!0).forEach(function(dataDim){!function unionDataExtents(dim,extent){dataExtents[dim]=dataExtents[dim]||[1/0,-1/0],dataExtents[dim][0]=Math.min(extent[0],dataExtents[dim][0]),dataExtents[dim][1]=Math.max(extent[1],dataExtents[dim][1])}(coordDim,data.getDataExtent(dataDim,!0))})})}},this),["xAxis3D","yAxis3D","zAxis3D"].forEach(function(axisType){ecModel.eachComponent(axisType,function(axisModel){var dim=axisType.charAt(0),grid3DModel=axisModel.getReferringComponents("grid3D").models[0],cartesian3D=grid3DModel.coordinateSystem;if(cartesian3D===this){var axis=cartesian3D.getAxis(dim);if(!axis){(axis=new Axis3D(dim,createScale(dataExtents[dim]||[1/0,-1/0],axisModel))).type=axisModel.get("type");var isCategory="category"===axis.type;axis.onBand=isCategory&amp;&amp;axisModel.get("boundaryGap"),axis.inverse=axisModel.get("inverse"),axisModel.axis=axis,axis.model=axisModel,axis.getLabelModel=function(){return axisModel.getModel("axisLabel",grid3DModel.getModel("axisLabel"))},axis.getTickModel=function(){return axisModel.getModel("axisTick",grid3DModel.getModel("axisTick"))},cartesian3D.addAxis(axis)}}},this)},this),this.resize(this.model,api)}ViewGL.prototype.castRay=function(x,y,out){var renderer=this.layer.renderer,oldViewport=renderer.viewport;return renderer.viewport=this.viewport,renderer.screenToNDC(x,y,ndc),this.camera.castRay(ndc,out),renderer.viewport=oldViewport,out},ViewGL.prototype.prepareRender=function(){this.scene.update(),this.camera.update(),this.scene.updateLights();var renderList=this.scene.updateRenderList(this.camera);this._needsSortProgressively=!1;for(var i=0;i&lt;renderList.transparent.length;i++){var geometry=renderList.transparent[i].geometry;geometry.needsSortVerticesProgressively&amp;&amp;geometry.needsSortVerticesProgressively()&amp;&amp;(this._needsSortProgressively=!0),geometry.needsSortTrianglesProgressively&amp;&amp;geometry.needsSortTrianglesProgressively()&amp;&amp;(this._needsSortProgressively=!0)}this._frame=0,this._temporalSS.resetFrame()},ViewGL.prototype.render=function(renderer,accumulating){this._doRender(renderer,accumulating,this._frame),this._frame++},ViewGL.prototype.needsAccumulate=function(){return this.needsTemporalSS()||this._needsSortProgressively},ViewGL.prototype.needsTemporalSS=function(){var enableTemporalSS=this._enableTemporalSS;return"auto"===enableTemporalSS&amp;&amp;(enableTemporalSS=this._enablePostEffect),enableTemporalSS},ViewGL.prototype.hasDOF=function(){return this._enableDOF},ViewGL.prototype.isAccumulateFinished=function(){return this.needsTemporalSS()?this._temporalSS.isFinished():this._frame&gt;30},ViewGL.prototype._doRender=function(renderer,accumulating,accumFrame){var scene=this.scene,camera=this.camera;accumFrame=accumFrame||0,this._updateTransparent(renderer,scene,camera,accumFrame),accumulating||(this._shadowMapPass.kernelPCF=this._pcfKernels[0],this._shadowMapPass.render(renderer,scene,camera,!0)),this._updateShadowPCFKernel(accumFrame);var frameBuffer,bgColor=renderer.clearColor;(renderer.gl.clearColor(bgColor[0],bgColor[1],bgColor[2],bgColor[3]),this._enablePostEffect&amp;&amp;(this.needsTemporalSS()&amp;&amp;this._temporalSS.jitterProjection(renderer,camera),this._compositor.updateNormal(renderer,scene,camera,this._temporalSS.getFrame())),this._updateSSAO(renderer,scene,camera,this._temporalSS.getFrame()),this._enablePostEffect)?((frameBuffer=this._compositor.getSourceFrameBuffer()).bind(renderer),renderer.gl.clear(renderer.gl.DEPTH_BUFFER_BIT|renderer.gl.COLOR_BUFFER_BIT),renderer.render(scene,camera,!0,!0),frameBuffer.unbind(renderer),this.needsTemporalSS()&amp;&amp;accumulating?(this._compositor.composite(renderer,scene,camera,this._temporalSS.getSourceFrameBuffer(),this._temporalSS.getFrame()),renderer.setViewport(this.viewport),this._temporalSS.render(renderer)):(renderer.setViewport(this.viewport),this._compositor.composite(renderer,scene,camera,null,0))):this.needsTemporalSS()&amp;&amp;accumulating?((frameBuffer=this._temporalSS.getSourceFrameBuffer()).bind(renderer),renderer.saveClear(),renderer.clearBit=renderer.gl.DEPTH_BUFFER_BIT|renderer.gl.COLOR_BUFFER_BIT,renderer.render(scene,camera,!0,!0),renderer.restoreClear(),frameBuffer.unbind(renderer),renderer.setViewport(this.viewport),this._temporalSS.render(renderer)):(renderer.setViewport(this.viewport),renderer.render(scene,camera,!0,!0))},ViewGL.prototype._updateTransparent=function(renderer,scene,camera,frame){for(var v3=new Vector3,invWorldTransform=new Matrix4,cameraWorldPosition=camera.getWorldPosition(),transparentList=scene.getRenderList(camera).transparent,i=0;i&lt;transparentList.length;i++){var renderable=transparentList[i],geometry=renderable.geometry;Matrix4.invert(invWorldTransform,renderable.worldTransform),Vector3.transformMat4(v3,cameraWorldPosition,invWorldTransform),geometry.needsSortTriangles&amp;&amp;geometry.needsSortTriangles()&amp;&amp;geometry.doSortTriangles(v3,frame),geometry.needsSortVertices&amp;&amp;geometry.needsSortVertices()&amp;&amp;geometry.doSortVertices(v3,frame)}},ViewGL.prototype._updateSSAO=function(renderer,scene,camera){var ifEnableSSAO=this._enableSSAO&amp;&amp;this._enablePostEffect;ifEnableSSAO&amp;&amp;this._compositor.updateSSAO(renderer,scene,camera,this._temporalSS.getFrame());for(var renderList=scene.getRenderList(camera),i=0;i&lt;renderList.opaque.length;i++){var renderable=renderList.opaque[i];renderable.renderNormal&amp;&amp;renderable.material[ifEnableSSAO?"enableTexture":"disableTexture"]("ssaoMap"),ifEnableSSAO&amp;&amp;renderable.material.set("ssaoMap",this._compositor.getSSAOTexture())}},ViewGL.prototype._updateShadowPCFKernel=function(frame){for(var pcfKernel=this._pcfKernels[frame%this._pcfKernels.length],opaqueList=this.scene.getRenderList(this.camera).opaque,i=0;i&lt;opaqueList.length;i++)opaqueList[i].receiveShadow&amp;&amp;(opaqueList[i].material.set("pcfKernel",pcfKernel),opaqueList[i].material.define("fragment","PCF_KERNEL_SIZE",pcfKernel.length/2))},ViewGL.prototype.dispose=function(renderer){this._compositor.dispose(renderer.gl),this._temporalSS.dispose(renderer.gl),this._shadowMapPass.dispose(renderer)},ViewGL.prototype.setPostEffect=function(postEffectModel,api){var compositor=this._compositor;this._enablePostEffect=postEffectModel.get("enable");var bloomModel=postEffectModel.getModel("bloom"),edgeModel=postEffectModel.getModel("edge"),dofModel=postEffectModel.getModel("DOF",postEffectModel.getModel("depthOfField")),ssaoModel=postEffectModel.getModel("SSAO",postEffectModel.getModel("screenSpaceAmbientOcclusion")),ssrModel=postEffectModel.getModel("SSR",postEffectModel.getModel("screenSpaceReflection")),fxaaModel=postEffectModel.getModel("FXAA"),colorCorrModel=postEffectModel.getModel("colorCorrection");bloomModel.get("enable")?compositor.enableBloom():compositor.disableBloom(),dofModel.get("enable")?compositor.enableDOF():compositor.disableDOF(),ssrModel.get("enable")?compositor.enableSSR():compositor.disableSSR(),colorCorrModel.get("enable")?compositor.enableColorCorrection():compositor.disableColorCorrection(),edgeModel.get("enable")?compositor.enableEdge():compositor.disableEdge(),fxaaModel.get("enable")?compositor.enableFXAA():compositor.disableFXAA(),this._enableDOF=dofModel.get("enable"),this._enableSSAO=ssaoModel.get("enable"),this._enableSSAO?compositor.enableSSAO():compositor.disableSSAO(),compositor.setBloomIntensity(bloomModel.get("intensity")),compositor.setEdgeColor(edgeModel.get("color")),compositor.setColorLookupTexture(colorCorrModel.get("lookupTexture"),api),compositor.setExposure(colorCorrModel.get("exposure")),["radius","quality","intensity"].forEach(function(name){compositor.setSSAOParameter(name,ssaoModel.get(name))}),["quality","maxRoughness","physical"].forEach(function(name){compositor.setSSRParameter(name,ssrModel.get(name))}),["quality","focalDistance","focalRange","blurRadius","fstop"].forEach(function(name){compositor.setDOFParameter(name,dofModel.get(name))}),["brightness","contrast","saturation"].forEach(function(name){compositor.setColorCorrection(name,colorCorrModel.get(name))})},ViewGL.prototype.setDOFFocusOnPoint=function(depth){if(this._enablePostEffect){if(depth&gt;this.camera.far||depth&lt;this.camera.near)return;return this._compositor.setDOFParameter("focalDistance",depth),!0}},ViewGL.prototype.setTemporalSuperSampling=function(temporalSuperSamplingModel){this._enableTemporalSS=temporalSuperSamplingModel.get("enable")},ViewGL.prototype.isLinearSpace=function(){return this._enablePostEffect},ViewGL.prototype.setRootNode=function(rootNode){if(this.rootNode!==rootNode){for(var children=this.rootNode.children(),i=0;i&lt;children.length;i++)rootNode.add(children[i]);rootNode!==this.scene&amp;&amp;this.scene.add(rootNode),this.rootNode=rootNode}},ViewGL.prototype.add=function(node3D){this.rootNode.add(node3D)},ViewGL.prototype.remove=function(node3D){this.rootNode.remove(node3D)},ViewGL.prototype.removeAll=function(node3D){this.rootNode.removeAll(node3D)},Object.assign(ViewGL.prototype,notifier);var grid3DCreator={dimensions:Cartesian3D.prototype.dimensions,create:function(ecModel,api){var cartesian3DList=[];ecModel.eachComponent("grid3D",function(grid3DModel){grid3DModel.__viewGL=grid3DModel.__viewGL||new ViewGL;var cartesian3D=new Cartesian3D;cartesian3D.model=grid3DModel,cartesian3D.viewGL=grid3DModel.__viewGL,grid3DModel.coordinateSystem=cartesian3D,cartesian3DList.push(cartesian3D),cartesian3D.resize=resizeCartesian3D,cartesian3D.update=updateCartesian3D});var axesTypes=["xAxis3D","yAxis3D","zAxis3D"];return ecModel.eachSeries(function(seriesModel){if("cartesian3D"===seriesModel.get("coordinateSystem")){if(null==(firstGridModel=seriesModel.getReferringComponents("grid3D").models[0])){var axesModels=function findAxesModels(seriesModel,ecModel2){return axesTypes.map(function(axisType){var axisModel=seriesModel.getReferringComponents(axisType).models[0];return null==axisModel&amp;&amp;(axisModel=ecModel2.getComponent(axisType)),axisModel})}(seriesModel,ecModel),firstGridModel=axesModels[0].getCoordSysModel();axesModels.forEach(function(axisModel){axisModel.getCoordSysModel()})}var coordSys=firstGridModel.coordinateSystem;seriesModel.coordinateSystem=coordSys}}),cartesian3DList}},Axis3DModel=ComponentModel.extend({type:"cartesian3DAxis",axis:null,getCoordSysModel:function(){return this.ecModel.queryComponents({mainType:"grid3D",index:this.option.gridIndex,id:this.option.gridId})[0]}});mixinAxisModelCommonMethods(Axis3DModel);var defaultOption={show:!0,grid3DIndex:0,inverse:!1,name:"",nameLocation:"middle",nameTextStyle:{fontSize:16},nameGap:20,axisPointer:{},axisLine:{},axisTick:{},axisLabel:{},splitArea:{}},categoryAxis=merge({boundaryGap:!0,axisTick:{alignWithLabel:!1,interval:"auto"},axisLabel:{interval:"auto"},axisPointer:{label:{show:!1}}},defaultOption),valueAxis=merge({boundaryGap:[0,0],splitNumber:5,axisPointer:{label:{}}},defaultOption),timeAxis=defaults({scale:!0,min:"dataMin",max:"dataMax"},valueAxis),logAxis=defaults({logBase:10},valueAxis);logAxis.scale=!0;const axisDefault={categoryAxis3D:categoryAxis,valueAxis3D:valueAxis,timeAxis3D:timeAxis,logAxis3D:logAxis};var AXIS_TYPES=["value","category","time","log"];function getAxisType(axisDim,option){return option.type||(option.data?"category":"value")}use(function install$f(registers){registers.registerComponentModel(Grid3DModel),registers.registerComponentView(Grid3DView),registers.registerCoordinateSystem("grid3D",grid3DCreator),["x","y","z"].forEach(function(dim){!function createAxis3DModel(registers,dim,BaseAxisModelClass,axisTypeDefaulter,extraDefaultOption){AXIS_TYPES.forEach(function(axisType){var AxisModel=BaseAxisModelClass.extend({type:dim+"Axis3D."+axisType,__ordinalMeta:null,mergeDefaultAndTheme:function(option,ecModel){var themeModel=ecModel.getTheme();merge(option,themeModel.get(axisType+"Axis3D")),merge(option,this.getDefaultOption()),option.type=axisTypeDefaulter(dim,option)},optionUpdated:function(){"category"===this.option.type&amp;&amp;(this.__ordinalMeta=OrdinalMeta.createByAxisModel(this))},getCategories:function(){if("category"===this.option.type)return this.__ordinalMeta.categories},getOrdinalMeta:function(){return this.__ordinalMeta},defaultOption:merge(clone(axisDefault[axisType+"Axis3D"]),extraDefaultOption||{},!0)});registers.registerComponentModel(AxisModel)}),registers.registerSubTypeDefaulter(dim+"Axis3D",curry(axisTypeDefaulter,dim))}(registers,dim,Axis3DModel,getAxisType,{name:dim.toUpperCase()});const AxisView=registers.ComponentView.extend({type:dim+"Axis3D"});registers.registerComponentView(AxisView)}),registers.registerAction({type:"grid3DChangeCamera",event:"grid3dcamerachanged",update:"series:updateCamera"},function(payload,ecModel){ecModel.eachComponent({mainType:"grid3D",query:payload},function(componentModel){componentModel.setView(payload)})}),registers.registerAction({type:"grid3DShowAxisPointer",event:"grid3dshowaxispointer",update:"grid3D:showAxisPointer"},function(payload,ecModel){}),registers.registerAction({type:"grid3DHideAxisPointer",event:"grid3dhideaxispointer",update:"grid3D:hideAxisPointer"},function(payload,ecModel){})});const componentShadingMixin={defaultOption:{shading:null,realisticMaterial:{textureTiling:1,textureOffset:0,detailTexture:null},lambertMaterial:{textureTiling:1,textureOffset:0,detailTexture:null},colorMaterial:{textureTiling:1,textureOffset:0,detailTexture:null},hatchingMaterial:{textureTiling:1,textureOffset:0,paperColor:"#fff"}}},geo3DModelMixin={getFilledRegions:function(regions,mapData){var geoJson,regionsArr=(regions||[]).slice();if("string"==typeof mapData?geoJson=(mapData=getMap(mapData))&amp;&amp;mapData.geoJson:mapData&amp;&amp;mapData.features&amp;&amp;(geoJson=mapData),!geoJson)return[];for(var dataNameMap={},features=geoJson.features,i=0;i&lt;regionsArr.length;i++)dataNameMap[regionsArr[i].name]=regionsArr[i];for(i=0;i&lt;features.length;i++){var name=features[i].properties.name;dataNameMap[name]||regionsArr.push({name:name})}return regionsArr},defaultOption:{show:!0,zlevel:-10,map:"",left:0,top:0,width:"100%",height:"100%",boxWidth:100,boxHeight:10,boxDepth:"auto",regionHeight:3,environment:"auto",groundPlane:{show:!1,color:"#aaa"},shading:"lambert",light:{main:{alpha:40,beta:30}},viewControl:{alpha:40,beta:0,distance:100,orthographicSize:60,minAlpha:5,minBeta:-80,maxBeta:80},label:{show:!1,distance:2,textStyle:{fontSize:20,color:"#000",backgroundColor:"rgba(255,255,255,0.7)",padding:3,borderRadius:4}},itemStyle:{color:"#fff",borderWidth:0,borderColor:"#333"},emphasis:{itemStyle:{color:"#639fc0"},label:{show:!0}}}};var Geo3DModel=ComponentModel.extend({type:"geo3D",layoutMode:"box",coordinateSystem:null,optionUpdated:function(){var option=this.option;option.regions=this.getFilledRegions(option.regions,option.map);var dimensions=createDimensions(option.data||[],{coordDimensions:["value"],encodeDefine:this.get("encode"),dimensionsDefine:this.get("dimensions")}),list=new SeriesData(dimensions,this);list.initData(option.regions);var regionModelMap={};list.each(function(idx){var name=list.getName(idx),itemModel=list.getItemModel(idx);regionModelMap[name]=itemModel}),this._regionModelMap=regionModelMap,this._data=list},getData:function(){return this._data},getRegionModel:function(idx){var name=this.getData().getName(idx);return this._regionModelMap[name]||new Model(null,this)},getRegionPolygonCoords:function(idx){var name=this.getData().getName(idx),region=this.coordinateSystem.getRegion(name);return region?region.geometries:[]},getFormattedLabel:function(dataIndex,status){var name=this._data.getName(dataIndex),regionModel=this.getRegionModel(dataIndex),formatter=regionModel.get("normal"===status?["label","formatter"]:["emphasis","label","formatter"]);null==formatter&amp;&amp;(formatter=regionModel.get(["label","formatter"]));var params={name:name};if("function"==typeof formatter)return params.status=status,formatter(params);if("string"==typeof formatter){var serName=params.seriesName;return formatter.replace("{a}",null!=serName?serName:"")}return name},defaultOption:{regions:[]}});function earcut(data,holeIndices,dim){dim=dim||2;var minX,minY,maxX,maxY,x,y,size,hasHoles=holeIndices&amp;&amp;holeIndices.length,outerLen=hasHoles?holeIndices[0]*dim:data.length,outerNode=linkedList(data,0,outerLen,dim,!0),triangles=[];if(!outerNode)return triangles;if(hasHoles&amp;&amp;(outerNode=function eliminateHoles(data,holeIndices,outerNode,dim){var i,len,list,queue=[];for(i=0,len=holeIndices.length;i&lt;len;i++)(list=linkedList(data,holeIndices[i]*dim,i&lt;len-1?holeIndices[i+1]*dim:data.length,dim,!1))===list.next&amp;&amp;(list.steiner=!0),queue.push(getLeftmost(list));for(queue.sort(compareX),i=0;i&lt;queue.length;i++)eliminateHole(queue[i],outerNode),outerNode=filterPoints(outerNode,outerNode.next);return outerNode}(data,holeIndices,outerNode,dim)),data.length&gt;80*dim){minX=maxX=data[0],minY=maxY=data[1];for(var i=dim;i&lt;outerLen;i+=dim)(x=data[i])&lt;minX&amp;&amp;(minX=x),(y=data[i+1])&lt;minY&amp;&amp;(minY=y),x&gt;maxX&amp;&amp;(maxX=x),y&gt;maxY&amp;&amp;(maxY=y);size=Math.max(maxX-minX,maxY-minY)}return earcutLinked(outerNode,triangles,dim,minX,minY,size),triangles}function linkedList(data,start,end,dim,clockwise){var i,last;if(clockwise===signedArea(data,start,end,dim)&gt;0)for(i=start;i&lt;end;i+=dim)last=insertNode(i,data[i],data[i+1],last);else for(i=end-dim;i&gt;=start;i-=dim)last=insertNode(i,data[i],data[i+1],last);return last&amp;&amp;equals(last,last.next)&amp;&amp;(removeNode(last),last=last.next),last}function filterPoints(start,end){if(!start)return start;end||(end=start);var again,p=start;do{if(again=!1,p.steiner||!equals(p,p.next)&amp;&amp;0!==area(p.prev,p,p.next))p=p.next;else{if(removeNode(p),(p=end=p.prev)===p.next)return null;again=!0}}while(again||p!==end);return end}function earcutLinked(ear,triangles,dim,minX,minY,size,pass){if(ear){!pass&amp;&amp;size&amp;&amp;function indexCurve(start,minX,minY,size){var p=start;do{null===p.z&amp;&amp;(p.z=zOrder(p.x,p.y,minX,minY,size)),p.prevZ=p.prev,p.nextZ=p.next,p=p.next}while(p!==start);p.prevZ.nextZ=null,p.prevZ=null,function sortLinked(list){var i,p,q,e2,tail,numMerges,pSize,qSize,inSize=1;do{for(p=list,list=null,tail=null,numMerges=0;p;){for(numMerges++,q=p,pSize=0,i=0;i&lt;inSize&amp;&amp;(pSize++,q=q.nextZ);i++);for(qSize=inSize;pSize&gt;0||qSize&gt;0&amp;&amp;q;)0!==pSize&amp;&amp;(0===qSize||!q||p.z&lt;=q.z)?(e2=p,p=p.nextZ,pSize--):(e2=q,q=q.nextZ,qSize--),tail?tail.nextZ=e2:list=e2,e2.prevZ=tail,tail=e2;p=q}tail.nextZ=null,inSize*=2}while(numMerges&gt;1);return list}(p)}(ear,minX,minY,size);for(var prev,next,stop=ear;ear.prev!==ear.next;)if(prev=ear.prev,next=ear.next,size?isEarHashed(ear,minX,minY,size):isEar(ear))triangles.push(prev.i/dim),triangles.push(ear.i/dim),triangles.push(next.i/dim),removeNode(ear),ear=next.next,stop=next.next;else if((ear=next)===stop){pass?1===pass?earcutLinked(ear=cureLocalIntersections(ear,triangles,dim),triangles,dim,minX,minY,size,2):2===pass&amp;&amp;splitEarcut(ear,triangles,dim,minX,minY,size):earcutLinked(filterPoints(ear),triangles,dim,minX,minY,size,1);break}}}function isEar(ear){var a=ear.prev,b=ear,c=ear.next;if(area(a,b,c)&gt;=0)return!1;for(var p=ear.next.next;p!==ear.prev;){if(pointInTriangle(a.x,a.y,b.x,b.y,c.x,c.y,p.x,p.y)&amp;&amp;area(p.prev,p,p.next)&gt;=0)return!1;p=p.next}return!0}function isEarHashed(ear,minX,minY,size){var a=ear.prev,b=ear,c=ear.next;if(area(a,b,c)&gt;=0)return!1;for(var minTX=a.x&lt;b.x?a.x&lt;c.x?a.x:c.x:b.x&lt;c.x?b.x:c.x,minTY=a.y&lt;b.y?a.y&lt;c.y?a.y:c.y:b.y&lt;c.y?b.y:c.y,maxTX=a.x&gt;b.x?a.x&gt;c.x?a.x:c.x:b.x&gt;c.x?b.x:c.x,maxTY=a.y&gt;b.y?a.y&gt;c.y?a.y:c.y:b.y&gt;c.y?b.y:c.y,minZ=zOrder(minTX,minTY,minX,minY,size),maxZ=zOrder(maxTX,maxTY,minX,minY,size),p=ear.nextZ;p&amp;&amp;p.z&lt;=maxZ;){if(p!==ear.prev&amp;&amp;p!==ear.next&amp;&amp;pointInTriangle(a.x,a.y,b.x,b.y,c.x,c.y,p.x,p.y)&amp;&amp;area(p.prev,p,p.next)&gt;=0)return!1;p=p.nextZ}for(p=ear.prevZ;p&amp;&amp;p.z&gt;=minZ;){if(p!==ear.prev&amp;&amp;p!==ear.next&amp;&amp;pointInTriangle(a.x,a.y,b.x,b.y,c.x,c.y,p.x,p.y)&amp;&amp;area(p.prev,p,p.next)&gt;=0)return!1;p=p.prevZ}return!0}function cureLocalIntersections(start,triangles,dim){var p=start;do{var a=p.prev,b=p.next.next;!equals(a,b)&amp;&amp;intersects(a,p,p.next,b)&amp;&amp;locallyInside(a,b)&amp;&amp;locallyInside(b,a)&amp;&amp;(triangles.push(a.i/dim),triangles.push(p.i/dim),triangles.push(b.i/dim),removeNode(p),removeNode(p.next),p=start=b),p=p.next}while(p!==start);return p}function splitEarcut(start,triangles,dim,minX,minY,size){var a=start;do{for(var b=a.next.next;b!==a.prev;){if(a.i!==b.i&amp;&amp;isValidDiagonal(a,b)){var c=splitPolygon(a,b);return a=filterPoints(a,a.next),c=filterPoints(c,c.next),earcutLinked(a,triangles,dim,minX,minY,size),void earcutLinked(c,triangles,dim,minX,minY,size)}b=b.next}a=a.next}while(a!==start)}function compareX(a,b){return a.x-b.x}function eliminateHole(hole,outerNode){if(outerNode=function findHoleBridge(hole,outerNode){var m,p=outerNode,hx=hole.x,hy=hole.y,qx=-1/0;do{if(hy&lt;=p.y&amp;&amp;hy&gt;=p.next.y&amp;&amp;p.next.y!==p.y){var x=p.x+(hy-p.y)*(p.next.x-p.x)/(p.next.y-p.y);if(x&lt;=hx&amp;&amp;x&gt;qx){if(qx=x,x===hx){if(hy===p.y)return p;if(hy===p.next.y)return p.next}m=p.x&lt;p.next.x?p:p.next}}p=p.next}while(p!==outerNode);if(!m)return null;if(hx===qx)return m.prev;var tan2,stop=m,mx=m.x,my=m.y,tanMin=1/0;p=m.next;for(;p!==stop;)hx&gt;=p.x&amp;&amp;p.x&gt;=mx&amp;&amp;hx!==p.x&amp;&amp;pointInTriangle(hy&lt;my?hx:qx,hy,mx,my,hy&lt;my?qx:hx,hy,p.x,p.y)&amp;&amp;((tan2=Math.abs(hy-p.y)/(hx-p.x))&lt;tanMin||tan2===tanMin&amp;&amp;p.x&gt;m.x)&amp;&amp;locallyInside(p,hole)&amp;&amp;(m=p,tanMin=tan2),p=p.next;return m}(hole,outerNode),outerNode){var b=splitPolygon(outerNode,hole);filterPoints(b,b.next)}}function zOrder(x,y,minX,minY,size){return(x=1431655765&amp;((x=858993459&amp;((x=252645135&amp;((x=16711935&amp;((x=32767*(x-minX)/size)|x&lt;&lt;8))|x&lt;&lt;4))|x&lt;&lt;2))|x&lt;&lt;1))|(y=1431655765&amp;((y=858993459&amp;((y=252645135&amp;((y=16711935&amp;((y=32767*(y-minY)/size)|y&lt;&lt;8))|y&lt;&lt;4))|y&lt;&lt;2))|y&lt;&lt;1))&lt;&lt;1}function getLeftmost(start){var p=start,leftmost=start;do{p.x&lt;leftmost.x&amp;&amp;(leftmost=p),p=p.next}while(p!==start);return leftmost}function pointInTriangle(ax,ay,bx,by,cx,cy,px,py){return(cx-px)*(ay-py)-(ax-px)*(cy-py)&gt;=0&amp;&amp;(ax-px)*(by-py)-(bx-px)*(ay-py)&gt;=0&amp;&amp;(bx-px)*(cy-py)-(cx-px)*(by-py)&gt;=0}function isValidDiagonal(a,b){return a.next.i!==b.i&amp;&amp;a.prev.i!==b.i&amp;&amp;!function intersectsPolygon(a,b){var p=a;do{if(p.i!==a.i&amp;&amp;p.next.i!==a.i&amp;&amp;p.i!==b.i&amp;&amp;p.next.i!==b.i&amp;&amp;intersects(p,p.next,a,b))return!0;p=p.next}while(p!==a);return!1}(a,b)&amp;&amp;locallyInside(a,b)&amp;&amp;locallyInside(b,a)&amp;&amp;function middleInside(a,b){var p=a,inside=!1,px=(a.x+b.x)/2,py=(a.y+b.y)/2;do{p.y&gt;py!=p.next.y&gt;py&amp;&amp;p.next.y!==p.y&amp;&amp;px&lt;(p.next.x-p.x)*(py-p.y)/(p.next.y-p.y)+p.x&amp;&amp;(inside=!inside),p=p.next}while(p!==a);return inside}(a,b)}function area(p,q,r){return(q.y-p.y)*(r.x-q.x)-(q.x-p.x)*(r.y-q.y)}function equals(p12,p22){return p12.x===p22.x&amp;&amp;p12.y===p22.y}function intersects(p12,q1,p22,q2){return!!(equals(p12,q1)&amp;&amp;equals(p22,q2)||equals(p12,q2)&amp;&amp;equals(p22,q1))||area(p12,q1,p22)&gt;0!=area(p12,q1,q2)&gt;0&amp;&amp;area(p22,q2,p12)&gt;0!=area(p22,q2,q1)&gt;0}function locallyInside(a,b){return area(a.prev,a,a.next)&lt;0?area(a,b,a.next)&gt;=0&amp;&amp;area(a,a.prev,b)&gt;=0:area(a,b,a.prev)&lt;0||area(a,a.next,b)&lt;0}function splitPolygon(a,b){var a2=new Node(a.i,a.x,a.y),b2=new Node(b.i,b.x,b.y),an=a.next,bp=b.prev;return a.next=b,b.prev=a,a2.next=an,an.prev=a2,b2.next=a2,a2.prev=b2,bp.next=b2,b2.prev=bp,b2}function insertNode(i,x,y,last){var p=new Node(i,x,y);return last?(p.next=last.next,p.prev=last,last.next.prev=p,last.next=p):(p.prev=p,p.next=p),p}function removeNode(p){p.next.prev=p.prev,p.prev.next=p.next,p.prevZ&amp;&amp;(p.prevZ.nextZ=p.nextZ),p.nextZ&amp;&amp;(p.nextZ.prevZ=p.prevZ)}function Node(i,x,y){this.i=i,this.x=x,this.y=y,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function signedArea(data,start,end,dim){for(var sum=0,i=start,j=end-dim;i&lt;end;i+=dim)sum+=(data[j]-data[i])*(data[i+1]+data[j+1]),j=i;return sum}function swap(arr,a,b){var tmp=arr[a];arr[a]=arr[b],arr[b]=tmp}function partition(arr,pivot,left,right,compare){var storeIndex=left,pivotValue=arr[pivot];swap(arr,pivot,right);for(var v=left;v&lt;right;v++)compare(arr[v],pivotValue)&lt;0&amp;&amp;(swap(arr,v,storeIndex),storeIndex++);return swap(arr,right,storeIndex),storeIndex}function quickSort(array,compare,left,right){if(left&lt;right){var newPivot=partition(array,Math.floor((left+right)/2),left,right,compare);quickSort(array,compare,left,newPivot-1),quickSort(array,compare,newPivot+1,right)}}function ProgressiveQuickSort(){this._parts=[]}merge(Geo3DModel.prototype,geo3DModelMixin),merge(Geo3DModel.prototype,componentViewControlMixin),merge(Geo3DModel.prototype,componentPostEffectMixin),merge(Geo3DModel.prototype,componentLightMixin),merge(Geo3DModel.prototype,componentShadingMixin),earcut.deviation=function(data,holeIndices,dim,triangles){var hasHoles=holeIndices&amp;&amp;holeIndices.length,outerLen=hasHoles?holeIndices[0]*dim:data.length,polygonArea=Math.abs(signedArea(data,0,outerLen,dim));if(hasHoles)for(var i=0,len=holeIndices.length;i&lt;len;i++){var start=holeIndices[i]*dim,end=i&lt;len-1?holeIndices[i+1]*dim:data.length;polygonArea-=Math.abs(signedArea(data,start,end,dim))}var trianglesArea=0;for(i=0;i&lt;triangles.length;i+=3){var a=triangles[i]*dim,b=triangles[i+1]*dim,c=triangles[i+2]*dim;trianglesArea+=Math.abs((data[a]-data[c])*(data[b+1]-data[a+1])-(data[a]-data[b])*(data[c+1]-data[a+1]))}return 0===polygonArea&amp;&amp;0===trianglesArea?0:Math.abs((trianglesArea-polygonArea)/polygonArea)},ProgressiveQuickSort.prototype.step=function(arr,compare,frame){var len=arr.length;if(0===frame){this._parts=[],this._sorted=!1;var pivot=Math.floor(len/2);this._parts.push({pivot:pivot,left:0,right:len-1}),this._currentSortPartIdx=0}if(!this._sorted){var parts=this._parts;if(0===parts.length)return this._sorted=!0,!0;if(parts.length&lt;512){for(var i=0;i&lt;parts.length;i++)parts[i].pivot=partition(arr,parts[i].pivot,parts[i].left,parts[i].right,compare);var subdividedParts=[];for(i=0;i&lt;parts.length;i++){var left=parts[i].left;(right=parts[i].pivot-1)&gt;left&amp;&amp;subdividedParts.push({pivot:Math.floor((right+left)/2),left:left,right:right});var right;left=parts[i].pivot+1;(right=parts[i].right)&gt;left&amp;&amp;subdividedParts.push({pivot:Math.floor((right+left)/2),left:left,right:right})}parts=this._parts=subdividedParts}else for(i=0;i&lt;Math.floor(parts.length/10);i++){var idx=parts.length-1-this._currentSortPartIdx;if(quickSort(arr,compare,parts[idx].left,parts[idx].right),this._currentSortPartIdx++,this._currentSortPartIdx===parts.length)return this._sorted=!0,!0}return!1}},ProgressiveQuickSort.sort=quickSort;var vec3$c=glmatrix.vec3,p0=vec3$c.create(),p1=vec3$c.create(),p2=vec3$c.create();const trianglesSortMixin={needsSortTriangles:function(){return this.indices&amp;&amp;this.sortTriangles},needsSortTrianglesProgressively:function(){return this.needsSortTriangles()&amp;&amp;this.triangleCount&gt;=2e4},doSortTriangles:function(cameraPos,frame){var indices=this.indices;if(0===frame){var posAttr=this.attributes.position;cameraPos=cameraPos.array;this._triangleZList&amp;&amp;this._triangleZList.length===this.triangleCount||(this._triangleZList=new Float32Array(this.triangleCount),this._sortedTriangleIndices=new Uint32Array(this.triangleCount),this._indicesTmp=new indices.constructor(indices.length),this._triangleZListTmp=new Float32Array(this.triangleCount));for(var firstZ,cursor=0,i=0;i&lt;indices.length;){posAttr.get(indices[i++],p0),posAttr.get(indices[i++],p1),posAttr.get(indices[i++],p2);var z0=vec3$c.sqrDist(p0,cameraPos),z1=vec3$c.sqrDist(p1,cameraPos),z2=vec3$c.sqrDist(p2,cameraPos),zMax=Math.min(z0,z1);zMax=Math.min(zMax,z2),3===i?(firstZ=zMax,zMax=0):zMax-=firstZ,this._triangleZList[cursor++]=zMax}}var sortedTriangleIndices=this._sortedTriangleIndices;for(i=0;i&lt;sortedTriangleIndices.length;i++)sortedTriangleIndices[i]=i;if(this.triangleCount&lt;2e4)0===frame&amp;&amp;this._simpleSort(!0);else for(i=0;i&lt;3;i++)this._progressiveQuickSort(3*frame+i);var targetIndices=this._indicesTmp,targetTriangleZList=this._triangleZListTmp,faceZList=this._triangleZList;for(i=0;i&lt;this.triangleCount;i++){var fromIdx3=3*sortedTriangleIndices[i],toIdx3=3*i;targetIndices[toIdx3++]=indices[fromIdx3++],targetIndices[toIdx3++]=indices[fromIdx3++],targetIndices[toIdx3]=indices[fromIdx3],targetTriangleZList[i]=faceZList[sortedTriangleIndices[i]]}var tmp=this._indicesTmp;this._indicesTmp=this.indices,this.indices=tmp;tmp=this._triangleZListTmp;this._triangleZListTmp=this._triangleZList,this._triangleZList=tmp,this.dirtyIndices()},_simpleSort:function(useNativeQuickSort){var faceZList=this._triangleZList,sortedTriangleIndices=this._sortedTriangleIndices;function compare(a,b){return faceZList[b]-faceZList[a]}useNativeQuickSort?Array.prototype.sort.call(sortedTriangleIndices,compare):ProgressiveQuickSort.sort(sortedTriangleIndices,compare,0,sortedTriangleIndices.length-1)},_progressiveQuickSort:function(frame){var faceZList=this._triangleZList,sortedTriangleIndices=this._sortedTriangleIndices;this._quickSort=this._quickSort||new ProgressiveQuickSort,this._quickSort.step(sortedTriangleIndices,function(a,b){return faceZList[b]-faceZList[a]},frame)}};function getItemVisualColor(data,idx){const style=data.getItemVisual(idx,"style");if(style){return style[data.getVisual("drawType")]}}function getItemVisualOpacity(data,idx){const style=data.getItemVisual(idx,"style");return style&amp;&amp;style.opacity}function LabelsBuilder(width,height,api){this._labelsMesh=new LabelsMesh,this._labelTextureSurface=new ZRTextureAtlasSurface({width:512,height:512,devicePixelRatio:api.getDevicePixelRatio(),onupdate:function(){api.getZr().refresh()}}),this._api=api,this._labelsMesh.material.set("textureAtlas",this._labelTextureSurface.getTexture())}LabelsBuilder.prototype.getLabelPosition=function(dataIndex,positionDesc,distance){return[0,0,0]},LabelsBuilder.prototype.getLabelDistance=function(dataIndex,positionDesc,distance){return 0},LabelsBuilder.prototype.getMesh=function(){return this._labelsMesh},LabelsBuilder.prototype.updateData=function(data,start,end){null==start&amp;&amp;(start=0),null==end&amp;&amp;(end=data.count()),this._labelsVisibilitiesBits&amp;&amp;this._labelsVisibilitiesBits.length===end-start||(this._labelsVisibilitiesBits=new Uint8Array(end-start));for(var normalLabelVisibilityQuery=["label","show"],emphasisLabelVisibilityQuery=["emphasis","label","show"],idx=start;idx&lt;end;idx++){var itemModel=data.getItemModel(idx),normalVisibility=itemModel.get(normalLabelVisibilityQuery),emphasisVisibility=itemModel.get(emphasisLabelVisibilityQuery);null==emphasisVisibility&amp;&amp;(emphasisVisibility=normalVisibility);var bit=(normalVisibility?1:0)|(emphasisVisibility?2:0);this._labelsVisibilitiesBits[idx-start]=bit}this._start=start,this._end=end,this._data=data},LabelsBuilder.prototype.updateLabels=function(highlightDataIndices){if(this._data){for(var hasHighlightData=(highlightDataIndices=highlightDataIndices||[]).length&gt;0,highlightDataIndicesMap={},i=0;i&lt;highlightDataIndices.length;i++)highlightDataIndicesMap[highlightDataIndices[i]]=!0;this._labelsMesh.geometry.convertToDynamicArray(!0),this._labelTextureSurface.clear();for(var normalLabelQuery=["label"],emphasisLabelQuery=["emphasis","label"],seriesModel=this._data.hostModel,data=this._data,seriesLabelModel=seriesModel.getModel(normalLabelQuery),seriesLabelEmphasisModel=seriesModel.getModel(emphasisLabelQuery,seriesLabelModel),textAlignMap={left:"right",right:"left",top:"center",bottom:"center"},textVerticalAlignMap={left:"middle",right:"middle",top:"bottom",bottom:"top"},dataIndex=this._start;dataIndex&lt;this._end;dataIndex++){var isEmphasis=!1;if(hasHighlightData&amp;&amp;highlightDataIndicesMap[dataIndex]&amp;&amp;(isEmphasis=!0),this._labelsVisibilitiesBits[dataIndex-this._start]&amp;(isEmphasis?2:1)){var labelModel=data.getItemModel(dataIndex).getModel(isEmphasis?emphasisLabelQuery:normalLabelQuery,isEmphasis?seriesLabelEmphasisModel:seriesLabelModel),distance=labelModel.get("distance")||0,position=labelModel.get("position"),dpr=this._api.getDevicePixelRatio(),text=seriesModel.getFormattedLabel(dataIndex,isEmphasis?"emphasis":"normal");if(null==text||""===text)return;var textEl=new ZRText({style:createTextStyle(labelModel,{text:text,fill:labelModel.get("color")||getItemVisualColor(data,dataIndex)||"#000",align:"left",verticalAlign:"top",opacity:retrieve_firstNotNull(labelModel.get("opacity"),getItemVisualOpacity(data,dataIndex),1)})}),rect=textEl.getBoundingRect();rect.height*=1.2;var coords=this._labelTextureSurface.add(textEl),textAlign=textAlignMap[position]||"center",textVerticalAlign=textVerticalAlignMap[position]||"bottom";this._labelsMesh.geometry.addSprite(this.getLabelPosition(dataIndex,position,distance),[rect.width*dpr,rect.height*dpr],coords,textAlign,textVerticalAlign,this.getLabelDistance(dataIndex,position,distance)*dpr)}}this._labelsMesh.material.set("uvScale",this._labelTextureSurface.getCoordsScale()),this._labelTextureSurface.getZr().refreshImmediately(),this._labelsMesh.geometry.convertToTypedArray(),this._labelsMesh.geometry.dirty()}},LabelsBuilder.prototype.dispose=function(){this._labelTextureSurface.dispose()};var vec3$b=glmatrix.vec3;function Geo3DBuilder(api){this.rootNode=new graphicGL.Node,this._triangulationResults={},this._shadersMap=graphicGL.COMMON_SHADERS.filter(function(shaderName){return"shadow"!==shaderName}).reduce(function(obj,shaderName){return obj[shaderName]=graphicGL.createShader("ecgl."+shaderName),obj},{}),this._linesShader=graphicGL.createShader("ecgl.meshLines3D");var groundMaterials={};graphicGL.COMMON_SHADERS.forEach(function(shading){groundMaterials[shading]=new graphicGL.Material({shader:graphicGL.createShader("ecgl."+shading)})}),this._groundMaterials=groundMaterials,this._groundMesh=new graphicGL.Mesh({geometry:new graphicGL.PlaneGeometry({dynamic:!0}),castShadow:!1,renderNormal:!0,$ignorePicking:!0}),this._groundMesh.rotation.rotateX(-Math.PI/2),this._labelsBuilder=new LabelsBuilder(512,512,api),this._labelsBuilder.getMesh().renderOrder=100,this._labelsBuilder.getMesh().material.depthTest=!1,this.rootNode.add(this._labelsBuilder.getMesh()),this._initMeshes(),this._api=api}graphicGL.Shader.import(lines3DGLSL),Geo3DBuilder.prototype={constructor:Geo3DBuilder,extrudeY:!0,update:function(componentModel,ecModel,api,start,end){var data=componentModel.getData();null==start&amp;&amp;(start=0),null==end&amp;&amp;(end=data.count()),this._startIndex=start,this._endIndex=end-1,this._triangulation(componentModel,start,end);var shader=this._getShader(componentModel.get("shading"));this._prepareMesh(componentModel,shader,api,start,end),this.rootNode.updateWorldTransform(),this._updateRegionMesh(componentModel,api,start,end);var coordSys=componentModel.coordinateSystem;"geo3D"===coordSys.type&amp;&amp;this._updateGroundPlane(componentModel,coordSys,api);var self2=this;this._labelsBuilder.updateData(data,start,end),this._labelsBuilder.getLabelPosition=function(dataIndex,positionDesc,distance){var name=data.getName(dataIndex),height=distance;if("geo3D"===coordSys.type){var region=coordSys.getRegion(name);return region?(center=region.getCenter(),coordSys.dataToPoint([center[0],center[1],height])):[NaN,NaN,NaN]}var tmp=self2._triangulationResults[dataIndex-self2._startIndex],center=self2.extrudeY?[(tmp.max[0]+tmp.min[0])/2,tmp.max[1]+height,(tmp.max[2]+tmp.min[2])/2]:[(tmp.max[0]+tmp.min[0])/2,(tmp.max[1]+tmp.min[1])/2,tmp.max[2]+height]},this._data=data,this._labelsBuilder.updateLabels(),this._updateDebugWireframe(componentModel),this._lastHoverDataIndex=0},_initMeshes:function(){var self2=this;var polygonMesh=function createPolygonMesh(){var mesh=new graphicGL.Mesh({name:"Polygon",material:new graphicGL.Material({shader:self2._shadersMap.lambert}),geometry:new graphicGL.Geometry({sortTriangles:!0,dynamic:!0}),culling:!1,ignorePicking:!0,renderNormal:!0});return Object.assign(mesh.geometry,trianglesSortMixin),mesh}(),linesMesh=new graphicGL.Mesh({material:new graphicGL.Material({shader:this._linesShader}),castShadow:!1,ignorePicking:!0,$ignorePicking:!0,geometry:new LinesGeometry$2({useNativeLine:!1})});this.rootNode.add(polygonMesh),this.rootNode.add(linesMesh),polygonMesh.material.define("both","VERTEX_COLOR"),polygonMesh.material.define("fragment","DOUBLE_SIDED"),this._polygonMesh=polygonMesh,this._linesMesh=linesMesh,this.rootNode.add(this._groundMesh)},_getShader:function(shading){var shader=this._shadersMap[shading];return shader||(shader=this._shadersMap.lambert),shader.__shading=shading,shader},_prepareMesh:function(componentModel,shader,api,start,end){for(var polygonVertexCount=0,polygonTriangleCount=0,linesVertexCount=0,linesTriangleCount=0,idx=start;idx&lt;end;idx++){var polyInfo=this._getRegionPolygonInfo(idx),lineInfo=this._getRegionLinesInfo(idx,componentModel,this._linesMesh.geometry);polygonVertexCount+=polyInfo.vertexCount,polygonTriangleCount+=polyInfo.triangleCount,linesVertexCount+=lineInfo.vertexCount,linesTriangleCount+=lineInfo.triangleCount}var polygonMesh=this._polygonMesh,polygonGeo=polygonMesh.geometry;["position","normal","texcoord0","color"].forEach(function(attrName){polygonGeo.attributes[attrName].init(polygonVertexCount)}),polygonGeo.indices=polygonVertexCount&gt;65535?new Uint32Array(3*polygonTriangleCount):new Uint16Array(3*polygonTriangleCount),polygonMesh.material.shader!==shader&amp;&amp;polygonMesh.material.attachShader(shader,!0),graphicGL.setMaterialFromModel(shader.__shading,polygonMesh.material,componentModel,api),linesVertexCount&gt;0&amp;&amp;(this._linesMesh.geometry.resetOffset(),this._linesMesh.geometry.setVertexCount(linesVertexCount),this._linesMesh.geometry.setTriangleCount(linesTriangleCount)),this._dataIndexOfVertex=new Uint32Array(polygonVertexCount),this._vertexRangeOfDataIndex=new Uint32Array(2*(end-start))},_updateRegionMesh:function(componentModel,api,start,end){for(var data=componentModel.getData(),vertexOffset=0,triangleOffset=0,hasTranparentRegion=!1,polygonMesh=this._polygonMesh,linesMesh=this._linesMesh,dataIndex=start;dataIndex&lt;end;dataIndex++){var regionModel=componentModel.getRegionModel(dataIndex),itemStyleModel=regionModel.getModel("itemStyle"),color=retrieve_firstNotNull(getItemVisualColor(data,dataIndex),itemStyleModel.get("color"),"#fff"),opacity=retrieve_firstNotNull(getItemVisualOpacity(data,dataIndex),itemStyleModel.get("opacity"),1),colorArr=graphicGL.parseColor(color),borderColorArr=graphicGL.parseColor(itemStyleModel.get("borderColor"));colorArr[3]*=opacity,borderColorArr[3]*=opacity;var isTransparent=colorArr[3]&lt;.99;polygonMesh.material.set("color",[1,1,1,1]),hasTranparentRegion=hasTranparentRegion||isTransparent;for(var regionHeight=retrieve_firstNotNull(regionModel.get("height",!0),componentModel.get("regionHeight")),newOffsets=this._updatePolygonGeometry(componentModel,polygonMesh.geometry,dataIndex,regionHeight,vertexOffset,triangleOffset,colorArr),i=vertexOffset;i&lt;newOffsets.vertexOffset;i++)this._dataIndexOfVertex[i]=dataIndex;this._vertexRangeOfDataIndex[2*(dataIndex-start)]=vertexOffset,this._vertexRangeOfDataIndex[2*(dataIndex-start)+1]=newOffsets.vertexOffset,vertexOffset=newOffsets.vertexOffset,triangleOffset=newOffsets.triangleOffset;var lineWidth=itemStyleModel.get("borderWidth"),hasLine=lineWidth&gt;0;hasLine&amp;&amp;(lineWidth*=api.getDevicePixelRatio(),this._updateLinesGeometry(linesMesh.geometry,componentModel,dataIndex,regionHeight,lineWidth,componentModel.coordinateSystem.transform)),linesMesh.invisible=!hasLine,linesMesh.material.set({color:borderColorArr})}(polygonMesh=this._polygonMesh).material.transparent=hasTranparentRegion,polygonMesh.material.depthMask=!hasTranparentRegion,polygonMesh.geometry.updateBoundingBox(),polygonMesh.frontFace=this.extrudeY?graphicGL.Mesh.CCW:graphicGL.Mesh.CW,polygonMesh.material.get("normalMap")&amp;&amp;polygonMesh.geometry.generateTangents(),polygonMesh.seriesIndex=componentModel.seriesIndex,polygonMesh.on("mousemove",this._onmousemove,this),polygonMesh.on("mouseout",this._onmouseout,this)},_updateDebugWireframe:function(componentModel){var debugWireframeModel=componentModel.getModel("debug.wireframe");if(debugWireframeModel.get("show")){var color=graphicGL.parseColor(debugWireframeModel.get("lineStyle.color")||"rgba(0,0,0,0.5)"),width=retrieve_firstNotNull(debugWireframeModel.get("lineStyle.width"),1),mesh=this._polygonMesh;mesh.geometry.generateBarycentric(),mesh.material.define("both","WIREFRAME_TRIANGLE"),mesh.material.set("wireframeLineColor",color),mesh.material.set("wireframeLineWidth",width)}},_onmousemove:function(e2){var dataIndex=this._dataIndexOfVertex[e2.triangle[0]];null==dataIndex&amp;&amp;(dataIndex=-1),dataIndex!==this._lastHoverDataIndex&amp;&amp;(this.downplay(this._lastHoverDataIndex),this.highlight(dataIndex),this._labelsBuilder.updateLabels([dataIndex])),this._lastHoverDataIndex=dataIndex,this._polygonMesh.dataIndex=dataIndex},_onmouseout:function(e2){e2.target&amp;&amp;(this.downplay(this._lastHoverDataIndex),this._lastHoverDataIndex=-1,this._polygonMesh.dataIndex=-1),this._labelsBuilder.updateLabels([])},_updateGroundPlane:function(componentModel,geo3D,api){var groundModel=componentModel.getModel("groundPlane",componentModel);if(this._groundMesh.invisible=!groundModel.get("show",!0),!this._groundMesh.invisible){var shading=componentModel.get("shading"),material=this._groundMaterials[shading];material||(material=this._groundMaterials.lambert),graphicGL.setMaterialFromModel(shading,material,groundModel,api),material.get("normalMap")&amp;&amp;this._groundMesh.geometry.generateTangents(),this._groundMesh.material=material,this._groundMesh.material.set("color",graphicGL.parseColor(groundModel.get("color"))),this._groundMesh.scale.set(geo3D.size[0],geo3D.size[2],1)}},_triangulation:function(componentModel,start,end){this._triangulationResults=[];for(var minAll=[1/0,1/0,1/0],maxAll=[-1/0,-1/0,-1/0],coordSys=componentModel.coordinateSystem,idx=start;idx&lt;end;idx++){for(var polygons=[],polygonCoords=componentModel.getRegionPolygonCoords(idx),i=0;i&lt;polygonCoords.length;i++){var exterior=polygonCoords[i].exterior,interiors=polygonCoords[i].interiors,points=[],holes=[];if(!(exterior.length&lt;3)){for(var offset=0,j=0;j&lt;exterior.length;j++){var p=exterior[j];points[offset++]=p[0],points[offset++]=p[1]}for(j=0;j&lt;interiors.length;j++)if(!(interiors[j].length&lt;3)){for(var startIdx=points.length/2,k=0;k&lt;interiors[j].length;k++){p=interiors[j][k];points.push(p[0]),points.push(p[1])}holes.push(startIdx)}var triangles=earcut(points,holes),points3=new Float64Array(points.length/2*3),pos=[],min=[1/0,1/0,1/0],max=[-1/0,-1/0,-1/0],off3=0;for(j=0;j&lt;points.length;)vec3$b.set(pos,points[j++],0,points[j++]),coordSys&amp;&amp;coordSys.transform&amp;&amp;vec3$b.transformMat4(pos,pos,coordSys.transform),vec3$b.min(min,min,pos),vec3$b.max(max,max,pos),points3[off3++]=pos[0],points3[off3++]=pos[1],points3[off3++]=pos[2];vec3$b.min(minAll,minAll,min),vec3$b.max(maxAll,maxAll,max),polygons.push({points:points3,indices:triangles,min:min,max:max})}}this._triangulationResults.push(polygons)}this._geoBoundingBox=[minAll,maxAll]},_getRegionPolygonInfo:function(idx){for(var polygons=this._triangulationResults[idx-this._startIndex],sideVertexCount=0,sideTriangleCount=0,i=0;i&lt;polygons.length;i++)sideVertexCount+=polygons[i].points.length/3,sideTriangleCount+=polygons[i].indices.length/3;return{vertexCount:2*sideVertexCount+4*sideVertexCount,triangleCount:2*sideTriangleCount+2*sideVertexCount}},_updatePolygonGeometry:function(componentModel,geometry,dataIndex,regionHeight,vertexOffset,triangleOffset,color){var projectUVOnGround=componentModel.get("projectUVOnGround"),positionAttr=geometry.attributes.position,normalAttr=geometry.attributes.normal,texcoordAttr=geometry.attributes.texcoord0,colorAttr=geometry.attributes.color,polygons=this._triangulationResults[dataIndex-this._startIndex],hasColor=colorAttr.value&amp;&amp;color,indices=geometry.indices,extrudeCoordIndex=this.extrudeY?1:2,sideCoordIndex=this.extrudeY?2:1,scale=[this.rootNode.worldTransform.x.len(),this.rootNode.worldTransform.y.len(),this.rootNode.worldTransform.z.len()],min=vec3$b.mul([],this._geoBoundingBox[0],scale),max=vec3$b.mul([],this._geoBoundingBox[1],scale),maxDimSize=Math.max(max[0]-min[0],max[2]-min[2]);function buildTopBottom(polygon2,y,insideOffset){var startVertexOffset2=vertexOffset;!function addVertices(polygon2,y,insideOffset){for(var points=polygon2.points,pointsLen=points.length,currentPosition=[],uv2=[],k2=0;k2&lt;pointsLen;k2+=3)currentPosition[0]=points[k2],currentPosition[extrudeCoordIndex]=y,currentPosition[sideCoordIndex]=points[k2+2],uv2[0]=(points[k2]*scale[0]-min[0])/maxDimSize,uv2[1]=(points[k2+2]*scale[sideCoordIndex]-min[2])/maxDimSize,positionAttr.set(vertexOffset,currentPosition),hasColor&amp;&amp;colorAttr.set(vertexOffset,color),texcoordAttr.set(vertexOffset++,uv2)}(polygon2,y);for(var len2=polygon2.indices.length,k2=0;k2&lt;len2;k2++)indices[3*triangleOffset+k2]=polygon2.indices[k2]+startVertexOffset2;triangleOffset+=polygon2.indices.length/3}for(var normalTop=this.extrudeY?[0,1,0]:[0,0,1],normalBottom=vec3$b.negate([],normalTop),p=0;p&lt;polygons.length;p++){var startVertexOffset=vertexOffset,polygon=polygons[p];buildTopBottom(polygon,0),buildTopBottom(polygon,regionHeight);for(var ringVertexCount=polygon.points.length/3,v=0;v&lt;ringVertexCount;v++)normalAttr.set(startVertexOffset+v,normalBottom),normalAttr.set(startVertexOffset+v+ringVertexCount,normalTop);var quadToTriangle=[0,3,1,1,3,2],quadPos=[[],[],[],[]],a=[],b=[],normal2=[],uv=[],len=0;for(v=0;v&lt;ringVertexCount;v++){for(var next=(v+1)%ringVertexCount,dx=(polygon.points[3*next]-polygon.points[3*v])*scale[0],dy=(polygon.points[3*next+2]-polygon.points[3*v+2])*scale[sideCoordIndex],sideLen=Math.sqrt(dx*dx+dy*dy),k=0;k&lt;4;k++){var isCurrent=0===k||3===k,idx3=3*(isCurrent?v:next);quadPos[k][0]=polygon.points[idx3],quadPos[k][extrudeCoordIndex]=k&gt;1?regionHeight:0,quadPos[k][sideCoordIndex]=polygon.points[idx3+2],positionAttr.set(vertexOffset+k,quadPos[k]),projectUVOnGround?(uv[0]=(polygon.points[idx3]*scale[0]-min[0])/maxDimSize,uv[1]=(polygon.points[idx3+2]*scale[sideCoordIndex]-min[sideCoordIndex])/maxDimSize):(uv[0]=(isCurrent?len:len+sideLen)/maxDimSize,uv[1]=(quadPos[k][extrudeCoordIndex]*scale[extrudeCoordIndex]-min[extrudeCoordIndex])/maxDimSize),texcoordAttr.set(vertexOffset+k,uv)}vec3$b.sub(a,quadPos[1],quadPos[0]),vec3$b.sub(b,quadPos[3],quadPos[0]),vec3$b.cross(normal2,a,b),vec3$b.normalize(normal2,normal2);for(k=0;k&lt;4;k++)normalAttr.set(vertexOffset+k,normal2),hasColor&amp;&amp;colorAttr.set(vertexOffset+k,color);for(k=0;k&lt;6;k++)indices[3*triangleOffset+k]=quadToTriangle[k]+vertexOffset;vertexOffset+=4,triangleOffset+=2,len+=sideLen}}return geometry.dirty(),{vertexOffset:vertexOffset,triangleOffset:triangleOffset}},_getRegionLinesInfo:function(idx,componentModel,geometry){var vertexCount=0,triangleCount=0;componentModel.getRegionModel(idx).getModel("itemStyle").get("borderWidth")&gt;0&amp;&amp;componentModel.getRegionPolygonCoords(idx).forEach(function(coords){var exterior=coords.exterior,interiors=coords.interiors;vertexCount+=geometry.getPolylineVertexCount(exterior),triangleCount+=geometry.getPolylineTriangleCount(exterior);for(var i=0;i&lt;interiors.length;i++)vertexCount+=geometry.getPolylineVertexCount(interiors[i]),triangleCount+=geometry.getPolylineTriangleCount(interiors[i])},this);return{vertexCount:vertexCount,triangleCount:triangleCount}},_updateLinesGeometry:function(geometry,componentModel,dataIndex,regionHeight,lineWidth,transform){function convertToPoints3(polygon){for(var points=new Float64Array(3*polygon.length),offset=0,pos=[],i=0;i&lt;polygon.length;i++)pos[0]=polygon[i][0],pos[1]=regionHeight+.1,pos[2]=polygon[i][1],transform&amp;&amp;vec3$b.transformMat4(pos,pos,transform),points[offset++]=pos[0],points[offset++]=pos[1],points[offset++]=pos[2];return points}var whiteColor=[1,1,1,1];componentModel.getRegionPolygonCoords(dataIndex).forEach(function(geo){var exterior=geo.exterior,interiors=geo.interiors;geometry.addPolyline(convertToPoints3(exterior),whiteColor,lineWidth);for(var i=0;i&lt;interiors.length;i++)geometry.addPolyline(convertToPoints3(interiors[i]),whiteColor,lineWidth)})},highlight:function(dataIndex){var data=this._data;if(data){var emphasisItemStyleModel=data.getItemModel(dataIndex).getModel(["emphasis","itemStyle"]),emphasisColor=emphasisItemStyleModel.get("color"),emphasisOpacity=retrieve_firstNotNull(emphasisItemStyleModel.get("opacity"),getItemVisualOpacity(data,dataIndex),1);if(null==emphasisColor){var color=getItemVisualColor(data,dataIndex);emphasisColor=lift(color,-.4)}null==emphasisOpacity&amp;&amp;(emphasisOpacity=getItemVisualOpacity(data,dataIndex));var colorArr=graphicGL.parseColor(emphasisColor);colorArr[3]*=emphasisOpacity,this._setColorOfDataIndex(data,dataIndex,colorArr)}},downplay:function(dataIndex){var data=this._data;if(data){var itemStyleModel=data.getItemModel(dataIndex),color=retrieve_firstNotNull(getItemVisualColor(data,dataIndex),itemStyleModel.get(["itemStyle","color"]),"#fff"),opacity=retrieve_firstNotNull(getItemVisualOpacity(data,dataIndex),itemStyleModel.get(["itemStyle","opacity"]),1),colorArr=graphicGL.parseColor(color);colorArr[3]*=opacity,this._setColorOfDataIndex(data,dataIndex,colorArr)}},dispose:function(){this._labelsBuilder.dispose()},_setColorOfDataIndex:function(data,dataIndex,colorArr){if(!(dataIndex&lt;this._startIndex&amp;&amp;dataIndex&gt;this._endIndex)){dataIndex-=this._startIndex;for(var i=this._vertexRangeOfDataIndex[2*dataIndex];i&lt;this._vertexRangeOfDataIndex[2*dataIndex+1];i++)this._polygonMesh.geometry.attributes.color.set(i,colorArr);this._polygonMesh.geometry.dirty(),this._api.getZr().refresh()}}};const Geo3DView=ComponentView.extend({type:"geo3D",__ecgl__:!0,init:function(ecModel,api){this._geo3DBuilder=new Geo3DBuilder(api),this.groupGL=new graphicGL.Node,this._lightRoot=new graphicGL.Node,this._sceneHelper=new SceneHelper(this._lightRoot),this._sceneHelper.initLight(this._lightRoot),this._control=new OrbitControl({zr:api.getZr()}),this._control.init()},render:function(geo3DModel,ecModel,api){this.groupGL.add(this._geo3DBuilder.rootNode);var geo3D=geo3DModel.coordinateSystem;if(geo3D&amp;&amp;geo3D.viewGL){geo3D.viewGL.add(this._lightRoot),geo3DModel.get("show")?geo3D.viewGL.add(this.groupGL):geo3D.viewGL.remove(this.groupGL);var control=this._control;control.setViewGL(geo3D.viewGL);var viewControlModel=geo3DModel.getModel("viewControl");control.setFromViewControlModel(viewControlModel,0),this._sceneHelper.setScene(geo3D.viewGL.scene),this._sceneHelper.updateLight(geo3DModel),geo3D.viewGL.setPostEffect(geo3DModel.getModel("postEffect"),api),geo3D.viewGL.setTemporalSuperSampling(geo3DModel.getModel("temporalSuperSampling")),this._geo3DBuilder.update(geo3DModel,ecModel,api,0,geo3DModel.getData().count());var srgbDefineMethod=geo3D.viewGL.isLinearSpace()?"define":"undefine";this._geo3DBuilder.rootNode.traverse(function(mesh){mesh.material&amp;&amp;mesh.material[srgbDefineMethod]("fragment","SRGB_DECODE")}),control.off("update"),control.on("update",function(){api.dispatchAction({type:"geo3DChangeCamera",alpha:control.getAlpha(),beta:control.getBeta(),distance:control.getDistance(),center:control.getCenter(),from:this.uid,geo3DId:geo3DModel.id})}),control.update()}},afterRender:function(geo3DModel,ecModel,api,layerGL){var renderer=layerGL.renderer;this._sceneHelper.updateAmbientCubemap(renderer,geo3DModel,api),this._sceneHelper.updateSkybox(renderer,geo3DModel,api)},dispose:function(){this._control.dispose(),this._geo3DBuilder.dispose()}});var vec3$a=glmatrix.vec3,mat4$1=glmatrix.mat4,geoFixFuncs=[fixTextCoords,fixGeoCoords];function Geo3D(name,map2,geoJson,specialAreas,nameMap){this.name=name,this.map=map2,this.regionHeight=0,this.regions=[],this._nameCoordMap={},this.loadGeoJson(geoJson,specialAreas,nameMap),this.transform=mat4$1.identity(new Float64Array(16)),this.invTransform=mat4$1.identity(new Float64Array(16)),this.extrudeY=!0,this.altitudeAxis}function resizeGeo3D(geo3DModel,api){var boxLayoutOption=geo3DModel.getBoxLayoutParams(),viewport=getLayoutRect(boxLayoutOption,{width:api.getWidth(),height:api.getHeight()});viewport.y=api.getHeight()-viewport.y-viewport.height,this.viewGL.setViewport(viewport.x,viewport.y,viewport.width,viewport.height,api.getDevicePixelRatio());var geoRect=this.getGeoBoundingRect(),aspect=geoRect.width/geoRect.height*(geo3DModel.get("aspectScale")||.75),width=geo3DModel.get("boxWidth"),depth=geo3DModel.get("boxDepth"),height=geo3DModel.get("boxHeight");null==height&amp;&amp;(height=5),isNaN(width)&amp;&amp;isNaN(depth)&amp;&amp;(width=100),isNaN(depth)?depth=width/aspect:isNaN(width)&amp;&amp;(width=depth/aspect),this.setSize(width,height,depth),this.regionHeight=geo3DModel.get("regionHeight"),this.altitudeAxis&amp;&amp;this.altitudeAxis.setExtent(0,Math.max(height-this.regionHeight,0))}function updateGeo3D(ecModel,api){var altitudeDataExtent=[1/0,-1/0];if(ecModel.eachSeries(function(seriesModel){if(seriesModel.coordinateSystem===this&amp;&amp;"series.map3D"!==seriesModel.type){var data=seriesModel.getData(),altDims=seriesModel.coordDimToDataDim("alt"),altDim=altDims&amp;&amp;altDims[0];if(altDim){var dataExtent=data.getDataExtent(altDim,!0);altitudeDataExtent[0]=Math.min(altitudeDataExtent[0],dataExtent[0]),altitudeDataExtent[1]=Math.max(altitudeDataExtent[1],dataExtent[1])}}},this),altitudeDataExtent&amp;&amp;isFinite(altitudeDataExtent[1]-altitudeDataExtent[0])){var scale=createScale(altitudeDataExtent,{type:"value",min:"dataMin",max:"dataMax"});this.altitudeAxis=new Axis("altitude",scale),this.resize(this.model,api)}}Geo3D.prototype={constructor:Geo3D,type:"geo3D",dimensions:["lng","lat","alt"],containPoint:function(){},loadGeoJson:function(geoJson,specialAreas,nameMap){var parseGeoJSON$1=parseGeoJSON||parseGeoJSON;try{this.regions=geoJson?parseGeoJSON$1(geoJson):[]}catch(e2){throw"Invalid geoJson format\n"+e2}specialAreas=specialAreas||{},nameMap=nameMap||{};for(var regions=this.regions,regionsMap={},i=0;i&lt;regions.length;i++){var regionName=regions[i].name;regionName=nameMap[regionName]||regionName,regions[i].name=regionName,regionsMap[regionName]=regions[i],this.addGeoCoord(regionName,regions[i].getCenter());var specialArea=specialAreas[regionName];specialArea&amp;&amp;regions[i].transformTo(specialArea.left,specialArea.top,specialArea.width,specialArea.height)}this._regionsMap=regionsMap,this._geoRect=null,geoFixFuncs.forEach(function(fixFunc){fixFunc(this)},this)},getGeoBoundingRect:function(){if(this._geoRect)return this._geoRect;for(var rect,regions=this.regions,i=0;i&lt;regions.length;i++){var regionRect=regions[i].getBoundingRect();(rect=rect||regionRect.clone()).union(regionRect)}return this._geoRect=rect||new BoundingRect(0,0,0,0)},addGeoCoord:function(name,geoCoord){this._nameCoordMap[name]=geoCoord},getRegion:function(name){return this._regionsMap[name]},getRegionByCoord:function(coord){for(var regions=this.regions,i=0;i&lt;regions.length;i++)if(regions[i].contain(coord))return regions[i]},setSize:function(width,height,depth){this.size=[width,height,depth];var rect=this.getGeoBoundingRect(),scaleX=width/rect.width,scaleZ=-depth/rect.height,translateX=-width/2-rect.x*scaleX,translateZ=depth/2-rect.y*scaleZ,position=this.extrudeY?[translateX,0,translateZ]:[translateX,translateZ,0],scale=this.extrudeY?[scaleX,1,scaleZ]:[scaleX,scaleZ,1],m=this.transform;mat4$1.identity(m),mat4$1.translate(m,m,position),mat4$1.scale(m,m,scale),mat4$1.invert(this.invTransform,m)},dataToPoint:function(data,out){out=out||[];var extrudeCoordIndex=this.extrudeY?1:2,sideCoordIndex=this.extrudeY?2:1,altitudeVal=data[2];return isNaN(altitudeVal)&amp;&amp;(altitudeVal=0),out[0]=data[0],out[sideCoordIndex]=data[1],this.altitudeAxis?out[extrudeCoordIndex]=this.altitudeAxis.dataToCoord(altitudeVal):out[extrudeCoordIndex]=0,out[extrudeCoordIndex]+=this.regionHeight,vec3$a.transformMat4(out,out,this.transform),out},pointToData:function(point,out){}};var idStart=0,geo3DCreator={dimensions:Geo3D.prototype.dimensions,create:function(ecModel,api){var geo3DList=[];if(!getMap)throw new Error("geo3D component depends on geo component");function createGeo3D(componentModel,idx){var geo3D=geo3DCreator.createGeo3D(componentModel);componentModel.__viewGL=componentModel.__viewGL||new ViewGL,geo3D.viewGL=componentModel.__viewGL,componentModel.coordinateSystem=geo3D,geo3D.model=componentModel,geo3DList.push(geo3D),geo3D.resize=resizeGeo3D,geo3D.resize(componentModel,api),geo3D.update=updateGeo3D}return ecModel.eachComponent("geo3D",function(geo3DModel,idx){createGeo3D(geo3DModel)}),ecModel.eachSeriesByType("map3D",function(map3DModel,idx){var coordSys=map3DModel.get("coordinateSystem");null==coordSys&amp;&amp;(coordSys="geo3D"),"geo3D"===coordSys&amp;&amp;createGeo3D(map3DModel)}),ecModel.eachSeries(function(seriesModel){if("geo3D"===seriesModel.get("coordinateSystem")){if("series.map3D"===seriesModel.type)return;var geo3DModel=seriesModel.getReferringComponents("geo3D").models[0];if(geo3DModel||(geo3DModel=ecModel.getComponent("geo3D")),!geo3DModel)throw new Error('geo "'+retrieve_firstNotNull(seriesModel.get("geo3DIndex"),seriesModel.get("geo3DId"),0)+'" not found');seriesModel.coordinateSystem=geo3DModel.coordinateSystem}}),geo3DList},createGeo3D:function(componentModel){var name,mapData=componentModel.get("map");return"string"==typeof mapData?(name=mapData,mapData=getMap(mapData)):mapData&amp;&amp;mapData.features&amp;&amp;(mapData={geoJson:mapData}),null==name&amp;&amp;(name="GEO_ANONYMOUS_"+idStart++),new Geo3D(name+idStart++,name,mapData&amp;&amp;mapData.geoJson,mapData&amp;&amp;mapData.specialAreas,componentModel.get("nameMap"))}};function install$e(registers){registers.registerComponentModel(Geo3DModel),registers.registerComponentView(Geo3DView),registers.registerAction({type:"geo3DChangeCamera",event:"geo3dcamerachanged",update:"series:updateCamera"},function(payload,ecModel){ecModel.eachComponent({mainType:"geo3D",query:payload},function(componentModel){componentModel.setView(payload)})}),registers.registerCoordinateSystem("geo3D",geo3DCreator)}function defaultId(option,idx){option.id=option.id||option.name||idx+""}use(install$e);var GlobeModel=ComponentModel.extend({type:"globe",layoutMode:"box",coordinateSystem:null,init:function(){GlobeModel.superApply(this,"init",arguments),each(this.option.layers,function(layerOption,idx){merge(layerOption,this.defaultLayerOption),defaultId(layerOption,idx)},this)},mergeOption:function(option){var oldLayers=this.option.layers;function createLayerMap(layers){return reduce(layers,function(obj,layerOption,idx){return defaultId(layerOption,idx),obj[layerOption.id]=layerOption,obj},{})}if(this.option.layers=null,GlobeModel.superApply(this,"mergeOption",arguments),oldLayers&amp;&amp;oldLayers.length){var newLayerMap=createLayerMap(option.layers),oldLayerMap=createLayerMap(oldLayers);for(var id in newLayerMap)oldLayerMap[id]?merge(oldLayerMap[id],newLayerMap[id],!0):oldLayers.push(option.layers[id]);this.option.layers=oldLayers}each(this.option.layers,function(layerOption){merge(layerOption,this.defaultLayerOption)},this)},optionUpdated:function(){this.updateDisplacementHash()},defaultLayerOption:{show:!0,type:"overlay"},defaultOption:{show:!0,zlevel:-10,left:0,top:0,width:"100%",height:"100%",environment:"auto",baseColor:"#fff",baseTexture:"",heightTexture:"",displacementTexture:"",displacementScale:0,displacementQuality:"medium",globeRadius:100,globeOuterRadius:150,shading:"lambert",light:{main:{time:""}},atmosphere:{show:!1,offset:5,color:"#ffffff",glowPower:6,innerGlowPower:2},viewControl:{autoRotate:!0,panSensitivity:0,targetCoord:null},layers:[]},setDisplacementData:function(data,width,height){this.displacementData=data,this.displacementWidth=width,this.displacementHeight=height},getDisplacementTexture:function(){return this.get("displacementTexture")||this.get("heightTexture")},getDisplacemenScale:function(){var displacementTexture=this.getDisplacementTexture(),displacementScale=this.get("displacementScale");return displacementTexture&amp;&amp;"none"!==displacementTexture||(displacementScale=0),displacementScale},hasDisplacement:function(){return this.getDisplacemenScale()&gt;0},_displacementChanged:!0,_displacementScale:0,updateDisplacementHash:function(){var displacementTexture=this.getDisplacementTexture(),displacementScale=this.getDisplacemenScale();this._displacementChanged=this._displacementTexture!==displacementTexture||this._displacementScale!==displacementScale,this._displacementTexture=displacementTexture,this._displacementScale=displacementScale},isDisplacementChanged:function(){return this._displacementChanged}});merge(GlobeModel.prototype,componentViewControlMixin),merge(GlobeModel.prototype,componentPostEffectMixin),merge(GlobeModel.prototype,componentLightMixin),merge(GlobeModel.prototype,componentShadingMixin);var PI$1=Math.PI,sin=Math.sin,cos=Math.cos,tan=Math.tan,asin=Math.asin,atan=Math.atan2,rad=PI$1/180;var e=23.4397*rad;function rightAscension(l,b){return atan(sin(l)*cos(e)-tan(b)*sin(e),cos(l))}function declination(l,b){return asin(sin(b)*cos(e)+cos(b)*sin(e)*sin(l))}function azimuth(H,phi,dec){return atan(sin(H),cos(H)*sin(phi)-tan(dec)*cos(phi))}function altitude(H,phi,dec){return asin(sin(phi)*sin(dec)+cos(phi)*cos(dec)*cos(H))}function sunCoords(d){var M=function solarMeanAnomaly(d){return rad*(357.5291+.98560028*d)}(d),L=function eclipticLongitude(M){return M+rad*(1.9148*sin(M)+.02*sin(2*M)+3e-4*sin(3*M))+102.9372*rad+PI$1}(M);return{dec:declination(L,0),ra:rightAscension(L,0)}}var SunCalc={};SunCalc.getPosition=function(date,lat,lng){var lw=rad*-lng,phi=rad*lat,d=function toDays(date){return function toJulian(date){return date.valueOf()/864e5-.5+2440588}(date)-2451545}(date),c=sunCoords(d),H=function siderealTime(d,lw){return rad*(280.16+360.9856235*d)-lw}(d,lw)-c.ra;return{azimuth:azimuth(H,phi,c.dec),altitude:altitude(H,phi,c.dec)}};graphicGL.Shader.import(utilShaderCode),graphicGL.Shader.import("@export ecgl.atmosphere.vertex\nattribute vec3 position: POSITION;\nattribute vec3 normal : NORMAL;\nuniform mat4 worldViewProjection : WORLDVIEWPROJECTION;\nuniform mat4 normalMatrix : WORLDINVERSETRANSPOSE;\n\nvarying vec3 v_Normal;\n\nvoid main() {\n v_Normal = normalize((normalMatrix * vec4(normal, 0.0)).xyz);\n gl_Position = worldViewProjection * vec4(position, 1.0);\n}\n@end\n\n\n@export ecgl.atmosphere.fragment\nuniform mat4 viewTranspose: VIEWTRANSPOSE;\nuniform float glowPower;\nuniform vec3 glowColor;\n\nvarying vec3 v_Normal;\n\nvoid main() {\n float intensity = pow(1.0 - dot(v_Normal, (viewTranspose * vec4(0.0, 0.0, 1.0, 0.0)).xyz), glowPower);\n gl_FragColor = vec4(glowColor, intensity * intensity);\n}\n@end");const GlobeView=ComponentView.extend({type:"globe",__ecgl__:!0,_displacementScale:0,init:function(ecModel,api){this.groupGL=new graphicGL.Node,this._sphereGeometry=new graphicGL.SphereGeometry({widthSegments:200,heightSegments:100,dynamic:!0}),this._overlayGeometry=new graphicGL.SphereGeometry({widthSegments:80,heightSegments:40}),this._planeGeometry=new graphicGL.PlaneGeometry,this._earthMesh=new graphicGL.Mesh({renderNormal:!0}),this._atmosphereMesh=new graphicGL.Mesh,this._atmosphereGeometry=new graphicGL.SphereGeometry({widthSegments:80,heightSegments:40}),this._atmosphereMaterial=new graphicGL.Material({shader:new graphicGL.Shader(graphicGL.Shader.source("ecgl.atmosphere.vertex"),graphicGL.Shader.source("ecgl.atmosphere.fragment")),transparent:!0}),this._atmosphereMesh.geometry=this._atmosphereGeometry,this._atmosphereMesh.material=this._atmosphereMaterial,this._atmosphereMesh.frontFace=graphicGL.Mesh.CW,this._lightRoot=new graphicGL.Node,this._sceneHelper=new SceneHelper,this._sceneHelper.initLight(this._lightRoot),this.groupGL.add(this._atmosphereMesh),this.groupGL.add(this._earthMesh),this._control=new OrbitControl({zr:api.getZr()}),this._control.init(),this._layerMeshes={}},render:function(globeModel,ecModel,api){var coordSys=globeModel.coordinateSystem,shading=globeModel.get("shading");coordSys.viewGL.add(this._lightRoot),globeModel.get("show")?coordSys.viewGL.add(this.groupGL):coordSys.viewGL.remove(this.groupGL),this._sceneHelper.setScene(coordSys.viewGL.scene),coordSys.viewGL.setPostEffect(globeModel.getModel("postEffect"),api),coordSys.viewGL.setTemporalSuperSampling(globeModel.getModel("temporalSuperSampling"));var earthMesh=this._earthMesh;earthMesh.geometry=this._sphereGeometry;var shadingPrefix="ecgl."+shading;earthMesh.material&amp;&amp;earthMesh.material.shader.name===shadingPrefix||(earthMesh.material=graphicGL.createMaterial(shadingPrefix)),graphicGL.setMaterialFromModel(shading,earthMesh.material,globeModel,api),["roughnessMap","metalnessMap","detailMap","normalMap"].forEach(function(texName){var texture=earthMesh.material.get(texName);texture&amp;&amp;(texture.flipY=!1)}),earthMesh.material.set("color",graphicGL.parseColor(globeModel.get("baseColor")));var scale=.99*coordSys.radius;if(earthMesh.scale.set(scale,scale,scale),globeModel.get("atmosphere.show")){earthMesh.material.define("both","ATMOSPHERE_ENABLED"),this._atmosphereMesh.invisible=!1,this._atmosphereMaterial.setUniforms({glowPower:globeModel.get("atmosphere.glowPower")||6,glowColor:globeModel.get("atmosphere.color")||"#ffffff"}),earthMesh.material.setUniforms({glowPower:globeModel.get("atmosphere.innerGlowPower")||2,glowColor:globeModel.get("atmosphere.color")||"#ffffff"});var offset=globeModel.get("atmosphere.offset")||5;this._atmosphereMesh.scale.set(scale+offset,scale+offset,scale+offset)}else earthMesh.material.undefine("both","ATMOSPHERE_ENABLED"),this._atmosphereMesh.invisible=!0;var diffuseTexture=earthMesh.material.setTextureImage("diffuseMap",globeModel.get("baseTexture"),api,{flipY:!1,anisotropic:8});diffuseTexture&amp;&amp;diffuseTexture.surface&amp;&amp;diffuseTexture.surface.attachToMesh(earthMesh);var bumpTexture=earthMesh.material.setTextureImage("bumpMap",globeModel.get("heightTexture"),api,{flipY:!1,anisotropic:8});bumpTexture&amp;&amp;bumpTexture.surface&amp;&amp;bumpTexture.surface.attachToMesh(earthMesh),earthMesh.material[globeModel.get("postEffect.enable")?"define":"undefine"]("fragment","SRGB_DECODE"),this._updateLight(globeModel,api),this._displaceVertices(globeModel,api),this._updateViewControl(globeModel,api),this._updateLayers(globeModel,api)},afterRender:function(globeModel,ecModel,api,layerGL){var renderer=layerGL.renderer;this._sceneHelper.updateAmbientCubemap(renderer,globeModel,api),this._sceneHelper.updateSkybox(renderer,globeModel,api)},_updateLayers:function(globeModel,api){var coordSys=globeModel.coordinateSystem,layers=globeModel.get("layers"),lastDistance=coordSys.radius,layerDiffuseTextures=[],layerDiffuseIntensity=[],layerEmissiveTextures=[],layerEmissionIntensity=[];each(layers,function(layerOption){var layerModel=new Model(layerOption),layerType=layerModel.get("type"),texture=graphicGL.loadTexture(layerModel.get("texture"),api,{flipY:!1,anisotropic:8});if(texture.surface&amp;&amp;texture.surface.attachToMesh(this._earthMesh),"blend"===layerType){var blendTo=layerModel.get("blendTo"),intensity=retrieve_firstNotNull(layerModel.get("intensity"),1);"emission"===blendTo?(layerEmissiveTextures.push(texture),layerEmissionIntensity.push(intensity)):(layerDiffuseTextures.push(texture),layerDiffuseIntensity.push(intensity))}else{var id=layerModel.get("id"),overlayMesh=this._layerMeshes[id];overlayMesh||(overlayMesh=this._layerMeshes[id]=new graphicGL.Mesh({geometry:this._overlayGeometry,castShadow:!1,ignorePicking:!0})),"lambert"===layerModel.get("shading")?(overlayMesh.material=overlayMesh.__lambertMaterial||new graphicGL.Material({autoUpdateTextureStatus:!1,shader:graphicGL.createShader("ecgl.lambert"),transparent:!0,depthMask:!1}),overlayMesh.__lambertMaterial=overlayMesh.material):(overlayMesh.material=overlayMesh.__colorMaterial||new graphicGL.Material({autoUpdateTextureStatus:!1,shader:graphicGL.createShader("ecgl.color"),transparent:!0,depthMask:!1}),overlayMesh.__colorMaterial=overlayMesh.material),overlayMesh.material.enableTexture("diffuseMap");var distance=layerModel.get("distance"),radius=lastDistance+(null==distance?coordSys.radius/100:distance);overlayMesh.scale.set(radius,radius,radius),lastDistance=radius;var blankTexture=this._blankTexture||(this._blankTexture=graphicGL.createBlankTexture("rgba(255, 255, 255, 0)"));overlayMesh.material.set("diffuseMap",blankTexture),graphicGL.loadTexture(layerModel.get("texture"),api,{flipY:!1,anisotropic:8},function(texture2){texture2.surface&amp;&amp;texture2.surface.attachToMesh(overlayMesh),overlayMesh.material.set("diffuseMap",texture2),api.getZr().refresh()}),layerModel.get("show")?this.groupGL.add(overlayMesh):this.groupGL.remove(overlayMesh)}},this);var earthMaterial=this._earthMesh.material;earthMaterial.define("fragment","LAYER_DIFFUSEMAP_COUNT",layerDiffuseTextures.length),earthMaterial.define("fragment","LAYER_EMISSIVEMAP_COUNT",layerEmissiveTextures.length),earthMaterial.set("layerDiffuseMap",layerDiffuseTextures),earthMaterial.set("layerDiffuseIntensity",layerDiffuseIntensity),earthMaterial.set("layerEmissiveMap",layerEmissiveTextures),earthMaterial.set("layerEmissionIntensity",layerEmissionIntensity);var debugWireframeModel=globeModel.getModel("debug.wireframe");if(debugWireframeModel.get("show")){earthMaterial.define("both","WIREFRAME_TRIANGLE");var color=graphicGL.parseColor(debugWireframeModel.get("lineStyle.color")||"rgba(0,0,0,0.5)"),width=retrieve_firstNotNull(debugWireframeModel.get("lineStyle.width"),1);earthMaterial.set("wireframeLineWidth",width),earthMaterial.set("wireframeLineColor",color)}else earthMaterial.undefine("both","WIREFRAME_TRIANGLE")},_updateViewControl:function(globeModel,api){var coordSys=globeModel.coordinateSystem,viewControlModel=globeModel.getModel("viewControl");coordSys.viewGL.camera;var self2=this;var control=this._control;control.setViewGL(coordSys.viewGL);var alpha2,beta,coord=viewControlModel.get("targetCoord");null!=coord&amp;&amp;(beta=coord[0]+90,alpha2=coord[1]),control.setFromViewControlModel(viewControlModel,{baseDistance:coordSys.radius,alpha:alpha2,beta:beta}),control.off("update"),control.on("update",function(){api.dispatchAction(function makeAction(){return{type:"globeChangeCamera",alpha:control.getAlpha(),beta:control.getBeta(),distance:control.getDistance()-coordSys.radius,center:control.getCenter(),from:self2.uid,globeId:globeModel.id}}())})},_displaceVertices:function(globeModel,api){var displacementQuality=globeModel.get("displacementQuality"),showDebugWireframe=globeModel.get("debug.wireframe.show"),globe=globeModel.coordinateSystem;if(globeModel.isDisplacementChanged()||displacementQuality!==this._displacementQuality||showDebugWireframe!==this._showDebugWireframe){this._displacementQuality=displacementQuality,this._showDebugWireframe=showDebugWireframe;var geometry=this._sphereGeometry,widthSegments={low:100,medium:200,high:400,ultra:800}[displacementQuality]||200,heightSegments=widthSegments/2;(geometry.widthSegments!==widthSegments||showDebugWireframe)&amp;&amp;(geometry.widthSegments=widthSegments,geometry.heightSegments=heightSegments,geometry.build()),this._doDisplaceVertices(geometry,globe),showDebugWireframe&amp;&amp;geometry.generateBarycentric()}},_doDisplaceVertices:function(geometry,globe){var positionArr=geometry.attributes.position.value,uvArr=geometry.attributes.texcoord0.value,originalPositionArr=geometry.__originalPosition;originalPositionArr&amp;&amp;originalPositionArr.length===positionArr.length||((originalPositionArr=new Float32Array(positionArr.length)).set(positionArr),geometry.__originalPosition=originalPositionArr);for(var width=globe.displacementWidth,height=globe.displacementHeight,data=globe.displacementData,i=0;i&lt;geometry.vertexCount;i++){var i3=3*i,i2=2*i,x=originalPositionArr[i3+1],y=originalPositionArr[i3+2],z=originalPositionArr[i3+3],u=uvArr[i2++],v=uvArr[i2++],j=Math.round(u*(width-1)),k=Math.round(v*(height-1)),scale=data?data[k*width+j]:0;positionArr[i3+1]=x+x*scale,positionArr[i3+2]=y+y*scale,positionArr[i3+3]=z+z*scale}geometry.generateVertexNormals(),geometry.dirty(),geometry.updateBoundingBox()},_updateLight:function(globeModel,api){var earthMesh=this._earthMesh;this._sceneHelper.updateLight(globeModel);var mainLight=this._sceneHelper.mainLight,time=globeModel.get("light.main.time")||new Date,pos=SunCalc.getPosition(parseDate(time),0,0),r0=Math.cos(pos.altitude);mainLight.position.y=-r0*Math.cos(pos.azimuth),mainLight.position.x=Math.sin(pos.altitude),mainLight.position.z=r0*Math.sin(pos.azimuth),mainLight.lookAt(earthMesh.getWorldPosition())},dispose:function(ecModel,api){this.groupGL.removeAll(),this._control.dispose()}});var vec3$9=glmatrix.vec3;function Globe(radius){this.radius=radius,this.viewGL=null,this.altitudeAxis,this.displacementData=null,this.displacementWidth,this.displacementHeight}function resizeGlobe(globeModel,api){var boxLayoutOption=globeModel.getBoxLayoutParams(),viewport=getLayoutRect(boxLayoutOption,{width:api.getWidth(),height:api.getHeight()});viewport.y=api.getHeight()-viewport.y-viewport.height,this.viewGL.setViewport(viewport.x,viewport.y,viewport.width,viewport.height,api.getDevicePixelRatio()),this.radius=globeModel.get("globeRadius");var outerRadius=globeModel.get("globeOuterRadius");this.altitudeAxis&amp;&amp;this.altitudeAxis.setExtent(0,outerRadius-this.radius)}function updateGlobe(ecModel,api){var altitudeDataExtent=[1/0,-1/0];if(ecModel.eachSeries(function(seriesModel){if(seriesModel.coordinateSystem===this){var data=seriesModel.getData(),altDims=seriesModel.coordDimToDataDim("alt"),altDim=altDims&amp;&amp;altDims[0];if(altDim){var dataExtent=data.getDataExtent(altDim,!0);altitudeDataExtent[0]=Math.min(altitudeDataExtent[0],dataExtent[0]),altitudeDataExtent[1]=Math.max(altitudeDataExtent[1],dataExtent[1])}}},this),altitudeDataExtent&amp;&amp;isFinite(altitudeDataExtent[1]-altitudeDataExtent[0])){var scale=createScale(altitudeDataExtent,{type:"value",min:"dataMin",max:"dataMax"});this.altitudeAxis=new Axis("altitude",scale),this.resize(this.model,api)}}Globe.prototype={constructor:Globe,dimensions:["lng","lat","alt"],type:"globe",containPoint:function(){},setDisplacementData:function(data,width,height){this.displacementData=data,this.displacementWidth=width,this.displacementHeight=height},_getDisplacementScale:function(lng,lat){var i=(lng+180)/360*(this.displacementWidth-1),j=(90-lat)/180*(this.displacementHeight-1),idx=Math.round(i)+Math.round(j)*this.displacementWidth;return this.displacementData[idx]},dataToPoint:function(data,out){var lng=data[0],lat=data[1],altVal=data[2]||0,r=this.radius;this.displacementData&amp;&amp;(r*=1+this._getDisplacementScale(lng,lat)),this.altitudeAxis&amp;&amp;(r+=this.altitudeAxis.dataToCoord(altVal)),lng=lng*Math.PI/180,lat=lat*Math.PI/180;var r0=Math.cos(lat)*r;return(out=out||[])[0]=-r0*Math.cos(lng+Math.PI),out[1]=Math.sin(lat)*r,out[2]=r0*Math.sin(lng+Math.PI),out},pointToData:function(point,out){var x=point[0],y=point[1],z=point[2],len=vec3$9.len(point);x/=len,y/=len,z/=len;var theta=Math.asin(y),phi=Math.atan2(z,-x);phi&lt;0&amp;&amp;(phi=2*Math.PI+phi);var lat=180*theta/Math.PI,lng=180*phi/Math.PI-180;return(out=out||[])[0]=lng,out[1]=lat,out[2]=len-this.radius,this.altitudeAxis&amp;&amp;(out[2]=this.altitudeAxis.coordToData(out[2])),out}};var globeCreator={dimensions:Globe.prototype.dimensions,create:function(ecModel,api){var globeList=[];return ecModel.eachComponent("globe",function(globeModel){globeModel.__viewGL=globeModel.__viewGL||new ViewGL;var globe=new Globe;globe.viewGL=globeModel.__viewGL,globeModel.coordinateSystem=globe,globe.model=globeModel,globeList.push(globe),globe.resize=resizeGlobe,globe.resize(globeModel,api),globe.update=updateGlobe}),ecModel.eachSeries(function(seriesModel){if("globe"===seriesModel.get("coordinateSystem")){var globeModel=seriesModel.getReferringComponents("globe").models[0];if(globeModel||(globeModel=ecModel.getComponent("globe")),!globeModel)throw new Error('globe "'+retrieve_firstNotNull(seriesModel.get("globe3DIndex"),seriesModel.get("globe3DId"),0)+'" not found');var coordSys=globeModel.coordinateSystem;seriesModel.coordinateSystem=coordSys}}),ecModel.eachComponent("globe",function(globeModel,idx){var globe=globeModel.coordinateSystem,displacementTextureValue=globeModel.getDisplacementTexture(),displacementScale=globeModel.getDisplacemenScale();if(globeModel.isDisplacementChanged()){if(globeModel.hasDisplacement()){var immediateLoaded=!0;graphicGL.loadTexture(displacementTextureValue,api,function(texture){var displacementData=function getDisplacementData(img,displacementScale){var canvas=document.createElement("canvas"),ctx=canvas.getContext("2d"),width=img.width,height=img.height;canvas.width=width,canvas.height=height,ctx.drawImage(img,0,0,width,height);for(var rgbaArr=ctx.getImageData(0,0,width,height).data,displacementArr=new Float32Array(rgbaArr.length/4),i=0;i&lt;rgbaArr.length/4;i++){var x=rgbaArr[4*i];displacementArr[i]=x/255*displacementScale}return{data:displacementArr,width:width,height:height}}(texture.image,displacementScale);globeModel.setDisplacementData(displacementData.data,displacementData.width,displacementData.height),immediateLoaded||api.dispatchAction({type:"globeUpdateDisplacment"})}),immediateLoaded=!1}else globe.setDisplacementData(null,0,0);globe.setDisplacementData(globeModel.displacementData,globeModel.displacementWidth,globeModel.displacementHeight)}}),globeList}};use(function install$d(registers){registers.registerComponentModel(GlobeModel),registers.registerComponentView(GlobeView),registers.registerCoordinateSystem("globe",globeCreator),registers.registerAction({type:"globeChangeCamera",event:"globecamerachanged",update:"series:updateCamera"},function(payload,ecModel){ecModel.eachComponent({mainType:"globe",query:payload},function(componentModel){componentModel.setView(payload)})}),registers.registerAction({type:"globeUpdateDisplacment",event:"globedisplacementupdated",update:"update"},function(payload,ecModel){})});var MAPBOX_CAMERA_OPTION=["zoom","center","pitch","bearing"],Mapbox3DModel=ComponentModel.extend({type:"mapbox3D",layoutMode:"box",coordinateSystem:null,defaultOption:{zlevel:-10,style:"mapbox://styles/mapbox/light-v9",center:[0,0],zoom:0,pitch:0,bearing:0,light:{main:{alpha:20,beta:30}},altitudeScale:1,boxHeight:"auto"},getMapboxCameraOption:function(){var self2=this;return MAPBOX_CAMERA_OPTION.reduce(function(obj,key){return obj[key]=self2.get(key),obj},{})},setMapboxCameraOption:function(option){null!=option&amp;&amp;MAPBOX_CAMERA_OPTION.forEach(function(key){null!=option[key]&amp;&amp;(this.option[key]=option[key])},this)},getMapbox:function(){return this._mapbox},setMapbox:function(mapbox){this._mapbox=mapbox}});function Mapbox3DLayer(id,zr){if(this.id=id,this.zr=zr,this.dom=document.createElement("div"),this.dom.style.cssText="position:absolute;left:0;right:0;top:0;bottom:0;",!mapboxgl)throw new Error("Mapbox GL library must be included. See https://www.mapbox.com/mapbox-gl-js/api/");this._mapbox=new mapboxgl.Map({container:this.dom}),this._initEvents()}merge(Mapbox3DModel.prototype,componentPostEffectMixin),merge(Mapbox3DModel.prototype,componentLightMixin),Mapbox3DLayer.prototype.setUnpainted=function(){},Mapbox3DLayer.prototype.resize=function(){this._mapbox.resize()},Mapbox3DLayer.prototype.getMapbox=function(){return this._mapbox},Mapbox3DLayer.prototype.clear=function(){},Mapbox3DLayer.prototype.refresh=function(){this._mapbox.resize()};var EVENTS$1=["mousedown","mouseup","click","dblclick","mousemove","mousewheel","wheel","touchstart","touchend","touchmove","touchcancel"];Mapbox3DLayer.prototype._initEvents=function(){var mapboxRoot=this._mapbox.getCanvasContainer();this._handlers=this._handlers||{contextmenu:function(e2){return e2.preventDefault(),!1}},EVENTS$1.forEach(function(eName){this._handlers[eName]=function(e2){var obj={};for(var name in e2)obj[name]=e2[name];obj.bubbles=!1;var newE=new e2.constructor(e2.type,obj);mapboxRoot.dispatchEvent(newE)},this.zr.dom.addEventListener(eName,this._handlers[eName])},this),this.zr.dom.addEventListener("contextmenu",this._handlers.contextmenu)},Mapbox3DLayer.prototype.dispose=function(){EVENTS$1.forEach(function(eName){this.zr.dom.removeEventListener(eName,this._handlers[eName])},this)};const displayShadowGLSL="\n@export ecgl.displayShadow.vertex\n\n@import ecgl.common.transformUniforms\n\n@import ecgl.common.uv.header\n\n@import ecgl.common.attributes\n\nvarying vec3 v_WorldPosition;\n\nvarying vec3 v_Normal;\n\nvoid main()\n{\n @import ecgl.common.uv.main\n v_Normal = normalize((worldInverseTranspose * vec4(normal, 0.0)).xyz);\n\n v_WorldPosition = (world * vec4(position, 1.0)).xyz;\n gl_Position = worldViewProjection * vec4(position, 1.0);\n}\n\n@end\n\n\n@export ecgl.displayShadow.fragment\n\n@import ecgl.common.uv.fragmentHeader\n\nvarying vec3 v_Normal;\nvarying vec3 v_WorldPosition;\n\nuniform float roughness: 0.2;\n\n#ifdef DIRECTIONAL_LIGHT_COUNT\n@import clay.header.directional_light\n#endif\n\n@import ecgl.common.ssaoMap.header\n\n@import clay.plugin.compute_shadow_map\n\nvoid main()\n{\n float shadow = 1.0;\n\n @import ecgl.common.ssaoMap.main\n\n#if defined(DIRECTIONAL_LIGHT_COUNT) &amp;&amp; defined(DIRECTIONAL_LIGHT_SHADOWMAP_COUNT)\n float shadowContribsDir[DIRECTIONAL_LIGHT_COUNT];\n if(shadowEnabled)\n {\n computeShadowOfDirectionalLights(v_WorldPosition, shadowContribsDir);\n }\n for (int i = 0; i &lt; DIRECTIONAL_LIGHT_COUNT; i++) {\n shadow = min(shadow, shadowContribsDir[i] * 0.5 + 0.5);\n }\n#endif\n\n shadow *= 0.5 + ao * 0.5;\n shadow = clamp(shadow, 0.0, 1.0);\n\n gl_FragColor = vec4(vec3(0.0), 1.0 - shadow);\n}\n\n@end";graphicGL.Shader.import(displayShadowGLSL);const Mapbox3DView=ComponentView.extend({type:"mapbox3D",__ecgl__:!0,init:function(ecModel,api){var zr=api.getZr();this._zrLayer=new Mapbox3DLayer("mapbox3D",zr),zr.painter.insertLayer(-1e3,this._zrLayer),this._lightRoot=new graphicGL.Node,this._sceneHelper=new SceneHelper(this._lightRoot),this._sceneHelper.initLight(this._lightRoot);var mapbox=this._zrLayer.getMapbox(),dispatchInteractAction=this._dispatchInteractAction.bind(this,api,mapbox);["zoom","rotate","drag","pitch","rotate","move"].forEach(function(eName){mapbox.on(eName,dispatchInteractAction)}),this._groundMesh=new graphicGL.Mesh({geometry:new graphicGL.PlaneGeometry,material:new graphicGL.Material({shader:new graphicGL.Shader({vertex:graphicGL.Shader.source("ecgl.displayShadow.vertex"),fragment:graphicGL.Shader.source("ecgl.displayShadow.fragment")}),depthMask:!1}),renderOrder:-100,culling:!1,castShadow:!1,$ignorePicking:!0,renderNormal:!0})},render:function(mapbox3DModel,ecModel,api){var mapbox=this._zrLayer.getMapbox(),styleDesc=mapbox3DModel.get("style"),styleStr=JSON.stringify(styleDesc);styleStr!==this._oldStyleStr&amp;&amp;styleDesc&amp;&amp;mapbox.setStyle(styleDesc),this._oldStyleStr=styleStr,mapbox.setCenter(mapbox3DModel.get("center")),mapbox.setZoom(mapbox3DModel.get("zoom")),mapbox.setPitch(mapbox3DModel.get("pitch")),mapbox.setBearing(mapbox3DModel.get("bearing")),mapbox3DModel.setMapbox(mapbox);var coordSys=mapbox3DModel.coordinateSystem;coordSys.viewGL.scene.add(this._lightRoot),coordSys.viewGL.add(this._groundMesh),this._updateGroundMesh(),this._sceneHelper.setScene(coordSys.viewGL.scene),this._sceneHelper.updateLight(mapbox3DModel),coordSys.viewGL.setPostEffect(mapbox3DModel.getModel("postEffect"),api),coordSys.viewGL.setTemporalSuperSampling(mapbox3DModel.getModel("temporalSuperSampling")),this._mapbox3DModel=mapbox3DModel},afterRender:function(mapbox3DModel,ecModel,api,layerGL){var renderer=layerGL.renderer;this._sceneHelper.updateAmbientCubemap(renderer,mapbox3DModel,api),this._sceneHelper.updateSkybox(renderer,mapbox3DModel,api),mapbox3DModel.coordinateSystem.viewGL.scene.traverse(function(mesh){mesh.material&amp;&amp;(mesh.material.define("fragment","NORMAL_UP_AXIS",2),mesh.material.define("fragment","NORMAL_FRONT_AXIS",1))})},updateCamera:function(mapbox3DModel,ecModel,api,payload){mapbox3DModel.coordinateSystem.setCameraOption(payload),this._updateGroundMesh(),api.getZr().refresh()},_dispatchInteractAction:function(api,mapbox,mapbox3DModel){api.dispatchAction({type:"mapbox3DChangeCamera",pitch:mapbox.getPitch(),zoom:mapbox.getZoom(),center:mapbox.getCenter().toArray(),bearing:mapbox.getBearing(),mapbox3DId:this._mapbox3DModel&amp;&amp;this._mapbox3DModel.id})},_updateGroundMesh:function(){if(this._mapbox3DModel){var coordSys=this._mapbox3DModel.coordinateSystem,pt=coordSys.dataToPoint(coordSys.center);this._groundMesh.position.set(pt[0],pt[1],-.001);var plane=new graphicGL.Plane(new graphicGL.Vector3(0,0,1),0),ray1=coordSys.viewGL.camera.castRay(new graphicGL.Vector2(-1,-1)),ray2=coordSys.viewGL.camera.castRay(new graphicGL.Vector2(1,1)),pos0=ray1.intersectPlane(plane),pos1=ray2.intersectPlane(plane),scale=pos0.dist(pos1)/coordSys.viewGL.rootNode.scale.x;this._groundMesh.scale.set(scale,scale,1)}},dispose:function(ecModel,api){this._zrLayer&amp;&amp;this._zrLayer.dispose(),api.getZr().painter.delLayer(-1e3)}});var mat4=glmatrix.mat4,FOV=.6435011087932844,PI=Math.PI;function MapServiceCoordSys3D(){this.width=0,this.height=0,this.altitudeScale=1,this.boxHeight="auto",this.altitudeExtent,this.bearing=0,this.pitch=0,this.center=[0,0],this._origin,this.zoom=0,this._initialZoom,this.maxPitch=60,this.zoomOffset=0}function Mapbox3D(){MapServiceCoordSys3D.apply(this,arguments)}function createMapService3DCreator(serviceComponentType,ServiceCtor,afterCreate){function resizeMapService3D(mapService3DModel,api){var width=api.getWidth(),height=api.getHeight(),dpr=api.getDevicePixelRatio();this.viewGL.setViewport(0,0,width,height,dpr),this.width=width,this.height=height,this.altitudeScale=mapService3DModel.get("altitudeScale"),this.boxHeight=mapService3DModel.get("boxHeight")}function updateService3D(ecModel,api){if("auto"!==this.model.get("boxHeight")){var altitudeDataExtent=[1/0,-1/0];ecModel.eachSeries(function(seriesModel){if(seriesModel.coordinateSystem===this){var data=seriesModel.getData(),altDim=seriesModel.coordDimToDataDim("alt")[0];if(altDim){var dataExtent=data.getDataExtent(altDim,!0);altitudeDataExtent[0]=Math.min(altitudeDataExtent[0],dataExtent[0]),altitudeDataExtent[1]=Math.max(altitudeDataExtent[1],dataExtent[1])}}},this),altitudeDataExtent&amp;&amp;isFinite(altitudeDataExtent[1]-altitudeDataExtent[0])&amp;&amp;(this.altitudeExtent=altitudeDataExtent)}}return{dimensions:ServiceCtor.prototype.dimensions,create:function(ecModel,api){var mapService3DList=[];return ecModel.eachComponent(serviceComponentType,function(mapService3DModel){var viewGL=mapService3DModel.__viewGL;viewGL||(viewGL=mapService3DModel.__viewGL=new ViewGL).setRootNode(new graphicGL.Node);var mapService3DCoordSys=new ServiceCtor;mapService3DCoordSys.viewGL=mapService3DModel.__viewGL,mapService3DCoordSys.resize=resizeMapService3D,mapService3DCoordSys.resize(mapService3DModel,api),mapService3DList.push(mapService3DCoordSys),mapService3DModel.coordinateSystem=mapService3DCoordSys,mapService3DCoordSys.model=mapService3DModel,mapService3DCoordSys.update=updateService3D}),ecModel.eachSeries(function(seriesModel){if(seriesModel.get("coordinateSystem")===serviceComponentType){var mapService3DModel=seriesModel.getReferringComponents(serviceComponentType).models[0];if(mapService3DModel||(mapService3DModel=ecModel.getComponent(serviceComponentType)),!mapService3DModel)throw new Error(serviceComponentType+' "'+retrieve_firstNotNull(seriesModel.get(serviceComponentType+"Index"),seriesModel.get(serviceComponentType+"Id"),0)+'" not found');seriesModel.coordinateSystem=mapService3DModel.coordinateSystem}}),afterCreate&amp;&amp;afterCreate(mapService3DList,ecModel,api),mapService3DList}}}MapServiceCoordSys3D.prototype={constructor:MapServiceCoordSys3D,dimensions:["lng","lat","alt"],containPoint:function(){},setCameraOption:function(option){this.bearing=option.bearing,this.pitch=option.pitch,this.center=option.center,this.zoom=option.zoom,this._origin||(this._origin=this.projectOnTileWithScale(this.center,512)),null==this._initialZoom&amp;&amp;(this._initialZoom=this.zoom),this.updateTransform()},updateTransform:function(){if(this.height){var cameraToCenterDistance=.5/Math.tan(FOV/2)*this.height*.1,pitch=Math.max(Math.min(this.pitch,this.maxPitch),0)/180*Math.PI,halfFov=FOV/2,groundAngle=Math.PI/2+pitch,topHalfSurfaceDistance=Math.sin(halfFov)*cameraToCenterDistance/Math.sin(Math.PI-groundAngle-halfFov),farZ=1.1*(Math.cos(Math.PI/2-pitch)*topHalfSurfaceDistance+cameraToCenterDistance);this.pitch&gt;50&amp;&amp;(farZ=1e3);var m=[];mat4.perspective(m,FOV,this.width/this.height,1,farZ),this.viewGL.camera.projectionMatrix.setArray(m),this.viewGL.camera.decomposeProjectionMatrix();m=mat4.identity([]);var pt=this.dataToPoint(this.center);mat4.scale(m,m,[1,-1,1]),mat4.translate(m,m,[0,0,-cameraToCenterDistance]),mat4.rotateX(m,m,pitch),mat4.rotateZ(m,m,-this.bearing/180*Math.PI),mat4.translate(m,m,[-pt[0]*this.getScale()*.1,-pt[1]*this.getScale()*.1,0]),this.viewGL.camera.viewMatrix.array=m;var invertM=[];mat4.invert(invertM,m),this.viewGL.camera.worldTransform.array=invertM,this.viewGL.camera.decomposeWorldTransform();var verticalScale,worldSize=512*this.getScale();if(this.altitudeExtent&amp;&amp;!isNaN(this.boxHeight)){var range=this.altitudeExtent[1]-this.altitudeExtent[0];verticalScale=this.boxHeight/range*this.getScale()/Math.pow(2,this._initialZoom-this.zoomOffset)}else verticalScale=worldSize/(2*Math.PI*6378e3*Math.abs(Math.cos(this.center[1]*(Math.PI/180))))*this.altitudeScale*.1;this.viewGL.rootNode.scale.set(.1*this.getScale(),.1*this.getScale(),verticalScale)}},getScale:function(){return Math.pow(2,this.zoom-this.zoomOffset)},projectOnTile:function(data,out){return this.projectOnTileWithScale(data,512*this.getScale(),out)},projectOnTileWithScale:function(data,scale,out){var lng=data[0],phi2=data[1]*PI/180,x=scale*(lng*PI/180+PI)/(2*PI),y=scale*(PI-Math.log(Math.tan(PI/4+.5*phi2)))/(2*PI);return(out=out||[])[0]=x,out[1]=y,out},unprojectFromTile:function(point,out){return this.unprojectOnTileWithScale(point,512*this.getScale(),out)},unprojectOnTileWithScale:function(point,scale,out){var x=point[0],y=point[1],lambda2=x/scale*(2*PI)-PI,phi2=2*(Math.atan(Math.exp(PI-y/scale*(2*PI)))-PI/4);return(out=out||[])[0]=180*lambda2/PI,out[1]=180*phi2/PI,out},dataToPoint:function(data,out){return(out=this.projectOnTileWithScale(data,512,out))[0]-=this._origin[0],out[1]-=this._origin[1],out[2]=isNaN(data[2])?0:data[2],isNaN(data[2])||(out[2]=data[2],this.altitudeExtent&amp;&amp;(out[2]-=this.altitudeExtent[0])),out}},Mapbox3D.prototype=new MapServiceCoordSys3D,Mapbox3D.prototype.constructor=Mapbox3D,Mapbox3D.prototype.type="mapbox3D";var mapbox3DCreator=createMapService3DCreator("mapbox3D",Mapbox3D,function(mapbox3DList){mapbox3DList.forEach(function(mapbox3D){mapbox3D.setCameraOption(mapbox3D.model.getMapboxCameraOption())})});use(function install$c(registers){registers.registerComponentModel(Mapbox3DModel),registers.registerComponentView(Mapbox3DView),registers.registerCoordinateSystem("mapbox3D",mapbox3DCreator),registers.registerAction({type:"mapbox3DChangeCamera",event:"mapbox3dcamerachanged",update:"mapbox3D:updateCamera"},function(payload,ecModel){ecModel.eachComponent({mainType:"mapbox3D",query:payload},function(componentModel){componentModel.setMapboxCameraOption(payload)})})});var MAPTALKS_CAMERA_OPTION=["zoom","center","pitch","bearing"],Maptalks3DModel=ComponentModel.extend({type:"maptalks3D",layoutMode:"box",coordinateSystem:null,defaultOption:{zlevel:-10,urlTemplate:"http://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}.png",attribution:'&amp;copy; &lt;a href="http://osm.org"&gt;OpenStreetMap&lt;/a&gt; contributors, &amp;copy; &lt;a href="https://carto.com/"&gt;CARTO&lt;/a&gt;',center:[0,0],zoom:0,pitch:0,bearing:0,light:{main:{alpha:20,beta:30}},altitudeScale:1,boxHeight:"auto"},getMaptalksCameraOption:function(){var self2=this;return MAPTALKS_CAMERA_OPTION.reduce(function(obj,key){return obj[key]=self2.get(key),obj},{})},setMaptalksCameraOption:function(option){null!=option&amp;&amp;MAPTALKS_CAMERA_OPTION.forEach(function(key){null!=option[key]&amp;&amp;(this.option[key]=option[key])},this)},getMaptalks:function(){return this._maptalks},setMaptalks:function(maptalks2){this._maptalks=maptalks2}});function Maptalks3DLayer(id,zr,defaultCenter,defaultZoom){if(this.id=id,this.zr=zr,this.dom=document.createElement("div"),this.dom.style.cssText="position:absolute;left:0;right:0;top:0;bottom:0;",!maptalks)throw new Error("Maptalks library must be included. See https://maptalks.org");this._maptalks=new maptalks.Map(this.dom,{center:defaultCenter,zoom:defaultZoom,doubleClickZoom:!1,fog:!1}),this._initEvents()}merge(Maptalks3DModel.prototype,componentPostEffectMixin),merge(Maptalks3DModel.prototype,componentLightMixin),Maptalks3DLayer.prototype.setUnpainted=function(){},Maptalks3DLayer.prototype.resize=function(){this._maptalks.checkSize()},Maptalks3DLayer.prototype.getMaptalks=function(){return this._maptalks},Maptalks3DLayer.prototype.clear=function(){},Maptalks3DLayer.prototype.refresh=function(){this._maptalks.checkSize()};var EVENTS=["mousedown","mouseup","click","dblclick","mousemove","mousewheel","DOMMouseScroll","touchstart","touchend","touchmove","touchcancel"];Maptalks3DLayer.prototype._initEvents=function(){var maptalksRoot=this.dom;this._handlers=this._handlers||{contextmenu:function(e2){return e2.preventDefault(),!1}},EVENTS.forEach(function(eName){this._handlers[eName]=function(e2){var obj={};for(var name in e2)obj[name]=e2[name];obj.bubbles=!1;var newE=new e2.constructor(e2.type,obj);"mousewheel"===eName||"DOMMouseScroll"===eName?maptalksRoot.dispatchEvent(newE):maptalksRoot.firstElementChild.dispatchEvent(newE)},this.zr.dom.addEventListener(eName,this._handlers[eName])},this),this.zr.dom.addEventListener("contextmenu",this._handlers.contextmenu)},Maptalks3DLayer.prototype.dispose=function(){EVENTS.forEach(function(eName){this.zr.dom.removeEventListener(eName,this._handlers[eName])},this),this._maptalks.remove()},graphicGL.Shader.import(displayShadowGLSL);const Maptalks3DView=ComponentView.extend({type:"maptalks3D",__ecgl__:!0,init:function(ecModel,api){this._groundMesh=new graphicGL.Mesh({geometry:new graphicGL.PlaneGeometry,material:new graphicGL.Material({shader:new graphicGL.Shader({vertex:graphicGL.Shader.source("ecgl.displayShadow.vertex"),fragment:graphicGL.Shader.source("ecgl.displayShadow.fragment")}),depthMask:!1}),renderOrder:-100,culling:!1,castShadow:!1,$ignorePicking:!0,renderNormal:!0})},_initMaptalksLayer:function(mapbox3DModel,api){var zr=api.getZr();this._zrLayer=new Maptalks3DLayer("maptalks3D",zr,mapbox3DModel.get("center"),mapbox3DModel.get("zoom")),zr.painter.insertLayer(-1e3,this._zrLayer),this._lightRoot=new graphicGL.Node,this._sceneHelper=new SceneHelper(this._lightRoot),this._sceneHelper.initLight(this._lightRoot);var maptalks2=this._zrLayer.getMaptalks(),dispatchInteractAction=this._dispatchInteractAction.bind(this,api,maptalks2);["zoomend","zooming","zoomstart","dragrotating","pitch","pitchend","movestart","moving","moveend","resize","touchstart","touchmove","touchend","animating"].forEach(function(eName){maptalks2.on(eName,dispatchInteractAction)})},render:function(maptalks3DModel,ecModel,api){this._zrLayer||this._initMaptalksLayer(maptalks3DModel,api);var mtks=this._zrLayer.getMaptalks(),urlTemplate=maptalks3DModel.get("urlTemplate"),baseLayer=mtks.getBaseLayer();urlTemplate!==this._oldUrlTemplate&amp;&amp;(baseLayer?baseLayer.setOptions({urlTemplate:urlTemplate,attribution:maptalks3DModel.get("attribution")}):(baseLayer=new maptalks.TileLayer("maptalks-echarts-gl-baselayer",{urlTemplate:urlTemplate,subdomains:["a","b","c"],attribution:maptalks3DModel.get("attribution")}),mtks.setBaseLayer(baseLayer))),this._oldUrlTemplate=urlTemplate,mtks.setCenter(maptalks3DModel.get("center")),mtks.setZoom(maptalks3DModel.get("zoom"),{animation:!1}),mtks.setPitch(maptalks3DModel.get("pitch")),mtks.setBearing(maptalks3DModel.get("bearing")),maptalks3DModel.setMaptalks(mtks);var coordSys=maptalks3DModel.coordinateSystem;coordSys.viewGL.scene.add(this._lightRoot),coordSys.viewGL.add(this._groundMesh),this._updateGroundMesh(),this._sceneHelper.setScene(coordSys.viewGL.scene),this._sceneHelper.updateLight(maptalks3DModel),coordSys.viewGL.setPostEffect(maptalks3DModel.getModel("postEffect"),api),coordSys.viewGL.setTemporalSuperSampling(maptalks3DModel.getModel("temporalSuperSampling")),this._maptalks3DModel=maptalks3DModel},afterRender:function(maptalks3DModel,ecModel,api,layerGL){var renderer=layerGL.renderer;this._sceneHelper.updateAmbientCubemap(renderer,maptalks3DModel,api),this._sceneHelper.updateSkybox(renderer,maptalks3DModel,api),maptalks3DModel.coordinateSystem.viewGL.scene.traverse(function(mesh){mesh.material&amp;&amp;(mesh.material.define("fragment","NORMAL_UP_AXIS",2),mesh.material.define("fragment","NORMAL_FRONT_AXIS",1))})},updateCamera:function(maptalks3DModel,ecModel,api,payload){maptalks3DModel.coordinateSystem.setCameraOption(payload),this._updateGroundMesh(),api.getZr().refresh()},_dispatchInteractAction:function(api,maptalks2,maptalks3DModel){var res;api.dispatchAction({type:"maptalks3DChangeCamera",pitch:maptalks2.getPitch(),zoom:(res=maptalks2.getResolution(),19-Math.log(res/MAX_RES)/Math.LN2+1),center:maptalks2.getCenter().toArray(),bearing:maptalks2.getBearing(),maptalks3DId:this._maptalks3DModel&amp;&amp;this._maptalks3DModel.id})},_updateGroundMesh:function(){if(this._maptalks3DModel){var coordSys=this._maptalks3DModel.coordinateSystem,pt=coordSys.dataToPoint(coordSys.center);this._groundMesh.position.set(pt[0],pt[1],-.001);var plane=new graphicGL.Plane(new graphicGL.Vector3(0,0,1),0),ray1=coordSys.viewGL.camera.castRay(new graphicGL.Vector2(-1,-1)),ray2=coordSys.viewGL.camera.castRay(new graphicGL.Vector2(1,1)),pos0=ray1.intersectPlane(plane),pos1=ray2.intersectPlane(plane),scale=pos0.dist(pos1)/coordSys.viewGL.rootNode.scale.x;this._groundMesh.scale.set(scale,scale,1)}},dispose:function(ecModel,api){this._zrLayer&amp;&amp;this._zrLayer.dispose(),api.getZr().painter.delLayer(-1e3)}}),MAX_RES=12756274*Math.PI/(256*Math.pow(2,20));function Maptalks3D(){MapServiceCoordSys3D.apply(this,arguments),this.maxPitch=85,this.zoomOffset=1}Maptalks3D.prototype=new MapServiceCoordSys3D,Maptalks3D.prototype.constructor=Maptalks3D,Maptalks3D.prototype.type="maptalks3D";var maptalks3DCreator=createMapService3DCreator("maptalks3D",Maptalks3D,function(maptalks3DList){maptalks3DList.forEach(function(maptalks3D){maptalks3D.setCameraOption(maptalks3D.model.getMaptalksCameraOption())})});use(function install$b(registers){registers.registerComponentModel(Maptalks3DModel),registers.registerComponentView(Maptalks3DView),registers.registerCoordinateSystem("maptalks3D",maptalks3DCreator),registers.registerAction({type:"maptalks3DChangeCamera",event:"maptalks3dcamerachanged",update:"maptalks3D:updateCamera"},function(payload,ecModel){ecModel.eachComponent({mainType:"maptalks3D",query:payload},function(componentModel){componentModel.setMaptalksCameraOption(payload)})})});var vec3$8=glmatrix.vec3,isDimensionStacked$1=dataStack.isDimensionStacked;function evaluateBarSparseness(data,dimX,dimY){for(var xExtent=data.getDataExtent(dimX),yExtent=data.getDataExtent(dimY),xSpan=xExtent[1]-xExtent[0]||xExtent[0],ySpan=yExtent[1]-yExtent[0]||yExtent[0],tmp=new Uint8Array(2500),i=0;i&lt;data.count();i++){var x=data.get(dimX,i),y=data.get(dimY,i),xIdx=Math.floor((x-xExtent[0])/xSpan*49),idx=50*Math.floor((y-yExtent[0])/ySpan*49)+xIdx;tmp[idx]=tmp[idx]||1}var filledCount=0;for(i=0;i&lt;tmp.length;i++)tmp[i]&amp;&amp;filledCount++;return filledCount/tmp.length}var vec3$7=glmatrix.vec3,isDimensionStacked=dataStack.isDimensionStacked;function getValueDimension(data,dataDims){var isStacked=isDimensionStacked(data,dataDims[2]);return{dimension:isStacked?data.getCalculationInfo("stackResultDimension"):dataDims[2],isStacked:isStacked}}function registerBarLayout(registers){registers.registerLayout(function(ecModel,api){ecModel.eachSeriesByType("bar3D",function(seriesModel){var coordSys=seriesModel.coordinateSystem,coordSysType=coordSys&amp;&amp;coordSys.type;"globe"===coordSysType?function globeLayout(seriesModel,coordSys){var data=seriesModel.getData(),barMinHeight=seriesModel.get("minHeight")||0,barSize=seriesModel.get("barSize"),dims=["lng","lat","alt"].map(function(coordDimName){return seriesModel.coordDimToDataDim(coordDimName)[0]});if(null==barSize){var perimeter=coordSys.radius*Math.PI,fillRatio=evaluateBarSparseness(data,dims[0],dims[1]);barSize=[perimeter/Math.sqrt(data.count()/fillRatio),perimeter/Math.sqrt(data.count()/fillRatio)]}else isArray(barSize)||(barSize=[barSize,barSize]);var valueDim=getValueDimension(data,dims);data.each(dims,function(lng,lat,val,idx){var stackedValue=data.get(valueDim.dimension,idx),baseValue=valueDim.isStacked?stackedValue-val:coordSys.altitudeAxis.scale.getExtent()[0],height=Math.max(coordSys.altitudeAxis.dataToCoord(val),barMinHeight),start=coordSys.dataToPoint([lng,lat,baseValue]),end=coordSys.dataToPoint([lng,lat,stackedValue]),dir=vec3$7.sub([],end,start);vec3$7.normalize(dir,dir);var size=[barSize[0],height,barSize[1]];data.setItemLayout(idx,[start,dir,size])}),data.setLayout("orient",Vector3.UP.array)}(seriesModel,coordSys):"cartesian3D"===coordSysType?function cartesian3DLayout(seriesModel,coordSys){var data=seriesModel.getData(),barSize=seriesModel.get("barSize");if(null==barSize){var barWidth,barDepth,size=coordSys.size,xAxis=coordSys.getAxis("x"),yAxis=coordSys.getAxis("y");barWidth="category"===xAxis.type?.7*xAxis.getBandWidth():.6*Math.round(size[0]/Math.sqrt(data.count())),barDepth="category"===yAxis.type?.7*yAxis.getBandWidth():.6*Math.round(size[1]/Math.sqrt(data.count())),barSize=[barWidth,barDepth]}else isArray(barSize)||(barSize=[barSize,barSize]);var zAxisExtent=coordSys.getAxis("z").scale.getExtent(),ifZAxisCrossZero=function ifCrossZero(extent){var min=extent[0],max=extent[1];return!(min&gt;0&amp;&amp;max&gt;0||min&lt;0&amp;&amp;max&lt;0)}(zAxisExtent),dims=["x","y","z"].map(function(coordDimName){return seriesModel.coordDimToDataDim(coordDimName)[0]}),isStacked=isDimensionStacked$1(data,dims[2]),valueDim=isStacked?data.getCalculationInfo("stackResultDimension"):dims[2];data.each(dims,function(x,y,z,idx){var stackedValue=data.get(valueDim,idx),baseValue=isStacked?stackedValue-z:ifZAxisCrossZero?0:zAxisExtent[0],start=coordSys.dataToPoint([x,y,baseValue]),end=coordSys.dataToPoint([x,y,stackedValue]),height=vec3$8.dist(start,end),dir=[0,end[1]&lt;start[1]?-1:1,0];0===Math.abs(height)&amp;&amp;(height=.1);var size2=[barSize[0],height,barSize[1]];data.setItemLayout(idx,[start,dir,size2])}),data.setLayout("orient",[1,0,0])}(seriesModel,coordSys):"geo3D"===coordSysType?function geo3DLayout(seriesModel,coordSys){var data=seriesModel.getData(),barSize=seriesModel.get("barSize"),barMinHeight=seriesModel.get("minHeight")||0,dims=["lng","lat","alt"].map(function(coordDimName){return seriesModel.coordDimToDataDim(coordDimName)[0]});if(null==barSize){var size=Math.min(coordSys.size[0],coordSys.size[2]),fillRatio=evaluateBarSparseness(data,dims[0],dims[1]);barSize=[size/Math.sqrt(data.count()/fillRatio),size/Math.sqrt(data.count()/fillRatio)]}else isArray(barSize)||(barSize=[barSize,barSize]);var dir=[0,1,0],valueDim=getValueDimension(data,dims);data.each(dims,function(lng,lat,val,idx){var stackedValue=data.get(valueDim.dimension,idx),baseValue=valueDim.isStacked?stackedValue-val:coordSys.altitudeAxis.scale.getExtent()[0],height=Math.max(coordSys.altitudeAxis.dataToCoord(val),barMinHeight),start=coordSys.dataToPoint([lng,lat,baseValue]),size2=[barSize[0],height,barSize[1]];data.setItemLayout(idx,[start,dir,size2])}),data.setLayout("orient",[1,0,0])}(seriesModel,coordSys):"mapbox3D"!==coordSysType&amp;&amp;"maptalks3D"!==coordSysType||function mapService3DLayout(seriesModel,coordSys){var data=seriesModel.getData(),dimLng=seriesModel.coordDimToDataDim("lng")[0],dimLat=seriesModel.coordDimToDataDim("lat")[0],dimAlt=seriesModel.coordDimToDataDim("alt")[0],barSize=seriesModel.get("barSize"),barMinHeight=seriesModel.get("minHeight")||0;if(null==barSize){var xExtent=data.getDataExtent(dimLng),yExtent=data.getDataExtent(dimLat),corner0=coordSys.dataToPoint([xExtent[0],yExtent[0]]),corner1=coordSys.dataToPoint([xExtent[1],yExtent[1]]),size=Math.min(Math.abs(corner0[0]-corner1[0]),Math.abs(corner0[1]-corner1[1]))||1,fillRatio=evaluateBarSparseness(data,dimLng,dimLat);barSize=[size/Math.sqrt(data.count()/fillRatio),size/Math.sqrt(data.count()/fillRatio)]}else isArray(barSize)||(barSize=[barSize,barSize]),barSize[0]/=coordSys.getScale()/16,barSize[1]/=coordSys.getScale()/16;var dir=[0,0,1],dims=[dimLng,dimLat,dimAlt],valueDim=getValueDimension(data,dims);data.each(dims,function(lng,lat,val,idx){var stackedValue=data.get(valueDim.dimension,idx),baseValue=valueDim.isStacked?stackedValue-val:0,start=coordSys.dataToPoint([lng,lat,baseValue]),end=coordSys.dataToPoint([lng,lat,stackedValue]),height=Math.max(end[2]-start[2],barMinHeight),size2=[barSize[0],height,barSize[1]];data.setItemLayout(idx,[start,dir,size2])}),data.setLayout("orient",[1,0,0])}(seriesModel,coordSys)})})}var formatUtil={};function formatTooltip(seriesModel,dataIndex,multipleSeries){var data=seriesModel.getData(),value=seriesModel.getRawValue(dataIndex),formattedValue=isArray(value)?function formatArrayValue(value2){var result=[],tooltipDims=function otherDimToDataDim(data,otherDim2){var dataDim=[];return each(data.dimensions,function(dimName){var dimItem=data.getDimensionInfo(dimName),dimIndex=dimItem.otherDims[otherDim2];null!=dimIndex&amp;&amp;!1!==dimIndex&amp;&amp;(dataDim[dimIndex]=dimItem.name)}),dataDim}(data,"tooltip");function setEachItem(val,dimIdx){var dimInfo=data.getDimensionInfo(dimIdx);if(dimInfo&amp;&amp;!1!==dimInfo.otherDims.tooltip){var dimType=dimInfo.type,valStr="- "+(dimInfo.tooltipName||dimInfo.name)+": "+("ordinal"===dimType?val+"":"time"===dimType?formatTime("yyyy/MM/dd hh:mm:ss",val):addCommas(val));valStr&amp;&amp;result.push(encodeHTML(valStr))}}return tooltipDims.length?each(tooltipDims,function(dimIdx){setEachItem(data.get(dimIdx,dataIndex),dimIdx)}):each(value2,setEachItem),"&lt;br/&gt;"+result.join("&lt;br/&gt;")}(value):encodeHTML(addCommas(value)),name=data.getName(dataIndex),color=getItemVisualColor(data,dataIndex);isObject(color)&amp;&amp;color.colorStops&amp;&amp;(color=(color.colorStops[0]||{}).color);var colorEl=getTooltipMarker(color=color||"transparent"),seriesName=seriesModel.name;return"\0-"===seriesName&amp;&amp;(seriesName=""),(seriesName=seriesName?encodeHTML(seriesName)+"&lt;br/&gt;":"")+colorEl+(name?encodeHTML(name)+": "+formattedValue:formattedValue)}function createList(seriesModel,dims,source){source=source||seriesModel.getSource();var coordSysDimensions=dims||getCoordinateSystemDimensions(seriesModel.get("coordinateSystem"))||["x","y","z"],dimensions=createDimensions(source,{dimensionsDefine:source.dimensionsDefine||seriesModel.get("dimensions"),encodeDefine:source.encodeDefine||seriesModel.get("encode"),coordDimensions:coordSysDimensions.map(function(dim){var axis3DModel=seriesModel.getReferringComponents(dim+"Axis3D").models[0];return{type:axis3DModel&amp;&amp;"category"===axis3DModel.get("type")?"ordinal":"float",name:dim}})});"cartesian3D"===seriesModel.get("coordinateSystem")&amp;&amp;dimensions.forEach(function(dimInfo){if(coordSysDimensions.indexOf(dimInfo.coordDim)&gt;=0){var axis3DModel=seriesModel.getReferringComponents(dimInfo.coordDim+"Axis3D").models[0];axis3DModel&amp;&amp;"category"===axis3DModel.get("type")&amp;&amp;(dimInfo.ordinalMeta=axis3DModel.getOrdinalMeta())}});var stackCalculationInfo=dataStack.enableDataStack(seriesModel,dimensions,{byIndex:!0,stackedCoordDimension:"z"}),data=new SeriesData(dimensions,seriesModel);return data.setCalculationInfo(stackCalculationInfo),data.initData(source),data}formatUtil.getFormattedLabel=function(seriesModel,dataIndex,status,dataType,dimIndex){status=status||"normal";var itemModel=seriesModel.getData(dataType).getItemModel(dataIndex),params=seriesModel.getDataParams(dataIndex,dataType);null!=dimIndex&amp;&amp;params.value instanceof Array&amp;&amp;(params.value=params.value[dimIndex]);var text,formatter=itemModel.get("normal"===status?["label","formatter"]:["emphasis","label","formatter"]);return null==formatter&amp;&amp;(formatter=itemModel.get(["label","formatter"])),"function"==typeof formatter?(params.status=status,text=formatter(params)):"string"==typeof formatter&amp;&amp;(text=formatTpl(formatter,params)),text},formatUtil.normalizeToArray=function(value){return value instanceof Array?value:null==value?[]:[value]};var Bar3DSeries=SeriesModel.extend({type:"series.bar3D",dependencies:["globe"],visualStyleAccessPathvisu:"itemStyle",getInitialData:function(option,ecModel){return createList(this)},getFormattedLabel:function(dataIndex,status,dataType,dimIndex){var text=formatUtil.getFormattedLabel(this,dataIndex,status,dataType,dimIndex);return null==text&amp;&amp;(text=this.getData().get("z",dataIndex)),text},formatTooltip:function(dataIndex){return formatTooltip(this,dataIndex)},defaultOption:{coordinateSystem:"cartesian3D",globeIndex:0,grid3DIndex:0,zlevel:-10,bevelSize:0,bevelSmoothness:2,onGridPlane:"xy",shading:"color",minHeight:0,itemStyle:{opacity:1},label:{show:!1,distance:2,textStyle:{fontSize:14,color:"#000",backgroundColor:"rgba(255,255,255,0.7)",padding:3,borderRadius:3}},emphasis:{label:{show:!0}},animationDurationUpdate:500}});merge(Bar3DSeries.prototype,componentShadingMixin);var px,py,pz,rotateMat,bevelStartSize,xOffsets,zOffsets,yOffsets,vec3$6=glmatrix.vec3,mat3=glmatrix.mat3,BarsGeometry=Geometry.extend(function(){return{attributes:{position:new Geometry.Attribute("position","float",3,"POSITION"),normal:new Geometry.Attribute("normal","float",3,"NORMAL"),color:new Geometry.Attribute("color","float",4,"COLOR"),prevPosition:new Geometry.Attribute("prevPosition","float",3),prevNormal:new Geometry.Attribute("prevNormal","float",3)},dynamic:!0,enableNormal:!1,bevelSize:1,bevelSegments:0,_dataIndices:null,_vertexOffset:0,_triangleOffset:0}},{resetOffset:function(){this._vertexOffset=0,this._triangleOffset=0},setBarCount:function(barCount){var enableNormal=this.enableNormal,vertexCount=this.getBarVertexCount()*barCount,triangleCount=this.getBarTriangleCount()*barCount;this.vertexCount!==vertexCount&amp;&amp;(this.attributes.position.init(vertexCount),enableNormal?this.attributes.normal.init(vertexCount):this.attributes.normal.value=null,this.attributes.color.init(vertexCount)),this.triangleCount!==triangleCount&amp;&amp;(this.indices=vertexCount&gt;65535?new Uint32Array(3*triangleCount):new Uint16Array(3*triangleCount),this._dataIndices=new Uint32Array(vertexCount))},getBarVertexCount:function(){var bevelSegments=this.bevelSize&gt;0?this.bevelSegments:0;return bevelSegments&gt;0?this._getBevelBarVertexCount(bevelSegments):this.enableNormal?24:8},getBarTriangleCount:function(){var bevelSegments=this.bevelSize&gt;0?this.bevelSegments:0;return bevelSegments&gt;0?this._getBevelBarTriangleCount(bevelSegments):12},_getBevelBarVertexCount:function(bevelSegments){return 4*(bevelSegments+1)*(bevelSegments+1)*2},_getBevelBarTriangleCount:function(bevelSegments){return(4*bevelSegments+3+1)*(2*bevelSegments+1)*2+4},setColor:function(idx,color){for(var vertexCount=this.getBarVertexCount(),end=vertexCount*(idx+1),i=vertexCount*idx;i&lt;end;i++)this.attributes.color.set(i,color);this.dirtyAttribute("color")},getDataIndexOfVertex:function(vertexIndex){return this._dataIndices?this._dataIndices[vertexIndex]:null},addBar:function(){for(var v3Create=vec3$6.create,v3ScaleAndAdd=vec3$6.scaleAndAdd,end=v3Create(),px=v3Create(),py=v3Create(),pz=v3Create(),nx=v3Create(),ny=v3Create(),nz=v3Create(),pts=[],normals=[],i=0;i&lt;8;i++)pts[i]=v3Create();var cubeFaces4=[[0,1,5,4],[2,3,7,6],[4,5,6,7],[3,2,1,0],[0,4,7,3],[1,2,6,5]],face4To3=[0,1,2,0,2,3],cubeFaces3=[];for(i=0;i&lt;cubeFaces4.length;i++)for(var face4=cubeFaces4[i],j=0;j&lt;2;j++){for(var face=[],k=0;k&lt;3;k++)face.push(face4[face4To3[3*j+k]]);cubeFaces3.push(face)}return function(start,dir,leftDir,size,color,dataIndex){var startVertex=this._vertexOffset;if(this.bevelSize&gt;0&amp;&amp;this.bevelSegments&gt;0)this._addBevelBar(start,dir,leftDir,size,this.bevelSize,this.bevelSegments,color);else{vec3$6.copy(py,dir),vec3$6.normalize(py,py),vec3$6.cross(pz,leftDir,py),vec3$6.normalize(pz,pz),vec3$6.cross(px,py,pz),vec3$6.normalize(pz,pz),vec3$6.negate(nx,px),vec3$6.negate(ny,py),vec3$6.negate(nz,pz),v3ScaleAndAdd(pts[0],start,px,size[0]/2),v3ScaleAndAdd(pts[0],pts[0],pz,size[2]/2),v3ScaleAndAdd(pts[1],start,px,size[0]/2),v3ScaleAndAdd(pts[1],pts[1],nz,size[2]/2),v3ScaleAndAdd(pts[2],start,nx,size[0]/2),v3ScaleAndAdd(pts[2],pts[2],nz,size[2]/2),v3ScaleAndAdd(pts[3],start,nx,size[0]/2),v3ScaleAndAdd(pts[3],pts[3],pz,size[2]/2),v3ScaleAndAdd(end,start,py,size[1]),v3ScaleAndAdd(pts[4],end,px,size[0]/2),v3ScaleAndAdd(pts[4],pts[4],pz,size[2]/2),v3ScaleAndAdd(pts[5],end,px,size[0]/2),v3ScaleAndAdd(pts[5],pts[5],nz,size[2]/2),v3ScaleAndAdd(pts[6],end,nx,size[0]/2),v3ScaleAndAdd(pts[6],pts[6],nz,size[2]/2),v3ScaleAndAdd(pts[7],end,nx,size[0]/2),v3ScaleAndAdd(pts[7],pts[7],pz,size[2]/2);var attributes=this.attributes;if(this.enableNormal){normals[0]=px,normals[1]=nx,normals[2]=py,normals[3]=ny,normals[4]=pz,normals[5]=nz;for(var vertexOffset=this._vertexOffset,i2=0;i2&lt;cubeFaces4.length;i2++){for(var idx3=3*this._triangleOffset,k2=0;k2&lt;6;k2++)this.indices[idx3++]=vertexOffset+face4To3[k2];vertexOffset+=4,this._triangleOffset+=2}for(i2=0;i2&lt;cubeFaces4.length;i2++){var normal2=normals[i2];for(k2=0;k2&lt;4;k2++){var idx=cubeFaces4[i2][k2];attributes.position.set(this._vertexOffset,pts[idx]),attributes.normal.set(this._vertexOffset,normal2),attributes.color.set(this._vertexOffset++,color)}}}else{for(i2=0;i2&lt;cubeFaces3.length;i2++){for(idx3=3*this._triangleOffset,k2=0;k2&lt;3;k2++)this.indices[idx3+k2]=cubeFaces3[i2][k2]+this._vertexOffset;this._triangleOffset++}for(i2=0;i2&lt;pts.length;i2++)attributes.position.set(this._vertexOffset,pts[i2]),attributes.color.set(this._vertexOffset++,color)}}var endVerex=this._vertexOffset;for(i2=startVertex;i2&lt;endVerex;i2++)this._dataIndices[i2]=dataIndex}}(),_addBevelBar:(px=vec3$6.create(),py=vec3$6.create(),pz=vec3$6.create(),rotateMat=mat3.create(),bevelStartSize=[],xOffsets=[1,-1,-1,1],zOffsets=[1,1,-1,-1],yOffsets=[2,0],function(start,dir,leftDir,size,bevelSize,bevelSegments,color){vec3$6.copy(py,dir),vec3$6.normalize(py,py),vec3$6.cross(pz,leftDir,py),vec3$6.normalize(pz,pz),vec3$6.cross(px,py,pz),vec3$6.normalize(pz,pz),rotateMat[0]=px[0],rotateMat[1]=px[1],rotateMat[2]=px[2],rotateMat[3]=py[0],rotateMat[4]=py[1],rotateMat[5]=py[2],rotateMat[6]=pz[0],rotateMat[7]=pz[1],rotateMat[8]=pz[2],bevelSize=Math.min(size[0],size[2])/2*bevelSize;for(var i=0;i&lt;3;i++)bevelStartSize[i]=Math.max(size[i]-2*bevelSize,0);var rx=(size[0]-bevelStartSize[0])/2,ry=(size[1]-bevelStartSize[1])/2,rz=(size[2]-bevelStartSize[2])/2,pos=[],normal2=[],vertexOffset=this._vertexOffset,endIndices=[];for(i=0;i&lt;2;i++){endIndices[i]=endIndices[i]=[];for(var m=0;m&lt;=bevelSegments;m++)for(var j=0;j&lt;4;j++){(0===m&amp;&amp;0===i||1===i&amp;&amp;m===bevelSegments)&amp;&amp;endIndices[i].push(vertexOffset);for(var n=0;n&lt;=bevelSegments;n++){var phi=n/bevelSegments*Math.PI/2+Math.PI/2*j,theta=m/bevelSegments*Math.PI/2+Math.PI/2*i;normal2[0]=rx*Math.cos(phi)*Math.sin(theta),normal2[1]=ry*Math.cos(theta),normal2[2]=rz*Math.sin(phi)*Math.sin(theta),pos[0]=normal2[0]+xOffsets[j]*bevelStartSize[0]/2,pos[1]=normal2[1]+ry+yOffsets[i]*bevelStartSize[1]/2,pos[2]=normal2[2]+zOffsets[j]*bevelStartSize[2]/2,Math.abs(rx-ry)&lt;1e-6&amp;&amp;Math.abs(ry-rz)&lt;1e-6||(normal2[0]/=rx*rx,normal2[1]/=ry*ry,normal2[2]/=rz*rz),vec3$6.normalize(normal2,normal2),vec3$6.transformMat3(pos,pos,rotateMat),vec3$6.transformMat3(normal2,normal2,rotateMat),vec3$6.add(pos,pos,start),this.attributes.position.set(vertexOffset,pos),this.enableNormal&amp;&amp;this.attributes.normal.set(vertexOffset,normal2),this.attributes.color.set(vertexOffset,color),vertexOffset++}}}var widthSegments=4*bevelSegments+3,heightSegments=2*bevelSegments+1,len=widthSegments+1;for(j=0;j&lt;heightSegments;j++)for(i=0;i&lt;=widthSegments;i++){var i2=j*len+i+this._vertexOffset,i1=j*len+(i+1)%len+this._vertexOffset,i4=(j+1)*len+(i+1)%len+this._vertexOffset,i3=(j+1)*len+i+this._vertexOffset;this.setTriangleIndices(this._triangleOffset++,[i4,i2,i1]),this.setTriangleIndices(this._triangleOffset++,[i4,i3,i2])}this.setTriangleIndices(this._triangleOffset++,[endIndices[0][0],endIndices[0][2],endIndices[0][1]]),this.setTriangleIndices(this._triangleOffset++,[endIndices[0][0],endIndices[0][3],endIndices[0][2]]),this.setTriangleIndices(this._triangleOffset++,[endIndices[1][0],endIndices[1][1],endIndices[1][2]]),this.setTriangleIndices(this._triangleOffset++,[endIndices[1][0],endIndices[1][2],endIndices[1][3]]),this._vertexOffset=vertexOffset})});defaults(BarsGeometry.prototype,dynamicConvertMixin),defaults(BarsGeometry.prototype,trianglesSortMixin);var vec3$5=glmatrix.vec3;const Bar3DView=ChartView.extend({type:"bar3D",__ecgl__:!0,init:function(ecModel,api){this.groupGL=new graphicGL.Node,this._api=api,this._labelsBuilder=new LabelsBuilder(256,256,api);var self2=this;this._labelsBuilder.getLabelPosition=function(dataIndex,position,distance){if(self2._data){var layout=self2._data.getItemLayout(dataIndex),start=layout[0],dir=layout[1],height=layout[2][1];return vec3$5.scaleAndAdd([],start,dir,distance+height)}return[0,0]},this._labelsBuilder.getMesh().renderOrder=100},render:function(seriesModel,ecModel,api){var tmp=this._prevBarMesh;this._prevBarMesh=this._barMesh,this._barMesh=tmp,this._barMesh||(this._barMesh=new graphicGL.Mesh({geometry:new BarsGeometry,shadowDepthMaterial:new graphicGL.Material({shader:new graphicGL.Shader(graphicGL.Shader.source("ecgl.sm.depth.vertex"),graphicGL.Shader.source("ecgl.sm.depth.fragment"))}),culling:"cartesian3D"===seriesModel.coordinateSystem.type,renderOrder:10,renderNormal:!0})),this.groupGL.remove(this._prevBarMesh),this.groupGL.add(this._barMesh),this.groupGL.add(this._labelsBuilder.getMesh());var coordSys=seriesModel.coordinateSystem;if(this._doRender(seriesModel,api),coordSys&amp;&amp;coordSys.viewGL){coordSys.viewGL.add(this.groupGL);var methodName=coordSys.viewGL.isLinearSpace()?"define":"undefine";this._barMesh.material[methodName]("fragment","SRGB_DECODE")}this._data=seriesModel.getData(),this._labelsBuilder.updateData(this._data),this._labelsBuilder.updateLabels(),this._updateAnimation(seriesModel)},_updateAnimation:function(seriesModel){graphicGL.updateVertexAnimation([["prevPosition","position"],["prevNormal","normal"]],this._prevBarMesh,this._barMesh,seriesModel)},_doRender:function(seriesModel,api){var data=seriesModel.getData(),shading=seriesModel.get("shading"),enableNormal="color"!==shading,self2=this,barMesh=this._barMesh,shadingPrefix="ecgl."+shading;barMesh.material&amp;&amp;barMesh.material.shader.name===shadingPrefix||(barMesh.material=graphicGL.createMaterial(shadingPrefix,["VERTEX_COLOR"])),graphicGL.setMaterialFromModel(shading,barMesh.material,seriesModel,api),barMesh.geometry.enableNormal=enableNormal,barMesh.geometry.resetOffset();var bevelSize=seriesModel.get("bevelSize"),bevelSegments=seriesModel.get("bevelSmoothness");barMesh.geometry.bevelSegments=bevelSegments,barMesh.geometry.bevelSize=bevelSize;var colorArr=[],vertexColors=new Float32Array(4*data.count()),colorOffset=0,barCount=0,hasTransparent=!1;data.each(function(idx){if(data.hasValue(idx)){var color=getItemVisualColor(data,idx),opacity=getItemVisualOpacity(data,idx);null==opacity&amp;&amp;(opacity=1),graphicGL.parseColor(color,colorArr),colorArr[3]*=opacity,vertexColors[colorOffset++]=colorArr[0],vertexColors[colorOffset++]=colorArr[1],vertexColors[colorOffset++]=colorArr[2],vertexColors[colorOffset++]=colorArr[3],colorArr[3]&gt;0&amp;&amp;(barCount++,colorArr[3]&lt;.99&amp;&amp;(hasTransparent=!0))}}),barMesh.geometry.setBarCount(barCount);var orient=data.getLayout("orient"),barIndexOfData=this._barIndexOfData=new Int32Array(data.count());barCount=0;data.each(function(idx){if(data.hasValue(idx)){var layout=data.getItemLayout(idx),start=layout[0],dir=layout[1],size=layout[2],idx4=4*idx;colorArr[0]=vertexColors[idx4++],colorArr[1]=vertexColors[idx4++],colorArr[2]=vertexColors[idx4++],colorArr[3]=vertexColors[idx4++],colorArr[3]&gt;0&amp;&amp;(self2._barMesh.geometry.addBar(start,dir,orient,size,colorArr,idx),barIndexOfData[idx]=barCount++)}else barIndexOfData[idx]=-1}),barMesh.geometry.dirty(),barMesh.geometry.updateBoundingBox();var material=barMesh.material;material.transparent=hasTransparent,material.depthMask=!hasTransparent,barMesh.geometry.sortTriangles=hasTransparent,this._initHandler(seriesModel,api)},_initHandler:function(seriesModel,api){var data=seriesModel.getData(),barMesh=this._barMesh,isCartesian3D="cartesian3D"===seriesModel.coordinateSystem.type;barMesh.seriesIndex=seriesModel.seriesIndex;var lastDataIndex=-1;barMesh.off("mousemove"),barMesh.off("mouseout"),barMesh.on("mousemove",function(e2){var dataIndex=barMesh.geometry.getDataIndexOfVertex(e2.triangle[0]);dataIndex!==lastDataIndex&amp;&amp;(this._downplay(lastDataIndex),this._highlight(dataIndex),this._labelsBuilder.updateLabels([dataIndex]),isCartesian3D&amp;&amp;api.dispatchAction({type:"grid3DShowAxisPointer",value:[data.get("x",dataIndex),data.get("y",dataIndex),data.get("z",dataIndex,!0)]})),lastDataIndex=dataIndex,barMesh.dataIndex=dataIndex},this),barMesh.on("mouseout",function(e2){this._downplay(lastDataIndex),this._labelsBuilder.updateLabels(),lastDataIndex=-1,barMesh.dataIndex=-1,isCartesian3D&amp;&amp;api.dispatchAction({type:"grid3DHideAxisPointer"})},this)},_highlight:function(dataIndex){var data=this._data;if(data){var barIndex=this._barIndexOfData[dataIndex];if(!(barIndex&lt;0)){var emphasisItemStyleModel=data.getItemModel(dataIndex).getModel("emphasis.itemStyle"),emphasisColor=emphasisItemStyleModel.get("color"),emphasisOpacity=emphasisItemStyleModel.get("opacity");if(null==emphasisColor){var color=getItemVisualColor(data,dataIndex);emphasisColor=lift(color,-.4)}null==emphasisOpacity&amp;&amp;(emphasisOpacity=getItemVisualOpacity(data,dataIndex));var colorArr=graphicGL.parseColor(emphasisColor);colorArr[3]*=emphasisOpacity,this._barMesh.geometry.setColor(barIndex,colorArr),this._api.getZr().refresh()}}},_downplay:function(dataIndex){var data=this._data;if(data){var barIndex=this._barIndexOfData[dataIndex];if(!(barIndex&lt;0)){var color=getItemVisualColor(data,dataIndex),opacity=getItemVisualOpacity(data,dataIndex),colorArr=graphicGL.parseColor(color);colorArr[3]*=opacity,this._barMesh.geometry.setColor(barIndex,colorArr),this._api.getZr().refresh()}}},highlight:function(seriesModel,ecModel,api,payload){this._toggleStatus("highlight",seriesModel,ecModel,api,payload)},downplay:function(seriesModel,ecModel,api,payload){this._toggleStatus("downplay",seriesModel,ecModel,api,payload)},_toggleStatus:function(status,seriesModel,ecModel,api,payload){var data=seriesModel.getData(),dataIndex=retrieve_queryDataIndex(data,payload),self2=this;null!=dataIndex?each(formatUtil.normalizeToArray(dataIndex),function(dataIdx){"highlight"===status?this._highlight(dataIdx):this._downplay(dataIdx)},this):data.each(function(dataIdx){"highlight"===status?self2._highlight(dataIdx):self2._downplay(dataIdx)})},remove:function(){this.groupGL.removeAll()},dispose:function(){this._labelsBuilder.dispose(),this.groupGL.removeAll()}});use(function install$a(registers){registers.registerChartView(Bar3DView),registers.registerSeriesModel(Bar3DSeries),registerBarLayout(registers),registers.registerProcessor(function(ecModel,api){ecModel.eachSeriesByType("bar3d",function(seriesModel){var data=seriesModel.getData();data.filterSelf(function(idx){return data.hasValue(idx)})})})});var Line3DSeries=SeriesModel.extend({type:"series.line3D",dependencies:["grid3D"],visualStyleAccessPath:"lineStyle",visualDrawType:"stroke",getInitialData:function(option,ecModel){return createList(this)},formatTooltip:function(dataIndex){return formatTooltip(this,dataIndex)},defaultOption:{coordinateSystem:"cartesian3D",zlevel:-10,grid3DIndex:0,lineStyle:{width:2},animationDurationUpdate:500}}),vec3$4=glmatrix.vec3;graphicGL.Shader.import(lines3DGLSL);const Line3DView=ChartView.extend({type:"line3D",__ecgl__:!0,init:function(ecModel,api){this.groupGL=new graphicGL.Node,this._api=api},render:function(seriesModel,ecModel,api){var tmp=this._prevLine3DMesh;this._prevLine3DMesh=this._line3DMesh,this._line3DMesh=tmp,this._line3DMesh||(this._line3DMesh=new graphicGL.Mesh({geometry:new LinesGeometry$2({useNativeLine:!1,sortTriangles:!0}),material:new graphicGL.Material({shader:graphicGL.createShader("ecgl.meshLines3D")}),renderOrder:10}),this._line3DMesh.geometry.pick=this._pick.bind(this)),this.groupGL.remove(this._prevLine3DMesh),this.groupGL.add(this._line3DMesh);var coordSys=seriesModel.coordinateSystem;if(coordSys&amp;&amp;coordSys.viewGL){coordSys.viewGL.add(this.groupGL);var methodName=coordSys.viewGL.isLinearSpace()?"define":"undefine";this._line3DMesh.material[methodName]("fragment","SRGB_DECODE")}this._doRender(seriesModel,api),this._data=seriesModel.getData(),this._camera=coordSys.viewGL.camera,this.updateCamera(),this._updateAnimation(seriesModel)},updateCamera:function(){this._updateNDCPosition()},_doRender:function(seriesModel,api){var data=seriesModel.getData(),lineMesh=this._line3DMesh;lineMesh.geometry.resetOffset();var points=data.getLayout("points"),colorArr=[],vertexColors=new Float32Array(points.length/3*4),colorOffset=0,hasTransparent=!1;data.each(function(idx){var color=getItemVisualColor(data,idx),opacity=getItemVisualOpacity(data,idx);null==opacity&amp;&amp;(opacity=1),graphicGL.parseColor(color,colorArr),colorArr[3]*=opacity,vertexColors[colorOffset++]=colorArr[0],vertexColors[colorOffset++]=colorArr[1],vertexColors[colorOffset++]=colorArr[2],vertexColors[colorOffset++]=colorArr[3],colorArr[3]&lt;.99&amp;&amp;(hasTransparent=!0)}),lineMesh.geometry.setVertexCount(lineMesh.geometry.getPolylineVertexCount(points)),lineMesh.geometry.setTriangleCount(lineMesh.geometry.getPolylineTriangleCount(points)),lineMesh.geometry.addPolyline(points,vertexColors,retrieve_firstNotNull(seriesModel.get("lineStyle.width"),1)),lineMesh.geometry.dirty(),lineMesh.geometry.updateBoundingBox();var material=lineMesh.material;material.transparent=hasTransparent,material.depthMask=!hasTransparent;var debugWireframeModel=seriesModel.getModel("debug.wireframe");debugWireframeModel.get("show")?(lineMesh.geometry.createAttribute("barycentric","float",3),lineMesh.geometry.generateBarycentric(),lineMesh.material.set("both","WIREFRAME_TRIANGLE"),lineMesh.material.set("wireframeLineColor",graphicGL.parseColor(debugWireframeModel.get("lineStyle.color")||"rgba(0,0,0,0.5)")),lineMesh.material.set("wireframeLineWidth",retrieve_firstNotNull(debugWireframeModel.get("lineStyle.width"),1))):lineMesh.material.set("both","WIREFRAME_TRIANGLE"),this._points=points,this._initHandler(seriesModel,api)},_updateAnimation:function(seriesModel){graphicGL.updateVertexAnimation([["prevPosition","position"],["prevPositionPrev","positionPrev"],["prevPositionNext","positionNext"]],this._prevLine3DMesh,this._line3DMesh,seriesModel)},_initHandler:function(seriesModel,api){var data=seriesModel.getData(),coordSys=seriesModel.coordinateSystem,lineMesh=this._line3DMesh,lastDataIndex=-1;lineMesh.seriesIndex=seriesModel.seriesIndex,lineMesh.off("mousemove"),lineMesh.off("mouseout"),lineMesh.on("mousemove",function(e2){var value=coordSys.pointToData(e2.point.array),dataIndex=data.indicesOfNearest("x",value[0])[0];dataIndex!==lastDataIndex&amp;&amp;(api.dispatchAction({type:"grid3DShowAxisPointer",value:[data.get("x",dataIndex),data.get("y",dataIndex),data.get("z",dataIndex)]}),lineMesh.dataIndex=dataIndex),lastDataIndex=dataIndex},this),lineMesh.on("mouseout",function(e2){lastDataIndex=-1,lineMesh.dataIndex=-1,api.dispatchAction({type:"grid3DHideAxisPointer"})},this)},_updateNDCPosition:function(){var worldViewProjection=new Matrix4,camera=this._camera;Matrix4.multiply(worldViewProjection,camera.projectionMatrix,camera.viewMatrix);var positionNDC=this._positionNDC,points=this._points,nPoints=points.length/3;positionNDC&amp;&amp;positionNDC.length/2===nPoints||(positionNDC=this._positionNDC=new Float32Array(2*nPoints));for(var pos=[],i=0;i&lt;nPoints;i++){var i3=3*i,i2=2*i;pos[0]=points[i3],pos[1]=points[i3+1],pos[2]=points[i3+2],pos[3]=1,vec3$4.transformMat4(pos,pos,worldViewProjection.array),positionNDC[i2]=pos[0]/pos[3],positionNDC[i2+1]=pos[1]/pos[3]}},_pick:function(x,y,renderer,camera,renderable,out){var positionNDC=this._positionNDC,lineWidth=this._data.hostModel.get("lineStyle.width"),dataIndex=-1,halfWidth=.5*renderer.viewport.width,halfHeight=.5*renderer.viewport.height;x=(x+1)*halfWidth,y=(y+1)*halfHeight;for(var i=1;i&lt;positionNDC.length/2;i++){var x0=(positionNDC[2*(i-1)]+1)*halfWidth,y0=(positionNDC[2*(i-1)+1]+1)*halfHeight,x1=(positionNDC[2*i]+1)*halfWidth,y1=(positionNDC[2*i+1]+1)*halfHeight;if(containStroke(x0,y0,x1,y1,lineWidth,x,y))dataIndex=(x0-x)*(x0-x)+(y0-y)*(y0-y)&lt;(x1-x)*(x1-x)+(y1-y)*(y1-y)?i-1:i}if(dataIndex&gt;=0){var i3=3*dataIndex,point=new Vector3(this._points[i3],this._points[i3+1],this._points[i3+2]);out.push({dataIndex:dataIndex,point:point,pointWorld:point.clone(),target:this._line3DMesh,distance:this._camera.getWorldPosition().dist(point)})}},remove:function(){this.groupGL.removeAll()},dispose:function(){this.groupGL.removeAll()}});use(function install$9(registers){registers.registerChartView(Line3DView),registers.registerSeriesModel(Line3DSeries),registers.registerLayout(function(ecModel,api){ecModel.eachSeriesByType("line3D",function(seriesModel){var data=seriesModel.getData(),coordSys=seriesModel.coordinateSystem;if(coordSys){if("cartesian3D"!==coordSys.type)return;var points=new Float32Array(3*data.count()),item=[],out=[],dims=coordSys.dimensions.map(function(coordDim){return seriesModel.coordDimToDataDim(coordDim)[0]});coordSys&amp;&amp;data.each(dims,function(x,y,z,idx){item[0]=x,item[1]=y,item[2]=z,coordSys.dataToPoint(item,out),points[3*idx]=out[0],points[3*idx+1]=out[1],points[3*idx+2]=out[2]}),data.setLayout("points",points)}})})});const Scatter3DSeries=SeriesModel.extend({type:"series.scatter3D",dependencies:["globe","grid3D","geo3D"],visualStyleAccessPath:"itemStyle",hasSymbolVisual:!0,getInitialData:function(option,ecModel){return createList(this)},getFormattedLabel:function(dataIndex,status,dataType,dimIndex){var text=formatUtil.getFormattedLabel(this,dataIndex,status,dataType,dimIndex);if(null==text){var data=this.getData(),lastDim=data.dimensions[data.dimensions.length-1];text=data.get(lastDim,dataIndex)}return text},formatTooltip:function(dataIndex){return formatTooltip(this,dataIndex)},defaultOption:{coordinateSystem:"cartesian3D",zlevel:-10,progressive:1e5,progressiveThreshold:1e5,grid3DIndex:0,globeIndex:0,symbol:"circle",symbolSize:10,blendMode:"source-over",label:{show:!1,position:"right",distance:5,textStyle:{fontSize:14,color:"#000",backgroundColor:"rgba(255,255,255,0.7)",padding:3,borderRadius:3}},itemStyle:{opacity:.8},emphasis:{label:{show:!0}},animationDurationUpdate:500}});function makeSprite(size,canvas,draw){(canvas=canvas||document.createElement("canvas")).width=size,canvas.height=size;var ctx=canvas.getContext("2d");return draw&amp;&amp;draw(ctx),canvas}var spriteUtil={getMarginByStyle:function(style){var minMargin=style.minMargin||0,lineWidth=0;style.stroke&amp;&amp;"none"!==style.stroke&amp;&amp;(lineWidth=null==style.lineWidth?1:style.lineWidth);var shadowBlurSize=style.shadowBlur||0,shadowOffsetX=style.shadowOffsetX||0,shadowOffsetY=style.shadowOffsetY||0,margin={};return margin.left=Math.max(lineWidth/2,-shadowOffsetX+shadowBlurSize,minMargin),margin.right=Math.max(lineWidth/2,shadowOffsetX+shadowBlurSize,minMargin),margin.top=Math.max(lineWidth/2,-shadowOffsetY+shadowBlurSize,minMargin),margin.bottom=Math.max(lineWidth/2,shadowOffsetY+shadowBlurSize,minMargin),margin},createSymbolSprite:function(symbol,symbolSize,style,canvas){var path=function makePath(symbol,symbolSize,style,marginBias){isArray(symbolSize)||(symbolSize=[symbolSize,symbolSize]);var margin=spriteUtil.getMarginByStyle(style,marginBias),width=symbolSize[0]+margin.left+margin.right,height=symbolSize[1]+margin.top+margin.bottom,path=createSymbol(symbol,0,0,symbolSize[0],symbolSize[1]),size=Math.max(width,height);path.x=margin.left,path.y=margin.top,width&gt;height?path.y+=(size-height)/2:path.x+=(size-width)/2;var rect=path.getBoundingRect();return path.x-=rect.x,path.y-=rect.y,path.setStyle(style),path.update(),path.__size=size,path}(symbol,symbolSize,style),margin=spriteUtil.getMarginByStyle(style);return{image:makeSprite(path.__size,canvas,function(ctx){brushSingle(ctx,path)}),margin:margin}},createSDFFromCanvas:function(canvas,size,range,outCanvas){return makeSprite(size,outCanvas,function(outCtx){var imgData=canvas.getContext("2d").getImageData(0,0,canvas.width,canvas.height);outCtx.putImageData(function generateSDF(ctx,sourceImageData,range){var sourceWidth=sourceImageData.width,sourceHeight=sourceImageData.height,width=ctx.canvas.width,height=ctx.canvas.height,scaleX=sourceWidth/width,scaleY=sourceHeight/height;function sign2(r){return r&lt;128?1:-1}function searchMinDistance(x2,y2){var minDistSqr=1/0;x2=Math.floor(x2*scaleX);for(var i2=(y2=Math.floor(y2*scaleY))*sourceWidth+x2,a=sign2(sourceImageData.data[4*i2]),y22=Math.max(y2-range,0);y22&lt;Math.min(y2+range,sourceHeight);y22++)for(var x22=Math.max(x2-range,0);x22&lt;Math.min(x2+range,sourceWidth);x22++){i2=y22*sourceWidth+x22;var dx=x22-x2,dy=y22-y2;if(a!==sign2(sourceImageData.data[4*i2])){var distSqr=dx*dx+dy*dy;distSqr&lt;minDistSqr&amp;&amp;(minDistSqr=distSqr)}}return a*Math.sqrt(minDistSqr)}for(var sdfImageData=ctx.createImageData(width,height),y=0;y&lt;height;y++)for(var x=0;x&lt;width;x++){var normalized=searchMinDistance(x,y)/range*.5+.5,i=4*(y*width+x);sdfImageData.data[i++]=255*(1-normalized),sdfImageData.data[i++]=255*(1-normalized),sdfImageData.data[i++]=255*(1-normalized),sdfImageData.data[i++]=255}return sdfImageData}(outCtx,imgData,range),0,0)})},createSimpleSprite:function(size,canvas){return makeSprite(size,canvas,function(ctx){var halfSize=size/2;ctx.beginPath(),ctx.arc(halfSize,halfSize,60,0,2*Math.PI,!1),ctx.closePath();var gradient=ctx.createRadialGradient(halfSize,halfSize,0,halfSize,halfSize,halfSize);gradient.addColorStop(0,"rgba(255, 255, 255, 1)"),gradient.addColorStop(.5,"rgba(255, 255, 255, 0.5)"),gradient.addColorStop(1,"rgba(255, 255, 255, 0)"),ctx.fillStyle=gradient,ctx.fill()})}},vec3$3=glmatrix.vec3;const verticesSortMixin={needsSortVertices:function(){return this.sortVertices},needsSortVerticesProgressively:function(){return this.needsSortVertices()&amp;&amp;this.vertexCount&gt;=2e4},doSortVertices:function(cameraPos,frame){var indices=this.indices,p=vec3$3.create();if(!indices){indices=this.indices=this.vertexCount&gt;65535?new Uint32Array(this.vertexCount):new Uint16Array(this.vertexCount);for(var i=0;i&lt;indices.length;i++)indices[i]=i}if(0===frame){var firstZ,posAttr=this.attributes.position,noneCount=(cameraPos=cameraPos.array,0);this._zList&amp;&amp;this._zList.length===this.vertexCount||(this._zList=new Float32Array(this.vertexCount));for(i=0;i&lt;this.vertexCount;i++){posAttr.get(i,p);var z=vec3$3.sqrDist(p,cameraPos);isNaN(z)&amp;&amp;(z=1e7,noneCount++),0===i?(firstZ=z,z=0):z-=firstZ,this._zList[i]=z}this._noneCount=noneCount}if(this.vertexCount&lt;2e4)0===frame&amp;&amp;this._simpleSort(this._noneCount/this.vertexCount&gt;.05);else for(i=0;i&lt;3;i++)this._progressiveQuickSort(3*frame+i);this.dirtyIndices()},_simpleSort:function(useNativeQuickSort){var zList=this._zList,indices=this.indices;function compare(a,b){return zList[b]-zList[a]}useNativeQuickSort?Array.prototype.sort.call(indices,compare):ProgressiveQuickSort.sort(indices,compare,0,indices.length-1)},_progressiveQuickSort:function(frame){var zList=this._zList,indices=this.indices;this._quickSort=this._quickSort||new ProgressiveQuickSort,this._quickSort.step(indices,function(a,b){return zList[b]-zList[a]},frame)}};var vec4=glmatrix.vec4;graphicGL.Shader.import("@export ecgl.sdfSprite.vertex\n\nuniform mat4 worldViewProjection : WORLDVIEWPROJECTION;\nuniform float elapsedTime : 0;\n\nattribute vec3 position : POSITION;\n\n#ifdef VERTEX_SIZE\nattribute float size;\n#else\nuniform float u_Size;\n#endif\n\n#ifdef VERTEX_COLOR\nattribute vec4 a_FillColor: COLOR;\nvarying vec4 v_Color;\n#endif\n\n#ifdef VERTEX_ANIMATION\nattribute vec3 prevPosition;\nattribute float prevSize;\nuniform float percent : 1.0;\n#endif\n\n\n#ifdef POSITIONTEXTURE_ENABLED\nuniform sampler2D positionTexture;\n#endif\n\nvarying float v_Size;\n\nvoid main()\n{\n\n#ifdef POSITIONTEXTURE_ENABLED\n gl_Position = worldViewProjection * vec4(texture2D(positionTexture, position.xy).xy, -10.0, 1.0);\n#else\n\n #ifdef VERTEX_ANIMATION\n vec3 pos = mix(prevPosition, position, percent);\n #else\n vec3 pos = position;\n #endif\n gl_Position = worldViewProjection * vec4(pos, 1.0);\n#endif\n\n#ifdef VERTEX_SIZE\n#ifdef VERTEX_ANIMATION\n v_Size = mix(prevSize, size, percent);\n#else\n v_Size = size;\n#endif\n#else\n v_Size = u_Size;\n#endif\n\n#ifdef VERTEX_COLOR\n v_Color = a_FillColor;\n #endif\n\n gl_PointSize = v_Size;\n}\n\n@end\n\n@export ecgl.sdfSprite.fragment\n\nuniform vec4 color: [1, 1, 1, 1];\nuniform vec4 strokeColor: [1, 1, 1, 1];\nuniform float smoothing: 0.07;\n\nuniform float lineWidth: 0.0;\n\n#ifdef VERTEX_COLOR\nvarying vec4 v_Color;\n#endif\n\nvarying float v_Size;\n\nuniform sampler2D sprite;\n\n@import clay.util.srgb\n\nvoid main()\n{\n gl_FragColor = color;\n\n vec4 _strokeColor = strokeColor;\n\n#ifdef VERTEX_COLOR\n gl_FragColor *= v_Color;\n #endif\n\n#ifdef SPRITE_ENABLED\n float d = texture2D(sprite, gl_PointCoord).r;\n gl_FragColor.a *= smoothstep(0.5 - smoothing, 0.5 + smoothing, d);\n\n if (lineWidth &gt; 0.0) {\n float sLineWidth = lineWidth / 2.0;\n\n float outlineMaxValue0 = 0.5 + sLineWidth;\n float outlineMaxValue1 = 0.5 + sLineWidth + smoothing;\n float outlineMinValue0 = 0.5 - sLineWidth - smoothing;\n float outlineMinValue1 = 0.5 - sLineWidth;\n\n if (d &lt;= outlineMaxValue1 &amp;&amp; d &gt;= outlineMinValue0) {\n float a = _strokeColor.a;\n if (d &lt;= outlineMinValue1) {\n a = a * smoothstep(outlineMinValue0, outlineMinValue1, d);\n }\n else {\n a = a * smoothstep(outlineMaxValue1, outlineMaxValue0, d);\n }\n gl_FragColor.rgb = mix(gl_FragColor.rgb * gl_FragColor.a, _strokeColor.rgb, a);\n gl_FragColor.a = gl_FragColor.a * (1.0 - a) + a;\n }\n }\n#endif\n\n#ifdef SRGB_DECODE\n gl_FragColor = sRGBToLinear(gl_FragColor);\n#endif\n}\n@end");var PointsMesh=graphicGL.Mesh.extend(function(){var geometry=new graphicGL.Geometry({dynamic:!0,attributes:{color:new graphicGL.Geometry.Attribute("color","float",4,"COLOR"),position:new graphicGL.Geometry.Attribute("position","float",3,"POSITION"),size:new graphicGL.Geometry.Attribute("size","float",1),prevPosition:new graphicGL.Geometry.Attribute("prevPosition","float",3),prevSize:new graphicGL.Geometry.Attribute("prevSize","float",1)}});Object.assign(geometry,verticesSortMixin);var material=new graphicGL.Material({shader:graphicGL.createShader("ecgl.sdfSprite"),transparent:!0,depthMask:!1});material.enableTexture("sprite"),material.define("both","VERTEX_COLOR"),material.define("both","VERTEX_SIZE");var sdfTexture=new graphicGL.Texture2D({image:document.createElement("canvas"),flipY:!1});return material.set("sprite",sdfTexture),geometry.pick=this._pick.bind(this),{geometry:geometry,material:material,mode:graphicGL.Mesh.POINTS,sizeScale:1}},{_pick:function(x,y,renderer,camera,renderable,out){var positionNDC=this._positionNDC;if(positionNDC)for(var viewport=renderer.viewport,ndcScaleX=2/viewport.width,ndcScaleY=2/viewport.height,i=this.geometry.vertexCount-1;i&gt;=0;i--){var idx,cx=positionNDC[2*(idx=this.geometry.indices?this.geometry.indices[i]:i)],cy=positionNDC[2*idx+1],halfSize=this.geometry.attributes.size.get(idx)/this.sizeScale/2;if(x&gt;cx-halfSize*ndcScaleX&amp;&amp;x&lt;cx+halfSize*ndcScaleX&amp;&amp;y&gt;cy-halfSize*ndcScaleY&amp;&amp;y&lt;cy+halfSize*ndcScaleY){var point=new graphicGL.Vector3,pointWorld=new graphicGL.Vector3;this.geometry.attributes.position.get(idx,point.array),graphicGL.Vector3.transformMat4(pointWorld,point,this.worldTransform),out.push({vertexIndex:idx,point:point,pointWorld:pointWorld,target:this,distance:pointWorld.distance(camera.getWorldPosition())})}}},updateNDCPosition:function(worldViewProjection,is2D,api){var positionNDC=this._positionNDC,geometry=this.geometry;positionNDC&amp;&amp;positionNDC.length/2===geometry.vertexCount||(positionNDC=this._positionNDC=new Float32Array(2*geometry.vertexCount));for(var pos=vec4.create(),i=0;i&lt;geometry.vertexCount;i++)geometry.attributes.position.get(i,pos),pos[3]=1,vec4.transformMat4(pos,pos,worldViewProjection.array),vec4.scale(pos,pos,1/pos[3]),positionNDC[2*i]=pos[0],positionNDC[2*i+1]=pos[1]}});function PointsBuilder(is2D,api){this.rootNode=new graphicGL.Node,this.is2D=is2D,this._labelsBuilder=new LabelsBuilder(256,256,api),this._labelsBuilder.getMesh().renderOrder=100,this.rootNode.add(this._labelsBuilder.getMesh()),this._api=api,this._spriteImageCanvas=document.createElement("canvas"),this._startDataIndex=0,this._endDataIndex=0,this._sizeScale=1}PointsBuilder.prototype={constructor:PointsBuilder,highlightOnMouseover:!0,update:function(seriesModel,ecModel,api,start,end){var tmp=this._prevMesh;this._prevMesh=this._mesh,this._mesh=tmp;var data=seriesModel.getData();if(null==start&amp;&amp;(start=0),null==end&amp;&amp;(end=data.count()),this._startDataIndex=start,this._endDataIndex=end-1,!this._mesh){var material=this._prevMesh&amp;&amp;this._prevMesh.material;this._mesh=new PointsMesh({renderOrder:10,frustumCulling:!1}),material&amp;&amp;(this._mesh.material=material)}material=this._mesh.material;var geometry=this._mesh.geometry,attributes=geometry.attributes;this.rootNode.remove(this._prevMesh),this.rootNode.add(this._mesh),this._setPositionTextureToMesh(this._mesh,this._positionTexture);var symbolInfo=this._getSymbolInfo(seriesModel,start,end),dpr=api.getDevicePixelRatio(),itemStyle=seriesModel.getModel("itemStyle").getItemStyle(),largeMode=seriesModel.get("large"),pointSizeScale=1;symbolInfo.maxSize&gt;2?(pointSizeScale=this._updateSymbolSprite(seriesModel,itemStyle,symbolInfo,dpr),material.enableTexture("sprite")):material.disableTexture("sprite"),attributes.position.init(end-start);var rgbaArr=[];if(largeMode){material.undefine("VERTEX_SIZE"),material.undefine("VERTEX_COLOR");var color=function getVisualColor(data){const style=data.getVisual("style");if(style)return style[data.getVisual("drawType")]}(data),opacity=function getVisualOpacity(data){return data.getVisual("style").opacity}(data);graphicGL.parseColor(color,rgbaArr),rgbaArr[3]*=opacity,material.set({color:rgbaArr,u_Size:symbolInfo.maxSize*this._sizeScale})}else material.set({color:[1,1,1,1]}),material.define("VERTEX_SIZE"),material.define("VERTEX_COLOR"),attributes.size.init(end-start),attributes.color.init(end-start),this._originalOpacity=new Float32Array(end-start);for(var points=data.getLayout("points"),positionArr=attributes.position.value,i=0;i&lt;end-start;i++){var i3=3*i,i2=2*i;if(this.is2D?(positionArr[i3]=points[i2],positionArr[i3+1]=points[i2+1],positionArr[i3+2]=-10):(positionArr[i3]=points[i3],positionArr[i3+1]=points[i3+1],positionArr[i3+2]=points[i3+2]),!largeMode){color=getItemVisualColor(data,i),opacity=getItemVisualOpacity(data,i);graphicGL.parseColor(color,rgbaArr),rgbaArr[3]*=opacity,attributes.color.set(i,rgbaArr),rgbaArr[3];var symbolSize=data.getItemVisual(i,"symbolSize");symbolSize=symbolSize instanceof Array?Math.max(symbolSize[0],symbolSize[1]):symbolSize,isNaN(symbolSize)&amp;&amp;(symbolSize=0),attributes.size.value[i]=symbolSize*pointSizeScale*this._sizeScale,this._originalOpacity[i]=rgbaArr[3]}}this._mesh.sizeScale=pointSizeScale,geometry.updateBoundingBox(),geometry.dirty(),this._updateMaterial(seriesModel,itemStyle);var coordSys=seriesModel.coordinateSystem;coordSys&amp;&amp;coordSys.viewGL&amp;&amp;material[coordSys.viewGL.isLinearSpace()?"define":"undefine"]("fragment","SRGB_DECODE");largeMode||this._updateLabelBuilder(seriesModel,start,end),this._updateHandler(seriesModel,ecModel,api),this._updateAnimation(seriesModel),this._api=api},getPointsMesh:function(){return this._mesh},updateLabels:function(highlightDataIndices){this._labelsBuilder.updateLabels(highlightDataIndices)},hideLabels:function(){this.rootNode.remove(this._labelsBuilder.getMesh())},showLabels:function(){this.rootNode.add(this._labelsBuilder.getMesh())},dispose:function(){this._labelsBuilder.dispose()},_updateSymbolSprite:function(seriesModel,itemStyle,symbolInfo,dpr){symbolInfo.maxSize=Math.min(2*symbolInfo.maxSize,200);var symbolSize=[];return symbolInfo.aspect&gt;1?(symbolSize[0]=symbolInfo.maxSize,symbolSize[1]=symbolInfo.maxSize/symbolInfo.aspect):(symbolSize[1]=symbolInfo.maxSize,symbolSize[0]=symbolInfo.maxSize*symbolInfo.aspect),symbolSize[0]=symbolSize[0]||1,symbolSize[1]=symbolSize[1]||1,this._symbolType===symbolInfo.type&amp;&amp;function isSymbolSizeSame(a,b){return a&amp;&amp;b&amp;&amp;a[0]===b[0]&amp;&amp;a[1]===b[1]}(this._symbolSize,symbolSize)&amp;&amp;this._lineWidth===itemStyle.lineWidth||(spriteUtil.createSymbolSprite(symbolInfo.type,symbolSize,{fill:"#fff",lineWidth:itemStyle.lineWidth,stroke:"transparent",shadowColor:"transparent",minMargin:Math.min(symbolSize[0]/2,10)},this._spriteImageCanvas),spriteUtil.createSDFFromCanvas(this._spriteImageCanvas,Math.min(this._spriteImageCanvas.width,32),20,this._mesh.material.get("sprite").image),this._symbolType=symbolInfo.type,this._symbolSize=symbolSize,this._lineWidth=itemStyle.lineWidth),this._spriteImageCanvas.width/symbolInfo.maxSize*dpr},_updateMaterial:function(seriesModel,itemStyle){var blendFunc="lighter"===seriesModel.get("blendMode")?graphicGL.additiveBlend:null,material=this._mesh.material;material.blend=blendFunc,material.set("lineWidth",itemStyle.lineWidth/20);var strokeColor=graphicGL.parseColor(itemStyle.stroke);material.set("strokeColor",strokeColor),material.transparent=!0,material.depthMask=!1,material.depthTest=!this.is2D,material.sortVertices=!this.is2D},_updateLabelBuilder:function(seriesModel,start,end){var data=seriesModel.getData(),geometry=this._mesh.geometry,positionArr=geometry.attributes.position.value,pointSizeScale=(start=this._startDataIndex,this._mesh.sizeScale);this._labelsBuilder.updateData(data,start,end),this._labelsBuilder.getLabelPosition=function(dataIndex,positionDesc,distance){var idx3=3*(dataIndex-start);return[positionArr[idx3],positionArr[idx3+1],positionArr[idx3+2]]},this._labelsBuilder.getLabelDistance=function(dataIndex,positionDesc,distance){return geometry.attributes.size.get(dataIndex-start)/pointSizeScale/2+distance},this._labelsBuilder.updateLabels()},_updateAnimation:function(seriesModel){graphicGL.updateVertexAnimation([["prevPosition","position"],["prevSize","size"]],this._prevMesh,this._mesh,seriesModel)},_updateHandler:function(seriesModel,ecModel,api){var grid3DModel,data=seriesModel.getData(),pointsMesh=this._mesh,self2=this,lastDataIndex=-1,isCartesian3D=seriesModel.coordinateSystem&amp;&amp;"cartesian3D"===seriesModel.coordinateSystem.type;isCartesian3D&amp;&amp;(grid3DModel=seriesModel.coordinateSystem.model),pointsMesh.seriesIndex=seriesModel.seriesIndex,pointsMesh.off("mousemove"),pointsMesh.off("mouseout"),pointsMesh.on("mousemove",function(e2){var dataIndex=e2.vertexIndex+self2._startDataIndex;dataIndex!==lastDataIndex&amp;&amp;(this.highlightOnMouseover&amp;&amp;(this.downplay(data,lastDataIndex),this.highlight(data,dataIndex),this._labelsBuilder.updateLabels([dataIndex])),isCartesian3D&amp;&amp;api.dispatchAction({type:"grid3DShowAxisPointer",value:[data.get(seriesModel.coordDimToDataDim("x")[0],dataIndex),data.get(seriesModel.coordDimToDataDim("y")[0],dataIndex),data.get(seriesModel.coordDimToDataDim("z")[0],dataIndex)],grid3DIndex:grid3DModel.componentIndex})),pointsMesh.dataIndex=dataIndex,lastDataIndex=dataIndex},this),pointsMesh.on("mouseout",function(e2){var dataIndex=e2.vertexIndex+self2._startDataIndex;this.highlightOnMouseover&amp;&amp;(this.downplay(data,dataIndex),this._labelsBuilder.updateLabels()),lastDataIndex=-1,pointsMesh.dataIndex=-1,isCartesian3D&amp;&amp;api.dispatchAction({type:"grid3DHideAxisPointer",grid3DIndex:grid3DModel.componentIndex})},this)},updateLayout:function(seriesModel,ecModel,api){var data=seriesModel.getData();if(this._mesh){var positionArr=this._mesh.geometry.attributes.position.value,points=data.getLayout("points");if(this.is2D)for(var i=0;i&lt;points.length/2;i++){var i3=3*i,i2=2*i;positionArr[i3]=points[i2],positionArr[i3+1]=points[i2+1],positionArr[i3+2]=-10}else for(i=0;i&lt;points.length;i++)positionArr[i]=points[i];this._mesh.geometry.dirty(),api.getZr().refresh()}},updateView:function(camera){if(this._mesh){var worldViewProjection=new Matrix4;Matrix4.mul(worldViewProjection,camera.viewMatrix,this._mesh.worldTransform),Matrix4.mul(worldViewProjection,camera.projectionMatrix,worldViewProjection),this._mesh.updateNDCPosition(worldViewProjection,this.is2D,this._api)}},highlight:function(data,dataIndex){if(!(dataIndex&gt;this._endDataIndex||dataIndex&lt;this._startDataIndex)){var emphasisItemStyleModel=data.getItemModel(dataIndex).getModel("emphasis.itemStyle"),emphasisColor=emphasisItemStyleModel.get("color"),emphasisOpacity=emphasisItemStyleModel.get("opacity");if(null==emphasisColor){var color=getItemVisualColor(data,dataIndex);emphasisColor=lift(color,-.4)}null==emphasisOpacity&amp;&amp;(emphasisOpacity=getItemVisualOpacity(data,dataIndex));var colorArr=graphicGL.parseColor(emphasisColor);colorArr[3]*=emphasisOpacity,this._mesh.geometry.attributes.color.set(dataIndex-this._startDataIndex,colorArr),this._mesh.geometry.dirtyAttribute("color"),this._api.getZr().refresh()}},downplay:function(data,dataIndex){if(!(dataIndex&gt;this._endDataIndex||dataIndex&lt;this._startDataIndex)){var color=getItemVisualColor(data,dataIndex),opacity=getItemVisualOpacity(data,dataIndex),colorArr=graphicGL.parseColor(color);colorArr[3]*=opacity,this._mesh.geometry.attributes.color.set(dataIndex-this._startDataIndex,colorArr),this._mesh.geometry.dirtyAttribute("color"),this._api.getZr().refresh()}},fadeOutAll:function(fadeOutPercent){if(this._originalOpacity){for(var geo=this._mesh.geometry,i=0;i&lt;geo.vertexCount;i++){var fadeOutOpacity=this._originalOpacity[i]*fadeOutPercent;geo.attributes.color.value[4*i+3]=fadeOutOpacity}geo.dirtyAttribute("color"),this._api.getZr().refresh()}},fadeInAll:function(){this.fadeOutAll(1)},setPositionTexture:function(texture){this._mesh&amp;&amp;this._setPositionTextureToMesh(this._mesh,texture),this._positionTexture=texture},removePositionTexture:function(){this._positionTexture=null,this._mesh&amp;&amp;this._setPositionTextureToMesh(this._mesh,null)},setSizeScale:function(sizeScale){if(sizeScale!==this._sizeScale){if(this._mesh){var originalSize=this._mesh.material.get("u_Size");this._mesh.material.set("u_Size",originalSize/this._sizeScale*sizeScale);var attributes=this._mesh.geometry.attributes;if(attributes.size.value)for(var i=0;i&lt;attributes.size.value.length;i++)attributes.size.value[i]=attributes.size.value[i]/this._sizeScale*sizeScale}this._sizeScale=sizeScale}},_setPositionTextureToMesh:function(mesh,texture){texture&amp;&amp;mesh.material.set("positionTexture",texture),mesh.material[texture?"enableTexture":"disableTexture"]("positionTexture")},_getSymbolInfo:function(seriesModel,start,end){if(seriesModel.get("large"))return(symbolSize=retrieve_firstNotNull(seriesModel.get("symbolSize"),1))instanceof Array?(maxSymbolSize=Math.max(symbolSize[0],symbolSize[1]),symbolAspect=symbolSize[0]/symbolSize[1]):(maxSymbolSize=symbolSize,symbolAspect=1),{maxSize:symbolSize,type:seriesModel.get("symbol"),aspect:symbolAspect};for(var symbolAspect,data=seriesModel.getData(),symbolType=data.getItemVisual(0,"symbol")||"circle",maxSymbolSize=0,idx=start;idx&lt;end;idx++){var currentSymbolAspect,symbolSize=data.getItemVisual(idx,"symbolSize"),currentSymbolType=data.getItemVisual(idx,"symbol");if(symbolSize instanceof Array)currentSymbolAspect=symbolSize[0]/symbolSize[1],maxSymbolSize=Math.max(Math.max(symbolSize[0],symbolSize[1]),maxSymbolSize);else{if(isNaN(symbolSize))continue;currentSymbolAspect=1,maxSymbolSize=Math.max(symbolSize,maxSymbolSize)}symbolType=currentSymbolType,symbolAspect=currentSymbolAspect}return{maxSize:maxSymbolSize,type:symbolType,aspect:symbolAspect}}};const Scatter3DView=ChartView.extend({type:"scatter3D",hasSymbolVisual:!0,__ecgl__:!0,init:function(ecModel,api){this.groupGL=new graphicGL.Node,this._pointsBuilderList=[],this._currentStep=0},render:function(seriesModel,ecModel,api){if(this.groupGL.removeAll(),seriesModel.getData().count()){var coordSys=seriesModel.coordinateSystem;if(coordSys&amp;&amp;coordSys.viewGL){coordSys.viewGL.add(this.groupGL),this._camera=coordSys.viewGL.camera;var pointsBuilder=this._pointsBuilderList[0];pointsBuilder||(pointsBuilder=this._pointsBuilderList[0]=new PointsBuilder(!1,api)),this._pointsBuilderList.length=1,this.groupGL.add(pointsBuilder.rootNode),pointsBuilder.update(seriesModel,ecModel,api),pointsBuilder.updateView(coordSys.viewGL.camera)}}},incrementalPrepareRender:function(seriesModel,ecModel,api){var coordSys=seriesModel.coordinateSystem;coordSys&amp;&amp;coordSys.viewGL&amp;&amp;(coordSys.viewGL.add(this.groupGL),this._camera=coordSys.viewGL.camera),this.groupGL.removeAll(),this._currentStep=0},incrementalRender:function(params,seriesModel,ecModel,api){if(!(params.end&lt;=params.start)){var pointsBuilder=this._pointsBuilderList[this._currentStep];pointsBuilder||(pointsBuilder=new PointsBuilder(!1,api),this._pointsBuilderList[this._currentStep]=pointsBuilder),this.groupGL.add(pointsBuilder.rootNode),pointsBuilder.update(seriesModel,ecModel,api,params.start,params.end),pointsBuilder.updateView(seriesModel.coordinateSystem.viewGL.camera),this._currentStep++}},updateCamera:function(){this._pointsBuilderList.forEach(function(pointsBuilder){pointsBuilder.updateView(this._camera)},this)},highlight:function(seriesModel,ecModel,api,payload){this._toggleStatus("highlight",seriesModel,ecModel,api,payload)},downplay:function(seriesModel,ecModel,api,payload){this._toggleStatus("downplay",seriesModel,ecModel,api,payload)},_toggleStatus:function(status,seriesModel,ecModel,api,payload){var data=seriesModel.getData(),dataIndex=retrieve_queryDataIndex(data,payload),isHighlight="highlight"===status;null!=dataIndex?each(formatUtil.normalizeToArray(dataIndex),function(dataIdx){for(var i=0;i&lt;this._pointsBuilderList.length;i++){var pointsBuilder=this._pointsBuilderList[i];isHighlight?pointsBuilder.highlight(data,dataIdx):pointsBuilder.downplay(data,dataIdx)}},this):data.each(function(dataIdx){for(var i=0;i&lt;this._pointsBuilderList.length;i++){var pointsBuilder=this._pointsBuilderList[i];isHighlight?pointsBuilder.highlight(data,dataIdx):pointsBuilder.downplay(data,dataIdx)}})},dispose:function(){this._pointsBuilderList.forEach(function(pointsBuilder){pointsBuilder.dispose()}),this.groupGL.removeAll()},remove:function(){this.groupGL.removeAll()}});use(function install$8(registers){registers.registerChartView(Scatter3DView),registers.registerSeriesModel(Scatter3DSeries),registers.registerLayout({seriesType:"scatter3D",reset:function(seriesModel){var coordSys=seriesModel.coordinateSystem;if(coordSys){var coordDims=coordSys.dimensions;if(coordDims.length&lt;3)return;var dims=coordDims.map(function(coordDim){return seriesModel.coordDimToDataDim(coordDim)[0]}),item=[],out=[];return{progress:function(params,data){for(var points=new Float32Array(3*(params.end-params.start)),idx=params.start;idx&lt;params.end;idx++){var idx3=3*(idx-params.start);item[0]=data.get(dims[0],idx),item[1]=data.get(dims[1],idx),item[2]=data.get(dims[2],idx),coordSys.dataToPoint(item,out),points[idx3]=out[0],points[idx3+1]=out[1],points[idx3+2]=out[2]}data.setLayout("points",points)}}}}})});var vec3$2=glmatrix.vec3,vec2$2=glmatrix.vec2,normalize$1=vec3$2.normalize,cross=vec3$2.cross,sub=vec3$2.sub,add=vec3$2.add,create=vec3$2.create,normal=create(),tangent=create(),bitangent=create(),halfVector=create(),coord0=[],coord1=[];function getCubicPointsOnGlobe(coords,coordSys){vec2$2.copy(coord0,coords[0]),vec2$2.copy(coord1,coords[1]);var pts=[],p02=pts[0]=create(),p12=pts[1]=create(),p22=pts[2]=create(),p3=pts[3]=create();coordSys.dataToPoint(coord0,p02),coordSys.dataToPoint(coord1,p3),normalize$1(normal,p02),sub(tangent,p3,p02),normalize$1(tangent,tangent),cross(bitangent,tangent,normal),normalize$1(bitangent,bitangent),cross(tangent,normal,bitangent),add(p12,normal,tangent),normalize$1(p12,p12),normalize$1(normal,p3),sub(tangent,p02,p3),normalize$1(tangent,tangent),cross(bitangent,tangent,normal),normalize$1(bitangent,bitangent),cross(tangent,normal,bitangent),add(p22,normal,tangent),normalize$1(p22,p22),add(halfVector,p02,p3),normalize$1(halfVector,halfVector);var projDist=vec3$2.dot(p02,halfVector),cosTheta=vec3$2.dot(halfVector,p12),len=(Math.max(vec3$2.len(p02),vec3$2.len(p3))-projDist)/cosTheta*2;return vec3$2.scaleAndAdd(p12,p02,p12,len),vec3$2.scaleAndAdd(p22,p3,p22,len),pts}function getPolylinePoints(coords,coordSys){for(var pts=new Float32Array(3*coords.length),off=0,pt=[],i=0;i&lt;coords.length;i++)coordSys.dataToPoint(coords[i],pt),pts[off++]=pt[0],pts[off++]=pt[1],pts[off++]=pt[2];return pts}function prepareCoords(data){var coordsList=[];return data.each(function(idx){var itemModel=data.getItemModel(idx),coords=itemModel.option instanceof Array?itemModel.option:itemModel.getShallow("coords",!0);coordsList.push(coords)}),{coordsList:coordsList}}function layoutOnPlane(seriesModel,coordSys,normal2){var data=seriesModel.getData(),isPolyline=seriesModel.get("polyline"),res=prepareCoords(data);data.setLayout("lineType",isPolyline?"polyline":"cubicBezier"),data.each(function(idx){var coords=res.coordsList[idx],pts=isPolyline?getPolylinePoints(coords,coordSys):function getCubicPointsOnPlane(coords,coordSys,up){var pts=[],p02=pts[0]=vec3$2.create(),p12=pts[1]=vec3$2.create(),p22=pts[2]=vec3$2.create(),p3=pts[3]=vec3$2.create();coordSys.dataToPoint(coords[0],p02),coordSys.dataToPoint(coords[1],p3);var len=vec3$2.dist(p02,p3);return vec3$2.lerp(p12,p02,p3,.3),vec3$2.lerp(p22,p02,p3,.3),vec3$2.scaleAndAdd(p12,p12,up,Math.min(.1*len,10)),vec3$2.scaleAndAdd(p22,p22,up,Math.min(.1*len,10)),pts}(coords,coordSys,normal2);data.setItemLayout(idx,pts)})}function lines3DLayout(ecModel,api){ecModel.eachSeriesByType("lines3D",function(seriesModel){var coordSys=seriesModel.coordinateSystem;"globe"===coordSys.type?function layoutGlobe(seriesModel,coordSys){var data=seriesModel.getData(),isPolyline=seriesModel.get("polyline");data.setLayout("lineType",isPolyline?"polyline":"cubicBezier");var res=prepareCoords(data);data.each(function(idx){var coords=res.coordsList[idx],getPointsMethod=isPolyline?getPolylinePoints:getCubicPointsOnGlobe;data.setItemLayout(idx,getPointsMethod(coords,coordSys))})}(seriesModel,coordSys):"geo3D"===coordSys.type?layoutOnPlane(seriesModel,coordSys,[0,1,0]):"mapbox3D"!==coordSys.type&amp;&amp;"maptalks3D"!==coordSys.type||layoutOnPlane(seriesModel,coordSys,[0,0,1])})}const Lines3DSeries=SeriesModel.extend({type:"series.lines3D",dependencies:["globe"],visualStyleAccessPath:"lineStyle",visualDrawType:"stroke",getInitialData:function(option,ecModel){var lineData=new SeriesData(["value"],this);return lineData.hasItemOption=!1,lineData.initData(option.data,[],function(dataItem,dimName,dataIndex,dimIndex){if(dataItem instanceof Array)return NaN;lineData.hasItemOption=!0;var value=dataItem.value;return null!=value?value instanceof Array?value[dimIndex]:value:void 0}),lineData},defaultOption:{coordinateSystem:"globe",globeIndex:0,geo3DIndex:0,zlevel:-10,polyline:!1,effect:{show:!1,period:4,trailWidth:4,trailLength:.2,spotIntensity:6},silent:!0,blendMode:"source-over",lineStyle:{width:1,opacity:.5}}});var vec3$1=glmatrix.vec3;function sign(a){return a&gt;0?1:-1}graphicGL.Shader.import("@export ecgl.trail2.vertex\nattribute vec3 position: POSITION;\nattribute vec3 positionPrev;\nattribute vec3 positionNext;\nattribute float offset;\nattribute float dist;\nattribute float distAll;\nattribute float start;\n\nattribute vec4 a_Color : COLOR;\n\nuniform mat4 worldViewProjection : WORLDVIEWPROJECTION;\nuniform vec4 viewport : VIEWPORT;\nuniform float near : NEAR;\n\nuniform float speed : 0;\nuniform float trailLength: 0.3;\nuniform float time;\nuniform float period: 1000;\n\nuniform float spotSize: 1;\n\nvarying vec4 v_Color;\nvarying float v_Percent;\nvarying float v_SpotPercent;\n\n@import ecgl.common.wireframe.vertexHeader\n\n@import ecgl.lines3D.clipNear\n\nvoid main()\n{\n @import ecgl.lines3D.expandLine\n\n gl_Position = currProj;\n\n v_Color = a_Color;\n\n @import ecgl.common.wireframe.vertexMain\n\n#ifdef CONSTANT_SPEED\n float t = mod((speed * time + start) / distAll, 1. + trailLength) - trailLength;\n#else\n float t = mod((time + start) / period, 1. + trailLength) - trailLength;\n#endif\n\n float trailLen = distAll * trailLength;\n\n v_Percent = (dist - t * distAll) / trailLen;\n\n v_SpotPercent = spotSize / distAll;\n\n }\n@end\n\n\n@export ecgl.trail2.fragment\n\nuniform vec4 color : [1.0, 1.0, 1.0, 1.0];\nuniform float spotIntensity: 5;\n\nvarying vec4 v_Color;\nvarying float v_Percent;\nvarying float v_SpotPercent;\n\n@import ecgl.common.wireframe.fragmentHeader\n\n@import clay.util.srgb\n\nvoid main()\n{\n if (v_Percent &gt; 1.0 || v_Percent &lt; 0.0) {\n discard;\n }\n\n float fade = v_Percent;\n\n#ifdef SRGB_DECODE\n gl_FragColor = sRGBToLinear(color * v_Color);\n#else\n gl_FragColor = color * v_Color;\n#endif\n\n @import ecgl.common.wireframe.fragmentMain\n\n if (v_Percent &gt; (1.0 - v_SpotPercent)) {\n gl_FragColor.rgb *= spotIntensity;\n }\n\n gl_FragColor.a *= fade;\n}\n\n@end");const TrailMesh2=graphicGL.Mesh.extend(function(){var material=new graphicGL.Material({shader:new graphicGL.Shader(graphicGL.Shader.source("ecgl.trail2.vertex"),graphicGL.Shader.source("ecgl.trail2.fragment")),transparent:!0,depthMask:!1}),geometry=new LinesGeometry$2({dynamic:!0});return geometry.createAttribute("dist","float",1),geometry.createAttribute("distAll","float",1),geometry.createAttribute("start","float",1),{geometry:geometry,material:material,culling:!1,$ignorePicking:!0}},{updateData:function(data,api,lines3DGeometry){var seriesModel=data.hostModel,geometry=this.geometry,effectModel=seriesModel.getModel("effect"),size=effectModel.get("trailWidth")*api.getDevicePixelRatio(),trailLength=effectModel.get("trailLength"),speed=seriesModel.get("effect.constantSpeed"),period=1e3*seriesModel.get("effect.period"),useConstantSpeed=null!=speed;useConstantSpeed?this.material.set("speed",speed/1e3):this.material.set("period",period),this.material[useConstantSpeed?"define":"undefine"]("vertex","CONSTANT_SPEED");var isPolyline=seriesModel.get("polyline");geometry.trailLength=trailLength,this.material.set("trailLength",trailLength),geometry.resetOffset(),["position","positionPrev","positionNext"].forEach(function(attrName){geometry.attributes[attrName].value=lines3DGeometry.attributes[attrName].value});["dist","distAll","start","offset","color"].forEach(function(attrName){geometry.attributes[attrName].init(geometry.vertexCount)}),geometry.indices=lines3DGeometry.indices;var colorArr=[],effectColor=effectModel.get("trailColor"),effectOpacity=effectModel.get("trailOpacity"),hasEffectColor=null!=effectColor,hasEffectOpacity=null!=effectOpacity;this.updateWorldTransform();var xScale=this.worldTransform.x.len(),yScale=this.worldTransform.y.len(),zScale=this.worldTransform.z.len(),vertexOffset=0,maxDistance=0;data.each(function(idx){var pts=data.getItemLayout(idx),opacity=hasEffectOpacity?effectOpacity:getItemVisualOpacity(data,idx),color=getItemVisualColor(data,idx);null==opacity&amp;&amp;(opacity=1),(colorArr=graphicGL.parseColor(hasEffectColor?effectColor:color,colorArr))[3]*=opacity;for(var vertexCount=isPolyline?lines3DGeometry.getPolylineVertexCount(pts):lines3DGeometry.getCubicCurveVertexCount(pts[0],pts[1],pts[2],pts[3]),dist=0,pos=[],posPrev=[],i=vertexOffset;i&lt;vertexOffset+vertexCount;i++)geometry.attributes.position.get(i,pos),pos[0]*=xScale,pos[1]*=yScale,pos[2]*=zScale,i&gt;vertexOffset&amp;&amp;(dist+=vec3$1.dist(pos,posPrev)),geometry.attributes.dist.set(i,dist),vec3$1.copy(posPrev,pos);maxDistance=Math.max(maxDistance,dist);var randomStart=Math.random()*(useConstantSpeed?dist:period);for(i=vertexOffset;i&lt;vertexOffset+vertexCount;i++)geometry.attributes.distAll.set(i,dist),geometry.attributes.start.set(i,randomStart),geometry.attributes.offset.set(i,sign(lines3DGeometry.attributes.offset.get(i))*size/2),geometry.attributes.color.set(i,colorArr);vertexOffset+=vertexCount}),this.material.set("spotSize",.1*maxDistance*trailLength),this.material.set("spotIntensity",effectModel.get("spotIntensity")),geometry.dirty()},setAnimationTime:function(time){this.material.set("time",time)}});graphicGL.Shader.import(lines3DGLSL);const Lines3DView=ChartView.extend({type:"lines3D",__ecgl__:!0,init:function(ecModel,api){this.groupGL=new graphicGL.Node,this._meshLinesMaterial=new graphicGL.Material({shader:graphicGL.createShader("ecgl.meshLines3D"),transparent:!0,depthMask:!1}),this._linesMesh=new graphicGL.Mesh({geometry:new LinesGeometry$2,material:this._meshLinesMaterial,$ignorePicking:!0}),this._trailMesh=new TrailMesh2},render:function(seriesModel,ecModel,api){this.groupGL.add(this._linesMesh);var coordSys=seriesModel.coordinateSystem,data=seriesModel.getData();if(coordSys&amp;&amp;coordSys.viewGL){coordSys.viewGL.add(this.groupGL),this._updateLines(seriesModel,ecModel,api);var methodName=coordSys.viewGL.isLinearSpace()?"define":"undefine";this._linesMesh.material[methodName]("fragment","SRGB_DECODE"),this._trailMesh.material[methodName]("fragment","SRGB_DECODE")}var trailMesh=this._trailMesh;if(trailMesh.stopAnimation(),seriesModel.get("effect.show")){this.groupGL.add(trailMesh),trailMesh.updateData(data,api,this._linesMesh.geometry),trailMesh.__time=trailMesh.__time||0;this._curveEffectsAnimator=trailMesh.animate("",{loop:!0}).when(36e5,{__time:36e5}).during(function(){trailMesh.setAnimationTime(trailMesh.__time)}).start()}else this.groupGL.remove(trailMesh),this._curveEffectsAnimator=null;this._linesMesh.material.blend=this._trailMesh.material.blend="lighter"===seriesModel.get("blendMode")?graphicGL.additiveBlend:null},pauseEffect:function(){this._curveEffectsAnimator&amp;&amp;this._curveEffectsAnimator.pause()},resumeEffect:function(){this._curveEffectsAnimator&amp;&amp;this._curveEffectsAnimator.resume()},toggleEffect:function(){var animator=this._curveEffectsAnimator;animator&amp;&amp;(animator.isPaused()?animator.resume():animator.pause())},_updateLines:function(seriesModel,ecModel,api){var data=seriesModel.getData(),coordSys=seriesModel.coordinateSystem,geometry=this._linesMesh.geometry,isPolyline=seriesModel.get("polyline");geometry.expandLine=!0;var size=function getCoordSysSize(coordSys){return null!=coordSys.radius?coordSys.radius:null!=coordSys.size?Math.max(coordSys.size[0],coordSys.size[1],coordSys.size[2]):100}(coordSys);geometry.segmentScale=size/20;var lineWidthQueryPath="lineStyle.width".split("."),dpr=api.getDevicePixelRatio();data.each(function(idx){var lineWidth=data.getItemModel(idx).get(lineWidthQueryPath);null==lineWidth&amp;&amp;(lineWidth=1),data.setItemVisual(idx,"lineWidth",lineWidth)}),geometry.useNativeLine=!1;var nVertex=0,nTriangle=0;data.each(function(idx){var pts=data.getItemLayout(idx);isPolyline?(nVertex+=geometry.getPolylineVertexCount(pts),nTriangle+=geometry.getPolylineTriangleCount(pts)):(nVertex+=geometry.getCubicCurveVertexCount(pts[0],pts[1],pts[2],pts[3]),nTriangle+=geometry.getCubicCurveTriangleCount(pts[0],pts[1],pts[2],pts[3]))}),geometry.setVertexCount(nVertex),geometry.setTriangleCount(nTriangle),geometry.resetOffset();var colorArr=[];data.each(function(idx){var pts=data.getItemLayout(idx),color=getItemVisualColor(data,idx),opacity=getItemVisualOpacity(data,idx),lineWidth=data.getItemVisual(idx,"lineWidth")*dpr;null==opacity&amp;&amp;(opacity=1),(colorArr=graphicGL.parseColor(color,colorArr))[3]*=opacity,isPolyline?geometry.addPolyline(pts,colorArr,lineWidth):geometry.addCubicCurve(pts[0],pts[1],pts[2],pts[3],colorArr,lineWidth)}),geometry.dirty()},remove:function(){this.groupGL.removeAll()},dispose:function(){this.groupGL.removeAll()}});function transformPolygon$1(coordSys,poly){for(var ret=[],i=0;i&lt;poly.length;i++)ret.push(coordSys.dataToPoint(poly[i]));return ret}use(function install$7(registers){registers.registerChartView(Lines3DView),registers.registerSeriesModel(Lines3DSeries),registers.registerLayout(lines3DLayout),registers.registerAction({type:"lines3DPauseEffect",event:"lines3deffectpaused",update:"series.lines3D:pauseEffect"},function(){}),registers.registerAction({type:"lines3DResumeEffect",event:"lines3deffectresumed",update:"series.lines3D:resumeEffect"},function(){}),registers.registerAction({type:"lines3DToggleEffect",event:"lines3deffectchanged",update:"series.lines3D:toggleEffect"},function(){})});var Polygons3DSeries=SeriesModel.extend({type:"series.polygons3D",getRegionModel:function(idx){return this.getData().getItemModel(idx)},getRegionPolygonCoords:function(idx){var coordSys=this.coordinateSystem,itemModel=this.getData().getItemModel(idx),coords=itemModel.option instanceof Array?itemModel.option:itemModel.getShallow("coords");itemModel.get("multiPolygon")||(coords=[coords]);for(var out=[],i=0;i&lt;coords.length;i++){for(var interiors=[],k=1;k&lt;coords[i].length;k++)interiors.push(transformPolygon$1(coordSys,coords[i][k]));out.push({exterior:transformPolygon$1(coordSys,coords[i][0]),interiors:interiors})}return out},getInitialData:function(option){var polygonsData=new SeriesData(["value"],this);return polygonsData.hasItemOption=!1,polygonsData.initData(option.data,[],function(dataItem,dimName,dataIndex,dimIndex){if(dataItem instanceof Array)return NaN;polygonsData.hasItemOption=!0;var value=dataItem.value;return null!=value?value instanceof Array?value[dimIndex]:value:void 0}),polygonsData},defaultOption:{show:!0,data:null,multiPolygon:!1,progressiveThreshold:1e3,progressive:1e3,zlevel:-10,label:{show:!1,distance:2,textStyle:{fontSize:20,color:"#000",backgroundColor:"rgba(255,255,255,0.7)",padding:3,borderRadius:4}},itemStyle:{color:"#fff",borderWidth:0,borderColor:"#333"},emphasis:{itemStyle:{color:"#639fc0"},label:{show:!0}}}});merge(Polygons3DSeries.prototype,componentShadingMixin);const Polygons3DView=ChartView.extend({type:"polygons3D",__ecgl__:!0,init:function(ecModel,api){this.groupGL=new graphicGL.Node,this._geo3DBuilderList=[],this._currentStep=0},render:function(seriesModel,ecModel,api){this.groupGL.removeAll();var coordSys=seriesModel.coordinateSystem;coordSys&amp;&amp;coordSys.viewGL&amp;&amp;coordSys.viewGL.add(this.groupGL);var geo3DBuilder=this._geo3DBuilderList[0];geo3DBuilder||((geo3DBuilder=new Geo3DBuilder(api)).extrudeY="mapbox3D"!==coordSys.type&amp;&amp;"maptalks3D"!==coordSys.type,this._geo3DBuilderList[0]=geo3DBuilder),this._updateShaderDefines(coordSys,geo3DBuilder),geo3DBuilder.update(seriesModel,ecModel,api),this._geo3DBuilderList.length=1,this.groupGL.add(geo3DBuilder.rootNode)},incrementalPrepareRender:function(seriesModel,ecModel,api){this.groupGL.removeAll();var coordSys=seriesModel.coordinateSystem;coordSys&amp;&amp;coordSys.viewGL&amp;&amp;coordSys.viewGL.add(this.groupGL),this._currentStep=0},incrementalRender:function(params,seriesModel,ecModel,api){var geo3DBuilder=this._geo3DBuilderList[this._currentStep],coordSys=seriesModel.coordinateSystem;geo3DBuilder||((geo3DBuilder=new Geo3DBuilder(api)).extrudeY="mapbox3D"!==coordSys.type&amp;&amp;"maptalks3D"!==coordSys.type,this._geo3DBuilderList[this._currentStep]=geo3DBuilder),geo3DBuilder.update(seriesModel,ecModel,api,params.start,params.end),this.groupGL.add(geo3DBuilder.rootNode),this._updateShaderDefines(coordSys,geo3DBuilder),this._currentStep++},_updateShaderDefines:function(coordSys,geo3DBuilder){var methodName=coordSys.viewGL.isLinearSpace()?"define":"undefine";geo3DBuilder.rootNode.traverse(function(mesh){mesh.material&amp;&amp;(mesh.material[methodName]("fragment","SRGB_DECODE"),"mapbox3D"!==coordSys.type&amp;&amp;"maptalks3D"!==coordSys.type||(mesh.material.define("fragment","NORMAL_UP_AXIS",2),mesh.material.define("fragment","NORMAL_FRONT_AXIS",1)))})},remove:function(){this.groupGL.removeAll()},dispose:function(){this.groupGL.removeAll(),this._geo3DBuilderList.forEach(function(geo3DBuilder){geo3DBuilder.dispose()})}});use(function install$6(registers){registers.registerChartView(Polygons3DView),registers.registerSeriesModel(Polygons3DSeries)});var SurfaceSeries=SeriesModel.extend({type:"series.surface",dependencies:["globe","grid3D","geo3D"],visualStyleAccessPath:"itemStyle",formatTooltip:function(dataIndex){return formatTooltip(this,dataIndex)},getInitialData:function(option,ecModel){var data=option.data;function validateDimension(dimOpts){return!(isNaN(dimOpts.min)||isNaN(dimOpts.max)||isNaN(dimOpts.step))}function getPrecision(dimOpts){var getPrecision2=getPrecisionSafe;return Math.max(getPrecision2(dimOpts.min),getPrecision2(dimOpts.max),getPrecision2(dimOpts.step))+1}if(!data)if(option.parametric){var parametricEquation=option.parametricEquation||{},uOpts=parametricEquation.u||{},vOpts=parametricEquation.v||{};["u","v"].forEach(function(dim){validateDimension(parametricEquation[dim])}),["x","y","z"].forEach(function(dim){parametricEquation[dim]});var uCount=Math.floor((uOpts.max+uOpts.step-uOpts.min)/uOpts.step),vCount=Math.floor((vOpts.max+vOpts.step-vOpts.min)/vOpts.step);data=new Float32Array(uCount*vCount*5);var uPrecision=getPrecision(uOpts),vPrecision=getPrecision(vOpts);for(off=0,j=0;j&lt;vCount;j++)for(i=0;i&lt;uCount;i++){var u=i*uOpts.step+uOpts.min,v=j*vOpts.step+vOpts.min,u2=round(Math.min(u,uOpts.max),uPrecision),v2=round(Math.min(v,vOpts.max),vPrecision);x=parametricEquation.x(u2,v2),y=parametricEquation.y(u2,v2),z=parametricEquation.z(u2,v2);data[off++]=x,data[off++]=y,data[off++]=z,data[off++]=u2,data[off++]=v2}}else{var equation=option.equation||{},xOpts=equation.x||{},yOpts=equation.y||{};if(["x","y"].forEach(function(dim){validateDimension(equation[dim])}),"function"!=typeof equation.z)return;var xCount=Math.floor((xOpts.max+xOpts.step-xOpts.min)/xOpts.step),yCount=Math.floor((yOpts.max+yOpts.step-yOpts.min)/yOpts.step);data=new Float32Array(xCount*yCount*3);for(var xPrecision=getPrecision(xOpts),yPrecision=getPrecision(yOpts),off=0,j=0;j&lt;yCount;j++)for(var i=0;i&lt;xCount;i++){var x=i*xOpts.step+xOpts.min,y=j*yOpts.step+yOpts.min,x2=round(Math.min(x,xOpts.max),xPrecision),y2=round(Math.min(y,yOpts.max),yPrecision),z=equation.z(x2,y2);data[off++]=x2,data[off++]=y2,data[off++]=z}}var dims=["x","y","z"];return option.parametric&amp;&amp;dims.push("u","v"),createList(this,dims,data)},defaultOption:{coordinateSystem:"cartesian3D",zlevel:-10,grid3DIndex:0,shading:"lambert",parametric:!1,wireframe:{show:!0,lineStyle:{color:"rgba(0,0,0,0.5)",width:1}},equation:{x:{min:-1,max:1,step:.1},y:{min:-1,max:1,step:.1},z:null},parametricEquation:{u:{min:-1,max:1,step:.1},v:{min:-1,max:1,step:.1},x:null,y:null,z:null},dataShape:null,itemStyle:{},animationDurationUpdate:500}});merge(SurfaceSeries.prototype,componentShadingMixin);var vec3=glmatrix.vec3;function isPointsNaN(pt){return isNaN(pt[0])||isNaN(pt[1])||isNaN(pt[2])}const SurfaceView=ChartView.extend({type:"surface",__ecgl__:!0,init:function(ecModel,api){this.groupGL=new graphicGL.Node},render:function(seriesModel,ecModel,api){var tmp=this._prevSurfaceMesh;this._prevSurfaceMesh=this._surfaceMesh,this._surfaceMesh=tmp,this._surfaceMesh||(this._surfaceMesh=this._createSurfaceMesh()),this.groupGL.remove(this._prevSurfaceMesh),this.groupGL.add(this._surfaceMesh);var coordSys=seriesModel.coordinateSystem,shading=seriesModel.get("shading"),data=seriesModel.getData(),shadingPrefix="ecgl."+shading;if(this._surfaceMesh.material&amp;&amp;this._surfaceMesh.material.shader.name===shadingPrefix||(this._surfaceMesh.material=graphicGL.createMaterial(shadingPrefix,["VERTEX_COLOR","DOUBLE_SIDED"])),graphicGL.setMaterialFromModel(shading,this._surfaceMesh.material,seriesModel,api),coordSys&amp;&amp;coordSys.viewGL){coordSys.viewGL.add(this.groupGL);var methodName=coordSys.viewGL.isLinearSpace()?"define":"undefine";this._surfaceMesh.material[methodName]("fragment","SRGB_DECODE")}var isParametric=seriesModel.get("parametric"),dataShape=seriesModel.get("dataShape");dataShape||(dataShape=this._getDataShape(data,isParametric));var wireframeModel=seriesModel.getModel("wireframe"),wireframeLineWidth=wireframeModel.get("lineStyle.width"),showWireframe=wireframeModel.get("show")&amp;&amp;wireframeLineWidth&gt;0;this._updateSurfaceMesh(this._surfaceMesh,seriesModel,dataShape,showWireframe);var material=this._surfaceMesh.material;showWireframe?(material.define("WIREFRAME_QUAD"),material.set("wireframeLineWidth",wireframeLineWidth),material.set("wireframeLineColor",graphicGL.parseColor(wireframeModel.get("lineStyle.color")))):material.undefine("WIREFRAME_QUAD"),this._initHandler(seriesModel,api),this._updateAnimation(seriesModel)},_updateAnimation:function(seriesModel){graphicGL.updateVertexAnimation([["prevPosition","position"],["prevNormal","normal"]],this._prevSurfaceMesh,this._surfaceMesh,seriesModel)},_createSurfaceMesh:function(){var mesh=new graphicGL.Mesh({geometry:new graphicGL.Geometry({dynamic:!0,sortTriangles:!0}),shadowDepthMaterial:new graphicGL.Material({shader:new graphicGL.Shader(graphicGL.Shader.source("ecgl.sm.depth.vertex"),graphicGL.Shader.source("ecgl.sm.depth.fragment"))}),culling:!1,renderOrder:10,renderNormal:!0});return mesh.geometry.createAttribute("barycentric","float",4),mesh.geometry.createAttribute("prevPosition","float",3),mesh.geometry.createAttribute("prevNormal","float",3),Object.assign(mesh.geometry,trianglesSortMixin),mesh},_initHandler:function(seriesModel,api){var data=seriesModel.getData(),surfaceMesh=this._surfaceMesh,coordSys=seriesModel.coordinateSystem;surfaceMesh.seriesIndex=seriesModel.seriesIndex;var lastDataIndex=-1;surfaceMesh.off("mousemove"),surfaceMesh.off("mouseout"),surfaceMesh.on("mousemove",function(e2){var idx=function getNearestPointIdx(triangle,point){for(var nearestDist=1/0,nearestIdx=-1,pos=[],i=0;i&lt;triangle.length;i++){surfaceMesh.geometry.attributes.position.get(triangle[i],pos);var dist=vec3.dist(point.array,pos);dist&lt;nearestDist&amp;&amp;(nearestDist=dist,nearestIdx=triangle[i])}return nearestIdx}(e2.triangle,e2.point);if(idx&gt;=0){var point=[];surfaceMesh.geometry.attributes.position.get(idx,point);for(var value=coordSys.pointToData(point),minDist=1/0,dataIndex=-1,item=[],i=0;i&lt;data.count();i++){item[0]=data.get("x",i),item[1]=data.get("y",i),item[2]=data.get("z",i);var dist=vec3.squaredDistance(item,value);dist&lt;minDist&amp;&amp;(dataIndex=i,minDist=dist)}dataIndex!==lastDataIndex&amp;&amp;api.dispatchAction({type:"grid3DShowAxisPointer",value:value}),lastDataIndex=dataIndex,surfaceMesh.dataIndex=dataIndex}else surfaceMesh.dataIndex=-1},this),surfaceMesh.on("mouseout",function(e2){lastDataIndex=-1,surfaceMesh.dataIndex=-1,api.dispatchAction({type:"grid3DHideAxisPointer"})},this)},_updateSurfaceMesh:function(surfaceMesh,seriesModel,dataShape,showWireframe){var geometry=surfaceMesh.geometry,data=seriesModel.getData(),pointsArr=data.getLayout("points"),invalidDataCount=0;data.each(function(idx2){data.hasValue(idx2)||invalidDataCount++});var needsSplitQuad=invalidDataCount||showWireframe,positionAttr=geometry.attributes.position,normalAttr=geometry.attributes.normal,texcoordAttr=geometry.attributes.texcoord0,barycentricAttr=geometry.attributes.barycentric,colorAttr=geometry.attributes.color,row=dataShape[0],column=dataShape[1],needsNormal="color"!==seriesModel.get("shading");if(needsSplitQuad){var vertexCount=(row-1)*(column-1)*4;positionAttr.init(vertexCount),showWireframe&amp;&amp;barycentricAttr.init(vertexCount)}else positionAttr.value=new Float32Array(pointsArr);colorAttr.init(geometry.vertexCount),texcoordAttr.init(geometry.vertexCount);var quadToTriangle=[0,3,1,1,3,2],quadBarycentric=[[1,1,0,0],[0,1,0,1],[1,0,0,1],[1,0,1,0]],indices=geometry.indices=new(geometry.vertexCount&gt;65535?Uint32Array:Uint16Array)((row-1)*(column-1)*6),getQuadIndices=function(i2,j2,out){out[1]=i2*column+j2,out[0]=i2*column+j2+1,out[3]=(i2+1)*column+j2+1,out[2]=(i2+1)*column+j2},isTransparent=!1;if(needsSplitQuad){var quadIndices=[],pos=[],faceOffset=0;needsNormal?normalAttr.init(geometry.vertexCount):normalAttr.value=null;for(var pts=[[],[],[]],v21=[],v32=[],normal2=vec3.create(),getFromArray=function(arr,idx2,out){var idx32=3*idx2;return out[0]=arr[idx32],out[1]=arr[idx32+1],out[2]=arr[idx32+2],out},vertexNormals=new Float32Array(pointsArr.length),vertexColors=new Float32Array(pointsArr.length/3*4),i=0;i&lt;data.count();i++)if(data.hasValue(i)){var rgbaArr=graphicGL.parseColor(getItemVisualColor(data,i));null!=(opacity=getItemVisualOpacity(data,i))&amp;&amp;(rgbaArr[3]*=opacity),rgbaArr[3]&lt;.99&amp;&amp;(isTransparent=!0);for(var k=0;k&lt;4;k++)vertexColors[4*i+k]=rgbaArr[k]}var farPoints=[1e7,1e7,1e7];for(i=0;i&lt;row-1;i++)for(var j=0;j&lt;column-1;j++){var vertexOffset=4*(i*(column-1)+j);getQuadIndices(i,j,quadIndices);var invisibleQuad=!1;for(k=0;k&lt;4;k++)getFromArray(pointsArr,quadIndices[k],pos),isPointsNaN(pos)&amp;&amp;(invisibleQuad=!0);for(k=0;k&lt;4;k++)invisibleQuad?positionAttr.set(vertexOffset+k,farPoints):(getFromArray(pointsArr,quadIndices[k],pos),positionAttr.set(vertexOffset+k,pos)),showWireframe&amp;&amp;barycentricAttr.set(vertexOffset+k,quadBarycentric[k]);for(k=0;k&lt;6;k++)indices[faceOffset++]=quadToTriangle[k]+vertexOffset;if(needsNormal&amp;&amp;!invisibleQuad)for(k=0;k&lt;2;k++){for(var k3=3*k,m=0;m&lt;3;m++){getFromArray(pointsArr,idx=quadIndices[quadToTriangle[k3]+m],pts[m])}vec3.sub(v21,pts[0],pts[1]),vec3.sub(v32,pts[1],pts[2]),vec3.cross(normal2,v21,v32);for(m=0;m&lt;3;m++){var idx3=3*quadIndices[quadToTriangle[k3]+m];vertexNormals[idx3]=vertexNormals[idx3]+normal2[0],vertexNormals[idx3+1]=vertexNormals[idx3+1]+normal2[1],vertexNormals[idx3+2]=vertexNormals[idx3+2]+normal2[2]}}}if(needsNormal)for(i=0;i&lt;vertexNormals.length/3;i++)getFromArray(vertexNormals,i,normal2),vec3.normalize(normal2,normal2),vertexNormals[3*i]=normal2[0],vertexNormals[3*i+1]=normal2[1],vertexNormals[3*i+2]=normal2[2];rgbaArr=[];var uvArr=[];for(i=0;i&lt;row-1;i++)for(j=0;j&lt;column-1;j++){vertexOffset=4*(i*(column-1)+j);getQuadIndices(i,j,quadIndices);for(k=0;k&lt;4;k++){for(m=0;m&lt;4;m++)rgbaArr[m]=vertexColors[4*quadIndices[k]+m];colorAttr.set(vertexOffset+k,rgbaArr),needsNormal&amp;&amp;(getFromArray(vertexNormals,quadIndices[k],normal2),normalAttr.set(vertexOffset+k,normal2));var idx=quadIndices[k];uvArr[0]=idx%column/(column-1),uvArr[1]=Math.floor(idx/column)/(row-1),texcoordAttr.set(vertexOffset+k,uvArr)}0}}else{for(uvArr=[],i=0;i&lt;data.count();i++){uvArr[0]=i%column/(column-1),uvArr[1]=Math.floor(i/column)/(row-1);var opacity;rgbaArr=graphicGL.parseColor(getItemVisualColor(data,i));null!=(opacity=getItemVisualOpacity(data,i))&amp;&amp;(rgbaArr[3]*=opacity),rgbaArr[3]&lt;.99&amp;&amp;(isTransparent=!0),colorAttr.set(i,rgbaArr),texcoordAttr.set(i,uvArr)}quadIndices=[];var cursor=0;for(i=0;i&lt;row-1;i++)for(j=0;j&lt;column-1;j++){getQuadIndices(i,j,quadIndices);for(k=0;k&lt;6;k++)indices[cursor++]=quadIndices[quadToTriangle[k]]}needsNormal?geometry.generateVertexNormals():normalAttr.value=null}surfaceMesh.material.get("normalMap")&amp;&amp;geometry.generateTangents(),geometry.updateBoundingBox(),geometry.dirty(),surfaceMesh.material.transparent=isTransparent,surfaceMesh.material.depthMask=!isTransparent},_getDataShape:function(data,isParametric){for(var prevX=-1/0,rowCount=0,columnCount=0,mayInvalid=!1,rowDim=isParametric?"u":"x",dataCount=data.count(),i=0;i&lt;dataCount;i++){var x=data.get(rowDim,i);x&lt;prevX&amp;&amp;(columnCount=0,rowCount++),prevX=x,columnCount++}if(rowCount&amp;&amp;1!==columnCount||(mayInvalid=!0),!mayInvalid)return[rowCount+1,columnCount];for(var rows=Math.floor(Math.sqrt(dataCount));rows&gt;0;){if(Math.floor(dataCount/rows)===dataCount/rows)return[rows,dataCount/rows];rows--}return[rows=Math.floor(Math.sqrt(dataCount)),rows]},dispose:function(){this.groupGL.removeAll()},remove:function(){this.groupGL.removeAll()}});function transformPolygon(mapbox3DCoordSys,poly){for(var newPoly=[],k=0;k&lt;poly.length;k++)newPoly.push(mapbox3DCoordSys.dataToPoint(poly[k]));return newPoly}use(function install$5(registers){registers.registerChartView(SurfaceView),registers.registerSeriesModel(SurfaceSeries),registers.registerLayout(function(ecModel,api){ecModel.eachSeriesByType("surface",function(surfaceModel){var cartesian=surfaceModel.coordinateSystem;!cartesian||cartesian.type;var data=surfaceModel.getData(),points=new Float32Array(3*data.count()),nanPoint=[NaN,NaN,NaN];if(cartesian&amp;&amp;"cartesian3D"===cartesian.type){var dims=cartesian.dimensions.map(function(coordDim){return surfaceModel.coordDimToDataDim(coordDim)[0]});data.each(dims,function(x,y,z,idx){var pt;pt=data.hasValue(idx)?cartesian.dataToPoint([x,y,z]):nanPoint,points[3*idx]=pt[0],points[3*idx+1]=pt[1],points[3*idx+2]=pt[2]})}data.setLayout("points",points)})})});var Map3DSeries=SeriesModel.extend({type:"series.map3D",layoutMode:"box",coordinateSystem:null,visualStyleAccessPath:"itemStyle",optionUpdated:function(newOpt){var coordSysType=this.get("coordinateSystem");null!=coordSysType&amp;&amp;"geo3D"!==coordSysType&amp;&amp;(this.get("groundPlane.show")&amp;&amp;(this.option.groundPlane.show=!1),this._geo=null)},getInitialData:function(option){option.data=this.getFilledRegions(option.data,option.map);var dimensions=createDimensions(option.data,{coordDimensions:["value"]}),list=new SeriesData(dimensions,this);list.initData(option.data);var regionModelMap={};return list.each(function(idx){var name=list.getName(idx),itemModel=list.getItemModel(idx);regionModelMap[name]=itemModel}),this._regionModelMap=regionModelMap,list},formatTooltip:function(dataIndex){return formatTooltip(this,dataIndex)},getRegionModel:function(idx){var name=this.getData().getName(idx);return this._regionModelMap[name]||new Model(null,this)},getRegionPolygonCoords:function(idx){var coordSys=this.coordinateSystem,name=this.getData().getName(idx);if(coordSys.transform)return(region=coordSys.getRegion(name))?region.geometries:[];this._geo||(this._geo=geo3DCreator.createGeo3D(this));for(var region=this._geo.getRegion(name),ret=[],k=0;k&lt;region.geometries.length;k++){var geo=region.geometries[k],interiors=[],exterior=transformPolygon(coordSys,geo.exterior);if(interiors&amp;&amp;interiors.length)for(var m=0;m&lt;geo.interiors.length;m++)interiors.push(transformPolygon(coordSys,interiors[m]));ret.push({interiors:interiors,exterior:exterior})}return ret},getFormattedLabel:function(dataIndex,status){var text=formatUtil.getFormattedLabel(this,dataIndex,status);return null==text&amp;&amp;(text=this.getData().getName(dataIndex)),text},defaultOption:{coordinateSystem:"geo3D",data:null}});merge(Map3DSeries.prototype,geo3DModelMixin),merge(Map3DSeries.prototype,componentViewControlMixin),merge(Map3DSeries.prototype,componentPostEffectMixin),merge(Map3DSeries.prototype,componentLightMixin),merge(Map3DSeries.prototype,componentShadingMixin);const Map3DView=ChartView.extend({type:"map3D",__ecgl__:!0,init:function(ecModel,api){this._geo3DBuilder=new Geo3DBuilder(api),this.groupGL=new graphicGL.Node},render:function(map3DModel,ecModel,api){var coordSys=map3DModel.coordinateSystem;if(coordSys&amp;&amp;coordSys.viewGL){if(this.groupGL.add(this._geo3DBuilder.rootNode),coordSys.viewGL.add(this.groupGL),"geo3D"===coordSys.type){this._sceneHelper||(this._sceneHelper=new SceneHelper,this._sceneHelper.initLight(this.groupGL)),this._sceneHelper.setScene(coordSys.viewGL.scene),this._sceneHelper.updateLight(map3DModel),coordSys.viewGL.setPostEffect(map3DModel.getModel("postEffect"),api),coordSys.viewGL.setTemporalSuperSampling(map3DModel.getModel("temporalSuperSampling"));var control=this._control;control||(control=this._control=new OrbitControl({zr:api.getZr()}),this._control.init());var viewControlModel=map3DModel.getModel("viewControl");control.setViewGL(coordSys.viewGL),control.setFromViewControlModel(viewControlModel,0),control.off("update"),control.on("update",function(){api.dispatchAction({type:"map3DChangeCamera",alpha:control.getAlpha(),beta:control.getBeta(),distance:control.getDistance(),from:this.uid,map3DId:map3DModel.id})}),this._geo3DBuilder.extrudeY=!0}else this._control&amp;&amp;(this._control.dispose(),this._control=null),this._sceneHelper&amp;&amp;(this._sceneHelper.dispose(),this._sceneHelper=null),map3DModel.getData().getLayout("geo3D"),this._geo3DBuilder.extrudeY=!1;this._geo3DBuilder.update(map3DModel,ecModel,api,0,map3DModel.getData().count());var srgbDefineMethod=coordSys.viewGL.isLinearSpace()?"define":"undefine";this._geo3DBuilder.rootNode.traverse(function(mesh){mesh.material&amp;&amp;mesh.material[srgbDefineMethod]("fragment","SRGB_DECODE")})}},afterRender:function(map3DModel,ecModel,api,layerGL){var renderer=layerGL.renderer,coordSys=map3DModel.coordinateSystem;coordSys&amp;&amp;"geo3D"===coordSys.type&amp;&amp;(this._sceneHelper.updateAmbientCubemap(renderer,map3DModel,api),this._sceneHelper.updateSkybox(renderer,map3DModel,api))},dispose:function(){this.groupGL.removeAll(),this._control.dispose(),this._geo3DBuilder.dispose()}});use(function install$4(registers){install$e(registers),registers.registerChartView(Map3DView),registers.registerSeriesModel(Map3DSeries),registers.registerAction({type:"map3DChangeCamera",event:"map3dcamerachanged",update:"series:updateCamera"},function(payload,ecModel){ecModel.eachComponent({mainType:"series",subType:"map3D",query:payload},function(componentModel){componentModel.setView(payload)})})});const ScatterGLSeries=SeriesModel.extend({type:"series.scatterGL",dependencies:["grid","polar","geo","singleAxis"],visualStyleAccessPath:"itemStyle",hasSymbolVisual:!0,getInitialData:function(){return createList$1(this)},defaultOption:{coordinateSystem:"cartesian2d",zlevel:10,progressive:1e5,progressiveThreshold:1e5,large:!1,symbol:"circle",symbolSize:10,zoomScale:0,blendMode:"source-over",itemStyle:{opacity:.8},postEffect:{enable:!1,colorCorrection:{exposure:0,brightness:0,contrast:1,saturation:1,enable:!0}}}});function GLViewHelper(viewGL){this.viewGL=viewGL}GLViewHelper.prototype.reset=function(seriesModel,api){this._updateCamera(api.getWidth(),api.getHeight(),api.getDevicePixelRatio()),this._viewTransform=create$1(),this.updateTransform(seriesModel,api)},GLViewHelper.prototype.updateTransform=function(seriesModel,api){var coordinateSystem=seriesModel.coordinateSystem;coordinateSystem.getRoamTransform&amp;&amp;(invert(this._viewTransform,coordinateSystem.getRoamTransform()),this._setCameraTransform(this._viewTransform),api.getZr().refresh())},GLViewHelper.prototype.dataToPoint=function(coordSys,data,pt){pt=coordSys.dataToPoint(data,null,pt);var viewTransform=this._viewTransform;viewTransform&amp;&amp;applyTransform(pt,pt,viewTransform)},GLViewHelper.prototype.removeTransformInPoint=function(pt){return this._viewTransform&amp;&amp;applyTransform(pt,pt,this._viewTransform),pt},GLViewHelper.prototype.getZoom=function(){if(this._viewTransform){var m=this._viewTransform;return 1/Math.max(Math.sqrt(m[0]*m[0]+m[1]*m[1]),Math.sqrt(m[2]*m[2]+m[3]*m[3]))}return 1},GLViewHelper.prototype._setCameraTransform=function(m){var camera=this.viewGL.camera;camera.position.set(m[4],m[5],0),camera.scale.set(Math.sqrt(m[0]*m[0]+m[1]*m[1]),Math.sqrt(m[2]*m[2]+m[3]*m[3]),1)},GLViewHelper.prototype._updateCamera=function(width,height,dpr){this.viewGL.setViewport(0,0,width,height,dpr);var camera=this.viewGL.camera;camera.left=camera.top=0,camera.bottom=height,camera.right=width,camera.near=0,camera.far=100};const ScatterGLView=ChartView.extend({type:"scatterGL",__ecgl__:!0,init:function(ecModel,api){this.groupGL=new graphicGL.Node,this.viewGL=new ViewGL("orthographic"),this.viewGL.add(this.groupGL),this._pointsBuilderList=[],this._currentStep=0,this._sizeScale=1,this._glViewHelper=new GLViewHelper(this.viewGL)},render:function(seriesModel,ecModel,api){if(this.groupGL.removeAll(),this._glViewHelper.reset(seriesModel,api),seriesModel.getData().count()){var pointsBuilder=this._pointsBuilderList[0];pointsBuilder||(pointsBuilder=this._pointsBuilderList[0]=new PointsBuilder(!0,api)),this._pointsBuilderList.length=1,this.groupGL.add(pointsBuilder.rootNode),this._removeTransformInPoints(seriesModel.getData().getLayout("points")),pointsBuilder.update(seriesModel,ecModel,api),this.viewGL.setPostEffect(seriesModel.getModel("postEffect"),api)}},incrementalPrepareRender:function(seriesModel,ecModel,api){this.groupGL.removeAll(),this._glViewHelper.reset(seriesModel,api),this._currentStep=0,this.viewGL.setPostEffect(seriesModel.getModel("postEffect"),api)},incrementalRender:function(params,seriesModel,ecModel,api){if(!(params.end&lt;=params.start)){var pointsBuilder=this._pointsBuilderList[this._currentStep];pointsBuilder||(pointsBuilder=new PointsBuilder(!0,api),this._pointsBuilderList[this._currentStep]=pointsBuilder),this.groupGL.add(pointsBuilder.rootNode),this._removeTransformInPoints(seriesModel.getData().getLayout("points")),pointsBuilder.setSizeScale(this._sizeScale),pointsBuilder.update(seriesModel,ecModel,api,params.start,params.end),api.getZr().refresh(),this._currentStep++}},updateTransform:function(seriesModel,ecModel,api){if(seriesModel.coordinateSystem.getRoamTransform){this._glViewHelper.updateTransform(seriesModel,api);var zoom=this._glViewHelper.getZoom(),sizeScale=Math.max((seriesModel.get("zoomScale")||0)*(zoom-1)+1,0);this._sizeScale=sizeScale,this._pointsBuilderList.forEach(function(pointsBuilder){pointsBuilder.setSizeScale(sizeScale)})}},_removeTransformInPoints:function(points){if(points)for(var pt=[],i=0;i&lt;points.length;i+=2)pt[0]=points[i],pt[1]=points[i+1],this._glViewHelper.removeTransformInPoint(pt),points[i]=pt[0],points[i+1]=pt[1]},dispose:function(){this.groupGL.removeAll(),this._pointsBuilderList.forEach(function(pointsBuilder){pointsBuilder.dispose()})},remove:function(){this.groupGL.removeAll()}});use(function install$3(registers){registers.registerChartView(ScatterGLView),registers.registerSeriesModel(ScatterGLSeries),registers.registerLayout({seriesType:"scatterGL",reset:function(seriesModel){var progress,coordSys=seriesModel.coordinateSystem,data=seriesModel.getData();if(coordSys){var dims=coordSys.dimensions.map(function(dim){return data.mapDimension(dim)}).slice(0,2),pt=[];1===dims.length?progress=function(params){for(var points=new Float32Array(2*(params.end-params.start)),idx=params.start;idx&lt;params.end;idx++){var offset=2*(idx-params.start),x=data.get(dims[0],idx),pt2=coordSys.dataToPoint(x);points[offset]=pt2[0],points[offset+1]=pt2[1]}data.setLayout("points",points)}:2===dims.length&amp;&amp;(progress=function(params){for(var points=new Float32Array(2*(params.end-params.start)),idx=params.start;idx&lt;params.end;idx++){var offset=2*(idx-params.start),x=data.get(dims[0],idx),y=data.get(dims[1],idx);pt[0]=x,pt[1]=y,pt=coordSys.dataToPoint(pt),points[offset]=pt[0],points[offset+1]=pt[1]}data.setLayout("points",points)})}return{progress:progress}}})});var GraphSeries=SeriesModel.extend({type:"series.graphGL",visualStyleAccessPath:"itemStyle",hasSymbolVisual:!0,init:function(option){GraphSeries.superApply(this,"init",arguments),this.legendDataProvider=function(){return this._categoriesData},this._updateCategoriesData()},mergeOption:function(option){GraphSeries.superApply(this,"mergeOption",arguments),this._updateCategoriesData()},getFormattedLabel:function(dataIndex,status,dataType,dimIndex){var text=formatUtil.getFormattedLabel(this,dataIndex,status,dataType,dimIndex);if(null==text){var data=this.getData(),lastDim=data.dimensions[data.dimensions.length-1];text=data.get(lastDim,dataIndex)}return text},getInitialData:function(option,ecModel){var edges=option.edges||option.links||[],nodes=option.data||option.nodes||[],self2=this;if(nodes&amp;&amp;edges)return function createGraphFromNodeEdge(nodes,edges,hostModel,directed,beforeLink){for(var graph=new Graph(directed),i=0;i&lt;nodes.length;i++)graph.addNode(retrieve_firstNotNull(nodes[i].id,nodes[i].name,i),i);var nodeData,linkNameList=[],validEdges=[],linkCount=0;for(i=0;i&lt;edges.length;i++){var link=edges[i],source=link.source,target=link.target;graph.addEdge(source,target,linkCount)&amp;&amp;(validEdges.push(link),linkNameList.push(retrieve_firstNotNull(link.id,source+" &gt; "+target)),linkCount++)}var dimensionNames=createDimensions(nodes,{coordDimensions:["value"]});(nodeData=new SeriesData(dimensionNames,hostModel)).initData(nodes);var edgeData=new SeriesData(["value"],hostModel);return edgeData.initData(validEdges,linkNameList),beforeLink&amp;&amp;beforeLink(nodeData,edgeData),linkSeriesData({mainData:nodeData,struct:graph,structAttr:"graph",datas:{node:nodeData,edge:edgeData},datasAttr:{node:"data",edge:"edgeData"}}),graph.update(),graph}(nodes,edges,this,!0,function beforeLink(nodeData,edgeData){nodeData.wrapMethod("getItemModel",function(model){const categoryModel=self2._categoriesModels[model.getShallow("category")];return categoryModel&amp;&amp;(categoryModel.parentModel=model.parentModel,model.parentModel=categoryModel),model});const oldGetModel=ecModel.getModel([]).getModel;function newGetModel(path,parentModel){const model=oldGetModel.call(this,path,parentModel);return model.resolveParentPath=resolveParentPath,model}function resolveParentPath(pathArr){if(pathArr&amp;&amp;("label"===pathArr[0]||"label"===pathArr[1])){const newPathArr=pathArr.slice();return"label"===pathArr[0]?newPathArr[0]="edgeLabel":"label"===pathArr[1]&amp;&amp;(newPathArr[1]="edgeLabel"),newPathArr}return pathArr}edgeData.wrapMethod("getItemModel",function(model){return model.resolveParentPath=resolveParentPath,model.getModel=newGetModel,model})}).data},getGraph:function(){return this.getData().graph},getEdgeData:function(){return this.getGraph().edgeData},getCategoriesData:function(){return this._categoriesData},formatTooltip:function(dataIndex,multipleSeries,dataType){if("edge"===dataType){var nodeData=this.getData(),params=this.getDataParams(dataIndex,dataType),edge=nodeData.graph.getEdgeByIndex(dataIndex),sourceName=nodeData.getName(edge.node1.dataIndex),targetName=nodeData.getName(edge.node2.dataIndex),html=[];return null!=sourceName&amp;&amp;html.push(sourceName),null!=targetName&amp;&amp;html.push(targetName),html=encodeHTML(html.join(" &gt; ")),params.value&amp;&amp;(html+=" : "+encodeHTML(params.value)),html}return GraphSeries.superApply(this,"formatTooltip",arguments)},_updateCategoriesData:function(){var categories=(this.option.categories||[]).map(function(category){return null!=category.value?category:Object.assign({value:0},category)}),categoriesData=new SeriesData(["value"],this);categoriesData.initData(categories),this._categoriesData=categoriesData,this._categoriesModels=categoriesData.mapArray(function(idx){return categoriesData.getItemModel(idx,!0)})},setView:function(payload){null!=payload.zoom&amp;&amp;(this.option.zoom=payload.zoom),null!=payload.offset&amp;&amp;(this.option.offset=payload.offset)},setNodePosition:function(points){for(var i=0;i&lt;points.length/2;i++){var x=points[2*i],y=points[2*i+1],opt=this.getData().getRawDataItem(i);opt.x=x,opt.y=y}},isAnimationEnabled:function(){return GraphSeries.superCall(this,"isAnimationEnabled")&amp;&amp;!("force"===this.get("layout")&amp;&amp;this.get("force.layoutAnimation"))},defaultOption:{zlevel:10,z:2,legendHoverLink:!0,layout:"forceAtlas2",forceAtlas2:{initLayout:null,GPU:!0,steps:1,maxSteps:1e3,repulsionByDegree:!0,linLogMode:!1,strongGravityMode:!1,gravity:1,edgeWeightInfluence:1,edgeWeight:[1,4],nodeWeight:[1,4],preventOverlap:!1,gravityCenter:null},focusNodeAdjacency:!0,focusNodeAdjacencyOn:"mouseover",left:"center",top:"center",symbol:"circle",symbolSize:5,roam:!1,center:null,zoom:1,label:{show:!1,formatter:"{b}",position:"right",distance:5,textStyle:{fontSize:14}},itemStyle:{},lineStyle:{color:"#aaa",width:1,opacity:.5},emphasis:{label:{show:!0}},animation:!1}}),vec2$1=glmatrix.vec2,sampleLinePoints=[[0,0],[1,1]],LinesGeometry$1=Geometry.extend(function(){return{segmentScale:4,dynamic:!0,useNativeLine:!0,attributes:{position:new Geometry.Attribute("position","float",2,"POSITION"),normal:new Geometry.Attribute("normal","float",2),offset:new Geometry.Attribute("offset","float",1),color:new Geometry.Attribute("color","float",4,"COLOR")}}},{resetOffset:function(){this._vertexOffset=0,this._faceOffset=0,this._itemVertexOffsets=[]},setVertexCount:function(nVertex){var attributes=this.attributes;this.vertexCount!==nVertex&amp;&amp;(attributes.position.init(nVertex),attributes.color.init(nVertex),this.useNativeLine||(attributes.offset.init(nVertex),attributes.normal.init(nVertex)),nVertex&gt;65535?this.indices instanceof Uint16Array&amp;&amp;(this.indices=new Uint32Array(this.indices)):this.indices instanceof Uint32Array&amp;&amp;(this.indices=new Uint16Array(this.indices)))},setTriangleCount:function(nTriangle){this.triangleCount!==nTriangle&amp;&amp;(this.indices=0===nTriangle?null:this.vertexCount&gt;65535?new Uint32Array(3*nTriangle):new Uint16Array(3*nTriangle))},_getCubicCurveApproxStep:function(p02,p12,p22,p3){return 1/(vec2$1.dist(p02,p12)+vec2$1.dist(p22,p12)+vec2$1.dist(p3,p22)+1)*this.segmentScale},getCubicCurveVertexCount:function(p02,p12,p22,p3){var step=this._getCubicCurveApproxStep(p02,p12,p22,p3),segCount=Math.ceil(1/step);return this.useNativeLine?2*segCount:2*segCount+2},getCubicCurveTriangleCount:function(p02,p12,p22,p3){var step=this._getCubicCurveApproxStep(p02,p12,p22,p3),segCount=Math.ceil(1/step);return this.useNativeLine?0:2*segCount},getLineVertexCount:function(){return this.getPolylineVertexCount(sampleLinePoints)},getLineTriangleCount:function(){return this.getPolylineTriangleCount(sampleLinePoints)},getPolylineVertexCount:function(points){var pointsLen;"number"==typeof points?pointsLen=points:pointsLen="number"!=typeof points[0]?points.length:points.length/2;return this.useNativeLine?2*(pointsLen-1):2*(pointsLen-1)+2},getPolylineTriangleCount:function(points){var pointsLen;"number"==typeof points?pointsLen=points:pointsLen="number"!=typeof points[0]?points.length:points.length/2;return this.useNativeLine?0:2*(pointsLen-1)},addCubicCurve:function(p02,p12,p22,p3,color,lineWidth){null==lineWidth&amp;&amp;(lineWidth=1);var x0=p02[0],y0=p02[1],x1=p12[0],y1=p12[1],x2=p22[0],y2=p22[1],x3=p3[0],y3=p3[1],step=this._getCubicCurveApproxStep(p02,p12,p22,p3),step2=step*step,step3=step2*step,pre1=3*step,pre2=3*step2,pre4=6*step2,pre5=6*step3,tmp1x=x0-2*x1+x2,tmp1y=y0-2*y1+y2,tmp2x=3*(x1-x2)-x0+x3,tmp2y=3*(y1-y2)-y0+y3,fx=x0,fy=y0,dfx=(x1-x0)*pre1+tmp1x*pre2+tmp2x*step3,dfy=(y1-y0)*pre1+tmp1y*pre2+tmp2y*step3,ddfx=tmp1x*pre4+tmp2x*pre5,ddfy=tmp1y*pre4+tmp2y*pre5,dddfx=tmp2x*pre5,dddfy=tmp2y*pre5,t=0,k=0,segCount=Math.ceil(1/step),points=new Float32Array(3*(segCount+1)),offset=(points=[],0);for(k=0;k&lt;segCount+1;k++)points[offset++]=fx,points[offset++]=fy,fx+=dfx,fy+=dfy,dfx+=ddfx,dfy+=ddfy,ddfx+=dddfx,ddfy+=dddfy,(t+=step)&gt;1&amp;&amp;(fx=dfx&gt;0?Math.min(fx,x3):Math.max(fx,x3),fy=dfy&gt;0?Math.min(fy,y3):Math.max(fy,y3));this.addPolyline(points,color,lineWidth)},addLine:function(p02,p12,color,lineWidth){this.addPolyline([p02,p12],color,lineWidth)},addPolyline:function(){var dirA=vec2$1.create(),dirB=vec2$1.create(),normal2=vec2$1.create(),tangent2=vec2$1.create(),point=[],nextPoint=[],prevPoint=[];return function(points,color,lineWidth,arrayOffset,pointsCount){if(points.length){var is2DArray="number"!=typeof points[0];if(null==pointsCount&amp;&amp;(pointsCount=is2DArray?points.length:points.length/2),!(pointsCount&lt;2)){null==arrayOffset&amp;&amp;(arrayOffset=0),null==lineWidth&amp;&amp;(lineWidth=1),this._itemVertexOffsets.push(this._vertexOffset);for(var pointColor,notSharingColor=is2DArray?"number"!=typeof color[0]:color.length/4===pointsCount,positionAttr=this.attributes.position,colorAttr=this.attributes.color,offsetAttr=this.attributes.offset,normalAttr=this.attributes.normal,indices=this.indices,vertexOffset=this._vertexOffset,k=0;k&lt;pointsCount;k++){if(is2DArray)point=points[k+arrayOffset],pointColor=notSharingColor?color[k+arrayOffset]:color;else{var k2=2*k+arrayOffset;if((point=point||[])[0]=points[k2],point[1]=points[k2+1],notSharingColor){var k4=4*k+arrayOffset;(pointColor=pointColor||[])[0]=color[k4],pointColor[1]=color[k4+1],pointColor[2]=color[k4+2],pointColor[3]=color[k4+3]}else pointColor=color}if(this.useNativeLine)k&gt;1&amp;&amp;(positionAttr.copy(vertexOffset,vertexOffset-1),colorAttr.copy(vertexOffset,vertexOffset-1),vertexOffset++);else{var offset;if(k&lt;pointsCount-1){if(is2DArray)vec2$1.copy(nextPoint,points[k+1]);else{k2=2*(k+1)+arrayOffset;(nextPoint=nextPoint||[])[0]=points[k2],nextPoint[1]=points[k2+1]}if(k&gt;0){vec2$1.sub(dirA,point,prevPoint),vec2$1.sub(dirB,nextPoint,point),vec2$1.normalize(dirA,dirA),vec2$1.normalize(dirB,dirB),vec2$1.add(tangent2,dirA,dirB),vec2$1.normalize(tangent2,tangent2);var miter=lineWidth/2*Math.min(1/vec2$1.dot(dirA,tangent2),2);normal2[0]=-tangent2[1],normal2[1]=tangent2[0],offset=miter}else vec2$1.sub(dirA,nextPoint,point),vec2$1.normalize(dirA,dirA),normal2[0]=-dirA[1],normal2[1]=dirA[0],offset=lineWidth/2}else vec2$1.sub(dirA,point,prevPoint),vec2$1.normalize(dirA,dirA),normal2[0]=-dirA[1],normal2[1]=dirA[0],offset=lineWidth/2;normalAttr.set(vertexOffset,normal2),normalAttr.set(vertexOffset+1,normal2),offsetAttr.set(vertexOffset,offset),offsetAttr.set(vertexOffset+1,-offset),vec2$1.copy(prevPoint,point),positionAttr.set(vertexOffset,point),positionAttr.set(vertexOffset+1,point),colorAttr.set(vertexOffset,pointColor),colorAttr.set(vertexOffset+1,pointColor),vertexOffset+=2}if(this.useNativeLine)colorAttr.set(vertexOffset,pointColor),positionAttr.set(vertexOffset,point),vertexOffset++;else if(k&gt;0){var idx3=3*this._faceOffset;(indices=this.indices)[idx3]=vertexOffset-4,indices[idx3+1]=vertexOffset-3,indices[idx3+2]=vertexOffset-2,indices[idx3+3]=vertexOffset-3,indices[idx3+4]=vertexOffset-1,indices[idx3+5]=vertexOffset-2,this._faceOffset+=2}}this._vertexOffset=vertexOffset}}}}(),setItemColor:function(idx,color){for(var startOffset=this._itemVertexOffsets[idx],endOffset=idx&lt;this._itemVertexOffsets.length-1?this._itemVertexOffsets[idx+1]:this._vertexOffset,i=startOffset;i&lt;endOffset;i++)this.attributes.color.set(i,color);this.dirty("color")}});defaults(LinesGeometry$1.prototype,dynamicConvertMixin);graphicGL.Shader.import("@export ecgl.forceAtlas2.updateNodeRepulsion\n\n#define NODE_COUNT 0\n\nuniform sampler2D positionTex;\n\nuniform vec2 textureSize;\nuniform float gravity;\nuniform float scaling;\nuniform vec2 gravityCenter;\n\nuniform bool strongGravityMode;\nuniform bool preventOverlap;\n\nvarying vec2 v_Texcoord;\n\nvoid main() {\n\n vec4 n0 = texture2D(positionTex, v_Texcoord);\n\n vec2 force = vec2(0.0);\n for (int i = 0; i &lt; NODE_COUNT; i++) {\n vec2 uv = vec2(\n mod(float(i), textureSize.x) / (textureSize.x - 1.0),\n floor(float(i) / textureSize.x) / (textureSize.y - 1.0)\n );\n vec4 n1 = texture2D(positionTex, uv);\n\n vec2 dir = n0.xy - n1.xy;\n float d2 = dot(dir, dir);\n\n if (d2 &gt; 0.0) {\n float factor = 0.0;\n if (preventOverlap) {\n float d = sqrt(d2);\n d = d - n0.w - n1.w;\n if (d &gt; 0.0) {\n factor = scaling * n0.z * n1.z / (d * d);\n }\n else if (d &lt; 0.0) {\n factor = scaling * 100.0 * n0.z * n1.z;\n }\n }\n else {\n factor = scaling * n0.z * n1.z / d2;\n }\n force += dir * factor;\n }\n }\n\n vec2 dir = gravityCenter - n0.xy;\n float d = 1.0;\n if (!strongGravityMode) {\n d = length(dir);\n }\n\n force += dir * n0.z * gravity / (d + 1.0);\n\n gl_FragColor = vec4(force, 0.0, 1.0);\n}\n@end\n\n@export ecgl.forceAtlas2.updateEdgeAttraction.vertex\n\nattribute vec2 node1;\nattribute vec2 node2;\nattribute float weight;\n\nuniform sampler2D positionTex;\nuniform float edgeWeightInfluence;\nuniform bool preventOverlap;\nuniform bool linLogMode;\n\nuniform vec2 windowSize: WINDOW_SIZE;\n\nvarying vec2 v_Force;\n\nvoid main() {\n\n vec4 n0 = texture2D(positionTex, node1);\n vec4 n1 = texture2D(positionTex, node2);\n\n vec2 dir = n1.xy - n0.xy;\n float d = length(dir);\n float w;\n if (edgeWeightInfluence == 0.0) {\n w = 1.0;\n }\n else if (edgeWeightInfluence == 1.0) {\n w = weight;\n }\n else {\n w = pow(weight, edgeWeightInfluence);\n }\n vec2 offset = vec2(1.0 / windowSize.x, 1.0 / windowSize.y);\n vec2 scale = vec2((windowSize.x - 1.0) / windowSize.x, (windowSize.y - 1.0) / windowSize.y);\n vec2 pos = node1 * scale * 2.0 - 1.0;\n gl_Position = vec4(pos + offset, 0.0, 1.0);\n gl_PointSize = 1.0;\n\n float factor;\n if (preventOverlap) {\n d = d - n1.w - n0.w;\n }\n if (d &lt;= 0.0) {\n v_Force = vec2(0.0);\n return;\n }\n\n if (linLogMode) {\n factor = w * log(d) / d;\n }\n else {\n factor = w;\n }\n v_Force = dir * factor;\n}\n@end\n\n@export ecgl.forceAtlas2.updateEdgeAttraction.fragment\n\nvarying vec2 v_Force;\n\nvoid main() {\n gl_FragColor = vec4(v_Force, 0.0, 0.0);\n}\n@end\n\n@export ecgl.forceAtlas2.calcWeightedSum.vertex\n\nattribute vec2 node;\n\nvarying vec2 v_NodeUv;\n\nvoid main() {\n\n v_NodeUv = node;\n gl_Position = vec4(0.0, 0.0, 0.0, 1.0);\n gl_PointSize = 1.0;\n}\n@end\n\n@export ecgl.forceAtlas2.calcWeightedSum.fragment\n\nvarying vec2 v_NodeUv;\n\nuniform sampler2D positionTex;\nuniform sampler2D forceTex;\nuniform sampler2D forcePrevTex;\n\nvoid main() {\n vec2 force = texture2D(forceTex, v_NodeUv).rg;\n vec2 forcePrev = texture2D(forcePrevTex, v_NodeUv).rg;\n\n float mass = texture2D(positionTex, v_NodeUv).z;\n float swing = length(force - forcePrev) * mass;\n float traction = length(force + forcePrev) * 0.5 * mass;\n\n gl_FragColor = vec4(swing, traction, 0.0, 0.0);\n}\n@end\n\n@export ecgl.forceAtlas2.calcGlobalSpeed\n\nuniform sampler2D globalSpeedPrevTex;\nuniform sampler2D weightedSumTex;\nuniform float jitterTolerence;\n\nvoid main() {\n vec2 weightedSum = texture2D(weightedSumTex, vec2(0.5)).xy;\n float prevGlobalSpeed = texture2D(globalSpeedPrevTex, vec2(0.5)).x;\n float globalSpeed = jitterTolerence * jitterTolerence\n * weightedSum.y / weightedSum.x;\n if (prevGlobalSpeed &gt; 0.0) {\n globalSpeed = min(globalSpeed / prevGlobalSpeed, 1.5) * prevGlobalSpeed;\n }\n gl_FragColor = vec4(globalSpeed, 0.0, 0.0, 1.0);\n}\n@end\n\n@export ecgl.forceAtlas2.updatePosition\n\nuniform sampler2D forceTex;\nuniform sampler2D forcePrevTex;\nuniform sampler2D positionTex;\nuniform sampler2D globalSpeedTex;\n\nvarying vec2 v_Texcoord;\n\nvoid main() {\n vec2 force = texture2D(forceTex, v_Texcoord).xy;\n vec2 forcePrev = texture2D(forcePrevTex, v_Texcoord).xy;\n vec4 node = texture2D(positionTex, v_Texcoord);\n\n float globalSpeed = texture2D(globalSpeedTex, vec2(0.5)).r;\n float swing = length(force - forcePrev);\n float speed = 0.1 * globalSpeed / (0.1 + globalSpeed * sqrt(swing));\n\n float df = length(force);\n if (df &gt; 0.0) {\n speed = min(df * speed, 10.0) / df;\n\n gl_FragColor = vec4(node.xy + speed * force, node.zw);\n }\n else {\n gl_FragColor = node;\n }\n}\n@end\n\n@export ecgl.forceAtlas2.edges.vertex\nuniform mat4 worldViewProjection : WORLDVIEWPROJECTION;\n\nattribute vec2 node;\nattribute vec4 a_Color : COLOR;\nvarying vec4 v_Color;\n\nuniform sampler2D positionTex;\n\nvoid main()\n{\n gl_Position = worldViewProjection * vec4(\n texture2D(positionTex, node).xy, -10.0, 1.0\n );\n v_Color = a_Color;\n}\n@end\n\n@export ecgl.forceAtlas2.edges.fragment\nuniform vec4 color : [1.0, 1.0, 1.0, 1.0];\nvarying vec4 v_Color;\nvoid main() {\n gl_FragColor = color * v_Color;\n}\n@end");var defaultConfigs$1={repulsionByDegree:!0,linLogMode:!1,strongGravityMode:!1,gravity:1,scaling:1,edgeWeightInfluence:1,jitterTolerence:.1,preventOverlap:!1,dissuadeHubs:!1,gravityCenter:null};function ForceAtlas2GPU(options){var textureOpt={type:graphicGL.Texture.FLOAT,minFilter:graphicGL.Texture.NEAREST,magFilter:graphicGL.Texture.NEAREST};this._positionSourceTex=new graphicGL.Texture2D(textureOpt),this._positionSourceTex.flipY=!1,this._positionTex=new graphicGL.Texture2D(textureOpt),this._positionPrevTex=new graphicGL.Texture2D(textureOpt),this._forceTex=new graphicGL.Texture2D(textureOpt),this._forcePrevTex=new graphicGL.Texture2D(textureOpt),this._weightedSumTex=new graphicGL.Texture2D(textureOpt),this._weightedSumTex.width=this._weightedSumTex.height=1,this._globalSpeedTex=new graphicGL.Texture2D(textureOpt),this._globalSpeedPrevTex=new graphicGL.Texture2D(textureOpt),this._globalSpeedTex.width=this._globalSpeedTex.height=1,this._globalSpeedPrevTex.width=this._globalSpeedPrevTex.height=1,this._nodeRepulsionPass=new Pass({fragment:graphicGL.Shader.source("ecgl.forceAtlas2.updateNodeRepulsion")}),this._positionPass=new Pass({fragment:graphicGL.Shader.source("ecgl.forceAtlas2.updatePosition")}),this._globalSpeedPass=new Pass({fragment:graphicGL.Shader.source("ecgl.forceAtlas2.calcGlobalSpeed")}),this._copyPass=new Pass({fragment:graphicGL.Shader.source("clay.compositor.output")});var additiveBlend=function(gl){gl.blendEquation(gl.FUNC_ADD),gl.blendFunc(gl.ONE,gl.ONE)};this._edgeForceMesh=new graphicGL.Mesh({geometry:new graphicGL.Geometry({attributes:{node1:new graphicGL.Geometry.Attribute("node1","float",2),node2:new graphicGL.Geometry.Attribute("node2","float",2),weight:new graphicGL.Geometry.Attribute("weight","float",1)},dynamic:!0,mainAttribute:"node1"}),material:new graphicGL.Material({transparent:!0,shader:graphicGL.createShader("ecgl.forceAtlas2.updateEdgeAttraction"),blend:additiveBlend,depthMask:!1,depthText:!1}),mode:graphicGL.Mesh.POINTS}),this._weightedSumMesh=new graphicGL.Mesh({geometry:new graphicGL.Geometry({attributes:{node:new graphicGL.Geometry.Attribute("node","float",2)},dynamic:!0,mainAttribute:"node"}),material:new graphicGL.Material({transparent:!0,shader:graphicGL.createShader("ecgl.forceAtlas2.calcWeightedSum"),blend:additiveBlend,depthMask:!1,depthText:!1}),mode:graphicGL.Mesh.POINTS}),this._framebuffer=new FrameBuffer({depthBuffer:!1}),this._dummyCamera=new graphicGL.OrthographicCamera({left:-1,right:1,top:1,bottom:-1,near:0,far:100}),this._globalSpeed=0}ForceAtlas2GPU.prototype.updateOption=function(options){for(var name in defaultConfigs$1)this[name]=defaultConfigs$1[name];var nNodes=this._nodes.length;if(this.jitterTolerence=nNodes&gt;5e4?10:nNodes&gt;5e3?1:.1,this.scaling=nNodes&gt;100?2:10,options)for(var name in defaultConfigs$1)null!=options[name]&amp;&amp;(this[name]=options[name]);if(this.repulsionByDegree)for(var positionBuffer=this._positionSourceTex.pixels,i=0;i&lt;this._nodes.length;i++)positionBuffer[4*i+2]=(this._nodes[i].degree||0)+1},ForceAtlas2GPU.prototype._updateGravityCenter=function(options){var nodes=this._nodes,edges=this._edges;if(this.gravityCenter)this._gravityCenter=this.gravityCenter;else{for(var min=[1/0,1/0],max=[-1/0,-1/0],i=0;i&lt;nodes.length;i++)min[0]=Math.min(nodes[i].x,min[0]),min[1]=Math.min(nodes[i].y,min[1]),max[0]=Math.max(nodes[i].x,max[0]),max[1]=Math.max(nodes[i].y,max[1]);this._gravityCenter=[.5*(min[0]+max[0]),.5*(min[1]+max[1])]}for(i=0;i&lt;edges.length;i++){var node1=edges[i].node1,node2=edges[i].node2;nodes[node1].degree=(nodes[node1].degree||0)+1,nodes[node2].degree=(nodes[node2].degree||0)+1}},ForceAtlas2GPU.prototype.initData=function(nodes,edges){this._nodes=nodes,this._edges=edges,this._updateGravityCenter();var textureWidth=Math.ceil(Math.sqrt(nodes.length)),textureHeight=textureWidth,positionBuffer=new Float32Array(textureWidth*textureHeight*4);this._resize(textureWidth,textureHeight);for(var offset=0,i=0;i&lt;nodes.length;i++){var node=nodes[i];positionBuffer[offset++]=node.x||0,positionBuffer[offset++]=node.y||0,positionBuffer[offset++]=node.mass||1,positionBuffer[offset++]=node.size||1}this._positionSourceTex.pixels=positionBuffer;var edgeGeometry=this._edgeForceMesh.geometry,edgeLen=edges.length;edgeGeometry.attributes.node1.init(2*edgeLen),edgeGeometry.attributes.node2.init(2*edgeLen),edgeGeometry.attributes.weight.init(2*edgeLen);var uv=[];for(i=0;i&lt;edges.length;i++){var attributes=edgeGeometry.attributes,weight=edges[i].weight;null==weight&amp;&amp;(weight=1),attributes.node1.set(i,this.getNodeUV(edges[i].node1,uv)),attributes.node2.set(i,this.getNodeUV(edges[i].node2,uv)),attributes.weight.set(i,weight),attributes.node1.set(i+edgeLen,this.getNodeUV(edges[i].node2,uv)),attributes.node2.set(i+edgeLen,this.getNodeUV(edges[i].node1,uv)),attributes.weight.set(i+edgeLen,weight)}var weigtedSumGeo=this._weightedSumMesh.geometry;weigtedSumGeo.attributes.node.init(nodes.length);for(i=0;i&lt;nodes.length;i++)weigtedSumGeo.attributes.node.set(i,this.getNodeUV(i,uv));edgeGeometry.dirty(),weigtedSumGeo.dirty(),this._nodeRepulsionPass.material.define("fragment","NODE_COUNT",nodes.length),this._nodeRepulsionPass.material.setUniform("textureSize",[textureWidth,textureHeight]),this._inited=!1,this._frame=0},ForceAtlas2GPU.prototype.getNodes=function(){return this._nodes},ForceAtlas2GPU.prototype.getEdges=function(){return this._edges},ForceAtlas2GPU.prototype.step=function(renderer){this._inited||(this._initFromSource(renderer),this._inited=!0),this._frame++,this._framebuffer.attach(this._forceTex),this._framebuffer.bind(renderer);var nodeRepulsionPass=this._nodeRepulsionPass;nodeRepulsionPass.setUniform("strongGravityMode",this.strongGravityMode),nodeRepulsionPass.setUniform("gravity",this.gravity),nodeRepulsionPass.setUniform("gravityCenter",this._gravityCenter),nodeRepulsionPass.setUniform("scaling",this.scaling),nodeRepulsionPass.setUniform("preventOverlap",this.preventOverlap),nodeRepulsionPass.setUniform("positionTex",this._positionPrevTex),nodeRepulsionPass.render(renderer);var edgeForceMesh=this._edgeForceMesh;edgeForceMesh.material.set("linLogMode",this.linLogMode),edgeForceMesh.material.set("edgeWeightInfluence",this.edgeWeightInfluence),edgeForceMesh.material.set("preventOverlap",this.preventOverlap),edgeForceMesh.material.set("positionTex",this._positionPrevTex),renderer.gl.enable(renderer.gl.BLEND),renderer.renderPass([edgeForceMesh],this._dummyCamera),this._framebuffer.attach(this._weightedSumTex),renderer.gl.clearColor(0,0,0,0),renderer.gl.clear(renderer.gl.COLOR_BUFFER_BIT),renderer.gl.enable(renderer.gl.BLEND);var weightedSumMesh=this._weightedSumMesh;weightedSumMesh.material.set("positionTex",this._positionPrevTex),weightedSumMesh.material.set("forceTex",this._forceTex),weightedSumMesh.material.set("forcePrevTex",this._forcePrevTex),renderer.renderPass([weightedSumMesh],this._dummyCamera),this._framebuffer.attach(this._globalSpeedTex);var globalSpeedPass=this._globalSpeedPass;globalSpeedPass.setUniform("globalSpeedPrevTex",this._globalSpeedPrevTex),globalSpeedPass.setUniform("weightedSumTex",this._weightedSumTex),globalSpeedPass.setUniform("jitterTolerence",this.jitterTolerence),renderer.gl.disable(renderer.gl.BLEND),globalSpeedPass.render(renderer);var positionPass=this._positionPass;this._framebuffer.attach(this._positionTex),positionPass.setUniform("globalSpeedTex",this._globalSpeedTex),positionPass.setUniform("positionTex",this._positionPrevTex),positionPass.setUniform("forceTex",this._forceTex),positionPass.setUniform("forcePrevTex",this._forcePrevTex),positionPass.render(renderer),this._framebuffer.unbind(renderer),this._swapTexture()},ForceAtlas2GPU.prototype.update=function(renderer,steps,cb){null==steps&amp;&amp;(steps=1),steps=Math.max(steps,1);for(var i=0;i&lt;steps;i++)this.step(renderer);cb&amp;&amp;cb()},ForceAtlas2GPU.prototype.getNodePositionTexture=function(){return this._inited?this._positionPrevTex:this._positionSourceTex},ForceAtlas2GPU.prototype.getNodeUV=function(nodeIndex,uv){uv=uv||[];var textureWidth=this._positionTex.width,textureHeight=this._positionTex.height;return uv[0]=nodeIndex%textureWidth/(textureWidth-1),uv[1]=Math.floor(nodeIndex/textureWidth)/(textureHeight-1)||0,uv},ForceAtlas2GPU.prototype.getNodePosition=function(renderer,out){var positionArr=this._positionArr,width=this._positionTex.width,height=this._positionTex.height,size=width*height;positionArr&amp;&amp;positionArr.length===4*size||(positionArr=this._positionArr=new Float32Array(4*size)),this._framebuffer.bind(renderer),this._framebuffer.attach(this._positionPrevTex),renderer.gl.readPixels(0,0,width,height,renderer.gl.RGBA,renderer.gl.FLOAT,positionArr),this._framebuffer.unbind(renderer),out||(out=new Float32Array(2*this._nodes.length));for(var i=0;i&lt;this._nodes.length;i++)out[2*i]=positionArr[4*i],out[2*i+1]=positionArr[4*i+1];return out},ForceAtlas2GPU.prototype.getTextureData=function(renderer,textureName){var tex=this["_"+textureName+"Tex"],width=tex.width,height=tex.height;this._framebuffer.bind(renderer),this._framebuffer.attach(tex);var arr=new Float32Array(width*height*4);return renderer.gl.readPixels(0,0,width,height,renderer.gl.RGBA,renderer.gl.FLOAT,arr),this._framebuffer.unbind(renderer),arr},ForceAtlas2GPU.prototype.getTextureSize=function(){return{width:this._positionTex.width,height:this._positionTex.height}},ForceAtlas2GPU.prototype.isFinished=function(maxSteps){return this._frame&gt;maxSteps},ForceAtlas2GPU.prototype._swapTexture=function(){var tmp=this._positionPrevTex;this._positionPrevTex=this._positionTex,this._positionTex=tmp;tmp=this._forcePrevTex;this._forcePrevTex=this._forceTex,this._forceTex=tmp;tmp=this._globalSpeedPrevTex;this._globalSpeedPrevTex=this._globalSpeedTex,this._globalSpeedTex=tmp},ForceAtlas2GPU.prototype._initFromSource=function(renderer){this._framebuffer.attach(this._positionPrevTex),this._framebuffer.bind(renderer),this._copyPass.setUniform("texture",this._positionSourceTex),this._copyPass.render(renderer),renderer.gl.clearColor(0,0,0,0),this._framebuffer.attach(this._forcePrevTex),renderer.gl.clear(renderer.gl.COLOR_BUFFER_BIT),this._framebuffer.attach(this._globalSpeedPrevTex),renderer.gl.clear(renderer.gl.COLOR_BUFFER_BIT),this._framebuffer.unbind(renderer)},ForceAtlas2GPU.prototype._resize=function(width,height){["_positionSourceTex","_positionTex","_positionPrevTex","_forceTex","_forcePrevTex"].forEach(function(texName){this[texName].width=width,this[texName].height=height,this[texName].dirty()},this)},ForceAtlas2GPU.prototype.dispose=function(renderer){this._framebuffer.dispose(renderer),this._copyPass.dispose(renderer),this._nodeRepulsionPass.dispose(renderer),this._positionPass.dispose(renderer),this._globalSpeedPass.dispose(renderer),this._edgeForceMesh.geometry.dispose(renderer),this._weightedSumMesh.geometry.dispose(renderer),this._positionSourceTex.dispose(renderer),this._positionTex.dispose(renderer),this._positionPrevTex.dispose(renderer),this._forceTex.dispose(renderer),this._forcePrevTex.dispose(renderer),this._weightedSumTex.dispose(renderer),this._globalSpeedTex.dispose(renderer),this._globalSpeedPrevTex.dispose(renderer)};var workerUrl=function forceAtlas2Worker(){var vec22_create=function(){return new Float32Array(2)},vec22_dist=function(a,b){var x=b[0]-a[0],y=b[1]-a[1];return Math.sqrt(x*x+y*y)},vec22_len=function(a){var x=a[0],y=a[1];return Math.sqrt(x*x+y*y)},vec22_scaleAndAdd=function(out,a,b,scale){return out[0]=a[0]+b[0]*scale,out[1]=a[1]+b[1]*scale,out},vec22_add=function(out,a,b){return out[0]=a[0]+b[0],out[1]=a[1]+b[1],out},vec22_sub=function(out,a,b){return out[0]=a[0]-b[0],out[1]=a[1]-b[1],out},vec22_copy=function(out,a){return out[0]=a[0],out[1]=a[1],out},vec22_set=function(out,x,y){return out[0]=x,out[1]=y,out};function Region(){this.subRegions=[],this.nSubRegions=0,this.node=null,this.mass=0,this.centerOfMass=null,this.bbox=new Float32Array(4),this.size=0}var regionProto=Region.prototype;function GraphNode(){this.position=new Float32Array(2),this.force=vec22_create(),this.forcePrev=vec22_create(),this.mass=1,this.inDegree=0,this.outDegree=0}function GraphEdge(source,target){this.source=source,this.target=target,this.weight=1}function ForceAtlas22(){this.autoSettings=!0,this.barnesHutOptimize=!0,this.barnesHutTheta=1.5,this.repulsionByDegree=!0,this.linLogMode=!1,this.strongGravityMode=!1,this.gravity=1,this.scaling=1,this.edgeWeightInfluence=1,this.jitterTolerence=.1,this.preventOverlap=!1,this.dissuadeHubs=!1,this.rootRegion=new Region,this.rootRegion.centerOfMass=vec22_create(),this.nodes=[],this.edges=[],this.bbox=new Float32Array(4),this.gravityCenter=null,this._massArr=null,this._swingingArr=null,this._sizeArr=null,this._globalSpeed=0}regionProto.beforeUpdate=function(){for(var i=0;i&lt;this.nSubRegions;i++)this.subRegions[i].beforeUpdate();this.mass=0,this.centerOfMass&amp;&amp;(this.centerOfMass[0]=0,this.centerOfMass[1]=0),this.nSubRegions=0,this.node=null},regionProto.afterUpdate=function(){this.subRegions.length=this.nSubRegions;for(var i=0;i&lt;this.nSubRegions;i++)this.subRegions[i].afterUpdate()},regionProto.addNode=function(node){if(0===this.nSubRegions){if(null==this.node)return void(this.node=node);this._addNodeToSubRegion(this.node),this.node=null}this._addNodeToSubRegion(node),this._updateCenterOfMass(node)},regionProto.findSubRegion=function(x,y){for(var i=0;i&lt;this.nSubRegions;i++){var region=this.subRegions[i];if(region.contain(x,y))return region}},regionProto.contain=function(x,y){return this.bbox[0]&lt;=x&amp;&amp;this.bbox[2]&gt;=x&amp;&amp;this.bbox[1]&lt;=y&amp;&amp;this.bbox[3]&gt;=y},regionProto.setBBox=function(minX,minY,maxX,maxY){this.bbox[0]=minX,this.bbox[1]=minY,this.bbox[2]=maxX,this.bbox[3]=maxY,this.size=(maxX-minX+maxY-minY)/2},regionProto._newSubRegion=function(){var subRegion=this.subRegions[this.nSubRegions];return subRegion||(subRegion=new Region,this.subRegions[this.nSubRegions]=subRegion),this.nSubRegions++,subRegion},regionProto._addNodeToSubRegion=function(node){var subRegion=this.findSubRegion(node.position[0],node.position[1]),bbox=this.bbox;if(!subRegion){var cx=(bbox[0]+bbox[2])/2,cy=(bbox[1]+bbox[3])/2,w=(bbox[2]-bbox[0])/2,h=(bbox[3]-bbox[1])/2,xi=node.position[0]&gt;=cx?1:0,yi=node.position[1]&gt;=cy?1:0;(subRegion=this._newSubRegion()).setBBox(xi*w+bbox[0],yi*h+bbox[1],(xi+1)*w+bbox[0],(yi+1)*h+bbox[1])}subRegion.addNode(node)},regionProto._updateCenterOfMass=function(node){null==this.centerOfMass&amp;&amp;(this.centerOfMass=new Float32Array(2));var x=this.centerOfMass[0]*this.mass,y=this.centerOfMass[1]*this.mass;x+=node.position[0]*node.mass,y+=node.position[1]*node.mass,this.mass+=node.mass,this.centerOfMass[0]=x/this.mass,this.centerOfMass[1]=y/this.mass};var v,forceAtlas2Proto=ForceAtlas22.prototype;forceAtlas2Proto.initNodes=function(positionArr,massArr,sizeArr){var nNodes=massArr.length;this.nodes.length=0;for(var haveSize=void 0!==sizeArr,i=0;i&lt;nNodes;i++){var node=new GraphNode;node.position[0]=positionArr[2*i],node.position[1]=positionArr[2*i+1],node.mass=massArr[i],haveSize&amp;&amp;(node.size=sizeArr[i]),this.nodes.push(node)}this._massArr=massArr,this._swingingArr=new Float32Array(nNodes),haveSize&amp;&amp;(this._sizeArr=sizeArr)},forceAtlas2Proto.initEdges=function(edgeArr,edgeWeightArr){var nEdges=edgeArr.length/2;this.edges.length=0;for(var i=0;i&lt;nEdges;i++){var sIdx=edgeArr[2*i],tIdx=edgeArr[2*i+1],sNode=this.nodes[sIdx],tNode=this.nodes[tIdx];if(!sNode||!tNode)return void console.error("Node not exists, try initNodes before initEdges");sNode.outDegree++,tNode.inDegree++;var edge=new GraphEdge(sNode,tNode);edgeWeightArr&amp;&amp;(edge.weight=edgeWeightArr[i]),this.edges.push(edge)}},forceAtlas2Proto.updateSettings=function(){if(this.repulsionByDegree)for(var i=0;i&lt;this.nodes.length;i++){(node=this.nodes[i]).mass=node.inDegree+node.outDegree+1}else for(i=0;i&lt;this.nodes.length;i++){var node;(node=this.nodes[i]).mass=this._massArr[i]}},forceAtlas2Proto.update=function(){var nNodes=this.nodes.length;if(this.updateSettings(),this.updateBBox(),this.barnesHutOptimize){this.rootRegion.setBBox(this.bbox[0],this.bbox[1],this.bbox[2],this.bbox[3]),this.rootRegion.beforeUpdate();for(var i=0;i&lt;nNodes;i++)this.rootRegion.addNode(this.nodes[i]);this.rootRegion.afterUpdate()}for(i=0;i&lt;nNodes;i++){var node=this.nodes[i];vec22_copy(node.forcePrev,node.force),vec22_set(node.force,0,0)}for(i=0;i&lt;nNodes;i++){var na=this.nodes[i];if(this.barnesHutOptimize)this.applyRegionToNodeRepulsion(this.rootRegion,na);else for(var j=i+1;j&lt;nNodes;j++){var nb=this.nodes[j];this.applyNodeToNodeRepulsion(na,nb,!1)}this.gravity&gt;0&amp;&amp;(this.strongGravityMode?this.applyNodeStrongGravity(na):this.applyNodeGravity(na))}for(i=0;i&lt;this.edges.length;i++)this.applyEdgeAttraction(this.edges[i]);var swingWeightedSum=0,tractionWeightedSum=0,tmp=vec22_create();for(i=0;i&lt;nNodes;i++){node=this.nodes[i];swingWeightedSum+=(swing=vec22_dist(node.force,node.forcePrev))*node.mass,vec22_add(tmp,node.force,node.forcePrev),tractionWeightedSum+=.5*vec22_len(tmp)*node.mass,this._swingingArr[i]=swing}var globalSpeed=this.jitterTolerence*this.jitterTolerence*tractionWeightedSum/swingWeightedSum;this._globalSpeed&gt;0&amp;&amp;(globalSpeed=Math.min(globalSpeed/this._globalSpeed,1.5)*this._globalSpeed),this._globalSpeed=globalSpeed;for(i=0;i&lt;nNodes;i++){node=this.nodes[i];var swing=this._swingingArr[i],speed=.1*globalSpeed/(1+globalSpeed*Math.sqrt(swing)),df=vec22_len(node.force);df&gt;0&amp;&amp;(speed=Math.min(df*speed,10)/df,vec22_scaleAndAdd(node.position,node.position,node.force,speed))}},forceAtlas2Proto.applyRegionToNodeRepulsion=(v=vec22_create(),function applyRegionToNodeRepulsion(region,node){if(region.node)this.applyNodeToNodeRepulsion(region.node,node,!0);else{vec22_sub(v,node.position,region.centerOfMass);var d2=v[0]*v[0]+v[1]*v[1];if(d2&gt;this.barnesHutTheta*region.size*region.size){var factor=this.scaling*node.mass*region.mass/d2;vec22_scaleAndAdd(node.force,node.force,v,factor)}else for(var i=0;i&lt;region.nSubRegions;i++)this.applyRegionToNodeRepulsion(region.subRegions[i],node)}}),forceAtlas2Proto.applyNodeToNodeRepulsion=function(){var v=vec22_create();return function applyNodeToNodeRepulsion(na,nb,oneWay){if(na!=nb){vec22_sub(v,na.position,nb.position);var d2=v[0]*v[0]+v[1]*v[1];if(0!==d2){var factor;if(this.preventOverlap){var d=Math.sqrt(d2);if((d=d-na.size-nb.size)&gt;0)factor=this.scaling*na.mass*nb.mass/(d*d);else{if(!(d&lt;0))return;factor=100*this.scaling*na.mass*nb.mass}}else factor=this.scaling*na.mass*nb.mass/d2;vec22_scaleAndAdd(na.force,na.force,v,factor),vec22_scaleAndAdd(nb.force,nb.force,v,-factor)}}}}(),forceAtlas2Proto.applyEdgeAttraction=function(){var v=vec22_create();return function applyEdgeAttraction(edge){var na=edge.source,nb=edge.target;vec22_sub(v,na.position,nb.position);var w,factor,d=vec22_len(v);w=0===this.edgeWeightInfluence?1:1===this.edgeWeightInfluence?edge.weight:Math.pow(edge.weight,this.edgeWeightInfluence),this.preventOverlap&amp;&amp;(d=d-na.size-nb.size)&lt;=0||(factor=this.linLogMode?-w*Math.log(d+1)/(d+1):-w,vec22_scaleAndAdd(na.force,na.force,v,factor),vec22_scaleAndAdd(nb.force,nb.force,v,-factor))}}(),forceAtlas2Proto.applyNodeGravity=function(){var v=vec22_create();return function(node){vec22_sub(v,this.gravityCenter,node.position);var d=vec22_len(v);vec22_scaleAndAdd(node.force,node.force,v,this.gravity*node.mass/(d+1))}}(),forceAtlas2Proto.applyNodeStrongGravity=function(){var v=vec22_create();return function(node){vec22_sub(v,this.gravityCenter,node.position),vec22_scaleAndAdd(node.force,node.force,v,this.gravity*node.mass)}}(),forceAtlas2Proto.updateBBox=function(){for(var minX=1/0,minY=1/0,maxX=-1/0,maxY=-1/0,i=0;i&lt;this.nodes.length;i++){var pos=this.nodes[i].position;minX=Math.min(minX,pos[0]),minY=Math.min(minY,pos[1]),maxX=Math.max(maxX,pos[0]),maxY=Math.max(maxY,pos[1])}this.bbox[0]=minX,this.bbox[1]=minY,this.bbox[2]=maxX,this.bbox[3]=maxY},forceAtlas2Proto.getGlobalSpeed=function(){return this._globalSpeed};var forceAtlas2=null;self.onmessage=function(e2){switch(e2.data.cmd){case"init":(forceAtlas2=new ForceAtlas22).initNodes(e2.data.nodesPosition,e2.data.nodesMass,e2.data.nodesSize),forceAtlas2.initEdges(e2.data.edges,e2.data.edgesWeight);break;case"updateConfig":if(forceAtlas2)for(var name in e2.data.config)forceAtlas2[name]=e2.data.config[name];break;case"update":var steps=e2.data.steps;if(forceAtlas2){for(var i=0;i&lt;steps;i++)forceAtlas2.update();var nNodes=forceAtlas2.nodes.length,positionArr=new Float32Array(2*nNodes);for(i=0;i&lt;nNodes;i++){var node=forceAtlas2.nodes[i];positionArr[2*i]=node.position[0],positionArr[2*i+1]=node.position[1]}self.postMessage({buffer:positionArr.buffer,globalSpeed:forceAtlas2.getGlobalSpeed()},[positionArr.buffer])}else{var emptyArr=new Float32Array;self.postMessage({buffer:emptyArr.buffer,globalSpeed:forceAtlas2.getGlobalSpeed()},[emptyArr.buffer])}}}}.toString();workerUrl=workerUrl.slice(workerUrl.indexOf("{")+1,workerUrl.lastIndexOf("}"));var defaultConfigs={barnesHutOptimize:!0,barnesHutTheta:1.5,repulsionByDegree:!0,linLogMode:!1,strongGravityMode:!1,gravity:1,scaling:1,edgeWeightInfluence:1,jitterTolerence:.1,preventOverlap:!1,dissuadeHubs:!1,gravityCenter:null},ForceAtlas2=function(options){for(var name in defaultConfigs)this[name]=defaultConfigs[name];if(options)for(var name in options)this[name]=options[name];this._nodes=[],this._edges=[],this._disposed=!1,this._positionTex=new Texture2D({type:Texture.FLOAT,flipY:!1,minFilter:Texture.NEAREST,magFilter:Texture.NEAREST})};ForceAtlas2.prototype.initData=function(nodes,edges){var bb=new Blob([workerUrl]),blobURL=window.URL.createObjectURL(bb);this._worker=new Worker(blobURL),this._worker.onmessage=this._$onupdate.bind(this),this._nodes=nodes,this._edges=edges,this._frame=0;for(var nNodes=nodes.length,nEdges=edges.length,positionArr=new Float32Array(2*nNodes),massArr=new Float32Array(nNodes),sizeArr=new Float32Array(nNodes),edgeArr=new Float32Array(2*nEdges),edgeWeightArr=new Float32Array(nEdges),i=0;i&lt;nodes.length;i++){var node=nodes[i];positionArr[2*i]=node.x,positionArr[2*i+1]=node.y,massArr[i]=null==node.mass?1:node.mass,sizeArr[i]=null==node.size?1:node.size}for(i=0;i&lt;edges.length;i++){var edge=edges[i],source=edge.node1,target=edge.node2;edgeArr[2*i]=source,edgeArr[2*i+1]=target,edgeWeightArr[i]=null==edge.weight?1:edge.weight}var textureWidth=Math.ceil(Math.sqrt(nodes.length)),textureHeight=textureWidth,pixels=new Float32Array(textureWidth*textureHeight*4),positionTex=this._positionTex;positionTex.width=textureWidth,positionTex.height=textureHeight,positionTex.pixels=pixels,this._worker.postMessage({cmd:"init",nodesPosition:positionArr,nodesMass:massArr,nodesSize:sizeArr,edges:edgeArr,edgesWeight:edgeWeightArr}),this._globalSpeed=1/0},ForceAtlas2.prototype.updateOption=function(options){var config={};for(var name in defaultConfigs)config[name]=defaultConfigs[name];var nodes=this._nodes,edges=this._edges,nNodes=nodes.length;if(config.jitterTolerence=nNodes&gt;5e4?10:nNodes&gt;5e3?1:.1,config.scaling=nNodes&gt;100?2:10,config.barnesHutOptimize=nNodes&gt;1e3,options)for(var name in defaultConfigs)null!=options[name]&amp;&amp;(config[name]=options[name]);if(!config.gravityCenter){for(var min=[1/0,1/0],max=[-1/0,-1/0],i=0;i&lt;nodes.length;i++)min[0]=Math.min(nodes[i].x,min[0]),min[1]=Math.min(nodes[i].y,min[1]),max[0]=Math.max(nodes[i].x,max[0]),max[1]=Math.max(nodes[i].y,max[1]);config.gravityCenter=[.5*(min[0]+max[0]),.5*(min[1]+max[1])]}for(i=0;i&lt;edges.length;i++){var node1=edges[i].node1,node2=edges[i].node2;nodes[node1].degree=(nodes[node1].degree||0)+1,nodes[node2].degree=(nodes[node2].degree||0)+1}this._worker&amp;&amp;this._worker.postMessage({cmd:"updateConfig",config:config})},ForceAtlas2.prototype.update=function(renderer,steps,cb){null==steps&amp;&amp;(steps=1),steps=Math.max(steps,1),this._frame+=steps,this._onupdate=cb,this._worker&amp;&amp;this._worker.postMessage({cmd:"update",steps:Math.round(steps)})},ForceAtlas2.prototype._$onupdate=function(e2){if(!this._disposed){var positionArr=new Float32Array(e2.data.buffer);this._globalSpeed=e2.data.globalSpeed,this._positionArr=positionArr,this._updateTexture(positionArr),this._onupdate&amp;&amp;this._onupdate()}},ForceAtlas2.prototype.getNodePositionTexture=function(){return this._positionTex},ForceAtlas2.prototype.getNodeUV=function(nodeIndex,uv){uv=uv||[];var textureWidth=this._positionTex.width,textureHeight=this._positionTex.height;return uv[0]=nodeIndex%textureWidth/(textureWidth-1),uv[1]=Math.floor(nodeIndex/textureWidth)/(textureHeight-1),uv},ForceAtlas2.prototype.getNodes=function(){return this._nodes},ForceAtlas2.prototype.getEdges=function(){return this._edges},ForceAtlas2.prototype.isFinished=function(maxSteps){return this._frame&gt;maxSteps},ForceAtlas2.prototype.getNodePosition=function(renderer,out){if(out||(out=new Float32Array(2*this._nodes.length)),this._positionArr)for(var i=0;i&lt;this._positionArr.length;i++)out[i]=this._positionArr[i];return out},ForceAtlas2.prototype._updateTexture=function(positionArr){for(var pixels=this._positionTex.pixels,offset=0,i=0;i&lt;positionArr.length;)pixels[offset++]=positionArr[i++],pixels[offset++]=positionArr[i++],pixels[offset++]=1,pixels[offset++]=1;this._positionTex.dirty()},ForceAtlas2.prototype.dispose=function(renderer){this._disposed=!0,this._worker=null};var Roam2DControl=Base.extend(function(){return{zr:null,viewGL:null,minZoom:.2,maxZoom:5,_needsUpdate:!1,_dx:0,_dy:0,_zoom:1}},function(){this._mouseDownHandler=this._mouseDownHandler.bind(this),this._mouseWheelHandler=this._mouseWheelHandler.bind(this),this._mouseMoveHandler=this._mouseMoveHandler.bind(this),this._mouseUpHandler=this._mouseUpHandler.bind(this),this._update=this._update.bind(this)},{init:function(){var zr=this.zr;zr.on("mousedown",this._mouseDownHandler),zr.on("mousewheel",this._mouseWheelHandler),zr.on("globalout",this._mouseUpHandler),zr.animation.on("frame",this._update)},setTarget:function(target){this._target=target},setZoom:function(zoom){this._zoom=Math.max(Math.min(zoom,this.maxZoom),this.minZoom),this._needsUpdate=!0},setOffset:function(offset){this._dx=offset[0],this._dy=offset[1],this._needsUpdate=!0},getZoom:function(){return this._zoom},getOffset:function(){return[this._dx,this._dy]},_update:function(){if(this._target&amp;&amp;this._needsUpdate){var target=this._target,scale=this._zoom;target.position.x=this._dx,target.position.y=this._dy,target.scale.set(scale,scale,scale),this.zr.refresh(),this._needsUpdate=!1,this.trigger("update")}},_mouseDownHandler:function(e2){if(!e2.target){var x=e2.offsetX,y=e2.offsetY;if(!this.viewGL||this.viewGL.containPoint(x,y)){this.zr.on("mousemove",this._mouseMoveHandler),this.zr.on("mouseup",this._mouseUpHandler);var pos=this._convertPos(x,y);this._x=pos.x,this._y=pos.y}}},_convertPos:function(x,y){var camera=this.viewGL.camera,viewport=this.viewGL.viewport;return{x:(x-viewport.x)/viewport.width*(camera.right-camera.left)+camera.left,y:(y-viewport.y)/viewport.height*(camera.bottom-camera.top)+camera.top}},_mouseMoveHandler:function(e2){var pos=this._convertPos(e2.offsetX,e2.offsetY);this._dx+=pos.x-this._x,this._dy+=pos.y-this._y,this._x=pos.x,this._y=pos.y,this._needsUpdate=!0},_mouseUpHandler:function(e2){this.zr.off("mousemove",this._mouseMoveHandler),this.zr.off("mouseup",this._mouseUpHandler)},_mouseWheelHandler:function(e2){var delta=(e2=e2.event).wheelDelta||-e2.detail;if(0!==delta){var x=e2.offsetX,y=e2.offsetY;if(!this.viewGL||this.viewGL.containPoint(x,y)){var zoomScale=delta&gt;0?1.1:.9,newZoom=Math.max(Math.min(this._zoom*zoomScale,this.maxZoom),this.minZoom);zoomScale=newZoom/this._zoom;var pos=this._convertPos(x,y),fixX=(pos.x-this._dx)*(zoomScale-1),fixY=(pos.y-this._dy)*(zoomScale-1);this._dx-=fixX,this._dy-=fixY,this._zoom=newZoom,this._needsUpdate=!0}}},dispose:function(){var zr=this.zr;zr.off("mousedown",this._mouseDownHandler),zr.off("mousemove",this._mouseMoveHandler),zr.off("mouseup",this._mouseUpHandler),zr.off("mousewheel",this._mouseWheelHandler),zr.off("globalout",this._mouseUpHandler),zr.animation.off("frame",this._update)}});var vec2=glmatrix.vec2;graphicGL.Shader.import("@export ecgl.lines2D.vertex\n\nuniform mat4 worldViewProjection : WORLDVIEWPROJECTION;\n\nattribute vec2 position: POSITION;\nattribute vec4 a_Color : COLOR;\nvarying vec4 v_Color;\n\n#ifdef POSITIONTEXTURE_ENABLED\nuniform sampler2D positionTexture;\n#endif\n\nvoid main()\n{\n gl_Position = worldViewProjection * vec4(position, -10.0, 1.0);\n\n v_Color = a_Color;\n}\n\n@end\n\n@export ecgl.lines2D.fragment\n\nuniform vec4 color : [1.0, 1.0, 1.0, 1.0];\n\nvarying vec4 v_Color;\n\nvoid main()\n{\n gl_FragColor = color * v_Color;\n}\n@end\n\n\n@export ecgl.meshLines2D.vertex\n\nattribute vec2 position: POSITION;\nattribute vec2 normal;\nattribute float offset;\nattribute vec4 a_Color : COLOR;\n\nuniform mat4 worldViewProjection : WORLDVIEWPROJECTION;\nuniform vec4 viewport : VIEWPORT;\n\nvarying vec4 v_Color;\nvarying float v_Miter;\n\nvoid main()\n{\n vec4 p2 = worldViewProjection * vec4(position + normal, -10.0, 1.0);\n gl_Position = worldViewProjection * vec4(position, -10.0, 1.0);\n\n p2.xy /= p2.w;\n gl_Position.xy /= gl_Position.w;\n\n vec2 N = normalize(p2.xy - gl_Position.xy);\n gl_Position.xy += N * offset / viewport.zw * 2.0;\n\n gl_Position.xy *= gl_Position.w;\n\n v_Color = a_Color;\n}\n@end\n\n\n@export ecgl.meshLines2D.fragment\n\nuniform vec4 color : [1.0, 1.0, 1.0, 1.0];\n\nvarying vec4 v_Color;\nvarying float v_Miter;\n\nvoid main()\n{\n gl_FragColor = color * v_Color;\n}\n\n@end");var globalLayoutId=1;const GraphGLView=ChartView.extend({type:"graphGL",__ecgl__:!0,init:function(ecModel,api){this.groupGL=new graphicGL.Node,this.viewGL=new ViewGL("orthographic"),this.viewGL.camera.left=this.viewGL.camera.right=0,this.viewGL.add(this.groupGL),this._pointsBuilder=new PointsBuilder(!0,api),this._forceEdgesMesh=new graphicGL.Mesh({material:new graphicGL.Material({shader:graphicGL.createShader("ecgl.forceAtlas2.edges"),transparent:!0,depthMask:!1,depthTest:!1}),$ignorePicking:!0,geometry:new graphicGL.Geometry({attributes:{node:new graphicGL.Geometry.Attribute("node","float",2),color:new graphicGL.Geometry.Attribute("color","float",4,"COLOR")},dynamic:!0,mainAttribute:"node"}),renderOrder:-1,mode:graphicGL.Mesh.LINES}),this._edgesMesh=new graphicGL.Mesh({material:new graphicGL.Material({shader:graphicGL.createShader("ecgl.meshLines2D"),transparent:!0,depthMask:!1,depthTest:!1}),$ignorePicking:!0,geometry:new LinesGeometry$1({useNativeLine:!1,dynamic:!0}),renderOrder:-1,culling:!1}),this._layoutId=0,this._control=new Roam2DControl({zr:api.getZr(),viewGL:this.viewGL}),this._control.setTarget(this.groupGL),this._control.init(),this._clickHandler=this._clickHandler.bind(this)},render:function(seriesModel,ecModel,api){this.groupGL.add(this._pointsBuilder.rootNode),this._model=seriesModel,this._api=api,this._initLayout(seriesModel,ecModel,api),this._pointsBuilder.update(seriesModel,ecModel,api),this._forceLayoutInstance instanceof ForceAtlas2GPU||this.groupGL.remove(this._forceEdgesMesh),this._updateCamera(seriesModel,api),this._control.off("update"),this._control.on("update",function(){api.dispatchAction({type:"graphGLRoam",seriesId:seriesModel.id,zoom:this._control.getZoom(),offset:this._control.getOffset()}),this._pointsBuilder.updateView(this.viewGL.camera)},this),this._control.setZoom(retrieve_firstNotNull(seriesModel.get("zoom"),1)),this._control.setOffset(seriesModel.get("offset")||[0,0]);var mesh=this._pointsBuilder.getPointsMesh();if(mesh.off("mousemove",this._mousemoveHandler),mesh.off("mouseout",this._mouseOutHandler,this),api.getZr().off("click",this._clickHandler),this._pointsBuilder.highlightOnMouseover=!0,seriesModel.get("focusNodeAdjacency")){var focusNodeAdjacencyOn=seriesModel.get("focusNodeAdjacencyOn");"click"===focusNodeAdjacencyOn?api.getZr().on("click",this._clickHandler):"mouseover"===focusNodeAdjacencyOn&amp;&amp;(mesh.on("mousemove",this._mousemoveHandler,this),mesh.on("mouseout",this._mouseOutHandler,this),this._pointsBuilder.highlightOnMouseover=!1)}this._lastMouseOverDataIndex=-1},_clickHandler:function(e2){if(!this._layouting){var dataIndex=this._pointsBuilder.getPointsMesh().dataIndex;dataIndex&gt;=0?this._api.dispatchAction({type:"graphGLFocusNodeAdjacency",seriesId:this._model.id,dataIndex:dataIndex}):this._api.dispatchAction({type:"graphGLUnfocusNodeAdjacency",seriesId:this._model.id})}},_mousemoveHandler:function(e2){if(!this._layouting){var dataIndex=this._pointsBuilder.getPointsMesh().dataIndex;dataIndex&gt;=0?dataIndex!==this._lastMouseOverDataIndex&amp;&amp;this._api.dispatchAction({type:"graphGLFocusNodeAdjacency",seriesId:this._model.id,dataIndex:dataIndex}):this._mouseOutHandler(e2),this._lastMouseOverDataIndex=dataIndex}},_mouseOutHandler:function(e2){this._layouting||(this._api.dispatchAction({type:"graphGLUnfocusNodeAdjacency",seriesId:this._model.id}),this._lastMouseOverDataIndex=-1)},_updateForceEdgesGeometry:function(edges,seriesModel){var geometry=this._forceEdgesMesh.geometry,edgeData=seriesModel.getEdgeData(),offset=0,layoutInstance=this._forceLayoutInstance,vertexCount=2*edgeData.count();geometry.attributes.node.init(vertexCount),geometry.attributes.color.init(vertexCount),edgeData.each(function(idx){var edge=edges[idx];geometry.attributes.node.set(offset,layoutInstance.getNodeUV(edge.node1)),geometry.attributes.node.set(offset+1,layoutInstance.getNodeUV(edge.node2));var color=getItemVisualColor(edgeData,edge.dataIndex),colorArr=graphicGL.parseColor(color);colorArr[3]*=retrieve_firstNotNull(getItemVisualOpacity(edgeData,edge.dataIndex),1),geometry.attributes.color.set(offset,colorArr),geometry.attributes.color.set(offset+1,colorArr),offset+=2}),geometry.dirty()},_updateMeshLinesGeometry:function(){var edgeData=this._model.getEdgeData(),geometry=this._edgesMesh.geometry,points=(edgeData=this._model.getEdgeData(),this._model.getData().getLayout("points"));geometry.resetOffset(),geometry.setVertexCount(edgeData.count()*geometry.getLineVertexCount()),geometry.setTriangleCount(edgeData.count()*geometry.getLineTriangleCount());var p02=[],p12=[],lineWidthQuery=["lineStyle","width"];this._originalEdgeColors=new Float32Array(4*edgeData.count()),this._edgeIndicesMap=new Float32Array(edgeData.count()),edgeData.each(function(idx){var edge=edgeData.graph.getEdgeByIndex(idx),idx1=2*edge.node1.dataIndex,idx2=2*edge.node2.dataIndex;p02[0]=points[idx1],p02[1]=points[idx1+1],p12[0]=points[idx2],p12[1]=points[idx2+1];var color=getItemVisualColor(edgeData,edge.dataIndex),colorArr=graphicGL.parseColor(color);colorArr[3]*=retrieve_firstNotNull(getItemVisualOpacity(edgeData,edge.dataIndex),1);var itemModel=edgeData.getItemModel(edge.dataIndex),lineWidth=retrieve_firstNotNull(itemModel.get(lineWidthQuery),1)*this._api.getDevicePixelRatio();geometry.addLine(p02,p12,colorArr,lineWidth);for(var k=0;k&lt;4;k++)this._originalEdgeColors[4*edge.dataIndex+k]=colorArr[k];this._edgeIndicesMap[edge.dataIndex]=idx},this),geometry.dirty()},_updateForceNodesGeometry:function(nodeData){for(var pointsMesh=this._pointsBuilder.getPointsMesh(),pos=[],i=0;i&lt;nodeData.count();i++)this._forceLayoutInstance.getNodeUV(i,pos),pointsMesh.geometry.attributes.position.set(i,pos);pointsMesh.geometry.dirty("position")},_initLayout:function(seriesModel,ecModel,api){var layout=seriesModel.get("layout"),graph=seriesModel.getGraph(),boxLayoutOption=seriesModel.getBoxLayoutParams(),viewport=getLayoutRect(boxLayoutOption,{width:api.getWidth(),height:api.getHeight()});"force"===layout&amp;&amp;(layout="forceAtlas2"),this.stopLayout(seriesModel,ecModel,api,{beforeLayout:!0});var nodeData=seriesModel.getData(),edgeData=seriesModel.getData();if("forceAtlas2"===layout){var layoutModel=seriesModel.getModel("forceAtlas2"),layoutInstance=this._forceLayoutInstance,nodes=[],edges=[],nodeDataExtent=nodeData.getDataExtent("value"),edgeDataExtent=edgeData.getDataExtent("value"),edgeWeightRange=retrieve_firstNotNull(layoutModel.get("edgeWeight"),1),nodeWeightRange=retrieve_firstNotNull(layoutModel.get("nodeWeight"),1);"number"==typeof edgeWeightRange&amp;&amp;(edgeWeightRange=[edgeWeightRange,edgeWeightRange]),"number"==typeof nodeWeightRange&amp;&amp;(nodeWeightRange=[nodeWeightRange,nodeWeightRange]);var offset=0,nodesIndicesMap={},layoutPoints=new Float32Array(2*nodeData.count());if(graph.eachNode(function(node){var x,y,dataIndex=node.dataIndex,value=nodeData.get("value",dataIndex);if(nodeData.hasItemOption){var itemModel=nodeData.getItemModel(dataIndex);x=itemModel.get("x"),y=itemModel.get("y")}null==x&amp;&amp;(x=viewport.x+Math.random()*viewport.width,y=viewport.y+Math.random()*viewport.height),layoutPoints[2*offset]=x,layoutPoints[2*offset+1]=y,nodesIndicesMap[node.id]=offset++;var mass=linearMap(value,nodeDataExtent,nodeWeightRange);isNaN(mass)&amp;&amp;(mass=isNaN(nodeWeightRange[0])?1:nodeWeightRange[0]),nodes.push({x:x,y:y,mass:mass,size:nodeData.getItemVisual(dataIndex,"symbolSize")})}),nodeData.setLayout("points",layoutPoints),graph.eachEdge(function(edge){var dataIndex=edge.dataIndex,value=nodeData.get("value",dataIndex),weight=linearMap(value,edgeDataExtent,edgeWeightRange);isNaN(weight)&amp;&amp;(weight=isNaN(edgeWeightRange[0])?1:edgeWeightRange[0]),edges.push({node1:nodesIndicesMap[edge.node1.id],node2:nodesIndicesMap[edge.node2.id],weight:weight,dataIndex:dataIndex})}),!layoutInstance){var isGPU=layoutModel.get("GPU");this._forceLayoutInstance&amp;&amp;((!isGPU||this._forceLayoutInstance instanceof ForceAtlas2GPU)&amp;&amp;(isGPU||this._forceLayoutInstance instanceof ForceAtlas2)||(this._forceLayoutInstanceToDispose=this._forceLayoutInstance)),layoutInstance=this._forceLayoutInstance=isGPU?new ForceAtlas2GPU:new ForceAtlas2}layoutInstance.initData(nodes,edges),layoutInstance.updateOption(layoutModel.option),this._updateForceEdgesGeometry(layoutInstance.getEdges(),seriesModel),this._updatePositionTexture(),api.dispatchAction({type:"graphGLStartLayout",from:this.uid})}else{layoutPoints=new Float32Array(2*nodeData.count()),offset=0;graph.eachNode(function(node){var x,y,dataIndex=node.dataIndex;if(nodeData.hasItemOption){var itemModel=nodeData.getItemModel(dataIndex);x=itemModel.get("x"),y=itemModel.get("y")}layoutPoints[offset++]=x,layoutPoints[offset++]=y}),nodeData.setLayout("points",layoutPoints),this._updateAfterLayout(seriesModel,ecModel,api)}},_updatePositionTexture:function(){var positionTex=this._forceLayoutInstance.getNodePositionTexture();this._pointsBuilder.setPositionTexture(positionTex),this._forceEdgesMesh.material.set("positionTex",positionTex)},startLayout:function(seriesModel,ecModel,api,payload){if(!payload||null==payload.from||payload.from===this.uid){var viewGL=this.viewGL,layoutInstance=(api=this._api,this._forceLayoutInstance),data=this._model.getData(),layoutModel=this._model.getModel("forceAtlas2");if(layoutInstance&amp;&amp;(this.groupGL.remove(this._edgesMesh),this.groupGL.add(this._forceEdgesMesh),this._forceLayoutInstance)){this._updateForceNodesGeometry(seriesModel.getData()),this._pointsBuilder.hideLabels();var self2=this,layoutId=this._layoutId=globalLayoutId++,maxSteps=layoutModel.getShallow("maxSteps"),steps=layoutModel.getShallow("steps"),stepsCount=0,syncStepCount=Math.max(2*steps,20),doLayout=function(layoutId2){if(layoutId2===self2._layoutId)return layoutInstance.isFinished(maxSteps)?(api.dispatchAction({type:"graphGLStopLayout",from:self2.uid}),void api.dispatchAction({type:"graphGLFinishLayout",points:data.getLayout("points"),from:self2.uid})):void layoutInstance.update(viewGL.layer.renderer,steps,function(){self2._updatePositionTexture(),(stepsCount+=steps)&gt;=syncStepCount&amp;&amp;(self2._syncNodePosition(seriesModel),stepsCount=0),api.getZr().refresh(),requestAnimationFrame$1(function(){doLayout(layoutId2)})})};requestAnimationFrame$1(function(){self2._forceLayoutInstanceToDispose&amp;&amp;(self2._forceLayoutInstanceToDispose.dispose(viewGL.layer.renderer),self2._forceLayoutInstanceToDispose=null),doLayout(layoutId)}),this._layouting=!0}}},stopLayout:function(seriesModel,ecModel,api,payload){payload&amp;&amp;null!=payload.from&amp;&amp;payload.from!==this.uid||(this._layoutId=0,this.groupGL.remove(this._forceEdgesMesh),this.groupGL.add(this._edgesMesh),this._forceLayoutInstance&amp;&amp;this.viewGL.layer&amp;&amp;(payload&amp;&amp;payload.beforeLayout||(this._syncNodePosition(seriesModel),this._updateAfterLayout(seriesModel,ecModel,api)),this._api.getZr().refresh(),this._layouting=!1))},_syncNodePosition:function(seriesModel){var points=this._forceLayoutInstance.getNodePosition(this.viewGL.layer.renderer);seriesModel.getData().setLayout("points",points),seriesModel.setNodePosition(points)},_updateAfterLayout:function(seriesModel,ecModel,api){this._updateMeshLinesGeometry(),this._pointsBuilder.removePositionTexture(),this._pointsBuilder.updateLayout(seriesModel,ecModel,api),this._pointsBuilder.updateView(this.viewGL.camera),this._pointsBuilder.updateLabels(),this._pointsBuilder.showLabels()},focusNodeAdjacency:function(seriesModel,ecModel,api,payload){var data=this._model.getData();this._downplayAll();var dataIndex=payload.dataIndex,graph=data.graph,focusNodes=[],node=graph.getNodeByIndex(dataIndex);focusNodes.push(node),node.edges.forEach(function(edge){edge.dataIndex&lt;0||(edge.node1!==node&amp;&amp;focusNodes.push(edge.node1),edge.node2!==node&amp;&amp;focusNodes.push(edge.node2))},this),this._pointsBuilder.fadeOutAll(.05),this._fadeOutEdgesAll(.05),focusNodes.forEach(function(node2){this._pointsBuilder.highlight(data,node2.dataIndex)},this),this._pointsBuilder.updateLabels(focusNodes.map(function(node2){return node2.dataIndex}));var focusEdges=[];node.edges.forEach(function(edge){edge.dataIndex&gt;=0&amp;&amp;(this._highlightEdge(edge.dataIndex),focusEdges.push(edge))},this),this._focusNodes=focusNodes,this._focusEdges=focusEdges},unfocusNodeAdjacency:function(seriesModel,ecModel,api,payload){this._downplayAll(),this._pointsBuilder.fadeInAll(),this._fadeInEdgesAll(),this._pointsBuilder.updateLabels()},_highlightEdge:function(dataIndex){var itemModel=this._model.getEdgeData().getItemModel(dataIndex),emphasisColor=graphicGL.parseColor(itemModel.get("emphasis.lineStyle.color")||itemModel.get("lineStyle.color")),emphasisOpacity=retrieve_firstNotNull(itemModel.get("emphasis.lineStyle.opacity"),itemModel.get("lineStyle.opacity"),1);emphasisColor[3]*=emphasisOpacity,this._edgesMesh.geometry.setItemColor(this._edgeIndicesMap[dataIndex],emphasisColor)},_downplayAll:function(){this._focusNodes&amp;&amp;this._focusNodes.forEach(function(node){this._pointsBuilder.downplay(this._model.getData(),node.dataIndex)},this),this._focusEdges&amp;&amp;this._focusEdges.forEach(function(edge){this._downplayEdge(edge.dataIndex)},this)},_downplayEdge:function(dataIndex){var color=this._getColor(dataIndex,[]);this._edgesMesh.geometry.setItemColor(this._edgeIndicesMap[dataIndex],color)},_setEdgeFade:function(){var color=[];return function(dataIndex,percent){this._getColor(dataIndex,color),color[3]*=percent,this._edgesMesh.geometry.setItemColor(this._edgeIndicesMap[dataIndex],color)}}(),_getColor:function(dataIndex,out){for(var i=0;i&lt;4;i++)out[i]=this._originalEdgeColors[4*dataIndex+i];return out},_fadeOutEdgesAll:function(percent){this._model.getData().graph.eachEdge(function(edge){this._setEdgeFade(edge.dataIndex,percent)},this)},_fadeInEdgesAll:function(){this._fadeOutEdgesAll(1)},_updateCamera:function(seriesModel,api){this.viewGL.setViewport(0,0,api.getWidth(),api.getHeight(),api.getDevicePixelRatio());for(var camera=this.viewGL.camera,points=seriesModel.getData().getLayout("points"),min=vec2.create(1/0,1/0),max=vec2.create(-1/0,-1/0),pt=[],i=0;i&lt;points.length;)pt[0]=points[i++],pt[1]=points[i++],vec2.min(min,min,pt),vec2.max(max,max,pt);var cy=(max[1]+min[1])/2,cx=(max[0]+min[0])/2;if(!(cx&gt;camera.left&amp;&amp;cx&lt;camera.right&amp;&amp;cy&lt;camera.bottom&amp;&amp;cy&gt;camera.top)){var width=Math.max(max[0]-min[0],10),height=width/api.getWidth()*api.getHeight();width*=1.4,height*=1.4,min[0]-=.2*width,camera.left=min[0],camera.top=cy-height/2,camera.bottom=cy+height/2,camera.right=width+min[0],camera.near=0,camera.far=100}},dispose:function(){var renderer=this.viewGL.layer.renderer;this._forceLayoutInstance&amp;&amp;this._forceLayoutInstance.dispose(renderer),this.groupGL.removeAll(),this._layoutId=-1,this._pointsBuilder.dispose()},remove:function(){this.groupGL.removeAll(),this._control.dispose()}});function normalize(a){return a instanceof Array||(a=[a,a]),a}use(function install$2(registers){function noop(){}registers.registerChartView(GraphGLView),registers.registerSeriesModel(GraphSeries),registers.registerVisual(function(ecModel){const paletteScope={};ecModel.eachSeriesByType("graphGL",function(seriesModel){var categoriesData=seriesModel.getCategoriesData(),data=seriesModel.getData(),categoryNameIdxMap={};categoriesData.each(function(idx){var name=categoriesData.getName(idx);categoryNameIdxMap["ec-"+name]=idx;var itemModel=categoriesData.getItemModel(idx),style=itemModel.getModel("itemStyle").getItemStyle();style.fill||(style.fill=seriesModel.getColorFromPalette(name,paletteScope)),categoriesData.setItemVisual(idx,"style",style);var symbolVisualList=["symbol","symbolSize","symbolKeepAspect"];for(let i=0;i&lt;symbolVisualList.length;i++){var symbolVisual=itemModel.getShallow(symbolVisualList[i],!0);null!=symbolVisual&amp;&amp;categoriesData.setItemVisual(idx,symbolVisualList[i],symbolVisual)}}),categoriesData.count()&amp;&amp;data.each(function(idx){let categoryIdx=data.getItemModel(idx).getShallow("category");if(null!=categoryIdx){"string"==typeof categoryIdx&amp;&amp;(categoryIdx=categoryNameIdxMap["ec-"+categoryIdx]);var categoryStyle=categoriesData.getItemVisual(categoryIdx,"style"),style=data.ensureUniqueItemVisual(idx,"style");extend(style,categoryStyle);var visualList=["symbol","symbolSize","symbolKeepAspect"];for(let i=0;i&lt;visualList.length;i++)data.setItemVisual(idx,visualList[i],categoriesData.getItemVisual(categoryIdx,visualList[i]))}})})}),registers.registerVisual(function(ecModel){ecModel.eachSeriesByType("graphGL",function(seriesModel){var graph=seriesModel.getGraph(),edgeData=seriesModel.getEdgeData(),symbolType=normalize(seriesModel.get("edgeSymbol")),symbolSize=normalize(seriesModel.get("edgeSymbolSize"));edgeData.setVisual("drawType","stroke"),edgeData.setVisual("fromSymbol",symbolType&amp;&amp;symbolType[0]),edgeData.setVisual("toSymbol",symbolType&amp;&amp;symbolType[1]),edgeData.setVisual("fromSymbolSize",symbolSize&amp;&amp;symbolSize[0]),edgeData.setVisual("toSymbolSize",symbolSize&amp;&amp;symbolSize[1]),edgeData.setVisual("style",seriesModel.getModel("lineStyle").getLineStyle()),edgeData.each(function(idx){var itemModel=edgeData.getItemModel(idx),edge=graph.getEdgeByIndex(idx),symbolType2=normalize(itemModel.getShallow("symbol",!0)),symbolSize2=normalize(itemModel.getShallow("symbolSize",!0)),style=itemModel.getModel("lineStyle").getLineStyle(),existsStyle=edgeData.ensureUniqueItemVisual(idx,"style");switch(extend(existsStyle,style),existsStyle.stroke){case"source":var nodeStyle=edge.node1.getVisual("style");existsStyle.stroke=nodeStyle&amp;&amp;nodeStyle.fill;break;case"target":nodeStyle=edge.node2.getVisual("style");existsStyle.stroke=nodeStyle&amp;&amp;nodeStyle.fill}symbolType2[0]&amp;&amp;edge.setVisual("fromSymbol",symbolType2[0]),symbolType2[1]&amp;&amp;edge.setVisual("toSymbol",symbolType2[1]),symbolSize2[0]&amp;&amp;edge.setVisual("fromSymbolSize",symbolSize2[0]),symbolSize2[1]&amp;&amp;edge.setVisual("toSymbolSize",symbolSize2[1])})})}),registers.registerAction({type:"graphGLRoam",event:"graphglroam",update:"series.graphGL:roam"},function(payload,ecModel){ecModel.eachComponent({mainType:"series",query:payload},function(componentModel){componentModel.setView(payload)})}),registers.registerAction({type:"graphGLStartLayout",event:"graphgllayoutstarted",update:"series.graphGL:startLayout"},noop),registers.registerAction({type:"graphGLStopLayout",event:"graphgllayoutstopped",update:"series.graphGL:stopLayout"},noop),registers.registerAction({type:"graphGLFocusNodeAdjacency",event:"graphGLFocusNodeAdjacency",update:"series.graphGL:focusNodeAdjacency"},noop),registers.registerAction({type:"graphGLUnfocusNodeAdjacency",event:"graphGLUnfocusNodeAdjacency",update:"series.graphGL:unfocusNodeAdjacency"},noop)});const FlowGLSeries=SeriesModel.extend({type:"series.flowGL",dependencies:["geo","grid","bmap"],visualStyleAccessPath:"itemStyle",getInitialData:function(option,ecModel){var coordType=this.get("coordinateSystem"),coordSysDimensions="geo"===coordType?["lng","lat"]:getCoordinateSystemDimensions(coordType)||["x","y"];coordSysDimensions.push("vx","vy");var dimensions=createDimensions(this.getSource(),{coordDimensions:coordSysDimensions,encodeDefine:this.get("encode"),dimensionsDefine:this.get("dimensions")}),data=new SeriesData(dimensions,this);return data.initData(this.getSource()),data},defaultOption:{coordinateSystem:"cartesian2d",zlevel:10,supersampling:1,particleType:"point",particleDensity:128,particleSize:1,particleSpeed:1,particleTrail:2,colorTexture:null,gridWidth:"auto",gridHeight:"auto",itemStyle:{color:"#fff",opacity:.8}}});var LinesGeometry=Geometry.extend(function(){return{dynamic:!0,attributes:{position:new Geometry.Attribute("position","float",3,"POSITION")}}},{resetOffset:function(){this._vertexOffset=0,this._faceOffset=0},setLineCount:function(nLine){var attributes=this.attributes,nVertex=4*nLine,nTriangle=2*nLine;this.vertexCount!==nVertex&amp;&amp;attributes.position.init(nVertex),this.triangleCount!==nTriangle&amp;&amp;(this.indices=0===nTriangle?null:this.vertexCount&gt;65535?new Uint32Array(3*nTriangle):new Uint16Array(3*nTriangle))},addLine:function(p){var vertexOffset=this._vertexOffset;this.attributes.position.set(vertexOffset,[p[0],p[1],1]),this.attributes.position.set(vertexOffset+1,[p[0],p[1],-1]),this.attributes.position.set(vertexOffset+2,[p[0],p[1],2]),this.attributes.position.set(vertexOffset+3,[p[0],p[1],-2]),this.setTriangleIndices(this._faceOffset++,[vertexOffset,vertexOffset+1,vertexOffset+2]),this.setTriangleIndices(this._faceOffset++,[vertexOffset+1,vertexOffset+2,vertexOffset+3]),this._vertexOffset+=4}});Shader.import("@export ecgl.vfParticle.particle.fragment\n\nuniform sampler2D particleTexture;\nuniform sampler2D spawnTexture;\nuniform sampler2D velocityTexture;\n\nuniform float deltaTime;\nuniform float elapsedTime;\n\nuniform float speedScaling : 1.0;\n\nuniform vec2 textureSize;\nuniform vec4 region : [0, 0, 1, 1];\nuniform float firstFrameTime;\n\nvarying vec2 v_Texcoord;\n\n\nvoid main()\n{\n vec4 p = texture2D(particleTexture, v_Texcoord);\n bool spawn = false;\n if (p.w &lt;= 0.0) {\n p = texture2D(spawnTexture, fract(v_Texcoord + elapsedTime / 10.0));\n p.w -= firstFrameTime;\n spawn = true;\n }\n vec2 v = texture2D(velocityTexture, fract(p.xy * region.zw + region.xy)).xy;\n v = (v - 0.5) * 2.0;\n p.z = length(v);\n p.xy += v * deltaTime / 10.0 * speedScaling;\n p.w -= deltaTime;\n\n if (spawn || p.xy != fract(p.xy)) {\n p.z = 0.0;\n }\n p.xy = fract(p.xy);\n\n gl_FragColor = p;\n}\n@end\n\n@export ecgl.vfParticle.renderPoints.vertex\n\n#define PI 3.1415926\n\nattribute vec2 texcoord : TEXCOORD_0;\n\nuniform sampler2D particleTexture;\nuniform mat4 worldViewProjection : WORLDVIEWPROJECTION;\n\nuniform float size : 1.0;\n\nvarying float v_Mag;\nvarying vec2 v_Uv;\n\nvoid main()\n{\n vec4 p = texture2D(particleTexture, texcoord);\n\n if (p.w &gt; 0.0 &amp;&amp; p.z &gt; 1e-5) {\n gl_Position = worldViewProjection * vec4(p.xy * 2.0 - 1.0, 0.0, 1.0);\n }\n else {\n gl_Position = vec4(100000.0, 100000.0, 100000.0, 1.0);\n }\n\n v_Mag = p.z;\n v_Uv = p.xy;\n\n gl_PointSize = size;\n}\n\n@end\n\n@export ecgl.vfParticle.renderPoints.fragment\n\nuniform vec4 color : [1.0, 1.0, 1.0, 1.0];\nuniform sampler2D gradientTexture;\nuniform sampler2D colorTexture;\nuniform sampler2D spriteTexture;\n\nvarying float v_Mag;\nvarying vec2 v_Uv;\n\nvoid main()\n{\n gl_FragColor = color;\n#ifdef SPRITETEXTURE_ENABLED\n gl_FragColor *= texture2D(spriteTexture, gl_PointCoord);\n if (color.a == 0.0) {\n discard;\n }\n#endif\n#ifdef GRADIENTTEXTURE_ENABLED\n gl_FragColor *= texture2D(gradientTexture, vec2(v_Mag, 0.5));\n#endif\n#ifdef COLORTEXTURE_ENABLED\n gl_FragColor *= texture2D(colorTexture, v_Uv);\n#endif\n}\n\n@end\n\n@export ecgl.vfParticle.renderLines.vertex\n\n#define PI 3.1415926\n\nattribute vec3 position : POSITION;\n\nuniform sampler2D particleTexture;\nuniform sampler2D prevParticleTexture;\n\nuniform float size : 1.0;\nuniform vec4 vp: VIEWPORT;\nuniform mat4 worldViewProjection : WORLDVIEWPROJECTION;\n\nvarying float v_Mag;\nvarying vec2 v_Uv;\n\n@import clay.util.rand\n\nvoid main()\n{\n vec4 p = texture2D(particleTexture, position.xy);\n vec4 p2 = texture2D(prevParticleTexture, position.xy);\n\n p.xy = p.xy * 2.0 - 1.0;\n p2.xy = p2.xy * 2.0 - 1.0;\n\n if (p.w &gt; 0.0 &amp;&amp; p.z &gt; 1e-5) {\n vec2 dir = normalize(p.xy - p2.xy);\n vec2 norm = vec2(dir.y / vp.z, -dir.x / vp.w) * sign(position.z) * size;\n if (abs(position.z) == 2.0) {\n gl_Position = vec4(p.xy + norm, 0.0, 1.0);\n v_Uv = p.xy;\n v_Mag = p.z;\n }\n else {\n gl_Position = vec4(p2.xy + norm, 0.0, 1.0);\n v_Mag = p2.z;\n v_Uv = p2.xy;\n }\n gl_Position = worldViewProjection * gl_Position;\n }\n else {\n gl_Position = vec4(100000.0, 100000.0, 100000.0, 1.0);\n }\n}\n\n@end\n\n@export ecgl.vfParticle.renderLines.fragment\n\nuniform vec4 color : [1.0, 1.0, 1.0, 1.0];\nuniform sampler2D gradientTexture;\nuniform sampler2D colorTexture;\n\nvarying float v_Mag;\nvarying vec2 v_Uv;\n\nvoid main()\n{\n gl_FragColor = color;\n #ifdef GRADIENTTEXTURE_ENABLED\n gl_FragColor *= texture2D(gradientTexture, vec2(v_Mag, 0.5));\n#endif\n#ifdef COLORTEXTURE_ENABLED\n gl_FragColor *= texture2D(colorTexture, v_Uv);\n#endif\n}\n\n@end\n");var VectorFieldParticleSurface=function(){this.motionBlurFactor=.99,this.vectorFieldTexture=new Texture2D({type:Texture.FLOAT,flipY:!1}),this.particleLife=[5,20],this._particleType="point",this._particleSize=1,this.particleColor=[1,1,1,1],this.particleSpeedScaling=1,this._thisFrameTexture=null,this._particlePass=null,this._spawnTexture=null,this._particleTexture0=null,this._particleTexture1=null,this._particlePointsMesh=null,this._surfaceFrameBuffer=null,this._elapsedTime=0,this._scene=null,this._camera=null,this._lastFrameTexture=null,this._supersampling=1,this._downsampleTextures=[],this._width=512,this._height=512,this.init()};VectorFieldParticleSurface.prototype={constructor:VectorFieldParticleSurface,init:function(){var parameters={type:Texture.FLOAT,minFilter:Texture.NEAREST,magFilter:Texture.NEAREST,useMipmap:!1};this._spawnTexture=new Texture2D(parameters),this._particleTexture0=new Texture2D(parameters),this._particleTexture1=new Texture2D(parameters),this._frameBuffer=new FrameBuffer({depthBuffer:!1}),this._particlePass=new Pass({fragment:Shader.source("ecgl.vfParticle.particle.fragment")}),this._particlePass.setUniform("velocityTexture",this.vectorFieldTexture),this._particlePass.setUniform("spawnTexture",this._spawnTexture),this._downsamplePass=new Pass({fragment:Shader.source("clay.compositor.downsample")});var particlePointsMesh=new Mesh({renderOrder:10,material:new Material({shader:new Shader(Shader.source("ecgl.vfParticle.renderPoints.vertex"),Shader.source("ecgl.vfParticle.renderPoints.fragment"))}),mode:Mesh.POINTS,geometry:new Geometry({dynamic:!0,mainAttribute:"texcoord0"})}),particleLinesMesh=new Mesh({renderOrder:10,material:new Material({shader:new Shader(Shader.source("ecgl.vfParticle.renderLines.vertex"),Shader.source("ecgl.vfParticle.renderLines.fragment"))}),geometry:new LinesGeometry,culling:!1}),lastFrameFullQuad=new Mesh({material:new Material({shader:new Shader(Shader.source("ecgl.color.vertex"),Shader.source("ecgl.color.fragment"))}),geometry:new Plane});lastFrameFullQuad.material.enableTexture("diffuseMap"),this._particlePointsMesh=particlePointsMesh,this._particleLinesMesh=particleLinesMesh,this._lastFrameFullQuadMesh=lastFrameFullQuad,this._camera=new Orthographic,this._thisFrameTexture=new Texture2D,this._lastFrameTexture=new Texture2D},setParticleDensity:function(width,height){for(var spawnTextureData=new Float32Array(4*(width*height)),off=0,lifeRange=this.particleLife,i=0;i&lt;width;i++)for(var j=0;j&lt;height;j++,off++){spawnTextureData[4*off]=Math.random(),spawnTextureData[4*off+1]=Math.random(),spawnTextureData[4*off+2]=Math.random();var life=(lifeRange[1]-lifeRange[0])*Math.random()+lifeRange[0];spawnTextureData[4*off+3]=life}"line"===this._particleType?this._setLineGeometry(width,height):this._setPointsGeometry(width,height),this._spawnTexture.width=width,this._spawnTexture.height=height,this._spawnTexture.pixels=spawnTextureData,this._particleTexture0.width=this._particleTexture1.width=width,this._particleTexture0.height=this._particleTexture1.height=height,this._particlePass.setUniform("textureSize",[width,height])},_setPointsGeometry:function(width,height){var nVertex=width*height,geometry=this._particlePointsMesh.geometry,attributes=geometry.attributes;attributes.texcoord0.init(nVertex);for(var off=0,i=0;i&lt;width;i++)for(var j=0;j&lt;height;j++,off++)attributes.texcoord0.value[2*off]=i/width,attributes.texcoord0.value[2*off+1]=j/height;geometry.dirty()},_setLineGeometry:function(width,height){var nLine=width*height,geometry=this._getParticleMesh().geometry;geometry.setLineCount(nLine),geometry.resetOffset();for(var i=0;i&lt;width;i++)for(var j=0;j&lt;height;j++)geometry.addLine([i/width,j/height]);geometry.dirty()},_getParticleMesh:function(){return"line"===this._particleType?this._particleLinesMesh:this._particlePointsMesh},update:function(renderer,api,deltaTime,firstFrame){var particleMesh=this._getParticleMesh(),frameBuffer=this._frameBuffer,particlePass=this._particlePass;firstFrame&amp;&amp;this._updateDownsampleTextures(renderer,api),particleMesh.material.set("size",this._particleSize*this._supersampling),particleMesh.material.set("color",this.particleColor),particlePass.setUniform("speedScaling",this.particleSpeedScaling),frameBuffer.attach(this._particleTexture1),particlePass.setUniform("firstFrameTime",firstFrame?(this.particleLife[1]+this.particleLife[0])/2:0),particlePass.setUniform("particleTexture",this._particleTexture0),particlePass.setUniform("deltaTime",deltaTime),particlePass.setUniform("elapsedTime",this._elapsedTime),particlePass.render(renderer,frameBuffer),particleMesh.material.set("particleTexture",this._particleTexture1),particleMesh.material.set("prevParticleTexture",this._particleTexture0),frameBuffer.attach(this._thisFrameTexture),frameBuffer.bind(renderer),renderer.gl.clear(renderer.gl.DEPTH_BUFFER_BIT|renderer.gl.COLOR_BUFFER_BIT);var lastFrameFullQuad=this._lastFrameFullQuadMesh;lastFrameFullQuad.material.set("diffuseMap",this._lastFrameTexture),lastFrameFullQuad.material.set("color",[1,1,1,this.motionBlurFactor]),this._camera.update(!0),renderer.renderPass([lastFrameFullQuad,particleMesh],this._camera),frameBuffer.unbind(renderer),this._downsample(renderer),this._swapTexture(),this._elapsedTime+=deltaTime},_downsample:function(renderer){var downsampleTextures=this._downsampleTextures;if(0!==downsampleTextures.length)for(var current=0,sourceTexture=this._thisFrameTexture,targetTexture=downsampleTextures[current];targetTexture;)this._frameBuffer.attach(targetTexture),this._downsamplePass.setUniform("texture",sourceTexture),this._downsamplePass.setUniform("textureSize",[sourceTexture.width,sourceTexture.height]),this._downsamplePass.render(renderer,this._frameBuffer),sourceTexture=targetTexture,targetTexture=downsampleTextures[++current]},getSurfaceTexture:function(){var downsampleTextures=this._downsampleTextures;return downsampleTextures.length&gt;0?downsampleTextures[downsampleTextures.length-1]:this._lastFrameTexture},setRegion:function(region){this._particlePass.setUniform("region",region)},resize:function(width,height){this._lastFrameTexture.width=width*this._supersampling,this._lastFrameTexture.height=height*this._supersampling,this._thisFrameTexture.width=width*this._supersampling,this._thisFrameTexture.height=height*this._supersampling,this._width=width,this._height=height},setParticleSize:function(size){var particleMesh=this._getParticleMesh();if(size&lt;=2)return particleMesh.material.disableTexture("spriteTexture"),void(particleMesh.material.transparent=!1);this._spriteTexture||(this._spriteTexture=new Texture2D),this._spriteTexture.image&amp;&amp;this._spriteTexture.image.width===size||(this._spriteTexture.image=function createSpriteCanvas(size){var canvas=document.createElement("canvas");canvas.width=canvas.height=size;var ctx=canvas.getContext("2d");return ctx.fillStyle="#fff",ctx.arc(size/2,size/2,size/2,0,2*Math.PI),ctx.fill(),canvas}(size),this._spriteTexture.dirty()),particleMesh.material.transparent=!0,particleMesh.material.enableTexture("spriteTexture"),particleMesh.material.set("spriteTexture",this._spriteTexture),this._particleSize=size},setGradientTexture:function(gradientTexture){var material=this._getParticleMesh().material;material[gradientTexture?"enableTexture":"disableTexture"]("gradientTexture"),material.setUniform("gradientTexture",gradientTexture)},setColorTextureImage:function(colorTextureImg,api){this._getParticleMesh().material.setTextureImage("colorTexture",colorTextureImg,api,{flipY:!0})},setParticleType:function(type){this._particleType=type},clearFrame:function(renderer){var frameBuffer=this._frameBuffer;frameBuffer.attach(this._lastFrameTexture),frameBuffer.bind(renderer),renderer.gl.clear(renderer.gl.DEPTH_BUFFER_BIT|renderer.gl.COLOR_BUFFER_BIT),frameBuffer.unbind(renderer)},setSupersampling:function(supersampling){this._supersampling=supersampling,this.resize(this._width,this._height)},_updateDownsampleTextures:function(renderer,api){for(var downsampleTextures=this._downsampleTextures,upScale=Math.max(Math.floor(Math.log(this._supersampling/api.getDevicePixelRatio())/Math.log(2)),0),scale=2,width=this._width*this._supersampling,height=this._height*this._supersampling,i=0;i&lt;upScale;i++)downsampleTextures[i]=downsampleTextures[i]||new Texture2D,downsampleTextures[i].width=width/scale,downsampleTextures[i].height=height/scale,scale*=2;for(;i&lt;downsampleTextures.length;i++)downsampleTextures[i].dispose(renderer);downsampleTextures.length=upScale},_swapTexture:function(){var tmp=this._particleTexture0;this._particleTexture0=this._particleTexture1,this._particleTexture1=tmp;tmp=this._thisFrameTexture;this._thisFrameTexture=this._lastFrameTexture,this._lastFrameTexture=tmp},dispose:function(renderer){renderer.disposeFrameBuffer(this._frameBuffer),renderer.disposeTexture(this.vectorFieldTexture),renderer.disposeTexture(this._spawnTexture),renderer.disposeTexture(this._particleTexture0),renderer.disposeTexture(this._particleTexture1),renderer.disposeTexture(this._thisFrameTexture),renderer.disposeTexture(this._lastFrameTexture),renderer.disposeGeometry(this._particleLinesMesh.geometry),renderer.disposeGeometry(this._particlePointsMesh.geometry),renderer.disposeGeometry(this._lastFrameFullQuadMesh.geometry),this._spriteTexture&amp;&amp;renderer.disposeTexture(this._spriteTexture),this._particlePass.dispose(renderer),this._downsamplePass.dispose(renderer),this._downsampleTextures.forEach(function(texture){texture.dispose(renderer)})}};const FlowGLView=ChartView.extend({type:"flowGL",__ecgl__:!0,init:function(ecModel,api){this.viewGL=new ViewGL("orthographic"),this.groupGL=new graphicGL.Node,this.viewGL.add(this.groupGL),this._particleSurface=new VectorFieldParticleSurface;var planeMesh=new graphicGL.Mesh({geometry:new graphicGL.PlaneGeometry,material:new graphicGL.Material({shader:new graphicGL.Shader({vertex:graphicGL.Shader.source("ecgl.color.vertex"),fragment:graphicGL.Shader.source("ecgl.color.fragment")}),transparent:!0})});planeMesh.material.enableTexture("diffuseMap"),this.groupGL.add(planeMesh),this._planeMesh=planeMesh},render:function(seriesModel,ecModel,api){var particleSurface=this._particleSurface;particleSurface.setParticleType(seriesModel.get("particleType")),particleSurface.setSupersampling(seriesModel.get("supersampling")),this._updateData(seriesModel,api),this._updateCamera(api.getWidth(),api.getHeight(),api.getDevicePixelRatio());var particleDensity=retrieve_firstNotNull(seriesModel.get("particleDensity"),128);particleSurface.setParticleDensity(particleDensity,particleDensity);var planeMesh=this._planeMesh,time=+new Date,self2=this,firstFrame=!0;planeMesh.__percent=0,planeMesh.stopAnimation(),planeMesh.animate("",{loop:!0}).when(1e5,{__percent:1}).during(function(){var timeNow=+new Date,dTime=Math.min(timeNow-time,20);time+=dTime,self2._renderer&amp;&amp;(particleSurface.update(self2._renderer,api,dTime/1e3,firstFrame),planeMesh.material.set("diffuseMap",particleSurface.getSurfaceTexture())),firstFrame=!1}).start();var itemStyleModel=seriesModel.getModel("itemStyle"),color=graphicGL.parseColor(itemStyleModel.get("color"));color[3]*=retrieve_firstNotNull(itemStyleModel.get("opacity"),1),planeMesh.material.set("color",color),particleSurface.setColorTextureImage(seriesModel.get("colorTexture"),api),particleSurface.setParticleSize(seriesModel.get("particleSize")),particleSurface.particleSpeedScaling=seriesModel.get("particleSpeed"),particleSurface.motionBlurFactor=1-Math.pow(.1,seriesModel.get("particleTrail"))},updateTransform:function(seriesModel,ecModel,api){this._updateData(seriesModel,api)},afterRender:function(globeModel,ecModel,api,layerGL){var renderer=layerGL.renderer;this._renderer=renderer},_updateData:function(seriesModel,api){var coordSys=seriesModel.coordinateSystem,dims=coordSys.dimensions.map(function(coordDim){return seriesModel.coordDimToDataDim(coordDim)[0]}),data=seriesModel.getData(),xExtent=data.getDataExtent(dims[0]),yExtent=data.getDataExtent(dims[1]),gridWidth=seriesModel.get("gridWidth"),gridHeight=seriesModel.get("gridHeight");if(null==gridWidth||"auto"===gridWidth){var aspect=(xExtent[1]-xExtent[0])/(yExtent[1]-yExtent[0]);gridWidth=Math.round(Math.sqrt(aspect*data.count()))}null!=gridHeight&amp;&amp;"auto"!==gridHeight||(gridHeight=Math.ceil(data.count()/gridWidth));var vectorFieldTexture=this._particleSurface.vectorFieldTexture,pixels=vectorFieldTexture.pixels;if(pixels&amp;&amp;pixels.length===gridHeight*gridWidth*4)for(var i=0;i&lt;pixels.length;i++)pixels[i]=0;else pixels=vectorFieldTexture.pixels=new Float32Array(gridWidth*gridHeight*4);var maxMag=0,minMag=1/0,points=new Float32Array(2*data.count()),offset=0,bbox=[[1/0,1/0],[-1/0,-1/0]];data.each([dims[0],dims[1],"vx","vy"],function(x,y,vx,vy){var pt=coordSys.dataToPoint([x,y]);points[offset++]=pt[0],points[offset++]=pt[1],bbox[0][0]=Math.min(pt[0],bbox[0][0]),bbox[0][1]=Math.min(pt[1],bbox[0][1]),bbox[1][0]=Math.max(pt[0],bbox[1][0]),bbox[1][1]=Math.max(pt[1],bbox[1][1]);var mag=Math.sqrt(vx*vx+vy*vy);maxMag=Math.max(maxMag,mag),minMag=Math.min(minMag,mag)}),data.each(["vx","vy"],function(vx,vy,i2){var xPix=Math.round((points[2*i2]-bbox[0][0])/(bbox[1][0]-bbox[0][0])*(gridWidth-1)),idx=4*((gridHeight-1-Math.round((points[2*i2+1]-bbox[0][1])/(bbox[1][1]-bbox[0][1])*(gridHeight-1)))*gridWidth+xPix);pixels[idx]=vx/maxMag*.5+.5,pixels[idx+1]=vy/maxMag*.5+.5,pixels[idx+3]=1}),vectorFieldTexture.width=gridWidth,vectorFieldTexture.height=gridHeight,"bmap"===seriesModel.get("coordinateSystem")&amp;&amp;this._fillEmptyPixels(vectorFieldTexture),vectorFieldTexture.dirty(),this._updatePlanePosition(bbox[0],bbox[1],seriesModel,api),this._updateGradientTexture(data.getVisual("visualMeta"),[minMag,maxMag])},_fillEmptyPixels:function(texture){var pixels=texture.pixels,width=texture.width,height=texture.height;function fetchPixel(x2,y2,rg){x2=Math.max(Math.min(x2,width-1),0);var idx2=4*((y2=Math.max(Math.min(y2,height-1),0))*(width-1)+x2);return 0!==pixels[idx2+3]&amp;&amp;(rg[0]=pixels[idx2],rg[1]=pixels[idx2+1],!0)}function addPixel(a,b,out){out[0]=a[0]+b[0],out[1]=a[1]+b[1]}for(var center=[],left=[],right=[],top=[],bottom=[],weight=0,y=0;y&lt;height;y++)for(var x=0;x&lt;width;x++){var idx=4*(y*(width-1)+x);0===pixels[idx+3]&amp;&amp;(weight=center[0]=center[1]=0,fetchPixel(x-1,y,left)&amp;&amp;(weight++,addPixel(left,center,center)),fetchPixel(x+1,y,right)&amp;&amp;(weight++,addPixel(right,center,center)),fetchPixel(x,y-1,top)&amp;&amp;(weight++,addPixel(top,center,center)),fetchPixel(x,y+1,bottom)&amp;&amp;(weight++,addPixel(bottom,center,center)),center[0]/=weight,center[1]/=weight,pixels[idx]=center[0],pixels[idx+1]=center[1]),pixels[idx+3]=1}},_updateGradientTexture:function(visualMeta,magExtent){if(visualMeta&amp;&amp;visualMeta.length){this._gradientTexture=this._gradientTexture||new graphicGL.Texture2D({image:document.createElement("canvas")});var gradientTexture=this._gradientTexture,canvas=gradientTexture.image;canvas.width=200,canvas.height=1;var ctx=canvas.getContext("2d"),gradient=ctx.createLinearGradient(0,.5,canvas.width,.5);visualMeta[0].stops.forEach(function(stop){var offset;magExtent[1]===magExtent[0]?offset=0:(offset=stop.value/magExtent[1],offset=Math.min(Math.max(offset,0),1)),gradient.addColorStop(offset,stop.color)}),ctx.fillStyle=gradient,ctx.fillRect(0,0,canvas.width,canvas.height),gradientTexture.dirty(),this._particleSurface.setGradientTexture(this._gradientTexture)}else this._particleSurface.setGradientTexture(null)},_updatePlanePosition:function(leftTop,rightBottom,seriesModel,api){var limitedResult=this._limitInViewportAndFullFill(leftTop,rightBottom,seriesModel,api);leftTop=limitedResult.leftTop,rightBottom=limitedResult.rightBottom,this._particleSurface.setRegion(limitedResult.region),this._planeMesh.position.set((leftTop[0]+rightBottom[0])/2,api.getHeight()-(leftTop[1]+rightBottom[1])/2,0);var width=rightBottom[0]-leftTop[0],height=rightBottom[1]-leftTop[1];this._planeMesh.scale.set(width/2,height/2,1),this._particleSurface.resize(Math.max(Math.min(width,2048),1),Math.max(Math.min(height,2048),1)),this._renderer&amp;&amp;this._particleSurface.clearFrame(this._renderer)},_limitInViewportAndFullFill:function(leftTop,rightBottom,seriesModel,api){var newLeftTop=[Math.max(leftTop[0],0),Math.max(leftTop[1],0)],newRightBottom=[Math.min(rightBottom[0],api.getWidth()),Math.min(rightBottom[1],api.getHeight())];if("bmap"===seriesModel.get("coordinateSystem")){var lngRange=seriesModel.getData().getDataExtent(seriesModel.coordDimToDataDim("lng")[0]);Math.floor(lngRange[1]-lngRange[0])&gt;=359&amp;&amp;(newLeftTop[0]&gt;0&amp;&amp;(newLeftTop[0]=0),newRightBottom[0]&lt;api.getWidth()&amp;&amp;(newRightBottom[0]=api.getWidth()))}var width=rightBottom[0]-leftTop[0],height=rightBottom[1]-leftTop[1],newWidth=newRightBottom[0]-newLeftTop[0],newHeight=newRightBottom[1]-newLeftTop[1];return{leftTop:newLeftTop,rightBottom:newRightBottom,region:[(newLeftTop[0]-leftTop[0])/width,1-newHeight/height-(newLeftTop[1]-leftTop[1])/height,newWidth/width,newHeight/height]}},_updateCamera:function(width,height,dpr){this.viewGL.setViewport(0,0,width,height,dpr);var camera=this.viewGL.camera;camera.left=camera.bottom=0,camera.top=height,camera.right=width,camera.near=0,camera.far=100,camera.position.z=10},remove:function(){this._planeMesh.stopAnimation(),this.groupGL.removeAll()},dispose:function(){this._renderer&amp;&amp;this._particleSurface.dispose(this._renderer),this.groupGL.removeAll()}});use(function install$1(registers){registers.registerChartView(FlowGLView),registers.registerSeriesModel(FlowGLSeries)});var LinesGLSeries=SeriesModel.extend({type:"series.linesGL",dependencies:["grid","geo"],visualStyleAccessPath:"lineStyle",visualDrawType:"stroke",streamEnabled:!0,init:function(option){var result=this._processFlatCoordsArray(option.data);this._flatCoords=result.flatCoords,this._flatCoordsOffset=result.flatCoordsOffset,result.flatCoords&amp;&amp;(option.data=new Float32Array(result.count)),LinesGLSeries.superApply(this,"init",arguments)},mergeOption:function(option){var result=this._processFlatCoordsArray(option.data);this._flatCoords=result.flatCoords,this._flatCoordsOffset=result.flatCoordsOffset,result.flatCoords&amp;&amp;(option.data=new Float32Array(result.count)),LinesGLSeries.superApply(this,"mergeOption",arguments)},appendData:function(params){var result=this._processFlatCoordsArray(params.data);result.flatCoords&amp;&amp;(this._flatCoords?(this._flatCoords=concatArray(this._flatCoords,result.flatCoords),this._flatCoordsOffset=concatArray(this._flatCoordsOffset,result.flatCoordsOffset)):(this._flatCoords=result.flatCoords,this._flatCoordsOffset=result.flatCoordsOffset),params.data=new Float32Array(result.count)),this.getRawData().appendData(params.data)},_getCoordsFromItemModel:function(idx){var itemModel=this.getData().getItemModel(idx);return itemModel.option instanceof Array?itemModel.option:itemModel.getShallow("coords")},getLineCoordsCount:function(idx){return this._flatCoordsOffset?this._flatCoordsOffset[2*idx+1]:this._getCoordsFromItemModel(idx).length},getLineCoords:function(idx,out){if(this._flatCoordsOffset){for(var offset=this._flatCoordsOffset[2*idx],len=this._flatCoordsOffset[2*idx+1],i=0;i&lt;len;i++)out[i]=out[i]||[],out[i][0]=this._flatCoords[offset+2*i],out[i][1]=this._flatCoords[offset+2*i+1];return len}var coords=this._getCoordsFromItemModel(idx);for(i=0;i&lt;coords.length;i++)out[i]=out[i]||[],out[i][0]=coords[i][0],out[i][1]=coords[i][1];return coords.length},_processFlatCoordsArray:function(data){var startOffset=0;if(this._flatCoords&amp;&amp;(startOffset=this._flatCoords.length),"number"==typeof data[0]){for(var len=data.length,coordsOffsetAndLenStorage=new Uint32Array(len),coordsStorage=new Float64Array(len),coordsCursor=0,offsetCursor=0,dataCount=0,i=0;i&lt;len;){dataCount++;var count=data[i++];coordsOffsetAndLenStorage[offsetCursor++]=coordsCursor+startOffset,coordsOffsetAndLenStorage[offsetCursor++]=count;for(var k=0;k&lt;count;k++){var x=data[i++],y=data[i++];coordsStorage[coordsCursor++]=x,coordsStorage[coordsCursor++]=y}}return{flatCoordsOffset:new Uint32Array(coordsOffsetAndLenStorage.buffer,0,offsetCursor),flatCoords:coordsStorage,count:dataCount}}return{flatCoordsOffset:null,flatCoords:null,count:data.length}},getInitialData:function(option,ecModel){var lineData=new SeriesData(["value"],this);return lineData.hasItemOption=!1,lineData.initData(option.data,[],function(dataItem,dimName,dataIndex,dimIndex){if(dataItem instanceof Array)return NaN;lineData.hasItemOption=!0;var value=dataItem.value;return null!=value?value instanceof Array?value[dimIndex]:value:void 0}),lineData},defaultOption:{coordinateSystem:"geo",zlevel:10,progressive:1e4,progressiveThreshold:5e4,blendMode:"source-over",lineStyle:{opacity:.8},postEffect:{enable:!1,colorCorrection:{exposure:0,brightness:0,contrast:1,saturation:1,enable:!0}}}});const LinesGLView=ChartView.extend({type:"linesGL",__ecgl__:!0,init:function(ecModel,api){this.groupGL=new graphicGL.Node,this.viewGL=new ViewGL("orthographic"),this.viewGL.add(this.groupGL),this._glViewHelper=new GLViewHelper(this.viewGL),this._nativeLinesShader=graphicGL.createShader("ecgl.lines3D"),this._meshLinesShader=graphicGL.createShader("ecgl.meshLines3D"),this._linesMeshes=[],this._currentStep=0},render:function(seriesModel,ecModel,api){this.groupGL.removeAll(),this._glViewHelper.reset(seriesModel,api);var linesMesh=this._linesMeshes[0];linesMesh||(linesMesh=this._linesMeshes[0]=this._createLinesMesh(seriesModel)),this._linesMeshes.length=1,this.groupGL.add(linesMesh),this._updateLinesMesh(seriesModel,linesMesh,0,seriesModel.getData().count()),this.viewGL.setPostEffect(seriesModel.getModel("postEffect"),api)},incrementalPrepareRender:function(seriesModel,ecModel,api){this.groupGL.removeAll(),this._glViewHelper.reset(seriesModel,api),this._currentStep=0,this.viewGL.setPostEffect(seriesModel.getModel("postEffect"),api)},incrementalRender:function(params,seriesModel,ecModel,api){var linesMesh=this._linesMeshes[this._currentStep];linesMesh||(linesMesh=this._createLinesMesh(seriesModel),this._linesMeshes[this._currentStep]=linesMesh),this._updateLinesMesh(seriesModel,linesMesh,params.start,params.end),this.groupGL.add(linesMesh),api.getZr().refresh(),this._currentStep++},updateTransform:function(seriesModel,ecModel,api){seriesModel.coordinateSystem.getRoamTransform&amp;&amp;this._glViewHelper.updateTransform(seriesModel,api)},_createLinesMesh:function(seriesModel){return new graphicGL.Mesh({$ignorePicking:!0,material:new graphicGL.Material({shader:graphicGL.createShader("ecgl.lines3D"),transparent:!0,depthMask:!1,depthTest:!1}),geometry:new LinesGeometry$1({segmentScale:10,useNativeLine:!0,dynamic:!1}),mode:graphicGL.Mesh.LINES,culling:!1})},_updateLinesMesh:function(seriesModel,linesMesh,start,end){var data=seriesModel.getData();linesMesh.material.blend="lighter"===seriesModel.get("blendMode")?graphicGL.additiveBlend:null;var curveness=seriesModel.get("lineStyle.curveness")||0,isPolyline=seriesModel.get("polyline"),geometry=linesMesh.geometry,coordSys=seriesModel.coordinateSystem,lineWidth=retrieve_firstNotNull(seriesModel.get("lineStyle.width"),1);lineWidth&gt;1?(linesMesh.material.shader!==this._meshLinesShader&amp;&amp;linesMesh.material.attachShader(this._meshLinesShader),linesMesh.mode=graphicGL.Mesh.TRIANGLES):(linesMesh.material.shader!==this._nativeLinesShader&amp;&amp;linesMesh.material.attachShader(this._nativeLinesShader),linesMesh.mode=graphicGL.Mesh.LINES),start=start||0,end=end||data.count(),geometry.resetOffset();var vertexCount=0,triangleCount=0,p02=[],p12=[],p22=[],p3=[],lineCoords=[],t=.3;function updateBezierControlPoints(){p12[0]=.7*p02[0]+p3[0]*t-(p02[1]-p3[1])*curveness,p12[1]=.7*p02[1]+p3[1]*t-(p3[0]-p02[0])*curveness,p22[0]=p02[0]*t+.7*p3[0]-(p02[1]-p3[1])*curveness,p22[1]=p02[1]*t+.7*p3[1]-(p3[0]-p02[0])*curveness}if(isPolyline||0!==curveness)for(var idx=start;idx&lt;end;idx++)if(isPolyline){var count=seriesModel.getLineCoordsCount(idx);vertexCount+=geometry.getPolylineVertexCount(count),triangleCount+=geometry.getPolylineTriangleCount(count)}else seriesModel.getLineCoords(idx,lineCoords),this._glViewHelper.dataToPoint(coordSys,lineCoords[0],p02),this._glViewHelper.dataToPoint(coordSys,lineCoords[1],p3),updateBezierControlPoints(),vertexCount+=geometry.getCubicCurveVertexCount(p02,p12,p22,p3),triangleCount+=geometry.getCubicCurveTriangleCount(p02,p12,p22,p3);else{var lineCount=end-start;vertexCount+=lineCount*geometry.getLineVertexCount(),triangleCount+=lineCount*geometry.getLineVertexCount()}geometry.setVertexCount(vertexCount),geometry.setTriangleCount(triangleCount);var dataIndex=start,colorArr=[];for(idx=start;idx&lt;end;idx++){graphicGL.parseColor(getItemVisualColor(data,dataIndex),colorArr);var opacity=retrieve_firstNotNull(getItemVisualOpacity(data,dataIndex),1);colorArr[3]*=opacity;count=seriesModel.getLineCoords(idx,lineCoords);for(var k=0;k&lt;count;k++)this._glViewHelper.dataToPoint(coordSys,lineCoords[k],lineCoords[k]);isPolyline?geometry.addPolyline(lineCoords,colorArr,lineWidth,0,count):0!==curveness?(p02=lineCoords[0],p3=lineCoords[1],updateBezierControlPoints(),geometry.addCubicCurve(p02,p12,p22,p3,colorArr,lineWidth)):geometry.addPolyline(lineCoords,colorArr,lineWidth,0,2),dataIndex++}},dispose:function(){this.groupGL.removeAll()},remove:function(){this.groupGL.removeAll()}});use(function install(registers){registers.registerChartView(LinesGLView),registers.registerSeriesModel(LinesGLSeries)});const index=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"})),RememberMeCheckbox=({checked:checked,onChange:onChange,label:label="Remember me",disabled:disabled=!1})=&gt;{const theme=useTheme();return jsxRuntimeExports.jsx(FormControlLabel,{control:jsxRuntimeExports.jsx(Checkbox,{checked:checked,onChange:e2=&gt;onChange(e2.target.checked),disabled:disabled,icon:jsxRuntimeExports.jsx(CheckBoxOutlineBlankIcon,{sx:{color:alpha(theme.palette.common.white,.5),fontSize:20}}),checkedIcon:jsxRuntimeExports.jsx(CheckBoxIcon,{sx:{color:theme.palette.primary.main,fontSize:20}}),sx:{"&amp;:hover":{backgroundColor:alpha(theme.palette.primary.main,.1)}}}),label:jsxRuntimeExports.jsx(Typography$1,{variant:"body2",sx:{color:alpha(theme.palette.common.white,.8),userSelect:"none"},children:label}),sx:{ml:0,"&amp; .MuiFormControlLabel-label":{ml:1}}})},useRememberMe=()=&gt;{const EMAIL_KEY="rememberedEmail",isRemembered=React.useCallback(()=&gt;"true"===localStorage.getItem("rememberMe"),[]),getRememberedEmail=React.useCallback(()=&gt;isRemembered()&amp;&amp;localStorage.getItem(EMAIL_KEY)||"",[isRemembered]),setRememberMe=React.useCallback((email,remember)=&gt;{if(remember){localStorage.setItem("rememberMe","true"),localStorage.setItem(EMAIL_KEY,email);const token=btoa(`${email}:${Date.now()}`);localStorage.setItem("rememberToken",token)}else localStorage.removeItem("rememberMe"),localStorage.removeItem(EMAIL_KEY),localStorage.removeItem("rememberToken")},[]),clearRememberMe=React.useCallback(()=&gt;{localStorage.removeItem("rememberMe"),localStorage.removeItem(EMAIL_KEY),localStorage.removeItem("rememberToken")},[]),checkAutoLogin=React.useCallback(()=&gt;{if(isRemembered()){const token=localStorage.getItem("rememberToken");if(token)try{const[email,timestamp]=atob(token).split(":");if(Date.now()-parseInt(timestamp)&lt;2592e6)return{email:email,valid:!0}}catch{}}return{email:"",valid:!1}},[isRemembered]);return{isRemembered:isRemembered,getRememberedEmail:getRememberedEmail,setRememberMe:setRememberMe,clearRememberMe:clearRememberMe,checkAutoLogin:checkAutoLogin}},EnhancedAuthError=({error:error,onDismiss:onDismiss,onResetPassword:onResetPassword,onContactSupport:onContactSupport})=&gt;{var _a;const[expanded,setExpanded]=React.useState(!1);if(!error)return null;const errorConfig=getAuthErrorMessage(error),hasSuggestions=errorConfig.suggestions&amp;&amp;errorConfig.suggestions.length&gt;0;return jsxRuntimeExports.jsxs(Alert,{severity:"error",sx:{mb:3,background:"rgba(211, 47, 47, 0.1)",backdropFilter:"blur(10px)",border:"1px solid rgba(211, 47, 47, 0.3)","&amp; .MuiAlert-icon":{color:"#ff5252"}},action:onDismiss&amp;&amp;jsxRuntimeExports.jsx(IconButton,{"aria-label":"close",color:"inherit",size:"small",onClick:onDismiss,children:jsxRuntimeExports.jsx(Close,{fontSize:"inherit"})}),children:[jsxRuntimeExports.jsx(AlertTitle,{sx:{fontWeight:600},children:errorConfig.message}),hasSuggestions&amp;&amp;jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsxs(Box,{sx:{display:"flex",alignItems:"center",mt:1},children:[jsxRuntimeExports.jsx(Typography$1,{variant:"body2",sx:{flexGrow:1},children:"Need help? Here are some suggestions"}),jsxRuntimeExports.jsx(IconButton,{size:"small",onClick:()=&gt;setExpanded(!expanded),sx:{ml:1},children:expanded?jsxRuntimeExports.jsx(ExpandLess,{}):jsxRuntimeExports.jsx(ExpandMoreIcon,{})})]}),jsxRuntimeExports.jsx(Collapse,{in:expanded,children:jsxRuntimeExports.jsx(List,{dense:!0,sx:{mt:1},children:null==(_a=errorConfig.suggestions)?void 0:_a.map((suggestion,index2)=&gt;jsxRuntimeExports.jsxs(ListItem,{sx:{py:.5,px:0},children:[jsxRuntimeExports.jsx(ListItemIcon,{sx:{minWidth:32},children:jsxRuntimeExports.jsx(CheckCircleIcon,{fontSize:"small",sx:{color:"success.main"}})}),jsxRuntimeExports.jsx(ListItemText,{primary:suggestion,primaryTypographyProps:{variant:"body2",sx:{color:"text.secondary"}}})]},index2))})})]}),jsxRuntimeExports.jsxs(Box,{sx:{mt:2,display:"flex",gap:1,flexWrap:"wrap"},children:[errorConfig.showResetPassword&amp;&amp;onResetPassword&amp;&amp;jsxRuntimeExports.jsx(Button,{size:"small",variant:"outlined",startIcon:jsxRuntimeExports.jsx(LockIcon,{}),onClick:onResetPassword,sx:{borderColor:"rgba(255, 255, 255, 0.3)",color:"rgba(255, 255, 255, 0.9)","&amp;:hover":{borderColor:"rgba(255, 255, 255, 0.5)",background:"rgba(255, 255, 255, 0.1)"}},children:"Reset Password"}),errorConfig.showContactSupport&amp;&amp;onContactSupport&amp;&amp;jsxRuntimeExports.jsx(Button,{size:"small",variant:"outlined",startIcon:jsxRuntimeExports.jsx(Email,{}),onClick:onContactSupport,sx:{borderColor:"rgba(255, 255, 255, 0.3)",color:"rgba(255, 255, 255, 0.9)","&amp;:hover":{borderColor:"rgba(255, 255, 255, 0.5)",background:"rgba(255, 255, 255, 0.1)"}},children:"Contact Support"})]})]})},SSOButtons=({onGoogleSignIn:onGoogleSignIn,onMicrosoftSignIn:onMicrosoftSignIn,isLoading:isLoading=!1,disabled:disabled=!1})=&gt;jsxRuntimeExports.jsxs(Box,{sx:{width:"100%"},children:[jsxRuntimeExports.jsxs(Box,{sx:{position:"relative",my:3},children:[jsxRuntimeExports.jsx(Divider,{sx:{borderColor:"rgba(255, 255, 255, 0.2)"}}),jsxRuntimeExports.jsx(Typography$1,{variant:"body2",sx:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",backgroundColor:"rgba(0, 0, 0, 0.5)",px:2,color:"rgba(255, 255, 255, 0.7)"},children:"OR"})]}),jsxRuntimeExports.jsxs(Box,{sx:{display:"flex",flexDirection:"column",gap:2},children:[jsxRuntimeExports.jsx(Button,{fullWidth:!0,variant:"outlined",size:"large",onClick:onGoogleSignIn,disabled:disabled||isLoading,startIcon:isLoading?jsxRuntimeExports.jsx(CircularProgress,{size:20}):jsxRuntimeExports.jsx(GoogleIcon,{}),sx:{py:1.5,borderColor:"rgba(255, 255, 255, 0.2)",color:"white",backgroundColor:"rgba(255, 255, 255, 0.05)",backdropFilter:"blur(10px)","&amp;:hover":{borderColor:"rgba(255, 255, 255, 0.3)",backgroundColor:"rgba(255, 255, 255, 0.1)"},"&amp; .MuiButton-startIcon":{color:isLoading?"inherit":"#4285F4"}},children:"Continue with Google"}),jsxRuntimeExports.jsx(Button,{fullWidth:!0,variant:"outlined",size:"large",onClick:onMicrosoftSignIn,disabled:disabled||isLoading,startIcon:isLoading?jsxRuntimeExports.jsx(CircularProgress,{size:20}):jsxRuntimeExports.jsx(BusinessIcon,{}),sx:{py:1.5,borderColor:"rgba(255, 255, 255, 0.2)",color:"white",backgroundColor:"rgba(255, 255, 255, 0.05)",backdropFilter:"blur(10px)","&amp;:hover":{borderColor:"rgba(255, 255, 255, 0.3)",backgroundColor:"rgba(255, 255, 255, 0.1)"},"&amp; .MuiButton-startIcon":{color:isLoading?"inherit":"#0078D4"}},children:"Continue with Microsoft"})]}),jsxRuntimeExports.jsx(Typography$1,{variant:"caption",sx:{display:"block",textAlign:"center",mt:2,color:"rgba(255, 255, 255, 0.5)"},children:"Secure authentication powered by Firebase"})]}),float=keyframes`</span>
<span class="cstat-no" title="statement not covered" >  0%, 100% {</span>
<span class="cstat-no" title="statement not covered" >    transform: translateY(0);</span>
<span class="cstat-no" title="statement not covered" >  }</span>
<span class="cstat-no" title="statement not covered" >  50% {</span>
<span class="cstat-no" title="statement not covered" >    transform: translateY(-10px);</span>
<span class="cstat-no" title="statement not covered" >  }</span>
<span class="cstat-no" title="statement not covered" >`,pulse$2=keyframes`</span>
<span class="cstat-no" title="statement not covered" >  0%, 100% {</span>
<span class="cstat-no" title="statement not covered" >    transform: scale(1);</span>
<span class="cstat-no" title="statement not covered" >    opacity: 1;</span>
<span class="cstat-no" title="statement not covered" >  }</span>
<span class="cstat-no" title="statement not covered" >  50% {</span>
<span class="cstat-no" title="statement not covered" >    transform: scale(1.05);</span>
<span class="cstat-no" title="statement not covered" >    opacity: 0.8;</span>
<span class="cstat-no" title="statement not covered" >  }</span>
<span class="cstat-no" title="statement not covered" >`,sparkle=keyframes`</span>
<span class="cstat-no" title="statement not covered" >  0% {</span>
<span class="cstat-no" title="statement not covered" >    transform: scale(0) rotate(0deg);</span>
<span class="cstat-no" title="statement not covered" >    opacity: 1;</span>
<span class="cstat-no" title="statement not covered" >  }</span>
<span class="cstat-no" title="statement not covered" >  50% {</span>
<span class="cstat-no" title="statement not covered" >    transform: scale(1) rotate(180deg);</span>
<span class="cstat-no" title="statement not covered" >    opacity: 1;</span>
<span class="cstat-no" title="statement not covered" >  }</span>
<span class="cstat-no" title="statement not covered" >  100% {</span>
<span class="cstat-no" title="statement not covered" >    transform: scale(0) rotate(360deg);</span>
<span class="cstat-no" title="statement not covered" >    opacity: 0;</span>
<span class="cstat-no" title="statement not covered" >  }</span>
<span class="cstat-no" title="statement not covered" >`,OnboardingFlow=({open:open,onClose:onClose,onComplete:onComplete,userProgress:userProgress={hasCreatedDashboard:!1,hasAddedMonitor:!1,hasCustomizedLayout:!1,hasSharedDashboard:!1}})=&gt;{const theme=useTheme(),[activeStep,setActiveStep]=reactExports.useState(0),[completed,setCompleted]=reactExports.useState([]),[showConfetti,setShowConfetti]=reactExports.useState(!1),steps=[{label:"Welcome",title:"Welcome to Building Vitals! ",description:"Let's get you started with monitoring your building's performance",icon:jsxRuntimeExports.jsx(LightbulbIcon,{}),content:jsxRuntimeExports.jsxs(Box,{children:[jsxRuntimeExports.jsxs(Box,{sx:{position:"relative",width:200,height:200,margin:"0 auto",mb:3},children:[jsxRuntimeExports.jsx(Box,{sx:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:150,height:150,borderRadius:"50%",background:`linear-gradient(135deg, ${theme.palette.primary.main} 0%, ${theme.palette.primary.light} 100%)`,opacity:.2,animation:`${pulse$2} 2s ease-in-out infinite`}}),jsxRuntimeExports.jsx(Dashboard,{sx:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",fontSize:80,color:theme.palette.primary.main,animation:`${float} 3s ease-in-out infinite`}})]}),jsxRuntimeExports.jsx(Typography$1,{variant:"h5",gutterBottom:!0,align:"center",children:"Building Vitals Dashboard"}),jsxRuntimeExports.jsx(Typography$1,{variant:"body1",color:"text.secondary",align:"center",children:"Your all-in-one solution for monitoring and analyzing building performance data in real-time."}),jsxRuntimeExports.jsxs(Box,{sx:{mt:3,display:"flex",gap:1,justifyContent:"center",flexWrap:"wrap"},children:[jsxRuntimeExports.jsx(Chip,{label:"Real-time Monitoring",size:"small"}),jsxRuntimeExports.jsx(Chip,{label:"Data Analytics",size:"small"}),jsxRuntimeExports.jsx(Chip,{label:"Custom Dashboards",size:"small"}),jsxRuntimeExports.jsx(Chip,{label:"Team Collaboration",size:"small"})]})]})},{label:"Create Dashboard",title:"Create Your First Dashboard",description:"Dashboards organize your monitors and visualizations",icon:jsxRuntimeExports.jsx(Dashboard,{}),actionLabel:"Create Dashboard",action:()=&gt;console.log("Create dashboard"),content:jsxRuntimeExports.jsxs(Box,{children:[jsxRuntimeExports.jsxs(Paper,{sx:{p:3,mb:3,backgroundColor:alpha(theme.palette.primary.main,.05),border:`1px solid ${alpha(theme.palette.primary.main,.3)}`,borderRadius:2},children:[jsxRuntimeExports.jsx(Typography$1,{variant:"h6",gutterBottom:!0,children:"What is a Dashboard?"}),jsxRuntimeExports.jsx(Typography$1,{variant:"body2",color:"text.secondary",children:"A dashboard is a collection of charts and monitors that help you visualize your building's data. You can create multiple dashboards for different purposes:"}),jsxRuntimeExports.jsxs(Box,{sx:{mt:2,display:"flex",flexDirection:"column",gap:1},children:[jsxRuntimeExports.jsxs(Box,{sx:{display:"flex",alignItems:"center",gap:1},children:[jsxRuntimeExports.jsx(Check,{sx:{fontSize:20,color:theme.palette.success.main}}),jsxRuntimeExports.jsx(Typography$1,{variant:"body2",children:"Energy consumption overview"})]}),jsxRuntimeExports.jsxs(Box,{sx:{display:"flex",alignItems:"center",gap:1},children:[jsxRuntimeExports.jsx(Check,{sx:{fontSize:20,color:theme.palette.success.main}}),jsxRuntimeExports.jsx(Typography$1,{variant:"body2",children:"HVAC system performance"})]}),jsxRuntimeExports.jsxs(Box,{sx:{display:"flex",alignItems:"center",gap:1},children:[jsxRuntimeExports.jsx(Check,{sx:{fontSize:20,color:theme.palette.success.main}}),jsxRuntimeExports.jsx(Typography$1,{variant:"body2",children:"Environmental conditions"})]})]})]}),userProgress.hasCreatedDashboard&amp;&amp;jsxRuntimeExports.jsx(Chip,{icon:jsxRuntimeExports.jsx(Check,{}),label:"Dashboard Created!",color:"success",sx:{width:"100%"}})]})},{label:"Add Monitors",title:"Add Your First Monitor",description:"Monitors display real-time data from your building sensors",icon:jsxRuntimeExports.jsx(AddIcon,{}),actionLabel:"Add Monitor",action:()=&gt;console.log("Add monitor"),content:jsxRuntimeExports.jsxs(Box,{children:[jsxRuntimeExports.jsx(Box,{sx:{mb:3},children:jsxRuntimeExports.jsx(Typography$1,{variant:"body1",gutterBottom:!0,children:"Follow these simple steps to add a monitor:"})}),jsxRuntimeExports.jsxs(Stepper,{orientation:"vertical",sx:{mb:3},children:[jsxRuntimeExports.jsxs(Step,{active:!0,children:[jsxRuntimeExports.jsx(StepLabel,{children:"Select a Site"}),jsxRuntimeExports.jsx(StepContent,{children:jsxRuntimeExports.jsx(Typography$1,{variant:"body2",color:"text.secondary",children:"Choose from your connected building sites"})})]}),jsxRuntimeExports.jsxs(Step,{active:!0,children:[jsxRuntimeExports.jsx(StepLabel,{children:"Choose Data Points"}),jsxRuntimeExports.jsx(StepContent,{children:jsxRuntimeExports.jsx(Typography$1,{variant:"body2",color:"text.secondary",children:"Pick sensors like temperature, energy, or occupancy"})})]}),jsxRuntimeExports.jsxs(Step,{active:!0,children:[jsxRuntimeExports.jsx(StepLabel,{children:"Select Visualization"}),jsxRuntimeExports.jsx(StepContent,{children:jsxRuntimeExports.jsx(Typography$1,{variant:"body2",color:"text.secondary",children:"Choose from 15+ chart types including line, bar, gauge, and 3D"})})]})]}),jsxRuntimeExports.jsx(Paper,{sx:{p:2,backgroundColor:alpha(theme.palette.info.main,.05),border:`1px solid ${alpha(theme.palette.info.main,.3)}`,borderRadius:1},children:jsxRuntimeExports.jsxs(Box,{sx:{display:"flex",alignItems:"center",gap:1},children:[jsxRuntimeExports.jsx(LightbulbIcon,{sx:{color:theme.palette.info.main}}),jsxRuntimeExports.jsxs(Typography$1,{variant:"body2",children:[jsxRuntimeExports.jsx("strong",{children:"Pro Tip:"})," Start with a time series chart to see historical trends"]})]})})]})},{label:"Customize Layout",title:"Customize Your Layout",description:"Drag and resize monitors to create your perfect dashboard",icon:jsxRuntimeExports.jsx(SettingsIcon,{}),content:jsxRuntimeExports.jsxs(Box,{children:[jsxRuntimeExports.jsxs(Box,{sx:{position:"relative",height:200,mb:3,borderRadius:2,overflow:"hidden",backgroundColor:alpha(theme.palette.primary.main,.05),border:`1px solid ${alpha(theme.palette.primary.main,.2)}`},children:[jsxRuntimeExports.jsx(Box,{sx:{position:"absolute",top:10,left:10,width:80,height:60,backgroundColor:alpha(theme.palette.primary.main,.2),borderRadius:1,animation:`${float} 4s ease-in-out infinite`}}),jsxRuntimeExports.jsx(Box,{sx:{position:"absolute",top:10,right:10,width:120,height:60,backgroundColor:alpha(theme.palette.secondary.main,.2),borderRadius:1,animation:`${float} 4s ease-in-out infinite 0.5s`}}),jsxRuntimeExports.jsx(Box,{sx:{position:"absolute",bottom:10,left:10,right:10,height:100,backgroundColor:alpha(theme.palette.success.main,.2),borderRadius:1,animation:`${float} 4s ease-in-out infinite 1s`}})]}),jsxRuntimeExports.jsx(Typography$1,{variant:"h6",gutterBottom:!0,children:"Layout Features:"}),jsxRuntimeExports.jsxs(Box,{sx:{display:"flex",flexDirection:"column",gap:2},children:[jsxRuntimeExports.jsxs(Box,{sx:{display:"flex",alignItems:"center",gap:2},children:[jsxRuntimeExports.jsx(Paper,{sx:{p:1,backgroundColor:alpha(theme.palette.primary.main,.1),borderRadius:"50%"},children:jsxRuntimeExports.jsx(TrendingUp,{sx:{color:theme.palette.primary.main}})}),jsxRuntimeExports.jsxs(Box,{children:[jsxRuntimeExports.jsx(Typography$1,{variant:"body2",fontWeight:600,children:"Drag &amp; Drop"}),jsxRuntimeExports.jsx(Typography$1,{variant:"caption",color:"text.secondary",children:"Rearrange monitors by dragging them to new positions"})]})]}),jsxRuntimeExports.jsxs(Box,{sx:{display:"flex",alignItems:"center",gap:2},children:[jsxRuntimeExports.jsx(Paper,{sx:{p:1,backgroundColor:alpha(theme.palette.secondary.main,.1),borderRadius:"50%"},children:jsxRuntimeExports.jsx(SettingsIcon,{sx:{color:theme.palette.secondary.main}})}),jsxRuntimeExports.jsxs(Box,{children:[jsxRuntimeExports.jsx(Typography$1,{variant:"body2",fontWeight:600,children:"Resize"}),jsxRuntimeExports.jsx(Typography$1,{variant:"caption",color:"text.secondary",children:"Make monitors larger or smaller to fit your needs"})]})]})]})]})},{label:"Share &amp; Collaborate",title:"Share Your Dashboard",description:"Collaborate with your team by sharing dashboards",icon:jsxRuntimeExports.jsx(Share,{}),content:jsxRuntimeExports.jsxs(Box,{children:[jsxRuntimeExports.jsxs(Box,{sx:{mb:3,textAlign:"center"},children:[jsxRuntimeExports.jsx(Share,{sx:{fontSize:60,color:theme.palette.primary.main,mb:2}}),jsxRuntimeExports.jsx(Typography$1,{variant:"h6",gutterBottom:!0,children:"Collaboration Made Easy"}),jsxRuntimeExports.jsx(Typography$1,{variant:"body2",color:"text.secondary",children:"Share your dashboards with team members to keep everyone informed"})]}),jsxRuntimeExports.jsxs(Box,{sx:{display:"flex",flexDirection:"column",gap:2},children:[jsxRuntimeExports.jsxs(Paper,{sx:{p:2,backgroundColor:alpha(theme.palette.background.paper,.8),border:`1px solid ${alpha(theme.palette.divider,.2)}`},children:[jsxRuntimeExports.jsx(Typography$1,{variant:"subtitle2",gutterBottom:!0,children:"Share via Link"}),jsxRuntimeExports.jsx(Typography$1,{variant:"caption",color:"text.secondary",children:"Generate a secure link that others can use to view your dashboard"})]}),jsxRuntimeExports.jsxs(Paper,{sx:{p:2,backgroundColor:alpha(theme.palette.background.paper,.8),border:`1px solid ${alpha(theme.palette.divider,.2)}`},children:[jsxRuntimeExports.jsx(Typography$1,{variant:"subtitle2",gutterBottom:!0,children:"Export Reports"}),jsxRuntimeExports.jsx(Typography$1,{variant:"caption",color:"text.secondary",children:"Download dashboard data as PDF or CSV for offline analysis"})]}),jsxRuntimeExports.jsxs(Paper,{sx:{p:2,backgroundColor:alpha(theme.palette.background.paper,.8),border:`1px solid ${alpha(theme.palette.divider,.2)}`},children:[jsxRuntimeExports.jsx(Typography$1,{variant:"subtitle2",gutterBottom:!0,children:"Set Permissions"}),jsxRuntimeExports.jsx(Typography$1,{variant:"caption",color:"text.secondary",children:"Control who can view or edit your dashboards"})]})]})]})}],handleSkip=()=&gt;{onClose()},progress=(activeStep+1)/steps.length*100;return jsxRuntimeExports.jsxs(Dialog,{open:open,onClose:handleSkip,maxWidth:"sm",fullWidth:!0,PaperProps:{sx:{backgroundColor:alpha(theme.palette.background.paper,.95),backdropFilter:"blur(20px)",WebkitBackdropFilter:"blur(20px)",border:`1px solid ${alpha(theme.palette.divider,.2)}`,borderRadius:2}},children:[jsxRuntimeExports.jsx(LinearProgress,{variant:"determinate",value:progress,sx:{height:4,backgroundColor:alpha(theme.palette.primary.main,.1),"&amp; .MuiLinearProgress-bar":{backgroundColor:theme.palette.primary.main,transition:"transform 0.3s ease"}}}),jsxRuntimeExports.jsx(IconButton,{onClick:handleSkip,sx:{position:"absolute",right:8,top:8,zIndex:1},children:jsxRuntimeExports.jsx(Close,{})}),jsxRuntimeExports.jsxs(DialogContent,{sx:{pt:4,pb:2},children:[jsxRuntimeExports.jsx(Zoom,{in:!0,children:jsxRuntimeExports.jsx(Box,{sx:{display:"flex",justifyContent:"center",mb:3},children:jsxRuntimeExports.jsxs(Box,{sx:{p:2,borderRadius:"50%",backgroundColor:alpha(theme.palette.primary.main,.1),color:theme.palette.primary.main,position:"relative"},children:[steps[activeStep].icon,showConfetti&amp;&amp;jsxRuntimeExports.jsx(jsxRuntimeExports.Fragment,{children:[...Array(6)].map((_,i)=&gt;jsxRuntimeExports.jsx(Box,{sx:{position:"absolute",width:4,height:4,backgroundColor:theme.palette.primary.main,borderRadius:"50%",top:"50%",left:"50%",animation:`${sparkle} 1s ease-out infinite ${.1*i}s`}},i))})]})})},activeStep),jsxRuntimeExports.jsx(Fade,{in:!0,children:jsxRuntimeExports.jsxs(Box,{children:[jsxRuntimeExports.jsx(Typography$1,{variant:"h5",align:"center",gutterBottom:!0,children:steps[activeStep].title}),jsxRuntimeExports.jsx(Typography$1,{variant:"body2",color:"text.secondary",align:"center",sx:{mb:3},children:steps[activeStep].description}),steps[activeStep].content]})},`content-${activeStep}`),showConfetti&amp;&amp;jsxRuntimeExports.jsx(Fade,{in:!0,children:jsxRuntimeExports.jsx(Box,{sx:{position:"absolute",top:0,left:0,right:0,bottom:0,display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:alpha(theme.palette.background.paper,.95),zIndex:10},children:jsxRuntimeExports.jsxs(Box,{sx:{textAlign:"center"},children:[jsxRuntimeExports.jsx(CelebrationIcon,{sx:{fontSize:80,color:theme.palette.primary.main,mb:2,animation:`${pulse$2} 1s ease-in-out infinite`}}),jsxRuntimeExports.jsx(Typography$1,{variant:"h4",gutterBottom:!0,children:"You're All Set! "}),jsxRuntimeExports.jsx(Typography$1,{variant:"body1",color:"text.secondary",children:"You're ready to start monitoring your building"})]})})})]}),jsxRuntimeExports.jsxs(DialogActions,{sx:{px:3,pb:3},children:[jsxRuntimeExports.jsx(Button,{onClick:handleSkip,sx:{mr:"auto"},children:"Skip Tour"}),jsxRuntimeExports.jsxs(Box,{sx:{display:"flex",gap:1},children:[activeStep&gt;0&amp;&amp;jsxRuntimeExports.jsx(Button,{onClick:()=&gt;{setActiveStep(activeStep-1)},startIcon:jsxRuntimeExports.jsx(ArrowBack,{}),variant:"outlined",children:"Back"}),steps[activeStep].action&amp;&amp;jsxRuntimeExports.jsx(Button,{onClick:steps[activeStep].action,variant:"outlined",color:"primary",startIcon:jsxRuntimeExports.jsx(PlayIcon,{}),children:steps[activeStep].actionLabel}),jsxRuntimeExports.jsx(Button,{onClick:()=&gt;{activeStep&lt;steps.length-1?(setCompleted([...completed,activeStep]),setActiveStep(activeStep+1)):(setShowConfetti(!0),setTimeout(()=&gt;{onComplete()},2e3))},endIcon:activeStep===steps.length-1?jsxRuntimeExports.jsx(Check,{}):jsxRuntimeExports.jsx(ArrowForward,{}),variant:"contained",children:activeStep===steps.length-1?"Complete":"Next"})]})]})]})},fadeIn=keyframes`</span>
<span class="cstat-no" title="statement not covered" >  from {</span>
<span class="cstat-no" title="statement not covered" >    opacity: 0;</span>
<span class="cstat-no" title="statement not covered" >    transform: translateY(10px);</span>
<span class="cstat-no" title="statement not covered" >  }</span>
<span class="cstat-no" title="statement not covered" >  to {</span>
<span class="cstat-no" title="statement not covered" >    opacity: 1;</span>
<span class="cstat-no" title="statement not covered" >    transform: translateY(0);</span>
<span class="cstat-no" title="statement not covered" >  }</span>
<span class="cstat-no" title="statement not covered" >`,pulse$1=keyframes`</span>
<span class="cstat-no" title="statement not covered" >  0%, 100% {</span>
<span class="cstat-no" title="statement not covered" >    transform: scale(1);</span>
<span class="cstat-no" title="statement not covered" >  }</span>
<span class="cstat-no" title="statement not covered" >  50% {</span>
<span class="cstat-no" title="statement not covered" >    transform: scale(1.05);</span>
<span class="cstat-no" title="statement not covered" >  }</span>
<span class="cstat-no" title="statement not covered" >`,KeyboardNavigationContext=React.createContext(null),KeyboardNavigationProvider=({children:children,enabled:enabled=!0,showVisualGuide:showVisualGuide=!0})=&gt;{const[elements,setElements]=reactExports.useState([]),[currentFocus,setCurrentFocus]=reactExports.useState(-1),[showHelper,setShowHelper]=reactExports.useState(!1),registerElement=reactExports.useCallback(element=&gt;{setElements(prev=&gt;{if(prev.some(el=&gt;el.element===element.element))return prev;return[...prev,element].sort((a,b)=&gt;a.index-b.index)})},[]),unregisterElement=reactExports.useCallback(element=&gt;{setElements(prev=&gt;prev.filter(el=&gt;el.element!==element))},[]),focusNext=reactExports.useCallback(()=&gt;{enabled&amp;&amp;0!==elements.length&amp;&amp;setCurrentFocus(prev=&gt;{var _a,_b;const next=(prev+1)%elements.length;return null==(_a=elements[next])||_a.element.focus(),null==(_b=elements[next])||_b.element.scrollIntoView({behavior:"smooth",block:"center"}),next})},[enabled,elements]),focusPrevious=reactExports.useCallback(()=&gt;{enabled&amp;&amp;0!==elements.length&amp;&amp;setCurrentFocus(prev=&gt;{var _a,_b;const next=prev&lt;=0?elements.length-1:prev-1;return null==(_a=elements[next])||_a.element.focus(),null==(_b=elements[next])||_b.element.scrollIntoView({behavior:"smooth",block:"center"}),next})},[enabled,elements]),activateCurrent=reactExports.useCallback(()=&gt;{if(!enabled||currentFocus&lt;0||currentFocus&gt;=elements.length)return;const current=elements[currentFocus];current&amp;&amp;current.element.click()},[enabled,currentFocus,elements]);useHotkeys("tab",e2=&gt;{enabled&amp;&amp;(e2.preventDefault(),focusNext())},{enableOnFormTags:!0}),useHotkeys("shift+tab",e2=&gt;{enabled&amp;&amp;(e2.preventDefault(),focusPrevious())},{enableOnFormTags:!0}),useHotkeys("enter, space",e2=&gt;{enabled&amp;&amp;currentFocus&gt;=0&amp;&amp;(e2.preventDefault(),activateCurrent())},{enableOnFormTags:!1}),useHotkeys("ctrl+shift+k",()=&gt;{setShowHelper(!showHelper)});const value={currentFocus:currentFocus,elements:elements,registerElement:registerElement,unregisterElement:unregisterElement,focusNext:focusNext,focusPrevious:focusPrevious,activateCurrent:activateCurrent};return jsxRuntimeExports.jsxs(KeyboardNavigationContext.Provider,{value:value,children:[children,showVisualGuide&amp;&amp;showHelper&amp;&amp;jsxRuntimeExports.jsx(KeyboardNavigationHelper,{elements:elements,currentFocus:currentFocus,onClose:()=&gt;setShowHelper(!1)})]})},KeyboardNavigationHelper=({elements:elements,currentFocus:currentFocus,onClose:onClose})=&gt;{const theme=useTheme();return jsxRuntimeExports.jsx(Portal,{children:jsxRuntimeExports.jsxs(Paper,{sx:{position:"fixed",bottom:20,right:20,p:3,maxWidth:400,backgroundColor:alpha(theme.palette.background.paper,.95),backdropFilter:"blur(20px)",WebkitBackdropFilter:"blur(20px)",border:`1px solid ${alpha(theme.palette.divider,.2)}`,borderRadius:2,boxShadow:`0 8px 32px ${alpha(theme.palette.common.black,.2)}`,animation:`${fadeIn} 0.3s ease-out`,zIndex:9999},children:[jsxRuntimeExports.jsxs(Box,{sx:{display:"flex",alignItems:"center",gap:1,mb:2},children:[jsxRuntimeExports.jsx(Keyboard,{sx:{color:theme.palette.primary.main}}),jsxRuntimeExports.jsx(Typography$1,{variant:"h6",children:"Keyboard Navigation"}),jsxRuntimeExports.jsx(Chip,{label:"Ctrl+Shift+K to toggle",size:"small",sx:{ml:"auto"}})]}),jsxRuntimeExports.jsxs(Box,{sx:{mb:2},children:[jsxRuntimeExports.jsx(Typography$1,{variant:"subtitle2",gutterBottom:!0,children:"Navigation Controls:"}),jsxRuntimeExports.jsxs(Box,{sx:{display:"flex",gap:1,flexWrap:"wrap"},children:[jsxRuntimeExports.jsx(Chip,{icon:jsxRuntimeExports.jsx(ArrowDownIcon,{}),label:"Tab",size:"small",variant:"outlined"}),jsxRuntimeExports.jsx(Chip,{icon:jsxRuntimeExports.jsx(ArrowUpIcon,{}),label:"Shift+Tab",size:"small",variant:"outlined"}),jsxRuntimeExports.jsx(Chip,{icon:jsxRuntimeExports.jsx(Check,{}),label:"Enter/Space",size:"small",variant:"outlined"})]})]}),jsxRuntimeExports.jsxs(Box,{children:[jsxRuntimeExports.jsxs(Typography$1,{variant:"subtitle2",gutterBottom:!0,children:["Focusable Elements (",elements.length,"):"]}),jsxRuntimeExports.jsx(Box,{sx:{maxHeight:200,overflow:"auto"},children:elements.map((el,index2)=&gt;jsxRuntimeExports.jsx(Box,{sx:{p:1,mb:.5,borderRadius:1,backgroundColor:index2===currentFocus?alpha(theme.palette.primary.main,.2):"transparent",border:`1px solid ${index2===currentFocus?theme.palette.primary.main:alpha(theme.palette.divider,.2)}`,transition:"all 0.2s ease",animation:index2===currentFocus?`${pulse$1} 1s ease-in-out infinite`:"none"},children:jsxRuntimeExports.jsxs(Typography$1,{variant:"caption",children:[index2+1,". ",el.label," (",el.type,")"]})},index2))})]})]})})},shimmer$1=keyframes`</span>
<span class="cstat-no" title="statement not covered" >  0% {</span>
<span class="cstat-no" title="statement not covered" >    transform: translateX(-100%);</span>
<span class="cstat-no" title="statement not covered" >  }</span>
<span class="cstat-no" title="statement not covered" >  100% {</span>
<span class="cstat-no" title="statement not covered" >    transform: translateX(100%);</span>
<span class="cstat-no" title="statement not covered" >  }</span>
<span class="cstat-no" title="statement not covered" >`;keyframes`</span>
<span class="cstat-no" title="statement not covered" >  0% {</span>
<span class="cstat-no" title="statement not covered" >    transform: scale(0.9);</span>
<span class="cstat-no" title="statement not covered" >    opacity: 0.6;</span>
<span class="cstat-no" title="statement not covered" >  }</span>
<span class="cstat-no" title="statement not covered" >  50% {</span>
<span class="cstat-no" title="statement not covered" >    transform: scale(1.05);</span>
<span class="cstat-no" title="statement not covered" >    opacity: 0.9;</span>
<span class="cstat-no" title="statement not covered" >  }</span>
<span class="cstat-no" title="statement not covered" >  100% {</span>
<span class="cstat-no" title="statement not covered" >    transform: scale(0.9);</span>
<span class="cstat-no" title="statement not covered" >    opacity: 0.6;</span>
<span class="cstat-no" title="statement not covered" >  }</span>
<span class="cstat-no" title="statement not covered" >`,keyframes`</span>
<span class="cstat-no" title="statement not covered" >  from {</span>
<span class="cstat-no" title="statement not covered" >    transform: rotate(0deg);</span>
<span class="cstat-no" title="statement not covered" >  }</span>
<span class="cstat-no" title="statement not covered" >  to {</span>
<span class="cstat-no" title="statement not covered" >    transform: rotate(360deg);</span>
<span class="cstat-no" title="statement not covered" >  }</span>
<span class="cstat-no" title="statement not covered" >`,keyframes`</span>
<span class="cstat-no" title="statement not covered" >  0%, 100% {</span>
<span class="cstat-no" title="statement not covered" >    transform: translateY(0px);</span>
<span class="cstat-no" title="statement not covered" >  }</span>
<span class="cstat-no" title="statement not covered" >  50% {</span>
<span class="cstat-no" title="statement not covered" >    transform: translateY(-10px);</span>
<span class="cstat-no" title="statement not covered" >  }</span>
<span class="cstat-no" title="statement not covered" >`;const ChartSkeletonLoader=({height:height=300,chartType:chartType="line",showHeader:showHeader=!0,showLegend:showLegend=!1,animated:animated=!0})=&gt;{const commonSx={backgroundColor:alpha(sesColorPalette.primary,.05),"&amp;::after":animated?{background:`linear-gradient(90deg, transparent, ${alpha(sesColorPalette.accent,.1)}, transparent)`}:void 0};return jsxRuntimeExports.jsxs(Card,{sx:{...glassEffect.medium,position:"relative",overflow:"hidden","&amp;::before":animated?{content:'""',position:"absolute",top:0,left:"-100%",width:"100%",height:"100%",background:`linear-gradient(90deg, transparent, ${alpha(sesColorPalette.accent,.05)}, transparent)`,animation:`${shimmer$1} 3s infinite`,zIndex:1}:void 0},children:[showHeader&amp;&amp;jsxRuntimeExports.jsx(CardHeader,{title:jsxRuntimeExports.jsx(Skeleton,{variant:"text",width:"40%",height:24,sx:commonSx}),action:jsxRuntimeExports.jsxs(Box,{sx:{display:"flex",gap:1},children:[jsxRuntimeExports.jsx(Skeleton,{variant:"circular",width:32,height:32,sx:commonSx}),jsxRuntimeExports.jsx(Skeleton,{variant:"circular",width:32,height:32,sx:commonSx})]})}),jsxRuntimeExports.jsx(CardContent,{children:jsxRuntimeExports.jsxs(Box,{sx:{height:height,display:"flex",flexDirection:"column",gap:2},children:[(()=&gt;{switch(alpha(sesColorPalette.primary,.05),animated&amp;&amp;alpha(sesColorPalette.accent,.1),chartType){case"bar":return jsxRuntimeExports.jsx(Box,{sx:{display:"flex",alignItems:"flex-end",gap:1,height:"70%"},children:[...Array(8)].map((_,i)=&gt;jsxRuntimeExports.jsx(Box,{sx:{flex:1,height:30+70*Math.random()+"%",backgroundColor:alpha(sesColorPalette.primary,.08),borderRadius:"4px 4px 0 0",position:"relative",overflow:"hidden","&amp;::after":animated?{content:'""',position:"absolute",top:0,left:"-100%",width:"100%",height:"100%",background:`linear-gradient(90deg, transparent, ${alpha(sesColorPalette.accent,.2)}, transparent)`,animation:`${shimmer$1} 2s infinite ${.2*i}s`}:void 0}},i))});case"pie":return jsxRuntimeExports.jsx(Box,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"70%"},children:jsxRuntimeExports.jsx(Box,{sx:{width:120,height:120,borderRadius:"50%",background:`conic-gradient(\n                  ${alpha(sesColorPalette.primary,.8)} 0deg 120deg,\n                  ${alpha(sesColorPalette.secondary,.8)} 120deg 200deg,\n                  ${alpha(sesColorPalette.accent,.8)} 200deg 280deg,\n                  ${alpha(sesColorPalette.primary,.4)} 280deg 360deg\n                )`,position:"relative","&amp;::after":{content:'""',position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:60,height:60,backgroundColor:sesColorPalette.backgroundPaper,borderRadius:"50%"}}})});case"heatmap":return jsxRuntimeExports.jsx(Box,{sx:{display:"grid",gridTemplateColumns:"repeat(10, 1fr)",gap:1,height:"70%"},children:[...Array(50)].map((_,i)=&gt;jsxRuntimeExports.jsx(Box,{sx:{aspectRatio:"1",backgroundColor:alpha(sesColorPalette.primary,.3*Math.random()+.05),borderRadius:1,position:"relative",overflow:"hidden","&amp;::after":animated?{content:'""',position:"absolute",top:0,left:"-100%",width:"100%",height:"100%",background:`linear-gradient(90deg, transparent, ${alpha(sesColorPalette.accent,.3)}, transparent)`,animation:`${shimmer$1} 3s infinite ${i%10*.1}s`}:void 0}},i))});case"gauge":return jsxRuntimeExports.jsx(Box,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"70%"},children:jsxRuntimeExports.jsx(Box,{sx:{width:140,height:70,borderRadius:"140px 140px 0 0",background:`linear-gradient(180deg, \n                  ${alpha(sesColorPalette.primary,.1)} 0%, \n                  ${alpha(sesColorPalette.accent,.3)} 100%\n                )`,position:"relative",overflow:"hidden","&amp;::before":{content:'""',position:"absolute",bottom:0,left:"50%",transform:"translateX(-50%)",width:2,height:50,backgroundColor:sesColorPalette.accent,transformOrigin:"bottom center",borderRadius:"2px 2px 0 0"},"&amp;::after":animated?{content:'""',position:"absolute",top:0,left:"-100%",width:"100%",height:"100%",background:`linear-gradient(90deg, transparent, ${alpha(sesColorPalette.accent,.4)}, transparent)`,animation:`${shimmer$1} 2s infinite`}:void 0}})});default:return jsxRuntimeExports.jsx(Box,{sx:{position:"relative",height:"70%",overflow:"hidden"},children:jsxRuntimeExports.jsxs("svg",{width:"100%",height:"100%",style:{overflow:"visible"},viewBox:"0 0 100 100",children:[[...Array(5)].map((_,i)=&gt;jsxRuntimeExports.jsx("line",{stroke:alpha(sesColorPalette.primary,.1),strokeDasharray:"4,4",x1:"0",x2:"100",y1:25*i,y2:25*i},`h-${i}`)),[...Array(8)].map((_,i)=&gt;jsxRuntimeExports.jsx("line",{stroke:alpha(sesColorPalette.primary,.1),strokeDasharray:"4,4",x1:14.28*i,x2:14.28*i,y1:"0",y2:"100"},`v-${i}`)),jsxRuntimeExports.jsx("path",{d:"M 0,70 Q 25,40 50,60 T 100,30",fill:"none",stroke:sesColorPalette.primary,strokeWidth:"2",opacity:.8}),jsxRuntimeExports.jsx("path",{d:"M 0,80 Q 25,50 50,70 T 100,40",fill:"none",stroke:sesColorPalette.secondary,strokeWidth:"2",opacity:.6})]})})}})(),jsxRuntimeExports.jsx(Box,{sx:{display:"flex",justifyContent:"space-between",mt:1},children:[...Array(6)].map((_,i)=&gt;jsxRuntimeExports.jsx(Skeleton,{variant:"text",width:40,height:16,sx:commonSx},i))}),showLegend&amp;&amp;jsxRuntimeExports.jsx(Box,{sx:{display:"flex",justifyContent:"center",gap:3,mt:2},children:[...Array(3)].map((_,i)=&gt;jsxRuntimeExports.jsxs(Box,{sx:{display:"flex",alignItems:"center",gap:1},children:[jsxRuntimeExports.jsx(Skeleton,{variant:"circular",width:12,height:12,sx:commonSx}),jsxRuntimeExports.jsx(Skeleton,{variant:"text",width:60,height:16,sx:commonSx})]},i))})]})})]})},buildingVitalsDarkTheme={color:["#00E5FF","#00BFA5","#448AFF","#7C4DFF","#FF6E40","#FFD740","#69F0AE","#FF5252","#18FFFF","#B388FF"],backgroundColor:"transparent",textStyle:{color:"rgba(255, 255, 255, 0.87)",fontFamily:"JetBrains Mono, Consolas, Monaco, monospace"},title:{textStyle:{color:"#00E5FF",fontSize:16,fontWeight:500},subtextStyle:{color:"rgba(255, 255, 255, 0.6)",fontSize:12}},line:{itemStyle:{borderWidth:2},lineStyle:{width:2,type:"solid"},symbolSize:4,symbol:"circle",smooth:!0},radar:{itemStyle:{borderWidth:2},lineStyle:{width:2},symbolSize:4,symbol:"circle",smooth:!0},bar:{itemStyle:{barBorderWidth:0,borderRadius:[4,4,0,0]}},pie:{itemStyle:{borderWidth:0,borderColor:"#1a1a1a"}},scatter:{itemStyle:{borderWidth:0,borderColor:"#1a1a1a"}},boxplot:{itemStyle:{borderWidth:0,borderColor:"#1a1a1a"}},parallel:{itemStyle:{borderWidth:0,borderColor:"#1a1a1a"}},sankey:{itemStyle:{borderWidth:0,borderColor:"#1a1a1a"}},funnel:{itemStyle:{borderWidth:0,borderColor:"#1a1a1a"}},gauge:{itemStyle:{borderWidth:0,borderColor:"#1a1a1a"},axisLine:{lineStyle:{color:[[1,"rgba(255, 255, 255, 0.1)"]],width:10}},splitLine:{lineStyle:{color:"rgba(255, 255, 255, 0.1)"}},axisLabel:{color:"rgba(255, 255, 255, 0.6)"},detail:{textStyle:{color:"#00E5FF"}}},candlestick:{itemStyle:{color:"#00E5FF",color0:"#FF5252",borderColor:"#00E5FF",borderColor0:"#FF5252",borderWidth:1}},graph:{itemStyle:{borderWidth:0,borderColor:"#1a1a1a"},lineStyle:{width:1,color:"rgba(255, 255, 255, 0.3)"},symbolSize:4,symbol:"circle",smooth:!0,color:["#00E5FF","#00BFA5","#448AFF","#7C4DFF","#FF6E40"],label:{color:"rgba(255, 255, 255, 0.87)"}},map:{itemStyle:{areaColor:"rgba(255, 255, 255, 0.05)",borderColor:"rgba(255, 255, 255, 0.2)",borderWidth:.5},label:{color:"rgba(255, 255, 255, 0.6)"},emphasis:{itemStyle:{areaColor:"rgba(0, 229, 255, 0.2)",borderColor:"#00E5FF",borderWidth:1},label:{color:"#00E5FF"}}},geo:{itemStyle:{areaColor:"rgba(255, 255, 255, 0.05)",borderColor:"rgba(255, 255, 255, 0.2)",borderWidth:.5},label:{color:"rgba(255, 255, 255, 0.6)"},emphasis:{itemStyle:{areaColor:"rgba(0, 229, 255, 0.2)",borderColor:"#00E5FF",borderWidth:1},label:{color:"#00E5FF"}}},categoryAxis:{axisLine:{show:!0,lineStyle:{color:"rgba(255, 255, 255, 0.2)"}},axisTick:{show:!0,lineStyle:{color:"rgba(255, 255, 255, 0.2)"}},axisLabel:{show:!0,color:"rgba(255, 255, 255, 0.6)"},splitLine:{show:!1,lineStyle:{color:["rgba(255, 255, 255, 0.1)"]}},splitArea:{show:!1,areaStyle:{color:["rgba(255, 255, 255, 0.02)","rgba(255, 255, 255, 0.05)"]}}},valueAxis:{axisLine:{show:!1,lineStyle:{color:"rgba(255, 255, 255, 0.2)"}},axisTick:{show:!1,lineStyle:{color:"rgba(255, 255, 255, 0.2)"}},axisLabel:{show:!0,color:"rgba(255, 255, 255, 0.6)"},splitLine:{show:!0,lineStyle:{color:["rgba(255, 255, 255, 0.1)"],type:"dashed"}},splitArea:{show:!1,areaStyle:{color:["rgba(255, 255, 255, 0.02)","rgba(255, 255, 255, 0.05)"]}}},logAxis:{axisLine:{show:!1,lineStyle:{color:"rgba(255, 255, 255, 0.2)"}},axisTick:{show:!1,lineStyle:{color:"rgba(255, 255, 255, 0.2)"}},axisLabel:{show:!0,color:"rgba(255, 255, 255, 0.6)"},splitLine:{show:!0,lineStyle:{color:["rgba(255, 255, 255, 0.1)"],type:"dashed"}},splitArea:{show:!1,areaStyle:{color:["rgba(255, 255, 255, 0.02)","rgba(255, 255, 255, 0.05)"]}}},timeAxis:{axisLine:{show:!0,lineStyle:{color:"rgba(255, 255, 255, 0.2)"}},axisTick:{show:!0,lineStyle:{color:"rgba(255, 255, 255, 0.2)"}},axisLabel:{show:!0,color:"rgba(255, 255, 255, 0.6)"},splitLine:{show:!1,lineStyle:{color:["rgba(255, 255, 255, 0.1)"]}},splitArea:{show:!1,areaStyle:{color:["rgba(255, 255, 255, 0.02)","rgba(255, 255, 255, 0.05)"]}}},toolbox:{iconStyle:{borderColor:"rgba(255, 255, 255, 0.6)"},emphasis:{iconStyle:{borderColor:"#00E5FF"}}},legend:{textStyle:{color:"rgba(255, 255, 255, 0.87)"},inactiveColor:"rgba(255, 255, 255, 0.3)"},tooltip:{backgroundColor:"rgba(0, 0, 0, 0.9)",borderColor:"rgba(255, 255, 255, 0.1)",borderWidth:1,textStyle:{color:"rgba(255, 255, 255, 0.87)"},axisPointer:{lineStyle:{color:"rgba(255, 255, 255, 0.3)",width:1},crossStyle:{color:"rgba(255, 255, 255, 0.3)",width:1},label:{backgroundColor:"rgba(0, 0, 0, 0.8)",color:"rgba(255, 255, 255, 0.87)",borderColor:"rgba(255, 255, 255, 0.2)",borderWidth:1}}},dataZoom:{backgroundColor:"rgba(255, 255, 255, 0.05)",dataBackgroundColor:"rgba(255, 255, 255, 0.1)",fillerColor:"rgba(0, 229, 255, 0.2)",handleColor:"#00E5FF",handleSize:"100%",textStyle:{color:"rgba(255, 255, 255, 0.6)"},borderColor:"rgba(255, 255, 255, 0.1)"},visualMap:{color:["#00E5FF","#00BFA5","#448AFF"],textStyle:{color:"rgba(255, 255, 255, 0.87)"}},markLine:{lineStyle:{color:"rgba(255, 255, 255, 0.3)",type:"dashed"},label:{color:"rgba(255, 255, 255, 0.87)"},emphasis:{lineStyle:{color:"#00E5FF",width:2}}},markPoint:{label:{color:"rgba(255, 255, 255, 0.87)"}},markArea:{itemStyle:{color:"rgba(0, 229, 255, 0.1)"},label:{color:"rgba(255, 255, 255, 0.87)"}}},buildingVitalsLightTheme={...buildingVitalsDarkTheme,textStyle:{color:"rgba(0, 0, 0, 0.87)",fontFamily:"JetBrains Mono, Consolas, Monaco, monospace"},backgroundColor:"transparent"};const brandColors_primary="#1976d2",darkColorPalette=["#42a5f5","#66bb6a","#ffa726","#ef5350","#ab47bc","#26c6da","#ff7043","#7e57c2","#ffca28","#8d6e63"],lightTheme={color:["#1976d2","#4caf50","#ff9800","#dc004e","#9c27b0","#00acc1","#ff5252","#536dfe","#ffb300","#795548"],backgroundColor:"transparent",textStyle:{color:"rgba(0, 0, 0, 0.87)",fontFamily:'"Roboto", "Helvetica", "Arial", sans-serif'},title:{textStyle:{color:"rgba(0, 0, 0, 0.87)",fontWeight:600},subtextStyle:{color:"rgba(0, 0, 0, 0.6)"}},legend:{textStyle:{color:"rgba(0, 0, 0, 0.87)"},pageTextStyle:{color:"rgba(0, 0, 0, 0.87)"}},tooltip:{backgroundColor:"rgba(255, 255, 255, 0.95)",borderColor:"#e0e0e0",borderWidth:1,textStyle:{color:"rgba(0, 0, 0, 0.87)"},axisPointer:{lineStyle:{color:"#999",type:"dashed"},crossStyle:{color:"#999"},shadowStyle:{color:"rgba(150, 150, 150, 0.1)"}}},grid:{borderColor:"#e0e0e0"},xAxis:{axisLine:{lineStyle:{color:"#e0e0e0"}},axisTick:{lineStyle:{color:"#e0e0e0"}},axisLabel:{color:"rgba(0, 0, 0, 0.6)"},splitLine:{lineStyle:{color:"#f5f5f5",type:"dashed"}},splitArea:{areaStyle:{color:["rgba(250, 250, 250, 0.3)","rgba(255, 255, 255, 0.3)"]}}},yAxis:{axisLine:{lineStyle:{color:"#e0e0e0"}},axisTick:{lineStyle:{color:"#e0e0e0"}},axisLabel:{color:"rgba(0, 0, 0, 0.6)"},splitLine:{lineStyle:{color:"#f5f5f5",type:"dashed"}},splitArea:{areaStyle:{color:["rgba(250, 250, 250, 0.3)","rgba(255, 255, 255, 0.3)"]}}},line:{smooth:!0,symbol:"circle",symbolSize:6,lineStyle:{width:2}},bar:{barMaxWidth:40,itemStyle:{borderRadius:[4,4,0,0]}},pie:{itemStyle:{borderWidth:2,borderColor:"#fff"}},scatter:{itemStyle:{opacity:.8}},dataZoom:{backgroundColor:"rgba(0, 0, 0, 0.03)",borderColor:"#e0e0e0",textStyle:{color:"rgba(0, 0, 0, 0.6)"},handleStyle:{color:brandColors_primary,borderColor:brandColors_primary},moveHandleStyle:{color:brandColors_primary},selectedDataBackground:{lineStyle:{color:brandColors_primary},areaStyle:{color:brandColors_primary,opacity:.2}}}},darkTheme={color:darkColorPalette,backgroundColor:"transparent",textStyle:{color:"rgba(255, 255, 255, 0.87)",fontFamily:'"Roboto", "Helvetica", "Arial", sans-serif'},title:{textStyle:{color:"rgba(255, 255, 255, 0.87)",fontWeight:600},subtextStyle:{color:"rgba(255, 255, 255, 0.6)"}},legend:{textStyle:{color:"rgba(255, 255, 255, 0.87)"},pageTextStyle:{color:"rgba(255, 255, 255, 0.87)"}},tooltip:{backgroundColor:"rgba(48, 48, 48, 0.95)",borderColor:"#424242",borderWidth:1,textStyle:{color:"rgba(255, 255, 255, 0.87)"},axisPointer:{lineStyle:{color:"#757575",type:"dashed"},crossStyle:{color:"#757575"},shadowStyle:{color:"rgba(255, 255, 255, 0.05)"}}},grid:{borderColor:"#424242"},xAxis:{axisLine:{lineStyle:{color:"#424242"}},axisTick:{lineStyle:{color:"#424242"}},axisLabel:{color:"rgba(255, 255, 255, 0.6)"},splitLine:{lineStyle:{color:"#2a2a2a",type:"dashed"}},splitArea:{areaStyle:{color:["rgba(255, 255, 255, 0.02)","rgba(255, 255, 255, 0.05)"]}}},yAxis:{axisLine:{lineStyle:{color:"#424242"}},axisTick:{lineStyle:{color:"#424242"}},axisLabel:{color:"rgba(255, 255, 255, 0.6)"},splitLine:{lineStyle:{color:"#2a2a2a",type:"dashed"}},splitArea:{areaStyle:{color:["rgba(255, 255, 255, 0.02)","rgba(255, 255, 255, 0.05)"]}}},line:{smooth:!0,symbol:"circle",symbolSize:6,lineStyle:{width:2}},bar:{barMaxWidth:40,itemStyle:{borderRadius:[4,4,0,0]}},pie:{itemStyle:{borderWidth:2,borderColor:"#121212"}},scatter:{itemStyle:{opacity:.8}},dataZoom:{backgroundColor:"rgba(255, 255, 255, 0.03)",borderColor:"#424242",textStyle:{color:"rgba(255, 255, 255, 0.6)"},handleStyle:{color:darkColorPalette[0],borderColor:darkColorPalette[0]},moveHandleStyle:{color:darkColorPalette[0]},selectedDataBackground:{lineStyle:{color:darkColorPalette[0]},areaStyle:{color:darkColorPalette[0],opacity:.2}}},toolbox:{iconStyle:{borderColor:"#999999",color:"transparent",borderWidth:1},emphasis:{iconStyle:{borderColor:"#ffffff",color:"transparent",borderWidth:1,shadowBlur:3,shadowColor:"rgba(255, 255, 255, 0.3)",shadowOffsetX:0,shadowOffsetY:0}}}};const ChartSyncContext=reactExports.createContext(void 0),getSpinnerSize=size=&gt;{switch(size){case"small":return 30;case"large":return 60;default:return 40}},LineChartSkeleton=({height:height})=&gt;jsxRuntimeExports.jsxs(Box,{sx:{width:"100%",height:height,p:2},children:[jsxRuntimeExports.jsxs(Box,{sx:{display:"flex",gap:2},children:[jsxRuntimeExports.jsx(Box,{sx:{width:40,display:"flex",flexDirection:"column",justifyContent:"space-between",py:2},children:[...Array(5)].map((_,i)=&gt;jsxRuntimeExports.jsx(Skeleton,{variant:"text",width:"100%",height:16},i))}),jsxRuntimeExports.jsx(Box,{sx:{flex:1,position:"relative",py:2},children:[...Array(3)].map((_,i)=&gt;jsxRuntimeExports.jsx(Skeleton,{variant:"rectangular",width:60+15*i+"%",height:2,sx:{position:"absolute",top:20+25*i+"%",left:0,animation:"pulse 1.5s ease-in-out infinite",animationDelay:.2*i+"s"}},i))})]}),jsxRuntimeExports.jsx(Box,{sx:{display:"flex",justifyContent:"space-between",mt:1,pl:6},children:[...Array(6)].map((_,i)=&gt;jsxRuntimeExports.jsx(Skeleton,{variant:"text",width:60,height:16},i))})]}),BarChartSkeleton=({height:height})=&gt;jsxRuntimeExports.jsxs(Box,{sx:{width:"100%",height:height,p:2},children:[jsxRuntimeExports.jsxs(Box,{sx:{display:"flex",gap:2,height:"100%"},children:[jsxRuntimeExports.jsx(Box,{sx:{width:40,display:"flex",flexDirection:"column",justifyContent:"space-between",py:2},children:[...Array(5)].map((_,i)=&gt;jsxRuntimeExports.jsx(Skeleton,{variant:"text",width:"100%",height:16},i))}),jsxRuntimeExports.jsx(Box,{sx:{flex:1,display:"flex",alignItems:"flex-end",gap:1,py:2},children:[65,85,45,95,55,75,40,80].map((barHeight,i)=&gt;jsxRuntimeExports.jsx(Skeleton,{variant:"rectangular",width:"100%",height:`${barHeight}%`,sx:{animation:"pulse 1.5s ease-in-out infinite",animationDelay:.1*i+"s"}},i))})]}),jsxRuntimeExports.jsx(Box,{sx:{display:"flex",justifyContent:"space-around",pl:6},children:[...Array(8)].map((_,i)=&gt;jsxRuntimeExports.jsx(Skeleton,{variant:"text",width:40,height:16},i))})]}),HeatmapSkeleton=({height:height})=&gt;jsxRuntimeExports.jsx(Box,{sx:{width:"100%",height:height,p:2},children:jsxRuntimeExports.jsxs(Box,{sx:{display:"flex",gap:1},children:[jsxRuntimeExports.jsx(Box,{sx:{width:60,display:"flex",flexDirection:"column",gap:1,pt:4},children:[...Array(10)].map((_,i)=&gt;jsxRuntimeExports.jsx(Skeleton,{variant:"text",width:"100%",height:24},i))}),jsxRuntimeExports.jsxs(Box,{sx:{flex:1},children:[jsxRuntimeExports.jsx(Box,{sx:{display:"flex",gap:1,mb:1},children:[...Array(12)].map((_,i)=&gt;jsxRuntimeExports.jsx(Skeleton,{variant:"text",width:"100%",height:20},i))}),jsxRuntimeExports.jsx(Box,{sx:{display:"flex",flexDirection:"column",gap:1},children:[...Array(10)].map((_,row)=&gt;jsxRuntimeExports.jsx(Box,{sx:{display:"flex",gap:1},children:[...Array(12)].map((_2,col)=&gt;jsxRuntimeExports.jsx(Skeleton,{variant:"rectangular",width:"100%",height:24,sx:{animation:"pulse 1.5s ease-in-out infinite",animationDelay:.05*(row+col)+"s"}},col))},row))})]})]})}),ScatterSkeleton=({height:height})=&gt;{useTheme();const positions=reactExports.useMemo(()=&gt;Array.from({length:20},()=&gt;({top:80*Math.random()+10+"%",left:80*Math.random()+10+"%"})),[]);return jsxRuntimeExports.jsxs(Box,{sx:{width:"100%",height:height,p:2},children:[jsxRuntimeExports.jsxs(Box,{sx:{display:"flex",gap:2},children:[jsxRuntimeExports.jsx(Box,{sx:{width:40,display:"flex",flexDirection:"column",justifyContent:"space-between",py:2},children:[...Array(5)].map((_,i)=&gt;jsxRuntimeExports.jsx(Skeleton,{variant:"text",width:"100%",height:16},i))}),jsxRuntimeExports.jsx(Box,{sx:{flex:1,position:"relative",py:2},children:positions.map((pos,i)=&gt;jsxRuntimeExports.jsx(Skeleton,{variant:"circular",width:8,height:8,sx:{position:"absolute",top:pos.top,left:pos.left,animation:"pulse 1.5s ease-in-out infinite",animationDelay:.1*i+"s"}},i))})]}),jsxRuntimeExports.jsx(Box,{sx:{display:"flex",justifyContent:"space-between",mt:1,pl:6},children:[...Array(6)].map((_,i)=&gt;jsxRuntimeExports.jsx(Skeleton,{variant:"text",width:60,height:16},i))})]})},GenericSkeleton=({height:height})=&gt;jsxRuntimeExports.jsxs(Box,{sx:{width:"100%",height:height,p:2},children:[jsxRuntimeExports.jsx(Skeleton,{variant:"rectangular",width:"100%",height:"90%"}),jsxRuntimeExports.jsx(Box,{sx:{display:"flex",justifyContent:"space-between",mt:1},children:[...Array(5)].map((_,i)=&gt;jsxRuntimeExports.jsx(Skeleton,{variant:"text",width:60,height:16},i))})]}),SkeletonLoader=({type:type,height:height})=&gt;{switch(type){case"line":return jsxRuntimeExports.jsx(LineChartSkeleton,{height:height});case"bar":return jsxRuntimeExports.jsx(BarChartSkeleton,{height:height});case"heatmap":return jsxRuntimeExports.jsx(HeatmapSkeleton,{height:height});case"scatter":return jsxRuntimeExports.jsx(ScatterSkeleton,{height:height});default:return jsxRuntimeExports.jsx(GenericSkeleton,{height:height})}},ChartLoadingState=({loading:loading,error:error,hasData:hasData,chartRef:chartRef,onRetry:onRetry,height:height=400,loadingMessage:loadingMessage="Loading chart data...",noDataMessage:noDataMessage="No data available for this period",errorMessage:errorMessage,variant:variant="spinner",skeletonType:skeletonType="generic",size:size="medium",showProgress:showProgress=!1,progress:progress,currentStep:currentStep,totalSteps:totalSteps})=&gt;{const isLoadingShown=reactExports.useRef(!1),theme=useTheme(),numericHeight="number"==typeof height?height:parseInt(String(height))||400;return reactExports.useEffect(()=&gt;{if(null==chartRef?void 0:chartRef.current){const echartsInstance=chartRef.current.getEchartsInstance();if(echartsInstance&amp;&amp;!echartsInstance.isDisposed())try{loading&amp;&amp;!isLoadingShown.current?(echartsInstance.showLoading({text:loadingMessage,color:theme.palette.primary.main,textColor:theme.palette.text.secondary,maskColor:"rgba(255, 255, 255, 0.8)",zlevel:0,fontSize:14,showSpinner:!0,spinnerRadius:10,lineWidth:3}),isLoadingShown.current=!0):!loading&amp;&amp;isLoadingShown.current&amp;&amp;(echartsInstance.hideLoading(),isLoadingShown.current=!1)}catch(error2){console.warn("Chart loading operation failed:",error2),isLoadingShown.current=!1}}},[loading,chartRef,loadingMessage,theme]),reactExports.useEffect(()=&gt;()=&gt;{if(null==chartRef?void 0:chartRef.current){const echartsInstance=chartRef.current.getEchartsInstance();if(echartsInstance&amp;&amp;!echartsInstance.isDisposed()&amp;&amp;isLoadingShown.current){try{echartsInstance.hideLoading()}catch(error2){console.warn("Chart cleanup operation failed:",error2)}isLoadingShown.current=!1}}},[chartRef]),error&amp;&amp;!loading?jsxRuntimeExports.jsx(Box,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"number"==typeof height?`${height}px`:height,p:3},children:jsxRuntimeExports.jsx(Alert,{severity:"error",sx:{mb:2,maxWidth:500},action:onRetry&amp;&amp;jsxRuntimeExports.jsx(Button,{color:"inherit",size:"small",onClick:onRetry,startIcon:jsxRuntimeExports.jsx(Refresh,{}),children:"Retry"}),children:jsxRuntimeExports.jsx(Typography$1,{variant:"body2",children:errorMessage||error.message||"Failed to load chart data"})})}):loading||error||hasData?loading&amp;&amp;"skeleton"===variant&amp;&amp;!chartRef?jsxRuntimeExports.jsxs(Box,{sx:{width:"100%",height:"number"==typeof height?`${height}px`:height},children:[jsxRuntimeExports.jsx(SkeletonLoader,{type:skeletonType,height:numericHeight}),showProgress&amp;&amp;(void 0!==progress||void 0!==currentStep&amp;&amp;void 0!==totalSteps)&amp;&amp;jsxRuntimeExports.jsxs(Box,{sx:{px:2,pb:2},children:[void 0!==progress&amp;&amp;jsxRuntimeExports.jsx(LinearProgress,{variant:"determinate",value:progress,sx:{mb:1}}),jsxRuntimeExports.jsxs(Box,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[jsxRuntimeExports.jsx(Typography$1,{variant:"caption",color:"text.secondary",children:loadingMessage}),void 0!==currentStep&amp;&amp;void 0!==totalSteps&amp;&amp;jsxRuntimeExports.jsxs(Typography$1,{variant:"caption",color:"text.secondary",children:["Step ",currentStep," of ",totalSteps]}),void 0!==progress&amp;&amp;jsxRuntimeExports.jsxs(Typography$1,{variant:"caption",color:"text.secondary",children:[Math.round(progress),"%"]})]})]})]}):loading&amp;&amp;!chartRef?jsxRuntimeExports.jsxs(Box,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"number"==typeof height?`${height}px`:height,p:3},children:[jsxRuntimeExports.jsx(CircularProgress,{size:getSpinnerSize(size)}),jsxRuntimeExports.jsx(Typography$1,{variant:"body2",color:"text.secondary",sx:{mt:2},children:loadingMessage}),showProgress&amp;&amp;(void 0!==progress||void 0!==currentStep&amp;&amp;void 0!==totalSteps)&amp;&amp;jsxRuntimeExports.jsxs(Box,{sx:{mt:2,width:"100%",maxWidth:300},children:[void 0!==progress&amp;&amp;jsxRuntimeExports.jsx(LinearProgress,{variant:"determinate",value:progress,sx:{mb:1}}),jsxRuntimeExports.jsxs(Box,{sx:{display:"flex",justifyContent:"space-between"},children:[void 0!==currentStep&amp;&amp;void 0!==totalSteps&amp;&amp;jsxRuntimeExports.jsxs(Typography$1,{variant:"caption",color:"text.secondary",children:["Step ",currentStep," of ",totalSteps]}),void 0!==progress&amp;&amp;jsxRuntimeExports.jsxs(Typography$1,{variant:"caption",color:"text.secondary",children:[Math.round(progress),"%"]})]})]})]}):null:jsxRuntimeExports.jsxs(Box,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"number"==typeof height?`${height}px`:height,p:3},children:[jsxRuntimeExports.jsx(Typography$1,{variant:"body1",color:"text.secondary",gutterBottom:!0,children:noDataMessage}),onRetry&amp;&amp;jsxRuntimeExports.jsx(Button,{variant:"outlined",size:"small",onClick:onRetry,startIcon:jsxRuntimeExports.jsx(Refresh,{}),sx:{mt:2},children:"Refresh"})]})},areChartPropsEqual=(prevProps,nextProps)=&gt;{if(prevProps===nextProps)return!0;const propsToCheck=["data","loading","error","height","width","title","theme","showDataZoom","showLegend","thresholds","ranges"];for(const prop of propsToCheck)if(!isEqual(prevProps[prop],nextProps[prop]))return!1;return!0};var define_process_env_default={};class BaseChartErrorBoundary extends reactExports.Component{constructor(props){super(props),__publicField(this,"retryTimeoutId",null),__publicField(this,"autoRecoveryTimeoutId",null),__publicField(this,"handleReset",async()=&gt;{if(this.canRetry()&amp;&amp;!this.state.isRecovering){this.setState({isRecovering:!0});try{this.retryTimeoutId&amp;&amp;clearTimeout(this.retryTimeoutId),await new Promise(resolve=&gt;{this.setState({hasError:!1,error:null,errorInfo:null,chartInfo:null,retryCount:this.state.retryCount+1,isRecovering:!1},resolve)}),this.props.onRecovery&amp;&amp;this.props.onRecovery(),this.retryTimeoutId=setTimeout(()=&gt;{this.setState({retryCount:0,lastSuccessfulRender:Date.now()})},3e4)}catch(error){this.setState({isRecovering:!1})}}}),__publicField(this,"handleCopyError",()=&gt;{const{error:error,errorInfo:errorInfo,chartInfo:chartInfo}=this.state,errorReport=this.generateErrorReport(error,errorInfo,chartInfo);navigator.clipboard.writeText(errorReport).then(()=&gt;{}).catch(err=&gt;{})}),this.state={hasError:!1,error:null,errorInfo:null,chartInfo:null,retryCount:0,isRecovering:!1,showDetails:!1,recoveryAttempts:new Map,lastSuccessfulRender:Date.now()}}static getDerivedStateFromError(error){return{hasError:!0,error:error}}componentDidCatch(error,errorInfo){const chartInfo={chartType:this.props.chartType,chartId:this.props.chartId,errorType:this.categorizeError(error),timestamp:Date.now(),context:{componentStack:errorInfo.componentStack,...this.gatherErrorContext()}};this.setState({errorInfo:errorInfo,chartInfo:chartInfo}),this.props.onError&amp;&amp;this.props.onError(error,errorInfo,chartInfo),this.reportToMonitoring(error,errorInfo,chartInfo),this.props.enableAutoRecovery&amp;&amp;this.scheduleAutoRecovery()}componentDidUpdate(prevProps){prevProps.chartType===this.props.chartType&amp;&amp;prevProps.chartId===this.props.chartId||this.state.hasError&amp;&amp;this.handleReset()}componentWillUnmount(){this.retryTimeoutId&amp;&amp;clearTimeout(this.retryTimeoutId),this.autoRecoveryTimeoutId&amp;&amp;clearTimeout(this.autoRecoveryTimeoutId)}categorizeError(error){var _a;const message=error.message.toLowerCase(),stack=(null==(_a=error.stack)?void 0:_a.toLowerCase())||"";return message.includes("network")||message.includes("fetch")||message.includes("api")?"network":message.includes("memory")||message.includes("heap")||message.includes("stack")?"memory":message.includes("data")||message.includes("undefined")||message.includes("null")?"data":message.includes("render")||message.includes("component")||stack.includes("react")?"rendering":"unknown"}gatherErrorContext(){return{userAgent:navigator.userAgent,url:window.location.href,viewport:{width:window.innerWidth,height:window.innerHeight},memory:performance.memory?{usedJSHeapSize:performance.memory.usedJSHeapSize,totalJSHeapSize:performance.memory.totalJSHeapSize,jsHeapSizeLimit:performance.memory.jsHeapSizeLimit}:null,timestamp:(new Date).toISOString()}}reportToMonitoring(error,errorInfo,chartInfo){try{window.gtag&amp;&amp;window.gtag("event","exception",{description:`Chart Error: ${error.message}`,fatal:!1,error_type:chartInfo.errorType,chart_type:chartInfo.chartType,chart_id:chartInfo.chartId}),define_process_env_default.REACT_APP_ERROR_REPORTING_ENDPOINT&amp;&amp;fetch(define_process_env_default.REACT_APP_ERROR_REPORTING_ENDPOINT,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({error:{message:error.message,stack:error.stack},errorInfo:errorInfo,chartInfo:chartInfo,context:this.gatherErrorContext()})}).catch(err=&gt;{})}catch(err){}}scheduleAutoRecovery(){const{retryDelay:retryDelay=5e3}=this.props;this.autoRecoveryTimeoutId=setTimeout(()=&gt;{this.state.hasError&amp;&amp;this.canRetry()&amp;&amp;this.handleReset()},retryDelay)}canRetry(){const{maxRetries:maxRetries=3}=this.props;return this.state.retryCount&lt;maxRetries}generateErrorReport(error,errorInfo,chartInfo){return`\nChart Error Report\n==================\nGenerated: ${(new Date).toISOString()}\nChart Type: ${(null==chartInfo?void 0:chartInfo.chartType)||"Unknown"}\nChart ID: ${(null==chartInfo?void 0:chartInfo.chartId)||"N/A"}\nError Type: ${(null==chartInfo?void 0:chartInfo.errorType)||"Unknown"}\n\nError Details\n-------------\nMessage: ${(null==error?void 0:error.message)||"No error message"}\nStack Trace:\n${(null==error?void 0:error.stack)||"No stack trace available"}\n\nComponent Stack:\n${(null==errorInfo?void 0:errorInfo.componentStack)||"No component stack available"}\n\nContext\n-------\n${JSON.stringify((null==chartInfo?void 0:chartInfo.context)||{},null,2)}\n\nBrowser Information\n------------------\nUser Agent: ${navigator.userAgent}\nURL: ${window.location.href}\nViewport: ${window.innerWidth}x${window.innerHeight}\n`.trim()}getRecoveryStrategies(){return[...[{name:"Refresh Chart",description:"Reload the chart with fresh data",icon:jsxRuntimeExports.jsx(Refresh,{}),action:()=&gt;this.handleReset()},{name:"Clear Cache",description:"Clear cached data and reload",icon:jsxRuntimeExports.jsx(WarningIcon,{}),action:async()=&gt;{if("caches"in window){const cacheNames=await caches.keys();await Promise.all(cacheNames.map(name=&gt;caches.delete(name)))}this.handleReset()},condition:error=&gt;error.message.includes("cache")||error.message.includes("stale")},{name:"Reduce Data",description:"Try loading with less data",icon:jsxRuntimeExports.jsx(Info,{}),action:()=&gt;{this.handleReset()},condition:error=&gt;{var _a;return"memory"===(null==(_a=this.state.chartInfo)?void 0:_a.errorType)}}],...this.props.recoveryStrategies||[]]}renderErrorFallback(){const{fallbackComponent:FallbackComponent}=this.props,{error:error,errorInfo:errorInfo,chartInfo:chartInfo,retryCount:retryCount}=this.state,{maxRetries:maxRetries=3}=this.props;return FallbackComponent&amp;&amp;error&amp;&amp;chartInfo?jsxRuntimeExports.jsx(FallbackComponent,{error:error,errorInfo:errorInfo,chartInfo:chartInfo,retry:this.handleReset,canRetry:this.canRetry(),retryCount:retryCount,maxRetries:maxRetries}):this.renderDefaultErrorUI()}renderDefaultErrorUI(){const{error:error,chartInfo:chartInfo,retryCount:retryCount,showDetails:showDetails,isRecovering:isRecovering}=this.state,{maxRetries:maxRetries=3,showDebugInfo:showDebugInfo=!1}=this.props,canRetry=this.canRetry(),strategies=this.getRecoveryStrategies().filter(s=&gt;!s.condition||error&amp;&amp;s.condition(error));return jsxRuntimeExports.jsxs(Paper,{elevation:0,sx:{p:3,height:"100%",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",backgroundColor:"background.default",border:1,borderColor:"error.main",borderStyle:"dashed",position:"relative"},children:[isRecovering&amp;&amp;jsxRuntimeExports.jsx(LinearProgress,{sx:{position:"absolute",top:0,left:0,right:0}}),jsxRuntimeExports.jsxs(Box,{sx:{textAlign:"center",maxWidth:600},children:[jsxRuntimeExports.jsx(ErrorIcon,{sx:{fontSize:48,color:"error.main",mb:2}}),jsxRuntimeExports.jsxs(Typography$1,{variant:"h6",gutterBottom:!0,color:"error",children:[this.props.chartType," Chart Error"]}),chartInfo&amp;&amp;jsxRuntimeExports.jsxs(Stack,{direction:"row",spacing:1,justifyContent:"center",sx:{mb:2},children:[jsxRuntimeExports.jsx(Chip,{size:"small",label:chartInfo.errorType,color:"error",variant:"outlined"}),chartInfo.chartId&amp;&amp;jsxRuntimeExports.jsx(Chip,{size:"small",label:`ID: ${chartInfo.chartId}`,variant:"outlined"})]}),jsxRuntimeExports.jsx(Typography$1,{variant:"body2",color:"text.secondary",paragraph:!0,children:this.getErrorMessage()}),jsxRuntimeExports.jsxs(Stack,{spacing:2,sx:{mt:3},children:[strategies.length&gt;0&amp;&amp;jsxRuntimeExports.jsx(Stack,{direction:"row",spacing:1,justifyContent:"center",flexWrap:"wrap",children:strategies.map((strategy,index2)=&gt;jsxRuntimeExports.jsx(Tooltip,{title:strategy.description,children:jsxRuntimeExports.jsxs(Button,{variant:0===index2?"contained":"outlined",size:"small",startIcon:strategy.icon,onClick:()=&gt;strategy.action(),disabled:isRecovering||!canRetry&amp;&amp;0===index2,children:[strategy.name,0===index2&amp;&amp;canRetry&amp;&amp;` (${retryCount}/${maxRetries})`]})},index2))}),showDebugInfo&amp;&amp;jsxRuntimeExports.jsxs(Stack,{direction:"row",spacing:1,justifyContent:"center",children:[jsxRuntimeExports.jsxs(Button,{variant:"text",size:"small",onClick:()=&gt;this.setState({showDetails:!showDetails}),endIcon:showDetails?jsxRuntimeExports.jsx(ExpandLess,{}):jsxRuntimeExports.jsx(ExpandMoreIcon,{}),children:[showDetails?"Hide":"Show"," Details"]}),jsxRuntimeExports.jsx(IconButton,{size:"small",onClick:this.handleCopyError,title:"Copy error details",children:jsxRuntimeExports.jsx(ContentCopy,{fontSize:"small"})}),jsxRuntimeExports.jsx(IconButton,{size:"small",onClick:()=&gt;this.reportBug(),title:"Report bug",children:jsxRuntimeExports.jsx(BugReportIcon,{fontSize:"small"})})]})]}),jsxRuntimeExports.jsx(Collapse,{in:showDetails,children:jsxRuntimeExports.jsxs(Alert,{severity:"error",sx:{mt:2,textAlign:"left"},children:[jsxRuntimeExports.jsx(AlertTitle,{children:"Error Details"}),jsxRuntimeExports.jsx(Typography$1,{variant:"body2",component:"pre",sx:{fontFamily:"monospace",fontSize:"0.75rem",whiteSpace:"pre-wrap",wordBreak:"break-word",maxHeight:200,overflow:"auto"},children:this.generateErrorReport(error,this.state.errorInfo,chartInfo)})]})}),!canRetry&amp;&amp;retryCount&gt;=maxRetries&amp;&amp;jsxRuntimeExports.jsx(Alert,{severity:"warning",sx:{mt:2},children:"Maximum retry attempts reached. Please refresh the page or contact support."})]})]})}getErrorMessage(){const{chartInfo:chartInfo}=this.state;switch(null==chartInfo?void 0:chartInfo.errorType){case"data":return"The chart encountered an issue with the data format or content.";case"memory":return"The chart requires too much memory to render. Try reducing the data range.";case"network":return"Failed to load chart data. Please check your connection.";case"rendering":return"The chart encountered a rendering error. This may be a temporary issue.";default:return"An unexpected error occurred while loading the chart."}}reportBug(){this.generateErrorReport(this.state.error,this.state.errorInfo,this.state.chartInfo)}render(){return this.state.hasError?this.renderErrorFallback():jsxRuntimeExports.jsx(jsxRuntimeExports.Fragment,{children:this.props.children})}}const TimeSeriesErrorFallback=({error:error,chartInfo:chartInfo,retry:retry,canRetry:canRetry,retryCount:retryCount,maxRetries:maxRetries,context:context})=&gt;{const isDataTooLarge="memory"===chartInfo.errorType||(null==context?void 0:context.dataPoints)&amp;&amp;context.dataPoints&gt;1e4,isTimeRangeIssue=error.message.includes("time")||error.message.includes("date")||error.message.includes("range");return jsxRuntimeExports.jsxs(Box,{sx:{height:"100%",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",p:3,backgroundColor:"background.paper",border:1,borderColor:"error.light",borderRadius:1},children:[jsxRuntimeExports.jsx(AccessTime,{sx:{fontSize:48,color:"error.main",mb:2}}),jsxRuntimeExports.jsx(Typography$1,{variant:"h6",gutterBottom:!0,color:"error",children:"Time Series Chart Error"}),context&amp;&amp;jsxRuntimeExports.jsxs(Box,{sx:{mb:2,textAlign:"center"},children:[context.timeRange&amp;&amp;jsxRuntimeExports.jsxs(Typography$1,{variant:"caption",color:"text.secondary",children:["Time Range: ",context.timeRange.start.toLocaleDateString()," - ",context.timeRange.end.toLocaleDateString()]}),context.dataPoints&amp;&amp;jsxRuntimeExports.jsxs(Typography$1,{variant:"caption",color:"text.secondary",display:"block",children:["Data Points: ",context.dataPoints.toLocaleString()]})]}),jsxRuntimeExports.jsx(Alert,{severity:"error",sx:{mb:2,maxWidth:400},children:isDataTooLarge?jsxRuntimeExports.jsx(jsxRuntimeExports.Fragment,{children:"The selected time range contains too much data to display. Try reducing the time range or enabling data sampling."}):isTimeRangeIssue?jsxRuntimeExports.jsx(jsxRuntimeExports.Fragment,{children:"There was an issue with the selected time range. Please verify the dates are valid and try again."}):jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:["Failed to load time series data. ",error.message]})}),jsxRuntimeExports.jsxs(Box,{sx:{display:"flex",gap:1,flexWrap:"wrap",justifyContent:"center"},children:[canRetry&amp;&amp;jsxRuntimeExports.jsxs(Button,{variant:"contained",startIcon:jsxRuntimeExports.jsx(ResetIcon,{}),onClick:retry,size:"small",children:["Retry (",retryCount,"/",maxRetries,")"]}),isDataTooLarge&amp;&amp;jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(Button,{variant:"outlined",startIcon:jsxRuntimeExports.jsx(DateRange,{}),onClick:()=&gt;{},size:"small",children:"Reduce Time Range"}),jsxRuntimeExports.jsx(Button,{variant:"outlined",startIcon:jsxRuntimeExports.jsx(CompressIcon,{}),onClick:()=&gt;{},size:"small",children:"Enable Sampling"})]})]})]})};class TimeSeriesChartErrorBoundary extends BaseChartErrorBoundary{constructor(props){super({...props,chartType:props.chartType||"Time Series",recoveryStrategies:[{name:"Last Hour",description:"Load only the last hour of data",icon:jsxRuntimeExports.jsx(AccessTime,{}),action:async()=&gt;{this.handleReset()},condition:error=&gt;error.message.includes("memory")||error.message.includes("too much data")},{name:"Reduce Resolution",description:"Load data at lower resolution",icon:jsxRuntimeExports.jsx(CompressIcon,{}),action:async()=&gt;{this.handleReset()}},...props.recoveryStrategies||[]]})}componentDidCatch(error,errorInfo){const timeSeriesContext={};try{const propsAny=this.props;propsAny.timeRange&amp;&amp;(timeSeriesContext.timeRange=propsAny.timeRange),propsAny.dataPoints&amp;&amp;(timeSeriesContext.dataPoints=propsAny.dataPoints),propsAny.seriesCount&amp;&amp;(timeSeriesContext.seriesCount=propsAny.seriesCount)}catch(e2){}super.componentDidCatch(error,errorInfo)}renderErrorFallback(){const{fallbackComponent:fallbackComponent}=this.props;return fallbackComponent?super.renderErrorFallback():jsxRuntimeExports.jsx(TimeSeriesErrorFallback,{error:this.state.error,errorInfo:this.state.errorInfo,chartInfo:this.state.chartInfo,retry:this.handleReset,canRetry:this.canRetry(),retryCount:this.state.retryCount,maxRetries:this.props.maxRetries||3})}}const HeatmapErrorFallback=({error:error,chartInfo:chartInfo,retry:retry,canRetry:canRetry,retryCount:retryCount,maxRetries:maxRetries,context:context})=&gt;{const isDataSizeIssue="memory"===chartInfo.errorType||(null==context?void 0:context.cellCount)&amp;&amp;context.cellCount&gt;5e4,isDataFormatIssue=(null==context?void 0:context.hasInvalidData)||error.message.includes("invalid")||error.message.includes("format");return jsxRuntimeExports.jsxs(Box,{sx:{height:"100%",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",p:3,backgroundColor:"background.paper",border:1,borderColor:"error.light",borderRadius:1},children:[jsxRuntimeExports.jsx(GridIcon,{sx:{fontSize:48,color:"error.main",mb:2}}),jsxRuntimeExports.jsx(Typography$1,{variant:"h6",gutterBottom:!0,color:"error",children:"Heatmap Chart Error"}),context&amp;&amp;jsxRuntimeExports.jsxs(Box,{sx:{mb:2,textAlign:"center"},children:[context.gridSize&amp;&amp;jsxRuntimeExports.jsx(Chip,{label:`Grid: ${context.gridSize.rows}${context.gridSize.cols}`,size:"small",color:"error",variant:"outlined",sx:{m:.5}}),context.cellCount&amp;&amp;jsxRuntimeExports.jsx(Chip,{label:`Cells: ${context.cellCount.toLocaleString()}`,size:"small",variant:"outlined",sx:{m:.5}}),context.valueRange&amp;&amp;jsxRuntimeExports.jsx(Chip,{label:`Range: ${context.valueRange.min} - ${context.valueRange.max}`,size:"small",variant:"outlined",sx:{m:.5}})]}),jsxRuntimeExports.jsx(Alert,{severity:"error",sx:{mb:2,maxWidth:400},children:isDataSizeIssue?jsxRuntimeExports.jsx(jsxRuntimeExports.Fragment,{children:"The heatmap contains too many cells to render efficiently. Consider aggregating the data or reducing the grid size."}):isDataFormatIssue?jsxRuntimeExports.jsx(jsxRuntimeExports.Fragment,{children:"The data format is invalid for heatmap visualization. Please ensure all values are numeric and within a valid range."}):jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:["Failed to render heatmap. ",error.message]})}),jsxRuntimeExports.jsxs(Box,{sx:{display:"flex",gap:1,flexWrap:"wrap",justifyContent:"center"},children:[canRetry&amp;&amp;jsxRuntimeExports.jsxs(Button,{variant:"contained",startIcon:jsxRuntimeExports.jsx(ResetIcon,{}),onClick:retry,size:"small",children:["Retry (",retryCount,"/",maxRetries,")"]}),isDataSizeIssue&amp;&amp;jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(Button,{variant:"outlined",startIcon:jsxRuntimeExports.jsx(TransformIcon,{}),onClick:()=&gt;{},size:"small",children:"Aggregate Data"}),jsxRuntimeExports.jsx(Button,{variant:"outlined",startIcon:jsxRuntimeExports.jsx(FilterIcon,{}),onClick:()=&gt;{},size:"small",children:"Filter Data"})]})]})]})};class HeatmapChartErrorBoundary extends BaseChartErrorBoundary{constructor(props){super({...props,chartType:props.chartType||"Heatmap",recoveryStrategies:[{name:"Reduce Grid Size",description:"Aggregate cells to create smaller grid",icon:jsxRuntimeExports.jsx(GridIcon,{}),action:async()=&gt;{this.handleReset()},condition:error=&gt;error.message.includes("memory")||error.message.includes("too many")},{name:"Filter Outliers",description:"Remove extreme values that may cause rendering issues",icon:jsxRuntimeExports.jsx(FilterIcon,{}),action:async()=&gt;{this.handleReset()},condition:error=&gt;error.message.includes("range")||error.message.includes("invalid")},...props.recoveryStrategies||[]]})}componentDidCatch(error,errorInfo){const heatmapContext={};try{const propsAny=this.props;propsAny.gridSize&amp;&amp;(heatmapContext.gridSize=propsAny.gridSize),propsAny.data&amp;&amp;Array.isArray(propsAny.data)&amp;&amp;(heatmapContext.cellCount=propsAny.data.length)}catch(e2){}super.componentDidCatch(error,errorInfo)}renderErrorFallback(){const{fallbackComponent:fallbackComponent}=this.props;return fallbackComponent?super.renderErrorFallback():jsxRuntimeExports.jsx(HeatmapErrorFallback,{error:this.state.error,errorInfo:this.state.errorInfo,chartInfo:this.state.chartInfo,retry:this.handleReset,canRetry:this.canRetry(),retryCount:this.state.retryCount,maxRetries:this.props.maxRetries||3})}}const ChartErrorBoundaryWrapper=props=&gt;{const{chartType:chartType,...boundaryProps}=props,normalizedType=chartType.toLowerCase().replace(/[^a-z0-9]/g,"");return normalizedType.includes("timeseries")||normalizedType.includes("timeline")||normalizedType.includes("line")||normalizedType.includes("area")?jsxRuntimeExports.jsx(TimeSeriesChartErrorBoundary,{...boundaryProps,chartType:chartType}):normalizedType.includes("heatmap")||normalizedType.includes("calendar")||normalizedType.includes("treemap")?jsxRuntimeExports.jsx(HeatmapChartErrorBoundary,{...boundaryProps,chartType:chartType}):jsxRuntimeExports.jsx(BaseChartErrorBoundary,{...boundaryProps,chartType:chartType})},CursorGlow=({containerRef:containerRef})=&gt;{const[mousePos,setMousePos]=reactExports.useState({x:0,y:0}),[isHovering,setIsHovering]=reactExports.useState(!1);return reactExports.useEffect(()=&gt;{const container=containerRef.current;if(!container)return;const handleMouseMove=e2=&gt;{const rect=container.getBoundingClientRect();setMousePos({x:e2.clientX-rect.left,y:e2.clientY-rect.top})},handleMouseEnter=()=&gt;setIsHovering(!0),handleMouseLeave=()=&gt;setIsHovering(!1);return container.addEventListener("mousemove",handleMouseMove),container.addEventListener("mouseenter",handleMouseEnter),container.addEventListener("mouseleave",handleMouseLeave),()=&gt;{container.removeEventListener("mousemove",handleMouseMove),container.removeEventListener("mouseenter",handleMouseEnter),container.removeEventListener("mouseleave",handleMouseLeave)}},[containerRef]),isHovering?jsxRuntimeExports.jsx(Box,{sx:{position:"absolute",left:mousePos.x-50,top:mousePos.y-50,width:100,height:100,pointerEvents:"none",zIndex:1e3,background:"radial-gradient(circle, rgba(0, 229, 255, 0.3) 0%, transparent 70%)",filter:"blur(20px)",transform:"translate(-50%, -50%)",transition:"opacity 0.3s ease",opacity:isHovering?1:0}}):null},ripple=keyframes`</span>
<span class="cstat-no" title="statement not covered" >  0% {</span>
<span class="cstat-no" title="statement not covered" >    transform: scale(0);</span>
<span class="cstat-no" title="statement not covered" >    opacity: 1;</span>
<span class="cstat-no" title="statement not covered" >  }</span>
<span class="cstat-no" title="statement not covered" >  100% {</span>
<span class="cstat-no" title="statement not covered" >    transform: scale(4);</span>
<span class="cstat-no" title="statement not covered" >    opacity: 0;</span>
<span class="cstat-no" title="statement not covered" >  }</span>
<span class="cstat-no" title="statement not covered" >`,DataPointRipple=({x:x,y:y})=&gt;jsxRuntimeExports.jsx(Box,{sx:{position:"absolute",left:x,top:y,width:20,height:20,borderRadius:"50%",border:"2px solid #00E5FF",transform:"translate(-50%, -50%)",animation:`${ripple} 0.6s ease-out`,pointerEvents:"none"}});keyframes`</span>
<span class="cstat-no" title="statement not covered" >  0% {</span>
<span class="cstat-no" title="statement not covered" >    transform: scale(1);</span>
<span class="cstat-no" title="statement not covered" >    opacity: 0.8;</span>
<span class="cstat-no" title="statement not covered" >  }</span>
<span class="cstat-no" title="statement not covered" >  50% {</span>
<span class="cstat-no" title="statement not covered" >    transform: scale(1.1);</span>
<span class="cstat-no" title="statement not covered" >    opacity: 0.4;</span>
<span class="cstat-no" title="statement not covered" >  }</span>
<span class="cstat-no" title="statement not covered" >  100% {</span>
<span class="cstat-no" title="statement not covered" >    transform: scale(1);</span>
<span class="cstat-no" title="statement not covered" >    opacity: 0.8;</span>
<span class="cstat-no" title="statement not covered" >  }</span>
<span class="cstat-no" title="statement not covered" >`,keyframes`</span>
<span class="cstat-no" title="statement not covered" >  0% {</span>
<span class="cstat-no" title="statement not covered" >    transform: translate(-50%, -50%) rotate(0deg);</span>
<span class="cstat-no" title="statement not covered" >  }</span>
<span class="cstat-no" title="statement not covered" >  100% {</span>
<span class="cstat-no" title="statement not covered" >    transform: translate(-50%, -50%) rotate(360deg);</span>
<span class="cstat-no" title="statement not covered" >  }</span>
<span class="cstat-no" title="statement not covered" >`;const CHART_OPTIMIZATION_CONFIG={largeDataConfig:{progressiveThreshold:Number.MAX_SAFE_INTEGER,samplingThreshold:Number.MAX_SAFE_INTEGER,enableProgressive:!1,enableSampling:!1,samplingMethod:"lttb",largeModeThreshold:Number.MAX_SAFE_INTEGER,enableLargeMode:!1,animationDisableThreshold:Number.MAX_SAFE_INTEGER,enableAnimationOptimization:!1,enableDataZoomOptimization:!1},chartTypeOverrides:{line:{enableSampling:!1,samplingThreshold:Number.MAX_SAFE_INTEGER},TimeSeries:{enableSampling:!1,samplingThreshold:Number.MAX_SAFE_INTEGER},SPC:{enableSampling:!1,samplingThreshold:Number.MAX_SAFE_INTEGER}}};!function registerBuildingVitalsThemes(echarts2){echarts2.registerTheme("building-vitals-dark",buildingVitalsDarkTheme),echarts2.registerTheme("building-vitals-light",buildingVitalsLightTheme)}(echarts),function registerThemes(echarts2){echarts2.registerTheme("building-vitals-light",lightTheme),echarts2.registerTheme("building-vitals-dark",darkTheme)}(echarts);const MemoizedEChartsWrapperContent=React.memo(({option:option,loading:loading=!1,error:error=null,height:height="100%",width:width="100%",theme:theme="light",onChartReady:onChartReady,onEvents:onEvents,className:className="",getChartInstance:getChartInstance,enableDeviation:enableDeviation=!1,deviationConfig:deviationConfig,enableRangeCompliance:enableRangeCompliance=!1,rangeConfig:rangeConfig,enableLargeDataOptimization:enableLargeDataOptimization=!1,largeDataConfig:largeDataConfig,chartId:chartId,chartType:chartType,renderer:renderer="canvas",forceWebGL:forceWebGL=!1})=&gt;{const chartRef=reactExports.useRef(null);reactExports.useRef(null);const containerRef=reactExports.useRef(null),[ripples,setRipples]=reactExports.useState([]),[containerSize,setContainerSize]=reactExports.useState({width:0,height:0});let chartSyncContext=null;try{chartSyncContext=(()=&gt;{const context=reactExports.useContext(ChartSyncContext);if(!context)throw new Error("useChartSyncContext must be used within ChartSyncProvider");return context})()}catch(e2){}if(reactExports.useEffect(()=&gt;{if(chartSyncContext&amp;&amp;chartId&amp;&amp;chartRef.current){const instance=chartRef.current.getEchartsInstance();if(instance)return chartSyncContext.chartSync.registerChart(chartId,instance),()=&gt;{chartSyncContext.chartSync.unregisterChart(chartId)}}},[chartSyncContext,chartId]),reactExports.useEffect(()=&gt;{let resizeObserver=null,animationFrameId=null,debounceTimeoutRef=null;const performResize=()=&gt;{if(chartRef.current){const echartsInstance=chartRef.current.getEchartsInstance();if(echartsInstance&amp;&amp;!echartsInstance.isDisposed())try{echartsInstance.resize({animation:{duration:200,easing:"cubicOut"}})}catch(error2){}}},handleImmediateResize=()=&gt;{animationFrameId&amp;&amp;cancelAnimationFrame(animationFrameId),animationFrameId=requestAnimationFrame(()=&gt;{performResize(),animationFrameId=null})},handleDebouncedResize=()=&gt;{debounceTimeoutRef&amp;&amp;clearTimeout(debounceTimeoutRef),debounceTimeoutRef=setTimeout(()=&gt;{performResize(),debounceTimeoutRef=null},150)};containerRef.current&amp;&amp;"undefined"!=typeof ResizeObserver&amp;&amp;(resizeObserver=new ResizeObserver(entries=&gt;{for(const entry of entries){const{width:width2,height:height2}=entry.contentRect;if(width2&gt;0&amp;&amp;height2&gt;0){const prevSize=containerSize,newSize={width:width2,height:height2};(Math.abs(prevSize.width-width2)&gt;1||Math.abs(prevSize.height-height2)&gt;1)&amp;&amp;(setContainerSize(newSize),chartResizeDebugger.logEvent("container-resize",{oldSize:prevSize,newSize:newSize,sizeDelta:{width:width2-prevSize.width,height:height2-prevSize.height}},containerRef.current||void 0,void 0,chartId),handleImmediateResize(),handleDebouncedResize())}}}),resizeObserver.observe(containerRef.current));const windowResizeHandler=()=&gt;{handleImmediateResize(),handleDebouncedResize()};window.addEventListener("resize",windowResizeHandler);const customResizeHandler=event=&gt;{"resize"!==event.type&amp;&amp;"grid-resize"!==event.type||handleImmediateResize()};window.addEventListener("grid-resize",customResizeHandler);return setTimeout(()=&gt;performResize(),100),setTimeout(()=&gt;performResize(),300),setTimeout(()=&gt;performResize(),500),()=&gt;{animationFrameId&amp;&amp;cancelAnimationFrame(animationFrameId),debounceTimeoutRef&amp;&amp;clearTimeout(debounceTimeoutRef),resizeObserver&amp;&amp;resizeObserver.disconnect(),window.removeEventListener("resize",windowResizeHandler),window.removeEventListener("grid-resize",customResizeHandler)}},[containerSize,chartId]),(null==option?void 0:option.series)&amp;&amp;isSeriesArray(option.series),loading)return jsxRuntimeExports.jsx("div",{className:`echarts-wrapper echarts-loading ${className}`,style:{height:"number"==typeof height?`${height}px`:height,width:"number"==typeof width?`${width}px`:width},children:jsxRuntimeExports.jsx(ChartSkeletonLoader,{height:height,chartType:"line",showHeader:!1,animated:!0})});if(error)return jsxRuntimeExports.jsx("div",{className:`echarts-wrapper echarts-error ${className}`,style:{display:"flex",justifyContent:"center",alignItems:"center",height:"number"==typeof height?`${height}px`:height,width:"number"==typeof width?`${width}px`:width},children:jsxRuntimeExports.jsx(Alert,{severity:"error",children:error.message||"Failed to load chart"})});if(!option||0===Object.keys(option).length)return jsxRuntimeExports.jsx("div",{className:`echarts-wrapper echarts-no-data ${className}`,style:{display:"flex",justifyContent:"center",alignItems:"center",height:"number"==typeof height?`${height}px`:height,width:"number"==typeof width?`${width}px`:width},children:jsxRuntimeExports.jsx(Alert,{severity:"info",children:"No data available"})});const hasData=reactExports.useMemo(()=&gt;!(!(null==option?void 0:option.series)||!Array.isArray(option.series))&amp;&amp;option.series.some(s=&gt;s.data&amp;&amp;s.data.length&gt;0),[option]),enhancedOption=reactExports.useMemo(()=&gt;{var _a,_b,_c,_d,_e,_f,_g,_h;try{let safeOption=createSafeEChartsOption(option);safeOption.tooltip&amp;&amp;"boolean"!=typeof safeOption.tooltip||(safeOption.tooltip=createEnhancedTooltip()),safeOption=handleEmptyChartData("generic",safeOption),safeOption=addChartErrorBoundaries(safeOption,error2=&gt;{});const dataSize=Array.isArray(safeOption.series)?safeOption.series.reduce((total,s)=&gt;total+(Array.isArray(s.data)?s.data.length:0),0):0;if(dataSize&gt;0&amp;&amp;(safeOption=optimizeChartPerformance(safeOption,dataSize)),containerSize.width&gt;0&amp;&amp;containerSize.height&gt;0&amp;&amp;(safeOption=applyResponsiveConfig(safeOption,containerSize.width,containerSize.height)),enableLargeDataOptimization){const globalConfig=function getChartOptimizationConfig(chartType){const baseConfig=CHART_OPTIMIZATION_CONFIG.largeDataConfig;return CHART_OPTIMIZATION_CONFIG.chartTypeOverrides[chartType]?{...baseConfig,...CHART_OPTIMIZATION_CONFIG.chartTypeOverrides[chartType]}:baseConfig}(chartType2);safeOption=applyLargeDataOptimizations(safeOption,{enableProgressive:(null==largeDataConfig?void 0:largeDataConfig.enableProgressive)??globalConfig.enableProgressive,progressiveThreshold:(null==largeDataConfig?void 0:largeDataConfig.progressiveThreshold)??globalConfig.progressiveThreshold,enableSampling:(null==largeDataConfig?void 0:largeDataConfig.enableSampling)??globalConfig.enableSampling,samplingThreshold:(null==largeDataConfig?void 0:largeDataConfig.samplingThreshold)??globalConfig.samplingThreshold,samplingMethod:(null==largeDataConfig?void 0:largeDataConfig.samplingMethod)??globalConfig.samplingMethod,enableLargeMode:(null==largeDataConfig?void 0:largeDataConfig.enableLargeMode)??globalConfig.enableLargeMode,largeModeThreshold:(null==largeDataConfig?void 0:largeDataConfig.largeModeThreshold)??globalConfig.largeModeThreshold,enableDataZoomOptimization:(null==largeDataConfig?void 0:largeDataConfig.enableDataZoomOptimization)??globalConfig.enableDataZoomOptimization,enableAnimationOptimization:(null==largeDataConfig?void 0:largeDataConfig.enableAnimationOptimization)??globalConfig.enableAnimationOptimization})}if(enableDeviation&amp;&amp;deviationConfig&amp;&amp;Array.isArray(safeOption.series)){const timeRange={start:new Date((null==(_a=safeOption.xAxis)?void 0:_a.min)||Date.now()-864e5),end:new Date((null==(_b=safeOption.xAxis)?void 0:_b.max)||Date.now())},deviationBands=generateDeviationBands(deviationConfig.setpoint,deviationConfig.tolerance,timeRange),deviationZones=generateDeviationZones(deviationConfig.setpoint,deviationConfig.tolerance,{min:(null==(_c=safeOption.yAxis)?void 0:_c.min)||0,max:(null==(_d=safeOption.yAxis)?void 0:_d.max)||100});safeOption.series=[...deviationBands,...safeOption.series],safeOption.visualMap||(safeOption.visualMap={show:!1,pieces:deviationZones}),safeOption.series.forEach(series=&gt;{series.data&amp;&amp;Array.isArray(series.data)&amp;&amp;"line"!==series.type&amp;&amp;(series.data=series.data.map(point=&gt;{const value="number"==typeof point?point:point.value||point[1],deviation=calculateDeviation$2(value,deviationConfig);return"number"==typeof point?{value:point,itemStyle:{color:deviation.color}}:{...point,itemStyle:{color:deviation.color}}}))})}if(enableRangeCompliance&amp;&amp;rangeConfig&amp;&amp;Array.isArray(safeOption.series)){const rangeZones=createRangeZones(rangeConfig.min,rangeConfig.max,(null==(_e=safeOption.yAxis)?void 0:_e.min)||0,(null==(_f=safeOption.yAxis)?void 0:_f.max)||100);safeOption.series.forEach(series=&gt;{"line"!==series.type&amp;&amp;"bar"!==series.type||(series.markArea={silent:!0,data:rangeZones.map(zone=&gt;({name:zone.name,yAxis:zone.yAxis,itemStyle:zone.itemStyle}))}),series.data&amp;&amp;Array.isArray(series.data)&amp;&amp;(series.data=series.data.map(point=&gt;{const value="number"==typeof point?point:point.value||point[1],color=getRangeComplianceColor(value,rangeConfig.min,rangeConfig.max);return"number"==typeof point?{value:point,itemStyle:{color:color}}:{...point,itemStyle:{color:color}}}))});const refLines=[{name:"Maximum",type:"line",data:[],markLine:{data:[{yAxis:rangeConfig.max}],lineStyle:{color:"#F44336",type:"dashed"}}},{name:"Minimum",type:"line",data:[],markLine:{data:[{yAxis:rangeConfig.min}],lineStyle:{color:"#2196F3",type:"dashed"}}}];safeOption.series=[...refLines,...safeOption.series]}const chartType2=(null==(_h=null==(_g=safeOption.series)?void 0:_g[0])?void 0:_h.type)||"line";return enhanceChartWithProfessionalTheme(safeOption,chartType2)}catch(error2){return option}},[option,enableDeviation,deviationConfig,enableRangeCompliance,rangeConfig,containerSize]),chartStyle=reactExports.useMemo(()=&gt;({height:"100%",width:"100%"}),[]),handleChartEvents=reactExports.useMemo(()=&gt;{const events2={...onEvents},originalClick=events2.click;return events2.click=params=&gt;{var _a;if("series"===params.componentType&amp;&amp;params.event){if(null==(_a=containerRef.current)?void 0:_a.getBoundingClientRect()){const rippleId=`${Date.now()}-${Math.random()}`,x=params.event.offsetX||0,y=params.event.offsetY||0;setRipples(prev=&gt;[...prev,{id:rippleId,x:x,y:y}]),setTimeout(()=&gt;{setRipples(prev=&gt;prev.filter(r=&gt;r.id!==rippleId))},600)}}originalClick&amp;&amp;originalClick(params)},events2.mousemove||(events2.mousemove=params=&gt;{if(chartRef.current){const instance=chartRef.current.getEchartsInstance();instance&amp;&amp;"series"===params.componentType&amp;&amp;instance.dispatchAction({type:"highlight",seriesIndex:params.seriesIndex})}}),events2.globalout||(events2.globalout=()=&gt;{if(chartRef.current){const instance=chartRef.current.getEchartsInstance();instance&amp;&amp;instance.dispatchAction({type:"downplay"})}}),events2},[onEvents]);return jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(ChartLoadingState,{loading:loading,error:error,hasData:hasData,chartRef:chartRef,height:height}),jsxRuntimeExports.jsxs("div",{ref:containerRef,className:`echarts-wrapper ${className}`,style:{height:"number"==typeof height?`${height}px`:height,width:"number"==typeof width?`${width}px`:width,position:"relative",display:"flex",flexDirection:"column",minHeight:"number"==typeof height?height:300,minWidth:0,transition:"all 0.2s cubic-bezier(0.4, 0, 0.2, 1)",opacity:loading?.7:1,"&amp; &gt; div":{position:"relative",height:"100%",width:"100%",pointerEvents:"auto !important"},"&amp; canvas":{pointerEvents:"auto !important",cursor:"crosshair"},'&amp; [class*="echarts"]':{pointerEvents:"auto !important"}},children:[jsxRuntimeExports.jsx(CursorGlow,{containerRef:containerRef}),ripples.map(ripple2=&gt;jsxRuntimeExports.jsx(DataPointRipple,{x:ripple2.x,y:ripple2.y},ripple2.id)),jsxRuntimeExports.jsx(EChartsReact,{ref:chartRef,lazyUpdate:!0,notMerge:!1,option:enhancedOption,opts:{renderer:(()=&gt;{if(forceWebGL||"webgl"===renderer)return"canvas";return(Array.isArray(enhancedOption.series)?enhancedOption.series.reduce((total,s)=&gt;total+(Array.isArray(s.data)?s.data.length:0),0):0)&gt;1e5&amp;&amp;"heatmap"===chartType?"canvas":renderer})(),width:containerSize.width&gt;0?containerSize.width:"auto",height:containerSize.height&gt;0?containerSize.height:"auto",devicePixelRatio:window.devicePixelRatio||1,resizeDelay:100},style:chartStyle,theme:(isDarkMode="dark"===theme,isDarkMode?"building-vitals-dark":"building-vitals-light"),onChartReady:chartInstance=&gt;{try{fixChartInteractions(chartInstance),containerRef.current&amp;&amp;(chartResizeDebugger.measureChartHierarchy(containerRef.current,chartId),chartResizeDebugger.logEvent("chart-ready",{chartSize:chartInstance.getWidth?{width:chartInstance.getWidth(),height:chartInstance.getHeight()}:null},containerRef.current,void 0,chartId)),getChartInstance&amp;&amp;getChartInstance(chartInstance),onChartReady&amp;&amp;onChartReady(chartInstance)}catch(error2){}},onEvents:handleChartEvents||onEvents})]})]});var isDarkMode},areChartPropsEqual),EChartsWrapper=props=&gt;{const{enableErrorBoundary:enableErrorBoundary=!0,chartType:chartType="ECharts",chartId:chartId,renderer:renderer,forceWebGL:forceWebGL,...restProps}=props,{logError:logError}=((chartType,chartId)=&gt;{const[debugInfo,setDebugInfo]=reactExports.useState({chartId:chartId||"unknown",chartType:chartType,renderTime:0,dataPoints:0,errors:[],warnings:[],performance:{renderCount:0,lastRender:Date.now()}});return{debugInfo:debugInfo,logError:error=&gt;{setDebugInfo(prev=&gt;({...prev,errors:[...prev.errors,{timestamp:Date.now(),message:error.message,stack:error.stack}].slice(-10)}))},logWarning:message=&gt;{setDebugInfo(prev=&gt;({...prev,warnings:[...prev.warnings,{timestamp:Date.now(),message:message}].slice(-10)}))},updatePerformance:(renderTime,dataPoints)=&gt;{setDebugInfo(prev=&gt;({...prev,renderTime:renderTime,dataPoints:dataPoints??prev.dataPoints,performance:{...prev.performance,renderCount:prev.performance.renderCount+1,lastRender:Date.now()}}))}}})(chartType,chartId);return enableErrorBoundary?jsxRuntimeExports.jsx(ChartErrorBoundaryWrapper,{chartType:chartType,chartId:chartId,showDebugInfo:!1,enableAutoRecovery:!0,maxRetries:3,onError:(error,errorInfo,chartInfo)=&gt;{logError(error)},children:jsxRuntimeExports.jsx(MemoizedEChartsWrapperContent,{...restProps,chartType:chartType,chartId:chartId,renderer:renderer,forceWebGL:forceWebGL})}):jsxRuntimeExports.jsx(MemoizedEChartsWrapperContent,{...restProps,chartType:chartType,chartId:chartId,renderer:renderer,forceWebGL:forceWebGL})},ChartExportToolbar=({chartInstance:chartInstance,chartData:chartData=[],chartTitle:chartTitle="chart",chartType:chartType="generic",position:position="top-right",size:size="small",showLabels:showLabels=!1,enableEnhancedExport:enableEnhancedExport=!0,onExportStart:onExportStart,onExportComplete:onExportComplete,onExportError:onExportError})=&gt;{const theme=useTheme(),[anchorEl,setAnchorEl]=reactExports.useState(null),[exporting,setExporting]=reactExports.useState(!1),[exportError,setExportError]=reactExports.useState(null),[exportSuccess,setExportSuccess]=reactExports.useState(null),handleExportClick=event=&gt;{setAnchorEl(event.currentTarget)},handleClose=()=&gt;{setAnchorEl(null)},convertToTimeseriesDataPoints=data=&gt;{const points=[];return data.forEach(series=&gt;{series.data.forEach(point=&gt;{Array.isArray(point)&amp;&amp;point.length&gt;=2?points.push({timestamp:new Date(point[0]),value:point[1],unit:series.unit,pointName:series.name}):"object"==typeof point&amp;&amp;"timestamp"in point&amp;&amp;"value"in point&amp;&amp;points.push(point)})}),points.sort((a,b)=&gt;new Date(a.timestamp).getTime()-new Date(b.timestamp).getTime())},exportOptions=[{format:"png",icon:jsxRuntimeExports.jsx(ImageIcon,{fontSize:"small"}),label:"Export as PNG",description:"High-quality image export",disabled:!chartInstance},{format:"csv",icon:jsxRuntimeExports.jsx(CsvIcon,{fontSize:"small"}),label:"Export as CSV",description:"Raw data in spreadsheet format",disabled:0===chartData.length},{format:"json",icon:jsxRuntimeExports.jsx(JsonIcon,{fontSize:"small"}),label:"Export as JSON",description:"Structured data format",disabled:0===chartData.length}];return jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsxs(Box,{sx:(()=&gt;{const baseStyles={position:"absolute",zIndex:Z_INDEX_CONFIG.CHART_EXPORT_TOOLBAR,backdropFilter:"blur(8px)",backgroundColor:"dark"===theme.palette.mode?"rgba(0, 0, 0, 0.8)":"rgba(255, 255, 255, 0.9)",borderRadius:1,padding:.5,boxShadow:"0 2px 8px rgba(0,0,0,0.15)",border:`1px solid ${theme.palette.divider}`};switch(position){case"top-right":default:return{...baseStyles,top:-50,right:8};case"top-left":return{...baseStyles,top:-50,left:8};case"bottom-right":return{...baseStyles,bottom:-50,right:8};case"bottom-left":return{...baseStyles,bottom:-50,left:8}}})(),children:[showLabels?jsxRuntimeExports.jsx(ButtonGroup,{size:size,variant:"outlined",children:jsxRuntimeExports.jsx(Tooltip,{title:"Export chart and data",children:jsxRuntimeExports.jsx(Button,{startIcon:exporting?jsxRuntimeExports.jsx(CircularProgress,{size:16}):jsxRuntimeExports.jsx(ExportIcon,{}),disabled:exporting,onClick:handleExportClick,children:"Export"})})}):jsxRuntimeExports.jsx(Tooltip,{title:"Export options",children:jsxRuntimeExports.jsx(IconButton,{size:size,disabled:exporting,onClick:handleExportClick,sx:{backgroundColor:theme.palette.background.paper,"&amp;:hover":{backgroundColor:theme.palette.action.hover}},children:exporting?jsxRuntimeExports.jsx(CircularProgress,{size:16}):jsxRuntimeExports.jsx(ExportIcon,{})})}),jsxRuntimeExports.jsxs(Menu,{anchorEl:anchorEl,open:Boolean(anchorEl),onClose:handleClose,PaperProps:{sx:{backgroundColor:theme.palette.background.paper,backdropFilter:"blur(10px)",border:`1px solid ${theme.palette.divider}`,minWidth:220}},children:[jsxRuntimeExports.jsx(MenuItem,{disabled:!0,sx:{fontSize:"0.75rem",opacity:.7},children:jsxRuntimeExports.jsx(ListItemText,{primary:"Export Options"})}),jsxRuntimeExports.jsx(Divider,{}),exportOptions.map(option=&gt;jsxRuntimeExports.jsxs(MenuItem,{disabled:option.disabled||exporting,onClick:()=&gt;(async format2=&gt;{setExporting(!0),setExportError(null),null==onExportStart||onExportStart();try{const timestamp=(new Date).toISOString().slice(0,19).replace(/[:.]/g,"-"),baseFilename=`${chartTitle.replace(/[^a-zA-Z0-9]/g,"_")}_${timestamp}`;switch(format2){case"png":if(!chartInstance)throw new Error("Chart instance not available for PNG export");const exportOptions2={filename:`${baseFilename}.png`,format:"png",backgroundColor:theme.palette.background.paper,pixelRatio:2,quality:1};await exportChartAsImage(chartInstance,exportOptions2),setExportSuccess("Chart exported as PNG successfully!");break;case"csv":if(enableEnhancedExport&amp;&amp;chartInstance)try{exportChartWithCalculations(chartInstance,chartType,`${baseFilename}.csv`),setExportSuccess("Data exported as CSV with calculated values!")}catch(enhancedError){if(0===chartData.length)throw new Error("No data available for CSV export");const csvData=convertToTimeseriesDataPoints(chartData);exportTimeseriesAsCSV(csvData,{filename:`${baseFilename}.csv`,includeHeaders:!0,dateFormat:"iso",precision:3,includeUnits:!0}),setExportSuccess("Data exported as CSV successfully!")}else{if(0===chartData.length)throw new Error("No data available for CSV export");const csvData=convertToTimeseriesDataPoints(chartData);exportTimeseriesAsCSV(csvData,{filename:`${baseFilename}.csv`,includeHeaders:!0,dateFormat:"iso",precision:3,includeUnits:!0}),setExportSuccess("Data exported as CSV successfully!")}break;case"json":if(0===chartData.length)throw new Error("No data available for JSON export");const jsonData=convertToTimeseriesDataPoints(chartData);exportTimeseriesAsJSON(jsonData,`${baseFilename}.json`,!0),setExportSuccess("Data exported as JSON successfully!");break;default:throw new Error(`Unsupported export format: ${format2}`)}null==onExportComplete||onExportComplete(format2)}catch(error){const errorMessage=error instanceof Error?error.message:"Export failed";setExportError(errorMessage),null==onExportError||onExportError(errorMessage)}finally{setExporting(!1),handleClose()}})(option.format),sx:{py:1.5},children:[jsxRuntimeExports.jsx(ListItemIcon,{sx:{minWidth:36},children:option.icon}),jsxRuntimeExports.jsx(ListItemText,{primary:option.label,secondary:option.description,primaryTypographyProps:{fontSize:"0.875rem"},secondaryTypographyProps:{fontSize:"0.75rem"}})]},option.format)),jsxRuntimeExports.jsx(Divider,{}),jsxRuntimeExports.jsxs(MenuItem,{disabled:!0,sx:{fontSize:"0.75rem",opacity:.5},children:[jsxRuntimeExports.jsx(ListItemIcon,{sx:{minWidth:36},children:jsxRuntimeExports.jsx(SettingsIcon,{fontSize:"small"})}),jsxRuntimeExports.jsx(ListItemText,{primary:`${chartData.length} series  ${chartData.reduce((sum,s)=&gt;sum+s.data.length,0)} points`})]})]})]}),jsxRuntimeExports.jsx(Snackbar,{open:!!exportSuccess,autoHideDuration:3e3,onClose:()=&gt;setExportSuccess(null),anchorOrigin:{vertical:"bottom",horizontal:"right"},children:jsxRuntimeExports.jsx(Alert,{onClose:()=&gt;setExportSuccess(null),severity:"success",variant:"filled",children:exportSuccess})}),jsxRuntimeExports.jsx(Snackbar,{open:!!exportError,autoHideDuration:5e3,onClose:()=&gt;setExportError(null),anchorOrigin:{vertical:"bottom",horizontal:"right"},children:jsxRuntimeExports.jsx(Alert,{onClose:()=&gt;setExportError(null),severity:"error",variant:"filled",children:exportError})})]})},SEVERITY_CONFIG={low:{color:"#2196F3",icon:Info,label:"Low",priority:1,pulseSpeed:3},medium:{color:"#FF9800",icon:WarningIcon,label:"Medium",priority:2,pulseSpeed:2},high:{color:"#FF5722",icon:ErrorIcon,label:"High",priority:3,pulseSpeed:1.5},critical:{color:"#F44336",icon:ErrorIcon,label:"Critical",priority:4,pulseSpeed:1}},FaultOverlay=({faults:faults=[],timeRange:timeRange,height:height="100%",width:width="100%",showSummaryPanel:showSummaryPanel=!0,enableFiltering:enableFiltering=!0,enableAutoDetection:enableAutoDetection=!0,detectionSensitivity:detectionSensitivity="medium",onFaultClick:onFaultClick,onFaultAcknowledge:onFaultAcknowledge,onFaultResolve:onFaultResolve,onToggleAutoDetection:onToggleAutoDetection,onSensitivityChange:onSensitivityChange,chartBounds:chartBounds,getChartPosition:getChartPosition})=&gt;{const theme=useTheme(),[expandedPanel,setExpandedPanel]=reactExports.useState(!1),[selectedSeverities,setSelectedSeverities]=reactExports.useState(new Set(["low","medium","high","critical"])),[selectedTypes,setSelectedTypes]=reactExports.useState(new Set(["temperature","humidity","pressure","flow","energy","vibration","electrical","mechanical"])),[showResolved,setShowResolved]=reactExports.useState(!1),filteredFaults=reactExports.useMemo(()=&gt;faults.filter(fault=&gt;!(fault.timestamp&lt;timeRange.start||fault.timestamp&gt;timeRange.end)&amp;&amp;(!!selectedSeverities.has(fault.severity)&amp;&amp;(!!selectedTypes.has(fault.type)&amp;&amp;!(!showResolved&amp;&amp;fault.resolved)))),[faults,timeRange,selectedSeverities,selectedTypes,showResolved]),faultStats=reactExports.useMemo(()=&gt;{const stats={total:filteredFaults.length,bySeverity:{low:0,medium:0,high:0,critical:0},byType:{},resolved:filteredFaults.filter(f=&gt;f.resolved).length,acknowledged:filteredFaults.filter(f=&gt;f.acknowledged).length,unresolved:filteredFaults.filter(f=&gt;!f.resolved).length};return filteredFaults.forEach(fault=&gt;{stats.bySeverity[fault.severity]++,stats.byType[fault.type]=(stats.byType[fault.type]||0)+1}),stats},[filteredFaults]),handleSeverityFilter=reactExports.useCallback(severities=&gt;{setSelectedSeverities(new Set(severities))},[]),handleFaultClick=reactExports.useCallback(fault=&gt;{null==onFaultClick||onFaultClick(fault)},[onFaultClick]);reactExports.useCallback((faultId,event)=&gt;{event.stopPropagation(),null==onFaultAcknowledge||onFaultAcknowledge(faultId)},[onFaultAcknowledge]),reactExports.useCallback((faultId,event)=&gt;{event.stopPropagation(),null==onFaultResolve||onFaultResolve(faultId)},[onFaultResolve]);const renderFaultMarkers=reactExports.useCallback(()=&gt;getChartPosition&amp;&amp;chartBounds?filteredFaults.map(fault=&gt;{const position=getChartPosition(fault.timestamp,fault.value),config=SEVERITY_CONFIG[fault.severity],IconComponent=config.icon;return jsxRuntimeExports.jsx(motion.div,{initial:{scale:0,opacity:0},animate:{scale:1,opacity:1},exit:{scale:0,opacity:0},transition:{duration:.3},style:{position:"absolute",left:position.x-12,top:position.y-12,zIndex:1e3,cursor:"pointer"},onClick:()=&gt;handleFaultClick(fault),children:jsxRuntimeExports.jsx(motion.div,{animate:{scale:[1,1.2,1]},transition:{duration:config.pulseSpeed,repeat:1/0,ease:"easeInOut"},children:jsxRuntimeExports.jsx(Tooltip,{title:jsxRuntimeExports.jsxs(Box,{children:[jsxRuntimeExports.jsxs(Typography$1,{variant:"subtitle2",sx:{fontWeight:600},children:[config.label," Fault"]}),jsxRuntimeExports.jsx(Typography$1,{variant:"body2",children:fault.message}),jsxRuntimeExports.jsx(Typography$1,{variant:"caption",sx:{opacity:.8},children:new Date(fault.timestamp).toLocaleString()}),fault.confidence&amp;&amp;jsxRuntimeExports.jsxs(Typography$1,{variant:"caption",sx:{opacity:.8,display:"block"},children:["Confidence: ",Math.round(100*fault.confidence),"%"]})]}),placement:"top",arrow:!0,children:jsxRuntimeExports.jsx(Box,{sx:{width:24,height:24,borderRadius:"50%",backgroundColor:alpha(config.color,.2),border:`2px solid ${config.color}`,display:"flex",alignItems:"center",justifyContent:"center",boxShadow:`0 0 8px ${alpha(config.color,.4)}`,"&amp;:hover":{backgroundColor:alpha(config.color,.3),transform:"scale(1.1)"}},children:jsxRuntimeExports.jsx(IconComponent,{sx:{fontSize:14,color:config.color}})})})})},fault.id)}):null,[filteredFaults,getChartPosition,chartBounds,handleFaultClick]);return jsxRuntimeExports.jsxs(Box,{sx:{position:"relative",height:height,width:width,pointerEvents:"none","&amp; &gt; *":{pointerEvents:"auto"}},children:[jsxRuntimeExports.jsx(AnimatePresence,{children:renderFaultMarkers()}),faultStats.total&gt;0&amp;&amp;jsxRuntimeExports.jsx(Fade,{in:!0,children:jsxRuntimeExports.jsx(Box,{sx:{position:"absolute",top:8,right:8,zIndex:1001},children:jsxRuntimeExports.jsx(Badge,{badgeContent:faultStats.unresolved,color:"error",max:99,showZero:!1,children:jsxRuntimeExports.jsx(Tooltip,{title:"View Fault Summary",children:jsxRuntimeExports.jsx(IconButton,{size:"small",onClick:()=&gt;setExpandedPanel(!expandedPanel),sx:{backgroundColor:alpha(theme.palette.background.paper,.9),backdropFilter:"blur(4px)","&amp;:hover":{backgroundColor:alpha(theme.palette.background.paper,1)}},children:jsxRuntimeExports.jsx(BugReportIcon,{})})})})})}),showSummaryPanel&amp;&amp;jsxRuntimeExports.jsx(Collapse,{in:expandedPanel,timeout:"auto",unmountOnExit:!0,sx:{position:"absolute",top:56,right:8,zIndex:1002,minWidth:320,maxWidth:400},children:jsxRuntimeExports.jsxs(Paper,{elevation:8,sx:{p:2,backgroundColor:alpha(theme.palette.background.paper,.95),backdropFilter:"blur(8px)",border:`1px solid ${alpha(theme.palette.divider,.2)}`},children:[jsxRuntimeExports.jsxs(Box,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:2},children:[jsxRuntimeExports.jsxs(Typography$1,{variant:"h6",sx:{display:"flex",alignItems:"center",gap:1},children:[jsxRuntimeExports.jsx(Assessment,{}),"Fault Detection"]}),jsxRuntimeExports.jsx(IconButton,{size:"small",onClick:()=&gt;setExpandedPanel(!1),sx:{ml:1},children:jsxRuntimeExports.jsx(ExpandMoreIcon,{})})]}),jsxRuntimeExports.jsxs(Box,{sx:{mb:2},children:[jsxRuntimeExports.jsx(FormControlLabel,{control:jsxRuntimeExports.jsx(Switch,{checked:enableAutoDetection,onChange:e2=&gt;null==onToggleAutoDetection?void 0:onToggleAutoDetection(e2.target.checked),size:"small"}),label:"Auto Detection",sx:{mr:0}}),enableAutoDetection&amp;&amp;jsxRuntimeExports.jsxs(ToggleButtonGroup,{value:detectionSensitivity,exclusive:!0,onChange:(_,value)=&gt;value&amp;&amp;(null==onSensitivityChange?void 0:onSensitivityChange(value)),size:"small",sx:{ml:1},children:[jsxRuntimeExports.jsx(ToggleButton,{value:"low",children:"Low"}),jsxRuntimeExports.jsx(ToggleButton,{value:"medium",children:"Med"}),jsxRuntimeExports.jsx(ToggleButton,{value:"high",children:"High"})]})]}),jsxRuntimeExports.jsx(Stack,{direction:"row",spacing:1,sx:{mb:2,flexWrap:"wrap"},children:Object.entries(SEVERITY_CONFIG).map(([severity,config])=&gt;jsxRuntimeExports.jsx(Chip,{size:"small",label:`${config.label}: ${faultStats.bySeverity[severity]}`,sx:{backgroundColor:alpha(config.color,.1),color:config.color,border:`1px solid ${alpha(config.color,.3)}`}},severity))}),enableFiltering&amp;&amp;jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(Divider,{sx:{my:1}}),jsxRuntimeExports.jsxs(Typography$1,{variant:"subtitle2",sx:{mb:1,display:"flex",alignItems:"center",gap:1},children:[jsxRuntimeExports.jsx(FilterIcon$1,{fontSize:"small"}),"Filters"]}),jsxRuntimeExports.jsx(ToggleButtonGroup,{value:Array.from(selectedSeverities),onChange:(_,severities)=&gt;handleSeverityFilter(severities),size:"small",sx:{mb:1,flexWrap:"wrap"},children:Object.entries(SEVERITY_CONFIG).map(([severity,config])=&gt;jsxRuntimeExports.jsx(ToggleButton,{value:severity,children:config.label},severity))}),jsxRuntimeExports.jsx(FormControlLabel,{control:jsxRuntimeExports.jsx(Switch,{checked:showResolved,onChange:e2=&gt;setShowResolved(e2.target.checked),size:"small"}),label:"Show Resolved"})]}),filteredFaults.length&gt;0&amp;&amp;jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(Divider,{sx:{my:1}}),jsxRuntimeExports.jsxs(Typography$1,{variant:"subtitle2",sx:{mb:1},children:["Recent Faults (",filteredFaults.slice(0,5).length," of ",filteredFaults.length,")"]}),jsxRuntimeExports.jsx(List,{dense:!0,sx:{maxHeight:200,overflow:"auto"},children:filteredFaults.sort((a,b)=&gt;b.timestamp-a.timestamp).slice(0,5).map(fault=&gt;{const config=SEVERITY_CONFIG[fault.severity],IconComponent=config.icon;return jsxRuntimeExports.jsxs(ListItem,{onClick:()=&gt;handleFaultClick(fault),sx:{cursor:"pointer",borderRadius:1,mb:.5,backgroundColor:alpha(config.color,.05),border:`1px solid ${alpha(config.color,.2)}`,"&amp;:hover":{backgroundColor:alpha(config.color,.1)}},children:[jsxRuntimeExports.jsx(ListItemIcon,{sx:{minWidth:"auto",mr:1},children:jsxRuntimeExports.jsx(IconComponent,{sx:{fontSize:16,color:config.color,opacity:fault.resolved?.5:1}})}),jsxRuntimeExports.jsx(ListItemText,{primary:jsxRuntimeExports.jsx(Typography$1,{variant:"body2",sx:{fontWeight:500},children:fault.message}),secondary:jsxRuntimeExports.jsxs(Typography$1,{variant:"caption",sx:{opacity:.7},children:[new Date(fault.timestamp).toLocaleString(),fault.pointName&amp;&amp;`  ${fault.pointName}`,fault.confidence&amp;&amp;`  ${Math.round(100*fault.confidence)}%`]}),sx:{opacity:fault.resolved?.6:1}})]},fault.id)})})]}),0===filteredFaults.length&amp;&amp;jsxRuntimeExports.jsx(Box,{sx:{textAlign:"center",py:3,color:"text.secondary"},children:jsxRuntimeExports.jsx(Typography$1,{variant:"body2",children:"No faults detected in current view"})})]})})]})},calculateDeviation$1=(value,config)=&gt;{let deviation=0,isInRange=!1;if("single"===config.mode&amp;&amp;void 0!==config.setpoint){deviation=value-config.setpoint;const tolerance2=config.tolerance||0;isInRange=Math.abs(deviation)&lt;=tolerance2}else"range"===config.mode&amp;&amp;void 0!==config.minSetpoint&amp;&amp;void 0!==config.maxSetpoint&amp;&amp;(value&lt;config.minSetpoint?(deviation=value-config.minSetpoint,isInRange=!1):value&gt;config.maxSetpoint?(deviation=value-config.maxSetpoint,isInRange=!1):(deviation=0,isInRange=!0));config.deviationLimits&amp;&amp;(deviation=deviation&gt;0?Math.min(deviation,config.deviationLimits.positive):Math.max(deviation,-config.deviationLimits.negative));let severity="normal";const absDeviation=Math.abs(deviation),tolerance=config.tolerance||0;severity=isInRange?"normal":absDeviation&lt;=2*tolerance?"warning":"critical";return{deviation:deviation,isInRange:isInRange,severity:severity,color:getDeviationColor(deviation,config)}},getDeviationColor=(deviation,config)=&gt;{var _a,_b;const maxDeviation=Math.max((null==(_a=config.deviationLimits)?void 0:_a.positive)||10,(null==(_b=config.deviationLimits)?void 0:_b.negative)||10);if(Math.abs(deviation)&lt;=(config.tolerance||0))return"#4caf50";if(deviation&gt;0){const intensity=Math.min(Math.abs(deviation)/maxDeviation,1);return"stepped"===config.colorScale?getSteppedRedColor(intensity):getGradientRedColor(intensity)}{const intensity=Math.min(Math.abs(deviation)/maxDeviation,1);return"stepped"===config.colorScale?getSteppedBlueColor(intensity):getGradientBlueColor(intensity)}},getGradientRedColor=intensity=&gt;`hsl(0, 80%, ${100*Math.max(.9-.6*intensity,.3)}%)`,getGradientBlueColor=intensity=&gt;`hsl(220, 80%, ${100*Math.max(.9-.6*intensity,.3)}%)`,getSteppedRedColor=intensity=&gt;intensity&lt;.3?"#ffebee":intensity&lt;.6?"#ef5350":"#c62828",getSteppedBlueColor=intensity=&gt;intensity&lt;.3?"#e3f2fd":intensity&lt;.6?"#42a5f5":"#1565c0",createDeviationVisualMap=(data,config,options)=&gt;{const colorScale=((data,config)=&gt;{const deviations=data.map(value=&gt;calculateDeviation$1(value,config).deviation),minDeviation=deviations.length&gt;0?Math.min(...deviations):0,maxDeviation=deviations.length&gt;0?Math.max(...deviations):1,maxAbsDeviation=Math.max(Math.abs(minDeviation),Math.abs(maxDeviation)),scaleMin=-maxAbsDeviation,scaleMax=maxAbsDeviation;if("stepped"===config.colorScale){const tolerance=config.tolerance||0;return{min:scaleMin,max:scaleMax,colors:[],pieces:[{min:scaleMin,max:2*-tolerance,color:getSteppedBlueColor(1)},{min:2*-tolerance,max:-tolerance,color:getSteppedBlueColor(.5)},{min:-tolerance,max:tolerance,color:"#4caf50"},{min:tolerance,max:2*tolerance,color:getSteppedRedColor(.5)},{min:2*tolerance,max:scaleMax,color:getSteppedRedColor(1)}]}}return{min:scaleMin,max:scaleMax,colors:[getGradientBlueColor(1),getGradientBlueColor(.5),getGradientBlueColor(.1),"#4caf50",getGradientRedColor(.1),getGradientRedColor(.5),getGradientRedColor(1)]}})(data,config),{show:show=!0,orient:orient="vertical",right:right="10px",bottom:bottom="20%"}=options||{},baseConfig={show:show,orient:orient,right:right,bottom:bottom,min:colorScale.min,max:colorScale.max,calculable:!0,text:["High","Low"],textStyle:{color:"#333"},formatter:value=&gt;`${value&gt;=0?"+":"-"}${Math.abs(value).toFixed(2)}${config.unit||""}`};return"stepped"===config.colorScale&amp;&amp;colorScale.pieces?{...baseConfig,type:"piecewise",pieces:colorScale.pieces,showLabel:!0}:{...baseConfig,type:"continuous",inRange:{color:colorScale.colors}}},createSetpointMarkLines=config=&gt;{const markLines=[];return"single"===config.mode&amp;&amp;void 0!==config.setpoint?(markLines.push({yAxis:config.setpoint,label:{formatter:`Setpoint: ${config.setpoint}${config.unit||""}`,position:"end"},lineStyle:{color:"#4caf50",type:"solid",width:2}}),config.tolerance&amp;&amp;markLines.push({yAxis:config.setpoint+config.tolerance,label:{formatter:`+Tolerance: ${config.setpoint+config.tolerance}${config.unit||""}`,position:"end"},lineStyle:{color:"#ff9800",type:"dashed",width:1}},{yAxis:config.setpoint-config.tolerance,label:{formatter:`-Tolerance: ${config.setpoint-config.tolerance}${config.unit||""}`,position:"end"},lineStyle:{color:"#ff9800",type:"dashed",width:1}})):"range"===config.mode&amp;&amp;(void 0!==config.minSetpoint&amp;&amp;markLines.push({yAxis:config.minSetpoint,label:{formatter:`Min: ${config.minSetpoint}${config.unit||""}`,position:"end"},lineStyle:{color:"#4caf50",type:"solid",width:2}}),void 0!==config.maxSetpoint&amp;&amp;markLines.push({yAxis:config.maxSetpoint,label:{formatter:`Max: ${config.maxSetpoint}${config.unit||""}`,position:"end"},lineStyle:{color:"#4caf50",type:"solid",width:2}})),markLines},createSetpointMarkAreas=config=&gt;{const markAreas=[];return"range"===config.mode&amp;&amp;void 0!==config.minSetpoint&amp;&amp;void 0!==config.maxSetpoint?markAreas.push([{yAxis:config.minSetpoint,itemStyle:{color:"rgba(76, 175, 80, 0.1)"}},{yAxis:config.maxSetpoint}]):"single"===config.mode&amp;&amp;void 0!==config.setpoint&amp;&amp;config.tolerance&amp;&amp;markAreas.push([{yAxis:config.setpoint-config.tolerance,itemStyle:{color:"rgba(76, 175, 80, 0.1)"}},{yAxis:config.setpoint+config.tolerance}]),markAreas},categoryFeatures={timeseries:{toolbox:!0,dataZoom:!0,dataView:!0,saveAsImage:!0,restore:!0,magicType:!0,markPoint:!0,markLine:!0,markArea:!0,brush:!0},statistical:{toolbox:!0,dataZoom:!0,dataView:!0,saveAsImage:!0,restore:!0,markLine:!0},distribution:{toolbox:!0,dataView:!0,saveAsImage:!0,restore:!0,brush:!0},correlation:{toolbox:!0,dataView:!0,saveAsImage:!0,restore:!0,brush:!0},gauge:{toolbox:!0,saveAsImage:!0,dataView:!0}},chartTypeCategory={TimeSeries:"timeseries",AreaChart:"timeseries",StackedArea:"timeseries",Candlestick:"timeseries",EnhancedLine:"timeseries",BoxPlot:"statistical",BarChart:"statistical",ControlBand:"statistical",SPC:"statistical",Heatmap:"distribution",CalendarHeatmap:"distribution",DeviceDeviationHeatmap:"distribution",Psychrometric:"distribution",ScatterPlot:"correlation",ParallelCoordinates:"correlation",PerfectEconomizer:"timeseries",ChilledWaterReset:"timeseries",DPOptimization:"timeseries",SimultaneousHC:"timeseries",Gauge:"gauge"},getMarkLineConfig=(thresholds,unit)=&gt;{if(thresholds&amp;&amp;0!==thresholds.length)return{symbol:"none",animation:!1,label:{formatter:params=&gt;{const threshold=thresholds.find(t=&gt;t.value===params.value);return threshold?`${threshold.name}: ${params.value}${unit||""}`:""},position:"end"},lineStyle:{type:"dashed",width:2},data:thresholds.map(threshold=&gt;({yAxis:threshold.value,name:threshold.name,lineStyle:{color:threshold.color||"#ff6b6b"},label:{color:threshold.color||"#ff6b6b"}}))}},getMarkAreaConfig=(ranges,_unit)=&gt;{if(ranges&amp;&amp;0!==ranges.length)return{silent:!0,itemStyle:{opacity:.3},data:ranges.map(range=&gt;[{yAxis:range.start,name:range.name,itemStyle:{color:range.color||"rgba(255, 173, 177, 0.4)"}},{yAxis:range.end}])}},applyStandardFeatures=(option,chartType,config)=&gt;{const{features:features,theme:theme="light",unit:unit,thresholds:thresholds,ranges:ranges,showDataZoomSlider:showDataZoomSlider=!0,dataZoomStart:dataZoomStart=0,dataZoomEnd:dataZoomEnd=100,onEdit:onEdit,onDelete:onDelete,hasHeader:hasHeader=!0}=config||{},toolbox=((chartType,features,theme)=&gt;{const category=chartTypeCategory[chartType]||"timeseries",mergedFeatures={...categoryFeatures[category],...features},toolboxConfig={show:!1!==mergedFeatures.toolbox,orient:"horizontal",itemSize:16,itemGap:12,right:"20px",top:"60px",feature:{},iconStyle:{borderColor:"dark"===theme?"#666":"#999",borderWidth:1},emphasis:{iconStyle:{borderColor:"dark"===theme?"#fff":"#333",shadowColor:"dark"===theme?"rgba(255,255,255,0.3)":"rgba(0,0,0,0.3)",shadowBlur:4,shadowOffsetY:2}},tooltip:{show:!0,position:"bottom",backgroundColor:"dark"===theme?"rgba(30,30,30,0.9)":"rgba(255,255,255,0.9)",borderColor:"dark"===theme?"#555":"#ccc",textStyle:{color:"dark"===theme?"#fff":"#333",fontSize:12}}};return mergedFeatures.saveAsImage&amp;&amp;(toolboxConfig.feature.saveAsImage={type:"png",name:"chart",backgroundColor:"auto",title:"Save as Image",pixelRatio:2}),mergedFeatures.dataView&amp;&amp;(toolboxConfig.feature.dataView={title:"Data View",readOnly:!1,lang:["Data View","Close","Refresh"],backgroundColor:"dark"===theme?"#1a1a1a":"#fff",textareaColor:"dark"===theme?"#1a1a1a":"#fff",textareaBorderColor:"dark"===theme?"#333":"#ddd",textColor:"dark"===theme?"#fff":"#000",buttonColor:"dark"===theme?"#3a84ff":"#1976d2",buttonTextColor:"#fff"}),mergedFeatures.restore&amp;&amp;(toolboxConfig.feature.restore={title:"Reset"}),mergedFeatures.dataZoom&amp;&amp;"timeseries"===category&amp;&amp;(toolboxConfig.feature.dataZoom={title:{zoom:"Area Zoom",back:"Zoom Reset"},yAxisIndex:!1}),!mergedFeatures.magicType||"TimeSeries"!==chartType&amp;&amp;"BarChart"!==chartType||(toolboxConfig.feature.magicType={type:["line","bar","stack"],title:{line:"Line Chart",bar:"Bar Chart",stack:"Stack"}}),mergedFeatures.brush&amp;&amp;(toolboxConfig.feature.brush={type:["rect","polygon","lineX","lineY","keep","clear"],title:{rect:"Rectangle Selection",polygon:"Polygon Selection",lineX:"Horizontal Selection",lineY:"Vertical Selection",keep:"Keep Selection",clear:"Clear Selection"}}),mergedFeatures.onEdit&amp;&amp;(toolboxConfig.feature.myEdit={show:!0,title:"Edit Chart Settings",icon:"path://M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z",onclick:mergedFeatures.onEdit,emphasis:{iconStyle:{borderColor:"#4CAF50",shadowColor:"rgba(76, 175, 80, 0.3)"}}}),mergedFeatures.onDelete&amp;&amp;(toolboxConfig.feature.myDelete={show:!0,title:"Delete Chart",icon:"path://M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z",onclick:mergedFeatures.onDelete,emphasis:{iconStyle:{borderColor:"#F44336",shadowColor:"rgba(244, 67, 54, 0.3)"}}}),toolboxConfig})(chartType,{...features,onEdit:onEdit,onDelete:onDelete},theme);toolbox.show&amp;&amp;(option.toolbox={...option.toolbox,...toolbox});const dataZoom=((chartType,showSlider=!0,startPercent=0,endPercent=100)=&gt;{const category=chartTypeCategory[chartType];if("timeseries"!==category&amp;&amp;"statistical"!==category)return[];const config=[{type:"inside",start:startPercent,end:endPercent,minValueSpan:10,maxValueSpan:100,zoomOnMouseWheel:!0,moveOnMouseMove:!0,moveOnMouseWheel:!1,preventDefaultMouseMove:!0}];return showSlider&amp;&amp;config.push({type:"slider",show:!0,start:startPercent,end:endPercent,height:20,bottom:10,borderColor:"#ccc",fillerColor:"rgba(135, 175, 255, 0.2)",handleIcon:"path://M10.7,11.9v-1.3H9.3v1.3c-4.9,0.3-8.8,4.4-8.8,9.4c0,5,3.9,9.1,8.8,9.4v1.3h1.3v-1.3c4.9-0.3,8.8-4.4,8.8-9.4C19.5,16.3,15.6,12.2,10.7,11.9z",handleSize:"100%",handleStyle:{color:"#a7b7cc"},textStyle:{color:"#666"},filterMode:"filter"}),config})(chartType,showDataZoomSlider,dataZoomStart,dataZoomEnd);dataZoom.length&gt;0&amp;&amp;(option.dataZoom=dataZoom);const enhancedTooltip=((chartType,unit,theme)=&gt;{const category=chartTypeCategory[chartType];return{trigger:"gauge"===category?"item":"axis",axisPointer:{type:"correlation"===category?"cross":"line",label:{backgroundColor:"dark"===theme?"#6a7985":"#333"},crossStyle:{color:"#999"}},backgroundColor:"dark"===theme?"rgba(30, 30, 30, 0.95)":"rgba(255, 255, 255, 0.95)",borderColor:"dark"===theme?"#333":"#ddd",borderWidth:1,padding:[10,15],textStyle:{color:"dark"===theme?"#fff":"#333",fontSize:12},extraCssText:"box-shadow: 0 2px 12px rgba(0,0,0,0.1); border-radius: 4px;",confine:!0,formatter:params=&gt;{if(Array.isArray(params)&amp;&amp;params.length&gt;0){let time="Data Point";if(params[0].axisValueLabel)time=params[0].axisValueLabel;else if(params[0].name)time=params[0].name;else if(params[0].value&amp;&amp;Array.isArray(params[0].value)&amp;&amp;params[0].value[0]){const timestamp=params[0].value[0];time="number"==typeof timestamp&amp;&amp;timestamp&gt;1e12?new Date(timestamp).toLocaleString():String(timestamp)}let content=`&lt;div style="margin-bottom: 8px; font-weight: 600;"&gt;${time}&lt;/div&gt;`;return params.forEach(item=&gt;{if(null!==item.value&amp;&amp;void 0!==item.value){const value=Array.isArray(item.value)?item.value[1]:item.value,formattedValue="number"==typeof value?value.toFixed(2):value;content+=`\n              &lt;div style="display: flex; align-items: center; margin: 4px 0;"&gt;\n                &lt;span style="display: inline-block; width: 10px; height: 10px; \n                  background-color: ${item.color}; border-radius: 50%; margin-right: 8px;"&gt;&lt;/span&gt;\n                &lt;span style="flex: 1;"&gt;${item.seriesName}:&lt;/span&gt;\n                &lt;span style="font-weight: 600; margin-left: 8px;"&gt;\n                  ${formattedValue}${unit?` ${unit}`:""}\n                &lt;/span&gt;\n              &lt;/div&gt;\n            `}}),content}return""}}})(chartType,unit,theme);return enhancedTooltip&amp;&amp;(option.tooltip={...enhancedTooltip,...option.tooltip||{}}),option.grid&amp;&amp;"object"==typeof option.grid&amp;&amp;!Array.isArray(option.grid)?option.grid={top:hasHeader?80:50,right:60,bottom:showDataZoomSlider?60:40,left:60,containLabel:!0,...option.grid}:option.grid||(option.grid={top:hasHeader?80:50,right:60,bottom:showDataZoomSlider?60:40,left:60,containLabel:!0}),option.series&amp;&amp;Array.isArray(option.series)&amp;&amp;(option.series=option.series.map(series=&gt;"line"===series.type||"bar"===series.type?{...series,markLine:thresholds?getMarkLineConfig(thresholds,unit):series.markLine,markArea:ranges?getMarkAreaConfig(ranges):series.markArea}:series)),option},defaultTooltipConfig={trigger:"axis",backgroundColor:"rgba(0, 0, 0, 0.9)",borderColor:"rgba(255, 255, 255, 0.1)",borderWidth:1,padding:[10,15],textStyle:{fontSize:13,color:"rgba(255, 255, 255, 0.87)"},axisPointer:{type:"cross",animation:!1,snap:!0,lineStyle:{color:"rgba(255, 255, 255, 0.3)",width:1,type:"dashed"},crossStyle:{color:"rgba(255, 255, 255, 0.3)",width:1,type:"dashed"},label:{backgroundColor:"rgba(0, 0, 0, 0.8)",color:"rgba(255, 255, 255, 0.87)",borderColor:"rgba(255, 255, 255, 0.2)",borderWidth:1,padding:[5,10]}}},createTooltipConfig=aggregationInfo=&gt;{const baseConfig={...defaultTooltipConfig};return aggregationInfo&amp;&amp;"none"!==aggregationInfo.type?{...baseConfig,formatter:params=&gt;{if(!Array.isArray(params)||0===params.length)return"";let tooltip=`&lt;strong&gt;${new Date(params[0].value[0]).toLocaleString()}&lt;/strong&gt;&lt;br/&gt;`;const aggLabel={avg:"Average",sum:"Total",min:"Minimum",max:"Maximum"}[aggregationInfo.type]||aggregationInfo.type.toUpperCase(),intervalLabel={minute:"per minute",hour:"hourly",day:"daily",week:"weekly",month:"monthly"}[aggregationInfo.interval]||aggregationInfo.interval;return tooltip+=`&lt;em&gt;${aggLabel} ${intervalLabel}&lt;/em&gt;&lt;br/&gt;&lt;br/&gt;`,params.forEach(param=&gt;{var _a;const value=param.value[1],unit=(null==(_a=param.data)?void 0:_a.unit)||"";tooltip+=`${param.marker} ${param.seriesName}: &lt;strong&gt;${formatValue(value,unit)}&lt;/strong&gt;&lt;br/&gt;`}),tooltip}}:baseConfig},defaultGridConfig={left:"3%",right:"2%",bottom:"10%",top:"8%",containLabel:!0},borderlessGridConfig={left:50,right:10,bottom:80,top:30,containLabel:!0},formatValue=(value,unit,precision=2)=&gt;{const formatted=value.toFixed(precision);return unit?`${formatted} ${unit}`:formatted},getDataZoomConfig=(showDataZoom=!0)=&gt;{if(showDataZoom)return[{type:"inside",start:0,end:100,zoomOnMouseWheel:!0,moveOnMouseMove:!0,moveOnMouseWheel:!1},{type:"slider",start:0,end:100,height:20,bottom:5,borderColor:"rgba(255, 255, 255, 0.1)",fillerColor:"rgba(0, 229, 255, 0.2)",handleIcon:"path://M512,512m-208,0a208,208,0,1,0,416,0a208,208,0,1,0,-416,0",handleSize:"100%",handleStyle:{color:"#00E5FF",borderColor:"#00E5FF",borderWidth:1,shadowBlur:4,shadowColor:"rgba(0, 229, 255, 0.5)"},backgroundColor:"rgba(255, 255, 255, 0.05)",dataBackground:{lineStyle:{color:"rgba(255, 255, 255, 0.3)"},areaStyle:{color:"rgba(255, 255, 255, 0.1)"}},textStyle:{color:"rgba(255, 255, 255, 0.6)"},labelFormatter:value=&gt;{const date=new Date(value),hours=date.getHours(),period=hours&gt;=12?"PM":"AM";return`${0===hours?12:hours&gt;12?hours-12:hours}:${date.getMinutes().toString().padStart(2,"0")} ${period}`}}]};function buildTimeSeriesOptions(options){const{deviationConfig:deviationConfig,showSetpointLines:showSetpointLines=!0,showSetpointAreas:showSetpointAreas=!0,userThresholds:userThresholds=[],dataBounds:dataBounds={},aggregationInfo:aggregationInfo,...baseOptions}=options;let setpointMarkLines=[],setpointMarkAreas=[];deviationConfig&amp;&amp;showSetpointLines&amp;&amp;(setpointMarkLines=createSetpointMarkLines(deviationConfig)),deviationConfig&amp;&amp;showSetpointAreas&amp;&amp;(setpointMarkAreas=createSetpointMarkAreas(deviationConfig));const allThresholds=[...baseOptions.thresholds||[],...setpointMarkLines.map(line=&gt;({value:line.yAxis,name:line.label.formatter,color:line.lineStyle.color}))],allRanges=[...baseOptions.ranges||[],...setpointMarkAreas.map(area2=&gt;({start:area2[0].yAxis,end:area2[1].yAxis,name:area2[0].name||"Setpoint Range",color:area2[0].itemStyle.color}))],baseOption=(config=&gt;{const{title:title,showLegend:showLegend=!0,showDataZoom:showDataZoom=!0,colors:colors,chartType:chartType="TimeSeries",theme:theme="light",unit:unit,features:features,thresholds:thresholds,ranges:ranges,optimizeGrid:optimizeGrid=!0,gradient:gradient,visualMapping:visualMapping,enableVisualEnhancements:enableVisualEnhancements=!0}=config||{},baseOption={animation:!0,animationDuration:1e3,animationEasing:"cubicInOut",animationDurationUpdate:750,animationEasingUpdate:"cubicInOut",title:title?{text:title,left:"center",textStyle:{fontSize:16,fontWeight:"normal"}}:void 0,tooltip:defaultTooltipConfig,legend:showLegend?{bottom:0,animation:!0,animationDuration:300}:void 0,grid:optimizeGrid?borderlessGridConfig:defaultGridConfig,dataZoom:getDataZoomConfig(showDataZoom),color:colors||["#5470c6","#91cc75","#fac858","#ee6666","#73c0de","#3ba272","#fc8452","#9a60b4","#ea7ccc"]};let enhancedOption=baseOption;if(chartType&amp;&amp;(enhancedOption=applyStandardFeatures(baseOption,chartType,{features:features,theme:theme,unit:unit,thresholds:thresholds,ranges:ranges,showDataZoomSlider:showDataZoom})),enableVisualEnhancements&amp;&amp;(gradient||visualMapping||thresholds)){const gradientConfig="string"==typeof gradient?GRADIENT_PRESETS[gradient]:gradient,thresholdConfigs=null==thresholds?void 0:thresholds.map(t=&gt;({value:t.value,name:t.name,color:t.color||"#FF5252",type:"warning",showLabel:!0}));enhancedOption=applyVisualEnhancements(enhancedOption,{thresholds:thresholdConfigs,gradient:gradientConfig,visualMapping:visualMapping,unit:unit,theme:theme})}return enhancedOption})({...baseOptions,chartType:"TimeSeries",thresholds:allThresholds.length&gt;0?allThresholds:void 0,ranges:allRanges.length&gt;0?allRanges:void 0,optimizeGrid:!0,gradient:baseOptions.gradient,visualMapping:baseOptions.visualMapping,enableVisualEnhancements:baseOptions.enableVisualEnhancements}),{xMin:xMin,xMax:xMax,yMin:yMin,yMax:yMax}=dataBounds,toolboxConfig=baseOptions.enableToolbox?{show:!0,orient:"horizontal",itemSize:15,itemGap:10,right:"20px",top:"10px",feature:{dataZoom:{show:!0,title:{zoom:"Area Zoom",back:"Zoom Reset"}},restore:{show:!0,title:"Reset"},saveAsImage:{show:!0,title:"Save as Image",type:"png",backgroundColor:"auto",pixelRatio:2},dataView:baseOptions.enableDataView?{show:!0,title:"Data View",readOnly:!1,lang:["Data View","Close","Refresh"]}:void 0,magicType:baseOptions.enableMagicType?{show:!0,type:["line","bar","stack"],title:{line:"Line",bar:"Bar",stack:"Stack"}}:void 0,...options.onEdit&amp;&amp;{myEdit:{show:!0,title:"Edit",icon:"path://M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z",onclick:function(){options.onEdit&amp;&amp;options.onEdit()}}},...options.onDelete&amp;&amp;{myDelete:{show:!0,title:"Delete",icon:"path://M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z",onclick:function(){options.onDelete&amp;&amp;options.onDelete()}}}},iconStyle:{color:"dark"===baseOptions.theme?"#ffffff":"#333333",borderColor:"dark"===baseOptions.theme?"#ffffff":"#999999",borderWidth:1},emphasis:{iconStyle:{color:"dark"===baseOptions.theme?"#3a84ff":"#1976d2",borderColor:"dark"===baseOptions.theme?"#3a84ff":"#1976d2",borderWidth:2}}}:void 0;return{...baseOption,toolbox:toolboxConfig,xAxis:{type:"time",boundaryGap:!1,...void 0!==xMin&amp;&amp;void 0!==xMax&amp;&amp;xMin&lt;xMax?{min:xMin,max:xMax}:{},axisLabel:{formatter:value=&gt;{const date=new Date(value),hours=date.getHours(),period=hours&gt;=12?"PM":"AM";return`${0===hours?12:hours&gt;12?hours-12:hours}:${date.getMinutes().toString().padStart(2,"0")} ${period}`},rotate:45,align:"right",fontSize:12,fontWeight:"bold",color:"dark"===baseOptions.theme?"#fff":"#333"},axisLine:{show:!0,lineStyle:{color:"dark"===baseOptions.theme?"#666":"#ccc",width:2}},splitLine:{show:!0,lineStyle:{color:"dark"===baseOptions.theme?"#444":"#e5e5e5",type:"dashed",width:1}},axisTick:{show:!0,lineStyle:{color:"dark"===baseOptions.theme?"#666":"#ccc"}}},yAxis:{type:"value",scale:!0,min:void 0!==yMin?yMin:"dataMin",max:void 0!==yMax?yMax:"dataMax",axisLabel:{formatter:value=&gt;function formatDisplayValue(value,precision=2,unit){return formatNumberForDisplay(value,precision,unit)}(value,1),fontSize:12,fontWeight:"bold",color:"dark"===baseOptions.theme?"#fff":"#333"},axisLine:{show:!0,lineStyle:{color:"dark"===baseOptions.theme?"#666":"#ccc",width:2}},splitLine:{show:!0,lineStyle:{color:"dark"===baseOptions.theme?"#444":"#e5e5e5",type:"solid",width:1}},axisTick:{show:!0,lineStyle:{color:"dark"===baseOptions.theme?"#666":"#ccc"}}},tooltip:aggregationInfo?createTooltipConfig(aggregationInfo):baseOption.tooltip}}const CHART_DEFAULTS={showLegend:!0,showTooltip:!0,showDataZoom:!1,showGrid:!0,showMarkerTags:!0,showValues:!1,showExportToolbar:!0,enableToolbox:!0,enableBrush:!1,enableDataView:!1,enableMagicType:!1,enableClickModal:!0,height:400,width:"100%",exportPosition:"top-right",toolbarHeight:48,theme:"light",useDarkThemeColors:!1,useHighContrastColors:!1,animation:!0,animationDuration:300,progressive:1e3,progressiveThreshold:3e3,enableDownsampling:!1,downsamplingThreshold:5e3,samplingMethod:"lttb",exportFormats:["png","csv","json"],exportable:!0,exportPixelRatio:2,ariaLabel:"Chart visualization",enableKeyboardNav:!0,announceDataUpdates:!1,enableThresholdConfig:!1,enableDeviationAnalysis:!1,enableRangeCompliance:!1,enableFaultDetection:!1,enableVisualEnhancements:!0,enableCorrelationAnalysis:!1,enableWebGL:!1,enableColorScaleConfig:!1},CHART_TYPE_DEFAULTS={timeSeries:{showDataZoom:!0,showLegend:!0,enableDownsampling:!0,downsamplingThreshold:5e3,animation:!0},heatmap:{showDataZoom:!1,showLegend:!1,showValues:!1,animation:!1,progressive:500,progressiveThreshold:1e3},bar:{showDataZoom:!1,showLegend:!1,showValues:!0,animation:!0,animationDuration:500},area:{showDataZoom:!0,showLegend:!0,enableVisualEnhancements:!0,animation:!0,stacked:!1},scatter:{showDataZoom:!1,showLegend:!0,showRegression:!0,enableCorrelationAnalysis:!1,animation:!1},gauge:{showDataZoom:!1,showLegend:!1,showExportToolbar:!1,animation:!0,animationDuration:800,refreshInterval:3e4},calendar:{showDataZoom:!1,showLegend:!1,animation:!1,progressive:365},boxPlot:{showDataZoom:!1,showLegend:!0,showValues:!0,animation:!0},candlestick:{showDataZoom:!0,showLegend:!1,animation:!0,enableDownsampling:!0},radar:{showDataZoom:!1,showLegend:!0,animation:!0,showValues:!1},sankey:{showDataZoom:!1,showLegend:!1,animation:!0,animationDuration:1e3},treemap:{showDataZoom:!1,showLegend:!1,animation:!0,showValues:!0},parallel:{showDataZoom:!1,showLegend:!0,animation:!1,enableBrush:!0},psychrometric:{showDataZoom:!1,showLegend:!0,animation:!1,showGrid:!0},spc:{showDataZoom:!0,showLegend:!0,enableThresholdConfig:!0,showValues:!1},deviceDeviation:{showDataZoom:!1,showLegend:!1,enableDeviationAnalysis:!0,animation:!1},perfectEconomizer:{showDataZoom:!0,showLegend:!0,enableCorrelationAnalysis:!0,animation:!1},controlBand:{showDataZoom:!0,showLegend:!0,enableDeviationAnalysis:!0,showSetpointLines:!0,showSetpointAreas:!0},vavEnhanced:{showDataZoom:!0,showLegend:!0,enableFaultDetection:!0,animation:!1},timeline:{showDataZoom:!0,showLegend:!0,animation:!0},sparkline:{showDataZoom:!1,showLegend:!1,showExportToolbar:!1,enableToolbox:!1,animation:!1,height:60}};function mergeWithDefaults(userProps,chartType){const defaults2=function getChartDefaults(chartType){if(!chartType||!(chartType in CHART_TYPE_DEFAULTS))return{...CHART_DEFAULTS};const typeSpecificDefaults=CHART_TYPE_DEFAULTS[chartType];return{...CHART_DEFAULTS,...typeSpecificDefaults}}(chartType);return{...defaults2,...userProps}}const EChartsTimeSeriesChart$1=React.memo(userProps=&gt;{const{data:data,loading:loading,error:error,height:height,width:width,title:title,showDataZoom:showDataZoom,showLegend:showLegend,enableToolbox:enableToolbox,enableDataView:enableDataView,enableMagicType:enableMagicType,showMarkerTags:showMarkerTags,thresholds:thresholds=[],ranges:ranges=[],initialThresholds:initialThresholds=[],initialZones:initialZones=[],onThresholdsChange:onThresholdsChange,constantValue:constantValue,deviationConfig:deviationConfig,showSetpointLines:showSetpointLines,showSetpointAreas:showSetpointAreas,customColors:customColors,aggregationInfo:aggregationInfo,onChartReady:onChartReady,showExportToolbar:showExportToolbar,exportPosition:exportPosition,enableDownsampling:enableDownsampling,downsamplingThreshold:downsamplingThreshold,enableDeviationAnalysis:enableDeviationAnalysis,deviationAnalysisConfig:deviationAnalysisConfig,enableRangeCompliance:enableRangeCompliance,rangeComplianceConfig:rangeComplianceConfig,gradient:gradient,visualMapping:visualMapping,enableVisualEnhancements:enableVisualEnhancements,largeDataConfig:largeDataConfig,onEdit:onEdit,onDelete:onDelete,enableFaultDetection:enableFaultDetection,faultDetectionConfig:faultDetectionConfig,onFaultClick:onFaultClick,onFaultAcknowledge:onFaultAcknowledge,onFaultResolve:onFaultResolve}=mergeWithDefaults(userProps,"timeSeries"),theme=useTheme(),isDarkTheme="dark"===theme.palette.mode,chartInstanceRef=reactExports.useRef(null),chartContainerRef=reactExports.useRef(null),[chartBounds,setChartBounds]=reactExports.useState(null),[announcement,setAnnouncement]=reactExports.useState(""),[keyboardNavState,setKeyboardNavState]=reactExports.useState(null);useChartKeyboardShortcuts(chartInstanceRef,{enableZoom:showDataZoom,enablePan:showDataZoom,enableReset:!0,zoomSpeed:.1,panSpeed:5}),reactExports.useEffect(()=&gt;{if(processedData&amp;&amp;processedData.length&gt;0){const pointCounts=processedData.map(series=&gt;{var _a;return(null==(_a=series.data)?void 0:_a.length)||0});setKeyboardNavState(createKeyboardNavState(processedData.length,pointCounts))}},[processedData]);const handleKeyDown=reactExports.useCallback(e2=&gt;{if(!keyboardNavState||!processedData||!chartInstanceRef.current)return;const{key:key}=e2;if("Enter"===key){e2.preventDefault();const currentSeries=processedData[keyboardNavState.currentSeriesIndex],currentPoint=null==currentSeries?void 0:currentSeries.data[keyboardNavState.currentPointIndex];if(currentPoint&amp;&amp;Array.isArray(currentPoint)){const[timestamp,value]=currentPoint,announcement2=generateDataPointAnnouncement(currentSeries.name,timestamp,value,currentSeries.unit);setAnnouncement(announcement2);chartInstanceRef.current.dispatchAction({type:"showTip",seriesIndex:keyboardNavState.currentSeriesIndex,dataIndex:keyboardNavState.currentPointIndex})}return}if("Escape"===key)return e2.preventDefault(),chartInstanceRef.current&amp;&amp;chartInstanceRef.current.dispatchAction({type:"hideTip"}),void setAnnouncement("Returned to chart overview");if(["ArrowLeft","ArrowRight","ArrowUp","ArrowDown","PageUp","PageDown","Home","End"].includes(key)){e2.preventDefault();const newState=handleKeyboardNav(key,keyboardNavState,(seriesIndex,pointIndex)=&gt;{const currentSeries=processedData[seriesIndex],currentPoint=null==currentSeries?void 0:currentSeries.data[pointIndex];if(currentPoint&amp;&amp;Array.isArray(currentPoint)){const[timestamp,value]=currentPoint,announcement2=generateDataPointAnnouncement(currentSeries.name,timestamp,value,currentSeries.unit);setAnnouncement(announcement2);const chart=chartInstanceRef.current;chart&amp;&amp;chart.dispatchAction({type:"showTip",seriesIndex:seriesIndex,dataIndex:pointIndex})}});setKeyboardNavState(newState)}},[keyboardNavState,processedData]),ariaLabelData=reactExports.useMemo(()=&gt;{if(!processedData||0===processedData.length)return{seriesCount:0,dataPointCount:0,startDate:void 0,endDate:void 0};const dataPointCount=processedData.reduce((sum,series)=&gt;{var _a;return sum+((null==(_a=series.data)?void 0:_a.length)||0)},0),allTimestamps=processedData.flatMap(series=&gt;{var _a;return(null==(_a=series.data)?void 0:_a.map(point=&gt;Array.isArray(point)?point[0]:point.timestamp))||[]});return{seriesCount:processedData.length,dataPointCount:dataPointCount,startDate:allTimestamps.length&gt;0?new Date(Math.min(...allTimestamps)):void 0,endDate:allTimestamps.length&gt;0?new Date(Math.max(...allTimestamps)):void 0}},[processedData]);reactExports.useEffect(()=&gt;{const updateBounds=()=&gt;{chartContainerRef.current&amp;&amp;setChartBounds(chartContainerRef.current.getBoundingClientRect())};return updateBounds(),window.addEventListener("resize",updateBounds),()=&gt;{window.removeEventListener("resize",updateBounds)}},[]),reactExports.useEffect(()=&gt;()=&gt;{var _a;(null==(_a=chartInstanceRef.current)?void 0:_a._resizeCleanup)&amp;&amp;chartInstanceRef.current._resizeCleanup()},[]),reactExports.useEffect(()=&gt;{},[data,loading,error]);const processedData=reactExports.useMemo(()=&gt;{performance.now();if(!data||!Array.isArray(data))return[];const filtered=data.filter(series=&gt;series&amp;&amp;series.data&amp;&amp;Array.isArray(series.data)&amp;&amp;series.data.length&gt;0);return performance.now(),filtered},[data]);processedData.length;const faultDetectionData=reactExports.useMemo(()=&gt;enableFaultDetection&amp;&amp;processedData.length?processedData.flatMap(series=&gt;series.data.map(point=&gt;{var _a,_b;return{timestamp:Array.isArray(point)?point[0]:point.timestamp,value:Array.isArray(point)?point[1]:point.value,pointName:series.name,unit:series.unit,zone:null==(_a=series.pointMetadata)?void 0:_a.zone,equipment:null==(_b=series.pointMetadata)?void 0:_b.equipment}})):[],[processedData,enableFaultDetection]),{faults:faults,config:faultConfig,updateConfig:updateFaultConfig,updateSensitivity:updateFaultSensitivity,acknowledgeFault:acknowledgeFault,resolveFault:resolveFault}=useFaultDetection(faultDetectionData,faultDetectionConfig),activeThresholds=reactExports.useMemo(()=&gt;initialThresholds.length&gt;0?initialThresholds:thresholds.map(t=&gt;({id:`threshold-${t.value}`,value:t.value,label:t.name,color:t.color||"#ff6b6b",type:"line"})),[initialThresholds,thresholds]),activeZones=initialZones||[];reactExports.useCallback(newThresholds=&gt;{onThresholdsChange&amp;&amp;onThresholdsChange(newThresholds)},[onThresholdsChange]),reactExports.useCallback(()=&gt;{},[]);const colors=customColors||HIGH_CONTRAST_COLORS.slice(0,processedData.length),exportData=reactExports.useMemo(()=&gt;processedData&amp;&amp;0!==processedData.length?processedData.map((series,index2)=&gt;({name:series.formattedName||series.name||`Series ${index2+1}`,data:series.data||[],unit:series.unit,markerTags:series.markerTags,pointMetadata:series.pointMetadata})):[],[processedData]),baseChartOptions=useBaseChartOptions(),dataBounds=reactExports.useMemo(()=&gt;{if(!processedData||0===processedData.length)return{};const allValues=[],seriesRanges=[];if(processedData.forEach(series=&gt;{if(series.data&amp;&amp;Array.isArray(series.data)){const seriesValues=[];series.data.forEach(point=&gt;{Array.isArray(point)&amp;&amp;point.length&gt;=2&amp;&amp;"number"==typeof point[1]&amp;&amp;(allValues.push(point[1]),seriesValues.push(point[1]))}),seriesValues.length&gt;0&amp;&amp;seriesRanges.push({name:series.name,min:Math.min(...seriesValues),max:Math.max(...seriesValues),unit:series.unit})}}),0===allValues.length)return{};const yMin=Math.min(...allValues),yMax=Math.max(...allValues),padding=.1*(yMax-yMin);return{yMin:yMin-padding,yMax:yMax+padding}},[processedData]),chartOptions=reactExports.useMemo(()=&gt;{var _a,_b,_c,_d,_e,_f,_g,_h,_i,_j,_k,_l,_m,_n;if(!isSeriesArray(processedData)||0===processedData.length){const titleOptions2=buildChartTitle(title,theme),xAxisOptions2=buildXAxis({}),yAxisOptions2=buildYAxis({});return combineOptions(baseChartOptions,{title:titleOptions2,xAxis:xAxisOptions2,yAxis:yAxisOptions2,series:[],graphic:[{type:"text",left:"center",top:"center",style:{text:"No data available",fontSize:16,fill:theme.palette.text.secondary}}]})}let series=transformToTimeSeries(processedData,{type:"line",showMarkerTags:showMarkerTags}).map((seriesData,index2)=&gt;{var _a2;const seriesColor=seriesData.color||colors[index2%colors.length],formattedName=showMarkerTags&amp;&amp;(null==(_a2=processedData[index2])?void 0:_a2.markerTags)?formatPointWithTags({name:seriesData.name,markerTags:processedData[index2].markerTags,unit:seriesData.unit},{maxTags:2,includeUnit:!1}):seriesData.formattedName||seriesData.name,sortedData=seriesData.data?[...seriesData.data].sort((a,b)=&gt;{var _a3,_b2;return(Array.isArray(a)?a[0]:(null==(_a3=null==a?void 0:a.value)?void 0:_a3[0])||(null==a?void 0:a.timestamp)||0)-(Array.isArray(b)?b[0]:(null==(_b2=null==b?void 0:b.value)?void 0:_b2[0])||(null==b?void 0:b.timestamp)||0)}):[];return{name:formattedName,data:sortedData.filter(point=&gt;{if(Array.isArray(point)&amp;&amp;point.length&gt;=2){const[timestamp,value]=point,isValidTimestamp="number"==typeof timestamp&amp;&amp;isFinite(timestamp)||timestamp instanceof Date&amp;&amp;!isNaN(timestamp.getTime()),isValidValue="number"==typeof value&amp;&amp;isFinite(value);return isValidTimestamp&amp;&amp;isValidValue}return!1}).map(point=&gt;{const[timestamp,value]=point;return[timestamp instanceof Date?timestamp.getTime():timestamp,value]}),type:"line",lineStyle:{color:seriesColor,width:getAdaptiveLineWidth(processedData.length),type:"solid",opacity:1,cap:"round",join:"round"},zlevel:0,itemStyle:{color:seriesColor,borderWidth:2,borderColor:isDarkTheme?"#1a1a1a":"#ffffff",opacity:1},showSymbol:!0,symbol:"circle",symbolSize:getAdaptiveSymbolSize(processedData.length,5),smooth:.3,connectNulls:!0,animation:!0,animationDuration:800,animationEasing:"cubicOut",emphasis:{focus:"series",lineStyle:{width:4},itemStyle:{symbolSize:8}},large:!1,largeThreshold:1/0,progressive:0,z:10+index2,coordinateSystem:"cartesian2d",color:seriesColor,xAxisIndex:0,yAxisIndex:0}});if(enableDownsampling&amp;&amp;series.forEach(s=&gt;{s.data&amp;&amp;s.data.length&gt;downsamplingThreshold&amp;&amp;(s.sampling="lttb",s.progressiveThreshold=downsamplingThreshold)}),activeThresholds.length&gt;0&amp;&amp;series.forEach(s=&gt;{s.markLine={silent:!0,data:activeThresholds.map(threshold=&gt;createThresholdLine(threshold))}}),void 0!==constantValue&amp;&amp;series.length&gt;0&amp;&amp;(series[0].markLine={...series[0].markLine,data:[...(null==(_a=series[0].markLine)?void 0:_a.data)||[],{name:"Constant",yAxis:constantValue,lineStyle:{color:"#666",type:"dashed",width:2},label:{position:"end",formatter:`Constant: ${constantValue}`}}]}),ranges.length&gt;0&amp;&amp;series.length&gt;0&amp;&amp;(series[0].markArea={silent:!0,data:ranges.map(range=&gt;[{yAxis:range.start,itemStyle:{color:range.color||"rgba(0, 150, 0, 0.1)"}},{yAxis:range.end,label:{position:"insideTop",formatter:range.name}}])}),deviationConfig&amp;&amp;series.length&gt;0){if(showSetpointLines){const markLines=createSetpointMarkLines(deviationConfig);series[0].markLine={...series[0].markLine,data:[...(null==(_b=series[0].markLine)?void 0:_b.data)||[],...markLines]}}if(showSetpointAreas){const markAreas=createSetpointMarkAreas(deviationConfig);series[0].markArea={...series[0].markArea,data:[...(null==(_c=series[0].markArea)?void 0:_c.data)||[],...markAreas]}}}if(activeZones.length&gt;0){const zoneData=createThresholdZones(activeZones);series.length&gt;0&amp;&amp;(series[0].markArea={...series[0].markArea,data:[...(null==(_d=series[0].markArea)?void 0:_d.data)||[],...zoneData]})}if(enableDeviationAnalysis&amp;&amp;deviationAnalysisConfig&amp;&amp;series.length&gt;0){const timeRange={start:new Date((null==(_f=null==(_e=processedData[0])?void 0:_e.data[0])?void 0:_f[0])||Date.now()-864e5),end:new Date((null==(_i=null==(_h=processedData[0])?void 0:_h.data[(null==(_g=processedData[0])?void 0:_g.data.length)-1])?void 0:_i[0])||Date.now())},deviationBands=generateDeviationBands(deviationAnalysisConfig.setpoint,deviationAnalysisConfig.tolerance,timeRange);series.unshift(...deviationBands),series.forEach(s=&gt;{var _a2;s.data&amp;&amp;Array.isArray(s.data)&amp;&amp;"line"===s.type&amp;&amp;!(null==(_a2=s.name)?void 0:_a2.includes("Tolerance"))&amp;&amp;(s.data=s.data.map(point=&gt;{const value=Array.isArray(point)?point[1]:point.value;return{value:point,itemStyle:{color:calculateDeviation$2(value,deviationAnalysisConfig).color}}}))})}if(enableRangeCompliance&amp;&amp;rangeComplianceConfig&amp;&amp;series.length&gt;0){const rangeZones=createRangeZones(rangeComplianceConfig.min,rangeComplianceConfig.max,Math.min(...processedData.flatMap(d=&gt;d.data.map(p=&gt;p[1]))),Math.max(...processedData.flatMap(d=&gt;d.data.map(p=&gt;p[1]))));series[0].markArea={...series[0].markArea,data:[...(null==(_j=series[0].markArea)?void 0:_j.data)||[],...rangeZones.map(zone=&gt;[{yAxis:zone.yAxis,itemStyle:zone.itemStyle},{yAxis:zone.yAxisEnd,label:{formatter:zone.name}}])]},series[0].markLine={...series[0].markLine,data:[...(null==(_k=series[0].markLine)?void 0:_k.data)||[],{name:"Maximum",yAxis:rangeComplianceConfig.max,lineStyle:{color:"#F44336",type:"dashed",width:2},label:{formatter:`Max: ${rangeComplianceConfig.max}`}},{name:"Minimum",yAxis:rangeComplianceConfig.min,lineStyle:{color:"#2196F3",type:"dashed",width:2},label:{formatter:`Min: ${rangeComplianceConfig.min}`}}]},series.forEach(s=&gt;{var _a2;s.data&amp;&amp;Array.isArray(s.data)&amp;&amp;"line"===s.type&amp;&amp;!(null==(_a2=s.name)?void 0:_a2.includes("Tolerance"))&amp;&amp;(s.data=s.data.map(point=&gt;{const value=Array.isArray(point)?point[1]:point.value;return{value:point,itemStyle:{color:getRangeComplianceColor(value,rangeComplianceConfig.min,rangeComplianceConfig.max)}}}))})}const totalPoints=processedData.reduce((sum,series2)=&gt;sum+series2.data.length,0),animationMode=CHART_DESIGN_TOKENS.adaptive.animationMode(totalPoints),titleOptions=title?{...CHART_DESIGN_TOKENS.title.base,text:title,textStyle:{...CHART_DESIGN_TOKENS.title.base.textStyle,color:theme.palette.text.primary}}:void 0;theme.palette.mode;const tooltipOptions=buildTooltip({...CHART_DESIGN_TOKENS.tooltip.base,textStyle:{...CHART_DESIGN_TOKENS.tooltip.base.textStyle,color:theme.palette.text.primary}}),gridOptions={...CHART_DESIGN_TOKENS.grid.base,top:calculateGridTop({hasTitle:!!title,hasToolbox:!0})},xAxisOptions=buildXAxis({axisLabel:{color:theme.palette.text.secondary}}),uniqueUnits=[...new Set(processedData.map(s=&gt;s.unit).filter(Boolean))];let needsDualAxis=!1,yAxisConfig={},seriesRanges=[],avgMagnitude=0;if(processedData.length&gt;1&amp;&amp;(seriesRanges=processedData.map(seriesItem=&gt;{if(!seriesItem.data||0===seriesItem.data.length)return null;const values=seriesItem.data.map(p=&gt;Array.isArray(p)?p[1]:p).filter(v=&gt;"number"==typeof v);if(0===values.length)return null;const min=Math.min(...values),max=Math.max(...values),avg=values.reduce((a,b)=&gt;a+b,0)/values.length;return{name:seriesItem.name,unit:seriesItem.unit,min:min,max:max,avg:avg,magnitude:Math.floor(Math.log10(Math.abs(avg)||1))}}).filter(Boolean),seriesRanges.length&gt;1)){const magnitudes=seriesRanges.map(r=&gt;r.magnitude),magDiff=Math.max(...magnitudes)-Math.min(...magnitudes);if(magDiff&gt;2||uniqueUnits.length&gt;1&amp;&amp;magDiff&gt;1){needsDualAxis=!0,avgMagnitude=magnitudes.reduce((a,b)=&gt;a+b,0)/magnitudes.length;const leftAxisSeries=seriesRanges.filter(r=&gt;r.magnitude&lt;=avgMagnitude),rightAxisSeries=seriesRanges.filter(r=&gt;r.magnitude&gt;avgMagnitude),leftValues=leftAxisSeries.flatMap(r=&gt;{var _a2,_b2;return(null==(_b2=null==(_a2=processedData.find(s=&gt;s.name===r.name))?void 0:_a2.data)?void 0:_b2.map(p=&gt;Array.isArray(p)?p[1]:p))||[]}).filter(v=&gt;"number"==typeof v),rightValues=rightAxisSeries.flatMap(r=&gt;{var _a2,_b2;return(null==(_b2=null==(_a2=processedData.find(s=&gt;s.name===r.name))?void 0:_a2.data)?void 0:_b2.map(p=&gt;Array.isArray(p)?p[1]:p))||[]}).filter(v=&gt;"number"==typeof v);if(leftValues.length&gt;0&amp;&amp;rightValues.length&gt;0){const leftMin=Math.min(...leftValues),leftMax=Math.max(...leftValues),leftPadding=.1*(leftMax-leftMin),rightMin=Math.min(...rightValues),rightMax=Math.max(...rightValues),rightPadding=.1*(rightMax-rightMin);yAxisConfig=[{type:"value",name:(null==(_l=leftAxisSeries[0])?void 0:_l.unit)||"Value",position:"left",min:leftMin-leftPadding,max:leftMax+leftPadding,axisLabel:{formatter:value=&gt;formatNumberForDisplay(value,2),color:theme.palette.text.secondary}},{type:"value",name:(null==(_m=rightAxisSeries[0])?void 0:_m.unit)||"Value 2",position:"right",min:rightMin-rightPadding,max:rightMax+rightPadding,axisLabel:{formatter:value=&gt;formatNumberForDisplay(value,2),color:theme.palette.text.secondary}}]}else needsDualAxis=!1}}if(!needsDualAxis){yAxisConfig={type:"value",name:1===uniqueUnits.length?uniqueUnits[0]:uniqueUnits.length&gt;1?"Multiple Units":"Value",min:void 0!==dataBounds.yMin?dataBounds.yMin:"dataMin",max:void 0!==dataBounds.yMax?dataBounds.yMax:"dataMax",axisLabel:{formatter:value=&gt;formatNumberForDisplay(value,2),color:theme.palette.text.secondary}}}const yAxisOptions=yAxisConfig;needsDualAxis&amp;&amp;seriesRanges.length&gt;0&amp;&amp;series.forEach(s=&gt;{const seriesRange=seriesRanges.find(r=&gt;r.name===s.name);seriesRange&amp;&amp;(s.yAxisIndex=seriesRange.magnitude&gt;avgMagnitude?1:0)});const legendOptions=buildLegend({data:series.map(s=&gt;s.name),textStyle:{color:theme.palette.text.secondary}}),timeSeriesOptions=buildTimeSeriesOptions({title:title,showLegend:showLegend,showDataZoom:showDataZoom,colors:colors,theme:theme.palette.mode,unit:null==(_n=processedData[0])?void 0:_n.unit,enableToolbox:enableToolbox,enableDataView:enableDataView,enableMagicType:enableMagicType,thresholds:thresholds.map(t=&gt;({value:t.value,name:t.name,color:t.color})),ranges:ranges,aggregationInfo:aggregationInfo,deviationConfig:deviationConfig,showSetpointLines:showSetpointLines,showSetpointAreas:showSetpointAreas,userThresholds:activeThresholds,gradient:gradient,visualMapping:visualMapping,enableVisualEnhancements:enableVisualEnhancements,largeDataMode:!1,dataBounds:dataBounds}),ariaConfig=createEChartsAriaConfig(title||"Time Series Chart",series.map(s=&gt;s.name),!0),options=combineOptions(baseChartOptions,timeSeriesOptions,{title:titleOptions,tooltip:tooltipOptions,grid:gridOptions,xAxis:xAxisOptions,yAxis:yAxisOptions,legend:legendOptions,series:series,aria:ariaConfig,dataZoom:showDataZoom?baseChartOptions.dataZoom:[],...CHART_DESIGN_TOKENS.animation[animationMode]},{showToolbox:enableToolbox,showDataZoom:showDataZoom,onEdit:onEdit,onDelete:onDelete,enableDataView:enableDataView,enableMagicType:enableMagicType});return width&amp;&amp;Object.assign(options,function optimizeChartOptions(option,dataStats){const{totalPoints:totalPoints,seriesCount:seriesCount,timeRange:timeRange=0}=dataStats,recommendations=getRecommendedSettings(totalPoints,seriesCount,timeRange);return totalPoints&gt;5e4||seriesCount&gt;50?getOptimizedChartOptions(option,{dataSize:totalPoints,seriesCount:seriesCount,enableProgressive:recommendations.enableProgressive,enableLargeMode:recommendations.enableLargeMode,enableDataSampling:recommendations.enableDataSampling}):option}(options,{})),enhanceChart(options)},[baseChartOptions,processedData,title,theme.palette.text.primary,theme.palette.text.secondary,colors,showLegend,showDataZoom,showMarkerTags,activeThresholds,activeZones,constantValue,ranges,deviationConfig,showSetpointLines,showSetpointAreas,enableToolbox,enableDataView,enableMagicType,aggregationInfo,width,height,enableDownsampling,downsamplingThreshold,enableDeviationAnalysis,deviationAnalysisConfig,enableRangeCompliance,rangeComplianceConfig,data,gradient,visualMapping,enableVisualEnhancements]),getChartPosition=reactExports.useCallback((timestamp,value)=&gt;{if(!chartInstanceRef.current||!chartBounds)return{x:0,y:0};try{const pixelPoint=chartInstanceRef.current.convertToPixel({seriesIndex:0},[timestamp,value]);return{x:pixelPoint[0],y:pixelPoint[1]}}catch(error2){return{x:0,y:0}}},[chartBounds]),handleFaultClick=reactExports.useCallback(fault=&gt;{onFaultClick&amp;&amp;onFaultClick(fault)},[onFaultClick]),handleFaultAcknowledge=reactExports.useCallback(faultId=&gt;{acknowledgeFault(faultId),null==onFaultAcknowledge||onFaultAcknowledge(faultId)},[acknowledgeFault,onFaultAcknowledge]),handleFaultResolve=reactExports.useCallback(faultId=&gt;{resolveFault(faultId),null==onFaultResolve||onFaultResolve(faultId)},[resolveFault,onFaultResolve]),chartTimeRange=reactExports.useMemo(()=&gt;{if(!processedData.length){const now=Date.now();return{start:now-864e5,end:now}}let minTime=1/0,maxTime=-1/0;return processedData.forEach(series=&gt;{series.data.forEach(point=&gt;{const timestamp=Array.isArray(point)?point[0]:point.timestamp;minTime=Math.min(minTime,timestamp),maxTime=Math.max(maxTime,timestamp)})}),{start:minTime,end:maxTime}},[processedData]),visibleFaults=reactExports.useMemo(()=&gt;faults.filter(fault=&gt;fault.timestamp&gt;=chartTimeRange.start&amp;&amp;fault.timestamp&lt;=chartTimeRange.end),[faults,chartTimeRange]);return error?jsxRuntimeExports.jsxs(Box,{sx:{height:height,display:"flex",alignItems:"center",justifyContent:"center",color:"error.main"},children:["Error loading chart: ",error.message]}):jsxRuntimeExports.jsxs(Box,{sx:{position:"relative",height:"string"==typeof height?height:`${height}px`,width:"100%",display:"flex",flexDirection:"column",minHeight:"number"==typeof height?height:300,paddingTop:showExportToolbar?"60px":0,paddingBottom:showExportToolbar&amp;&amp;(null==exportPosition?void 0:exportPosition.includes("bottom"))?"60px":0,"&amp; .echarts-wrapper":{height:"100% !important",width:"100% !important"}},children:[showExportToolbar&amp;&amp;!loading&amp;&amp;!error&amp;&amp;exportData.length&gt;0&amp;&amp;jsxRuntimeExports.jsx(ChartExportToolbar,{chartInstance:chartInstanceRef.current,chartData:exportData,chartTitle:title||"Time Series Chart",position:exportPosition,size:"small",onExportStart:()=&gt;{},onExportComplete:format2=&gt;{},onExportError:error2=&gt;{}}),jsxRuntimeExports.jsx(Box,{role:"status","aria-live":"polite","aria-atomic":"true",sx:srOnlyStyles,children:announcement}),jsxRuntimeExports.jsxs(Box,{ref:chartContainerRef,role:"img","aria-label":generateChartAriaLabel(title||"Time Series Chart",ariaLabelData.seriesCount,ariaLabelData.dataPointCount,ariaLabelData.startDate,ariaLabelData.endDate,"time series chart"),tabIndex:0,onKeyDown:handleKeyDown,sx:{flex:"1 1 auto",position:"relative",minHeight:0,minWidth:0,width:"100%",height:"100%",...chartFocusStyles},children:[jsxRuntimeExports.jsx(EChartsWrapper,{option:chartOptions,loading:loading,height:"100%",width:"100%",theme:isDarkTheme?"dark":"light",style:{position:"absolute",top:0,left:0,right:0,bottom:0,width:"100%",height:"100%"},onChartReady:instance=&gt;{chartInstanceRef.current=instance,onChartReady&amp;&amp;onChartReady(instance);const handleResize=()=&gt;{instance&amp;&amp;instance.resize()};window.addEventListener("resize",handleResize),window.addEventListener("grid-resize",handleResize);instance._resizeCleanup=()=&gt;{window.removeEventListener("resize",handleResize),window.removeEventListener("grid-resize",handleResize)}},getChartInstance:instance=&gt;{chartInstanceRef.current=instance},enableLargeDataOptimization:!0,largeDataConfig:largeDataConfig}),enableFaultDetection&amp;&amp;jsxRuntimeExports.jsx(FaultOverlay,{faults:visibleFaults,timeRange:chartTimeRange,height:"100%",width:"100%",showSummaryPanel:!0,enableFiltering:!0,enableAutoDetection:faultConfig.enabled,detectionSensitivity:faultConfig.sensitivity,onFaultClick:handleFaultClick,onFaultAcknowledge:handleFaultAcknowledge,onFaultResolve:handleFaultResolve,onToggleAutoDetection:enabled=&gt;updateFaultConfig({enabled:enabled}),onSensitivityChange:updateFaultSensitivity,chartBounds:chartBounds,getChartPosition:getChartPosition})]})]})},areChartPropsEqual),RawDataModal=({open:open,onClose:onClose,title:title,subtitle:subtitle,data:data,aggregationType:aggregationType,dateFormat:dateFormat="yyyy-MM-dd h:mm:ss a"})=&gt;{var _a,_b,_c;const stats=(()=&gt;{if(!data||0===data.length)return null;const values=data.map(d=&gt;d.value),sum=values.reduce((a,b)=&gt;a+b,0);return{avg:sum/values.length,min:Math.min(...values),max:Math.max(...values),count:values.length}})();return jsxRuntimeExports.jsxs(Dialog,{open:open,onClose:onClose,maxWidth:"md",fullWidth:!0,PaperProps:{sx:{minHeight:"60vh",maxHeight:"90vh"}},children:[jsxRuntimeExports.jsxs(DialogTitle,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",pb:1},children:[jsxRuntimeExports.jsxs(Box,{children:[jsxRuntimeExports.jsx(Typography$1,{variant:"h6",children:title}),subtitle&amp;&amp;jsxRuntimeExports.jsx(Typography$1,{variant:"body2",color:"text.secondary",children:subtitle})]}),jsxRuntimeExports.jsxs(Box,{sx:{display:"flex",alignItems:"center",gap:1},children:[aggregationType&amp;&amp;jsxRuntimeExports.jsx(Chip,{label:`Aggregation: ${aggregationType}`,size:"small",color:"primary",variant:"outlined"}),jsxRuntimeExports.jsx(IconButton,{onClick:onClose,size:"small",children:jsxRuntimeExports.jsx(Close,{})})]})]}),jsxRuntimeExports.jsxs(DialogContent,{dividers:!0,children:[stats&amp;&amp;jsxRuntimeExports.jsxs(Box,{sx:{mb:3,p:2,bgcolor:"background.paper",borderRadius:1},children:[jsxRuntimeExports.jsx(Typography$1,{variant:"subtitle2",gutterBottom:!0,children:"Summary Statistics"}),jsxRuntimeExports.jsxs(Box,{sx:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(150px, 1fr))",gap:2},children:[jsxRuntimeExports.jsxs(Box,{children:[jsxRuntimeExports.jsx(Typography$1,{variant:"caption",color:"text.secondary",children:"Count"}),jsxRuntimeExports.jsx(Typography$1,{variant:"body1",fontWeight:"medium",children:stats.count})]}),jsxRuntimeExports.jsxs(Box,{children:[jsxRuntimeExports.jsx(Typography$1,{variant:"caption",color:"text.secondary",children:"Average"}),jsxRuntimeExports.jsxs(Typography$1,{variant:"body1",fontWeight:"medium",children:[stats.avg.toFixed(2)," ",null==(_a=data[0])?void 0:_a.unit]})]}),jsxRuntimeExports.jsxs(Box,{children:[jsxRuntimeExports.jsx(Typography$1,{variant:"caption",color:"text.secondary",children:"Min"}),jsxRuntimeExports.jsxs(Typography$1,{variant:"body1",fontWeight:"medium",children:[stats.min.toFixed(2)," ",null==(_b=data[0])?void 0:_b.unit]})]}),jsxRuntimeExports.jsxs(Box,{children:[jsxRuntimeExports.jsx(Typography$1,{variant:"caption",color:"text.secondary",children:"Max"}),jsxRuntimeExports.jsxs(Typography$1,{variant:"body1",fontWeight:"medium",children:[stats.max.toFixed(2)," ",null==(_c=data[0])?void 0:_c.unit]})]})]})]}),jsxRuntimeExports.jsx(TableContainer,{component:Paper,variant:"outlined",children:jsxRuntimeExports.jsxs(Table,{size:"small",stickyHeader:!0,children:[jsxRuntimeExports.jsx(TableHead,{children:jsxRuntimeExports.jsxs(TableRow,{children:[jsxRuntimeExports.jsx(TableCell,{children:"#"}),jsxRuntimeExports.jsx(TableCell,{children:"Timestamp"}),jsxRuntimeExports.jsx(TableCell,{align:"right",children:"Value"}),jsxRuntimeExports.jsx(TableCell,{children:"Unit"}),data.some(d=&gt;d.metadata)&amp;&amp;jsxRuntimeExports.jsx(TableCell,{children:"Metadata"})]})}),jsxRuntimeExports.jsx(TableBody,{children:data.map((point,index2)=&gt;jsxRuntimeExports.jsxs(TableRow,{hover:!0,children:[jsxRuntimeExports.jsx(TableCell,{children:index2+1}),jsxRuntimeExports.jsx(TableCell,{children:format$1(new Date(point.timestamp),dateFormat)}),jsxRuntimeExports.jsx(TableCell,{align:"right",sx:{fontFamily:"monospace"},children:point.value.toFixed(2)}),jsxRuntimeExports.jsx(TableCell,{children:point.unit||"-"}),data.some(d=&gt;d.metadata)&amp;&amp;jsxRuntimeExports.jsx(TableCell,{children:point.metadata?jsxRuntimeExports.jsx(Typography$1,{variant:"caption",component:"pre",sx:{m:0},children:JSON.stringify(point.metadata,null,2)}):"-"})]},index2))})]})})]}),jsxRuntimeExports.jsxs(DialogActions,{children:[jsxRuntimeExports.jsx(Button,{startIcon:jsxRuntimeExports.jsx(Download,{}),onClick:()=&gt;{if(!data||0===data.length)return;const rows=data.map(point=&gt;[format$1(new Date(point.timestamp),dateFormat),point.value.toString(),point.unit||""]),csvContent=[["Timestamp","Value","Unit"].join(","),...rows.map(row=&gt;row.join(","))].join("\n"),blob=new Blob([csvContent],{type:"text/csv"}),url=URL.createObjectURL(blob),link=document.createElement("a");link.href=url,link.download=`${title.replace(/\s+/g,"_")}_raw_data_${format$1(new Date,"yyyyMMdd_HHmmss")}.csv`,document.body.appendChild(link),link.click(),document.body.removeChild(link),URL.revokeObjectURL(url)},variant:"outlined",children:"Export CSV"}),jsxRuntimeExports.jsx(Button,{onClick:onClose,variant:"contained",children:"Close"})]})]})},EChartsBarChart$1=React.memo(userProps=&gt;{var _a;const{data:data,loading:loading,error:error,height:height,title:title,timeRange:timeRange,selectedPoints:selectedPoints,onChartReady:onChartReady,orientation:orientation="vertical",showValues:showValues,thresholds:thresholds,enableToolbox:enableToolbox,showDataZoom:showDataZoom,aggregationInfo:aggregationInfo,showMarkerTags:showMarkerTags,customColors:customColors,showExportToolbar:showExportToolbar,exportPosition:exportPosition,enableClickModal:enableClickModal}=mergeWithDefaults(userProps,"bar"),theme=useTheme(),chartInstanceRef=reactExports.useRef(null),[announcement,setAnnouncement]=reactExports.useState(""),[keyboardNavState,setKeyboardNavState]=reactExports.useState(null);reactExports.useEffect(()=&gt;()=&gt;{var _a2;(null==(_a2=chartInstanceRef.current)?void 0:_a2._resizeCleanup)&amp;&amp;chartInstanceRef.current._resizeCleanup()},[]);const{series:fetchedSeries,isLoading:dataLoading,error:dataError}=useChartDataSimple({selectedPoints:selectedPoints||[],timeRange:timeRange,enabled:!!selectedPoints&amp;&amp;selectedPoints.length&gt;0}),activeSeries=fetchedSeries||data||[],isLoading=loading||dataLoading,activeError=error||dataError,{modalOpen:modalOpen,selectedData:selectedData,handleBarClick:handleBarClick,closeModal:closeModal}=useBarChartClick();reactExports.useEffect(()=&gt;{const dataToNav=activeSeries;dataToNav&amp;&amp;dataToNav.length&gt;0&amp;&amp;setKeyboardNavState(createKeyboardNavState(1,[dataToNav.length]))},[activeSeries]);const handleKeyDown=reactExports.useCallback(e2=&gt;{var _a2;if(!keyboardNavState||!activeSeries||!chartInstanceRef.current)return;const{key:key}=e2;if("Enter"===key){e2.preventDefault();const currentBar=activeSeries[keyboardNavState.currentPointIndex];if(currentBar){const value=currentBar.value||0,announcement2=`${currentBar.name}, Value: ${value.toFixed(2)}${currentBar.unit?` ${currentBar.unit}`:""}`;setAnnouncement(announcement2),chartInstanceRef.current.dispatchAction({type:"showTip",seriesIndex:0,dataIndex:keyboardNavState.currentPointIndex})}return}if("Escape"===key)return e2.preventDefault(),null==(_a2=chartInstanceRef.current)||_a2.dispatchAction({type:"hideTip"}),void setAnnouncement("Returned to chart overview");if(["ArrowLeft","ArrowRight","ArrowUp","ArrowDown","Home","End"].includes(key)){e2.preventDefault();const newState=handleKeyboardNav("ArrowUp"===key?"ArrowLeft":"ArrowDown"===key?"ArrowRight":key,keyboardNavState,(seriesIndex,pointIndex)=&gt;{var _a3;const currentBar=activeSeries[pointIndex];if(currentBar){const value=currentBar.value||0,announcement2=`${currentBar.name}, Value: ${value.toFixed(2)}${currentBar.unit?` ${currentBar.unit}`:""}`;setAnnouncement(announcement2),null==(_a3=chartInstanceRef.current)||_a3.dispatchAction({type:"showTip",seriesIndex:0,dataIndex:pointIndex})}});setKeyboardNavState(newState)}},[keyboardNavState,activeSeries]),ariaLabelData=reactExports.useMemo(()=&gt;activeSeries&amp;&amp;0!==activeSeries.length?{categoryCount:activeSeries.length,dataPointCount:activeSeries.length}:{categoryCount:0,dataPointCount:0},[activeSeries]),exportData=reactExports.useMemo(()=&gt;{var _a2,_b,_c,_d;const dataToExport=activeSeries;if(!dataToExport||0===dataToExport.length)return[];if(Array.isArray(null==(_a2=dataToExport[0])?void 0:_a2.data))return dataToExport.map(series=&gt;({name:series.formattedName||series.name,data:series.data,unit:series.unit,markerTags:series.markerTags,pointMetadata:series.pointMetadata}));{const timeSeriesData=dataToExport.map((bar,index2)=&gt;[index2,bar.value]);return[{name:title||"Bar Chart Data",data:timeSeriesData,unit:null==(_b=dataToExport[0])?void 0:_b.unit,markerTags:null==(_c=dataToExport[0])?void 0:_c.markerTags,pointMetadata:null==(_d=dataToExport[0])?void 0:_d.pointMetadata}]}},[activeSeries,title]),baseChartOptions=useBaseChartOptions(),option=reactExports.useMemo(()=&gt;{var _a2,_b;let barData=activeSeries;if(Array.isArray(activeSeries)&amp;&amp;activeSeries.length&gt;0&amp;&amp;Array.isArray(null==(_a2=activeSeries[0])?void 0:_a2.data)&amp;&amp;(barData=activeSeries.map(series=&gt;{var _a3,_b2;return{name:series.formattedName||series.name,value:(null==(_a3=series.data[series.data.length-1])?void 0:_a3[1])||0,unit:series.unit,timestamp:null==(_b2=series.data[series.data.length-1])?void 0:_b2[0],markerTags:series.markerTags,rawData:series.data.map(([ts,val])=&gt;({timestamp:new Date(ts),value:val}))}})),!barData||0===barData.length)return mergeChartOptions(baseChartOptions,{title:{text:title,left:"center",top:20,textStyle:{color:theme.palette.text.primary,fontSize:16,fontWeight:600}},xAxis:{type:"category",data:[]},yAxis:{type:"value"},series:[],graphic:[{type:"text",left:"center",top:"center",style:{text:"No data available",fontSize:16,fill:theme.palette.text.secondary}}]});const safeData=Array.isArray(barData)?barData:[],isDarkMode="dark"===theme.palette.mode,colors=customColors||(isDarkMode?DARK_THEME_COLORS:getDistinctColors(safeData.length));null==(_b=safeData[0])||_b.unit;const isHorizontal="horizontal"===orientation,categories=safeData.map(d=&gt;showMarkerTags&amp;&amp;d.markerTags?formatPointWithTags(d.name,d.markerTags,d.pointMetadata):d.name),values=safeData.map((d,i)=&gt;({value:d.value,itemStyle:{color:d.color||colors[i%colors.length]},rawData:d.rawData,timestamp:d.timestamp,aggregationType:null==aggregationInfo?void 0:aggregationInfo.type})),tooltipFormatter=aggregationInfo?createTooltipConfig(aggregationInfo):{trigger:"axis",axisPointer:{type:"shadow"},formatter:params=&gt;{const param=Array.isArray(params)?params[0]:params,dataItem=barData[param.dataIndex],value=formatNumberForDisplay(param.value,2,null==dataItem?void 0:dataItem.unit);let content='&lt;div style="font-family: monospace;"&gt;';if(showMarkerTags&amp;&amp;dataItem.markerTags){content+=`${formatPointWithTags(dataItem.name,dataItem.markerTags,dataItem.pointMetadata)}&lt;br/&gt;`}else content+=`${param.name}&lt;br/&gt;`;return content+=`&lt;strong&gt;${value}&lt;/strong&gt;`,aggregationInfo&amp;&amp;(content+=`&lt;br/&gt;&lt;span style="color: #999; font-size: 0.9em;"&gt;${aggregationInfo.description}&lt;/span&gt;`),content+="&lt;/div&gt;",content}},totalPoints=safeData.length,animationMode=CHART_DESIGN_TOKENS.adaptive.animationMode(totalPoints),chartOption=mergeChartOptions(baseChartOptions,{title:title?{...CHART_DESIGN_TOKENS.title.base,text:title,textStyle:{...CHART_DESIGN_TOKENS.title.base.textStyle,color:theme.palette.text.primary}}:void 0,tooltip:{...tooltipFormatter,backgroundColor:isDarkMode?"rgba(50, 50, 50, 0.95)":"rgba(255, 255, 255, 0.95)",borderColor:isDarkMode?"rgba(255, 255, 255, 0.12)":"rgba(0, 0, 0, 0.12)",textStyle:{...CHART_DESIGN_TOKENS.tooltip.base.textStyle,color:theme.palette.text.primary}},grid:{...CHART_DESIGN_TOKENS.grid.base,containLabel:!0,top:calculateGridTop({hasTitle:!!title,hasToolbox:enableToolbox}),bottom:categories.length&gt;10&amp;&amp;!isHorizontal?80:CHART_DESIGN_TOKENS.grid.base.bottom},...CHART_DESIGN_TOKENS.animation[animationMode],aria:createEChartsAriaConfig(title||"Bar Chart",categories,!0),xAxis:isHorizontal?{type:"value",scale:!0,min:"dataMin",max:"dataMax",axisLabel:{formatter:value=&gt;formatNumberForDisplay(value,1)}}:{type:"category",data:categories,axisLabel:{interval:0,rotate:categories.length&gt;10?45:0,formatter:value=&gt;{const maxLength=categories.length&gt;10?15:20;return value.length&gt;maxLength?value.substring(0,maxLength)+"...":value}}},yAxis:isHorizontal?{type:"category",data:categories,axisLabel:{formatter:value=&gt;value.length&gt;25?value.substring(0,25)+"...":value}}:{type:"value",scale:!0,min:"dataMin",max:"dataMax",axisLabel:{formatter:value=&gt;formatNumberForDisplay(value,1)}},series:[{type:"bar",data:values,label:showValues?{show:!0,position:isHorizontal?"right":"top",formatter:params=&gt;{const dataItem=barData[params.dataIndex];return formatNumberForDisplay(params.value,1,null==dataItem?void 0:dataItem.unit)},fontSize:11,color:theme.palette.text.primary}:void 0,emphasis:{itemStyle:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}},large:safeData.length&gt;1e3,largeThreshold:1e3,barMaxWidth:safeData.length&gt;50?void 0:50,barCategoryGap:safeData.length&gt;20?"20%":"40%",markLine:thresholds&amp;&amp;thresholds.length&gt;0?{symbol:"none",label:{position:"end",formatter:"{b}",fontSize:11,padding:[2,4],backgroundColor:"rgba(255, 255, 255, 0.8)",borderRadius:2},data:thresholds.map(threshold=&gt;({[isHorizontal?"xAxis":"yAxis"]:threshold.value,name:`${threshold.name}: ${formatNumberForDisplay(threshold.value)}`,label:{color:threshold.color||theme.palette.error.main},lineStyle:{color:threshold.color||theme.palette.error.main,type:"solid",width:2}}))}:void 0}]},{showDataZoom:showDataZoom,showLegend:!1,showToolbox:enableToolbox,enableDataView:!0,enableMagicType:!0}),optimizedOption=safeData.length&gt;1e3?getOptimizedChartOptions(chartOption,{dataSize:safeData.length,seriesCount:1,enableProgressive:!0,enableLargeMode:!0,enableDataSampling:!1}):chartOption;return enhanceChart(optimizedOption,{chartType:"bar",dataSize:safeData.length,theme:theme.palette.mode})},[baseChartOptions,activeSeries,title,orientation,showValues,thresholds,theme.palette.mode,theme.palette.text.primary,enableToolbox,showDataZoom,aggregationInfo,showMarkerTags,customColors]);return jsxRuntimeExports.jsxs(Box,{sx:{position:"relative",height:"string"==typeof height?height:`${height}px`,width:"100%",display:"flex",flexDirection:"column",minHeight:"number"==typeof height?height:300,paddingTop:showExportToolbar?"48px":0,paddingBottom:showExportToolbar&amp;&amp;(null==exportPosition?void 0:exportPosition.includes("bottom"))?"48px":0,"&amp; .echarts-wrapper":{height:"100% !important",width:"100% !important"}},children:[showExportToolbar&amp;&amp;!isLoading&amp;&amp;!activeError&amp;&amp;exportData.length&gt;0&amp;&amp;jsxRuntimeExports.jsx(ChartExportToolbar,{chartInstance:chartInstanceRef.current,chartData:exportData,chartTitle:title||"Bar Chart",position:exportPosition,size:"small",onExportStart:()=&gt;{},onExportComplete:format2=&gt;{},onExportError:error2=&gt;{}}),jsxRuntimeExports.jsx(Box,{role:"status","aria-live":"polite","aria-atomic":"true",sx:srOnlyStyles,children:announcement}),jsxRuntimeExports.jsx(Box,{role:"img","aria-label":`${title||"Bar Chart"}. Bar chart showing ${ariaLabelData.categoryCount} categories with ${ariaLabelData.dataPointCount} data points. Use arrow keys to navigate, Enter to show details, Escape to return to overview.`,tabIndex:0,onKeyDown:handleKeyDown,sx:{flex:"1 1 auto",position:"relative",minHeight:0,minWidth:0,width:"100%",height:"100%",...chartFocusStyles},children:jsxRuntimeExports.jsx(EChartsWrapper,{error:activeError,loading:isLoading,option:option,height:"100%",width:"100%",theme:theme.palette.mode,style:{position:"absolute",top:0,left:0,right:0,bottom:0,width:"100%",height:"100%"},getChartInstance:instance=&gt;{chartInstanceRef.current=instance,onChartReady&amp;&amp;instance&amp;&amp;onChartReady(instance);const handleResize=()=&gt;{instance&amp;&amp;instance.resize()};window.addEventListener("resize",handleResize),window.addEventListener("grid-resize",handleResize);instance._resizeCleanup=()=&gt;{window.removeEventListener("resize",handleResize),window.removeEventListener("grid-resize",handleResize)}},onEvents:enableClickModal?createBarChartClickEvent(handleBarClick):void 0})}),enableClickModal&amp;&amp;selectedData&amp;&amp;jsxRuntimeExports.jsx(RawDataModal,{open:modalOpen,onClose:closeModal,title:`Raw Data: ${selectedData.seriesName}`,subtitle:`Bar Value: ${selectedData.value}${(null==(_a=activeSeries[0])?void 0:_a.unit)?` ${activeSeries[0].unit}`:""}`,data:selectedData.rawData||[],aggregationType:selectedData.aggregationType})]})});const EChartsHeatmap$1=React.memo(userProps=&gt;{const{data:data,loading:externalLoading,error:externalError,height:height,width:width,title:title,colorScheme:colorScheme="default",xCategories:xCategories,yCategories:yCategories,timeRange:timeRange,selectedPoints:selectedPoints,deviationConfig:deviationConfig,showValues:showValues,enableToolbox:enableToolbox,unit:unit,enableColorScaleConfig:enableColorScaleConfig,customColorScale:customColorScale,showMarkerTags:showMarkerTags,presetType:presetType="temperature",onEdit:onEdit,onDelete:onDelete,onChartReady:onChartReady,timeBucket:timeBucket="hourly",showAbsoluteValues:showAbsoluteValues=!0,enableNormalization:enableNormalization=!1,normalizationMethod:normalizationMethod="minmax",baselineValues:baselineValues}=mergeWithDefaults(userProps,"heatmap"),theme=useTheme(),chartInstanceRef=reactExports.useRef(null),[colorStops,setColorStops]=reactExports.useState(customColorScale||HEATMAP_COLOR_SCALES[presetType]||HEATMAP_COLOR_SCALES.temperature);useChartKeyboardShortcuts$1(chartInstanceRef,{enableZoom:!1,enablePan:!1,enableReset:!0,enableDataView:!0});const{series:fetchedSeries,isLoading:isLoading,error:dataError}=useChartDataSimple({selectedPoints:selectedPoints||[],timeRange:timeRange||"24h",enabled:selectedPoints&amp;&amp;selectedPoints.length&gt;0}),dataSource=data||fetchedSeries||[],validatedData=reactExports.useMemo(()=&gt;{var _a;if(Array.isArray(dataSource)&amp;&amp;dataSource.length&gt;0){if((null==(_a=dataSource[0])?void 0:_a.data)&amp;&amp;Array.isArray(dataSource[0].data))return dataSource.filter(s=&gt;s&amp;&amp;s.data&amp;&amp;Array.isArray(s.data)&amp;&amp;s.data.length&gt;0);if("object"==typeof dataSource[0]&amp;&amp;"value"in dataSource[0])return dataSource}return[]},[dataSource]),finalLoading=externalLoading||isLoading,finalError=externalError||dataError;reactExports.useEffect(()=&gt;()=&gt;{var _a;(null==(_a=chartInstanceRef.current)?void 0:_a._resizeCleanup)&amp;&amp;chartInstanceRef.current._resizeCleanup()},[]);const baseChartOptions=useBaseChartOptions(),option=reactExports.useMemo(()=&gt;{var _a;let heatmapData=[],xCats=[],yCats=[],stats={min:0,max:0};if(validatedData.length&gt;0&amp;&amp;(null==(_a=validatedData[0])?void 0:_a.data)){const transformResult=function transformTimeseriesToHeatmap(seriesData,timeBucket="hourly",options={}){if(!seriesData||0===seriesData.length)return{data:[],xCategories:[],yCategories:[],stats:{min:0,max:0,mean:0}};let minTime=1/0,maxTime=-1/0;if(seriesData.forEach(series=&gt;{series.data.forEach(([timestamp])=&gt;{minTime=Math.min(minTime,timestamp),maxTime=Math.max(maxTime,timestamp)})}),!isFinite(minTime)||!isFinite(maxTime))return{data:[],xCategories:[],yCategories:[],stats:{min:0,max:0,mean:0}};const intervalMs=TimeAggregation.getIntervalMs("hourly"===timeBucket?"hourly":"daily"===timeBucket?"daily":"15min"===timeBucket?"15min":"5min"),timeBuckets=[];for(let t=Math.floor(minTime/intervalMs)*intervalMs;t&lt;=maxTime;t+=intervalMs){const date=new Date(t);let label;label=format$1(date,"hourly"===timeBucket?"MM/dd h:mm a":"daily"===timeBucket?"MM/dd":"h:mm a"),timeBuckets.push({timestamp:t,label:label})}const yCategories=seriesData.map(series=&gt;series.name),bucketedData=new Map;seriesData.forEach((series,yIndex)=&gt;{series.data.forEach(([timestamp,value])=&gt;{const bucketKey=(Math.floor(timestamp/intervalMs)*intervalMs).toString();bucketedData.has(bucketKey)||bucketedData.set(bucketKey,new Map);const bucket=bucketedData.get(bucketKey);bucket.has(series.name)||bucket.set(series.name,[]),bucket.get(series.name).push(value)})});const allValues=[],heatmapData=[];if(timeBuckets.forEach((bucket,xIndex)=&gt;{const bucketData=bucketedData.get(bucket.timestamp.toString());yCategories.forEach((pointName,yIndex)=&gt;{const values=null==bucketData?void 0:bucketData.get(pointName);if(values&amp;&amp;values.length&gt;0){const avgValue=ChartStatistics.mean(values);allValues.push(avgValue);const series=seriesData.find(s=&gt;s.name===pointName);heatmapData.push({x:xIndex,y:yIndex,value:avgValue,pointName:pointName,formattedName:(null==series?void 0:series.name)||pointName,markerTags:null==series?void 0:series.markerTags,pointMetadata:null==series?void 0:series.pointMetadata,timestamp:bucket.timestamp,actualValue:avgValue})}})}),options.enableNormalization&amp;&amp;heatmapData.length&gt;0)if("minmax"===options.normalizationMethod){const{min:globalMin,max:globalMax}=ChartStatistics.range(allValues),range2=globalMax-globalMin;range2&gt;0&amp;&amp;heatmapData.forEach(point=&gt;{point.value=(point.actualValue-globalMin)/range2})}else if("zscore"===options.normalizationMethod){const mean=ChartStatistics.mean(allValues),stdDev=ChartStatistics.standardDeviation(allValues);stdDev&gt;0&amp;&amp;heatmapData.forEach(point=&gt;{point.value=(point.actualValue-mean)/stdDev})}else"baseline"===options.normalizationMethod&amp;&amp;options.baselineValues&amp;&amp;heatmapData.forEach(point=&gt;{const baseline=options.baselineValues[point.pointName];void 0!==baseline&amp;&amp;(point.deviation=DeviationCalculations.fromTarget(point.actualValue,baseline),point.value=options.showAbsoluteValues?point.actualValue:point.deviation)});const finalValues=heatmapData.map(d=&gt;d.value),range=ChartStatistics.range(finalValues),stats={min:range.min,max:range.max,mean:ChartStatistics.mean(finalValues)};return{data:heatmapData,xCategories:timeBuckets.map(b=&gt;b.label),yCategories:yCategories,stats:stats}}(validatedData,timeBucket,{enableNormalization:enableNormalization,normalizationMethod:normalizationMethod,baselineValues:baselineValues,showAbsoluteValues:showAbsoluteValues});heatmapData=transformResult.data,xCats=transformResult.xCategories,yCats=transformResult.yCategories,stats=transformResult.stats}else if(validatedData.length&gt;0&amp;&amp;"object"==typeof validatedData[0]&amp;&amp;"value"in validatedData[0]){heatmapData=validatedData,xCats=xCategories||Array.from(new Set(validatedData.map(d=&gt;String(d.x)))).sort(),yCats=yCategories||Array.from(new Set(validatedData.map(d=&gt;d.formattedName||String(d.y)))).sort();const values2=validatedData.map(d=&gt;d.value);if(values2.length&gt;0){const range=ChartStatistics.range(values2);stats={min:range.min,max:range.max,mean:ChartStatistics.mean(values2)}}}if(0===heatmapData.length){const titleOptions2=buildChartTitle(title,theme),xAxisOptions2=buildXAxis({}),yAxisOptions2=buildYAxis({});return combineOptions(baseChartOptions,{title:titleOptions2,xAxis:xAxisOptions2,yAxis:yAxisOptions2,series:[],graphic:[{type:"text",left:"center",top:"center",style:{text:"No data available",fontSize:16,fill:theme.palette.text.secondary}}]})}const values=heatmapData.map(d=&gt;d.value);let displayValues=values,minValue=stats.min,maxValue=stats.max;deviationConfig&amp;&amp;(displayValues=((values,config)=&gt;values.map(value=&gt;calculateDeviation$1(value,config).deviation))(values,deviationConfig),minValue=displayValues.length&gt;0?Math.min(...displayValues):0,maxValue=displayValues.length&gt;0?Math.max(...displayValues):1);const echartsHeatmapData=heatmapData.map((item,index2)=&gt;["number"==typeof item.x?item.x:xCats.indexOf(String(item.x)),"number"==typeof item.y?item.y:yCats.indexOf(String(item.y)),deviationConfig?displayValues[index2]:item.value,item.actualValue||item.value]),isDarkMode="dark"===theme.palette.mode,titleOptions=title?{...CHART_DESIGN_TOKENS.title.base,text:title,textStyle:{...CHART_DESIGN_TOKENS.title.base.textStyle,color:theme.palette.text.primary}}:void 0,tooltipOptions={...CHART_DESIGN_TOKENS.tooltip.base,trigger:"item",position:"top",formatter:params=&gt;{var _a2,_b;const xLabel=xCats[params.value[0]],yLabel=yCats[params.value[1]],originalValue=params.value[3]||params.value[2],displayValue=params.value[2],pointData=heatmapData.find(d=&gt;{const xIndex="number"==typeof d.x?d.x:xCats.indexOf(String(d.x)),yIndex="number"==typeof d.y?d.y:yCats.indexOf(String(d.y));return xIndex===params.value[0]&amp;&amp;yIndex===params.value[1]});let result='&lt;div style="padding: 8px;"&gt;';if(pointData){if(showMarkerTags&amp;&amp;(pointData.markerTags||(null==(_a2=pointData.pointMetadata)?void 0:_a2.markerTags))){const metadata={id:pointData.pointName||`${xLabel}-${yLabel}`,name:pointData.pointName||`${xLabel} - ${yLabel}`,markerTags:pointData.markerTags||(null==(_b=pointData.pointMetadata)?void 0:_b.markerTags),unit:unit,...pointData.pointMetadata};result+=`&lt;strong&gt;${formatPointWithTags(metadata,{maxTags:3,includeUnit:!1})}&lt;/strong&gt;&lt;br/&gt;`}else pointData.pointName&amp;&amp;(result+=`&lt;strong&gt;${pointData.pointName}&lt;/strong&gt;&lt;br/&gt;`);pointData.timestamp&amp;&amp;(result+=`Time: ${new Date(pointData.timestamp).toLocaleString()}&lt;br/&gt;`)}if(result+=`${xLabel} - ${yLabel}&lt;br/&gt;`,enableNormalization){if(result+=`Normalized: &lt;strong&gt;${formatNumberForDisplay(displayValue,3)}&lt;/strong&gt;&lt;br/&gt;`,result+=`Actual: &lt;strong&gt;${formatNumberForDisplay(originalValue,2)}${unit?` ${unit}`:""}&lt;/strong&gt;`,void 0!==(null==pointData?void 0:pointData.deviation)){result+=`&lt;br/&gt;Deviation: &lt;strong&gt;${pointData.deviation&gt;=0?"+":""}${formatNumberForDisplay(pointData.deviation,2)}${unit?` ${unit}`:""}&lt;/strong&gt;`}}else result+=`Value: &lt;strong&gt;${formatNumberForDisplay(originalValue,2)}${unit?` ${unit}`:""}&lt;/strong&gt;`;if(showMarkerTags&amp;&amp;(null==pointData?void 0:pointData.markerTags)&amp;&amp;pointData.markerTags.length&gt;0&amp;&amp;(result+='&lt;br/&gt;&lt;span style="color: rgba(255,255,255,0.7); font-size: 11px;"&gt;',result+=`Tags: ${pointData.markerTags.slice(0,5).join(", ")}`,result+="&lt;/span&gt;"),deviationConfig){const deviation=calculateDeviation$1(originalValue,deviationConfig),deviationSign=deviation.deviation&gt;=0?"+":"",severityColor="critical"===deviation.severity?"#f44336":"warning"===deviation.severity?"#ff9800":"#4caf50";result+=`&lt;br/&gt;Deviation: &lt;span style="color: ${severityColor}; font-weight: bold;"&gt;`,result+=`${deviationSign}${formatNumberForDisplay(deviation.deviation,3)}${unit?` ${unit}`:""}&lt;/span&gt;`,"single"===deviationConfig.mode&amp;&amp;void 0!==deviationConfig.setpoint?result+=`&lt;br/&gt;Setpoint: ${deviationConfig.setpoint}${unit?` ${unit}`:""}`:"range"===deviationConfig.mode&amp;&amp;(result+=`&lt;br/&gt;Range: ${deviationConfig.minSetpoint}-${deviationConfig.maxSetpoint}${unit?` ${unit}`:""}`),result+=`&lt;br/&gt;Status: &lt;span style="color: ${severityColor}; font-weight: bold;"&gt;`,result+=`${deviation.isInRange?"In Range":deviation.severity.toUpperCase()}&lt;/span&gt;`}return result+="&lt;/div&gt;",result},backgroundColor:isDarkMode?"rgba(50, 50, 50, 0.95)":"rgba(255, 255, 255, 0.95)",borderColor:isDarkMode?"rgba(255, 255, 255, 0.12)":"rgba(0, 0, 0, 0.12)",textStyle:{...CHART_DESIGN_TOKENS.tooltip.base.textStyle,color:theme.palette.text.primary}},gridOptions={...CHART_DESIGN_TOKENS.grid.base,height:"70%",top:calculateGridTop({hasTitle:!!title,hasToolbox:!0}),right:"10%",left:"15%"},xAxisOptions=buildXAxis({axisLabel:{rotate:xCats.length&gt;10?45:0,color:theme.palette.text.secondary}}),yAxisOptions=buildYAxis({axisLabel:{color:theme.palette.text.secondary}}),visualMapOptions=deviationConfig?createDeviationVisualMap(displayValues,deviationConfig,{orient:"horizontal",bottom:"5%"}):buildVisualMap({textStyle:{color:theme.palette.text.secondary},inRange:enableColorScaleConfig?{color:generateColorScale(minValue,maxValue,colorStops).map(stop=&gt;stop.color)}:{}}),heatmapSeries=SeriesBuilders.heatmap({name:deviationConfig?"Deviation Heatmap":enableNormalization?"Normalized Heatmap":"Heatmap",data:echartsHeatmapData,label:{show:showValues,formatter:params=&gt;{const value=(showAbsoluteValues||!enableNormalization)&amp;&amp;params.value[3]||params.value[2];return formatNumberForDisplay(value,1)},color:theme.palette.text.primary,fontSize:10},emphasis:{itemStyle:{shadowBlur:10,shadowColor:"dark"===theme.palette.mode?"rgba(255, 255, 255, 0.3)":"rgba(0, 0, 0, 0.5)",opacity:1}}}),totalDataPoints=heatmapData.length,animationMode=CHART_DESIGN_TOKENS.adaptive.animationMode(totalDataPoints),heatmapOptions=combineOptions(baseChartOptions,{...CHART_DESIGN_TOKENS.animation[animationMode],title:titleOptions,tooltip:tooltipOptions,grid:gridOptions,xAxis:xAxisOptions,yAxis:yAxisOptions,visualMap:visualMapOptions,series:[heatmapSeries]},{showDataZoom:!1,showLegend:!1,showToolbox:enableToolbox,enableDataView:!0,onEdit:onEdit,onDelete:onDelete});return totalDataPoints&gt;1e4?getOptimizedChartOptions(heatmapOptions,{dataSize:totalDataPoints,seriesCount:1,enableProgressive:!0,enableLargeMode:!0,enableDataSampling:!1}):heatmapOptions},[baseChartOptions,validatedData,title,colorScheme,xCategories,yCategories,timeRange,selectedPoints,timeBucket,enableNormalization,normalizationMethod,baselineValues,showAbsoluteValues,deviationConfig,showValues,theme.palette.mode,theme.palette.text.primary,theme.palette.text.secondary,enableToolbox,unit,showMarkerTags,enableColorScaleConfig,colorStops,onEdit,onDelete]);return jsxRuntimeExports.jsx(Box,{sx:{position:"relative",height:"string"==typeof height?height:`${height}px`,width:width||"100%",display:"flex",flexDirection:"column",minHeight:"number"==typeof height?height:300,"&amp; .echarts-wrapper":{height:"100% !important",width:"100% !important"}},children:jsxRuntimeExports.jsx(Box,{sx:{flex:"1 1 auto",position:"relative",minHeight:0,minWidth:0,width:"100%",height:"100%"},children:jsxRuntimeExports.jsx(EChartsWrapper,{error:finalError,loading:finalLoading,option:option,height:"100%",width:"100%",theme:"dark"===theme.palette.mode?"dark":"light",style:{position:"absolute",top:0,left:0,right:0,bottom:0,width:"100%",height:"100%"},getChartInstance:instance=&gt;{chartInstanceRef.current=instance,onChartReady&amp;&amp;onChartReady(instance);const handleResize=()=&gt;{instance&amp;&amp;instance.resize()};window.addEventListener("resize",handleResize),window.addEventListener("grid-resize",handleResize);instance._resizeCleanup=()=&gt;{window.removeEventListener("resize",handleResize),window.removeEventListener("grid-resize",handleResize)}}})})})}),EChartsGaugeChart$1=React.memo(({data:data,series:series,value:value,name:name="Gauge",unit:unit="",min:min=0,max:max=100,thresholds:thresholds,thresholdZones:initialZones,loading:externalLoading,error:externalError,height:height="400px",title:title,enableToolbox:enableToolbox=!0,enableThresholdConfig:enableThresholdConfig=!1,markerTags:markerTags,pointMetadata:pointMetadata,showMarkerTags:showMarkerTags=!0,presetType:presetType,selectedPoints:selectedPoints,timeRange:timeRange="1h",refreshInterval:refreshInterval=3e4,enableLiveData:enableLiveData=!0,onEdit:onEdit,onDelete:onDelete})=&gt;{var _a,_b,_c,_d;const theme=useTheme(),chartInstanceRef=reactExports.useRef(null),baseOptions=useBaseChartOptions(),[customZones,setCustomZones]=reactExports.useState(initialZones||[]),{series:fetchedSeries,isLoading:isLoading,error:dataError}=useChartDataSimple({selectedPoints:selectedPoints||[],timeRange:timeRange,refreshInterval:enableLiveData?refreshInterval:void 0,enabled:selectedPoints&amp;&amp;selectedPoints.length&gt;0}),dataSource=series||fetchedSeries||[],validatedData=reactExports.useMemo(()=&gt;Array.isArray(dataSource)?dataSource.filter(s=&gt;s&amp;&amp;s.data&amp;&amp;Array.isArray(s.data)&amp;&amp;s.data.length&gt;0):[],[dataSource]),finalLoading=externalLoading||isLoading,finalError=externalError||dataError;reactExports.useEffect(()=&gt;()=&gt;{var _a2;(null==(_a2=chartInstanceRef.current)?void 0:_a2._resizeCleanup)&amp;&amp;chartInstanceRef.current._resizeCleanup()},[]);const gaugeData=reactExports.useMemo(()=&gt;validatedData.length&gt;0?validatedData.map((seriesItem,index2)=&gt;{let latestValue=0,pointMin=min,pointMax=max;if(seriesItem.data&amp;&amp;seriesItem.data.length&gt;0){const latestPoint=seriesItem.data[seriesItem.data.length-1];if(latestValue=Array.isArray(latestPoint)?latestPoint[1]:latestPoint.value||0,0===min&amp;&amp;100===max){const values=seriesItem.data.map(point=&gt;Array.isArray(point)?point[1]:point.value||0).filter(val=&gt;null!=val&amp;&amp;!isNaN(val));if(values.length&gt;0){const dataMin=Math.min(...values),dataMax=Math.max(...values),range=dataMax-dataMin;pointMin=Math.floor(dataMin-.1*range),pointMax=Math.ceil(dataMax+.1*range)}}}return{value:latestValue,name:seriesItem.formattedName||seriesItem.name,unit:seriesItem.unit||unit,min:pointMin,max:pointMax,markerTags:seriesItem.markerTags,originalSeries:seriesItem}}):data&amp;&amp;Array.isArray(data)&amp;&amp;data.length&gt;0?data.map(dataItem=&gt;({value:(null==dataItem?void 0:dataItem.value)||0,name:(null==dataItem?void 0:dataItem.formattedName)||(null==dataItem?void 0:dataItem.name)||name,unit:(null==dataItem?void 0:dataItem.unit)||unit,min:(null==dataItem?void 0:dataItem.min)||min,max:(null==dataItem?void 0:dataItem.max)||max,markerTags:null==dataItem?void 0:dataItem.markerTags})):[{value:value||0,name:name,unit:unit,min:min,max:max,markerTags:markerTags}],[validatedData,data,value,name,unit,min,max,markerTags]),currentValue=(null==(_a=gaugeData[0])?void 0:_a.value)||0,effectiveUnit=(null==(_b=gaugeData[0])?void 0:_b.unit)||unit,effectiveMarkerTags=(null==(_c=gaugeData[0])?void 0:_c.markerTags)||markerTags,effectiveName=gaugeData.length&gt;1?title||"Multiple Gauges":(null==(_d=gaugeData[0])?void 0:_d.name)||name,displayName=1===gaugeData.length&amp;&amp;showMarkerTags&amp;&amp;(effectiveMarkerTags||(null==pointMetadata?void 0:pointMetadata.markerTags))?formatPointWithTags({name:effectiveName,markerTags:effectiveMarkerTags||(null==pointMetadata?void 0:pointMetadata.markerTags),unit:effectiveUnit,...pointMetadata},{maxTags:2,includeUnit:!1}):effectiveName;reactExports.useMemo(()=&gt;transformToGauge({value:currentValue,name:displayName,unit:effectiveUnit,markerTags:effectiveMarkerTags,pointMetadata:pointMetadata}),[currentValue,displayName,effectiveUnit,effectiveMarkerTags,pointMetadata]);const option=reactExports.useMemo(()=&gt;{const totalPoints=gaugeData.reduce((sum,gauge)=&gt;{var _a2;return sum+((null==(_a2=gauge.markerTags)?void 0:_a2.length)||1)},0),animationMode=CHART_DESIGN_TOKENS.adaptive.animationMode(totalPoints),isDarkMode="dark"===theme.palette.mode,numGauges=gaugeData.length,isMultipleGauges=numGauges&gt;1,gaugeSpecificOptions={...CHART_DESIGN_TOKENS.animation[animationMode],title:title?{...CHART_DESIGN_TOKENS.title.base,text:title,textStyle:{...CHART_DESIGN_TOKENS.title.base.textStyle,color:theme.palette.text.primary}}:void 0,tooltip:{...CHART_DESIGN_TOKENS.tooltip.base,backgroundColor:isDarkMode?"rgba(50, 50, 50, 0.95)":"rgba(255, 255, 255, 0.95)",borderColor:isDarkMode?"rgba(255, 255, 255, 0.12)":"rgba(0, 0, 0, 0.12)",textStyle:{...CHART_DESIGN_TOKENS.tooltip.base.textStyle,color:theme.palette.text.primary},formatter:function(params){const gauge=gaugeData[params.seriesIndex]||gaugeData[0],metadata={id:gauge.name,name:gauge.name,markerTags:gauge.markerTags||(null==pointMetadata?void 0:pointMetadata.markerTags),unit:gauge.unit,...pointMetadata};let content='&lt;div style="padding: 8px;"&gt;';return content+=`&lt;div style="font-weight: bold; margin-bottom: 4px;"&gt;${gauge.name}&lt;/div&gt;`,content+=`&lt;div style="font-size: 20px; color: #00D9FF;"&gt;${formatNumberForDisplay(params.value,1)}${gauge.unit?" "+gauge.unit:""}&lt;/div&gt;`,metadata.markerTags&amp;&amp;metadata.markerTags.length&gt;0&amp;&amp;(content+='&lt;div style="margin-top: 4px; font-size: 12px; color: rgba(255,255,255,0.7);"&gt;',content+=`Tags: ${metadata.markerTags.slice(0,3).join(", ")}`,content+="&lt;/div&gt;"),content+="&lt;/div&gt;",content}},series:gaugeData.map((gauge,index2)=&gt;{const layout=((index2,total)=&gt;{if(1===total)return{center:["50%","60%"],radius:"75%"};if(2===total)return{center:0===index2?["25%","60%"]:["75%","60%"],radius:"60%"};if(total&lt;=4)return{center:[["30%","40%"],["70%","40%"],["30%","80%"],["70%","80%"]][index2]||["50%","60%"],radius:"45%"};{const cols=Math.ceil(Math.sqrt(total));return{center:[(index2%cols+1)/(cols+1)*100+"%",(Math.floor(index2/cols)+1)/(Math.ceil(total/cols)+1)*100+"%"],radius:`${Math.min(30,80/cols)}%`}}})(index2,numGauges),axisLineColor=((gaugeMin,gaugeMax)=&gt;{let axisLineColor=[];if(customZones.length&gt;0){const gaugeThresholds=createGaugeThresholds(gaugeMin,gaugeMax,customZones);axisLineColor=gaugeThresholds.map(zone=&gt;[zone.end/100,zone.color])}else if(thresholds&amp;&amp;thresholds.length&gt;0){const sortedThresholds=[...thresholds].sort((a,b)=&gt;a.value-b.value);let lastValue=0;sortedThresholds.forEach((threshold,index2)=&gt;{const normalizedValue=(threshold.value-gaugeMin)/(gaugeMax-gaugeMin);0===index2&amp;&amp;normalizedValue&gt;0&amp;&amp;axisLineColor.push([normalizedValue,"#4CAF50"]),axisLineColor.push([normalizedValue,threshold.color]),lastValue=normalizedValue}),lastValue&lt;1&amp;&amp;axisLineColor.push([1,thresholds[thresholds.length-1].color])}else axisLineColor=[[.2,"#4CAF50"],[.5,"#8BC34A"],[.8,"#FFB84D"],[1,"#FF4444"]];return axisLineColor})(gauge.min,gauge.max);return{name:`Gauge_${index2}`,type:"gauge",center:layout.center,radius:layout.radius,startAngle:180,endAngle:0,min:gauge.min,max:gauge.max,splitNumber:isMultipleGauges?5:10,axisLine:{lineStyle:{width:isMultipleGauges?20:30,color:axisLineColor}},pointer:{icon:"path://M12.8,0.7l12,40.1H0.7L12.8,0.7z",length:"80%",width:isMultipleGauges?6:8,offsetCenter:[0,"-60%"],itemStyle:{color:"auto"}},axisTick:{length:isMultipleGauges?8:12,lineStyle:{color:"auto",width:2}},splitLine:{length:isMultipleGauges?12:20,lineStyle:{color:"auto",width:isMultipleGauges?3:5}},axisLabel:{color:theme.palette.text.secondary,fontSize:isMultipleGauges?10:14,distance:isMultipleGauges?-40:-60,formatter:function(val){return formatNumberForDisplay(val,0)}},title:{offsetCenter:[0,isMultipleGauges?"35%":"20%"],fontSize:isMultipleGauges?14:20,fontWeight:"bold",color:theme.palette.text.primary},detail:{fontSize:isMultipleGauges?16:24,offsetCenter:[0,isMultipleGauges?"15%":"0%"],valueAnimation:!0,formatter:function(val){return formatNumberForDisplay(val,1,gauge.unit)},color:"auto"},data:[{value:gauge.value,name:gauge.name}]}})};return mergeChartOptions(baseOptions,gaugeSpecificOptions,{showToolbox:enableToolbox,enableDataView:!1,enableMagicType:!1,showDataZoom:!1,showLegend:!1})},[gaugeData,customZones,thresholds,title,theme.palette.mode,theme.palette.text,enableToolbox,pointMetadata,baseOptions,onEdit,onDelete]);return jsxRuntimeExports.jsx(Box,{sx:{position:"relative",height:"string"==typeof height?height:`${height}px`,width:"100%",display:"flex",flexDirection:"column",minHeight:"number"==typeof height?height:400,"&amp; .echarts-wrapper":{height:"100% !important",width:"100% !important"}},children:jsxRuntimeExports.jsx(Box,{sx:{flex:"1 1 auto",position:"relative",minHeight:0,minWidth:0,width:"100%",height:"100%"},children:jsxRuntimeExports.jsx(EChartsWrapper,{error:finalError,loading:finalLoading,option:option,height:"100%",width:"100%",theme:theme.palette.mode,style:{position:"absolute",top:0,left:0,right:0,bottom:0,width:"100%",height:"100%"},onChartReady:instance=&gt;{chartInstanceRef.current=instance;const handleResize=()=&gt;{instance&amp;&amp;instance.resize()};window.addEventListener("resize",handleResize),window.addEventListener("grid-resize",handleResize);instance._resizeCleanup=()=&gt;{window.removeEventListener("resize",handleResize),window.removeEventListener("grid-resize",handleResize)}}})})})});const EChartsScatterPlot$1=React.memo(({data:data,series:series,xAxisLabel:xAxisLabel="X Axis",yAxisLabel:yAxisLabel="Y Axis",xUnit:xUnit,yUnit:yUnit,loading:loading,error:error,height:height="400px",width:width,title:title,yDeviationConfig:yDeviationConfig,colorByDeviation:colorByDeviation=!1,showSetpointLines:showSetpointLines=!0,showSetpointAreas:showSetpointAreas=!0,enableToolbox:enableToolbox=!0,showMarkerTags:showMarkerTags=!0,customColors:customColors,showRegression:showRegression=!0,onEdit:onEdit,onDelete:onDelete,onChartReady:onChartReady,timeRange:timeRange,selectedPoints:selectedPoints,...restProps})=&gt;{const theme=useTheme(),baseOptions=useBaseChartOptions(),chartInstanceRef=reactExports.useRef(null),containerRef=reactExports.useRef(null);useChartKeyboardShortcuts$1(chartInstanceRef,{enableZoom:!0,enablePan:!0,enableReset:!0,zoomSpeed:.1,panSpeed:5});const{series:fetchedSeries,isLoading:dataLoading,error:dataError}=useChartDataSimple({selectedPoints:selectedPoints||[],timeRange:timeRange||"24h",enabled:!!selectedPoints&amp;&amp;selectedPoints.length&gt;=2}),dataSource=series||fetchedSeries||[],isLoading=loading||dataLoading,activeError=error||dataError,validatedData=reactExports.useMemo(()=&gt;Array.isArray(dataSource)?dataSource.filter(s=&gt;s&amp;&amp;s.data&amp;&amp;Array.isArray(s.data)&amp;&amp;s.data.length&gt;0):[],[dataSource]),effectiveXAxisLabel=reactExports.useMemo(()=&gt;selectedPoints&amp;&amp;selectedPoints.length&gt;=1&amp;&amp;fetchedSeries&amp;&amp;selectedPoints[0].name||xAxisLabel,[selectedPoints,fetchedSeries,xAxisLabel]),effectiveYAxisLabel=reactExports.useMemo(()=&gt;selectedPoints&amp;&amp;selectedPoints.length&gt;=2&amp;&amp;fetchedSeries&amp;&amp;selectedPoints[1].name||yAxisLabel,[selectedPoints,fetchedSeries,yAxisLabel]);reactExports.useEffect(()=&gt;{const handleResize=()=&gt;{chartInstanceRef.current&amp;&amp;chartInstanceRef.current.resize()},handleGridResize=()=&gt;{chartInstanceRef.current&amp;&amp;chartInstanceRef.current.resize()};return window.addEventListener("resize",handleResize),window.addEventListener("grid-resize",handleGridResize),()=&gt;{window.removeEventListener("resize",handleResize),window.removeEventListener("grid-resize",handleGridResize)}},[]);const transformedData=reactExports.useMemo(()=&gt;{if(!validatedData||!Array.isArray(validatedData))return[];if(validatedData.length&gt;=2){const xSeries=validatedData[0],ySeries=validatedData[1],scatterData=[];if(xSeries.data&amp;&amp;ySeries.data){const yLookup=new Map(ySeries.data.map(([timestamp,value])=&gt;[timestamp,value]));xSeries.data.forEach(([timestamp,xValue])=&gt;{const yValue=yLookup.get(timestamp);void 0!==yValue&amp;&amp;null!==xValue&amp;&amp;null!==yValue&amp;&amp;scatterData.push([xValue,yValue])})}return[{name:`${ySeries.name} vs ${xSeries.name}`,formattedName:`${ySeries.formattedName||ySeries.name} vs ${xSeries.formattedName||xSeries.name}`,data:scatterData,color:ySeries.color||xSeries.color,unit:ySeries.unit,markerTags:ySeries.markerTags||xSeries.markerTags}]}return transformToScatter(validatedData)},[validatedData]),totalDataPoints=reactExports.useMemo(()=&gt;transformedData&amp;&amp;Array.isArray(transformedData)?transformedData.reduce((sum,series2)=&gt;{var _a;return sum+((null==(_a=series2.data)?void 0:_a.length)||0)},0):0,[transformedData]),useWebGL=totalDataPoints&gt;1e4,option=reactExports.useMemo(()=&gt;{const animationMode=CHART_DESIGN_TOKENS.adaptive.animationMode(totalDataPoints),isDarkMode="dark"===theme.palette.mode;if(!transformedData||0===transformedData.length)return{title:title?{...CHART_DESIGN_TOKENS.title.base,text:title,textStyle:{...CHART_DESIGN_TOKENS.title.base.textStyle,color:theme.palette.text.primary}}:void 0,xAxis:{type:"value",name:effectiveXAxisLabel||"X Axis"},yAxis:{type:"value",name:effectiveYAxisLabel||"Y Axis"},series:[],graphic:[{type:"text",left:"center",top:"center",style:{text:selectedPoints&amp;&amp;selectedPoints.length&lt;2?"Select at least 2 points for scatter plot":"No data available",fontSize:16,fill:theme.palette.text.secondary}}]};const colors=customColors||(isDarkMode?DARK_THEME_COLORS:getDistinctColors(transformedData.length));let setpointMarkLines=[],setpointMarkAreas=[];yDeviationConfig&amp;&amp;showSetpointLines&amp;&amp;(setpointMarkLines=createSetpointMarkLines(yDeviationConfig)),yDeviationConfig&amp;&amp;showSetpointAreas&amp;&amp;(setpointMarkAreas=createSetpointMarkAreas(yDeviationConfig));const series2=transformedData.map((seriesData,index2)=&gt;({name:seriesData.formattedName||seriesData.name,type:useWebGL?"scatterGL":"scatter",data:colorByDeviation&amp;&amp;yDeviationConfig?seriesData.data.map(([x,y])=&gt;{const deviation=calculateDeviation$1(y,yDeviationConfig);return{value:[x,y],itemStyle:{color:deviation.color},symbolSize:"critical"===deviation.severity?12:"warning"===deviation.severity?10:8}}):seriesData.data,symbolSize:colorByDeviation?void 0:8,itemStyle:colorByDeviation?void 0:{color:seriesData.color||colors[index2%colors.length]},emphasis:{focus:"series",itemStyle:{borderColor:"#333",borderWidth:2,shadowBlur:10,shadowColor:"rgba(0, 0, 0, 0.5)"}},large:seriesData.data.length&gt;5e3,largeThreshold:5e3,...useWebGL?{progressive:5e3,progressiveThreshold:1e4}:{}}));let regressionSeries=null;if(showRegression&amp;&amp;1===transformedData.length&amp;&amp;transformedData[0].data.length&gt;1){const points=transformedData[0].data,regression=function calculateLinearRegression(points){const n=points.length;if(n&lt;2)return null;let sumX=0,sumY=0,sumXY=0,sumX2=0;points.forEach(([x,y])=&gt;{sumX+=x,sumY+=y,sumXY+=x*y,sumX2+=x*x});const slope=(n*sumXY-sumX*sumY)/(n*sumX2-sumX*sumX),intercept=(sumY-slope*sumX)/n,yMean=sumY/n;let ssTotal=0,ssResidual=0;points.forEach(([x,y])=&gt;{const yPred=slope*x+intercept;ssTotal+=Math.pow(y-yMean,2),ssResidual+=Math.pow(y-yPred,2)});return{slope:slope,intercept:intercept,r2:1-ssResidual/ssTotal}}(points);if(regression){const minX=Math.min(...points.map(p=&gt;p[0])),maxX=Math.max(...points.map(p=&gt;p[0]));regressionSeries={name:"Trend Line",type:"line",data:[[minX,regression.slope*minX+regression.intercept],[maxX,regression.slope*maxX+regression.intercept]],lineStyle:{type:"dashed",color:"dark"===theme.palette.mode?"#999":"#666",width:2},symbol:"none",tooltip:{formatter:()=&gt;`y = ${regression.slope.toFixed(3)}x + ${regression.intercept.toFixed(3)}&lt;br/&gt;R = ${regression.r2.toFixed(3)}`}}}}const scatterSpecificOptions={title:title?{...CHART_DESIGN_TOKENS.title.base,text:title,textStyle:{...CHART_DESIGN_TOKENS.title.base.textStyle,color:theme.palette.text.primary}}:void 0,tooltip:{...baseOptions.tooltip,...CHART_DESIGN_TOKENS.tooltip.base,trigger:"item",backgroundColor:isDarkMode?"rgba(50, 50, 50, 0.95)":"rgba(255, 255, 255, 0.95)",borderColor:isDarkMode?"rgba(255, 255, 255, 0.12)":"rgba(0, 0, 0, 0.12)",textStyle:{...CHART_DESIGN_TOKENS.tooltip.base.textStyle,color:theme.palette.text.primary},formatter:params=&gt;{if(!params||!params.value||!Array.isArray(params.value)||params.value.length&lt;2)return"No data available";const xValue=formatNumberForDisplay(params.value[0],2,xUnit),yValue=formatNumberForDisplay(params.value[1],2,yUnit);let result='&lt;div style="padding: 8px; font-family: monospace;"&gt;';const originalSeriesIndex=transformedData.findIndex(s=&gt;(s.formattedName||s.name)===params.seriesName);if(showMarkerTags&amp;&amp;originalSeriesIndex&gt;=0&amp;&amp;transformedData[originalSeriesIndex].markerTags,result+=`&lt;strong&gt;${params.seriesName}&lt;/strong&gt;&lt;br/&gt;`,result+=`${effectiveXAxisLabel}: &lt;strong&gt;${xValue}&lt;/strong&gt;&lt;br/&gt;`,result+=`${effectiveYAxisLabel}: &lt;strong&gt;${yValue}&lt;/strong&gt;`,yDeviationConfig){const deviation=calculateDeviation$1(params.value[1],yDeviationConfig),deviationSign=deviation.deviation&gt;=0?"+":"",severityColor="critical"===deviation.severity?"#f44336":"warning"===deviation.severity?"#ff9800":"#4caf50";result+=`&lt;br/&gt;Deviation: &lt;span style="color: ${severityColor}; font-weight: bold;"&gt;`,result+=`${deviationSign}${formatNumberForDisplay(deviation.deviation,3)}${yUnit?` ${yUnit}`:""}&lt;/span&gt;`,"single"===yDeviationConfig.mode&amp;&amp;void 0!==yDeviationConfig.setpoint?result+=`&lt;br/&gt;Setpoint: ${yDeviationConfig.setpoint}${yUnit?` ${yUnit}`:""}`:"range"===yDeviationConfig.mode&amp;&amp;(result+=`&lt;br/&gt;Range: ${yDeviationConfig.minSetpoint}-${yDeviationConfig.maxSetpoint}${yUnit?` ${yUnit}`:""}`),result+=`&lt;br/&gt;Status: &lt;span style="color: ${severityColor}; font-weight: bold;"&gt;`,result+=`${deviation.isInRange?"In Range":deviation.severity.toUpperCase()}&lt;/span&gt;`}return result+="&lt;/div&gt;",result}},xAxis:{type:"value",name:effectiveXAxisLabel+(xUnit?` (${xUnit})`:""),nameLocation:"middle",nameGap:30,scale:!0,axisLabel:{formatter:value=&gt;formatNumberForDisplay(value,1)}},yAxis:{type:"value",name:effectiveYAxisLabel+(yUnit?` (${yUnit})`:""),nameLocation:"middle",nameGap:50,scale:!0,min:value=&gt;value.min-Math.abs(.1*value.min),max:value=&gt;value.max+Math.abs(.1*value.max),axisLabel:{formatter:value=&gt;formatNumberForDisplay(value,1)}},series:[...series2,...regressionSeries?[regressionSeries]:[],...setpointMarkLines.map(line=&gt;({name:line.label.formatter,type:"line",data:[[Math.min(...transformedData.flatMap(s=&gt;s.data.map(p=&gt;p[0]))),line.yAxis],[Math.max(...transformedData.flatMap(s=&gt;s.data.map(p=&gt;p[0]))),line.yAxis]],lineStyle:line.lineStyle,symbol:"none",silent:!0,z:1}))],visualMap:colorByDeviation&amp;&amp;yDeviationConfig?{show:!1,dimension:1,pieces:[{lte:yDeviationConfig.minSetpoint,color:"#f44336"},{gt:yDeviationConfig.minSetpoint,lte:yDeviationConfig.maxSetpoint,color:"#4caf50"},{gt:yDeviationConfig.maxSetpoint,color:"#f44336"}]}:void 0};setpointMarkAreas.length&gt;0&amp;&amp;scatterSpecificOptions.series&amp;&amp;(scatterSpecificOptions.series[0].markArea={silent:!0,data:setpointMarkAreas}),scatterSpecificOptions.grid={...CHART_DESIGN_TOKENS.grid.base,top:calculateGridTop({hasTitle:!!title,hasToolbox:!0})};const finalOptions={...mergeChartOptions(baseOptions,scatterSpecificOptions,{showToolbox:enableToolbox,enableDataView:!0,enableMagicType:!1,showDataZoom:!0,showLegend:!0}),...CHART_DESIGN_TOKENS.animation[animationMode]},seriesCount=transformedData.length;return totalDataPoints&gt;1e4||seriesCount&gt;10?getOptimizedChartOptions(finalOptions,{dataSize:Math.max(...transformedData.map(s=&gt;s.data.length)),seriesCount:seriesCount,enableProgressive:!0,enableLargeMode:!0,enableDataSampling:totalDataPoints&gt;5e4}):finalOptions},[transformedData,selectedPoints,title,effectiveXAxisLabel,effectiveYAxisLabel,xUnit,yUnit,yDeviationConfig,colorByDeviation,showSetpointLines,showSetpointAreas,theme.palette.mode,enableToolbox,showMarkerTags,customColors,showRegression,baseOptions,onEdit,onDelete]);return reactExports.useMemo(()=&gt;transformedData&amp;&amp;Array.isArray(transformedData)?transformedData.filter(series2=&gt;series2&amp;&amp;"string"==typeof series2.name&amp;&amp;Array.isArray(series2.data)&amp;&amp;series2.data.length&gt;0):[],[transformedData]),jsxRuntimeExports.jsx(Box,{ref:containerRef,sx:{position:"relative",height:height,width:"100%",overflow:"hidden"},children:jsxRuntimeExports.jsx(EChartsWrapper,{error:activeError,height:"100%",loading:isLoading,option:option,theme:theme.palette.mode,getChartInstance:instance=&gt;{chartInstanceRef.current=instance,onChartReady&amp;&amp;onChartReady(instance)}})})}),EChartsAreaChart=({data:data,loading:loading=!1,error:error=null,height:height=400,title:title,stacked:stacked=!1,showDataZoom:showDataZoom=!0,showLegend:showLegend=!0,enableAnimation:enableAnimation=!1,onEdit:onEdit,onDelete:onDelete,customColors:customColors,performanceMode:performanceMode="balanced"})=&gt;{const theme=useTheme(),baseOptions=useBaseChartOptions(),chartInstanceRef=reactExports.useRef(null),renderFrameRef=reactExports.useRef(),updatePendingRef=reactExports.useRef(!1),[announcement,setAnnouncement]=useState(""),[keyboardNavState,setKeyboardNavState]=useState(null),totalPoints=reactExports.useMemo(()=&gt;(Array.isArray(data)?data:[]).reduce((sum,series)=&gt;sum+(Array.isArray(series.data)?series.data.length:0),0),[data]),effectivePerformanceMode=reactExports.useMemo(()=&gt;"balanced"!==performanceMode?performanceMode:totalPoints&lt;2e4?"quality":totalPoints&lt;5e4?"balanced":"performance",[performanceMode,totalPoints]),perfSettings=reactExports.useMemo(()=&gt;{switch(effectivePerformanceMode){case"performance":return{animation:!1,animationDuration:0,progressive:1e3,progressiveThreshold:5e3,hoverLayerThreshold:3e3,useUTC:!0,gradients:!1,shadows:!1,symbolSize:0,lineSmooth:!1,blendMode:"source-over",largeMode:!0,sampling:"lttb"};case"quality":return{animation:!0,animationDuration:1e3,progressive:5e3,progressiveThreshold:1e4,hoverLayerThreshold:1e4,useUTC:!1,gradients:!0,shadows:!0,symbolSize:4,lineSmooth:!0,blendMode:"lighter",largeMode:!1,sampling:void 0};default:return{animation:!1,animationDuration:300,progressive:2e3,progressiveThreshold:7500,hoverLayerThreshold:5e3,useUTC:!0,gradients:!1,shadows:!1,symbolSize:0,lineSmooth:!1,blendMode:"source-over",largeMode:!0,sampling:"average"}}},[effectivePerformanceMode]),scheduleUpdate=reactExports.useCallback(()=&gt;{updatePendingRef.current||(updatePendingRef.current=!0,renderFrameRef.current&amp;&amp;cancelAnimationFrame(renderFrameRef.current),renderFrameRef.current=requestAnimationFrame(()=&gt;{updatePendingRef.current=!1,chartInstanceRef.current&amp;&amp;chartInstanceRef.current.resize()}))},[]);reactExports.useEffect(()=&gt;()=&gt;{renderFrameRef.current&amp;&amp;cancelAnimationFrame(renderFrameRef.current)},[]);const transformedData=reactExports.useMemo(()=&gt;transformToTimeSeries(data,{type:stacked?"stackedArea":"area",showMarkerTags:!1}),[data,stacked]);reactExports.useEffect(()=&gt;{const safeData=Array.isArray(data)?data:[];if(safeData.length&gt;0){const pointCounts=safeData.map(series=&gt;{var _a;return(null==(_a=series.data)?void 0:_a.length)||0});setKeyboardNavState(createKeyboardNavState(safeData.length,pointCounts))}},[data]);const handleKeyDown=reactExports.useCallback(e2=&gt;{var _a;const safeData=Array.isArray(data)?data:[];if(!keyboardNavState||!safeData||!chartInstanceRef.current)return;const{key:key}=e2;if("Enter"===key){e2.preventDefault();const currentSeries=safeData[keyboardNavState.currentSeriesIndex],currentPoint=null==currentSeries?void 0:currentSeries.data[keyboardNavState.currentPointIndex];if(currentPoint&amp;&amp;Array.isArray(currentPoint)){const[timestamp,value]=currentPoint;setAnnouncement(generateDataPointAnnouncement(currentSeries.name,timestamp,value,currentSeries.unit)),chartInstanceRef.current.dispatchAction({type:"showTip",seriesIndex:keyboardNavState.currentSeriesIndex,dataIndex:keyboardNavState.currentPointIndex})}return}if("Escape"===key)return e2.preventDefault(),null==(_a=chartInstanceRef.current)||_a.dispatchAction({type:"hideTip"}),void setAnnouncement("Returned to chart overview");if(["ArrowLeft","ArrowRight","ArrowUp","ArrowDown","PageUp","PageDown","Home","End"].includes(key)){e2.preventDefault();const newState=handleKeyboardNav(key,keyboardNavState,(seriesIndex,pointIndex)=&gt;{var _a2;const currentSeries=safeData[seriesIndex],currentPoint=null==currentSeries?void 0:currentSeries.data[pointIndex];if(currentPoint&amp;&amp;Array.isArray(currentPoint)){const[timestamp,value]=currentPoint;setAnnouncement(generateDataPointAnnouncement(currentSeries.name,timestamp,value,currentSeries.unit)),null==(_a2=chartInstanceRef.current)||_a2.dispatchAction({type:"showTip",seriesIndex:seriesIndex,dataIndex:pointIndex})}});setKeyboardNavState(newState)}},[keyboardNavState,data]),ariaLabelData=reactExports.useMemo(()=&gt;{const safeData=Array.isArray(data)?data:[];if(0===safeData.length)return{seriesCount:0,dataPointCount:0,startDate:void 0,endDate:void 0};const dataPointCount=safeData.reduce((sum,series)=&gt;{var _a;return sum+((null==(_a=series.data)?void 0:_a.length)||0)},0),allTimestamps=safeData.flatMap(series=&gt;{var _a;return(null==(_a=series.data)?void 0:_a.map(point=&gt;Array.isArray(point)?point[0]:point.timestamp))||[]});return{seriesCount:safeData.length,dataPointCount:dataPointCount,startDate:allTimestamps.length&gt;0?new Date(Math.min(...allTimestamps)):void 0,endDate:allTimestamps.length&gt;0?new Date(Math.max(...allTimestamps)):void 0}},[data]),chartOptions=reactExports.useMemo(()=&gt;{const safeData=Array.isArray(data)?data:[];if(!isSeriesArray(safeData)||0===safeData.length)return{title:{text:title,left:"center",top:20},xAxis:getTimeAxisConfig({showAxisName:!1}),yAxis:{type:"value"},series:[]};const colors=customColors||getDistinctColors(safeData.length),useSimpleRendering=totalPoints&gt;1e4,showSymbols=totalPoints&lt;1e3&amp;&amp;perfSettings.symbolSize&gt;0,enableHover=totalPoints&lt;perfSettings.hoverLayerThreshold,useLargeMode=perfSettings.largeMode&amp;&amp;useSimpleRendering,optimizedSeries=safeData.map((seriesData,index2)=&gt;{const color=colors[index2%colors.length],areaStyle=perfSettings.gradients?{color:{type:"linear",x:0,y:0,x2:0,y2:1,colorStops:[{offset:0,color:`${color}88`},{offset:1,color:`${color}22`}]},opacity:.7}:{color:`${color}40`,opacity:1};return{name:seriesData.name||`Series ${index2+1}`,type:"line",data:seriesData.data,lineStyle:{width:useSimpleRendering?1:2,color:color,type:"solid",cap:useSimpleRendering?"butt":"round",join:useSimpleRendering?"miter":"round",shadowBlur:perfSettings.shadows?2:0},areaStyle:areaStyle,symbol:showSymbols?"circle":"none",symbolSize:showSymbols?perfSettings.symbolSize:0,showSymbol:showSymbols,smooth:!!perfSettings.lineSmooth&amp;&amp;.3,...useLargeMode?{large:!0,largeThreshold:2e3,progressive:perfSettings.progressive,progressiveThreshold:perfSettings.progressiveThreshold}:{},...stacked?{stack:"total",stackStrategy:"all"}:{},emphasis:enableHover?{focus:"series",blurScope:"series",lineStyle:{width:3}}:{disabled:!0},sampling:perfSettings.sampling||(useSimpleRendering?"average":void 0),z:stacked?2:safeData.length-index2,zlevel:0}}),animationMode=CHART_DESIGN_TOKENS.adaptive.animationMode(totalPoints),isDarkMode="dark"===theme.palette.mode,options={renderer:"canvas",devicePixelRatio:window.devicePixelRatio&gt;2?2:window.devicePixelRatio,title:title?{...CHART_DESIGN_TOKENS.title.base,text:title,textStyle:{...CHART_DESIGN_TOKENS.title.base.textStyle,color:theme.palette.text.primary}}:void 0,grid:{...CHART_DESIGN_TOKENS.grid.base,top:calculateGridTop({hasTitle:!!title,hasToolbox:!0})},tooltip:{...CHART_DESIGN_TOKENS.tooltip.base,trigger:"axis",backgroundColor:isDarkMode?"rgba(50, 50, 50, 0.95)":"rgba(255, 255, 255, 0.95)",borderColor:isDarkMode?"rgba(255, 255, 255, 0.12)":"rgba(0, 0, 0, 0.12)",textStyle:{...CHART_DESIGN_TOKENS.tooltip.base.textStyle,color:theme.palette.text.primary},axisPointer:{type:useSimpleRendering?"line":"cross",animation:!1,label:{backgroundColor:"#6a7985",precision:0}},confine:!0,extraCssText:"z-index: 999",transitionDuration:0,alwaysShowContent:!1,hideDelay:100,enterable:!1},legend:showLegend?{data:optimizedSeries.map(s=&gt;s.name),bottom:5,type:"scroll",pageButtonItemGap:5,animationDurationUpdate:0}:void 0,xAxis:{...getTimeAxisConfig({showAxisName:!1}),axisPointer:{label:{formatter:params=&gt;new Date(params.value).toLocaleString()}},splitNumber:5,minInterval:6e4},yAxis:(()=&gt;{var _a,_b;const uniqueUnits=[...new Set(safeData.map(s=&gt;s.unit).filter(Boolean))];if(safeData.length&gt;1){const seriesRanges=safeData.map(seriesItem=&gt;{if(!seriesItem.data||0===seriesItem.data.length)return null;const values=seriesItem.data.map(p=&gt;Array.isArray(p)?p[1]:p).filter(v=&gt;"number"==typeof v);if(0===values.length)return null;const avg=values.reduce((a,b)=&gt;a+b,0)/values.length;return{name:seriesItem.name,unit:seriesItem.unit,min:Math.min(...values),max:Math.max(...values),magnitude:Math.floor(Math.log10(Math.abs(avg)||1))}}).filter(Boolean);if(seriesRanges.length&gt;1){const magnitudes=seriesRanges.map(r=&gt;r.magnitude),magDiff=Math.max(...magnitudes)-Math.min(...magnitudes);if(magDiff&gt;2||uniqueUnits.length&gt;1&amp;&amp;magDiff&gt;1){const avgMagnitude=magnitudes.reduce((a,b)=&gt;a+b,0)/magnitudes.length,leftAxisSeries=seriesRanges.filter(r=&gt;r.magnitude&lt;=avgMagnitude),rightAxisSeries=seriesRanges.filter(r=&gt;r.magnitude&gt;avgMagnitude),leftValues=leftAxisSeries.flatMap(r=&gt;{var _a2,_b2;return(null==(_b2=null==(_a2=safeData.find(s=&gt;s.name===r.name))?void 0:_a2.data)?void 0:_b2.map(p=&gt;Array.isArray(p)?p[1]:p))||[]}).filter(v=&gt;"number"==typeof v),rightValues=rightAxisSeries.flatMap(r=&gt;{var _a2,_b2;return(null==(_b2=null==(_a2=safeData.find(s=&gt;s.name===r.name))?void 0:_a2.data)?void 0:_b2.map(p=&gt;Array.isArray(p)?p[1]:p))||[]}).filter(v=&gt;"number"==typeof v);if(leftValues.length&gt;0&amp;&amp;rightValues.length&gt;0){const leftMin=Math.min(...leftValues),leftMax=Math.max(...leftValues),leftPadding=.1*(leftMax-leftMin),rightMin=Math.min(...rightValues),rightMax=Math.max(...rightValues),rightPadding=.1*(rightMax-rightMin);return optimizedSeries.forEach(s=&gt;{const seriesRange=seriesRanges.find(r=&gt;r.name===s.name);seriesRange&amp;&amp;(s.yAxisIndex=seriesRange.magnitude&gt;avgMagnitude?1:0)}),[{type:"value",name:(null==(_a=leftAxisSeries[0])?void 0:_a.unit)||"Value",position:"left",min:leftMin-leftPadding,max:leftMax+leftPadding,axisLabel:{formatter:value=&gt;formatNumberForDisplay(value,2)},splitLine:{show:!0,lineStyle:{type:"dashed",opacity:.3}},splitNumber:5},{type:"value",name:(null==(_b=rightAxisSeries[0])?void 0:_b.unit)||"Value 2",position:"right",min:rightMin-rightPadding,max:rightMax+rightPadding,axisLabel:{formatter:value=&gt;formatNumberForDisplay(value,2)},splitLine:{show:!1},splitNumber:5}]}}}}return{type:"value",name:1===uniqueUnits.length?uniqueUnits[0]:uniqueUnits.length&gt;1?"Multiple Units":"Value",nameLocation:"middle",nameGap:40,splitLine:{show:!0,lineStyle:{type:"dashed",opacity:.3}},splitNumber:5}})(),dataZoom:showDataZoom?[{type:"slider",show:!0,xAxisIndex:[0],start:0,end:100,height:20,bottom:0,throttle:100,rangeMode:["value","value"],animationDurationUpdate:200,realtime:!useSimpleRendering},{type:"inside",xAxisIndex:[0],start:0,end:100,throttle:100,zoomOnMouseWheel:"shift",moveOnMouseMove:!1}]:[],series:optimizedSeries,blendMode:perfSettings.blendMode,stateAnimation:{duration:200,easing:"linear"},...CHART_DESIGN_TOKENS.animation[animationMode],aria:createEChartsAriaConfig(title||"Area Chart",optimizedSeries.map(s=&gt;s.name),!0)};return mergeChartOptions(baseOptions,options,{showToolbox:!0,enableDataView:!0,showDataZoom:showDataZoom,showLegend:showLegend})},[data,title,stacked,showDataZoom,showLegend,customColors,perfSettings,baseOptions,theme,onEdit,onDelete,transformedData,totalPoints]),handleChartReady=reactExports.useCallback(chartInstance=&gt;{chartInstanceRef.current=chartInstance,chartInstance.off("highlight"),chartInstance.off("downplay");const resizeObserver=new ResizeObserver(()=&gt;{scheduleUpdate()});resizeObserver.observe(chartInstance.getDom()),chartInstance._resizeCleanup=()=&gt;{resizeObserver.disconnect()}},[scheduleUpdate]);return loading?jsxRuntimeExports.jsx(Box,{sx:{height:height,display:"flex",alignItems:"center",justifyContent:"center"},children:"Loading..."}):error?jsxRuntimeExports.jsxs(Box,{sx:{height:height,display:"flex",alignItems:"center",justifyContent:"center"},children:["Error: ",error.message]}):jsxRuntimeExports.jsxs(Box,{sx:{height:"100%",position:"relative"},children:[jsxRuntimeExports.jsx(Box,{role:"status","aria-live":"polite","aria-atomic":"true",sx:srOnlyStyles,children:announcement}),jsxRuntimeExports.jsx(Box,{role:"img","aria-label":generateChartAriaLabel(title||"Area Chart",ariaLabelData.seriesCount,ariaLabelData.dataPointCount,ariaLabelData.startDate,ariaLabelData.endDate,"area chart"),tabIndex:0,onKeyDown:handleKeyDown,sx:{height:"100%",width:"100%",...chartFocusStyles},children:jsxRuntimeExports.jsx(EChartsWrapper,{option:chartOptions,height:height,loading:loading,onChartReady:handleChartReady,lazyUpdate:!0,notMerge:!0,silent:!0})})]})};function TabPanel(props){const{children:children,value:value,index:index2,...other}=props;return jsxRuntimeExports.jsx("div",{role:"tabpanel",hidden:value!==index2,id:`economizer-tabpanel-${index2}`,"aria-labelledby":`economizer-tab-${index2}`,...other,children:value===index2&amp;&amp;jsxRuntimeExports.jsx(Box,{sx:{p:3},children:children})})}const PerfectEconomizerHelp=({open:open,onClose:onClose,config:config={mixedAirSetpoint:55,minimumOAPercentage:20,economizerHighLimit:75,unit:"F"}})=&gt;{const[tabValue,setTabValue]=reactExports.useState(0);return jsxRuntimeExports.jsxs(Dialog,{open:open,onClose:onClose,maxWidth:"md",fullWidth:!0,children:[jsxRuntimeExports.jsx(DialogTitle,{children:jsxRuntimeExports.jsxs(Box,{display:"flex",alignItems:"center",justifyContent:"space-between",children:[jsxRuntimeExports.jsx(Typography$1,{variant:"h6",children:"Understanding the Perfect Economizer Chart"}),jsxRuntimeExports.jsx(IconButton,{onClick:onClose,size:"small",children:jsxRuntimeExports.jsx(Close,{})})]})}),jsxRuntimeExports.jsxs(DialogContent,{dividers:!0,children:[jsxRuntimeExports.jsxs(Tabs,{value:tabValue,onChange:(event,newValue)=&gt;{setTabValue(newValue)},"aria-label":"economizer help tabs",children:[jsxRuntimeExports.jsx(Tab,{label:"Overview"}),jsxRuntimeExports.jsx(Tab,{label:"Operating Modes"}),jsxRuntimeExports.jsx(Tab,{label:"Fault Detection"}),jsxRuntimeExports.jsx(Tab,{label:"Optimization"})]}),jsxRuntimeExports.jsxs(TabPanel,{value:tabValue,index:0,children:[jsxRuntimeExports.jsx(Typography$1,{variant:"h6",gutterBottom:!0,children:"What is the Perfect Economizer?"}),jsxRuntimeExports.jsxs(Typography$1,{paragraph:!0,children:["The Perfect Economizer chart visualizes the ideal operating envelope for your HVAC economizer system. It plots ",jsxRuntimeExports.jsx("strong",{children:"Outdoor Air Temperature (OAT)"})," on the X-axis against ",jsxRuntimeExports.jsx("strong",{children:"Mixed Air Temperature (MAT)"})," on the Y-axis."]}),jsxRuntimeExports.jsxs(Alert,{severity:"info",sx:{mb:2},children:[jsxRuntimeExports.jsx(Typography$1,{variant:"subtitle2",children:"Key Concept:"}),'An economizer uses cool outdoor air for "free cooling" when conditions are favorable, reducing the need for mechanical cooling and saving energy.']}),jsxRuntimeExports.jsx(Typography$1,{variant:"h6",gutterBottom:!0,sx:{mt:3},children:"Current Configuration"}),jsxRuntimeExports.jsxs(Grid,{container:!0,spacing:2,children:[jsxRuntimeExports.jsx(Grid,{item:!0,xs:6,children:jsxRuntimeExports.jsxs(Paper,{sx:{p:2,bgcolor:"background.default"},children:[jsxRuntimeExports.jsx(Typography$1,{variant:"caption",color:"text.secondary",children:"Mixed Air Setpoint"}),jsxRuntimeExports.jsxs(Typography$1,{variant:"h6",children:[config.mixedAirSetpoint,"",config.unit]})]})}),jsxRuntimeExports.jsx(Grid,{item:!0,xs:6,children:jsxRuntimeExports.jsxs(Paper,{sx:{p:2,bgcolor:"background.default"},children:[jsxRuntimeExports.jsx(Typography$1,{variant:"caption",color:"text.secondary",children:"Minimum OA %"}),jsxRuntimeExports.jsxs(Typography$1,{variant:"h6",children:[config.minimumOAPercentage,"%"]})]})}),jsxRuntimeExports.jsx(Grid,{item:!0,xs:6,children:jsxRuntimeExports.jsxs(Paper,{sx:{p:2,bgcolor:"background.default"},children:[jsxRuntimeExports.jsx(Typography$1,{variant:"caption",color:"text.secondary",children:"Economizer High Limit"}),jsxRuntimeExports.jsxs(Typography$1,{variant:"h6",children:[config.economizerHighLimit,"",config.unit]})]})}),jsxRuntimeExports.jsx(Grid,{item:!0,xs:6,children:jsxRuntimeExports.jsxs(Paper,{sx:{p:2,bgcolor:"background.default"},children:[jsxRuntimeExports.jsx(Typography$1,{variant:"caption",color:"text.secondary",children:"Transition Temperature"}),jsxRuntimeExports.jsxs(Typography$1,{variant:"h6",children:[Math.round((config.mixedAirSetpoint-72)/(config.minimumOAPercentage/100)+72),"",config.unit]})]})})]})]}),jsxRuntimeExports.jsxs(TabPanel,{value:tabValue,index:1,children:[jsxRuntimeExports.jsx(Typography$1,{variant:"h6",gutterBottom:!0,children:"Four Operating Modes"}),jsxRuntimeExports.jsxs(List,{children:[jsxRuntimeExports.jsxs(ListItem,{children:[jsxRuntimeExports.jsx(ListItemIcon,{children:jsxRuntimeExports.jsx(LocalFireDepartment,{sx:{color:"#ff9800"}})}),jsxRuntimeExports.jsx(ListItemText,{primary:jsxRuntimeExports.jsxs(Box,{display:"flex",alignItems:"center",gap:1,children:[jsxRuntimeExports.jsx(Typography$1,{children:"MOA with Preheat"}),jsxRuntimeExports.jsx(Chip,{label:"Orange Line",size:"small",sx:{bgcolor:"#ff9800",color:"white"}})]}),secondary:`Cold weather (OAT &lt; ${Math.round((config.mixedAirSetpoint-72)/(config.minimumOAPercentage/100)+72)}${config.unit}): \n                  Maintains ${config.minimumOAPercentage}% outdoor air for ventilation, preheats as needed`})]}),jsxRuntimeExports.jsx(Divider,{variant:"inset",component:"li"}),jsxRuntimeExports.jsxs(ListItem,{children:[jsxRuntimeExports.jsx(ListItemIcon,{children:jsxRuntimeExports.jsx(CheckCircleIcon,{sx:{color:"#4caf50"}})}),jsxRuntimeExports.jsx(ListItemText,{primary:jsxRuntimeExports.jsxs(Box,{display:"flex",alignItems:"center",gap:1,children:[jsxRuntimeExports.jsx(Typography$1,{children:"Economizer Cooling"}),jsxRuntimeExports.jsx(Chip,{label:"Green Line",size:"small",sx:{bgcolor:"#4caf50",color:"white"}})]}),secondary:`Free cooling mode: Modulates outdoor air damper to maintain ${config.mixedAirSetpoint}${config.unit} setpoint without mechanical cooling`})]}),jsxRuntimeExports.jsx(Divider,{variant:"inset",component:"li"}),jsxRuntimeExports.jsxs(ListItem,{children:[jsxRuntimeExports.jsx(ListItemIcon,{children:jsxRuntimeExports.jsx(Thermostat,{sx:{color:"#2196f3"}})}),jsxRuntimeExports.jsx(ListItemText,{primary:jsxRuntimeExports.jsxs(Box,{display:"flex",alignItems:"center",gap:1,children:[jsxRuntimeExports.jsx(Typography$1,{children:"Integrated Economizer"}),jsxRuntimeExports.jsx(Chip,{label:"Blue Line",size:"small",sx:{bgcolor:"#2196f3",color:"white"}})]}),secondary:`100% outdoor air mode (${config.mixedAirSetpoint}${config.unit} &lt; OAT &lt; ${config.economizerHighLimit}${config.unit}): \n                  OAT equals MAT, maximum free cooling`})]}),jsxRuntimeExports.jsx(Divider,{variant:"inset",component:"li"}),jsxRuntimeExports.jsxs(ListItem,{children:[jsxRuntimeExports.jsx(ListItemIcon,{children:jsxRuntimeExports.jsx(AcUnit,{sx:{color:"#f44336"}})}),jsxRuntimeExports.jsx(ListItemText,{primary:jsxRuntimeExports.jsxs(Box,{display:"flex",alignItems:"center",gap:1,children:[jsxRuntimeExports.jsx(Typography$1,{children:"MOA with Cooling"}),jsxRuntimeExports.jsx(Chip,{label:"Red Line",size:"small",sx:{bgcolor:"#f44336",color:"white"}})]}),secondary:`Hot weather (OAT &gt; ${config.economizerHighLimit}${config.unit}): \n                  Returns to ${config.minimumOAPercentage}% outdoor air with mechanical cooling`})]})]}),jsxRuntimeExports.jsxs(Alert,{severity:"success",sx:{mt:2},children:[jsxRuntimeExports.jsx(Typography$1,{variant:"subtitle2",children:"Optimal Operation:"}),"Your actual operating points should fall on or very close to these colored lines. The system automatically transitions between modes based on outdoor conditions."]})]}),jsxRuntimeExports.jsxs(TabPanel,{value:tabValue,index:2,children:[jsxRuntimeExports.jsx(Typography$1,{variant:"h6",gutterBottom:!0,children:"Understanding Data Points"}),jsxRuntimeExports.jsx(Typography$1,{paragraph:!0,children:"Each dot on the chart represents an actual operating condition. The color and size indicate how well your system is performing:"}),jsxRuntimeExports.jsxs(List,{children:[jsxRuntimeExports.jsxs(ListItem,{children:[jsxRuntimeExports.jsx(ListItemIcon,{children:jsxRuntimeExports.jsx(CheckCircleIcon,{sx:{color:"#4caf50"}})}),jsxRuntimeExports.jsx(ListItemText,{primary:"Green Points",secondary:"Operating correctly (within 2F of ideal) - System is optimized"})]}),jsxRuntimeExports.jsxs(ListItem,{children:[jsxRuntimeExports.jsx(ListItemIcon,{children:jsxRuntimeExports.jsx(WarningIcon,{sx:{color:"#ff9800"}})}),jsxRuntimeExports.jsx(ListItemText,{primary:"Yellow Points",secondary:"Minor deviation (2-5F) - Possible sensor drift or control tuning needed"})]}),jsxRuntimeExports.jsxs(ListItem,{children:[jsxRuntimeExports.jsx(ListItemIcon,{children:jsxRuntimeExports.jsx(ErrorIcon,{sx:{color:"#f44336"}})}),jsxRuntimeExports.jsx(ListItemText,{primary:"Red Points",secondary:"Major deviation (&gt;5F) - Likely control failure or mechanical issue"})]})]}),jsxRuntimeExports.jsx(Typography$1,{variant:"h6",gutterBottom:!0,sx:{mt:3},children:"Common Faults Detected"}),jsxRuntimeExports.jsxs(Grid,{container:!0,spacing:2,children:[jsxRuntimeExports.jsx(Grid,{item:!0,xs:12,md:6,children:jsxRuntimeExports.jsxs(Paper,{sx:{p:2,border:"1px solid",borderColor:"error.main"},children:[jsxRuntimeExports.jsx(Typography$1,{variant:"subtitle2",color:"error",gutterBottom:!0,children:"Simultaneous Heating/Cooling"}),jsxRuntimeExports.jsx(Typography$1,{variant:"body2",children:"Points far from any line with both heating and cooling active"})]})}),jsxRuntimeExports.jsx(Grid,{item:!0,xs:12,md:6,children:jsxRuntimeExports.jsxs(Paper,{sx:{p:2,border:"1px solid",borderColor:"warning.main"},children:[jsxRuntimeExports.jsx(Typography$1,{variant:"subtitle2",color:"warning.main",gutterBottom:!0,children:"Stuck Dampers"}),jsxRuntimeExports.jsx(Typography$1,{variant:"body2",children:"Points not following expected mode transitions"})]})}),jsxRuntimeExports.jsx(Grid,{item:!0,xs:12,md:6,children:jsxRuntimeExports.jsxs(Paper,{sx:{p:2,border:"1px solid",borderColor:"warning.main"},children:[jsxRuntimeExports.jsx(Typography$1,{variant:"subtitle2",color:"warning.main",gutterBottom:!0,children:"Incorrect Setpoints"}),jsxRuntimeExports.jsx(Typography$1,{variant:"body2",children:"Consistent offset from perfect lines"})]})}),jsxRuntimeExports.jsx(Grid,{item:!0,xs:12,md:6,children:jsxRuntimeExports.jsxs(Paper,{sx:{p:2,border:"1px solid",borderColor:"error.main"},children:[jsxRuntimeExports.jsx(Typography$1,{variant:"subtitle2",color:"error",gutterBottom:!0,children:"Sensor Errors"}),jsxRuntimeExports.jsx(Typography$1,{variant:"body2",children:"Impossible operating conditions or outliers"})]})})]})]}),jsxRuntimeExports.jsxs(TabPanel,{value:tabValue,index:3,children:[jsxRuntimeExports.jsx(Typography$1,{variant:"h6",gutterBottom:!0,children:"Optimization Opportunities"}),jsxRuntimeExports.jsx(Typography$1,{paragraph:!0,children:"Use this chart to identify energy-saving opportunities:"}),jsxRuntimeExports.jsxs(List,{children:[jsxRuntimeExports.jsxs(ListItem,{children:[jsxRuntimeExports.jsx(ListItemIcon,{children:jsxRuntimeExports.jsx(TrendingUp,{})}),jsxRuntimeExports.jsx(ListItemText,{primary:"Free Cooling Potential",secondary:"Red points when OAT is favorable indicate missed free cooling opportunities"})]}),jsxRuntimeExports.jsxs(ListItem,{children:[jsxRuntimeExports.jsx(ListItemIcon,{children:jsxRuntimeExports.jsx(TrendingUp,{})}),jsxRuntimeExports.jsx(ListItemText,{primary:"Setpoint Optimization",secondary:`Adjust mixed air setpoint (currently ${config.mixedAirSetpoint}${config.unit}) based on actual loads`})]}),jsxRuntimeExports.jsxs(ListItem,{children:[jsxRuntimeExports.jsx(ListItemIcon,{children:jsxRuntimeExports.jsx(TrendingUp,{})}),jsxRuntimeExports.jsx(ListItemText,{primary:"High Limit Adjustment",secondary:`Consider adjusting economizer high limit (currently ${config.economizerHighLimit}${config.unit}) based on humidity`})]}),jsxRuntimeExports.jsxs(ListItem,{children:[jsxRuntimeExports.jsx(ListItemIcon,{children:jsxRuntimeExports.jsx(TrendingUp,{})}),jsxRuntimeExports.jsx(ListItemText,{primary:"Control Tuning",secondary:"Tighten control loops if seeing consistent yellow points"})]})]}),jsxRuntimeExports.jsxs(Alert,{severity:"info",sx:{mt:2},children:[jsxRuntimeExports.jsx(Typography$1,{variant:"subtitle2",children:"Pro Tip:"}),"Monitor this chart during different seasons to understand your economizer's performance patterns. Look for times when mechanical cooling runs unnecessarily (red points when green line conditions exist)."]}),jsxRuntimeExports.jsx(Typography$1,{variant:"h6",gutterBottom:!0,sx:{mt:3},children:"Energy Impact"}),jsxRuntimeExports.jsx(Typography$1,{paragraph:!0,children:"A properly functioning economizer can reduce cooling energy consumption by 20-40% in moderate climates. Each hour of unnecessary mechanical cooling when free cooling is available wastes approximately:"}),jsxRuntimeExports.jsxs(Box,{sx:{bgcolor:"background.default",p:2,borderRadius:1},children:[jsxRuntimeExports.jsx(Typography$1,{variant:"body2",children:" Small RTU (5 tons): ~5-6 kWh"}),jsxRuntimeExports.jsx(Typography$1,{variant:"body2",children:" Medium AHU (20 tons): ~20-24 kWh"}),jsxRuntimeExports.jsx(Typography$1,{variant:"body2",children:" Large AHU (50 tons): ~50-60 kWh"})]})]})]}),jsxRuntimeExports.jsx(DialogActions,{children:jsxRuntimeExports.jsx(Button,{onClick:onClose,color:"primary",children:"Close"})})]})},PerfectEconomizerHelpButton=({config:config})=&gt;{const[open,setOpen]=reactExports.useState(!1);return jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(Tooltip,{title:"Learn how to interpret this chart",children:jsxRuntimeExports.jsx(IconButton,{size:"small",onClick:()=&gt;setOpen(!0),sx:{position:"absolute",top:8,right:8,bgcolor:"background.paper","&amp;:hover":{bgcolor:"action.hover"}},children:jsxRuntimeExports.jsx(Info,{})})}),jsxRuntimeExports.jsx(PerfectEconomizerHelp,{open:open,onClose:()=&gt;setOpen(!1),config:config})]})};use([install$g]);const generateHeatmapGradient=(scheme="deviation",steps=256)=&gt;{let colorStops=[];if("temperature"===scheme)colorStops=[{position:0,color:"#313695"},{position:.25,color:"#74add1"},{position:.5,color:"#ffffbf"},{position:.75,color:"#fdae61"},{position:1,color:"#a50026"}];else{const deviationGradient=DEVIATION_COLORS.gradient,deviationCount=deviationGradient.length;colorStops=deviationGradient.map((color,index2)=&gt;({position:index2/(deviationCount-1),color:color}))}const colors=[];for(let i=0;i&lt;steps;i++){const position=i/(steps-1);let lowerStop=colorStops[0],upperStop=colorStops[colorStops.length-1];for(let j=0;j&lt;colorStops.length-1;j++)if(position&gt;=colorStops[j].position&amp;&amp;position&lt;=colorStops[j+1].position){lowerStop=colorStops[j],upperStop=colorStops[j+1];break}const range=upperStop.position-lowerStop.position,localPosition=range&gt;0?(position-lowerStop.position)/range:0,color=interpolateColor(lowerStop.color,upperStop.color,localPosition);colors.push(color)}return colors},interpolateColor=(color1,color2,factor)=&gt;{const c1=hexToRgb(color1),c2=hexToRgb(color2),r=Math.round(c1.r+(c2.r-c1.r)*factor),g=Math.round(c1.g+(c2.g-c1.g)*factor),b=Math.round(c1.b+(c2.b-c1.b)*factor);return rgbToHex(r,g,b)},hexToRgb=hex=&gt;{const result=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);return result?{r:parseInt(result[1],16),g:parseInt(result[2],16),b:parseInt(result[3],16)}:{r:0,g:0,b:0}},rgbToHex=(r,g,b)=&gt;"#"+((1&lt;&lt;24)+(r&lt;&lt;16)+(g&lt;&lt;8)+b).toString(16).slice(1),calculateDeviation=(value,config)=&gt;{if(!config)return 0;if(void 0!==config.targetValue){const deviation=value-config.targetValue;let effectiveTolerance;if(void 0!==config.tolerance)effectiveTolerance=config.tolerance;else{const targetMagnitude=Math.abs(config.targetValue);effectiveTolerance=targetMagnitude&lt;.1?.1*targetMagnitude:targetMagnitude&lt;1?.05*targetMagnitude:targetMagnitude&lt;10?.02*targetMagnitude:.01*targetMagnitude,effectiveTolerance=Math.max(effectiveTolerance,1e-4)}const normalizedDeviation=deviation/effectiveTolerance;return Math.max(-2,Math.min(2,normalizedDeviation))}if(void 0!==config.minValue&amp;&amp;void 0!==config.maxValue){const range=config.maxValue-config.minValue;if(value&lt;config.minValue){const deviation=(config.minValue-value)/range;return-Math.min(2,deviation)}if(value&gt;config.maxValue){const deviation=(value-config.maxValue)/range;return Math.min(2,deviation)}return 0}return 0},EChartsDeviceDeviationHeatmap=({series:series,loading:loading=!1,error:error=null,height:height=400,title:title="Device Deviation Heatmap",deviceConfigs:deviceConfigs=[],deviationMethod:deviationMethod="auto",timeRange:timeRange,colorScheme:colorScheme="deviation",customColors:customColors,onCellClick:onCellClick,onZoomRequest:onZoomRequest})=&gt;{const theme=useTheme(),chartRef=reactExports.useRef(null),baseOptions=useBaseChartOptions(),strategy=reactExports.useMemo(()=&gt;{if(!series||0===series.length)return{level:"full",smooth:!0,sampling:"none",lineWidth:1.5,showArea:!0,animation:!0,large:!1,largeThreshold:5e3,aggregation:"none",dataReduction:0,cellResolution:"5min",preserveAnomalies:!0,anomalyThreshold:2,aggregationMethod:"max",faultDetection:{mode:"realtime",accuracy:"full"}};let minTime=1/0,maxTime=-1/0;series.forEach(s=&gt;{s.data&amp;&amp;s.data.length&gt;0&amp;&amp;s.data.forEach(point=&gt;{point&amp;&amp;point[0]&amp;&amp;(minTime=Math.min(minTime,point[0]),maxTime=Math.max(maxTime,point[0]))})}),isFinite(minTime)&amp;&amp;isFinite(maxTime)||(minTime=Date.now()-864e5,maxTime=Date.now());const startDate=new Date(minTime),endDate=new Date(maxTime);return getHeatmapRenderingStrategy(startDate,endDate,series.length)},[series]),heatmapCells=reactExports.useMemo(()=&gt;{const cells=[],bucketSize=function getCellResolutionMs(resolution){switch(resolution){case"5min":return 3e5;case"15min":default:return 9e5;case"30min":return 18e5;case"1hour":return 36e5;case"2hour":return 72e5;case"4hour":return 144e5;case"8hour":return 288e5;case"1day":return 864e5}}(strategy.cellResolution),aggregatedData2=new Map;series.forEach(s=&gt;{const deviceBuckets=new Map;s.data.forEach(point=&gt;{const bucketTimestamp=Math.floor(point[0]/bucketSize)*bucketSize;deviceBuckets.has(bucketTimestamp)||deviceBuckets.set(bucketTimestamp,[]),deviceBuckets.get(bucketTimestamp).push(point[1])}),aggregatedData2.set(s.name,deviceBuckets)});const seriesStats=new Map;return aggregatedData2.forEach((deviceBuckets,deviceName)=&gt;{const aggregatedValues=[];deviceBuckets.forEach(bucketValues=&gt;{let aggregatedValue;if("mean"===strategy.aggregationMethod)aggregatedValue=bucketValues.reduce((sum,v)=&gt;sum+v,0)/bucketValues.length;else if("percentile95"===strategy.aggregationMethod){const sorted=[...bucketValues].sort((a,b)=&gt;a-b);aggregatedValue=sorted[Math.floor(.95*sorted.length)]||sorted[sorted.length-1]}else aggregatedValue=Math.max(...bucketValues);aggregatedValues.push(aggregatedValue)}),aggregatedValues.length&gt;0&amp;&amp;seriesStats.set(deviceName,(values=&gt;{const sorted=[...values].sort((a,b)=&gt;a-b),n=sorted.length,mean=values.reduce((sum,v)=&gt;sum+v,0)/n,median=n%2==0?(sorted[n/2-1]+sorted[n/2])/2:sorted[Math.floor(n/2)],q1=sorted[Math.floor(.25*n)],q3=sorted[Math.floor(.75*n)],iqr=q3-q1,variance=values.reduce((sum,v)=&gt;sum+Math.pow(v-mean,2),0)/n,stdDev=Math.sqrt(variance),min=sorted[0],max=sorted[n-1];return{mean:mean,median:median,stdDev:stdDev,min:min,max:max,range:max-min,q1:q1,q3:q3,iqr:iqr}})(aggregatedValues))}),aggregatedData2.forEach((deviceBuckets,deviceName)=&gt;{const config=deviceConfigs.find(c=&gt;c.deviceName===deviceName),stats=seriesStats.get(deviceName);stats&amp;&amp;deviceBuckets.forEach((bucketValues,timestamp)=&gt;{let aggregatedValue;if("mean"===strategy.aggregationMethod)aggregatedValue=bucketValues.reduce((sum,v)=&gt;sum+v,0)/bucketValues.length;else if("percentile95"===strategy.aggregationMethod){const sorted=[...bucketValues].sort((a,b)=&gt;a-b);aggregatedValue=sorted[Math.floor(.95*sorted.length)]||sorted[sorted.length-1]}else aggregatedValue=Math.max(...bucketValues);const deviation=((value,stats,method,config)=&gt;{switch(method){case"target":return void 0!==(null==config?void 0:config.targetValue)?calculateDeviation(value,config):(value-stats.mean)/(stats.stdDev||1);case"mean":return stats.stdDev&gt;0?(value-stats.mean)/stats.stdDev:0;case"median":const mad=stats.iqr/1.35;return mad&gt;0?(value-stats.median)/mad:0;case"minmax":return stats.range&gt;0?4*((value-stats.min)/stats.range-.5):0;case"percentage":return 0!==stats.mean?(value-stats.mean)/Math.abs(stats.mean)*100/50:0;case"iqr":return stats.iqr&gt;0?value&lt;stats.q1?(value-stats.q1)/stats.iqr:value&gt;stats.q3?(value-stats.q3)/stats.iqr:0:0;default:const cv=stats.stdDev/Math.abs(stats.mean);if(void 0!==(null==config?void 0:config.targetValue))return calculateDeviation(value,config);if(cv&gt;.5&amp;&amp;0!==stats.mean)return(value-stats.mean)/Math.abs(stats.mean)*100/50;if(stats.iqr&gt;0&amp;&amp;stats.iqr&lt;.5*stats.range){const mad2=stats.iqr/1.35;return mad2&gt;0?(value-stats.median)/mad2:0}return stats.stdDev&gt;0?(value-stats.mean)/stats.stdDev:0}})(aggregatedValue,stats,deviationMethod,config),clampedDeviation=Math.max(-2,Math.min(2,deviation));cells.push({device:deviceName,timestamp:timestamp,value:aggregatedValue,deviation:clampedDeviation})})}),cells},[series,deviceConfigs,deviationMethod,strategy]),aggregatedData=reactExports.useMemo(()=&gt;(console.log("[HeatmapV2] Using pre-aggregated cells:",{strategy:strategy.cellResolution,inputCells:heatmapCells.length,preserveAnomalies:strategy.preserveAnomalies}),heatmapCells.map(cell=&gt;({device:cell.device,timestamp:cell.timestamp,maxDeviation:cell.deviation,diagnostics:{count:1,mean:cell.deviation,min:cell.deviation,max:cell.deviation,percentile95:cell.deviation,stdDev:0,anomalyCount:Math.abs(cell.deviation)&gt;strategy.anomalyThreshold?1:0,sustainedDeviation:Math.abs(cell.deviation)&gt;1,peakTimestamp:cell.timestamp}}))),[heatmapCells,strategy]),chartData=reactExports.useMemo(()=&gt;optimizeHeatmapForECharts(aggregatedData,strategy),[aggregatedData,strategy]),tooltipFormatter=reactExports.useCallback(params=&gt;{if(!params||!params.data)return"";const[xIndex,yIndex,deviationValue]=params.value||[],timestamp=chartData.xAxis[xIndex],device=chartData.yAxis[yIndex],cell=aggregatedData.find(c=&gt;c.device===device&amp;&amp;chartData.xAxis[chartData.xAxis.findIndex(t=&gt;t===timestamp)]===timestamp),config=deviceConfigs.find(c=&gt;c.deviceName===device);if(!cell)return`\n        &lt;div style="padding: 8px;"&gt;\n          &lt;strong&gt;${device}&lt;/strong&gt;&lt;br/&gt;\n          ${timestamp}&lt;br/&gt;\n          Deviation: ${(100*deviationValue).toFixed(1)}%\n        &lt;/div&gt;\n      `;const statusColor=Math.abs(cell.maxDeviation)&gt;.5?CHART_DESIGN_TOKENS.colors.semantic.error:Math.abs(cell.maxDeviation)&gt;.2?CHART_DESIGN_TOKENS.colors.semantic.warning:CHART_DESIGN_TOKENS.colors.semantic.success;let actualValueStr="";if(config&amp;&amp;void 0!==config.targetValue&amp;&amp;cell.diagnostics){actualValueStr=`Actual Value: ${(config.targetValue+cell.diagnostics.mean*(config.tolerance||.1*config.targetValue)).toFixed(2)}&lt;br/&gt;\n                       Target: ${config.targetValue.toFixed(2)}&lt;br/&gt;`}let statusText="Normal",statusEmoji="";return Math.abs(cell.maxDeviation)&gt;1?(statusText="Critical",statusEmoji=""):Math.abs(cell.maxDeviation)&gt;.5?(statusText="Warning",statusEmoji=""):Math.abs(cell.maxDeviation)&gt;.2&amp;&amp;(statusText="Minor",statusEmoji=""),`\n      &lt;div style="padding: 10px; font-size: 12px; line-height: 1.5;"&gt;\n        &lt;div style="font-weight: bold; font-size: 13px; margin-bottom: 6px;"&gt;\n          ${statusEmoji} ${device}\n        &lt;/div&gt;\n        &lt;div style="color: #888; font-size: 11px; margin-bottom: 8px;"&gt;\n          ${timestamp}\n        &lt;/div&gt;\n        &lt;div style="background: rgba(0,0,0,0.05); padding: 8px; border-radius: 4px;"&gt;\n          ${actualValueStr}\n          &lt;div style="margin-top: 4px;"&gt;\n            &lt;strong&gt;Status:&lt;/strong&gt; &lt;span style="color: ${statusColor};"&gt;${statusText}&lt;/span&gt;&lt;br/&gt;\n            &lt;strong&gt;Deviation:&lt;/strong&gt; &lt;span style="color: ${statusColor}; font-weight: bold;"&gt;\n              ${cell.maxDeviation&gt;0?"+":""}${(100*cell.maxDeviation).toFixed(1)}%\n            &lt;/span&gt;\n          &lt;/div&gt;\n          ${cell.diagnostics.sustainedDeviation?`&lt;div style="color: ${CHART_DESIGN_TOKENS.colors.semantic.error}; margin-top: 4px;"&gt; Sustained deviation detected&lt;/div&gt;`:""}\n          ${cell.diagnostics.anomalyCount&gt;0?`&lt;div style="color: ${CHART_DESIGN_TOKENS.colors.semantic.warning}; margin-top: 4px;"&gt; ${cell.diagnostics.anomalyCount} anomalies in this period&lt;/div&gt;`:""}\n        &lt;/div&gt;\n        &lt;div style="color: ${theme.palette.text.disabled}; font-size: 10px; margin-top: 6px; padding-top: 6px; border-top: 1px solid ${theme.palette.divider};"&gt;\n          &lt;strong&gt;Aggregation:&lt;/strong&gt; ${cell.diagnostics.count} readings&lt;br/&gt;\n          &lt;strong&gt;Range:&lt;/strong&gt; ${cell.diagnostics.min.toFixed(1)}% to ${cell.diagnostics.max.toFixed(1)}%\n        &lt;/div&gt;\n      &lt;/div&gt;\n    `},[aggregatedData,chartData,deviceConfigs]),handleCellClick=reactExports.useCallback(params=&gt;{if(!params||!params.data)return;const[xIndex,yIndex]=params.value||[],timestamp=new Date(chartData.xAxis[xIndex]).getTime(),device=chartData.yAxis[yIndex];if(onCellClick){const cell=aggregatedData.find(c=&gt;c.device===device&amp;&amp;Math.abs(c.timestamp-timestamp)&lt;6e4);cell&amp;&amp;onCellClick(device,cell.timestamp,cell.maxDeviation)}},[aggregatedData,chartData,onCellClick]),gradientColors=reactExports.useMemo(()=&gt;{if(customColors)return customColors;Math.min(...aggregatedData.map(d=&gt;d.maxDeviation)),Math.max(...aggregatedData.map(d=&gt;d.maxDeviation));return((minValue,maxValue,steps=256)=&gt;generateHeatmapGradient("deviation",steps))(0,0,256)},[customColors,aggregatedData]),chartOptions=reactExports.useMemo(()=&gt;{const colors=gradientColors,isDarkMode="dark"===theme.palette.mode,options={title:title?{...CHART_DESIGN_TOKENS.title.base,text:title,textStyle:{...CHART_DESIGN_TOKENS.title.base.textStyle,color:theme.palette.text.primary}}:void 0,tooltip:{...CHART_DESIGN_TOKENS.tooltip.base,trigger:"item",formatter:tooltipFormatter,position:"top",backgroundColor:isDarkMode?"rgba(50, 50, 50, 0.95)":"rgba(255, 255, 255, 0.95)",borderColor:isDarkMode?"rgba(255, 255, 255, 0.12)":"rgba(0, 0, 0, 0.12)",textStyle:{...CHART_DESIGN_TOKENS.tooltip.base.textStyle,color:theme.palette.text.primary}},grid:{...CHART_DESIGN_TOKENS.grid.base,height:"70%",top:calculateGridTop({hasTitle:!!title,hasToolbox:!0}),right:"12%",left:"12%"},xAxis:{type:"category",data:chartData.xAxis,splitArea:{show:!0},axisLabel:{rotate:45,fontSize:11,color:theme.palette.text.secondary,formatter:value=&gt;value.length&gt;15?value.substring(0,15)+"...":value},name:"Time",nameLocation:"middle",nameGap:45,nameTextStyle:{fontSize:12,color:theme.palette.text.secondary}},yAxis:{type:"category",data:chartData.yAxis,splitArea:{show:!0},axisLabel:{fontSize:11,color:theme.palette.text.secondary,formatter:value=&gt;value.length&gt;20?value.substring(0,20)+"...":value},name:"Devices",nameLocation:"middle",nameGap:80,nameTextStyle:{fontSize:12,color:theme.palette.text.secondary}},visualMap:{...chartData.visualMap,left:"center",bottom:"5%",orient:"horizontal",itemWidth:20,itemHeight:140,text:[" High Deviation"," Normal (Green)"],textStyle:{fontSize:11,color:theme.palette.text.secondary},inRange:{color:colors}},series:[{name:"Deviation",type:"heatmap",data:chartData.data,label:{show:!1},emphasis:{itemStyle:{shadowBlur:10,shadowColor:"rgba(0, 0, 0, 0.5)"}},progressive:strategy.dataReduction&gt;90?1e4:5e3,progressiveThreshold:5e3,animation:!1}]},totalPoints=series.reduce((sum,s)=&gt;sum+s.data.length,0),animationMode=CHART_DESIGN_TOKENS.adaptive.animationMode(totalPoints);return mergeChartOptions(baseOptions,{...options,...CHART_DESIGN_TOKENS.animation[animationMode]},{showToolbox:!0,showDataZoom:strategy.dataReduction&gt;50,showLegend:!1,enableDataView:!1})},[baseOptions,title,chartData,tooltipFormatter,colorScheme,customColors,strategy,deviceConfigs,series,deviationMethod,gradientColors,theme]);if(loading)return jsxRuntimeExports.jsx(Box,{sx:{height:height,display:"flex",alignItems:"center",justifyContent:"center"},children:jsxRuntimeExports.jsx(CircularProgress,{})});if(error)return jsxRuntimeExports.jsx(Box,{sx:{height:height},children:jsxRuntimeExports.jsxs(Alert,{severity:"error",children:["Error loading heatmap data: ",error.message]})});if(!series||0===series.length)return jsxRuntimeExports.jsx(Box,{sx:{height:height},children:jsxRuntimeExports.jsx(Alert,{severity:"info",children:"No data available for the selected time range"})});const aggregationInfo=reactExports.useMemo(()=&gt;{const totalRawPoints=series.reduce((sum,s)=&gt;sum+s.data.length,0),aggregatedPoints=aggregatedData.length,compressionRatio=totalRawPoints&gt;0?100*(1-aggregatedPoints/totalRawPoints):0,pointsPerCell=totalRawPoints/aggregatedPoints;let integrity="High",integrityColor="success";return"1day"===strategy.cellResolution?(integrity="Daily Summary",integrityColor="warning"):parseInt(strategy.cellResolution)&gt;=240?(integrity="Moderate",integrityColor="info"):parseInt(strategy.cellResolution)&gt;=60&amp;&amp;(integrity="Good",integrityColor="info"),{totalRawPoints:totalRawPoints,aggregatedPoints:aggregatedPoints,compressionRatio:compressionRatio,pointsPerCell:Math.round(pointsPerCell),integrity:integrity,integrityColor:integrityColor}},[series,aggregatedData,strategy]),getResolutionText=resolution=&gt;({"5min":"5 minutes","15min":"15 minutes","30min":"30 minutes","1hour":"1 hour","2hour":"2 hours","4hour":"4 hours","8hour":"8 hours","1day":"1 day"}[resolution]||resolution);return jsxRuntimeExports.jsxs(Paper,{elevation:2,sx:{height:height,display:"flex",flexDirection:"column",background:"dark"===theme.palette.mode?"linear-gradient(145deg, rgba(30, 30, 30, 1) 0%, rgba(42, 42, 42, 1) 100%)":"linear-gradient(145deg, rgba(255, 255, 255, 1) 0%, rgba(245, 245, 245, 1) 100%)"},children:[jsxRuntimeExports.jsx(Box,{sx:{p:2,borderBottom:`1px solid ${theme.palette.divider}`,background:"dark"===theme.palette.mode?"rgba(255,255,255,0.02)":"rgba(0,0,0,0.02)"},children:jsxRuntimeExports.jsxs(Stack,{spacing:1.5,children:[jsxRuntimeExports.jsxs(Box,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[jsxRuntimeExports.jsx(Typography$1,{variant:"h6",sx:{fontWeight:500},children:title}),jsxRuntimeExports.jsx(Stack,{direction:"row",spacing:1,children:jsxRuntimeExports.jsx(Tooltip,{title:"View aggregation details",children:jsxRuntimeExports.jsx(IconButton,{size:"small",children:jsxRuntimeExports.jsx(Info,{fontSize:"small"})})})})]}),jsxRuntimeExports.jsx(Paper,{elevation:0,sx:{p:1.5,backgroundColor:"dark"===theme.palette.mode?"rgba(30, 150, 250, 0.08)":"rgba(25, 118, 210, 0.08)",border:"1px solid "+("dark"===theme.palette.mode?"rgba(30, 150, 250, 0.2)":"rgba(25, 118, 210, 0.2)")},children:jsxRuntimeExports.jsxs(Stack,{spacing:1,children:[jsxRuntimeExports.jsxs(Box,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[jsxRuntimeExports.jsx(Typography$1,{variant:"subtitle2",sx:{fontWeight:600},children:" Data Aggregation Status"}),jsxRuntimeExports.jsx(Chip,{label:aggregationInfo.integrity,size:"small",color:aggregationInfo.integrityColor,sx:{fontWeight:600}})]}),jsxRuntimeExports.jsxs(Box,{sx:{display:"flex",gap:2,flexWrap:"wrap"},children:[jsxRuntimeExports.jsxs(Typography$1,{variant:"caption",color:"text.secondary",children:[jsxRuntimeExports.jsx("strong",{children:"Resolution:"})," ",getResolutionText(strategy.cellResolution)]}),jsxRuntimeExports.jsxs(Typography$1,{variant:"caption",color:"text.secondary",children:[jsxRuntimeExports.jsx("strong",{children:"Method:"})," ","max"===strategy.aggregationMethod?"Maximum (preserves peaks)":"mean"===strategy.aggregationMethod?"Average":"95th Percentile"]}),jsxRuntimeExports.jsxs(Typography$1,{variant:"caption",color:"text.secondary",children:[jsxRuntimeExports.jsx("strong",{children:"Points per cell:"})," ~",aggregationInfo.pointsPerCell]}),aggregationInfo.compressionRatio&gt;0&amp;&amp;jsxRuntimeExports.jsxs(Typography$1,{variant:"caption",color:"text.secondary",children:[jsxRuntimeExports.jsx("strong",{children:"Compression:"})," ",aggregationInfo.compressionRatio.toFixed(1),"%"]})]}),"5min"!==strategy.cellResolution&amp;&amp;jsxRuntimeExports.jsx(Alert,{severity:"info",sx:{py:.5,"&amp; .MuiAlert-message":{py:.5}},children:jsxRuntimeExports.jsxs(Typography$1,{variant:"caption",children:[jsxRuntimeExports.jsx("strong",{children:" How aggregation works:"})," We combine ~",aggregationInfo.pointsPerCell," raw data points into each cell representing ",getResolutionText(strategy.cellResolution)," of time.","max"===strategy.aggregationMethod?" We use the MAXIMUM value to ensure no anomalies or critical deviations are hidden during aggregation.":"mean"===strategy.aggregationMethod?" We use the AVERAGE to show typical behavior over the time period.":" We use the 95th PERCENTILE to show significant deviations while filtering noise."," ",jsxRuntimeExports.jsx("strong",{children:"Green = Normal"}),", Blue = Below Target, Red/Orange = Above Target."," For full 5-minute resolution, select a time range under 7 days."]})})]})}),jsxRuntimeExports.jsxs(Box,{sx:{display:"flex",gap:1,flexWrap:"wrap"},children:[jsxRuntimeExports.jsx(Chip,{label:`Analysis: ${method=deviationMethod,{auto:"Auto (Smart Detection)",target:"Target-Based",mean:"Mean (Z-Score)",median:"Median (Robust)",minmax:"Min/Max Range",percentage:"Percentage",iqr:"IQR (Outlier Resistant)"}[method]||method}`,size:"small",variant:"outlined",sx:{fontWeight:500}}),jsxRuntimeExports.jsx(Chip,{label:`${series.length} devices`,size:"small",variant:"outlined"}),jsxRuntimeExports.jsx(Chip,{label:`${chartData.xAxis.length} time points`,size:"small",variant:"outlined"}),jsxRuntimeExports.jsx(Chip,{label:`${aggregatedData.length.toLocaleString()} cells`,size:"small",variant:"outlined"})]})]})}),jsxRuntimeExports.jsx(Box,{sx:{flexGrow:1,minHeight:0,position:"relative",p:1},children:jsxRuntimeExports.jsx(EChartsReact,{ref:chartRef,option:chartOptions,style:{height:"100%",width:"100%"},theme:theme.palette.mode,opts:{renderer:strategy.useWebGL?"canvas":"svg"},onEvents:{click:handleCellClick}})})]});var method},calculateAggregatedValue$2=(data,aggregation="latest")=&gt;{if(!DataValidation.hasValidData({data:data}))return 0;const validData=DataValidation.filterValidDataPoints(data);if(0===validData.length)return 0;const values=validData.map(([_,value])=&gt;value);switch(aggregation){case"latest":default:return validData[validData.length-1][1];case"average":return ChartStatistics.mean(values);case"max":return ChartStatistics.range(values).max;case"min":return ChartStatistics.range(values).min}},normalizeValues=(values,indicators,method)=&gt;{if(values.length!==indicators.length)return values;switch(method){case"minmax":return values.map((value,index2)=&gt;{const indicator=indicators[index2],range=indicator.max-indicator.min;return 0===range?0:(value-indicator.min)/range});case"percentage":return values.map((value,index2)=&gt;{const indicator=indicators[index2];return 0===indicator.max?0:value/indicator.max*100});case"zscore":const mean=ChartStatistics.mean(values),stdDev=ChartStatistics.standardDeviation(values);return 0===stdDev?values:values.map(value=&gt;(value-mean)/stdDev);default:return values}},EChartsRadar$1=React.memo(({data:data,series:series,metrics:metrics=[],staticData:staticData,loading:externalLoading,error:externalError,height:height="400px",title:title,shape:shape="polygon",showArea:showArea=!0,showMarkerTags:showMarkerTags=!0,groupId:groupId,chartId:chartId,customColors:customColors,onChartReady:onChartReady,selectedPoints:selectedPoints,timeRange:timeRange="24h",refreshInterval:refreshInterval,enableLiveData:enableLiveData=!1,aggregationType:aggregationType="latest",timeComparison:timeComparison,normalization:normalization={enabled:!1,method:"minmax"},autoScaleAxes:autoScaleAxes=!0,onEdit:onEdit,onDelete:onDelete})=&gt;{const theme=useTheme(),containerRef=reactExports.useRef(null),chartInstanceRef=reactExports.useRef(null),baseOptions=useBaseChartOptions(),{series:fetchedSeries,isLoading:isLoading,error:dataError}=useChartDataSimple({selectedPoints:selectedPoints||[],timeRange:timeRange,refreshInterval:refreshInterval,enabled:selectedPoints&amp;&amp;selectedPoints.length&gt;0}),dataSource=series||fetchedSeries||[],validatedData=reactExports.useMemo(()=&gt;Array.isArray(dataSource)?dataSource.filter(s=&gt;s&amp;&amp;s.data&amp;&amp;Array.isArray(s.data)&amp;&amp;s.data.length&gt;0):[],[dataSource]),finalLoading=externalLoading||isLoading,finalError=externalError||dataError,{radarConfig:radarConfig,effectiveData:effectiveData}=reactExports.useMemo(()=&gt;{if(validatedData.length&gt;0)return((timeseriesSeries,options)=&gt;{const{aggregationType:aggregationType,timeComparison:timeComparison,normalization:normalization,autoScaleAxes:autoScaleAxes=!0,showMarkerTags:showMarkerTags=!0,customMetrics:customMetrics=[]}=options;if(!timeseriesSeries||0===timeseriesSeries.length)return{radarConfig:{indicators:customMetrics,series:[]},effectiveData:[]};const indicators=timeseriesSeries.map(series=&gt;{const validData=DataValidation.filterValidDataPoints(series.data);if(0===validData.length)return{name:series.formattedName||series.name,max:100,min:0,unit:series.unit};const values=validData.map(([_,value])=&gt;value),{min:dataMin,max:dataMax}=ChartStatistics.range(values);let min=dataMin,max=dataMax;if(autoScaleAxes){const padding=.1*(max-min);min=Math.max(0,min-padding),max+=padding}return min===max&amp;&amp;(min=Math.max(0,max-1),max+=1),{name:series.formattedName||series.name,max:max,min:min,unit:series.unit}}),radarSeriesData=[];if((null==timeComparison?void 0:timeComparison.enabled)&amp;&amp;timeComparison.periods.length&gt;0)timeComparison.periods.forEach(period=&gt;{const values=timeseriesSeries.map(series=&gt;calculateAggregatedValue$2(series.data,aggregationType)),normalizedValues=(null==normalization?void 0:normalization.enabled)?normalizeValues(values,indicators,normalization.method):values;radarSeriesData.push({name:period.name,value:normalizedValues,markerTags:showMarkerTags?timeseriesSeries.flatMap(s=&gt;s.markerTags||[]):void 0})});else{const values=timeseriesSeries.map(series=&gt;calculateAggregatedValue$2(series.data,aggregationType)),normalizedValues=(null==normalization?void 0:normalization.enabled)?normalizeValues(values,indicators,normalization.method):values;if(radarSeriesData.push({name:"latest"===aggregationType?"Current Values":`${aggregationType.charAt(0).toUpperCase()+aggregationType.slice(1)} Values`,value:normalizedValues,markerTags:showMarkerTags?timeseriesSeries.flatMap(s=&gt;s.markerTags||[]):void 0}),"latest"===aggregationType){const avgValues=timeseriesSeries.map(series=&gt;calculateAggregatedValue$2(series.data,"average")),maxValues=timeseriesSeries.map(series=&gt;calculateAggregatedValue$2(series.data,"max")),normalizedAvg=(null==normalization?void 0:normalization.enabled)?normalizeValues(avgValues,indicators,normalization.method):avgValues,normalizedMax=(null==normalization?void 0:normalization.enabled)?normalizeValues(maxValues,indicators,normalization.method):maxValues;radarSeriesData.push({name:"Average Values",value:normalizedAvg,markerTags:void 0},{name:"Peak Values",value:normalizedMax,markerTags:void 0})}}const effectiveData=radarSeriesData.map(series=&gt;({name:series.name,values:series.value,markerTags:series.markerTags}));return{radarConfig:{indicators:indicators,series:radarSeriesData},effectiveData:effectiveData}})(validatedData,{aggregationType:aggregationType,timeComparison:timeComparison,normalization:normalization,autoScaleAxes:autoScaleAxes,showMarkerTags:showMarkerTags,customMetrics:metrics});if(data&amp;&amp;Array.isArray(data)&amp;&amp;data.length&gt;0){if(data[0]&amp;&amp;"object"==typeof data[0]&amp;&amp;"values"in data[0])return{radarConfig:{indicators:metrics,series:data},effectiveData:data};{const transformedRadarData=transformToRadar(data,{aggregation:aggregationType,indicators:metrics.length&gt;0?metrics:void 0,showMarkerTags:showMarkerTags});return{radarConfig:{indicators:transformedRadarData.indicators,series:transformedRadarData.series},effectiveData:transformedRadarData.series.map(seriesItem=&gt;({name:seriesItem.formattedName||seriesItem.name,values:seriesItem.value,markerTags:seriesItem.markerTags,pointMetadata:seriesItem.pointMetadata}))}}}return{radarConfig:{indicators:metrics,series:staticData||[]},effectiveData:staticData||[]}},[validatedData,data,staticData,metrics,aggregationType,timeComparison,normalization,autoScaleAxes,showMarkerTags]),indicators=radarConfig.indicators||metrics||[],radarSeries=radarConfig.series||effectiveData,distinctColors=customColors||getDistinctColors(effectiveData.length);reactExports.useEffect(()=&gt;{const handleResize=()=&gt;{chartInstanceRef.current&amp;&amp;chartInstanceRef.current.resize()},handleGridResize=()=&gt;{chartInstanceRef.current&amp;&amp;chartInstanceRef.current.resize()};return window.addEventListener("resize",handleResize),window.addEventListener("grid-resize",handleGridResize),()=&gt;{window.removeEventListener("resize",handleResize),window.removeEventListener("grid-resize",handleGridResize)}},[]);const option=reactExports.useMemo(()=&gt;{const totalPoints=radarSeries.reduce((sum,point)=&gt;{var _a;return sum+((null==(_a=point.values)?void 0:_a.length)||0)},0),animationMode=CHART_DESIGN_TOKENS.adaptive.animationMode(totalPoints),isDarkMode="dark"===theme.palette.mode,processedData=radarSeries.map(point=&gt;{if(point.timeseriesData&amp;&amp;point.timeseriesData.length&gt;0){const values=indicators.map(metric=&gt;{const tsData=point.timeseriesData.find(ts=&gt;ts.metricName===metric.name);return tsData?calculateAggregatedValue$2(tsData.data,tsData.aggregation):0});return{...point,values:values}}return point}),radarSpecificOptions={title:title?{...CHART_DESIGN_TOKENS.title.base,text:title,textStyle:{...CHART_DESIGN_TOKENS.title.base.textStyle,color:theme.palette.text.primary}}:void 0,tooltip:{...CHART_DESIGN_TOKENS.tooltip.base,trigger:"item",backgroundColor:isDarkMode?"rgba(50, 50, 50, 0.95)":"rgba(255, 255, 255, 0.95)",borderColor:isDarkMode?"rgba(255, 255, 255, 0.12)":"rgba(0, 0, 0, 0.12)",textStyle:{...CHART_DESIGN_TOKENS.tooltip.base.textStyle,color:theme.palette.text.primary},formatter:params=&gt;{const dataIndex=params.dataIndex,seriesName=params.seriesName,values=params.value,originalPoint=processedData[dataIndex],markerTags=(null==originalPoint?void 0:originalPoint.markerTags)||[];let tooltip=`&lt;strong&gt;${seriesName}&lt;/strong&gt;&lt;br/&gt;`;return markerTags.length&gt;0&amp;&amp;(tooltip+=`&lt;span style="color: #888; font-size: 0.9em;"&gt;Tags: ${markerTags.join(", ")}&lt;/span&gt;&lt;br/&gt;`),indicators.forEach((metric,index2)=&gt;{const value=values[index2],percentage=(value/metric.max*100).toFixed(1);tooltip+=`${metric.name}: ${formatNumberForDisplay(value,2)} ${metric.unit||""} (${percentage}%)&lt;br/&gt;`}),tooltip}},legend:{data:processedData.map(d=&gt;showMarkerTags&amp;&amp;d.markerTags&amp;&amp;d.markerTags.length&gt;0?formatPointWithTags({id:d.name,name:d.name,markerTags:d.markerTags},{maxTags:2,includeUnit:!1}):d.name),bottom:20,textStyle:{color:theme.palette.text.secondary}},radar:{indicator:indicators.map(metric=&gt;({name:metric.name,max:metric.max,min:metric.min||0,axisLabel:{show:!0,formatter:value=&gt;formatNumberForDisplay(value,0)+(metric.unit?` ${metric.unit}`:"")}})),shape:shape,splitNumber:5,axisName:{color:theme.palette.text.secondary,fontSize:12},splitLine:{lineStyle:{color:theme.palette.divider,opacity:.3}},splitArea:{show:!0,areaStyle:{color:"dark"===theme.palette.mode?["rgba(255, 255, 255, 0.02)","rgba(255, 255, 255, 0.05)"]:["rgba(0, 0, 0, 0.02)","rgba(0, 0, 0, 0.05)"]}},axisLine:{lineStyle:{color:theme.palette.divider}}},series:[{type:"radar",data:processedData.map((point,index2)=&gt;({name:showMarkerTags&amp;&amp;point.markerTags&amp;&amp;point.markerTags.length&gt;0?formatPointWithTags({id:point.name,name:point.name,markerTags:point.markerTags},{maxTags:2,includeUnit:!1}):point.name,value:point.values||point.value,symbol:"circle",symbolSize:6,lineStyle:{width:2.5,color:distinctColors[index2%distinctColors.length],type:"solid",opacity:1},itemStyle:{color:distinctColors[index2%distinctColors.length],opacity:1},areaStyle:showArea?{color:distinctColors[index2%distinctColors.length],opacity:.2}:void 0,emphasis:{lineStyle:{width:4,opacity:1},itemStyle:{opacity:1},areaStyle:showArea?{opacity:.4}:void 0}}))}],aria:{enabled:!0,label:{enabled:!0,description:`Radar chart comparing ${processedData.map(d=&gt;d.name).join(", ")} across ${indicators.map(m=&gt;m.name).join(", ")}`}},...CHART_DESIGN_TOKENS.animation[animationMode]};return mergeChartOptions(baseOptions,radarSpecificOptions,{showToolbox:true,enableDataView:!1,enableMagicType:!1,showDataZoom:!1,showLegend:!0})},[baseOptions,indicators,radarSeries,title,theme,shape,showArea,distinctColors,true,onEdit,onDelete]);return reactExports.useMemo(()=&gt;Array.isArray(radarSeries)?radarSeries.filter(item=&gt;item&amp;&amp;"string"==typeof item.name&amp;&amp;(Array.isArray(item.values)||Array.isArray(item.value)||Array.isArray(item.timeseriesData))):[],[radarSeries]),reactExports.useMemo(()=&gt;Array.isArray(indicators)?indicators.filter(indicator=&gt;indicator&amp;&amp;"string"==typeof indicator.name&amp;&amp;"number"==typeof indicator.max):[],[indicators]),jsxRuntimeExports.jsx(Box,{ref:containerRef,sx:{position:"relative",height:height,width:"100%",overflow:"hidden"},children:jsxRuntimeExports.jsx(EChartsWrapper,{option:option,loading:finalLoading,error:finalError,height:"100%",theme:"dark"===theme.palette.mode?"dark":"light",onChartReady:chart=&gt;{chartInstanceRef.current=chart,chartId&amp;&amp;registerChartForActions(chartId,chart),groupId&amp;&amp;chartId&amp;&amp;addChartToGroup(chart,groupId),onChartReady&amp;&amp;onChartReady(chart)}})})},(prevProps,nextProps)=&gt;{var _a,_b;if(prevProps.loading!==nextProps.loading||prevProps.error!==nextProps.error||prevProps.height!==nextProps.height||prevProps.title!==nextProps.title||prevProps.shape!==nextProps.shape||prevProps.showArea!==nextProps.showArea||prevProps.groupId!==nextProps.groupId||prevProps.chartId!==nextProps.chartId)return!1;if(prevProps.metrics!==nextProps.metrics){if(prevProps.metrics.length!==nextProps.metrics.length)return!1;for(let i=0;i&lt;prevProps.metrics.length;i++){const prevMetric=prevProps.metrics[i],nextMetric=nextProps.metrics[i];if(prevMetric.name!==nextMetric.name||prevMetric.max!==nextMetric.max||prevMetric.min!==nextMetric.min||prevMetric.unit!==nextMetric.unit)return!1}}if(prevProps.data!==nextProps.data||prevProps.series!==nextProps.series)return!1;if(prevProps.staticData!==nextProps.staticData){const prevDataLength=(null==(_a=prevProps.staticData)?void 0:_a.length)||0,nextDataLength=(null==(_b=nextProps.staticData)?void 0:_b.length)||0;if(prevDataLength&gt;20||nextDataLength&gt;20)return!1;if(prevDataLength!==nextDataLength)return!1;if(prevProps.staticData&amp;&amp;nextProps.staticData)for(let i=0;i&lt;prevProps.staticData.length;i++){const prevPoint=prevProps.staticData[i],nextPoint=nextProps.staticData[i];if(prevPoint.name!==nextPoint.name||prevPoint.values!==nextPoint.values||prevPoint.timeseriesData!==nextPoint.timeseriesData)return!1}}if(prevProps.selectedPoints!==nextProps.selectedPoints||prevProps.timeRange!==nextProps.timeRange||prevProps.refreshInterval!==nextProps.refreshInterval||prevProps.enableLiveData!==nextProps.enableLiveData||prevProps.pointToMetricMapping!==nextProps.pointToMetricMapping)return!1;if(prevProps.customColors!==nextProps.customColors){if(!prevProps.customColors||!nextProps.customColors)return!1;if(prevProps.customColors.length!==nextProps.customColors.length)return!1;for(let i=0;i&lt;prevProps.customColors.length;i++)if(prevProps.customColors[i]!==nextProps.customColors[i])return!1}return prevProps.onChartReady===nextProps.onChartReady}),EChartsBoxPlot$1=React.memo(({data:data,loading:loading=!1,error:error=null,height:height=400,title:title,yAxisLabel:yAxisLabel,unit:unit="",showMean:showMean=!0,thresholds:thresholds,enableToolbox:enableToolbox=!0,showDataZoom:showDataZoom=!0,groupId:groupId,chartId:chartId,customColors:customColors,onChartReady:onChartReady,showMarkerTags:showMarkerTags=!0,onEdit:onEdit,onDelete:onDelete})=&gt;{const theme=useTheme(),baseOptions=useBaseChartOptions(),containerRef=reactExports.useRef(null),chartInstanceRef=reactExports.useRef(null),[focusedCategory,setFocusedCategory]=reactExports.useState(0),[focusedLayer,setFocusedLayer]=reactExports.useState("median"),[announcement,setAnnouncement]=reactExports.useState("");useChartKeyboardShortcuts$1(chartInstanceRef,{enableZoom:showDataZoom,enablePan:showDataZoom,enableReset:!0,zoomSpeed:.1,panSpeed:5});const processedBoxPlotData=reactExports.useMemo(()=&gt;data&amp;&amp;0!==data.length?data.map(series=&gt;({name:series.name,timeseriesData:series.data,unit:series.unit,markerTags:series.markerTags})):[],[data]),finalData=processedBoxPlotData,finalLoading=loading,finalError=error,distinctColors=customColors||getDistinctColors(finalData.length),layerOrder=showMean?["outliers","max","q3","median","mean","q1","min"]:["outliers","max","q3","median","q1","min"],announceBoxPlotLayer=reactExports.useCallback((categoryIndex,layer,stats)=&gt;{var _a;const category=processedBoxPlotData[categoryIndex];if(!category||!stats)return;const displayUnit=category.unit||unit||"",categoryName=category.name,interpretation=(layer=&gt;{switch(layer){case"min":return"Minimum value within 1.5 times the interquartile range";case"q1":return"First quartile - 25% of values fall below this";case"median":return"Median - the middle value of the distribution";case"mean":return"Mean - the arithmetic average of all values";case"q3":return"Third quartile - 75% of values fall below this";case"max":return"Maximum value within 1.5 times the interquartile range";case"outliers":return"Outliers - values beyond 1.5 times the interquartile range";default:return""}})(layer);let message="";switch(layer){case"min":message=`${categoryName}, Minimum: ${formatNumberForDisplay(stats.min)} ${displayUnit}. ${interpretation}.`;break;case"q1":message=`${categoryName}, First quartile: ${formatNumberForDisplay(stats.q1)} ${displayUnit}. ${interpretation}.`;break;case"median":message=`${categoryName}, Median: ${formatNumberForDisplay(stats.median)} ${displayUnit}. ${interpretation}.`;break;case"mean":showMean&amp;&amp;(message=`${categoryName}, Mean: ${formatNumberForDisplay(stats.mean)} ${displayUnit}. ${interpretation}.`);break;case"q3":message=`${categoryName}, Third quartile: ${formatNumberForDisplay(stats.q3)} ${displayUnit}. ${interpretation}.`;break;case"max":message=`${categoryName}, Maximum: ${formatNumberForDisplay(stats.max)} ${displayUnit}. ${interpretation}.`;break;case"outliers":const outlierCount=(null==(_a=stats.outliers)?void 0:_a.length)||0;if(outlierCount&gt;0){message=`${categoryName}, ${outlierCount} outlier${outlierCount&gt;1?"s":""} detected. ${interpretation}. Values: ${stats.outliers.slice(0,5).map(v=&gt;formatNumberForDisplay(v)).join(", ")}${outlierCount&gt;5?`, and ${outlierCount-5} more`:""}.`}else message=`${categoryName}, No outliers detected.`}setAnnouncement(message)},[processedBoxPlotData,unit,showMean]),announceSummaryStatistics=reactExports.useCallback((categoryIndex,stats)=&gt;{var _a,_b;const category=processedBoxPlotData[categoryIndex];if(!category||!stats)return;const displayUnit=category.unit||unit||"",sampleSize=(null==(_a=category.timeseriesData)?void 0:_a.length)||0,outlierCount=(null==(_b=stats.outliers)?void 0:_b.length)||0,range=stats.max-stats.min,iqr=stats.q3-stats.q1,summary=`\n      ${category.name} summary statistics.\n      Sample size: ${sampleSize} data points.\n      Median: ${formatNumberForDisplay(stats.median)} ${displayUnit}.\n      Mean: ${formatNumberForDisplay(stats.mean)} ${displayUnit}.\n      Range: ${formatNumberForDisplay(stats.min)} to ${formatNumberForDisplay(stats.max)} ${displayUnit}. Total spread: ${formatNumberForDisplay(range)} ${displayUnit}.\n      Interquartile range: ${formatNumberForDisplay(iqr)} ${displayUnit}. This represents the middle 50% of data.\n      First quartile: ${formatNumberForDisplay(stats.q1)} ${displayUnit}. Third quartile: ${formatNumberForDisplay(stats.q3)} ${displayUnit}.\n      ${outlierCount&gt;0?`${outlierCount} outlier${outlierCount&gt;1?"s":""} detected beyond 1.5 times the interquartile range.`:"No outliers detected."}\n      ${stats.mean&gt;stats.median?"Distribution is positively skewed, with more high values.":stats.mean&lt;stats.median?"Distribution is negatively skewed, with more low values.":"Distribution is approximately symmetric."}\n    `.replace(/\n\s+/g," ").trim();setAnnouncement(summary)},[processedBoxPlotData,unit]),handleStatisticalKeyboard=reactExports.useCallback(e2=&gt;{const categoryCount=processedBoxPlotData.length;if(0===categoryCount)return;const currentLayerIndex=layerOrder.indexOf(focusedLayer);switch(e2.key.toLowerCase()){case"arrowright":e2.preventDefault();const nextCategory=Math.min(focusedCategory+1,categoryCount-1);setFocusedCategory(nextCategory);const nextCategoryData=boxPlotStatistics[nextCategory];(null==nextCategoryData?void 0:nextCategoryData.statistics)&amp;&amp;announceBoxPlotLayer(nextCategory,focusedLayer,nextCategoryData.statistics);break;case"arrowleft":e2.preventDefault();const prevCategory=Math.max(focusedCategory-1,0);setFocusedCategory(prevCategory);const prevCategoryData=boxPlotStatistics[prevCategory];(null==prevCategoryData?void 0:prevCategoryData.statistics)&amp;&amp;announceBoxPlotLayer(prevCategory,focusedLayer,prevCategoryData.statistics);break;case"arrowup":e2.preventDefault();const prevLayer=Math.max(currentLayerIndex-1,0);setFocusedLayer(layerOrder[prevLayer]);const upCategoryData=boxPlotStatistics[focusedCategory];(null==upCategoryData?void 0:upCategoryData.statistics)&amp;&amp;announceBoxPlotLayer(focusedCategory,layerOrder[prevLayer],upCategoryData.statistics);break;case"arrowdown":e2.preventDefault();const nextLayer=Math.min(currentLayerIndex+1,layerOrder.length-1);setFocusedLayer(layerOrder[nextLayer]);const downCategoryData=boxPlotStatistics[focusedCategory];(null==downCategoryData?void 0:downCategoryData.statistics)&amp;&amp;announceBoxPlotLayer(focusedCategory,layerOrder[nextLayer],downCategoryData.statistics);break;case"enter":e2.preventDefault();const enterCategoryData=boxPlotStatistics[focusedCategory];(null==enterCategoryData?void 0:enterCategoryData.statistics)&amp;&amp;announceBoxPlotLayer(focusedCategory,focusedLayer,enterCategoryData.statistics);break;case"s":e2.preventDefault();const summaryCategoryData=boxPlotStatistics[focusedCategory];(null==summaryCategoryData?void 0:summaryCategoryData.statistics)&amp;&amp;announceSummaryStatistics(focusedCategory,summaryCategoryData.statistics);break;case"home":e2.preventDefault(),setFocusedCategory(0),setFocusedLayer("median");const firstCategoryData=boxPlotStatistics[0];(null==firstCategoryData?void 0:firstCategoryData.statistics)&amp;&amp;announceBoxPlotLayer(0,"median",firstCategoryData.statistics);break;case"end":e2.preventDefault();const lastCategoryIndex=categoryCount-1;setFocusedCategory(lastCategoryIndex),setFocusedLayer("median");const lastCategoryData=boxPlotStatistics[lastCategoryIndex];(null==lastCategoryData?void 0:lastCategoryData.statistics)&amp;&amp;announceBoxPlotLayer(lastCategoryIndex,"median",lastCategoryData.statistics)}},[focusedCategory,focusedLayer,processedBoxPlotData,layerOrder,announceBoxPlotLayer,announceSummaryStatistics]);reactExports.useEffect(()=&gt;{const handleResize=()=&gt;{chartInstanceRef.current&amp;&amp;chartInstanceRef.current.resize()},handleGridResize=()=&gt;{chartInstanceRef.current&amp;&amp;chartInstanceRef.current.resize()};return window.addEventListener("resize",handleResize),window.addEventListener("grid-resize",handleGridResize),()=&gt;{window.removeEventListener("resize",handleResize),window.removeEventListener("grid-resize",handleGridResize)}},[]);const boxPlotStatistics=reactExports.useMemo(()=&gt;finalData.map(point=&gt;{let values;if(point.timeseriesData&amp;&amp;point.timeseriesData.length&gt;0){const rawValues=point.timeseriesData.map(([_,value])=&gt;[0,value]);values=DataValidation.filterValidDataPoints(rawValues).map(([_,v])=&gt;v)}else if(point.data&amp;&amp;Array.isArray(point.data)){if(5===point.data.length&amp;&amp;point.data.every(v=&gt;"number"==typeof v))return{...point,values:point.data,outliers:point.outliers||[],isPreCalculated:!0,statistics:null};{const rawValues=point.data.map((v,i)=&gt;[i,v]);values=DataValidation.filterValidDataPoints(rawValues).map(([_,v])=&gt;v)}}else values=[];const statistics=values.length&gt;0?(values=&gt;{if(!DataValidation.hasValidData({data:values}))return{min:0,q1:0,median:0,q3:0,max:0,mean:0,outliers:[]};const filteredValues=DataValidation.filterValidDataPoints(values.map((v,i)=&gt;[i,v])).map(([_,v])=&gt;v);if(0===filteredValues.length)return{min:0,q1:0,median:0,q3:0,max:0,mean:0,outliers:[]};const quartiles=ChartStatistics.quartiles(filteredValues),mean=ChartStatistics.mean(filteredValues),range=ChartStatistics.range(filteredValues),iqr=quartiles.q3-quartiles.q1,lowerBound=quartiles.q1-1.5*iqr,upperBound=quartiles.q3+1.5*iqr,outliers=filteredValues.filter(v=&gt;v&lt;lowerBound||v&gt;upperBound),whiskerMin=Math.max(range.min,lowerBound),whiskerMax=Math.min(range.max,upperBound);return{min:whiskerMin,q1:quartiles.q1,median:quartiles.q2,q3:quartiles.q3,max:whiskerMax,mean:mean,outliers:outliers}})(values):null;return{...point,values:values,outliers:(null==statistics?void 0:statistics.outliers)||[],isPreCalculated:!1,statistics:statistics}}),[finalData]),processedData=reactExports.useMemo(()=&gt;boxPlotStatistics,[boxPlotStatistics]),option=reactExports.useMemo(()=&gt;{const isDarkMode="dark"===theme.palette.mode,totalPoints=processedData.reduce((sum,d)=&gt;{var _a;return d.isPreCalculated?sum+1:sum+((null==(_a=d.values)?void 0:_a.length)||0)},0),animationMode=CHART_DESIGN_TOKENS.adaptive.animationMode(totalPoints),titleOptions=title?{...CHART_DESIGN_TOKENS.title.base,text:title,textStyle:{...CHART_DESIGN_TOKENS.title.base.textStyle,color:theme.palette.text.primary}}:void 0,tooltipOptions={...CHART_DESIGN_TOKENS.tooltip.base,backgroundColor:isDarkMode?"rgba(50, 50, 50, 0.95)":"rgba(255, 255, 255, 0.95)",borderColor:isDarkMode?"rgba(255, 255, 255, 0.12)":"rgba(0, 0, 0, 0.12)",textStyle:{...CHART_DESIGN_TOKENS.tooltip.base.textStyle,color:theme.palette.text.primary},trigger:"item",formatter:function(params){if("boxplot"===params.componentType){const stats=params.data,categoryIndex=params.dataIndex,dataPoint=processedData[categoryIndex],displayUnit=(null==dataPoint?void 0:dataPoint.unit)||unit||"";let tooltipHtml=`\n          &lt;div style="padding: 8px;"&gt;\n            &lt;strong&gt;${params.name}&lt;/strong&gt;&lt;br/&gt;`;return(null==dataPoint?void 0:dataPoint.markerTags)&amp;&amp;dataPoint.markerTags.length&gt;0&amp;&amp;(tooltipHtml+=`&lt;span style="color: #888; font-size: 11px;"&gt;Tags: ${dataPoint.markerTags.join(", ")}&lt;/span&gt;&lt;br/&gt;`),tooltipHtml+=`\n            Max: ${formatNumberForDisplay(stats[4])} ${displayUnit}&lt;br/&gt;\n            Q3: ${formatNumberForDisplay(stats[3])} ${displayUnit}&lt;br/&gt;\n            Median: ${formatNumberForDisplay(stats[2])} ${displayUnit}&lt;br/&gt;\n            Q1: ${formatNumberForDisplay(stats[1])} ${displayUnit}&lt;br/&gt;\n            Min: ${formatNumberForDisplay(stats[0])} ${displayUnit}\n            ${showMean&amp;&amp;stats.length&gt;5?`&lt;br/&gt;Mean: ${formatNumberForDisplay(stats[5])} ${displayUnit}`:""}\n          &lt;/div&gt;\n        `,tooltipHtml}if("scatter"===params.componentType){const categoryIndex=params.data[0],dataPoint=processedData[categoryIndex],displayUnit=(null==dataPoint?void 0:dataPoint.unit)||unit||"";return"Mean"===params.seriesName?`\n            &lt;div style="padding: 8px;"&gt;\n              &lt;strong&gt;${params.name}&lt;/strong&gt;&lt;br/&gt;\n              Mean: ${formatNumberForDisplay(params.data[1])} ${displayUnit}\n            &lt;/div&gt;\n          `:`\n            &lt;div style="padding: 8px;"&gt;\n              &lt;strong&gt;${params.name}&lt;/strong&gt;&lt;br/&gt;\n              Outlier: ${formatNumberForDisplay(params.data[1])} ${displayUnit}\n            &lt;/div&gt;\n          `}return""}},gridOptions={...CHART_DESIGN_TOKENS.grid.base,top:calculateGridTop({hasTitle:!!title,hasToolbox:!0}),left:"10%",right:"5%",bottom:"15%",containLabel:!0},xAxisOptions=buildXAxis({data:processedData.map(d=&gt;{if(showMarkerTags&amp;&amp;d.markerTags&amp;&amp;d.markerTags.length&gt;0){const pointMetadata={id:d.name,name:d.name,markerTags:d.markerTags,unit:d.unit};return formatPointWithTags(pointMetadata)}return d.name}),axisLabel:{color:theme.palette.text.secondary}}),yAxisOptions=buildYAxis({axisLabel:{color:theme.palette.text.secondary},splitLine:{lineStyle:{color:theme.palette.divider}}});return combineOptions(baseOptions,{...CHART_DESIGN_TOKENS.animation[animationMode],title:titleOptions,tooltip:tooltipOptions,grid:gridOptions,xAxis:xAxisOptions,yAxis:yAxisOptions,series:[{name:"Box Plot",type:"boxplot",data:processedData.map(d=&gt;{if(d.isPreCalculated&amp;&amp;5===d.values.length){const boxData=[...d.values];return showMean&amp;&amp;d.values.length&gt;5&amp;&amp;boxData.push(d.values[5]),boxData}{const stats=d.statistics,boxData=[stats.min,stats.q1,stats.median,stats.q3,stats.max];return showMean&amp;&amp;boxData.push(stats.mean),boxData}}),itemStyle:{color:theme.palette.primary.main,borderColor:theme.palette.primary.dark},emphasis:{itemStyle:{borderWidth:2,shadowBlur:10,shadowColor:"dark"===theme.palette.mode?"rgba(255, 255, 255, 0.2)":"rgba(0, 0, 0, 0.2)"}}},{name:"Outliers",type:"scatter",data:processedData.flatMap((d,categoryIndex)=&gt;{var _a;if(d.isPreCalculated){return(d.outliers||[]).map(outlier=&gt;[categoryIndex,outlier])}return((null==(_a=d.statistics)?void 0:_a.outliers)||[]).map(outlier=&gt;[categoryIndex,outlier])}),symbolSize:8,itemStyle:{color:theme.palette.error.main,opacity:.8}},...showMean?[{name:"Mean",type:"scatter",data:processedData.map((d,index2)=&gt;{var _a;return d.isPreCalculated&amp;&amp;d.values.length&gt;5?[index2,d.values[5]]:[index2,(null==(_a=d.statistics)?void 0:_a.mean)||0]}),symbol:"diamond",symbolSize:10,itemStyle:{color:theme.palette.secondary.main},z:3}]:[]],aria:{enabled:!0,decal:{show:!0},label:{enabled:!0,description:generateAriaLabel(),general:{withTitle:`This is a box plot chart${title?` titled ${title}`:""} showing statistical distributions.`,withoutTitle:"This is a box plot chart showing statistical distributions."}}}},{showToolbox:enableToolbox,enableDataView:!0,enableMagicType:!1,showDataZoom:showDataZoom,showLegend:!0,onEdit:onEdit,onDelete:onDelete})},[processedData,title,theme,showMean,unit,yAxisLabel,distinctColors,showMarkerTags,baseOptions,enableToolbox,showDataZoom,generateAriaLabel]),finalOption=processedData.reduce((sum,d)=&gt;{var _a;return d.isPreCalculated?sum+1:sum+((null==(_a=d.values)?void 0:_a.length)||0)},0)&gt;1e4||processedData.length&gt;100?getOptimizedChartOptions(option,{dataSize:Math.max(...processedData.map(d=&gt;d.values.length)),seriesCount:processedData.length,enableProgressive:!0,enableLargeMode:!1,enableDataSampling:!1}):option;reactExports.useMemo(()=&gt;Array.isArray(finalData)?finalData.filter(item=&gt;item&amp;&amp;"string"==typeof item.name&amp;&amp;(Array.isArray(item.data)||Array.isArray(item.timeseriesData))&amp;&amp;(item.data&amp;&amp;item.data.length&gt;0||item.timeseriesData&amp;&amp;item.timeseriesData.length&gt;0)):[],[finalData]);const generateAriaLabel=reactExports.useCallback(()=&gt;{if(!processedData||0===processedData.length)return`Box plot chart${title?` titled ${title}`:""}. No data available.`;const categoryCount=processedData.length,categoryNames=processedData.map(d=&gt;d.name).join(", "),allStats=processedData.map(d=&gt;d.statistics).filter(Boolean);if(0===allStats.length)return`Box plot chart${title?` titled ${title}`:""} with ${categoryCount} categories: ${categoryNames}. Statistical data is being calculated.`;const overallMin=Math.min(...allStats.map(s=&gt;s.min)),overallMax=Math.max(...allStats.map(s=&gt;s.max)),overallMedian=allStats.reduce((sum,s)=&gt;sum+s.median,0)/allStats.length,totalOutliers=allStats.reduce((sum,s)=&gt;{var _a;return sum+((null==(_a=s.outliers)?void 0:_a.length)||0)},0);return`Box plot chart${title?` titled ${title}`:""} showing distribution of ${categoryCount} categories: ${categoryNames}.\n      Overall statistics: Range from ${formatNumberForDisplay(overallMin)} to ${formatNumberForDisplay(overallMax)} ${unit}.\n      Average median: ${formatNumberForDisplay(overallMedian)} ${unit}.\n      Total outliers detected: ${totalOutliers}.\n      Use arrow keys to navigate between categories and statistical layers.\n      Press S for detailed summary statistics.\n      Press Enter to repeat current value.\n      Press Home to go to first category, End to go to last category.`},[processedData,title,unit]);return jsxRuntimeExports.jsxs(Box,{ref:containerRef,sx:{position:"relative",height:height,width:"100%",overflow:"hidden"},role:"application","aria-label":generateAriaLabel(),tabIndex:0,onKeyDown:handleStatisticalKeyboard,children:[jsxRuntimeExports.jsx(EChartsWrapper,{error:finalError,height:"100%",loading:finalLoading,option:finalOption,theme:theme.palette.mode,onChartReady:chart=&gt;{chartInstanceRef.current=chart,chartId&amp;&amp;registerChartForActions(chartId,chart),groupId&amp;&amp;chartId&amp;&amp;addChartToGroup(chart,groupId),onChartReady&amp;&amp;onChartReady(chart)}}),jsxRuntimeExports.jsx("div",{role:"status","aria-live":"polite","aria-atomic":"true",style:{position:"absolute",left:"-10000px",width:"1px",height:"1px",overflow:"hidden"},children:announcement}),jsxRuntimeExports.jsxs("div",{style:{position:"absolute",left:"-10000px",width:"1px",height:"1px",overflow:"hidden"},children:[jsxRuntimeExports.jsx("p",{children:"Box plot navigation instructions:"}),jsxRuntimeExports.jsxs("ul",{children:[jsxRuntimeExports.jsx("li",{children:"Arrow Left/Right: Navigate between categories"}),jsxRuntimeExports.jsxs("li",{children:["Arrow Up/Down: Navigate between statistical layers (outliers, max, Q3, median, ",showMean?"mean, ":"","Q1, min)"]}),jsxRuntimeExports.jsx("li",{children:"Enter: Repeat current statistical value"}),jsxRuntimeExports.jsx("li",{children:"S key: Announce complete summary statistics for current category"}),jsxRuntimeExports.jsx("li",{children:"Home: Jump to first category"}),jsxRuntimeExports.jsx("li",{children:"End: Jump to last category"})]})]})]})},(prevProps,nextProps)=&gt;{if(prevProps.loading!==nextProps.loading||prevProps.error!==nextProps.error||prevProps.height!==nextProps.height||prevProps.title!==nextProps.title||prevProps.yAxisLabel!==nextProps.yAxisLabel||prevProps.unit!==nextProps.unit||prevProps.showMean!==nextProps.showMean||prevProps.enableToolbox!==nextProps.enableToolbox||prevProps.showDataZoom!==nextProps.showDataZoom||prevProps.groupId!==nextProps.groupId||prevProps.chartId!==nextProps.chartId)return!1;if(prevProps.data!==nextProps.data)return!1;if(prevProps.thresholds!==nextProps.thresholds){if(!prevProps.thresholds||!nextProps.thresholds)return!1;if(prevProps.thresholds.length!==nextProps.thresholds.length)return!1;for(let i=0;i&lt;prevProps.thresholds.length;i++){const prevThreshold=prevProps.thresholds[i],nextThreshold=nextProps.thresholds[i];if(prevThreshold.value!==nextThreshold.value||prevThreshold.name!==nextThreshold.name||prevThreshold.color!==nextThreshold.color)return!1}}if(prevProps.customColors!==nextProps.customColors){if(!prevProps.customColors||!nextProps.customColors)return!1;if(prevProps.customColors.length!==nextProps.customColors.length)return!1;for(let i=0;i&lt;prevProps.customColors.length;i++)if(prevProps.customColors[i]!==nextProps.customColors[i])return!1}return prevProps.onChartReady===nextProps.onChartReady}),EChartsCandlestick$1=React.memo(({data:data,loading:loading=!1,error:error=null,height:height=400,width:width="100%",title:title,yAxisLabel:yAxisLabel,unit:unit="",showVolume:showVolume=!1,interval:interval="hourly",thresholds:thresholds,enableToolbox:enableToolbox=!0,timeRange:timeRange,selectedPoints:selectedPoints,onChartReady:onChartReady,onEdit:onEdit,onDelete:onDelete,...restProps})=&gt;{const theme=useTheme(),baseOptions=useBaseChartOptions(),containerRef=reactExports.useRef(null),chartInstanceRef=reactExports.useRef(null);reactExports.useEffect(()=&gt;{const handleResize=()=&gt;{chartInstanceRef.current&amp;&amp;chartInstanceRef.current.resize()},handleGridResize=()=&gt;{chartInstanceRef.current&amp;&amp;chartInstanceRef.current.resize()};return window.addEventListener("resize",handleResize),window.addEventListener("grid-resize",handleGridResize),()=&gt;{window.removeEventListener("resize",handleResize),window.removeEventListener("grid-resize",handleGridResize)}},[]);const candlestickData=reactExports.useMemo(()=&gt;{if(!data||0===data.length)return[];const allPoints=data.flatMap(series=&gt;series.data.map(([timestamp,value])=&gt;({timestamp:timestamp,value:value})));allPoints.sort((a,b)=&gt;a.timestamp-b.timestamp);const intervalMs=(interval2=&gt;{switch(interval2){case"hourly":default:return 36e5;case"daily":return 864e5;case"weekly":return 6048e5}})(interval),grouped=new Map;return allPoints.forEach(({timestamp:timestamp,value:value})=&gt;{if(!timestamp||isNaN(new Date(timestamp).getTime()))return void console.warn("Invalid timestamp in data:",timestamp);const intervalStart=Math.floor(timestamp/intervalMs)*intervalMs;grouped.has(intervalStart)||grouped.set(intervalStart,[]),grouped.get(intervalStart).push(value)}),Array.from(grouped.entries()).map(([timestamp,values])=&gt;({timestamp:timestamp,open:values[0],high:Math.max(...values),low:Math.min(...values),close:values[values.length-1],volume:values.length}))},[data,interval]),formatTime2=timestamp=&gt;{if(!timestamp||isNaN(timestamp)||!isFinite(timestamp))return console.warn("Invalid timestamp:",timestamp),"";try{const date=new Date(timestamp);if(isNaN(date.getTime()))return console.warn("Invalid timestamp produces invalid date:",timestamp),"";switch(interval){case"hourly":default:return format$1(date,"MMM d, h:mm a");case"daily":return format$1(date,"MMM d");case"weekly":return format$1(date,"MMM d, yyyy")}}catch(error2){return console.warn("Invalid timestamp for formatting:",timestamp,error2),""}},echartsData=candlestickData.map(d=&gt;({value:[d.open,d.close,d.low,d.high],timestamp:d.timestamp})),volumeData=showVolume?candlestickData.map(d=&gt;d.volume||0):[],totalDataPoints=candlestickData.length,useWebGL=totalDataPoints&gt;1e4;reactExports.useEffect(()=&gt;{},[useWebGL,totalDataPoints]);const option=reactExports.useMemo(()=&gt;{const isDarkMode="dark"===theme.palette.mode,totalPoints=candlestickData.length,animationMode=CHART_DESIGN_TOKENS.adaptive.animationMode(totalPoints),candlestickSpecificOptions={...CHART_DESIGN_TOKENS.animation[animationMode],title:title?{...CHART_DESIGN_TOKENS.title.base,text:title,textStyle:{...CHART_DESIGN_TOKENS.title.base.textStyle,color:theme.palette.text.primary}}:void 0,tooltip:{...CHART_DESIGN_TOKENS.tooltip.base,backgroundColor:isDarkMode?"rgba(50, 50, 50, 0.95)":"rgba(255, 255, 255, 0.95)",borderColor:isDarkMode?"rgba(255, 255, 255, 0.12)":"rgba(0, 0, 0, 0.12)",textStyle:{...CHART_DESIGN_TOKENS.tooltip.base.textStyle,color:theme.palette.text.primary},trigger:"axis",axisPointer:{type:"cross",lineStyle:{color:theme.palette.divider}},formatter:function(params){var _a;const dataIndex=params[0].dataIndex,point=candlestickData[dataIndex];if(!point)return"";const change=point.close-point.open,changePercent=(change/point.open*100).toFixed(2),changeColor=change&gt;=0?"#4caf50":"#f44336";let html=`\n            &lt;div style="padding: 8px;"&gt;\n              &lt;strong&gt;${point.timestamp&amp;&amp;!isNaN(point.timestamp)?ChartTimeFormatter.tooltip(point.timestamp):"Invalid Date"}&lt;/strong&gt;&lt;br/&gt;`;if(selectedPoints&amp;&amp;selectedPoints.length&gt;0&amp;&amp;(null==(_a=selectedPoints[0])?void 0:_a.markerTag)){html+=`&lt;span style="color: #888; font-size: 11px;"&gt;Tags: ${(Array.isArray(selectedPoints[0].markerTag)?selectedPoints[0].markerTag:[selectedPoints[0].markerTag]).join(", ")}&lt;/span&gt;&lt;br/&gt;`}return html+=`\n              &lt;span style="color: ${changeColor}"&gt;\n                ${change&gt;=0?"":""} ${formatNumberForDisplay(Math.abs(change))} ${unit} (${changePercent}%)\n              &lt;/span&gt;&lt;br/&gt;\n              Open: ${formatNumberForDisplay(point.open)} ${unit}&lt;br/&gt;\n              High: ${formatNumberForDisplay(point.high)} ${unit}&lt;br/&gt;\n              Low: ${formatNumberForDisplay(point.low)} ${unit}&lt;br/&gt;\n              Close: ${formatNumberForDisplay(point.close)} ${unit}\n          `,showVolume&amp;&amp;void 0!==point.volume&amp;&amp;(html+=`&lt;br/&gt;Volume: ${formatNumberForDisplay(point.volume)}`),html+="&lt;/div&gt;",html}},legend:{data:showVolume?["Values","Volume"]:["Values"],textStyle:{color:theme.palette.text.secondary},top:title?40:10},grid:showVolume?[{...CHART_DESIGN_TOKENS.grid.base,left:"10%",right:"5%",height:"50%",top:calculateGridTop({hasTitle:!!title,hasToolbox:!0})},{...CHART_DESIGN_TOKENS.grid.base,left:"10%",right:"5%",top:"70%",height:"15%"}]:{...CHART_DESIGN_TOKENS.grid.base,left:"10%",right:"5%",bottom:"15%",top:calculateGridTop({hasTitle:!!title,hasToolbox:!0}),containLabel:!0},xAxis:showVolume?[{type:"category",data:candlestickData.map(d=&gt;d.timestamp?formatTime2(d.timestamp):""),gridIndex:0,axisLabel:{color:theme.palette.text.secondary,rotate:45},axisLine:{lineStyle:{color:theme.palette.divider}}},{type:"category",data:candlestickData.map(d=&gt;d.timestamp?formatTime2(d.timestamp):""),gridIndex:1,axisLabel:{show:!1},axisLine:{lineStyle:{color:theme.palette.divider}}}]:{type:"category",data:candlestickData.map(d=&gt;d.timestamp?formatTime2(d.timestamp):""),axisLabel:{color:theme.palette.text.secondary,rotate:45},axisLine:{lineStyle:{color:theme.palette.divider}}},yAxis:showVolume?[{type:"value",name:yAxisLabel||`Value (${unit})`,nameLocation:"middle",nameGap:50,gridIndex:0,scale:!0,min:"dataMin",max:"dataMax",nameTextStyle:{color:theme.palette.text.secondary,fontSize:12},axisLabel:{color:theme.palette.text.secondary,formatter:value=&gt;formatNumberForDisplay(value)},axisLine:{lineStyle:{color:theme.palette.divider}},splitLine:{lineStyle:{color:theme.palette.divider,opacity:.3}}},{type:"value",name:"Volume",nameLocation:"middle",nameGap:30,gridIndex:1,scale:!0,min:"dataMin",max:"dataMax",nameTextStyle:{color:theme.palette.text.secondary,fontSize:12},axisLabel:{color:theme.palette.text.secondary,formatter:value=&gt;formatNumberForDisplay(value)},axisLine:{lineStyle:{color:theme.palette.divider}},splitLine:{lineStyle:{color:theme.palette.divider,opacity:.3}}}]:{type:"value",name:yAxisLabel||`Value (${unit})`,nameLocation:"middle",nameGap:50,scale:!0,min:"dataMin",max:"dataMax",nameTextStyle:{color:theme.palette.text.secondary,fontSize:12},axisLabel:{color:theme.palette.text.secondary,formatter:value=&gt;formatNumberForDisplay(value)},axisLine:{lineStyle:{color:theme.palette.divider}},splitLine:{lineStyle:{color:theme.palette.divider,opacity:.3}}},series:[{name:"Values",type:"candlestick",data:echartsData.map(d=&gt;d.value),itemStyle:{color:"#4caf50",color0:"#f44336",borderColor:"#4caf50",borderColor0:"#f44336"},emphasis:{itemStyle:{borderWidth:2,shadowBlur:10,shadowColor:"dark"===theme.palette.mode?"rgba(255, 255, 255, 0.2)":"rgba(0, 0, 0, 0.2)"}},...showVolume?{xAxisIndex:0,yAxisIndex:0}:{},...useWebGL?{progressive:5e3,progressiveThreshold:1e4,large:!0,largeThreshold:5e3}:{}},...showVolume?[{name:"Volume",type:"bar",data:volumeData,xAxisIndex:1,yAxisIndex:1,itemStyle:{color:theme.palette.action.selected,opacity:.8}}]:[]],dataZoom:[{type:"inside",xAxisIndex:showVolume?[0,1]:0,start:70,end:100},{show:!0,type:"slider",xAxisIndex:showVolume?[0,1]:0,start:70,end:100,bottom:10,height:20}]};return mergeChartOptions(baseOptions,candlestickSpecificOptions,{showToolbox:enableToolbox,enableDataView:!1,enableMagicType:!1,showDataZoom:!0,showLegend:!0})},[data,title,theme,yAxisLabel,unit,showVolume,interval,candlestickData,volumeData,enableToolbox,baseOptions]);return reactExports.useMemo(()=&gt;Array.isArray(candlestickData)?candlestickData.filter(candle=&gt;candle&amp;&amp;"number"==typeof candle.timestamp&amp;&amp;"number"==typeof candle.open&amp;&amp;"number"==typeof candle.high&amp;&amp;"number"==typeof candle.low&amp;&amp;"number"==typeof candle.close&amp;&amp;!isNaN(candle.open)&amp;&amp;!isNaN(candle.high)&amp;&amp;!isNaN(candle.low)&amp;&amp;!isNaN(candle.close)):[],[candlestickData]),jsxRuntimeExports.jsx(Box,{ref:containerRef,sx:{position:"relative",height:height,width:width,overflow:"hidden"},children:jsxRuntimeExports.jsx(EChartsWrapper,{error:error,height:"100%",loading:loading,option:option,theme:theme.palette.mode,getChartInstance:instance=&gt;{chartInstanceRef.current=instance,onChartReady&amp;&amp;onChartReady(instance)}})})},(prevProps,nextProps)=&gt;{if(prevProps.loading!==nextProps.loading||prevProps.error!==nextProps.error||prevProps.height!==nextProps.height||prevProps.width!==nextProps.width||prevProps.title!==nextProps.title||prevProps.yAxisLabel!==nextProps.yAxisLabel||prevProps.unit!==nextProps.unit||prevProps.showVolume!==nextProps.showVolume||prevProps.interval!==nextProps.interval||prevProps.enableToolbox!==nextProps.enableToolbox||prevProps.timeRange!==nextProps.timeRange||prevProps.selectedPoints!==nextProps.selectedPoints||prevProps.onChartReady!==nextProps.onChartReady||prevProps.onEdit!==nextProps.onEdit||prevProps.onDelete!==nextProps.onDelete)return!1;if(prevProps.data!==nextProps.data)return!1;if(prevProps.thresholds!==nextProps.thresholds){if(!prevProps.thresholds||!nextProps.thresholds)return!1;if(prevProps.thresholds.length!==nextProps.thresholds.length)return!1;for(let i=0;i&lt;prevProps.thresholds.length;i++){const prevThreshold=prevProps.thresholds[i],nextThreshold=nextProps.thresholds[i];if(prevThreshold.value!==nextThreshold.value||prevThreshold.name!==nextThreshold.name||prevThreshold.color!==nextThreshold.color)return!1}}return!0});function sampleByInterval(timestamps,intervalMs){if(0===timestamps.length)return[];const sampled=[];let lastSampled=timestamps[0]-intervalMs;return timestamps.forEach(timestamp=&gt;{timestamp-lastSampled&gt;=intervalMs&amp;&amp;(sampled.push(timestamp),lastSampled=timestamp)}),sampled}const AGGREGATION_METHODS={sum:{type:"sum",label:"Total"},average:{type:"average",label:"Average"},max:{type:"max",label:"Maximum"},min:{type:"min",label:"Minimum"},count:{type:"count",label:"Count"}},EChartsCalendarHeatmap$1=React.memo(({selectedPoints:selectedPoints,timeRange:timeRange="1y",data:data,series:series,loading:loading,error:propsError,title:title,year:year=(new Date).getFullYear(),aggregationType:aggregationType="average",timeRangeFilter:timeRangeFilter="year",showMultipleYears:showMultipleYears=!1,startYear:startYear,endYear:endYear,height:height="100%",width:width="100%",colorRange:colorRange,valueRange:valueRange,gradientTheme:gradientTheme,onChartReady:onChartReady,onDateSelect:onDateSelect,onMonthSelect:onMonthSelect,enableRangeCompliance:enableRangeCompliance=!1,rangeMin:rangeMin,rangeMax:rangeMax,enableDeviationAnalysis:enableDeviationAnalysis=!1,deviationSetpoint:deviationSetpoint,deviationTolerance:deviationTolerance,brushedTimeRange:brushedTimeRange,brushSourceChartId:brushSourceChartId,widgetId:widgetId,linkedSeriesInfo:linkedSeriesInfo,sourceChartForSeriesLink:sourceChartForSeriesLink,aggregationInfo:aggregationInfo,enableToolbox:enableToolbox=!0,onEdit:onEdit,onDelete:onDelete,timeSeriesData:timeSeriesData=[],isLoadingTimeSeries:isLoadingTimeSeries=!1,lastUpdated:lastUpdated=null})=&gt;{const theme=useTheme(),[error,setError]=reactExports.useState(null),containerRef=reactExports.useRef(null),chartInstanceRef=reactExports.useRef(null),{series:fetchedSeries,isLoading:isLoading,error:dataError}=useChartDataSimple({selectedPoints:selectedPoints,timeRange:timeRange,enabled:selectedPoints.length&gt;0}),dataSource=series||fetchedSeries||[],validatedData=reactExports.useMemo(()=&gt;Array.isArray(dataSource)?dataSource.filter(s=&gt;s&amp;&amp;s.data&amp;&amp;Array.isArray(s.data)&amp;&amp;s.data.length&gt;0):[],[dataSource]),finalLoading=loading||isLoading,finalError=propsError||dataError;reactExports.useEffect(()=&gt;{const handleResize=()=&gt;{chartInstanceRef.current&amp;&amp;chartInstanceRef.current.resize()},handleGridResize=()=&gt;{chartInstanceRef.current&amp;&amp;chartInstanceRef.current.resize()};return window.addEventListener("resize",handleResize),window.addEventListener("grid-resize",handleGridResize),()=&gt;{window.removeEventListener("resize",handleResize),window.removeEventListener("grid-resize",handleGridResize)}},[]);const baseOptions=useBaseChartOptions(),calendarData=reactExports.useMemo(()=&gt;{let sourceData=[];if(validatedData.length&gt;0?sourceData=validatedData:data&amp;&amp;Array.isArray(data)?sourceData=data:timeSeriesData&amp;&amp;timeSeriesData.length&gt;0&amp;&amp;(sourceData=timeSeriesData),0===sourceData.length)return[];const aggregatedByDate=new Map;sourceData.forEach(series2=&gt;{const seriesData=series2.data||[];(brushedTimeRange&amp;&amp;widgetId!==brushSourceChartId?seriesData.filter(point=&gt;{const timestamp=Array.isArray(point)?point[0]:point.timestamp;return timestamp&gt;=brushedTimeRange.start&amp;&amp;timestamp&lt;=brushedTimeRange.end}):seriesData).forEach(point=&gt;{const timestamp=Array.isArray(point)?point[0]:point.timestamp,value=Array.isArray(point)?point[1]:point.value;if(timestamp&amp;&amp;null!=value&amp;&amp;!isNaN(value)){const date=new Date(timestamp);if("custom"!==timeRangeFilter){const currentYear=date.getFullYear(),currentMonth=date.getMonth(),targetYear=year;if("year"===timeRangeFilter&amp;&amp;currentYear!==targetYear)return;if("quarter"===timeRangeFilter){const targetQuarter=Math.floor((new Date).getMonth()/3),currentQuarter=Math.floor(currentMonth/3);if(currentYear!==targetYear||currentQuarter!==targetQuarter)return}if("month"===timeRangeFilter){const targetMonth=(new Date).getMonth();if(currentYear!==targetYear||currentMonth!==targetMonth)return}}const dateStr=format(date,"yyyy-MM-dd");aggregatedByDate.has(dateStr)||aggregatedByDate.set(dateStr,[]),aggregatedByDate.get(dateStr).push("number"==typeof value?value:parseFloat(value)||0)}})});const result=[];return aggregatedByDate.forEach((values,date)=&gt;{if(0===values.length)return;let aggregatedValue;switch(aggregationType){case"sum":aggregatedValue=values.reduce((sum,val)=&gt;sum+val,0);break;case"max":aggregatedValue=Math.max(...values);break;case"min":aggregatedValue=Math.min(...values);break;case"count":aggregatedValue=values.length;break;default:aggregatedValue=values.reduce((sum,val)=&gt;sum+val,0)/values.length}result.push({date:date,value:aggregatedValue})}),result.sort((a,b)=&gt;a.date.localeCompare(b.date))},[validatedData,data,timeSeriesData,aggregationType,timeRangeFilter,year,brushedTimeRange,brushSourceChartId,widgetId]),effectiveValueRange=reactExports.useMemo(()=&gt;{if(valueRange)return valueRange;if(0===calendarData.length)return[0,0];const values=calendarData.map(item=&gt;item.value);return values.length&gt;0?[Math.min(...values),Math.max(...values)]:[0,1]},[calendarData,valueRange]),effectiveColorRange=reactExports.useMemo(()=&gt;colorRange||("dark"===theme.palette.mode?["#66bb6a","#4caf50","#43a047","#2e7d32"]:["#81c784","#4caf50","#2e7d32","#1b5e20"]),[colorRange,theme]),handleChartEvents=reactExports.useCallback(params=&gt;{if("calendar"===params.componentType){const date=params.value[0],value=params.value[1];if(onDateSelect&amp;&amp;onDateSelect(date,value),onMonthSelect&amp;&amp;"monthLabel"===params.targetType){const clickedDate=new Date(date),monthStr=`${clickedDate.getFullYear()}-${String(clickedDate.getMonth()+1).padStart(2,"0")}`;onMonthSelect(monthStr)}}},[onDateSelect,onMonthSelect]),transformedData=reactExports.useMemo(()=&gt;{if(0===calendarData.length)return null;return{type:"heatmap",coordinateSystem:"calendar",data:calendarData.map(item=&gt;[item.date,item.value]),name:selectedPoints.length&gt;0?1===selectedPoints.length?selectedPoints[0].name:`${selectedPoints.length} Points`:"Calendar Data"}},[calendarData,selectedPoints]),chartOption=reactExports.useMemo(()=&gt;{var _a;try{if(!transformedData)return baseOptions;let displayYears,titleSuffix="";if(showMultipleYears&amp;&amp;startYear&amp;&amp;endYear){displayYears=[];for(let y=startYear;y&lt;=endYear;y++)displayYears.push(y.toString())}else{let displayYear=year;brushedTimeRange&amp;&amp;widgetId!==brushSourceChartId&amp;&amp;brushedTimeRange.start&amp;&amp;(displayYear=new Date(brushedTimeRange.start).getFullYear()),displayYears=[displayYear.toString()]}linkedSeriesInfo&amp;&amp;widgetId!==sourceChartForSeriesLink&amp;&amp;(titleSuffix+=` (Linked: ${linkedSeriesInfo.seriesName||linkedSeriesInfo.pointId||"Series"})`);const aggregationLabel=(null==(_a=AGGREGATION_METHODS[aggregationType])?void 0:_a.label)||"Average";selectedPoints.length&gt;1?titleSuffix+=` (${aggregationLabel} of ${selectedPoints.length} points)`:"average"!==aggregationType&amp;&amp;(titleSuffix+=` (${aggregationLabel})`);const isDarkMode="dark"===theme.palette.mode,customOptions={title:title?{...CHART_DESIGN_TOKENS.title.base,text:`${title}${titleSuffix}`,textStyle:{...CHART_DESIGN_TOKENS.title.base.textStyle,color:theme.palette.text.primary}}:void 0,tooltip:{...CHART_DESIGN_TOKENS.tooltip.base,backgroundColor:isDarkMode?"rgba(50, 50, 50, 0.95)":"rgba(255, 255, 255, 0.95)",borderColor:isDarkMode?"rgba(255, 255, 255, 0.12)":"rgba(0, 0, 0, 0.12)",textStyle:{...CHART_DESIGN_TOKENS.tooltip.base.textStyle,color:theme.palette.text.primary},position:"top",...aggregationInfo?createTooltipConfig(aggregationInfo):{formatter:params=&gt;{var _a2;if(!params||!params.value||!Array.isArray(params.value)||params.value.length&lt;2)return"No data available";const date=params.value[0],value=params.value[1],aggregationLabel2=(null==(_a2=AGGREGATION_METHODS[aggregationType])?void 0:_a2.label)||"Average",unit=selectedPoints.length&gt;0&amp;&amp;selectedPoints[0].unit?` ${selectedPoints[0].unit}`:"";return`&lt;div style="font-size: 12px;"&gt;\n                    &lt;div style="font-weight: bold; margin-bottom: 4px;"&gt;${ChartTimeFormatter.calendar(date)}&lt;/div&gt;\n                    &lt;div&gt;${aggregationLabel2}: &lt;b&gt;${formatNumberForDisplay(value,2)}${unit}&lt;/b&gt;&lt;/div&gt;\n                    ${selectedPoints.length&gt;1?`&lt;div style="color: #666; font-size: 11px;"&gt;${selectedPoints.length} points combined&lt;/div&gt;`:""}\n                  &lt;/div&gt;`}}},visualMap:enableRangeCompliance&amp;&amp;void 0!==rangeMin&amp;&amp;void 0!==rangeMax?{min:effectiveValueRange[0],max:effectiveValueRange[1],calculable:!0,orient:"horizontal",left:"center",bottom:25,pieces:[{lt:rangeMin,label:"Below Range",color:theme.palette.info.main},{gte:rangeMin,lte:rangeMax,label:"Within Range",color:theme.palette.success.main},{gt:rangeMax,label:"Above Range",color:theme.palette.error.main}]}:enableDeviationAnalysis&amp;&amp;void 0!==deviationSetpoint&amp;&amp;void 0!==deviationTolerance?{min:effectiveValueRange[0],max:effectiveValueRange[1],calculable:!0,orient:"horizontal",left:"center",bottom:25,inRange:{color:value=&gt;calculateDeviation$2(value,{setpoint:deviationSetpoint,tolerance:deviationTolerance,colorScheme:DEVIATION_COLOR_SCHEMES.standard}).color},formatter:value=&gt;{if("number"==typeof value){const deviation=value-deviationSetpoint;return`${formatNumberForDisplay(value)} (${deviation&gt;0?"+":""}${formatNumberForDisplay(deviation)})`}return value}}:{min:effectiveValueRange[0],max:effectiveValueRange[1],calculable:!0,orient:"horizontal",left:"center",bottom:25,inRange:{color:effectiveColorRange},formatter:value=&gt;"number"==typeof value?formatNumberForDisplay(value):String(value)},calendar:1===displayYears.length?{top:title?60:25,left:30,right:30,bottom:60,cellSize:["auto","auto"],range:displayYears[0],itemStyle:{borderWidth:1,borderColor:theme.palette.divider},splitLine:{lineStyle:{width:1,color:theme.palette.divider}},dayLabel:{nameMap:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],color:theme.palette.text.secondary},monthLabel:{nameMap:"en",color:theme.palette.text.primary,fontSize:14},yearLabel:{show:!0,position:"top",color:theme.palette.text.primary,fontSize:16,fontWeight:"bold"}}:displayYears.map((year2,index2)=&gt;({id:`calendar_${year2}`,top:title?80+280*index2:40+280*index2,left:30,right:30,height:220,cellSize:["auto",13],range:year2,itemStyle:{borderWidth:1,borderColor:theme.palette.divider},splitLine:{lineStyle:{width:1,color:theme.palette.divider}},dayLabel:{nameMap:["S","M","T","W","T","F","S"],color:theme.palette.text.secondary,fontSize:10},monthLabel:{nameMap:"en",color:theme.palette.text.primary,fontSize:12},yearLabel:{show:!0,position:"top",color:theme.palette.text.primary,fontSize:14,fontWeight:"bold"}})),series:showMultipleYears&amp;&amp;displayYears.length&gt;1?displayYears.map((year2,index2)=&gt;{var _a2;return{...transformedData,calendarIndex:index2,coordinateSystem:"calendar",emphasis:{itemStyle:{shadowBlur:10,shadowColor:"rgba(0, 0, 0, 0.5)"}},data:(null==(_a2=transformedData.data)?void 0:_a2.filter(item=&gt;{var _a3;return new Date((null==(_a3=item.value)?void 0:_a3[0])||item[0]).getFullYear().toString()===year2}))||[]}}):{...transformedData,coordinateSystem:"calendar",emphasis:{itemStyle:{shadowBlur:10,shadowColor:"rgba(0, 0, 0, 0.5)"}}},progressive:1e3,progressiveThreshold:3e3,largeThreshold:1e3},totalPoints=calendarData.reduce((sum,_)=&gt;sum+1,0),animationMode=CHART_DESIGN_TOKENS.adaptive.animationMode(totalPoints);return mergeChartOptions(baseOptions,{...customOptions,...CHART_DESIGN_TOKENS.animation[animationMode]},{showDataZoom:!1,showLegend:!1,showToolbox:enableToolbox,enableDataView:!1,onEdit:onEdit,onDelete:onDelete})}catch(err){return setError("Failed to create chart configuration"),baseOptions}},[transformedData,baseOptions,title,year,showMultipleYears,startYear,endYear,aggregationType,selectedPoints.length,brushedTimeRange,widgetId,brushSourceChartId,JSON.stringify(effectiveValueRange),JSON.stringify(effectiveColorRange),linkedSeriesInfo,sourceChartForSeriesLink,aggregationInfo,enableRangeCompliance,rangeMin,rangeMax,enableDeviationAnalysis,deviationSetpoint,deviationTolerance,enableToolbox,theme.palette.mode]);return error||finalError?jsxRuntimeExports.jsx(Box,{alignItems:"center",display:"flex",height:height,justifyContent:"center",width:width,children:jsxRuntimeExports.jsx(Typography$1,{color:"error",children:error||(null==finalError?void 0:finalError.message)||"Failed to load calendar data"})}):finalLoading||isLoadingTimeSeries?jsxRuntimeExports.jsxs(Box,{alignItems:"center",display:"flex",height:height,justifyContent:"center",width:width,children:[jsxRuntimeExports.jsx(CircularProgress,{}),jsxRuntimeExports.jsx(Typography$1,{variant:"body2",sx:{ml:2},color:"textSecondary",children:"Loading calendar data..."})]}):transformedData&amp;&amp;0!==calendarData.length?(reactExports.useMemo(()=&gt;{const hasValidatedData=validatedData.length&gt;0,hasPassedData=data&amp;&amp;Array.isArray(data)&amp;&amp;data.length&gt;0,hasLegacyData=timeSeriesData&amp;&amp;Array.isArray(timeSeriesData)&amp;&amp;timeSeriesData.length&gt;0;return hasValidatedData||hasPassedData||hasLegacyData},[validatedData,data,timeSeriesData,calendarData.length,selectedPoints.length,aggregationType,timeRangeFilter,year]),jsxRuntimeExports.jsx(Box,{ref:containerRef,sx:{position:"relative",height:height,width:"100%",overflow:"hidden"},children:jsxRuntimeExports.jsx(EChartsWrapper,{height:"100%",option:chartOption,width:width,theme:"dark"===theme.palette.mode?"dark":"light",onChartReady:chart=&gt;{chartInstanceRef.current=chart,null==onChartReady||onChartReady(chart)},onEvents:{click:handleChartEvents}})})):jsxRuntimeExports.jsx(Box,{alignItems:"center",display:"flex",height:height,justifyContent:"center",width:width,children:jsxRuntimeExports.jsxs(Box,{textAlign:"center",children:[jsxRuntimeExports.jsx(Typography$1,{color:"textSecondary",gutterBottom:!0,children:"No data available for calendar display"}),0===selectedPoints.length&amp;&amp;jsxRuntimeExports.jsx(Typography$1,{variant:"body2",color:"textSecondary",children:"Please select points to visualize"}),selectedPoints.length&gt;0&amp;&amp;jsxRuntimeExports.jsx(Typography$1,{variant:"body2",color:"textSecondary",children:"Try adjusting the time range or year filter"})]})})}),EChartsTimelineChart=({data:data,loading:loading,error:error,height:height="500px",title:title,chartType:chartType="line",playInterval:playInterval=2e3,autoPlay:autoPlay=!1,loop:loop=!0,chartId:chartId,customColors:customColors,onTimeChange:onTimeChange,onEdit:onEdit,onDelete:onDelete})=&gt;{var _a;const theme=useTheme(),distinctColors=customColors||getDistinctColors(10),[isPlaying,setIsPlaying]=reactExports.useState(autoPlay),[currentIndex,setCurrentIndex]=reactExports.useState(0),baseOptions=useBaseChartOptions(),option=reactExports.useMemo(()=&gt;{const totalPoints=data.reduce((sum,timepoint)=&gt;sum+timepoint.data.reduce((s,series)=&gt;s+series.values.length,0),0),animationMode=CHART_DESIGN_TOKENS.adaptive.animationMode(totalPoints),isDarkMode="dark"===theme.palette.mode,allSeriesNames=new Set;data.forEach(timepoint=&gt;{timepoint.data.forEach(series=&gt;{allSeriesNames.add(series.name)})});const seriesNames=Array.from(allSeriesNames),timelineData=data.map(d=&gt;({value:d.label,tooltip:{formatter:()=&gt;ChartTimeFormatter.tooltip(d.timestamp)}})),timelineOptions=data.map(timepoint=&gt;({series:seriesNames.map((seriesName,index2)=&gt;{const seriesData=timepoint.data.find(d=&gt;d.name===seriesName),baseSeries={name:(null==seriesData?void 0:seriesData.formattedName)||seriesName,type:chartType,data:(null==seriesData?void 0:seriesData.values)||[],itemStyle:{color:distinctColors[index2%distinctColors.length]}};return"line"===chartType?{...baseSeries,smooth:!0,symbol:"circle",symbolSize:6,lineStyle:{width:2},emphasis:{focus:"series"}}:"scatter"===chartType?{...baseSeries,symbolSize:10,emphasis:{focus:"series",itemStyle:{borderWidth:2,borderColor:"#fff"}}}:baseSeries})})),timelineSpecificOptions={...CHART_DESIGN_TOKENS.animation[animationMode],baseOption:{timeline:{axisType:"category",data:timelineData.map(item=&gt;"object"==typeof item?item.value:item),autoPlay:isPlaying,playInterval:playInterval,loop:loop,currentIndex:currentIndex,controlStyle:{show:!1,showPlayBtn:!1,showPrevBtn:!1,showNextBtn:!1,itemSize:22,itemGap:12,position:"left",playIcon:"path://M31.6,53.3c0.5,0.3,1.1,0.3,1.6,0c0.5-0.3,0.8-0.8,0.8-1.4V12.1c0-0.5-0.3-1.1-0.8-1.4s-1.1-0.3-1.6,0l-26,19.9c-0.4,0.3-0.6,0.8-0.6,1.4s0.2,1,0.6,1.4L31.6,53.3z",stopIcon:"path://M30.9,53.2C31.2,53.7,31.7,54,32.3,54h10.4c0.6,0,1.1-0.3,1.4-0.8c0.3-0.5,0.3-1.1,0-1.6L33.7,32l10.4-19.6c0.3-0.5,0.3-1.1,0-1.6C43.8,10.3,43.3,10,42.7,10H32.3c-0.6,0-1.1,0.3-1.4,0.8L20.5,30.4c-0.3,0.5-0.3,1.1,0,1.6L30.9,53.2z",prevIcon:"path://M29.5,53.3c0.5,0.3,1.1,0.3,1.6,0c0.5-0.3,0.8-0.8,0.8-1.4V12.1c0-0.5-0.3-1.1-0.8-1.4s-1.1-0.3-1.6,0l-19.5,19.9c-0.4,0.3-0.6,0.8-0.6,1.4s0.2,1,0.6,1.4L29.5,53.3z M38,10h4c1.1,0,2,0.9,2,2v40c0,1.1-0.9,2-2,2h-4c-1.1,0-2-0.9-2-2V12C36,10.9,36.9,10,38,10z",nextIcon:"path://M18.5,10.7c-0.5-0.3-1.1-0.3-1.6,0S16.1,11.5,16.1,12.1v39.8c0,0.5,0.3,1.1,0.8,1.4c0.3,0.1,0.5,0.2,0.8,0.2s0.6-0.1,0.8-0.2l19.5-19.9c0.4-0.3,0.6-0.8,0.6-1.4s-0.2-1-0.6-1.4L18.5,10.7z M10,54H6c-1.1,0-2-0.9-2-2V12c0-1.1,0.9-2,2-2h4c1.1,0,2,0.9,2,2v40C12,53.1,11.1,54,10,54z",color:theme.palette.primary.main,borderColor:theme.palette.divider},label:{color:theme.palette.text.primary,fontSize:12},itemStyle:{color:theme.palette.primary.main,borderColor:theme.palette.divider},checkpointStyle:{color:theme.palette.primary.main,borderColor:theme.palette.primary.dark,borderWidth:2,symbolSize:14},lineStyle:{color:theme.palette.divider},emphasis:{label:{color:theme.palette.primary.main,fontSize:14,fontWeight:"bold"},itemStyle:{color:theme.palette.primary.dark}},bottom:60},title:title?{...CHART_DESIGN_TOKENS.title.base,text:title,textStyle:{...CHART_DESIGN_TOKENS.title.base.textStyle,color:theme.palette.text.primary}}:void 0,tooltip:{...CHART_DESIGN_TOKENS.tooltip.base,trigger:"axis",axisPointer:{type:"cross",animation:!1},backgroundColor:isDarkMode?"rgba(50, 50, 50, 0.95)":"rgba(255, 255, 255, 0.95)",borderColor:isDarkMode?"rgba(255, 255, 255, 0.12)":"rgba(0, 0, 0, 0.12)",textStyle:{...CHART_DESIGN_TOKENS.tooltip.base.textStyle,color:theme.palette.text.primary}},legend:{data:seriesNames.map(name=&gt;{var _a2;const foundSeries=null==(_a2=data[0])?void 0:_a2.data.find(d=&gt;d.name===name);return(null==foundSeries?void 0:foundSeries.formattedName)||name}),bottom:120,textStyle:{color:theme.palette.text.secondary}},grid:{...CHART_DESIGN_TOKENS.grid.base,left:"10%",right:"10%",bottom:"25%",top:calculateGridTop({hasTitle:!!title,hasToolbox:!0}),containLabel:!0},xAxis:"scatter"===chartType?{type:"value",boundaryGap:["10%","10%"],axisLabel:{color:theme.palette.text.secondary,formatter:value=&gt;formatNumberForDisplay(value,1)},splitLine:{show:!0,lineStyle:{color:theme.palette.divider,opacity:.3}}}:{...getTimeAxisConfig(),boundaryGap:"bar"===chartType&amp;&amp;["10%","10%"],axisLabel:{...getTimeAxisConfig().axisLabel,color:theme.palette.text.secondary,rotate:45,align:"right",verticalAlign:"top"},splitLine:{show:!0,lineStyle:{color:theme.palette.divider,opacity:.3}}},yAxis:{type:"value",axisLabel:{color:theme.palette.text.secondary,formatter:value=&gt;formatNumberForDisplay(value,1)},axisLine:{lineStyle:{color:theme.palette.divider}},splitLine:{lineStyle:{color:theme.palette.divider,opacity:.3}}},aria:{enabled:!0,label:{enabled:!0,description:`Timeline chart showing ${title||"data"} evolution over ${data.length} time points`}}},options:timelineOptions};return mergeChartOptions(baseOptions,timelineSpecificOptions,{showToolbox:!0,enableDataView:!0,enableMagicType:!1,showDataZoom:!1,showLegend:!0})},[data,title,theme,chartType,distinctColors,isPlaying,playInterval,loop,currentIndex,baseOptions,onEdit,onDelete]),handleChartReady=reactExports.useCallback(chart=&gt;{chartId&amp;&amp;registerChartForActions(chartId,chart),chart.on("timelinechanged",params=&gt;{if(setCurrentIndex(params.currentIndex),onTimeChange){const timepoint=data[params.currentIndex];timepoint&amp;&amp;onTimeChange(params.currentIndex,timepoint.timestamp)}}),chart.on("timelineplaychanged",params=&gt;{setIsPlaying(params.playState)})},[chartId,data,onTimeChange]),handlePlayPause=reactExports.useCallback(()=&gt;{chartId&amp;&amp;chartActionDispatcher.controlTimeline(chartId,!isPlaying),setIsPlaying(!isPlaying)},[chartId,isPlaying]),handlePrevious=reactExports.useCallback(()=&gt;{const newIndex=currentIndex&gt;0?currentIndex-1:data.length-1;chartId&amp;&amp;chartActionDispatcher.setTimelineIndex(chartId,newIndex),setCurrentIndex(newIndex)},[chartId,currentIndex,data.length]),handleNext=reactExports.useCallback(()=&gt;{const newIndex=(currentIndex+1)%data.length;chartId&amp;&amp;chartActionDispatcher.setTimelineIndex(chartId,newIndex),setCurrentIndex(newIndex)},[chartId,currentIndex,data.length]),handleSliderChange=reactExports.useCallback((_,value)=&gt;{const index2=value;chartId&amp;&amp;chartActionDispatcher.setTimelineIndex(chartId,index2),setCurrentIndex(index2)},[chartId]);return jsxRuntimeExports.jsxs(Box,{children:[jsxRuntimeExports.jsx(EChartsWrapper,{option:option,loading:loading,error:error,height:height,onChartReady:handleChartReady}),jsxRuntimeExports.jsxs(Box,{sx:{display:"flex",alignItems:"center",gap:2,px:2,py:1,borderTop:1,borderColor:"divider"},children:[jsxRuntimeExports.jsx(IconButton,{onClick:handlePrevious,size:"small",children:jsxRuntimeExports.jsx(SkipPreviousIcon,{})}),jsxRuntimeExports.jsx(IconButton,{onClick:handlePlayPause,size:"small",children:isPlaying?jsxRuntimeExports.jsx(PauseIcon,{}):jsxRuntimeExports.jsx(PlayArrowIcon,{})}),jsxRuntimeExports.jsx(IconButton,{onClick:handleNext,size:"small",children:jsxRuntimeExports.jsx(SkipNextIcon,{})}),jsxRuntimeExports.jsx(Slider,{value:currentIndex,onChange:handleSliderChange,min:0,max:data.length-1,step:1,marks:!0,sx:{flexGrow:1,mx:2}}),jsxRuntimeExports.jsx(Typography$1,{variant:"caption",color:"text.secondary",sx:{minWidth:100},children:(null==(_a=data[currentIndex])?void 0:_a.label)||""})]})]})},calculateAggregatedValue$1=(data,aggregation="average")=&gt;{if(!data||0===data.length)return 0;switch(aggregation){case"sum":return data.reduce((sum,[_,value])=&gt;sum+value,0);case"average":default:return data.reduce((sum,[_,value])=&gt;sum+value,0)/data.length;case"latest":return data[data.length-1][1];case"max":return Math.max(...data.map(([_,value])=&gt;value));case"min":return Math.min(...data.map(([_,value])=&gt;value))}},extractSystemGroup=(name,patterns)=&gt;{const upperName=name.toUpperCase();for(const pattern of patterns){const regex=new RegExp(`(${pattern.toUpperCase()}[-_]?d*)`,"i"),match=upperName.match(regex);if(match)return match[1]}return""},groupPointsBySystem=points=&gt;points.reduce((groups,point)=&gt;{const key=point.systemGroup||point.systemType||"default";return groups[key]||(groups[key]=[]),groups[key].push(point),groups},{}),calculateFlowEfficiency=(sourceValue,targetValue)=&gt;0===sourceValue?0:Math.min(100,Math.abs(targetValue)/Math.abs(sourceValue)*100),formatPointName=(name,markerTags)=&gt;{if(!markerTags||0===markerTags.length)return name;return`${name} [${markerTags.slice(0,2).join(", ")}]`},EChartsSankey$1=React.memo(({data:data,selectedPoints:selectedPoints,timeRange:timeRange="24h",loading:loading,error:error,height:height="500px",title:title,unit:unit="",orient:orient="horizontal",nodeWidth:nodeWidth=20,nodeGap:nodeGap=8,layoutIterations:layoutIterations=32,groupId:groupId,chartId:chartId,customColors:customColors,enableAutoFlowDetection:enableAutoFlowDetection=!0,flowDetectionKeywords:flowDetectionKeywords,systemGrouping:systemGrouping="auto",enableTimeAnimation:enableTimeAnimation=!1,animationSpeed:animationSpeed=1e3,animationSteps:animationSteps=10,onChartReady:onChartReady,onEdit:onEdit,onDelete:onDelete,onFlowClick:onFlowClick,onNodeClick:onNodeClick,...otherProps})=&gt;{const theme=useTheme(),baseOptions=useBaseChartOptions(),validatedData=reactExports.useMemo(()=&gt;Array.isArray(data)?data.filter(s=&gt;s&amp;&amp;s.data&amp;&amp;Array.isArray(s.data)&amp;&amp;s.data.length&gt;0):[],[data]),finalLoading=loading,finalError=error,processedFlowData=reactExports.useMemo(()=&gt;{if(enableAutoFlowDetection&amp;&amp;validatedData.length&gt;0)return((seriesData,keywords={})=&gt;{const defaultKeywords={energy:["power","energy","kwh","kw","electrical","consumption","demand","usage"],air:["air","supply","return","exhaust","cfm","ahu","vav","fan","flow"],water:["water","chw","hhw","chilled","hot","cooling","heating","pump","gpm","flow"],steam:["steam","condensate","boiler","pressure","temperature","btu"],...keywords},nodes=[],links=[];let systemType="mixed",totalFlow=0;const categorizedPoints=seriesData.map(series=&gt;{var _a;const name=series.name.toLowerCase(),searchText=`${name} ${(null==(_a=series.markerTags)?void 0:_a.join(" ").toLowerCase())||""}`;let detectedSystemType="unknown",nodeType="process",systemGroup="";defaultKeywords.energy.some(keyword=&gt;searchText.includes(keyword))?(detectedSystemType="energy",searchText.includes("consumption")||searchText.includes("usage")||searchText.includes("demand")?nodeType="consumption":(searchText.includes("input")||searchText.includes("supply")||searchText.includes("main"))&amp;&amp;(nodeType="input")):defaultKeywords.air.some(keyword=&gt;searchText.includes(keyword))?(detectedSystemType="air",searchText.includes("supply")||searchText.includes("fan")||searchText.includes("ahu")?(nodeType="input",systemGroup=extractSystemGroup(name,["ahu","fan"])):searchText.includes("return")||searchText.includes("exhaust")?(nodeType="output",systemGroup=extractSystemGroup(name,["ahu","fan"])):(searchText.includes("vav")||searchText.includes("zone"))&amp;&amp;(nodeType="consumption",systemGroup=extractSystemGroup(name,["vav","zone"]))):defaultKeywords.water.some(keyword=&gt;searchText.includes(keyword))?(detectedSystemType="water",searchText.includes("supply")||searchText.includes("inlet")||searchText.includes("pump")?(nodeType="input",systemGroup=extractSystemGroup(name,["chw","hhw","pump"])):(searchText.includes("return")||searchText.includes("outlet"))&amp;&amp;(nodeType="output",systemGroup=extractSystemGroup(name,["chw","hhw"]))):defaultKeywords.steam.some(keyword=&gt;searchText.includes(keyword))&amp;&amp;(detectedSystemType="steam",searchText.includes("supply")||searchText.includes("boiler")?nodeType="input":(searchText.includes("condensate")||searchText.includes("return"))&amp;&amp;(nodeType="output"));const flowValue=calculateAggregatedValue$1(series.data,"average");return totalFlow+=Math.abs(flowValue),{series:series,systemType:detectedSystemType,nodeType:nodeType,systemGroup:systemGroup,flowValue:flowValue,formattedName:formatPointName(series.name,series.markerTags)}}),systemCounts=categorizedPoints.reduce((acc,point)=&gt;(acc[point.systemType]=(acc[point.systemType]||0)+1,acc),{}),dominantSystem=Object.entries(systemCounts).filter(([type])=&gt;"unknown"!==type).sort(([,a],[,b])=&gt;b-a)[0];dominantSystem&amp;&amp;(systemType=dominantSystem[0]),categorizedPoints.forEach(point=&gt;{const node={name:point.series.name,formattedName:point.formattedName,systemType:point.systemType,nodeType:point.nodeType,value:Math.abs(point.flowValue),unit:point.series.unit};nodes.push(node)});const groupedPoints=groupPointsBySystem(categorizedPoints);Object.entries(groupedPoints).forEach(([systemGroup,points])=&gt;{const inputPoints=points.filter(p=&gt;"input"===p.nodeType),outputPoints=points.filter(p=&gt;"output"===p.nodeType),consumptionPoints=points.filter(p=&gt;"consumption"===p.nodeType),processPoints=points.filter(p=&gt;"process"===p.nodeType);inputPoints.forEach(input=&gt;{[...consumptionPoints,...processPoints,...outputPoints].forEach(target=&gt;{if(input.series.name!==target.series.name){const flowValue=Math.min(Math.abs(input.flowValue),Math.abs(target.flowValue));flowValue&gt;0&amp;&amp;links.push({source:input.series.name,target:target.series.name,value:flowValue,sourceFormatted:input.formattedName,targetFormatted:target.formattedName,flowType:"unknown"!==input.systemType?input.systemType:"unknown",efficiency:calculateFlowEfficiency(input.flowValue,target.flowValue)})}})}),0===inputPoints.length&amp;&amp;processPoints.length&gt;0&amp;&amp;outputPoints.length&gt;0&amp;&amp;processPoints.forEach(process=&gt;{outputPoints.forEach(output=&gt;{if(process.series.name!==output.series.name){const flowValue=Math.min(Math.abs(process.flowValue),Math.abs(output.flowValue));flowValue&gt;0&amp;&amp;links.push({source:process.series.name,target:output.series.name,value:flowValue,sourceFormatted:process.formattedName,targetFormatted:output.formattedName,flowType:"unknown"!==process.systemType?process.systemType:"unknown",efficiency:calculateFlowEfficiency(process.flowValue,output.flowValue)})}})})});const efficiency=links.length&gt;0?links.reduce((sum,link)=&gt;sum+(link.efficiency||0),0)/links.length:0;return{nodes:nodes,links:links,systemType:systemType,totalFlow:totalFlow,efficiency:efficiency}})(validatedData,flowDetectionKeywords);if(validatedData.length&gt;=2){const fallbackNodes=validatedData.map(s=&gt;({name:s.name,formattedName:s.name,value:calculateAggregatedValue$1(s.data,"average"),unit:s.unit})),fallbackLinks=[];for(let i=0;i&lt;validatedData.length-1;i++)fallbackLinks.push({source:validatedData[i].name,target:validatedData[i+1].name,value:Math.abs(calculateAggregatedValue$1(validatedData[i].data,"average")),sourceFormatted:validatedData[i].name,targetFormatted:validatedData[i+1].name});return{nodes:fallbackNodes,links:fallbackLinks,systemType:"mixed",totalFlow:fallbackLinks.reduce((sum,link)=&gt;sum+link.value,0),efficiency:75}}return{nodes:[],links:[],systemType:"mixed",totalFlow:0,efficiency:0}},[validatedData,enableAutoFlowDetection,flowDetectionKeywords]),distinctColors=customColors||getDistinctColors(processedFlowData.nodes.length),option=reactExports.useMemo(()=&gt;{const{nodes:nodes,links:links}=processedFlowData,totalPoints=nodes.length+links.length,animationMode=CHART_DESIGN_TOKENS.adaptive.animationMode(totalPoints),isDarkMode="dark"===theme.palette.mode,processedLinks=links.map(link=&gt;link.timeseriesData&amp;&amp;link.timeseriesData.length&gt;0?{...link,value:calculateAggregatedValue$1(link.timeseriesData,link.aggregation)}:link),coloredNodes=nodes.map((node,index2)=&gt;{var _a,_b;return{...node,itemStyle:{color:(null==(_a=node.itemStyle)?void 0:_a.color)||distinctColors[index2%distinctColors.length],borderColor:(null==(_b=node.itemStyle)?void 0:_b.borderColor)||theme.palette.divider,...node.itemStyle}}}),sankeySpecificOptions={title:title?{...CHART_DESIGN_TOKENS.title.base,text:title,textStyle:{...CHART_DESIGN_TOKENS.title.base.textStyle,color:theme.palette.text.primary}}:void 0,tooltip:{...CHART_DESIGN_TOKENS.tooltip.base,trigger:"item",triggerOn:"mousemove",backgroundColor:isDarkMode?"rgba(50, 50, 50, 0.95)":"rgba(255, 255, 255, 0.95)",borderColor:isDarkMode?"rgba(255, 255, 255, 0.12)":"rgba(0, 0, 0, 0.12)",textStyle:{...CHART_DESIGN_TOKENS.tooltip.base.textStyle,color:theme.palette.text.primary},formatter:params=&gt;{if("node"===params.dataType){const node=params.data,incomingValue=processedLinks.filter(l=&gt;l.target===node.name).reduce((sum,l)=&gt;sum+l.value,0),outgoingValue=processedLinks.filter(l=&gt;l.source===node.name).reduce((sum,l)=&gt;sum+l.value,0),netFlow=incomingValue-outgoingValue,nodeUnit=node.unit||unit;let tooltip=`&lt;strong&gt;${node.formattedName||node.name}&lt;/strong&gt;&lt;br/&gt;`;return node.systemType&amp;&amp;"unknown"!==node.systemType&amp;&amp;(tooltip+=`System: ${node.systemType.charAt(0).toUpperCase()+node.systemType.slice(1)}&lt;br/&gt;`),node.nodeType&amp;&amp;(tooltip+=`Type: ${node.nodeType.charAt(0).toUpperCase()+node.nodeType.slice(1)}&lt;br/&gt;`),tooltip+=`Incoming: ${formatNumberForDisplay(incomingValue,2)} ${nodeUnit}&lt;br/&gt;`,tooltip+=`Outgoing: ${formatNumberForDisplay(outgoingValue,2)} ${nodeUnit}&lt;br/&gt;`,tooltip+=`Net Flow: ${formatNumberForDisplay(netFlow,2)} ${nodeUnit}`,void 0!==node.value&amp;&amp;(tooltip+=`&lt;br/&gt;Node Value: ${formatNumberForDisplay(node.value,2)} ${nodeUnit}`),tooltip}if("edge"===params.dataType){const link=params.data;let tooltip=`&lt;strong&gt;${link.sourceFormatted||link.source}  ${link.targetFormatted||link.target}&lt;/strong&gt;&lt;br/&gt;`;return tooltip+=`Flow Rate: ${formatNumberForDisplay(link.value,2)} ${unit}`,link.flowType&amp;&amp;"unknown"!==link.flowType&amp;&amp;(tooltip+=`&lt;br/&gt;Flow Type: ${link.flowType.charAt(0).toUpperCase()+link.flowType.slice(1)}`),void 0!==link.efficiency&amp;&amp;(tooltip+=`&lt;br/&gt;Efficiency: ${formatNumberForDisplay(link.efficiency,1)}%`),tooltip}return""}},series:[{type:"sankey",orient:orient,nodeWidth:nodeWidth,nodeGap:nodeGap,layoutIterations:layoutIterations,emphasis:{focus:"adjacency",blurScope:"global",itemStyle:{shadowBlur:10,shadowColor:"rgba(0, 0, 0, 0.5)"},lineStyle:{opacity:.6}},lineStyle:{color:"gradient",opacity:.3,curveness:.5},label:{show:!0,color:theme.palette.text.primary,fontSize:12,formatter:"{b}"},itemStyle:{borderWidth:1,borderColor:theme.palette.divider},data:coloredNodes,links:processedLinks,...CHART_DESIGN_TOKENS.animation[animationMode],select:{itemStyle:{borderColor:theme.palette.primary.main,borderWidth:3}},...onNodeClick&amp;&amp;{emphasis:{focus:"adjacency",blurScope:"global",itemStyle:{shadowBlur:15,shadowColor:theme.palette.primary.main,borderColor:theme.palette.primary.main,borderWidth:2}}}}],aria:{enabled:!0,label:{enabled:!0,description:`Sankey diagram showing ${title||processedFlowData.systemType+" system flow"} between ${nodes.length} nodes with ${processedLinks.length} connections. Total flow: ${formatNumberForDisplay(processedFlowData.totalFlow,2)} ${unit}. System efficiency: ${formatNumberForDisplay(processedFlowData.efficiency,1)}%`}},...onNodeClick||onFlowClick?{animation:!1}:{}};return mergeChartOptions(baseOptions,sankeySpecificOptions,{showToolbox:!0,enableDataView:!1,enableMagicType:!1,showDataZoom:!1,showLegend:!1})},[processedFlowData,title,theme,unit,orient,nodeWidth,nodeGap,layoutIterations,distinctColors,baseOptions,enableTimeAnimation,animationSpeed,onEdit,onDelete,onNodeClick,onFlowClick]);return finalLoading||finalError||0!==processedFlowData.nodes.length?jsxRuntimeExports.jsx(EChartsWrapper,{option:option,loading:finalLoading,error:finalError,height:height,theme:"dark"===theme.palette.mode?"dark":"light",onChartReady:chart=&gt;{chartId&amp;&amp;registerChartForActions(chartId,chart),groupId&amp;&amp;chartId&amp;&amp;addChartToGroup(chart,groupId),(onNodeClick||onFlowClick)&amp;&amp;chart.on("click",params=&gt;{if("node"===params.dataType&amp;&amp;onNodeClick){const nodeData=processedFlowData.nodes.find(n=&gt;n.name===params.data.name);nodeData&amp;&amp;onNodeClick(nodeData)}else if("edge"===params.dataType&amp;&amp;onFlowClick){const linkData=processedFlowData.links.find(l=&gt;l.source===params.data.source&amp;&amp;l.target===params.data.target);linkData&amp;&amp;onFlowClick(linkData)}}),onChartReady&amp;&amp;onChartReady(chart)}}):jsxRuntimeExports.jsxs(Box,{sx:{height:height,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",p:3,textAlign:"center",backgroundColor:theme.palette.background.paper,border:`1px dashed ${theme.palette.divider}`,borderRadius:1},children:[jsxRuntimeExports.jsx(Typography,{variant:"h6",color:"text.secondary",gutterBottom:!0,children:"No Flow Data Available"}),jsxRuntimeExports.jsx(Typography,{variant:"body2",color:"text.secondary",sx:{mb:2},children:"To visualize building system flows, select points that represent:"}),jsxRuntimeExports.jsxs(Box,{component:"ul",sx:{textAlign:"left",color:"text.secondary"},children:[jsxRuntimeExports.jsx("li",{children:"Energy flow: Power consumption, electrical demand"}),jsxRuntimeExports.jsx("li",{children:"Air flow: Supply air, return air, AHU systems"}),jsxRuntimeExports.jsx("li",{children:"Water flow: Chilled water supply/return, pumps"}),jsxRuntimeExports.jsx("li",{children:"Steam flow: Boiler supply, condensate return"})]}),jsxRuntimeExports.jsx(Typography,{variant:"caption",color:"text.secondary",sx:{mt:2},children:'Point names should include keywords like "supply", "return", "AHU", "CHW", etc.'})]})},(prevProps,nextProps)=&gt;prevProps.loading===nextProps.loading&amp;&amp;prevProps.error===nextProps.error&amp;&amp;prevProps.height===nextProps.height&amp;&amp;prevProps.title===nextProps.title&amp;&amp;prevProps.unit===nextProps.unit&amp;&amp;prevProps.orient===nextProps.orient&amp;&amp;prevProps.nodeWidth===nextProps.nodeWidth&amp;&amp;prevProps.nodeGap===nextProps.nodeGap&amp;&amp;prevProps.layoutIterations===nextProps.layoutIterations&amp;&amp;prevProps.groupId===nextProps.groupId&amp;&amp;prevProps.chartId===nextProps.chartId&amp;&amp;prevProps.enableAutoFlowDetection===nextProps.enableAutoFlowDetection&amp;&amp;prevProps.systemGrouping===nextProps.systemGrouping&amp;&amp;prevProps.enableTimeAnimation===nextProps.enableTimeAnimation&amp;&amp;prevProps.animationSpeed===nextProps.animationSpeed&amp;&amp;(prevProps.data===nextProps.data&amp;&amp;(prevProps.onChartReady===nextProps.onChartReady&amp;&amp;prevProps.onEdit===nextProps.onEdit&amp;&amp;prevProps.onDelete===nextProps.onDelete&amp;&amp;prevProps.onNodeClick===nextProps.onNodeClick&amp;&amp;prevProps.onFlowClick===nextProps.onFlowClick))),calculateAggregatedValue=(data,aggregation="sum")=&gt;{if(!data||0===data.length)return 0;switch(aggregation){case"sum":default:return data.reduce((sum,[_,value])=&gt;sum+value,0);case"average":return data.reduce((sum,[_,value])=&gt;sum+value,0)/data.length;case"latest":return data[data.length-1][1];case"max":return Math.max(...data.map(([_,value])=&gt;value));case"min":return Math.min(...data.map(([_,value])=&gt;value))}},calculateEfficiency=node=&gt;{if(!node.timeseriesData||0===node.timeseriesData.length)return.5;const values=node.timeseriesData.map(([_,value])=&gt;value),mean=values.reduce((sum,val)=&gt;sum+val,0)/values.length,coefficient=values.reduce((sum,val)=&gt;sum+Math.pow(val-mean,2),0)/values.length/(mean||1);return Math.max(0,Math.min(1,1-coefficient/10))},transformToTreemapData=(data,props)=&gt;{if(!data||0===data.length)return[];const{aggregationMethod:aggregationMethod="sum",hierarchySeparator:hierarchySeparator="/",maxHierarchyLevels:maxHierarchyLevels=4,autoDetectHierarchy:autoDetectHierarchy=!0,colorByEfficiency:colorByEfficiency=!1}=props;if(!autoDetectHierarchy)return data.map(series=&gt;({name:series.name,value:Math.abs(calculateAggregatedValue(series.data,aggregationMethod)),unit:series.unit,timeseriesData:series.data,aggregation:aggregationMethod,originalPointName:series.name,level:0,path:[series.name],efficiency:colorByEfficiency?calculateEfficiency({name:series.name,timeseriesData:series.data}):void 0}));const hierarchicalData=((seriesData,options)=&gt;{const{separator:separator,maxLevels:maxLevels,aggregation:aggregation}=options,tree=new Map;seriesData.forEach(series=&gt;{const hierarchy=((name,separator="/")=&gt;{if(!name)return["Unknown"];const parts=name.split(separator).map(part=&gt;part.trim()).filter(part=&gt;part.length&gt;0);return parts.length&gt;0?parts:[name]})(series.name,separator),truncatedHierarchy=hierarchy.slice(0,maxLevels),value=calculateAggregatedValue(series.data,aggregation);let currentPath="",currentLevel=tree;truncatedHierarchy.forEach((part,index2)=&gt;{const isLast=index2===truncatedHierarchy.length-1,pathKey=currentPath?`${currentPath}${separator}${part}`:part;if(!currentLevel.has(pathKey)){const node={name:part,level:index2,path:truncatedHierarchy.slice(0,index2+1),parentName:index2&gt;0?truncatedHierarchy[index2-1]:void 0,originalPointName:series.name,unit:series.unit,category:truncatedHierarchy[0],children:isLast?void 0:[],value:isLast?Math.abs(value):0,timeseriesData:isLast?series.data:void 0,aggregation:aggregation};currentLevel.set(pathKey,node)}if(currentPath=pathKey,!isLast){const node=currentLevel.get(pathKey);node.children||(node.children=[]),node.childrenMap||(node.childrenMap=new Map),currentLevel=node.childrenMap}})});const convertMapToArray=nodeMap=&gt;Array.from(nodeMap.values()).map(node=&gt;{if(node.childrenMap&amp;&amp;(node.children=convertMapToArray(node.childrenMap),delete node.childrenMap,node.children&amp;&amp;node.children.length&gt;0)){const childValues=node.children.map(child=&gt;child.value||0);switch(aggregation){case"sum":case"latest":default:node.value=childValues.reduce((sum,val)=&gt;sum+val,0);break;case"average":node.value=childValues.reduce((sum,val)=&gt;sum+val,0)/childValues.length;break;case"max":node.value=Math.max(...childValues);break;case"min":node.value=Math.min(...childValues)}}return node});return convertMapToArray(tree)})(data,{separator:hierarchySeparator,maxLevels:maxHierarchyLevels,aggregation:aggregationMethod});if(colorByEfficiency){const addEfficiencyToTree=nodes=&gt;nodes.map(node=&gt;({...node,efficiency:calculateEfficiency(node),children:node.children?addEfficiencyToTree(node.children):void 0}));return addEfficiencyToTree(hierarchicalData)}return hierarchicalData},processTreemapData=(nodes,efficiencyThresholds)=&gt;nodes.map(node=&gt;{if(node.children)return{...node,children:processTreemapData(node.children,efficiencyThresholds)};if(node.timeseriesData&amp;&amp;node.timeseriesData.length&gt;0){const processedNode={...node,value:calculateAggregatedValue(node.timeseriesData,node.aggregation)};if(void 0!==node.efficiency&amp;&amp;efficiencyThresholds){const{good:good,warning:warning,critical:critical}=efficiencyThresholds;let color;color=node.efficiency&gt;=good?"#4CAF50":node.efficiency&gt;=warning?"#FF9800":node.efficiency&gt;=critical?"#F44336":"#9E9E9E",processedNode.itemStyle={...processedNode.itemStyle,color:color}}return processedNode}return node}),EChartsTreemap$1=React.memo(({data:data,loading:loading,error:error,height:height="500px",title:title,unit:unit="",leafDepth:leafDepth=3,roam:roam=!0,nodeClick:nodeClick="zoomToNode",breadcrumb:breadcrumb=!0,groupId:groupId,chartId:chartId,customColors:customColors,onChartReady:onChartReady,onEdit:onEdit,onDelete:onDelete,aggregationMethod:aggregationMethod="sum",hierarchySeparator:hierarchySeparator="/",maxHierarchyLevels:maxHierarchyLevels=4,autoDetectHierarchy:autoDetectHierarchy=!0,colorByEfficiency:colorByEfficiency=!1,efficiencyThresholds:efficiencyThresholds={good:.8,warning:.6,critical:.4},sizeByValue:sizeByValue=!0,enableDrillDown:enableDrillDown=!0,onNodeSelect:onNodeSelect})=&gt;{const theme=useTheme(),distinctColors=customColors||getDistinctColors(20),containerRef=reactExports.useRef(null),chartInstanceRef=reactExports.useRef(null);reactExports.useEffect(()=&gt;{const handleResize=()=&gt;{chartInstanceRef.current&amp;&amp;chartInstanceRef.current.resize()},handleGridResize=()=&gt;{chartInstanceRef.current&amp;&amp;chartInstanceRef.current.resize()};return window.addEventListener("resize",handleResize),window.addEventListener("grid-resize",handleGridResize),()=&gt;{window.removeEventListener("resize",handleResize),window.removeEventListener("grid-resize",handleGridResize)}},[]);const baseOptions=useBaseChartOptions(),option=reactExports.useMemo(()=&gt;{const countNodes=nodes=&gt;nodes.reduce((sum,node)=&gt;sum+1+(node.children?countNodes(node.children):0),0),transformedData=transformToTreemapData(data,{aggregationMethod:aggregationMethod,hierarchySeparator:hierarchySeparator,maxHierarchyLevels:maxHierarchyLevels,autoDetectHierarchy:autoDetectHierarchy,colorByEfficiency:colorByEfficiency}),processedData=processTreemapData(transformedData,colorByEfficiency?efficiencyThresholds:void 0),totalPoints=countNodes(processedData),animationMode=CHART_DESIGN_TOKENS.adaptive.animationMode(totalPoints),isDarkMode="dark"===theme.palette.mode,treemapSpecificOptions={title:title?{...CHART_DESIGN_TOKENS.title.base,text:title,textStyle:{...CHART_DESIGN_TOKENS.title.base.textStyle,color:theme.palette.text.primary}}:void 0,tooltip:{...CHART_DESIGN_TOKENS.tooltip.base,trigger:"item",backgroundColor:isDarkMode?"rgba(50, 50, 50, 0.95)":"rgba(255, 255, 255, 0.95)",borderColor:isDarkMode?"rgba(255, 255, 255, 0.12)":"rgba(0, 0, 0, 0.12)",textStyle:{...CHART_DESIGN_TOKENS.tooltip.base.textStyle,color:theme.palette.text.primary},formatter:params=&gt;{const data2=params.data,value=data2.value||0,treePathInfo=params.treePathInfo,treePath=treePathInfo.map(node=&gt;node.formattedName||node.name).join("  ");let percentage=100;if(treePathInfo.length&gt;1){const parent=treePathInfo[treePathInfo.length-2];parent.value&gt;0&amp;&amp;(percentage=value/parent.value*100)}let tooltipContent=`&lt;strong&gt;${treePath}&lt;/strong&gt;&lt;br/&gt;`;return tooltipContent+=`Value: ${formatNumberForDisplay(value,2)} ${data2.unit||unit}&lt;br/&gt;`,tooltipContent+=`Percentage: ${percentage.toFixed(1)}%&lt;br/&gt;`,void 0!==data2.efficiency&amp;&amp;(tooltipContent+=`Efficiency: ${(100*data2.efficiency).toFixed(1)}%&lt;br/&gt;`),data2.originalPointName&amp;&amp;data2.originalPointName!==data2.name&amp;&amp;(tooltipContent+=`Original: ${data2.originalPointName}&lt;br/&gt;`),data2.aggregation&amp;&amp;data2.timeseriesData&amp;&amp;(tooltipContent+=`Aggregation: ${data2.aggregation} (${data2.timeseriesData.length} points)&lt;br/&gt;`),tooltipContent+=data2.children?`Children: ${data2.children.length}`:"Leaf node",enableDrillDown&amp;&amp;data2.children&amp;&amp;(tooltipContent+="&lt;br/&gt;&lt;em&gt;Click to drill down&lt;/em&gt;"),tooltipContent}},series:[{type:"treemap",data:processedData,leafDepth:leafDepth,roam:roam,nodeClick:nodeClick,breadcrumb:breadcrumb?{show:!0,left:"center",bottom:10,itemStyle:{color:theme.palette.primary.main,borderColor:theme.palette.divider,textStyle:{color:theme.palette.text.primary}},emphasis:{itemStyle:{color:theme.palette.primary.dark}}}:{show:!1},label:{show:!0,position:"inside",color:"#fff",fontSize:12,formatter:params=&gt;{const data2=params.data,value=formatNumberForDisplay(data2.value||0,0);return`{name|${data2.formattedName||data2.name}}\n{value|${value} ${data2.unit||unit}}`},rich:{name:{fontSize:14,fontWeight:"bold",lineHeight:20},value:{fontSize:12,lineHeight:20,color:"rgba(255, 255, 255, 0.8)"}}},upperLabel:{show:!0,height:30,color:theme.palette.text.primary,backgroundColor:"dark"===theme.palette.mode?"rgba(0, 0, 0, 0.7)":"rgba(255, 255, 255, 0.7)"},itemStyle:{borderColor:theme.palette.divider,borderWidth:2,gapWidth:2,borderColorSaturation:.6},levels:[{itemStyle:{borderColor:theme.palette.divider,borderWidth:0,gapWidth:2},upperLabel:{show:!1}},{itemStyle:{borderColor:theme.palette.divider,borderWidth:3,gapWidth:2},emphasis:{itemStyle:{borderColor:theme.palette.primary.main}}},{colorSaturation:[.35,.5],itemStyle:{borderWidth:3,gapWidth:1,borderColorSaturation:.6}}],colorMappingBy:"index",color:colorByEfficiency?void 0:distinctColors,visibleMin:300,childrenVisibleMin:30,...CHART_DESIGN_TOKENS.animation[animationMode],emphasis:{focus:"descendant",itemStyle:{borderWidth:4,borderColor:theme.palette.primary.main},label:{fontSize:16,fontWeight:"bold"}},...enableDrillDown&amp;&amp;onNodeSelect?{emphasis:{focus:"descendant",itemStyle:{borderWidth:4,borderColor:theme.palette.primary.main}}}:{}}],aria:{enabled:!0,label:{enabled:!0,description:`Treemap visualization showing hierarchical ${title||"data"} structure`}}};return mergeChartOptions(baseOptions,treemapSpecificOptions,{showToolbox:!0,enableDataView:!1,enableMagicType:!1,showDataZoom:!1,showLegend:!1})},[baseOptions,data,title,theme,unit,leafDepth,roam,nodeClick,breadcrumb,distinctColors,onEdit,onDelete,aggregationMethod,hierarchySeparator,maxHierarchyLevels,autoDetectHierarchy,colorByEfficiency,efficiencyThresholds,sizeByValue,enableDrillDown,onNodeSelect]),validData=reactExports.useMemo(()=&gt;Array.isArray(data)?data.filter(series=&gt;series&amp;&amp;"string"==typeof series.name&amp;&amp;Array.isArray(series.data)&amp;&amp;series.data.length&gt;0):[],[data]);return jsxRuntimeExports.jsx(Box,{ref:containerRef,sx:{position:"relative",height:height,width:"100%",overflow:"hidden"},children:jsxRuntimeExports.jsx(EChartsWrapper,{option:option,loading:loading||0===validData.length,error:error||(0===validData.length?new Error("No valid data provided for treemap visualization"):null),height:"100%",theme:"dark"===theme.palette.mode?"dark":"light",onChartReady:chart=&gt;{chartInstanceRef.current=chart,(chart=&gt;{chartId&amp;&amp;registerChartForActions(chartId,chart),groupId&amp;&amp;chartId&amp;&amp;addChartToGroup(chart,groupId),enableDrillDown&amp;&amp;onNodeSelect&amp;&amp;chart.on("click",params=&gt;{if(params.data&amp;&amp;params.treePathInfo){const path=params.treePathInfo.map(node=&gt;node.name);onNodeSelect(params.data,path)}}),onChartReady&amp;&amp;onChartReady(chart)})(chart)}})})},(prevProps,nextProps)=&gt;{if(prevProps.loading!==nextProps.loading||prevProps.error!==nextProps.error||prevProps.height!==nextProps.height||prevProps.title!==nextProps.title||prevProps.unit!==nextProps.unit||prevProps.leafDepth!==nextProps.leafDepth||prevProps.roam!==nextProps.roam||prevProps.nodeClick!==nextProps.nodeClick||prevProps.breadcrumb!==nextProps.breadcrumb||prevProps.groupId!==nextProps.groupId||prevProps.chartId!==nextProps.chartId||prevProps.aggregationMethod!==nextProps.aggregationMethod||prevProps.hierarchySeparator!==nextProps.hierarchySeparator||prevProps.maxHierarchyLevels!==nextProps.maxHierarchyLevels||prevProps.autoDetectHierarchy!==nextProps.autoDetectHierarchy||prevProps.colorByEfficiency!==nextProps.colorByEfficiency||prevProps.sizeByValue!==nextProps.sizeByValue||prevProps.enableDrillDown!==nextProps.enableDrillDown)return!1;if(prevProps.efficiencyThresholds!==nextProps.efficiencyThresholds){if(!prevProps.efficiencyThresholds||!nextProps.efficiencyThresholds)return!1;if(prevProps.efficiencyThresholds.good!==nextProps.efficiencyThresholds.good||prevProps.efficiencyThresholds.warning!==nextProps.efficiencyThresholds.warning||prevProps.efficiencyThresholds.critical!==nextProps.efficiencyThresholds.critical)return!1}if(prevProps.data!==nextProps.data){if(prevProps.data.length&gt;10||nextProps.data.length&gt;10)return!1;if(prevProps.data.length!==nextProps.data.length)return!1;for(let i=0;i&lt;prevProps.data.length;i++){const prevNode=prevProps.data[i],nextNode=nextProps.data[i];if(prevNode.name!==nextNode.name||prevNode.value!==nextNode.value||prevNode.children!==nextNode.children||prevNode.timeseriesData!==nextNode.timeseriesData||prevNode.aggregation!==nextNode.aggregation||prevNode.unit!==nextNode.unit||prevNode.itemStyle!==nextNode.itemStyle)return!1}}if(prevProps.customColors!==nextProps.customColors){if(!prevProps.customColors||!nextProps.customColors)return!1;if(prevProps.customColors.length!==nextProps.customColors.length)return!1;for(let i=0;i&lt;prevProps.customColors.length;i++)if(prevProps.customColors[i]!==nextProps.customColors[i])return!1}return prevProps.onChartReady===nextProps.onChartReady&amp;&amp;prevProps.onNodeSelect===nextProps.onNodeSelect}),ALERT_TYPES_outOfBounds={icon:""},ALERT_TYPES_warningZone={icon:""},ALERT_TYPES_optimal={icon:""},EChartsControlBandChart$1=React.memo(({data:data,series:series,title:title="Control Band Chart",height:height=500,loading:loading=!1,error:error,onEdit:onEdit,onDelete:onDelete,onChartReady:onChartReady,timeRange:timeRange,upperLimit:upperLimit,lowerLimit:lowerLimit,targetValue:targetValue,warningThreshold:warningThreshold=10,showBackgroundZones:showBackgroundZones=!0,showAlerts:showAlerts=!0,selectedPoints:selectedPoints,enableToolbox:enableToolbox=!0})=&gt;{const theme=useTheme(),baseOptions=useBaseChartOptions(),[alertsExpanded,setAlertsExpanded]=reactExports.useState(!0),[alertsDismissed,setAlertsDismissed]=reactExports.useState(!1),controlBands=reactExports.useMemo(()=&gt;{const warningOffset=warningThreshold/100*(upperLimit-lowerLimit);return{ucl:upperLimit,lcl:lowerLimit,centerLine:targetValue??(upperLimit+lowerLimit)/2,upperWarning:upperLimit-warningOffset,lowerWarning:lowerLimit+warningOffset}},[upperLimit,lowerLimit,targetValue,warningThreshold]),alerts=reactExports.useMemo(()=&gt;{var _a;const detectedAlerts=[],chartData=series||(null==data?void 0:data.series)||data||[];if(!chartData||0===chartData.length)return[];const seriesData=Array.isArray(chartData)?chartData[0]:chartData,values=(null==(_a=null==seriesData?void 0:seriesData.data)?void 0:_a.map((point,index2)=&gt;({index:index2,value:Array.isArray(point)?point[1]:(null==point?void 0:point.value)||point,timestamp:Array.isArray(point)?point[0]:null==point?void 0:point.timestamp})).filter(v=&gt;null!=v.value&amp;&amp;!isNaN(v.value)))||[];if(0===values.length)return[];const outOfBounds=values.filter(p=&gt;p.value&gt;controlBands.ucl||p.value&lt;controlBands.lcl),inWarningZone=values.filter(p=&gt;p.value&gt;controlBands.upperWarning&amp;&amp;p.value&lt;=controlBands.ucl||p.value&lt;controlBands.lowerWarning&amp;&amp;p.value&gt;=controlBands.lcl);return outOfBounds.length&gt;0&amp;&amp;detectedAlerts.push({type:"out-of-bounds",count:outOfBounds.length,percentage:outOfBounds.length/values.length*100,points:outOfBounds.slice(0,5).map(p=&gt;({timestamp:p.timestamp,value:p.value,deviation:p.value&gt;controlBands.ucl?p.value-controlBands.ucl:controlBands.lcl-p.value})),message:`${outOfBounds.length} reading${outOfBounds.length&gt;1?"s":""} outside operating limits`,severity:"error",icon:ALERT_TYPES_outOfBounds.icon}),inWarningZone.length&gt;0&amp;&amp;detectedAlerts.push({type:"warning-zone",count:inWarningZone.length,percentage:inWarningZone.length/values.length*100,points:inWarningZone.slice(0,3).map(p=&gt;({timestamp:p.timestamp,value:p.value,deviation:0})),message:`${inWarningZone.length} reading${inWarningZone.length&gt;1?"s":""} in warning zone`,severity:"warning",icon:ALERT_TYPES_warningZone.icon}),0===outOfBounds.length&amp;&amp;0===inWarningZone.length&amp;&amp;values.length&gt;0&amp;&amp;detectedAlerts.push({type:"optimal",count:values.length,percentage:100,points:[],message:"All readings within optimal range",severity:"success",icon:ALERT_TYPES_optimal.icon}),detectedAlerts},[data,series,controlBands]),chartOption=reactExports.useMemo(()=&gt;{const isDarkMode="dark"===theme.palette.mode,chartData=series||(null==data?void 0:data.series)||data||[];if(!chartData||0===chartData.length)return baseOptions;const seriesData=Array.isArray(chartData)?chartData[0]:chartData,chartValues=(null==seriesData?void 0:seriesData.data)||[],totalPoints=chartValues.length,animationMode=CHART_DESIGN_TOKENS.adaptive.animationMode(totalPoints),formattedName=(null==seriesData?void 0:seriesData.markerTags)?formatPointWithTags({name:seriesData.name||"Process Value",markerTags:seriesData.markerTags,unit:seriesData.unit},{maxTags:2,includeUnit:!1}):(null==seriesData?void 0:seriesData.name)||"Process Value",mainSeries={name:formattedName,type:"line",data:chartValues,smooth:!1,lineStyle:{width:2,color:theme.palette.primary.main},symbol:"circle",symbolSize:value=&gt;{const y=value[1];return y&gt;controlBands.ucl||y&lt;controlBands.lcl?10:y&gt;controlBands.upperWarning||y&lt;controlBands.lowerWarning?7:5},itemStyle:{color:params=&gt;{const value=params.value[1];return value&gt;controlBands.ucl||value&lt;controlBands.lcl?theme.palette.error.main:value&gt;controlBands.upperWarning||value&lt;controlBands.lowerWarning?theme.palette.warning.main:theme.palette.success.main}},markArea:showBackgroundZones?{silent:!0,data:[[{yAxis:controlBands.ucl,itemStyle:{color:"rgba(244, 67, 54, 0.1)",borderColor:theme.palette.error.main,borderWidth:2,borderType:"solid"}},{yAxis:"max"}],[{yAxis:"min",itemStyle:{color:"rgba(244, 67, 54, 0.1)",borderColor:theme.palette.error.main,borderWidth:2,borderType:"solid"}},{yAxis:controlBands.lcl}],[{yAxis:controlBands.upperWarning,itemStyle:{color:"rgba(255, 193, 7, 0.1)"}},{yAxis:controlBands.ucl}],[{yAxis:controlBands.lcl,itemStyle:{color:"rgba(255, 193, 7, 0.1)"}},{yAxis:controlBands.lowerWarning}],[{yAxis:controlBands.lowerWarning,itemStyle:{color:"rgba(76, 175, 80, 0.15)",borderColor:theme.palette.success.main,borderWidth:1,borderType:"dashed"}},{yAxis:controlBands.upperWarning}]]}:void 0,markLine:{symbol:"none",label:{position:"insideEndTop",formatter:"{b}",fontSize:11,padding:[2,4],backgroundColor:"rgba(255, 255, 255, 0.8)",borderRadius:2},data:[{yAxis:controlBands.ucl,name:`Upper: ${formatNumberForDisplay(controlBands.ucl)}`,label:{position:"insideEndTop",color:theme.palette.error.main},lineStyle:{color:theme.palette.error.main,type:"solid",width:2}},{yAxis:controlBands.centerLine,name:`Target: ${formatNumberForDisplay(controlBands.centerLine)}`,label:{position:"insideEndTop",color:theme.palette.success.main},lineStyle:{color:theme.palette.success.main,type:"dashed",width:2}},{yAxis:controlBands.lcl,name:`Lower: ${formatNumberForDisplay(controlBands.lcl)}`,label:{position:"insideEndBottom",color:theme.palette.error.main},lineStyle:{color:theme.palette.error.main,type:"solid",width:2}},...controlBands.upperWarning?[{yAxis:controlBands.upperWarning,name:"Warning High",lineStyle:{color:theme.palette.warning.main,type:"dotted",width:1}}]:[],...controlBands.lowerWarning?[{yAxis:controlBands.lowerWarning,name:"Warning Low",lineStyle:{color:theme.palette.warning.main,type:"dotted",width:1}}]:[]]}},option={...CHART_DESIGN_TOKENS.animation[animationMode],title:title?{...CHART_DESIGN_TOKENS.title.base,text:title,textStyle:{...CHART_DESIGN_TOKENS.title.base.textStyle,color:theme.palette.text.primary}}:void 0,tooltip:{...CHART_DESIGN_TOKENS.tooltip.base,backgroundColor:isDarkMode?"rgba(50, 50, 50, 0.95)":"rgba(255, 255, 255, 0.95)",borderColor:isDarkMode?"rgba(255, 255, 255, 0.12)":"rgba(0, 0, 0, 0.12)",textStyle:{...CHART_DESIGN_TOKENS.tooltip.base.textStyle,color:theme.palette.text.primary},trigger:"axis",axisPointer:{type:"cross"},formatter:params=&gt;{var _a,_b;if(!Array.isArray(params)||0===params.length)return"";const param=params[0],timestamp=null==(_a=param.value)?void 0:_a[0],value=null==(_b=param.value)?void 0:_b[1];let tooltipHtml=`&lt;div style="padding: 8px;"&gt;\n            &lt;div style="font-weight: 600; margin-bottom: 8px;"&gt;\n              ${ChartTimeFormatter.tooltip(timestamp)}\n            &lt;/div&gt;\n            &lt;div style="display: flex; align-items: center; gap: 8px;"&gt;\n              &lt;div style="width: 10px; height: 10px; background: ${param.color}; border-radius: 50%;"&gt;&lt;/div&gt;\n              &lt;span&gt;${formattedName}: &lt;strong&gt;${formatNumberForDisplay(value)}${(null==seriesData?void 0:seriesData.unit)?" "+seriesData.unit:""}&lt;/strong&gt;&lt;/span&gt;\n            &lt;/div&gt;`;return value&gt;controlBands.ucl||value&lt;controlBands.lcl?tooltipHtml+=`&lt;div style="margin-top: 8px; color: ${theme.palette.error.main};"&gt;\n              &lt;strong&gt; Out of Bounds&lt;/strong&gt;\n            &lt;/div&gt;`:value&gt;controlBands.upperWarning||value&lt;controlBands.lowerWarning?tooltipHtml+=`&lt;div style="margin-top: 8px; color: ${theme.palette.warning.main};"&gt;\n              &lt;strong&gt; Warning Zone&lt;/strong&gt;\n            &lt;/div&gt;`:tooltipHtml+=`&lt;div style="margin-top: 8px; color: ${theme.palette.success.main};"&gt;\n              &lt;strong&gt; Optimal Range&lt;/strong&gt;\n            &lt;/div&gt;`,tooltipHtml+="&lt;/div&gt;",tooltipHtml}},legend:{show:!1},grid:{...CHART_DESIGN_TOKENS.grid.base,left:"3%",right:"15%",top:calculateGridTop({hasTitle:!!title,hasToolbox:!0}),bottom:60,containLabel:!0},xAxis:{type:"time",boundaryGap:!1,axisLabel:{formatter:value=&gt;new Date(value).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0}),color:theme.palette.text.secondary,fontSize:11,rotate:45,align:"right",verticalAlign:"top"},splitLine:{show:!1}},yAxis:{type:"value",name:(null==seriesData?void 0:seriesData.unit)||"Value",nameTextStyle:{color:theme.palette.text.secondary,fontSize:11},axisLabel:{color:theme.palette.text.secondary,formatter:value=&gt;formatNumberForDisplay(value),fontSize:11},splitLine:{lineStyle:{color:theme.palette.divider,type:"dashed"}},min:value=&gt;{const dataMin=Math.min(value.min,controlBands.lcl),dataMax=Math.max(value.max,controlBands.ucl),range=Math.abs(dataMax-dataMin);let padding;return padding=0===range?.1*Math.abs(dataMin)||1:range&lt;.01?.2*range:range&lt;.1?.15*range:range&lt;1?.1*range:range&lt;10?.08*range:range&lt;100?.05*range:.03*range,Math.abs(dataMin)&lt;1&amp;&amp;padding&lt;.001&amp;&amp;(padding=.001),dataMin-padding},max:value=&gt;{const dataMin=Math.min(value.min,controlBands.lcl),dataMax=Math.max(value.max,controlBands.ucl),range=Math.abs(dataMax-dataMin);let padding;return padding=0===range?.1*Math.abs(dataMax)||1:range&lt;.01?.2*range:range&lt;.1?.15*range:range&lt;1?.1*range:range&lt;10?.08*range:range&lt;100?.05*range:.03*range,Math.abs(dataMax)&lt;1&amp;&amp;padding&lt;.001&amp;&amp;(padding=.001),dataMax+padding}},dataZoom:[{type:"inside",start:0,end:100,filterMode:"none"},{type:"slider",start:0,end:100,filterMode:"none",bottom:5,height:20}],series:[mainSeries]};return mergeChartOptions(baseOptions,option,{showToolbox:enableToolbox,enableDataView:!0,showDataZoom:!0,showLegend:!1})},[data,series,title,theme,baseOptions,controlBands,alerts,enableToolbox,onEdit,onDelete]);return reactExports.useMemo(()=&gt;{if("string"==typeof height)return height;if(alerts.length&gt;0&amp;&amp;alertsExpanded&amp;&amp;!alertsDismissed&amp;&amp;showAlerts){const alertsHeight=Math.min(200,80+60*alerts.length);return Math.max(300,height-alertsHeight-40)}return height},[height,alerts.length,alertsExpanded,alertsDismissed,showAlerts]),jsxRuntimeExports.jsxs(Box,{sx:{height:"100%",display:"flex",flexDirection:"column",position:"relative",pt:5},children:[showAlerts&amp;&amp;alerts.length&gt;0&amp;&amp;!alertsDismissed&amp;&amp;jsxRuntimeExports.jsxs(Paper,{elevation:0,sx:{p:1,mb:1,backgroundColor:"dark"===theme.palette.mode?"rgba(255, 255, 255, 0.05)":"rgba(0, 0, 0, 0.02)",border:`1px solid ${theme.palette.divider}`,borderRadius:1,position:{xs:"relative",md:"relative"},zIndex:10},children:[jsxRuntimeExports.jsxs(Stack,{direction:"row",spacing:1,alignItems:"center",sx:{mb:alertsExpanded?1:0},children:[jsxRuntimeExports.jsx(IconButton,{size:"small",onClick:()=&gt;setAlertsExpanded(!alertsExpanded),sx:{p:.5},children:alertsExpanded?jsxRuntimeExports.jsx(ExpandLess,{}):jsxRuntimeExports.jsx(ExpandMoreIcon,{})}),jsxRuntimeExports.jsx(Typography$1,{variant:"subtitle2",fontWeight:"bold",sx:{flexGrow:1},children:"Operating Status"}),jsxRuntimeExports.jsx(Chip,{label:`${alerts.filter(a=&gt;"optimal"!==a.type).length} Alert${1!==alerts.filter(a=&gt;"optimal"!==a.type).length?"s":""}`,color:alerts.some(a=&gt;"error"===a.severity)?"error":alerts.some(a=&gt;"warning"===a.severity)?"warning":"success",size:"small",sx:{height:20}}),jsxRuntimeExports.jsx(IconButton,{size:"small",onClick:()=&gt;setAlertsDismissed(!0),sx:{p:.5},children:jsxRuntimeExports.jsx(Close,{fontSize:"small"})})]}),jsxRuntimeExports.jsx(Collapse,{in:alertsExpanded,children:jsxRuntimeExports.jsxs(Stack,{spacing:.5,children:[alerts.filter(a=&gt;"optimal"!==a.type).slice(0,2).map((alert,index2)=&gt;jsxRuntimeExports.jsx(Alert,{severity:alert.severity,icon:jsxRuntimeExports.jsx("span",{style:{fontSize:"16px"},children:alert.icon}),sx:{py:.5,"&amp; .MuiAlert-message":{py:.5}},children:jsxRuntimeExports.jsx(Typography$1,{variant:"caption",fontWeight:"bold",children:alert.message})},index2)),alerts.filter(a=&gt;"optimal"!==a.type).length&gt;2&amp;&amp;jsxRuntimeExports.jsxs(Typography$1,{variant:"caption",color:"text.secondary",sx:{pl:1},children:["+",alerts.filter(a=&gt;"optimal"!==a.type).length-2," more alert",alerts.filter(a=&gt;"optimal"!==a.type).length-2&gt;1?"s":"","..."]})]})})]}),showAlerts&amp;&amp;alerts.length&gt;0&amp;&amp;alertsDismissed&amp;&amp;jsxRuntimeExports.jsxs(Button,{size:"small",onClick:()=&gt;setAlertsDismissed(!1),sx:{mb:1,alignSelf:"flex-start"},children:["Show ",alerts.filter(a=&gt;"optimal"!==a.type).length," alert",1!==alerts.filter(a=&gt;"optimal"!==a.type).length?"s":""]}),showAlerts&amp;&amp;alerts.some(a=&gt;"optimal"===a.type)&amp;&amp;data&amp;&amp;jsxRuntimeExports.jsx(Alert,{severity:"success",sx:{mb:1,py:.5},children:jsxRuntimeExports.jsx(Typography$1,{variant:"caption",fontWeight:"bold",children:" System Operating Optimally - All readings within target range"})}),jsxRuntimeExports.jsx(Box,{sx:{flex:1,minHeight:0},children:jsxRuntimeExports.jsx(EChartsWrapper,{option:chartOption,height:"100%",loading:loading,error:error,onChartReady:onChartReady,theme:theme.palette.mode,notMerge:!1,lazyUpdate:!0})}),jsxRuntimeExports.jsx(Box,{sx:{mt:1,display:"flex",justifyContent:"space-between",alignItems:"center",px:1},children:jsxRuntimeExports.jsxs(Typography$1,{variant:"caption",color:"text.secondary",sx:{fontSize:"0.7rem"},children:["Upper: ",formatNumberForDisplay(upperLimit)," |"," ","Target: ",formatNumberForDisplay(controlBands.centerLine)," |"," ","Lower: ",formatNumberForDisplay(lowerLimit)," "," | Warning: ",warningThreshold,"%",timeRange&amp;&amp;` | Range: ${timeRange}`]})})]})}),HEALTH_SCORE_EXPLANATION={factors:[{name:"Airflow Tracking",weight:30,description:"How well actual airflow follows setpoint"},{name:"Damper Response",weight:25,description:"Damper efficiency and response time"},{name:"Temperature Control",weight:25,description:"Discharge air temp control accuracy"},{name:"Energy Efficiency",weight:20,description:"Heating/cooling overlap and waste"}],levels:[{min:90,label:"Excellent",color:"#4caf50",description:"System operating optimally"},{min:75,label:"Good",color:"#8bc34a",description:"Minor adjustments may improve performance"},{min:60,label:"Fair",color:"#ff9800",description:"Performance issues detected, maintenance recommended"},{min:40,label:"Poor",color:"#ff5722",description:"Significant issues, immediate attention needed"},{min:0,label:"Critical",color:"#f44336",description:"System failure or severe malfunction"}]},VIEW_MODE_INFO={panel:{title:"Panel View",panels:["Airflow &amp; Setpoint tracking","Damper position and efficiency","Temperature control (DAT, EAT, Room)","Energy usage (Heating signal)"]},overlay:{title:"Overlay View",features:["Combined visualization","Easier pattern recognition","Simplified export"]}},GuidedPointSelection=({categories:categories,availablePoints:availablePoints,selectedPoints:selectedPoints,onSelectionChange:onSelectionChange,onComplete:onComplete,onBack:onBack,title:title="Select Points",description:description="Choose points for each category"})=&gt;{useTheme();const[activeStep,setActiveStep]=reactExports.useState(0),[searchTerm,setSearchTerm]=reactExports.useState(""),[expandedCategories,setExpandedCategories]=reactExports.useState(new Set),[validationErrors,setValidationErrors]=reactExports.useState(new Map),currentCategory=categories[activeStep],filteredPoints=availablePoints.filter(point=&gt;{var _a,_b,_c;if(!((point,category)=&gt;{var _a,_b,_c;if(category.unitFilter&amp;&amp;category.unitFilter.length&gt;0){const pointUnit=(null==(_a=point.unit)?void 0:_a.toLowerCase())||"";if(!category.unitFilter.some(unit=&gt;pointUnit.includes(unit.toLowerCase())))return!1}if(category.namePatterns&amp;&amp;category.namePatterns.length&gt;0){const pointName=(null==(_b=point.name)?void 0:_b.toLowerCase())||"";if(!category.namePatterns.some(pattern=&gt;pointName.includes(pattern.toLowerCase())))return!1}if(category.pointTypes&amp;&amp;category.pointTypes.length&gt;0){const pointType=(null==(_c=point.type)?void 0:_c.toLowerCase())||"";if(!category.pointTypes.some(type=&gt;pointType===type.toLowerCase()))return!1}return!0})(point,currentCategory))return!1;if(searchTerm){const search=searchTerm.toLowerCase();return(null==(_a=point.name)?void 0:_a.toLowerCase().includes(search))||(null==(_b=point.id)?void 0:_b.toLowerCase().includes(search))||(null==(_c=point.unit)?void 0:_c.toLowerCase().includes(search))}return!0}),currentSelected=selectedPoints.get(currentCategory.id)||[],validateCategory=categoryId=&gt;{const category=categories.find(c=&gt;c.id===categoryId);if(!category)return null;const selected=selectedPoints.get(categoryId)||[];return!category.optional&amp;&amp;selected.length&lt;category.minRequired?`Select at least ${category.minRequired} point${category.minRequired&gt;1?"s":""}`:category.maxAllowed&amp;&amp;selected.length&gt;category.maxAllowed?`Select at most ${category.maxAllowed} point${category.maxAllowed&gt;1?"s":""}`:null},handlePointToggle=point=&gt;{const current=[...currentSelected],index2=current.findIndex(p=&gt;p.id===point.id);if(index2&gt;=0)current.splice(index2,1);else{if(currentCategory.maxAllowed&amp;&amp;!(current.length&lt;currentCategory.maxAllowed))return;current.push(point)}onSelectionChange(currentCategory.id,current)},handleNext=()=&gt;{const error=validateCategory(currentCategory.id);!error||currentCategory.optional?(setValidationErrors(new Map),activeStep&lt;categories.length-1&amp;&amp;(setActiveStep(activeStep+1),setSearchTerm(""))):setValidationErrors(new Map([[currentCategory.id,error]]))},handleBack=()=&gt;{activeStep&gt;0?(setActiveStep(activeStep-1),setSearchTerm("")):onBack&amp;&amp;onBack()},handleFinish=()=&gt;{const errors=new Map;if(categories.forEach(category=&gt;{const error=validateCategory(category.id);error&amp;&amp;errors.set(category.id,error)}),errors.size&gt;0){setValidationErrors(errors);const firstErrorCategory=categories.findIndex(c=&gt;errors.has(c.id));return void(firstErrorCategory&gt;=0&amp;&amp;setActiveStep(firstErrorCategory))}onComplete()},getProgress=()=&gt;{let completed=0,total=0;return categories.forEach(category=&gt;{if(!category.optional){total+=category.minRequired;const selected=selectedPoints.get(category.id)||[];completed+=Math.min(selected.length,category.minRequired)}}),total&gt;0?completed/total*100:0};return jsxRuntimeExports.jsxs(Box,{children:[jsxRuntimeExports.jsx(Typography$1,{variant:"h5",gutterBottom:!0,children:title}),jsxRuntimeExports.jsx(Typography$1,{variant:"body2",color:"text.secondary",paragraph:!0,children:description}),jsxRuntimeExports.jsxs(Box,{sx:{mb:3},children:[jsxRuntimeExports.jsxs(Box,{sx:{display:"flex",justifyContent:"space-between",mb:1},children:[jsxRuntimeExports.jsx(Typography$1,{variant:"caption",children:"Overall Progress"}),jsxRuntimeExports.jsxs(Typography$1,{variant:"caption",children:[Math.round(getProgress()),"%"]})]}),jsxRuntimeExports.jsx(LinearProgress,{variant:"determinate",value:getProgress(),sx:{height:8,borderRadius:1}})]}),jsxRuntimeExports.jsx(Stepper,{activeStep:activeStep,orientation:"vertical",children:categories.map((category,index2)=&gt;{const selected=selectedPoints.get(category.id)||[],error=validationErrors.get(category.id),isComplete=!error&amp;&amp;selected.length&gt;=category.minRequired;return jsxRuntimeExports.jsxs(Step,{children:[jsxRuntimeExports.jsx(StepLabel,{error:!!error,optional:category.optional?jsxRuntimeExports.jsx(Typography$1,{variant:"caption",children:"Optional"}):void 0,StepIconComponent:()=&gt;jsxRuntimeExports.jsxs(Box,{sx:{position:"relative"},children:[category.icon||jsxRuntimeExports.jsx(Category,{}),isComplete&amp;&amp;jsxRuntimeExports.jsx(CheckCircleIcon,{sx:{position:"absolute",bottom:-4,right:-4,fontSize:12,color:"success.main",bgcolor:"background.paper",borderRadius:"50%"}})]}),children:jsxRuntimeExports.jsxs(Box,{sx:{display:"flex",alignItems:"center",gap:1},children:[jsxRuntimeExports.jsx(Typography$1,{children:category.name}),jsxRuntimeExports.jsx(Chip,{label:`${selected.length}/${category.minRequired}${category.maxAllowed?`-${category.maxAllowed}`:"+"}`,size:"small",color:isComplete?"success":"default",variant:isComplete?"filled":"outlined"})]})}),jsxRuntimeExports.jsxs(StepContent,{children:[jsxRuntimeExports.jsx(Typography$1,{variant:"body2",color:"text.secondary",paragraph:!0,children:category.description}),jsxRuntimeExports.jsx(Alert,{severity:category.optional?"info":"warning",sx:{mb:2},icon:jsxRuntimeExports.jsx(Info,{}),children:category.optional?"This category is optional but recommended for better analysis":jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:["Select ",category.minRequired,category.maxAllowed?`-${category.maxAllowed}`:" or more"," point",1!==category.minRequired?"s":""]})}),jsxRuntimeExports.jsx(TextField,{fullWidth:!0,size:"small",placeholder:"Search points...",value:searchTerm,onChange:e2=&gt;setSearchTerm(e2.target.value),sx:{mb:2},InputProps:{startAdornment:jsxRuntimeExports.jsx(InputAdornment,{position:"start",children:jsxRuntimeExports.jsx(SearchIcon,{})}),endAdornment:searchTerm&amp;&amp;jsxRuntimeExports.jsx(InputAdornment,{position:"end",children:jsxRuntimeExports.jsx(IconButton,{size:"small",onClick:()=&gt;setSearchTerm(""),children:jsxRuntimeExports.jsx(ClearIcon,{})})})}}),jsxRuntimeExports.jsx(Paper,{variant:"outlined",sx:{maxHeight:300,overflow:"auto",mb:2},children:0===filteredPoints.length?jsxRuntimeExports.jsxs(Box,{sx:{p:3,textAlign:"center"},children:[jsxRuntimeExports.jsx(Typography$1,{variant:"body2",color:"text.secondary",children:"No matching points found"}),category.namePatterns&amp;&amp;jsxRuntimeExports.jsxs(Typography$1,{variant:"caption",color:"text.secondary",children:["Looking for: ",category.namePatterns.join(", ")]})]}):jsxRuntimeExports.jsx(List,{dense:!0,children:filteredPoints.map(point=&gt;{const isSelected=currentSelected.some(p=&gt;p.id===point.id),isDisabled=!isSelected&amp;&amp;category.maxAllowed&amp;&amp;currentSelected.length&gt;=category.maxAllowed;return jsxRuntimeExports.jsxs(ListItem,{button:!0,onClick:()=&gt;!isDisabled&amp;&amp;handlePointToggle(point),disabled:isDisabled,selected:isSelected,children:[jsxRuntimeExports.jsx(ListItemIcon,{children:jsxRuntimeExports.jsx(Checkbox,{edge:"start",checked:isSelected,disabled:isDisabled,tabIndex:-1,disableRipple:!0})}),jsxRuntimeExports.jsx(ListItemText,{primary:point.name,secondary:jsxRuntimeExports.jsxs(Stack,{direction:"row",spacing:1,alignItems:"center",children:[jsxRuntimeExports.jsx(Typography$1,{variant:"caption",children:point.id}),point.unit&amp;&amp;jsxRuntimeExports.jsx(Chip,{label:point.unit,size:"small"})]})})]},point.id)})})}),currentSelected.length&gt;0&amp;&amp;jsxRuntimeExports.jsxs(Box,{sx:{mb:2},children:[jsxRuntimeExports.jsxs(Typography$1,{variant:"caption",gutterBottom:!0,children:["Selected (",currentSelected.length,"):"]}),jsxRuntimeExports.jsx(Stack,{direction:"row",spacing:.5,flexWrap:"wrap",sx:{mt:.5},children:currentSelected.map(point=&gt;jsxRuntimeExports.jsx(Chip,{label:point.name,size:"small",onDelete:()=&gt;handlePointToggle(point),sx:{mb:.5}},point.id))})]}),error&amp;&amp;jsxRuntimeExports.jsx(Alert,{severity:"error",sx:{mb:2},children:error}),jsxRuntimeExports.jsxs(Box,{sx:{mt:2},children:[jsxRuntimeExports.jsx(Button,{onClick:handleBack,disabled:0===index2&amp;&amp;!onBack,children:"Back"}),index2===categories.length-1?jsxRuntimeExports.jsx(Button,{variant:"contained",onClick:handleFinish,sx:{ml:1},children:"Complete Setup"}):jsxRuntimeExports.jsx(Button,{variant:"contained",onClick:handleNext,sx:{ml:1},children:"Next"})]})]})]},category.id)})}),activeStep===categories.length&amp;&amp;jsxRuntimeExports.jsxs(Paper,{sx:{p:3,mt:3},children:[jsxRuntimeExports.jsx(Typography$1,{variant:"h6",gutterBottom:!0,children:"Selection Summary"}),jsxRuntimeExports.jsx(Grid,{container:!0,spacing:2,children:categories.map(category=&gt;{const selected=selectedPoints.get(category.id)||[];return jsxRuntimeExports.jsx(Grid,{item:!0,xs:12,md:6,children:jsxRuntimeExports.jsx(Card,{variant:"outlined",children:jsxRuntimeExports.jsxs(CardContent,{children:[jsxRuntimeExports.jsx(Typography$1,{variant:"subtitle2",gutterBottom:!0,children:category.name}),jsxRuntimeExports.jsxs(Typography$1,{variant:"body2",color:"text.secondary",children:[selected.length," point",1!==selected.length?"s":""," selected"]}),jsxRuntimeExports.jsxs(Stack,{direction:"row",spacing:.5,flexWrap:"wrap",sx:{mt:1},children:[selected.slice(0,3).map(point=&gt;jsxRuntimeExports.jsx(Chip,{label:point.name,size:"small"},point.id)),selected.length&gt;3&amp;&amp;jsxRuntimeExports.jsx(Chip,{label:`+${selected.length-3} more`,size:"small",variant:"outlined"})]})]})})},category.id)})})]})]})},CHW_RESET_CATEGORIES=[{id:"valve_positions",name:"CHW Valve Positions",description:"Select chilled water valve position points to monitor for reset optimization",icon:jsxRuntimeExports.jsx(Speed,{}),minRequired:1,unitFilter:["%"],namePatterns:["valve","vlv","chw"],optional:!1},{id:"supply_temp",name:"CHW Supply Temperature",description:"Select the chilled water supply temperature point",icon:jsxRuntimeExports.jsx(DeviceThermostat,{}),minRequired:1,maxAllowed:1,unitFilter:["F","C"],namePatterns:["supply","chws"],optional:!1},{id:"return_temp",name:"CHW Return Temperature",description:"Select the chilled water return temperature point",icon:jsxRuntimeExports.jsx(DeviceThermostat,{}),minRequired:1,maxAllowed:1,unitFilter:["F","C"],namePatterns:["return","chwr"],optional:!1},{id:"flow_rates",name:"Flow Rates",description:"Select flow rate points for enhanced analysis (optional)",icon:jsxRuntimeExports.jsx(WaterDrop,{}),minRequired:0,unitFilter:["gpm","l/s"],optional:!0},{id:"zone_temps",name:"Zone Temperatures",description:"Select zone temperature points for demand analysis (optional)",icon:jsxRuntimeExports.jsx(Air,{}),minRequired:0,unitFilter:["F","C"],namePatterns:["zone","room","space"],optional:!0}],DP_OPTIMIZATION_CATEGORIES=[{id:"dampers",name:"VAV Damper Positions",description:"Select VAV damper position points (% open)",icon:jsxRuntimeExports.jsx(Air,{}),minRequired:2,maxAllowed:void 0,unitFilter:["%","percent"],namePatterns:["damper","vav","box","terminal","position"],optional:!1},{id:"pressure",name:"Static Pressure Sensors",description:"Select duct static pressure measurement points",icon:jsxRuntimeExports.jsx(Speed,{}),minRequired:1,maxAllowed:void 0,unitFilter:["inWC","Pa","in.wc","pascal"],namePatterns:["static","pressure","sp","duct"],optional:!1},{id:"airflow",name:"Zone Airflow",description:"Optional: Select airflow measurement points for zones",icon:jsxRuntimeExports.jsx(Air,{}),minRequired:0,maxAllowed:void 0,unitFilter:["cfm","l/s","m3/h"],namePatterns:["flow","airflow","cfm"],optional:!0},{id:"temperature",name:"Zone Temperatures",description:"Optional: Select zone temperature points for correlation",icon:jsxRuntimeExports.jsx(Assessment,{}),minRequired:0,maxAllowed:void 0,unitFilter:["F","C","F","C"],namePatterns:["zone","temp","temperature","space"],optional:!0}],SIMULTANEOUS_HC_CATEGORIES=[{id:"ahuHeating",name:"AHU Heating Signals",description:"Select AHU heating coil valve positions or heating enable signals",icon:jsxRuntimeExports.jsx(LocalFireDepartment,{}),minRequired:1,maxAllowed:void 0,unitFilter:["%","percent","bool","binary"],namePatterns:["heat","heating","hwv","hot water","preheat"],optional:!1},{id:"ahuCooling",name:"AHU Cooling Signals",description:"Select AHU cooling coil valve positions or cooling enable signals",icon:jsxRuntimeExports.jsx(AcUnit,{}),minRequired:1,maxAllowed:void 0,unitFilter:["%","percent","bool","binary"],namePatterns:["cool","cooling","chw","chilled water"],optional:!1},{id:"zoneReheat",name:"Zone Reheat Valves",description:"Select terminal unit reheat valve positions",icon:jsxRuntimeExports.jsx(Whatshot,{}),minRequired:2,maxAllowed:void 0,unitFilter:["%","percent"],namePatterns:["reheat","terminal","zone","vav heat"],optional:!1},{id:"supplyTemp",name:"Supply Air Temperatures",description:"Select supply air temperature measurements",icon:jsxRuntimeExports.jsx(ThermostatAuto,{}),minRequired:1,maxAllowed:void 0,unitFilter:["F","C","F","C"],namePatterns:["supply","sat","discharge","air temp"],optional:!1},{id:"zoneTemp",name:"Zone Temperatures",description:"Optional: Select zone temperature measurements for context",icon:jsxRuntimeExports.jsx(Assessment,{}),minRequired:0,maxAllowed:void 0,unitFilter:["F","C","F","C"],namePatterns:["zone","space","room","temp"],optional:!0},{id:"dampers",name:"VAV Damper Positions",description:"Optional: Select VAV damper positions for airflow context",icon:jsxRuntimeExports.jsx(CompareArrows,{}),minRequired:0,maxAllowed:void 0,unitFilter:["%","percent"],namePatterns:["damper","vav","position"],optional:!0}],ENERGY_FACTORS={kW:{heatingCOP:.9,coolingCOP:3.5,typicalAHUCapacity:50,typicalZoneCapacity:5},"BTU/hr":{heatingEfficiency:.85,coolingEfficiency:3,typicalAHUCapacity:17e4,typicalZoneCapacity:17e3}};class SafeChartWrapper extends React.Component{constructor(props){super(props),__publicField(this,"handleRetry",()=&gt;{this.setState({hasError:!1,error:null})}),this.state={hasError:!1,error:null}}static getDerivedStateFromError(error){return{hasError:!0,error:error}}componentDidCatch(error,errorInfo){console.error(`[SafeChartWrapper] Error in chart ${this.props.chartId}:`,{error:error.message,stack:error.stack,componentStack:errorInfo.componentStack}),this.props.onError&amp;&amp;this.props.onError(error)}render(){return this.state.hasError?this.props.fallback?jsxRuntimeExports.jsx(jsxRuntimeExports.Fragment,{children:this.props.fallback}):jsxRuntimeExports.jsx(Box,{sx:{p:2,height:"100%",minHeight:300,display:"flex",alignItems:"center",justifyContent:"center"},children:jsxRuntimeExports.jsxs(Alert,{severity:"error",sx:{maxWidth:400,backgroundColor:"rgba(255, 82, 82, 0.1)",border:"1px solid rgba(255, 82, 82, 0.2)",borderRadius:2},action:jsxRuntimeExports.jsx(Button,{size:"small",onClick:this.handleRetry,sx:{color:"error.main","&amp;:hover":{backgroundColor:"rgba(255, 82, 82, 0.1)"}},children:"Retry"}),children:[jsxRuntimeExports.jsxs(Typography$1,{variant:"body2",sx:{color:"error.main"},children:["Failed to render chart",this.props.chartId&amp;&amp;` (${this.props.chartId})`]}),this.state.error&amp;&amp;jsxRuntimeExports.jsx(Typography$1,{variant:"caption",display:"block",sx:{mt:1,opacity:.8},children:this.state.error.message})]})}):this.props.children}}const EChartsEnhancedLineChart$1=React.memo(({data:data=[],series:series,title:title,height:height=400,loading:loading=!1,error:error,thresholds:thresholds=[],annotations:annotations=[],dualYAxis:dualYAxis,showDataZoom:showDataZoom=!0,showBrush:showBrush=!1,gradientArea:gradientArea=!1,connectNulls:connectNulls=!0,stacked:stacked=!1,showMinMax:showMinMax=!1,regressionLine:regressionLine=!1,movingAverage:movingAverage,showTooltip:showTooltip=!0,tooltipFormatter:tooltipFormatter,onDataZoom:onDataZoom,onChartClick:onChartClick,onChartReady:onChartReady,enableToolbox:enableToolbox=!0,onEdit:onEdit,onDelete:onDelete,selectedPoints:selectedPoints,showMarkerTags:showMarkerTags=!0})=&gt;{const theme=useTheme(),baseOptions=useBaseChartOptions(),chartRef=reactExports.useRef(null),[announcement,setAnnouncement]=useState(""),[keyboardNavState,setKeyboardNavState]=useState(null);reactExports.useEffect(()=&gt;{var _a,_b,_c,_d;if(!chartRef.current)return;const resizeObserver=new ResizeObserver(()=&gt;{chartRef.current&amp;&amp;chartRef.current.resize()}),chartElement=null==(_d=null==(_c=null==(_b=(_a=chartRef.current).getEchartsInstance)?void 0:_b.call(_a))?void 0:_c.getDom)?void 0:_d.call(_c);return chartElement&amp;&amp;resizeObserver.observe(chartElement.parentElement||chartElement),()=&gt;{resizeObserver.disconnect()}},[]);const chartData=reactExports.useMemo(()=&gt;series&amp;&amp;isSeriesArray(series)?series:isSeriesArray(data)?data:[],[data,series]);reactExports.useEffect(()=&gt;{if(chartData.length&gt;0){const pointCounts=chartData.map(s=&gt;{var _a;return(null==(_a=s.data)?void 0:_a.length)||0});setKeyboardNavState(createKeyboardNavState(chartData.length,pointCounts))}},[chartData]);const handleKeyDown=useCallback(e2=&gt;{var _a;if(!keyboardNavState||!chartData||!chartRef.current)return;const{key:key}=e2;if("Enter"===key){e2.preventDefault();const currentSeries=chartData[keyboardNavState.currentSeriesIndex],currentPoint=null==currentSeries?void 0:currentSeries.data[keyboardNavState.currentPointIndex];if(currentPoint&amp;&amp;Array.isArray(currentPoint)){const[timestamp,value]=currentPoint;setAnnouncement(generateDataPointAnnouncement(currentSeries.name,timestamp,value,currentSeries.unit)),chartRef.current.dispatchAction({type:"showTip",seriesIndex:keyboardNavState.currentSeriesIndex,dataIndex:keyboardNavState.currentPointIndex})}return}if("Escape"===key)return e2.preventDefault(),null==(_a=chartRef.current)||_a.dispatchAction({type:"hideTip"}),void setAnnouncement("Returned to chart overview");if(["ArrowLeft","ArrowRight","ArrowUp","ArrowDown","PageUp","PageDown","Home","End"].includes(key)){e2.preventDefault();const newState=handleKeyboardNav(key,keyboardNavState,(seriesIndex,pointIndex)=&gt;{var _a2;const currentSeries=chartData[seriesIndex],currentPoint=null==currentSeries?void 0:currentSeries.data[pointIndex];if(currentPoint&amp;&amp;Array.isArray(currentPoint)){const[timestamp,value]=currentPoint;setAnnouncement(generateDataPointAnnouncement(currentSeries.name,timestamp,value,currentSeries.unit)),null==(_a2=chartRef.current)||_a2.dispatchAction({type:"showTip",seriesIndex:seriesIndex,dataIndex:pointIndex})}});setKeyboardNavState(newState)}},[keyboardNavState,chartData]),ariaLabelData=reactExports.useMemo(()=&gt;{if(!chartData||0===chartData.length)return{seriesCount:0,dataPointCount:0,startDate:void 0,endDate:void 0};const dataPointCount=chartData.reduce((sum,s)=&gt;{var _a;return sum+((null==(_a=s.data)?void 0:_a.length)||0)},0),allTimestamps=chartData.flatMap(s=&gt;{var _a;return(null==(_a=s.data)?void 0:_a.map(point=&gt;Array.isArray(point)?point[0]:point.timestamp))||[]});return{seriesCount:chartData.length,dataPointCount:dataPointCount,startDate:allTimestamps.length&gt;0?new Date(Math.min(...allTimestamps)):void 0,endDate:allTimestamps.length&gt;0?new Date(Math.max(...allTimestamps)):void 0}},[chartData]),chartOption=reactExports.useMemo(()=&gt;{var _a;const totalPoints=chartData.reduce((sum,series2)=&gt;{var _a2;return sum+((null==(_a2=series2.data)?void 0:_a2.length)||0)},0),animationMode=CHART_DESIGN_TOKENS.adaptive.animationMode(totalPoints),isDarkMode="dark"===theme.palette.mode;if(!chartData||0===chartData.length)return mergeChartOptions(baseOptions,{title:title?{...CHART_DESIGN_TOKENS.title.base,text:title,textStyle:{...CHART_DESIGN_TOKENS.title.base.textStyle,color:theme.palette.text.primary}}:void 0,xAxis:{type:"time",axisLabel:{formatter:value=&gt;new Date(value).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0}),rotate:45,align:"right",verticalAlign:"top"}},yAxis:{type:"value"},series:[],graphic:[{type:"text",left:"center",top:"center",style:{text:loading?"Loading...":error?"Error loading data":"No data available",fontSize:16,fill:theme.palette.text.secondary}}]});const colors=getDistinctColors(chartData.length),seriesConfig=chartData.map((seriesData,index2)=&gt;{const seriesColor=seriesData.color||colors[index2];let validData=seriesData.data||[];Array.isArray(validData)||(console.warn("[EChartsEnhancedLineChart] Invalid data format for series:",seriesData.name),validData=[]);const mainSeries={name:showMarkerTags&amp;&amp;seriesData.markerTags?formatPointWithTags({id:seriesData.name,name:seriesData.name,markerTags:Array.isArray(seriesData.markerTags)?seriesData.markerTags:[seriesData.markerTags]},{maxTags:2,includeUnit:!1}):seriesData.name||`Series ${index2+1}`,type:"step"===seriesData.type?"line":seriesData.type||"line",step:"step"===seriesData.type&amp;&amp;(seriesData.stepType||"middle"),data:validData,smooth:void 0===seriesData.smooth||seriesData.smooth,yAxisIndex:seriesData.yAxisIndex||0,stack:stacked?"total":void 0,lineStyle:{color:seriesColor,width:getAdaptiveLineWidth(chartData.length),type:"solid"},itemStyle:{color:seriesColor},showSymbol:void 0!==seriesData.showSymbol&amp;&amp;seriesData.showSymbol,symbol:"circle",symbolSize:seriesData.symbolSize||getAdaptiveSymbolSize(chartData.length,4),connectNulls:connectNulls,emphasis:{focus:"series",lineStyle:{width:3}}};return("area"===seriesData.type||seriesData.areaStyle||gradientArea)&amp;&amp;(mainSeries.areaStyle=seriesData.areaStyle||{opacity:.3}),mainSeries}),lineOption={title:title?{...CHART_DESIGN_TOKENS.title.base,text:title,textStyle:{...CHART_DESIGN_TOKENS.title.base.textStyle,color:theme.palette.text.primary}}:void 0,tooltip:showTooltip?{...CHART_DESIGN_TOKENS.tooltip.base,trigger:"axis",backgroundColor:isDarkMode?"rgba(50, 50, 50, 0.95)":"rgba(255, 255, 255, 0.95)",borderColor:isDarkMode?"rgba(255, 255, 255, 0.12)":"rgba(0, 0, 0, 0.12)",textStyle:{...CHART_DESIGN_TOKENS.tooltip.base.textStyle,color:theme.palette.text.primary},axisPointer:{type:"cross",label:{backgroundColor:"dark"===theme.palette.mode?"rgba(0, 0, 0, 0.8)":"rgba(255, 255, 255, 0.9)"}},formatter:tooltipFormatter||(params=&gt;{var _a2,_b;if(!Array.isArray(params))return"";const timestamp=null==(_b=null==(_a2=params[0])?void 0:_a2.value)?void 0:_b[0];let html=`&lt;div style="padding: 8px;"&gt;\n            &lt;div style="margin-bottom: 8px; font-weight: 600;"&gt;${ChartTimeFormatter.tooltip(timestamp)}&lt;/div&gt;`;return params.forEach(param=&gt;{var _a3;const value=null==(_a3=param.value)?void 0:_a3[1],seriesItem=chartData.find(d=&gt;(showMarkerTags&amp;&amp;d.markerTags?formatPointWithTags({id:d.name,name:d.name,markerTags:Array.isArray(d.markerTags)?d.markerTags:[d.markerTags]},{maxTags:2,includeUnit:!1}):d.name)===param.seriesName||d.name===param.seriesName),unit=(null==seriesItem?void 0:seriesItem.unit)||"",markerTags=(null==seriesItem?void 0:seriesItem.markerTags)||[];if(html+=`\n              &lt;div style="display: flex; align-items: center; gap: 8px; margin-top: 4px;"&gt;\n                &lt;div style="width: 10px; height: 10px; background: ${param.color}; border-radius: 50%;"&gt;&lt;/div&gt;\n                &lt;span&gt;${param.seriesName}:&lt;/span&gt;\n                &lt;strong&gt;${formatNumberForDisplay(value)} ${unit}&lt;/strong&gt;\n              &lt;/div&gt;\n            `,markerTags&amp;&amp;markerTags.length&gt;0&amp;&amp;!param.seriesName.includes("[")){const tagsArray=Array.isArray(markerTags)?markerTags:[markerTags];html+=`&lt;div style="margin-left: 26px; color: #888; font-size: 0.9em;"&gt;Tags: ${tagsArray.join(", ")}&lt;/div&gt;`}}),html+="&lt;/div&gt;",html})}:void 0,legend:{data:chartData.map(s=&gt;showMarkerTags&amp;&amp;s.markerTags?formatPointWithTags({id:s.name,name:s.name,markerTags:Array.isArray(s.markerTags)?s.markerTags:[s.markerTags]},{maxTags:2,includeUnit:!1}):s.name),bottom:showDataZoom?60:10,type:"scroll",textStyle:{color:theme.palette.text.secondary}},grid:{...CHART_DESIGN_TOKENS.grid.base,top:calculateGridTop({hasTitle:!!title,hasToolbox:!0}),right:(null==dualYAxis?void 0:dualYAxis.enabled)?60:20},xAxis:{...getTimeAxisConfig(),boundaryGap:!1,axisLabel:{...getTimeAxisConfig().axisLabel,rotate:45,align:"right",verticalAlign:"top"}},yAxis:[{type:"value",name:(null==(_a=chartData[0])?void 0:_a.unit)||"",nameTextStyle:{color:theme.palette.text.secondary},axisLabel:{color:theme.palette.text.secondary,formatter:value=&gt;formatNumberForDisplay(value)},splitLine:{lineStyle:{color:theme.palette.divider,type:"dashed"}}},...(null==dualYAxis?void 0:dualYAxis.enabled)?[{type:"value",name:dualYAxis.name||dualYAxis.unit||"",nameTextStyle:{color:theme.palette.text.secondary},axisLabel:{color:theme.palette.text.secondary,formatter:value=&gt;formatNumberForDisplay(value)},splitLine:{show:!1}}]:[]],dataZoom:showDataZoom?[{type:"inside",start:0,end:100,filterMode:"none",throttle:0},{type:"slider",start:0,end:100,filterMode:"none",bottom:20,throttle:0,realtime:!0}]:void 0,series:seriesConfig};if(thresholds.length&gt;0&amp;&amp;lineOption.series){const markLine={symbol:"none",data:thresholds.map(threshold=&gt;{var _a2,_b,_c;return{yAxis:threshold.value,name:threshold.name||`Threshold: ${threshold.value}`,lineStyle:{type:threshold.lineStyle||"dashed",color:threshold.color||theme.palette.warning.main},label:{show:!1!==(null==(_a2=threshold.label)?void 0:_a2.show),position:(null==(_b=threshold.label)?void 0:_b.position)||"end",formatter:(null==(_c=threshold.label)?void 0:_c.formatter)||threshold.name||`${threshold.value}`}}})};Array.isArray(lineOption.series)&amp;&amp;lineOption.series.length&gt;0&amp;&amp;(lineOption.series[0]={...lineOption.series[0],markLine:markLine})}return{...mergeChartOptions(baseOptions,lineOption,{showToolbox:enableToolbox,enableDataView:!1,showDataZoom:showDataZoom,showLegend:!0}),...CHART_DESIGN_TOKENS.animation[animationMode],aria:createEChartsAriaConfig(title||"Line Chart",chartData.map(s=&gt;s.name),!0)}},[chartData,theme,baseOptions,title,showTooltip,tooltipFormatter,showDataZoom,dualYAxis,thresholds,stacked,connectNulls,gradientArea,enableToolbox,onEdit,onDelete]);return jsxRuntimeExports.jsxs(Box,{sx:{height:"100%",position:"relative"},children:[jsxRuntimeExports.jsx(Box,{role:"status","aria-live":"polite","aria-atomic":"true",sx:srOnlyStyles,children:announcement}),jsxRuntimeExports.jsx(Box,{role:"img","aria-label":generateChartAriaLabel(title||"Line Chart",ariaLabelData.seriesCount,ariaLabelData.dataPointCount,ariaLabelData.startDate,ariaLabelData.endDate,"line chart"),tabIndex:0,onKeyDown:handleKeyDown,sx:{height:"100%",width:"100%",...chartFocusStyles},children:jsxRuntimeExports.jsx(EChartsWrapper,{ref:chartRef,option:chartOption,height:height,loading:loading,error:error,onChartReady:chart=&gt;{chartRef.current=chart,null==onChartReady||onChartReady(chart)},onEvents:{click:onChartClick,datazoom:onDataZoom},theme:theme.palette.mode,notMerge:!1,lazyUpdate:!0})})]})}),CHART_COMPONENTS={TimeSeries:EChartsEnhancedLineChart$1,line:EChartsEnhancedLineChart$1,Line:EChartsEnhancedLineChart$1,LineChart:EChartsEnhancedLineChart$1,bar:EChartsBarChart$1,Bar:EChartsBarChart$1,BarChart:EChartsBarChart$1,heatmap:EChartsHeatmap$1,Heatmap:EChartsHeatmap$1,DeviceDeviationHeatmap:EChartsDeviceDeviationHeatmap,gauge:EChartsGaugeChart$1,Gauge:EChartsGaugeChart$1,GaugeChart:EChartsGaugeChart$1,scatter:EChartsScatterPlot$1,Scatter:EChartsScatterPlot$1,ScatterPlot:EChartsScatterPlot$1,AreaChart:EChartsAreaChart,area:EChartsAreaChart,StackedArea:EChartsAreaChart,Psychrometric:({data:data=[],series:series,temperaturePoints:temperaturePoints=[],humidityPoints:humidityPoints=[],correlationMethod:correlationMethod="latest",maxCorrelationGapMs:maxCorrelationGapMs=3e5,interpolationMethod:interpolationMethod="linear",samplingStrategy:samplingStrategy="union",samplingInterval:samplingInterval=6e4,allowPartialData:allowPartialData=!1,fillMissingData:fillMissingData=!0,showTimeSeries:showTimeSeries=!1,timeSeriesPosition:timeSeriesPosition="bottom",loading:externalLoading=!1,error:externalError=null,height:height="100%",title:title,enableToolbox:enableToolbox=!0,onEdit:onEdit,onDelete:onDelete,onChartReady:onChartReady,temperatureUnit:temperatureUnit="C",showComfortZone:showComfortZone=!0,showGridLines:showGridLines=!0,colorByTime:colorByTime=!1,showMarkerTags:showMarkerTags=!0,showEnthalpy:showEnthalpy=!0,showWetBulb:showWetBulb=!0,showSpecificVolume:showSpecificVolume=!1,showRelativeHumidityLines:showRelativeHumidityLines=!0,comfortZones:comfortZones=[],clothingInsulation:clothingInsulation=.5,metabolicRate:metabolicRate=1.2,airVelocity:airVelocity=.1,onPointClick:onPointClick,onPointHover:onPointHover,enableAnimations:enableAnimations=!0,enableTimeAnimation:enableTimeAnimation=!1,animationSpeed:animationSpeed=1e3})=&gt;{const theme=useTheme(),containerRef=reactExports.useRef(null),chartInstanceRef=reactExports.useRef(null);reactExports.useEffect(()=&gt;{const handleResize=()=&gt;{chartInstanceRef.current&amp;&amp;chartInstanceRef.current.resize()};return window.addEventListener("resize",handleResize),window.addEventListener("grid-resize",handleResize),()=&gt;{window.removeEventListener("resize",handleResize),window.removeEventListener("grid-resize",handleResize)}},[]);const baseOptions=useBaseChartOptions();reactExports.useMemo(()=&gt;{var _a,_b,_c,_d,_e,_f;const seriesToUse=series||data||[];if(!Array.isArray(seriesToUse)||seriesToUse.length&lt;2)return console.log("[Psychrometric] Need exactly 2 series (temperature and humidity):",{seriesCount:(null==seriesToUse?void 0:seriesToUse.length)||0,series:null==seriesToUse?void 0:seriesToUse.map(s=&gt;{var _a2;return{name:s.name,dataPoints:(null==(_a2=s.data)?void 0:_a2.length)||0}})}),{temperaturePoints:[],humidityPoints:[]};const tempPoints=seriesToUse[0]?[{name:seriesToUse[0].name,unit:seriesToUse[0].unit}]:[],humidityPoints2=seriesToUse[1]?[{name:seriesToUse[1].name,unit:seriesToUse[1].unit}]:[];return console.log("[Psychrometric] Using user-selected series:",{temperature:null==(_a=tempPoints[0])?void 0:_a.name,humidity:null==(_b=humidityPoints2[0])?void 0:_b.name,tempDataPoints:(null==(_d=null==(_c=seriesToUse[0])?void 0:_c.data)?void 0:_d.length)||0,humidityDataPoints:(null==(_f=null==(_e=seriesToUse[1])?void 0:_e.data)?void 0:_f.length)||0}),{temperaturePoints:tempPoints,humidityPoints:humidityPoints2}},[series,data]);const dataSource=reactExports.useMemo(()=&gt;{var _a,_b;return data&amp;&amp;Array.isArray(data)&amp;&amp;data.length&gt;0?void 0!==(null==(_a=data[0])?void 0:_a.temperature)&amp;&amp;void 0!==(null==(_b=data[0])?void 0:_b.humidity)?{data:data,type:"psychrometric"}:{data:data,type:"series"}:series&amp;&amp;Array.isArray(series)&amp;&amp;series.length&gt;0?{data:series,type:"series"}:{data:[],type:"empty"}},[data,series]);reactExports.useMemo(()=&gt;dataSource.data&amp;&amp;Array.isArray(dataSource.data)?"psychrometric"===dataSource.type?dataSource.data.filter(point=&gt;point&amp;&amp;"number"==typeof point.temperature&amp;&amp;"number"==typeof point.humidity&amp;&amp;!isNaN(point.temperature)&amp;&amp;!isNaN(point.humidity)):dataSource.data.filter(s=&gt;s&amp;&amp;s.data&amp;&amp;Array.isArray(s.data)&amp;&amp;s.data.length&gt;0):[],[dataSource]);const generatePsychrometricPoints=reactExports.useCallback((seriesData,tempPoints,humidityPoints2,options)=&gt;{if(!(options.allowPartialData||tempPoints.length&amp;&amp;humidityPoints2.length))return[];const tempSeries=seriesData.find(s=&gt;tempPoints.some(tp=&gt;tp.name===s.name)),humiditySeries=seriesData.find(s=&gt;humidityPoints2.some(hp=&gt;hp.name===s.name));if(!(null==tempSeries?void 0:tempSeries.data)&amp;&amp;!(null==humiditySeries?void 0:humiditySeries.data))return[];const tempValid=validateSeriesForInterpolation(null==tempSeries?void 0:tempSeries.data),humidityValid=validateSeriesForInterpolation(null==humiditySeries?void 0:humiditySeries.data);if(!tempValid&amp;&amp;!humidityValid)return[];const points=[],allTimestamps=getAllTimestamps(null==tempSeries?void 0:tempSeries.data,null==humiditySeries?void 0:humiditySeries.data);if(0===allTimestamps.length)return[];const startTime=allTimestamps[0],endTime=allTimestamps[allTimestamps.length-1],samplesToProcess=generateSamplingTimestamps(startTime,endTime,options.samplingStrategy,allTimestamps,options.samplingInterval);let lastTemp=null,lastHumidity=null;return samplesToProcess.forEach(timestamp=&gt;{let temp=(null==tempSeries?void 0:tempSeries.data)?interpolateValue(tempSeries.data,timestamp,options.interpolationMethod):null,humidity=(null==humiditySeries?void 0:humiditySeries.data)?interpolateValue(humiditySeries.data,timestamp,options.interpolationMethod):null;if(options.fillMissingData&amp;&amp;(null===temp&amp;&amp;null!==lastTemp&amp;&amp;(temp=lastTemp),null===humidity&amp;&amp;null!==lastHumidity&amp;&amp;(humidity=lastHumidity)),null!==temp&amp;&amp;(lastTemp=temp),null!==humidity&amp;&amp;(lastHumidity=humidity),null!==temp&amp;&amp;null!==humidity){const tempCelsius="F"===options.temperatureUnit?5*(temp-32)/9:temp,properties=calculatePsychrometricProperties(tempCelsius,humidity);points.push({temperature:temp,humidity:humidity,timestamp:timestamp,properties:properties,dewPoint:properties.dewPoint,wetBulb:properties.wetBulb,enthalpy:properties.enthalpy,specificVolume:properties.specificVolume,name:`${(null==tempSeries?void 0:tempSeries.name)||"Temperature"} &amp; ${(null==humiditySeries?void 0:humiditySeries.name)||"Humidity"}`,markerTags:[...(null==tempSeries?void 0:tempSeries.markerTags)||[],...(null==humiditySeries?void 0:humiditySeries.markerTags)||[]]})}}),points},[calculatePsychrometricProperties]);reactExports.useCallback((seriesData,tempPoints,humidityPoints2,options)=&gt;generatePsychrometricPoints(seriesData,tempPoints,humidityPoints2,{interpolationMethod:"linear",samplingStrategy:"union",samplingInterval:6e4,temperatureUnit:options.temperatureUnit,allowPartialData:!1,fillMissingData:!0}),[generatePsychrometricPoints]);const timeRangeLabel=reactExports.useMemo(()=&gt;{const seriesToUse=series||data||[];if(!Array.isArray(seriesToUse)||seriesToUse.length&lt;2)return"";const allTimestamps=[];if(seriesToUse.forEach(seriesItem=&gt;{(null==seriesItem?void 0:seriesItem.data)&amp;&amp;Array.isArray(seriesItem.data)&amp;&amp;seriesItem.data.forEach(point=&gt;{Array.isArray(point)&amp;&amp;point.length&gt;=2&amp;&amp;"number"==typeof point[0]&amp;&amp;allTimestamps.push(point[0])})}),0===allTimestamps.length)return"";const minTime=Math.min(...allTimestamps),maxTime=Math.max(...allTimestamps),startDate=new Date(minTime),endDate=new Date(maxTime),formatDate2=date=&gt;date.toLocaleDateString()+" "+date.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"});return`${formatDate2(startDate)} - ${formatDate2(endDate)}`},[series,data]),finalData=reactExports.useMemo(()=&gt;{const seriesToUse=series||data||[];if(!Array.isArray(seriesToUse)||seriesToUse.length&lt;2)return console.log("[Psychrometric] Insufficient series for correlation"),[];const tempSeries=seriesToUse[0],humiditySeries=seriesToUse[1];if(!(null==tempSeries?void 0:tempSeries.data)||!(null==humiditySeries?void 0:humiditySeries.data))return console.log("[Psychrometric] Missing data in series"),[];const correlatedPoints=[],humidityMap=new Map;return humiditySeries.data.forEach(point=&gt;{Array.isArray(point)&amp;&amp;point.length&gt;=2&amp;&amp;humidityMap.set(point[0],point[1])}),tempSeries.data.forEach(tempPoint=&gt;{if(!Array.isArray(tempPoint)||tempPoint.length&lt;2)return;const timestamp=tempPoint[0],tempValue=tempPoint[1];let humidityValue=null;if(humidityMap.has(timestamp))humidityValue=humidityMap.get(timestamp);else for(const[humTimestamp,humValue]of humidityMap.entries())if(Math.abs(timestamp-humTimestamp)&lt;=3e5){humidityValue=humValue;break}null!==humidityValue&amp;&amp;correlatedPoints.push({temperature:tempValue,humidity:humidityValue,timestamp:timestamp,name:`${tempSeries.formattedName||tempSeries.name} / ${humiditySeries.formattedName||humiditySeries.name}`})}),console.log("[Psychrometric] Correlated points:",{tempPoints:tempSeries.data.length,humidityPoints:humiditySeries.data.length,correlatedPoints:correlatedPoints.length}),correlatedPoints},[series,data]);reactExports.useEffect(()=&gt;{console.log("[Psychrometric] Data update:",{hasData:!!data,hasSeries:!!series,dataLength:Array.isArray(data)?data.length:0,seriesLength:Array.isArray(series)?series.length:0,finalDataPoints:finalData.length,timeRange:timeRangeLabel,firstPoint:finalData[0],lastPoint:finalData[finalData.length-1]})},[data,series,finalData,timeRangeLabel]);const finalLoading=externalLoading,finalError=externalError,relativeHumidityLines=reactExports.useMemo(()=&gt;{if(!showRelativeHumidityLines)return[];const lines=[],tempRange="C"===temperatureUnit?[10,40]:[50,104];return[10,20,30,40,50,60,70,80,90,95].forEach(rh=&gt;{const lineData=[];for(let temp=tempRange[0];temp&lt;=tempRange[1];temp+=1)lineData.push([temp,rh]);lines.push({name:`${rh}% RH`,type:"line",data:lineData,lineStyle:{color:theme.palette.divider,width:rh%20==0?1.5:1,type:100===rh?"solid":"dashed",opacity:100===rh?.8:.4},symbol:"none",silent:!0,z:1,showSymbol:!1})}),lines},[showRelativeHumidityLines,temperatureUnit,theme]),enthalpyLines=reactExports.useMemo(()=&gt;{if(!showEnthalpy)return[];return generateConstantEnthalpyLines("C"===temperatureUnit?[20,30,40,50,60,70,80,90]:[10,15,20,25,30,35,40],"C"===temperatureUnit?[10,40]:[50,104]).map(line=&gt;({name:line.name,type:"line",data:line.data,lineStyle:{color:theme.palette.warning.main,width:1,type:"dotted",opacity:.6},symbol:"none",silent:!0,z:2,showSymbol:!1}))},[showEnthalpy,temperatureUnit,theme]),wetBulbLines=reactExports.useMemo(()=&gt;{if(!showWetBulb)return[];return generateConstantWetBulbLines("C"===temperatureUnit?[10,15,20,25,30,35]:[50,59,68,77,86,95],"C"===temperatureUnit?[10,40]:[50,104]).map(line=&gt;({name:line.name,type:"line",data:line.data,lineStyle:{color:theme.palette.info.main,width:1,type:"solid",opacity:.5},symbol:"none",silent:!0,z:2,showSymbol:!1}))},[showWetBulb,temperatureUnit,theme]),scatterData=reactExports.useMemo(()=&gt;{if(!finalData||0===finalData.length)return[];const timestamps=finalData.map(d=&gt;d.timestamp).filter(t=&gt;t),minTime=timestamps.length&gt;0?Math.min(...timestamps):0,timeRange=(timestamps.length&gt;0?Math.max(...timestamps):1)-minTime||1;return finalData.map((point,index2)=&gt;{var _a;const displayName=showMarkerTags?getPointDisplayLabel({name:point.formattedName||point.name||`Point ${index2+1}`,marker_tags:point.markerTags,unit:null==(_a=point.pointMetadata)?void 0:_a.unit},{displayMode:"smart",context:"legend"}):point.formattedName||point.name||`Point ${index2+1}`,tempCelsius="C"===temperatureUnit?point.temperature:5*(point.temperature-32)/9,properties=point.properties||calculatePsychrometricProperties(tempCelsius,point.humidity),dewPoint=point.dewPoint||calculateDewPoint(tempCelsius,point.humidity),wetBulb=point.wetBulb||calculateWetBulbTemperature(tempCelsius,point.humidity),enthalpy=point.enthalpy||properties.enthalpy,specificVolume=point.specificVolume||properties.specificVolume,displayDewPoint="F"===temperatureUnit?9*dewPoint/5+32:dewPoint,displayWetBulb="F"===temperatureUnit?9*wetBulb/5+32:wetBulb,timeRatio=point.timestamp?(point.timestamp-minTime)/timeRange:.5;let pointColor=theme.palette.primary.main;if(colorByTime&amp;&amp;timestamps.length&gt;1){pointColor=`hsl(${240-240*timeRatio}, 70%, 50%)`}return{value:[point.temperature,point.humidity,displayDewPoint,displayWetBulb,enthalpy,specificVolume,displayName,point.timestamp||index2,pointColor],itemStyle:{color:pointColor,opacity:colorByTime?.6+.4*timeRatio:.8},emphasis:{scale:1.3,itemStyle:{shadowBlur:15,shadowColor:pointColor,borderColor:theme.palette.primary.dark,borderWidth:2}},pointData:{...point,dewPoint:displayDewPoint,wetBulb:displayWetBulb,enthalpy:enthalpy,specificVolume:specificVolume,properties:properties}}})},[finalData,temperatureUnit,showMarkerTags,colorByTime,theme]),comfortZonePolygons=reactExports.useMemo(()=&gt;{const polygons=[];if(showComfortZone&amp;&amp;comfortZones.length&gt;0&amp;&amp;comfortZones.forEach((zone,index2)=&gt;{zone.data&amp;&amp;zone.data.length&gt;2&amp;&amp;polygons.push({name:zone.name,type:"custom",renderItem:function(params,api){return{type:"polygon",shape:{points:zone.data.map(([temp,rh])=&gt;api.coord([temp,rh]))},style:{fill:zone.style.fill,stroke:zone.style.stroke,lineWidth:zone.style.strokeWidth||2,opacity:zone.style.opacity||.3},z:0,...enableAnimations&amp;&amp;{transition:["style"],enterFrom:{style:{opacity:0}},enterAnimation:{duration:1e3,easing:"cubicOut"}}}},data:[[index2]],silent:!0,z:0})}),showComfortZone&amp;&amp;0===comfortZones.length){const summerZone=generateASHRAE55ComfortZone("summer",clothingInsulation,metabolicRate,airVelocity),winterZone=generateASHRAE55ComfortZone("winter",1.5*clothingInsulation,metabolicRate,airVelocity);if(summerZone.length&gt;0){const summerData=summerZone.map(point=&gt;["F"===temperatureUnit?9*point.temperature/5+32:point.temperature,point.humidity]);polygons.push({name:"ASHRAE 55 Summer Comfort",type:"custom",renderItem:function(params,api){return{type:"polygon",shape:{points:summerData.map(([temp,rh])=&gt;api.coord([temp,rh]))},style:{fill:"dark"===theme.palette.mode?"rgba(255, 193, 7, 0.2)":"rgba(255, 193, 7, 0.15)",stroke:theme.palette.warning.main,lineWidth:2,opacity:.7},z:0}},data:[[0]],silent:!0})}if(winterZone.length&gt;0){const winterData=winterZone.map(point=&gt;["F"===temperatureUnit?9*point.temperature/5+32:point.temperature,point.humidity]);polygons.push({name:"ASHRAE 55 Winter Comfort",type:"custom",renderItem:function(params,api){return{type:"polygon",shape:{points:winterData.map(([temp,rh])=&gt;api.coord([temp,rh]))},style:{fill:"dark"===theme.palette.mode?"rgba(33, 150, 243, 0.2)":"rgba(33, 150, 243, 0.15)",stroke:theme.palette.primary.main,lineWidth:2,opacity:.7},z:0}},data:[[1]],silent:!0})}}return polygons},[showComfortZone,comfortZones,clothingInsulation,metabolicRate,airVelocity,temperatureUnit,enableAnimations]),timelineData=reactExports.useMemo(()=&gt;{if(!enableTimeAnimation||!finalData.some(d=&gt;d.timestamp))return null;const timeGroups=new Map;finalData.forEach(point=&gt;{if(point.timestamp){const hourTimestamp=36e5*Math.floor(point.timestamp/36e5);timeGroups.has(hourTimestamp)||timeGroups.set(hourTimestamp,[]),timeGroups.get(hourTimestamp).push(point)}});const sortedTimes=Array.from(timeGroups.keys()).sort();return{axisType:"time",orient:"horizontal",autoPlay:!1,loop:!0,playInterval:animationSpeed,data:sortedTimes.map(timestamp=&gt;({value:timestamp,name:new Date(timestamp).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0})})),timeline:sortedTimes,timeGroups:timeGroups}},[finalData,enableTimeAnimation,animationSpeed]),chartOption=reactExports.useMemo(()=&gt;{if(!finalData||0===finalData.length)return baseOptions;const totalPoints=finalData.length,animationMode=CHART_DESIGN_TOKENS.adaptive.animationMode(totalPoints),titleText=title||"Temperature vs Humidity Over Time",customOptions={...CHART_DESIGN_TOKENS.animation[animationMode],title:{...CHART_DESIGN_TOKENS.title.base,text:titleText,subtext:timeRangeLabel?`Showing ${finalData.length} readings from: ${timeRangeLabel}`:`Showing ${finalData.length} readings over selected time period`,textStyle:{...CHART_DESIGN_TOKENS.title.base.textStyle,color:theme.palette.text.primary},subtextStyle:{color:theme.palette.text.secondary,fontSize:12}},...timelineData&amp;&amp;{timeline:{axisType:"time",orient:"horizontal",autoPlay:!1,loop:!0,playInterval:animationSpeed,left:"10%",right:"10%",bottom:0,height:40,data:timelineData.data,label:{color:theme.palette.text.secondary,fontSize:10},lineStyle:{color:theme.palette.primary.main},checkpointStyle:{color:theme.palette.primary.main,borderColor:theme.palette.primary.dark},controlStyle:{color:theme.palette.primary.main,borderColor:theme.palette.primary.dark}}},tooltip:{...CHART_DESIGN_TOKENS.tooltip.base,trigger:"item",backgroundColor:"dark"===theme.palette.mode?"rgba(50, 50, 50, 0.95)":"rgba(255, 255, 255, 0.95)",borderColor:"dark"===theme.palette.mode?"rgba(255, 255, 255, 0.12)":"rgba(0, 0, 0, 0.12)",textStyle:{...CHART_DESIGN_TOKENS.tooltip.base.textStyle,color:theme.palette.text.primary},formatter:function(params){if(!params||!params.value||!Array.isArray(params.value)||params.value.length&lt;8)return"No data available";const[temp,rh,dewPoint,wetBulb,enthalpy,specificVolume,name,timestamp]=params.value,comfort=((temp2,humidity)=&gt;{const summerTempRange="F"===temperatureUnit?[73,79]:[23,26],humidityRange=[30,60];return humidity&lt;humidityRange[0]?{status:"Too Dry",color:getComfortColor("dry"),recommendation:"Consider using a humidifier"}:humidity&gt;humidityRange[1]?{status:"Too Humid",color:getComfortColor("humid"),recommendation:"Increase ventilation or use dehumidification"}:temp2&lt;summerTempRange[0]?{status:"Too Cool",color:getComfortColor("cold"),recommendation:"Increase temperature setpoint"}:temp2&gt;summerTempRange[1]?{status:"Too Warm",color:getComfortColor("hot"),recommendation:"Decrease temperature setpoint or increase air movement"}:{status:"Comfortable",color:getComfortColor("optimal"),recommendation:"Conditions are within comfort range"}})(temp,rh),tempUnit=temperatureUnit,date=timestamp?new Date(timestamp):null,timeStr=date?date.toLocaleString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"Unknown time";return`\n          &lt;div style="padding: 8px; line-height: 1.6; min-width: 280px;"&gt;\n            &lt;div style="font-weight: bold; margin-bottom: 4px; font-size: 13px; color: ${theme.palette.primary.main};"&gt;\n               ${timeStr}\n            &lt;/div&gt;\n            &lt;div style="font-size: 12px; margin-bottom: 8px; color: #666;"&gt;\n              Reading ${params.dataIndex+1} of ${finalData.length} in this time range\n            &lt;/div&gt;\n            \n            \x3c!-- Comfort Status Banner --\x3e\n            &lt;div style="background: ${comfort.color}15; border-left: 3px solid ${comfort.color}; \n                        padding: 6px 8px; margin-bottom: 10px; border-radius: 2px;"&gt;\n              &lt;div style="font-weight: 600; color: ${comfort.color}; font-size: 13px;"&gt;\n                ${"Comfortable"===comfort.status?"":""} ${comfort.status}\n              &lt;/div&gt;\n              &lt;div style="font-size: 11px; color: #666; margin-top: 2px;"&gt;\n                ${comfort.recommendation}\n              &lt;/div&gt;\n            &lt;/div&gt;\n            \n            \x3c!-- Primary Readings --\x3e\n            &lt;div style="margin-bottom: 10px;"&gt;\n              &lt;div style="display: flex; justify-content: space-between; margin-bottom: 4px;"&gt;\n                &lt;span style="color: #666;"&gt; Temperature:&lt;/span&gt;\n                &lt;strong&gt;${formatNumberForDisplay(temp,1)}${tempUnit}&lt;/strong&gt;\n              &lt;/div&gt;\n              &lt;div style="display: flex; justify-content: space-between;"&gt;\n                &lt;span style="color: #666;"&gt; Humidity:&lt;/span&gt;\n                &lt;strong&gt;${formatNumberForDisplay(rh,0)}%&lt;/strong&gt;\n              &lt;/div&gt;\n            &lt;/div&gt;\n            \n            \x3c!-- Additional Properties (collapsible or smaller) --\x3e\n            &lt;div style="border-top: 1px solid ${theme.palette.divider}; padding-top: 8px; margin-top: 8px;"&gt;\n              &lt;div style="font-size: 11px; color: #888; margin-bottom: 4px;"&gt;\n                Advanced Properties:\n              &lt;/div&gt;\n              &lt;div style="font-size: 11px; color: #666; line-height: 1.4;"&gt;\n                &lt;div&gt;Dew Point: ${formatNumberForDisplay(dewPoint,1)}${tempUnit} \n                  &lt;span style="color: #999;"&gt;(condensation temp)&lt;/span&gt;\n                &lt;/div&gt;\n                &lt;div&gt;Wet Bulb: ${formatNumberForDisplay(wetBulb,1)}${tempUnit}\n                  &lt;span style="color: #999;"&gt;(evaporative cooling limit)&lt;/span&gt;\n                &lt;/div&gt;\n              &lt;/div&gt;\n            &lt;/div&gt;\n            \n            \x3c!-- Chart Reading Help --\x3e\n            &lt;div style="border-top: 1px solid ${theme.palette.divider}; padding-top: 8px; margin-top: 8px; \n                        font-size: 10px; color: #999;"&gt;\n              &lt;div&gt; How to read this chart:&lt;/div&gt;\n              &lt;div&gt; X-axis = Temperature, Y-axis = Humidity&lt;/div&gt;\n              &lt;div&gt; Green zones = Comfortable conditions&lt;/div&gt;\n              &lt;div&gt; Points show air conditions over time&lt;/div&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n        `}},grid:{...CHART_DESIGN_TOKENS.grid.base,left:"10%",right:colorByTime&amp;&amp;finalData.some(d=&gt;d.timestamp)?"15%":"10%",bottom:timelineData?"15%":finalData.length&gt;10?"12%":"10%",top:calculateGridTop({hasTitle:!0,hasToolbox:!0}),containLabel:!0},legend:{show:!0,data:[{name:`Conditions Over Time (${finalData.length} readings)`,icon:"circle"}],bottom:10,left:"center",textStyle:{color:theme.palette.text.secondary,fontSize:11},formatter:name=&gt;{if(finalData.length&gt;0){const avgTemp=finalData.reduce((sum,d)=&gt;sum+d.temperature,0)/finalData.length,avgHumidity=finalData.reduce((sum,d)=&gt;sum+d.humidity,0)/finalData.length;return`${name} | Avg: ${avgTemp.toFixed(1)}${temperatureUnit}, ${avgHumidity.toFixed(0)}% RH`}return name}},dataZoom:[{type:"inside",xAxisIndex:0,filterMode:"none"},{type:"inside",yAxisIndex:0,filterMode:"none"},...finalData.length&gt;10?[{type:"slider",show:!0,bottom:40,height:20,borderColor:theme.palette.divider,fillerColor:"dark"===theme.palette.mode?"rgba(33, 150, 243, 0.3)":"rgba(33, 150, 243, 0.2)",handleStyle:{color:theme.palette.primary.main},moveHandleSize:7,startValue:0,endValue:100,labelFormatter:value=&gt;{const index2=Math.floor(value/100*finalData.length),point=finalData[index2];return(null==point?void 0:point.timestamp)?new Date(point.timestamp).toLocaleTimeString():""}}]:[]],graphic:[{type:"group",right:20,top:20,children:[{type:"rect",shape:{width:250,height:80},style:{fill:"dark"===theme.palette.mode?"rgba(0, 0, 0, 0.7)":"rgba(255, 255, 255, 0.9)",stroke:theme.palette.divider,lineWidth:1,shadowBlur:4,shadowColor:"dark"===theme.palette.mode?"rgba(0, 0, 0, 0.3)":"rgba(0, 0, 0, 0.1)"}},{type:"text",style:{text:" How to Read This Chart",fontSize:12,fontWeight:"bold",fill:theme.palette.text.primary,x:10,y:15}},{type:"text",style:{text:" Each dot = conditions at one point in time\\n Tight cluster = stable conditions\\n Wide spread = variable conditions\\n Green zone = comfortable range",fontSize:10,fill:theme.palette.text.secondary,x:10,y:35,lineHeight:14}}]},...0===finalData.length?[{type:"text",left:"center",top:"middle",style:{text:"No data available for the selected time range\\n\\nSelect temperature and humidity points\\nto see conditions over time",fontSize:14,fill:theme.palette.text.secondary,textAlign:"center",lineHeight:20}}]:[]],xAxis:{type:"value",name:`Dry Bulb Temperature (${temperatureUnit})`,nameLocation:"middle",nameGap:30,nameTextStyle:{color:theme.palette.text.primary,fontSize:14,fontWeight:500},min:"C"===temperatureUnit?10:50,max:"C"===temperatureUnit?40:104,axisLabel:{color:theme.palette.text.secondary,formatter:"{value}"},axisLine:{lineStyle:{color:theme.palette.divider}},splitLine:{show:showGridLines,lineStyle:{color:theme.palette.divider,opacity:.2}}},yAxis:{type:"value",name:"Relative Humidity (%)",nameLocation:"middle",nameGap:50,nameTextStyle:{color:theme.palette.text.primary,fontSize:14,fontWeight:500},min:0,max:100,axisLabel:{color:theme.palette.text.secondary,formatter:"{value}%"},axisLine:{lineStyle:{color:theme.palette.divider}},splitLine:{show:showGridLines,lineStyle:{color:theme.palette.divider,opacity:.2}}},...timelineData?{baseOption:{series:[...comfortZonePolygons,...showGridLines?relativeHumidityLines:[],...showGridLines?enthalpyLines:[],...showGridLines?wetBulbLines:[]]},options:timelineData.timeline.map(timestamp=&gt;{var _a;return{series:[{name:`Conditions at ${new Date(timestamp).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0})}`,type:"scatter",data:(null==(_a=timelineData.timeGroups.get(timestamp))?void 0:_a.map((point,index2)=&gt;{var _a2;const displayName=showMarkerTags?getPointDisplayLabel({name:point.formattedName||point.name||`Point ${index2+1}`,marker_tags:point.markerTags,unit:null==(_a2=point.pointMetadata)?void 0:_a2.unit},{displayMode:"smart",context:"legend"}):point.formattedName||point.name||`Point ${index2+1}`,tempCelsius="C"===temperatureUnit?point.temperature:5*(point.temperature-32)/9,properties=point.properties||calculatePsychrometricProperties(tempCelsius,point.humidity),dewPoint=point.dewPoint||calculateDewPoint(tempCelsius,point.humidity),wetBulb=point.wetBulb||calculateWetBulbTemperature(tempCelsius,point.humidity),enthalpy=point.enthalpy||properties.enthalpy,specificVolume=point.specificVolume||properties.specificVolume,displayDewPoint="F"===temperatureUnit?9*dewPoint/5+32:dewPoint,displayWetBulb="F"===temperatureUnit?9*wetBulb/5+32:wetBulb;return{value:[point.temperature,point.humidity,displayDewPoint,displayWetBulb,enthalpy,specificVolume,displayName,point.timestamp||index2],itemStyle:{color:theme.palette.primary.main,opacity:.8},emphasis:{scale:1.3,itemStyle:{shadowBlur:15,shadowColor:theme.palette.primary.main,borderColor:theme.palette.primary.dark,borderWidth:2}},pointData:{...point,dewPoint:displayDewPoint,wetBulb:displayWetBulb,enthalpy:enthalpy,specificVolume:specificVolume,properties:properties}}}))||[],symbolSize:10,emphasis:{scale:1.5,focus:"self"},z:10}]}})}:{series:[...comfortZonePolygons,...showGridLines?relativeHumidityLines:[],...showGridLines?enthalpyLines:[],...showGridLines?wetBulbLines:[],{name:`Conditions Over Time (${finalData.length} readings)`,type:"scatter",data:scatterData,symbolSize:function(value,params){return colorByTime?8+params.dataIndex/finalData.length*6:10},itemStyle:{color:params=&gt;{var _a,_b;return(null==(_b=null==(_a=params.data)?void 0:_a.value)?void 0:_b[8])||theme.palette.primary.main}},emphasis:{scale:1.5,focus:"self"},z:10,...onPointClick&amp;&amp;{select:{itemStyle:{borderColor:theme.palette.secondary.main,borderWidth:3}}},...enableAnimations&amp;&amp;{animation:!0,animationDuration:1e3,animationEasing:"cubicOut",animationDelay:function(idx){return 50*idx}}},...colorByTime&amp;&amp;finalData.length&gt;1?[{name:"Condition Trajectory",type:"line",data:finalData.filter(d=&gt;d.timestamp).sort((a,b)=&gt;(a.timestamp||0)-(b.timestamp||0)).map(d=&gt;[d.temperature,d.humidity]),lineStyle:{color:theme.palette.primary.light,width:2,opacity:.6,type:"dashed"},symbol:"none",smooth:!0,z:5,silent:!0,...enableAnimations&amp;&amp;{animation:!0,animationDuration:2e3,animationDurationUpdate:1e3}}]:[]]},...colorByTime&amp;&amp;finalData.some(d=&gt;d.timestamp)?{visualMap:{show:!0,type:"continuous",dimension:7,min:Math.min(...finalData.map(d=&gt;d.timestamp||0)),max:Math.max(...finalData.map(d=&gt;d.timestamp||0)),right:10,top:"center",orient:"vertical",text:["Newer","Older"],textStyle:{color:theme.palette.text.secondary,fontSize:10},inRange:{color:["hsl(240, 70%, 50%)","hsl(120, 70%, 50%)","hsl(0, 70%, 50%)"]},formatter:function(value){return new Date(value).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})},calculable:!0}}:{}};return mergeChartOptions(baseOptions,customOptions,{showDataZoom:!1,showLegend:!1,showToolbox:enableToolbox,enableDataView:!1})},[baseOptions,finalData,title,temperatureUnit,showComfortZone,showGridLines,colorByTime,enableToolbox,comfortZonePolygons,relativeHumidityLines,enthalpyLines,wetBulbLines,scatterData,enableAnimations,timelineData,theme,showMarkerTags,onPointClick]);return reactExports.useMemo(()=&gt;Array.isArray(finalData)?finalData.filter(point=&gt;point&amp;&amp;"number"==typeof point.temperature&amp;&amp;"number"==typeof point.humidity&amp;&amp;!isNaN(point.temperature)&amp;&amp;!isNaN(point.humidity)):[],[finalData]),jsxRuntimeExports.jsx(Box,{ref:containerRef,className:"gpu-psychrometric gpu-heavy-compute gpu-chart-container",sx:{position:"relative",height:height,width:"100%",overflow:"hidden"},children:jsxRuntimeExports.jsx(EChartsWrapper,{error:finalError,height:"100%",loading:finalLoading,option:chartOption,theme:"dark"===theme.palette.mode?"dark":"light",getChartInstance:instance=&gt;{chartInstanceRef.current=instance,onChartReady&amp;&amp;instance&amp;&amp;onChartReady(instance),instance&amp;&amp;onPointClick&amp;&amp;(instance.off("click"),instance.on("click",function(params){var _a;"series"===params.componentType&amp;&amp;"scatter"===params.seriesType&amp;&amp;(null==(_a=params.data)?void 0:_a.pointData)&amp;&amp;onPointClick(params.data.pointData)})),instance&amp;&amp;onPointHover&amp;&amp;(instance.off("mouseover"),instance.off("mouseout"),instance.on("mouseover",function(params){var _a;"series"===params.componentType&amp;&amp;"scatter"===params.seriesType&amp;&amp;(null==(_a=params.data)?void 0:_a.pointData)&amp;&amp;onPointHover(params.data.pointData)}),instance.on("mouseout",function(){onPointHover(null)}))}},`psychrometric-${finalData.length}-${timeRangeLabel}`)})},PerfectEconomizer:({data:data=[],series:series,config:config,loading:loading=!1,error:error=null,height:height=500,title:title="Perfect Economizer Analysis",enableToolbox:enableToolbox=!0,showDiagnostics:showDiagnostics=!0,mode:mode="scatter",showTimeSeriesOverlay:showTimeSeriesOverlay=!1,showFaultMarkers:showFaultMarkers=!0,showOptimalComparison:showOptimalComparison=!0,showEnergyOpportunities:showEnergyOpportunities=!0,onEdit:onEdit,onDelete:onDelete})=&gt;{const theme=useTheme(),baseOptions=useBaseChartOptions(),{processedData:processedData,alignmentQuality:alignmentQuality}=reactExports.useMemo(()=&gt;{if(data&amp;&amp;data.length&gt;0&amp;&amp;"outdoorTemp"in data[0])return{processedData:data,alignmentQuality:null};let actualSeries=series;if(!actualSeries&amp;&amp;Array.isArray(data)&amp;&amp;data.length&gt;0){const firstItem=data[0];firstItem&amp;&amp;"object"==typeof firstItem&amp;&amp;"name"in firstItem&amp;&amp;"data"in firstItem&amp;&amp;(actualSeries=data)}if(!actualSeries||actualSeries.length&lt;2)return{processedData:[],alignmentQuality:null};if(actualSeries&amp;&amp;actualSeries.length&gt;=2){if(actualSeries.some(s=&gt;!s.data||0===s.data.length))return{processedData:[],alignmentQuality:null};const mapSeriesByType=series2=&gt;{var _a,_b,_c;const oatPatterns=["outdoor_temp","oat","outside_air","outside air","outdoor air","ambient_temp","ambient","ext_temp","external_temp","weather"],matPatterns=["mixed_temp","mat","mixed_air","mixed air","supply_temp","supply air","discharge_temp","discharge","sat","supply_air_temp"],ratPatterns=["return_temp","rat","return_air","return air","space_temp","room_temp","zone_temp","return_air_temp"];let oatSeries2=null,matSeries2=null,ratSeries2=null;for(const s of series2){const name=(null==(_a=s.name)?void 0:_a.toLowerCase())||"",markerTag=(null==(_b=s.markerTag)?void 0:_b.toLowerCase())||"",markerTags=(null==(_c=s.markerTags)?void 0:_c.map(tag=&gt;tag.toLowerCase()))||[];oatSeries2||!oatPatterns.some(pattern=&gt;name.includes(pattern)||markerTag.includes(pattern)||markerTags.some(tag=&gt;tag.includes(pattern)))?matSeries2||!matPatterns.some(pattern=&gt;name.includes(pattern)||markerTag.includes(pattern)||markerTags.some(tag=&gt;tag.includes(pattern)))?ratSeries2||!ratPatterns.some(pattern=&gt;name.includes(pattern)||markerTag.includes(pattern)||markerTags.some(tag=&gt;tag.includes(pattern)))||(ratSeries2=s):matSeries2=s:oatSeries2=s}const unmatchedSeries=series2.filter(s=&gt;s!==oatSeries2&amp;&amp;s!==matSeries2&amp;&amp;s!==ratSeries2);return!oatSeries2&amp;&amp;unmatchedSeries.length&gt;0&amp;&amp;(oatSeries2=unmatchedSeries.shift()),!matSeries2&amp;&amp;unmatchedSeries.length&gt;0&amp;&amp;(matSeries2=unmatchedSeries.shift()),!ratSeries2&amp;&amp;unmatchedSeries.length&gt;0&amp;&amp;(ratSeries2=unmatchedSeries.shift()),{oatSeries:oatSeries2,matSeries:matSeries2,ratSeries:ratSeries2}},{oatSeries:oatSeries,matSeries:matSeries,ratSeries:ratSeries}=mapSeriesByType(actualSeries);if(!oatSeries||!matSeries)return{processedData:[],alignmentQuality:null};const seriesToAlign=[oatSeries,matSeries];ratSeries&amp;&amp;seriesToAlign.push(ratSeries);const quality=analyzeAlignmentQuality(seriesToAlign);return{processedData:alignTimeSeries(seriesToAlign,{method:"linear",maxGap:72e5,tolerance:9e5,requireAllSeries:!1,minSeriesRequired:2,fillGaps:!0}).filter(point=&gt;!isNaN(point.values[0])&amp;&amp;!isNaN(point.values[1])).map(point=&gt;({timestamp:point.timestamp,outdoorTemp:point.values[0],mixedAirTemp:point.values[1],returnAirTemp:isNaN(point.values[2])?config.returnAirTemp:point.values[2]})),alignmentQuality:quality}}return{processedData:[],alignmentQuality:null}},[data,series,config.returnAirTemp]),transformedData=reactExports.useMemo(()=&gt;transformToEconomizer({data:processedData,config:config,showDiagnostics:showDiagnostics}),[processedData,config,showDiagnostics]),chartOption=reactExports.useMemo(()=&gt;{if(!Array.isArray(processedData)||0===processedData.length)return{title:title?{...CHART_DESIGN_TOKENS.title.base,text:title,textStyle:{...CHART_DESIGN_TOKENS.title.base.textStyle,color:theme.palette.text.primary}}:void 0,xAxis:{type:"value",name:"Outdoor Air Temperature (F)",nameLocation:"middle",nameGap:40},yAxis:{type:"value",name:"Mixed Air Temperature (F)",nameLocation:"middle",nameGap:40},series:[],graphic:[{type:"text",left:"center",top:"center",style:{text:"No data available",fontSize:16,fill:theme.palette.text.disabled}}]};const{mixedAirSetpoint:mixedAirSetpoint,minimumOAPercentage:minimumOAPercentage,returnAirTemp:returnAirTemp,economizerHighLimit:economizerHighLimit}=config,identifyOperatingMode=point=&gt;{const{outdoorTemp:outdoorTemp,mixedAirTemp:mixedAirTemp}=point;let expectedMode,expectedMAT,diagnosticStatus;outdoorTemp&lt;(mixedAirSetpoint-returnAirTemp)/(minimumOAPercentage/100)+returnAirTemp?(expectedMode="Preheat + MOA",expectedMAT=returnAirTemp-minimumOAPercentage/100*(returnAirTemp-outdoorTemp)):outdoorTemp&lt;=mixedAirSetpoint?(expectedMode="Economizer Cooling",expectedMAT=mixedAirSetpoint):outdoorTemp&lt;=economizerHighLimit?(expectedMode="Integrated Economizer",expectedMAT=outdoorTemp):(expectedMode="Mechanical Cooling + MOA",expectedMAT=mixedAirSetpoint);const deviation=Math.abs(mixedAirTemp-expectedMAT);return diagnosticStatus=deviation&lt;2?"good":deviation&lt;5?"warning":"problem",{expectedMode:expectedMode,expectedMAT:expectedMAT,diagnosticStatus:diagnosticStatus,deviation:deviation}},createTimeSeriesChart=()=&gt;{const sortedData=[...processedData].sort((a,b)=&gt;a.timestamp-b.timestamp),oatData=sortedData.map(d=&gt;[d.timestamp,d.outdoorTemp]),matData=sortedData.map(d=&gt;[d.timestamp,d.mixedAirTemp]),ratData=sortedData.map(d=&gt;[d.timestamp,d.returnAirTemp||config.returnAirTemp]),actualDamperData=sortedData.filter(d=&gt;void 0!==d.damperPosition).map(d=&gt;[d.timestamp,d.damperPosition]),optimalDamperData=sortedData.filter(d=&gt;void 0!==d.optimalDamperPosition).map(d=&gt;[d.timestamp,d.optimalDamperPosition]),energyOpportunityData=sortedData.filter(d=&gt;void 0!==d.energySavingsPotential).map(d=&gt;[d.timestamp,d.energySavingsPotential]),faultMarkers=showFaultMarkers?sortedData.filter(d=&gt;d.faultDetected).map(d=&gt;({coord:[d.timestamp,d.mixedAirTemp],symbol:"triangle",symbolSize:"critical"===d.faultSeverity?12:"high"===d.faultSeverity?10:8,itemStyle:{color:"critical"===d.faultSeverity?getHVACModeColor("inefficient"):"high"===d.faultSeverity?getHVACModeColor("mechanical"):"medium"===d.faultSeverity?getHVACModeColor("preheat"):getHVACModeColor("transitional")}})):[];return{title:{text:title+" - Time Series",left:"center",top:20,textStyle:{color:theme.palette.text.primary,fontSize:18,fontWeight:600}},tooltip:{...CHART_DESIGN_TOKENS.tooltip.base,trigger:"axis",axisPointer:{type:"cross",animation:!1},backgroundColor:getTooltipBackground("dark"===theme.palette.mode),borderColor:getTooltipBorder("dark"===theme.palette.mode),textStyle:{...CHART_DESIGN_TOKENS.tooltip.base.textStyle,color:theme.palette.text.primary},formatter:params=&gt;{let tooltip=`&lt;div style="padding: 12px;"&gt;&lt;strong&gt;${ChartTimeFormatter.tooltip(params[0].value[0])}&lt;/strong&gt;&lt;br/&gt;`;return params.forEach(param=&gt;{param.seriesName.includes("Temperature")?tooltip+=`${param.seriesName}: ${formatNumberForDisplay(param.value[1],1)}${config.unit}&lt;br/&gt;`:param.seriesName.includes("Damper")?tooltip+=`${param.seriesName}: ${formatNumberForDisplay(param.value[1],0)}%&lt;br/&gt;`:param.seriesName.includes("Energy")&amp;&amp;(tooltip+=`${param.seriesName}: ${formatNumberForDisplay(param.value[1],1)} kW&lt;br/&gt;`)}),tooltip+="&lt;/div&gt;",tooltip}},legend:{data:["Outdoor Temperature","Mixed Air Temperature","Return Air Temperature",...actualDamperData.length&gt;0?["Actual Damper Position"]:[],...optimalDamperData.length&gt;0&amp;&amp;showOptimalComparison?["Optimal Damper Position"]:[],...energyOpportunityData.length&gt;0&amp;&amp;showEnergyOpportunities?["Energy Savings Potential"]:[]],top:60,textStyle:{color:theme.palette.text.secondary}},grid:[{...CHART_DESIGN_TOKENS.grid.base,left:"10%",right:"10%",height:"35%",top:calculateGridTop({hasTitle:!!title,hasToolbox:!0})},{left:"10%",right:"10%",height:"20%",top:"55%"},{left:"10%",right:"10%",height:"15%",top:"80%"}],xAxis:[{type:"time",gridIndex:0,axisLabel:{show:!1},axisLine:{show:!1}},{type:"time",gridIndex:1,axisLabel:{show:!1},axisLine:{show:!1}},{type:"time",gridIndex:2,axisLabel:{color:theme.palette.text.secondary}}],yAxis:[{type:"value",gridIndex:0,name:`Temperature (${config.unit})`,nameTextStyle:{color:theme.palette.text.primary},axisLabel:{color:theme.palette.text.secondary,formatter:value=&gt;`${formatNumberForDisplay(value,0)}`}},{type:"value",gridIndex:1,name:"Damper Position (%)",nameTextStyle:{color:theme.palette.text.primary},max:100,axisLabel:{color:theme.palette.text.secondary,formatter:value=&gt;`${value}%`}},{type:"value",gridIndex:2,name:"Energy (kW)",nameTextStyle:{color:theme.palette.text.primary},axisLabel:{color:theme.palette.text.secondary,formatter:value=&gt;`${formatNumberForDisplay(value,1)}`}}],series:[{name:"Outdoor Temperature",type:"line",xAxisIndex:0,yAxisIndex:0,data:oatData,smooth:!0,lineStyle:{color:getHVACModeColor("integrated"),width:2},showSymbol:!1},{name:"Mixed Air Temperature",type:"line",xAxisIndex:0,yAxisIndex:0,data:matData,smooth:!0,lineStyle:{color:getHVACModeColor("economizer"),width:2},showSymbol:!1},{name:"Return Air Temperature",type:"line",xAxisIndex:0,yAxisIndex:0,data:ratData,smooth:!0,lineStyle:{color:getHVACModeColor("preheat"),width:2},showSymbol:!1},{name:"Mixed Air Setpoint",type:"line",xAxisIndex:0,yAxisIndex:0,data:sortedData.map(d=&gt;[d.timestamp,config.mixedAirSetpoint]),lineStyle:{color:theme.palette.text.secondary,width:2,type:"dashed"},showSymbol:!1},...actualDamperData.length&gt;0?[{name:"Actual Damper Position",type:"line",xAxisIndex:1,yAxisIndex:1,data:actualDamperData,smooth:!0,lineStyle:{color:getHVACModeColor("mechanical"),width:2},showSymbol:!1}]:[],...optimalDamperData.length&gt;0&amp;&amp;showOptimalComparison?[{name:"Optimal Damper Position",type:"line",xAxisIndex:1,yAxisIndex:1,data:optimalDamperData,smooth:!0,lineStyle:{color:getHVACModeColor("optimal"),width:2,type:"dashed"},showSymbol:!1}]:[],...energyOpportunityData.length&gt;0&amp;&amp;showEnergyOpportunities?[{name:"Energy Savings Potential",type:"line",xAxisIndex:2,yAxisIndex:2,data:energyOpportunityData,smooth:!0,lineStyle:{color:theme.palette.secondary.main,width:2},areaStyle:{color:{type:"linear",x:0,y:0,x2:0,y2:1,colorStops:[{offset:0,color:theme.palette.secondary.main+"4D"},{offset:1,color:theme.palette.secondary.main+"1A"}]}},showSymbol:!1}]:[]],...faultMarkers.length&gt;0?{markPoint:{data:faultMarkers,label:{show:!1}}}:{}}};if("timeseries"===mode)return createTimeSeriesChart();if("combined"===mode)return createTimeSeriesChart();const perfectLines=(()=&gt;{const tempRange=[-40,130],minOATemp=(mixedAirSetpoint-returnAirTemp)/(minimumOAPercentage/100)+returnAirTemp;return[{name:"Economizer Cooling (Free Cooling)",type:"line",data:[[minOATemp,mixedAirSetpoint],[mixedAirSetpoint,mixedAirSetpoint]],lineStyle:{color:getHVACModeColor("economizer"),width:3,type:"solid"},symbol:"none",z:10,emphasis:{lineStyle:{width:4}},tooltip:{trigger:"axis",formatter:()=&gt;`&lt;div style="padding: 8px;"&gt;\n              &lt;strong style="color: ${getHVACModeColor("economizer")};"&gt;Economizer Cooling Mode&lt;/strong&gt;&lt;br/&gt;\n              &lt;small&gt;Free cooling - No mechanical cooling needed&lt;/small&gt;&lt;br/&gt;\n              &lt;hr style="margin: 4px 0; opacity: 0.3;"/&gt;\n               Maintains ${mixedAirSetpoint}${config.unit} mixed air&lt;br/&gt;\n               Modulates OA damper position&lt;br/&gt;\n               Maximum energy savings&lt;br/&gt;\n               Operating range: ${Math.round(minOATemp)}-${mixedAirSetpoint}${config.unit}\n            &lt;/div&gt;`}},{name:"MOA with Preheat",type:"line",data:[[tempRange[0],returnAirTemp-minimumOAPercentage/100*(returnAirTemp-tempRange[0])],[minOATemp,mixedAirSetpoint]],lineStyle:{color:getHVACModeColor("preheat"),width:3,type:"solid"},symbol:"none",z:10,tooltip:{formatter:`MOA with Preheat: ${minimumOAPercentage}% outdoor air with preheat as needed`}},{name:"Integrated Economizer",type:"line",data:[[mixedAirSetpoint,mixedAirSetpoint],[economizerHighLimit,economizerHighLimit]],lineStyle:{color:getHVACModeColor("integrated"),width:3,type:"solid"},symbol:"none",z:10,tooltip:{formatter:"Integrated Economizer: 100% outdoor air, OAT = MAT"}},{name:"MOA with Cooling",type:"line",data:[[economizerHighLimit,mixedAirSetpoint],[tempRange[1],returnAirTemp-minimumOAPercentage/100*(returnAirTemp-tempRange[1])]],lineStyle:{color:getHVACModeColor("mechanical"),width:3,type:"solid"},symbol:"none",z:10,tooltip:{formatter:`MOA with Cooling: ${minimumOAPercentage}% outdoor air with mechanical cooling`}}]})(),dataPoints=processedData.map(point=&gt;{const analysis=identifyOperatingMode(point);let color;switch(analysis.diagnosticStatus){case"good":color=getHVACModeColor("optimal");break;case"warning":color=getHVACModeColor("preheat");break;case"problem":color=getHVACModeColor("inefficient");break;default:color=theme.palette.text.disabled}const symbolSize=Math.min(Math.max(4,2*analysis.deviation),16);return{value:[point.outdoorTemp,point.mixedAirTemp],symbolSize:symbolSize,itemStyle:{color:color},emphasis:{itemStyle:{borderColor:theme.palette.text.primary,borderWidth:2}},analysis:analysis,originalPoint:point}}),diagnosticOverlays=(()=&gt;{if(!showDiagnostics)return[];const overlays=[],problemPoints=processedData.filter(p=&gt;"problem"===identifyOperatingMode(p).diagnosticStatus);if(problemPoints.length&gt;0){const simultaneousIssues=problemPoints.filter(p=&gt;p.preheatActive&amp;&amp;p.coolingActive);simultaneousIssues.length&gt;0&amp;&amp;overlays.push({name:"Simultaneous Heating/Cooling",type:"scatter",data:simultaneousIssues.map(p=&gt;[p.outdoorTemp,p.mixedAirTemp]),symbol:"triangle",symbolSize:12,itemStyle:{color:getHVACModeColor("inefficient"),borderColor:theme.palette.background.paper,borderWidth:2},z:20,tooltip:{formatter:"WARNING: Simultaneous heating and cooling detected!"}})}return overlays})(),totalPoints=processedData.reduce((sum,series2)=&gt;{var _a;return sum+((null==(_a=series2.data)?void 0:_a.length)||0)},0),animationMode=CHART_DESIGN_TOKENS.adaptive.animationMode(totalPoints),customOptions={...CHART_DESIGN_TOKENS.animation[animationMode],title:title?{...CHART_DESIGN_TOKENS.title.base,text:title,textStyle:{...CHART_DESIGN_TOKENS.title.base.textStyle,color:theme.palette.text.primary}}:void 0,tooltip:{...CHART_DESIGN_TOKENS.tooltip.base,trigger:"item",backgroundColor:getTooltipBackground("dark"===theme.palette.mode),borderColor:getTooltipBorder("dark"===theme.palette.mode),textStyle:{...CHART_DESIGN_TOKENS.tooltip.base.textStyle,color:theme.palette.text.primary},formatter:params=&gt;{if("series"===params.componentType&amp;&amp;"Real Data"===params.seriesName){const point=params.data.originalPoint,analysis=params.data.analysis;return`\n              &lt;div style="padding: 12px;"&gt;\n                &lt;div style="font-weight: 600; margin-bottom: 8px;"&gt;\n                  ${ChartTimeFormatter.tooltip(point.timestamp)}\n                &lt;/div&gt;\n                &lt;div style="margin-bottom: 8px;"&gt;\n                  &lt;strong&gt;Actual:&lt;/strong&gt;&lt;br/&gt;\n                  OAT: ${formatNumberForDisplay(point.outdoorTemp,1)}${config.unit}&lt;br/&gt;\n                  MAT: ${formatNumberForDisplay(point.mixedAirTemp,1)}${config.unit}\n                  ${point.markerTags?"&lt;br/&gt;&lt;small&gt;"+formatPointWithTags({name:"",markerTags:point.markerTags},{maxTags:3,includeUnit:!1})+"&lt;/small&gt;":""}\n                &lt;/div&gt;\n                &lt;div style="margin-bottom: 8px;"&gt;\n                  &lt;strong&gt;Expected Mode:&lt;/strong&gt; ${analysis.expectedMode}&lt;br/&gt;\n                  &lt;strong&gt;Expected MAT:&lt;/strong&gt; ${formatNumberForDisplay(analysis.expectedMAT,1)}${config.unit}\n                &lt;/div&gt;\n                &lt;div style="color: ${"good"===analysis.diagnosticStatus?getHVACModeColor("optimal"):"warning"===analysis.diagnosticStatus?getHVACModeColor("preheat"):getHVACModeColor("inefficient")};"&gt;\n                  &lt;strong&gt;Status:&lt;/strong&gt; ${analysis.diagnosticStatus.toUpperCase()}&lt;br/&gt;\n                  &lt;strong&gt;Deviation:&lt;/strong&gt; ${formatNumberForDisplay(analysis.deviation,1)}${config.unit}\n                &lt;/div&gt;\n                ${point.preheatActive?`&lt;div style="color: ${getHVACModeColor("preheat")};"&gt; Preheat Active&lt;/div&gt;`:""}\n                ${point.coolingActive?`&lt;div style="color: ${getHVACModeColor("integrated")};"&gt; Cooling Active&lt;/div&gt;`:""}\n                ${point.reheatActive?`&lt;div style="color: ${getHVACModeColor("mechanical")};"&gt; Reheat Active&lt;/div&gt;`:""}\n              &lt;/div&gt;\n            `}return params.value}},legend:{data:[{name:"Economizer Cooling (Free Cooling)",icon:"rect"},{name:"MOA with Preheat",icon:"rect"},{name:"Integrated Economizer",icon:"rect"},{name:"MOA with Cooling",icon:"rect"},{name:"Actual Operation",icon:"circle"}],top:60,textStyle:{color:theme.palette.text.secondary},selected:{"Economizer Cooling (Free Cooling)":!0,"MOA with Preheat":!0,"Integrated Economizer":!0,"MOA with Cooling":!0,"Actual Operation":!0}},grid:{...CHART_DESIGN_TOKENS.grid.base,left:"10%",right:"10%",bottom:"15%",top:calculateGridTop({hasTitle:!!title,hasToolbox:!0}),containLabel:!0},xAxis:{type:"value",name:`Outdoor Temperature (${config.unit})`,nameLocation:"middle",nameGap:30,nameTextStyle:{color:theme.palette.text.primary,fontSize:14,fontWeight:500},min:-40,max:130,axisLabel:{color:theme.palette.text.secondary,formatter:value=&gt;`${formatNumberForDisplay(value,0)}`},axisLine:{lineStyle:{color:theme.palette.divider}},splitLine:{show:!0,lineStyle:{color:theme.palette.divider,opacity:.3}}},yAxis:{type:"value",name:`Mixed Air Temperature (${config.unit})`,nameLocation:"middle",nameGap:50,nameTextStyle:{color:theme.palette.text.primary,fontSize:14,fontWeight:500},min:30,max:90,axisLabel:{color:theme.palette.text.secondary,formatter:value=&gt;`${formatNumberForDisplay(value,0)}`},axisLine:{lineStyle:{color:theme.palette.divider}},splitLine:{show:!0,lineStyle:{color:theme.palette.divider,opacity:.3}}},series:[...perfectLines,{name:"Actual Operation",type:"scatter",data:dataPoints,symbolSize:6,z:15,emphasis:{focus:"self",scale:1.5}},...diagnosticOverlays],graphic:[{type:"text",left:"15%",top:"25%",style:{text:"HEATING\nZONE",fontSize:12,fontWeight:"bold",fill:getHVACModeColor("preheat"),opacity:.3}},{type:"text",left:"40%",top:"35%",style:{text:"FREE COOLING\nZONE",fontSize:12,fontWeight:"bold",fill:getHVACModeColor("economizer"),opacity:.3}},{type:"text",left:"65%",top:"50%",style:{text:"100% OA",fontSize:12,fontWeight:"bold",fill:getHVACModeColor("integrated"),opacity:.3}},{type:"text",right:"15%",bottom:"25%",style:{text:"MECHANICAL\nCOOLING",fontSize:12,fontWeight:"bold",fill:getHVACModeColor("mechanical"),opacity:.3}},{type:"group",right:20,bottom:80,children:[{type:"rect",shape:{width:180,height:60},style:{fill:theme.palette.background.paper,stroke:theme.palette.divider}},{type:"text",style:{text:`Setpoint: ${mixedAirSetpoint}${config.unit}\nMin OA: ${minimumOAPercentage}%\nHigh Limit: ${economizerHighLimit}${config.unit}`,fontSize:11,fill:theme.palette.text.secondary},position:[10,10]}]}]};return mergeChartOptions(baseOptions,customOptions,{showDataZoom:!1,showLegend:!0,showToolbox:enableToolbox,enableDataView:!1})},[baseOptions,transformedData,processedData,config,title,enableToolbox,showDiagnostics,theme,mode,showFaultMarkers,showOptimalComparison,showEnergyOpportunities]);return jsxRuntimeExports.jsxs(Box,{position:"relative",height:height,children:[jsxRuntimeExports.jsx(PerfectEconomizerHelpButton,{config:config}),0===processedData.length?jsxRuntimeExports.jsxs(Alert,{severity:"warning",sx:{position:"absolute",top:50,left:8,right:8,zIndex:10,backgroundColor:"dark"===theme.palette.mode?"rgba(50, 50, 50, 0.95)":"rgba(255, 255, 255, 0.95)"},children:[jsxRuntimeExports.jsx("strong",{children:"No data available for display"}),jsxRuntimeExports.jsx("br",{}),"This can happen when:",jsxRuntimeExports.jsxs("ul",{style:{marginTop:4,marginBottom:0,paddingLeft:20},children:[jsxRuntimeExports.jsx("li",{children:"Controllers were offline during the selected time period"}),jsxRuntimeExports.jsx("li",{children:"Sensors have very different sampling rates"}),jsxRuntimeExports.jsx("li",{children:"Data gaps exceed 1 hour between readings"}),jsxRuntimeExports.jsx("li",{children:"OAT or MAT sensors are missing critical data"})]}),jsxRuntimeExports.jsx("small",{children:"Try selecting a different time range or checking sensor connectivity."})]}):alignmentQuality&amp;&amp;alignmentQuality.alignmentRate&lt;.5&amp;&amp;jsxRuntimeExports.jsxs(Alert,{severity:"info",sx:{position:"absolute",top:50,left:8,right:8,zIndex:10,backgroundColor:"dark"===theme.palette.mode?"rgba(50, 50, 50, 0.95)":"rgba(255, 255, 255, 0.95)"},children:[jsxRuntimeExports.jsxs("strong",{children:["Sparse Data: ",(100*alignmentQuality.alignmentRate).toFixed(0),"% alignment"]}),jsxRuntimeExports.jsx("br",{}),jsxRuntimeExports.jsxs("small",{children:["Using ",alignmentQuality.alignedPoints," of ",alignmentQuality.totalPoints," available timestamps. Data gaps are being filled with last known values.",alignmentQuality.samplingIntervals.map(s=&gt;s.interval?` ${s.name}: ${Math.round(s.interval/6e4)}min intervals`:"").join(", ")]})]}),jsxRuntimeExports.jsx(EChartsWrapper,{error:error,height:height,loading:loading,option:chartOption,theme:"dark"===theme.palette.mode?"dark":"light"})]})},VAVComprehensive:({series:series=[],loading:loading=!1,error:error=null,height:height=900,title:title="VAV System Diagnostics",config:config={},onChartReady:onChartReady})=&gt;{var _a,_b,_c,_d;const theme=useTheme(),chartRef=reactExports.useRef(null),baseOptions=useBaseChartOptions(),[viewMode,setViewMode]=reactExports.useState("panel"),[showHelp,setShowHelp]=reactExports.useState(!1),[zoomState,setZoomState]=reactExports.useState({start:0,end:100}),validatedSeries=reactExports.useMemo(()=&gt;series&amp;&amp;Array.isArray(series)?series.map(s=&gt;({...s,data:Array.isArray(s.data)?s.data.filter(point=&gt;Array.isArray(point)&amp;&amp;point.length&gt;=2&amp;&amp;!isNaN(point[0])&amp;&amp;!isNaN(point[1])):[]})).filter(s=&gt;s.data.length&gt;0):[],[series]),diagnostics=reactExports.useMemo(()=&gt;{var _a2;if(validatedSeries.length&lt;7)return{healthScore:0,airflowAlarms:[],temperatureAlarms:[],damperAlarms:[],huntingDetected:!1,leakingDamper:!1,damperEfficiency:0,systemRequests:{heating:0,cooling:0,pressure:0,coolingSATReset:0,staticPressureReset:0,hotWaterReset:0},recommendations:["Insufficient data for analysis"],activeFaults:[],comprehensiveFaults:[],sensorReliability:[],healthReport:{overallHealth:0,criticalIssues:0,estimatedMonthlyCost:0,topPriorities:[],maintenanceSchedule:[]}};try{const[airflow,airflowSp,damper,heating,dat,eat,roomTemp]=validatedSeries,formatData=series2=&gt;series2.data.map(point=&gt;({timestamp:point[0],value:point[1]})),persistentFaults=(()=&gt;{const faults=[],faultConditions={lowAirflow:{startTime:null,duration:0},highTemperature:{startTime:null,duration:0},damperStuck:{startTime:null,duration:0},simultaneousHC:{startTime:null,duration:0}};for(let i=0;i&lt;Math.min(airflow.data.length,airflowSp.data.length);i++){const timestamp=airflow.data[i][0],actualFlow=airflow.data[i][1],setpointFlow=airflowSp.data[i][1];if(setpointFlow&gt;0&amp;&amp;actualFlow&lt;.7*setpointFlow){if(faultConditions.lowAirflow.startTime||(faultConditions.lowAirflow.startTime=timestamp),faultConditions.lowAirflow.duration=timestamp-(faultConditions.lowAirflow.startTime||timestamp),faultConditions.lowAirflow.duration&gt;=3e5){const errorPct=((setpointFlow-actualFlow)/setpointFlow*100).toFixed(1);faults.push({type:"Low Airflow",severity:"high",duration:faultConditions.lowAirflow.duration,message:`Airflow ${errorPct}% below setpoint for &gt; 5 minutes`,timestamp:timestamp})}}else faultConditions.lowAirflow.startTime=null,faultConditions.lowAirflow.duration=0;if(i&gt;=10){const recentDamperValues=damper.data.slice(i-10,i).map(d=&gt;d[1]);Math.max(...recentDamperValues)-Math.min(...recentDamperValues)&lt;2?(faultConditions.damperStuck.startTime||(faultConditions.damperStuck.startTime=timestamp),faultConditions.damperStuck.duration=timestamp-(faultConditions.damperStuck.startTime||timestamp),faultConditions.damperStuck.duration&gt;=3e5&amp;&amp;faults.push({type:"Damper Stuck",severity:"medium",duration:faultConditions.damperStuck.duration,message:`Damper position unchanged for &gt; 5 minutes at ${damper.data[i][1].toFixed(0)}%`,timestamp:timestamp})):(faultConditions.damperStuck.startTime=null,faultConditions.damperStuck.duration=0)}if(i&lt;heating.data.length&amp;&amp;i&lt;damper.data.length){const heatingVal=heating.data[i][1],damperVal=damper.data[i][1];heatingVal&gt;10&amp;&amp;damperVal&gt;70?(faultConditions.simultaneousHC.startTime||(faultConditions.simultaneousHC.startTime=timestamp),faultConditions.simultaneousHC.duration=timestamp-(faultConditions.simultaneousHC.startTime||timestamp),faultConditions.simultaneousHC.duration&gt;=3e5&amp;&amp;faults.push({type:"Energy Waste",severity:"medium",duration:faultConditions.simultaneousHC.duration,message:"Simultaneous heating and cooling for &gt; 5 minutes",timestamp:timestamp})):(faultConditions.simultaneousHC.startTime=null,faultConditions.simultaneousHC.duration=0)}}return faults})(),comprehensiveFaults=detectComprehensiveFaults({airflow:airflow.data.map(d=&gt;d[1]),airflowSp:airflowSp.data.map(d=&gt;d[1]),damper:damper.data.map(d=&gt;d[1]),heating:heating.data.map(d=&gt;d[1]),dat:dat.data.map(d=&gt;d[1]),eat:eat.data.map(d=&gt;d[1]),roomTemp:roomTemp.data.map(d=&gt;d[1]),timestamps:airflow.data.map(d=&gt;d[0])},{VcoolMax:(null==config?void 0:config.VcoolMax)||1e3,heatingPlantOn:!1!==(null==config?void 0:config.heatingPlantOn),ahuSAT:(null==config?void 0:config.ahuSAT)||55}),sensorReliabilityAnalysis=[analyzeSensorReliability(airflow.data.map(d=&gt;d[1]),"Airflow Sensor",{min:0,max:(null==config?void 0:config.VcoolMax)||2e3}),analyzeSensorReliability(roomTemp.data.map(d=&gt;d[1]),"Room Temperature",{min:50,max:95}),analyzeSensorReliability(dat.data.map(d=&gt;d[1]),"Discharge Air Temp",{min:40,max:120}),analyzeSensorReliability(damper.data.map(d=&gt;d[1]),"Damper Position",{min:0,max:100})],healthReport=generateSystemHealthReport(comprehensiveFaults,sensorReliabilityAnalysis),airflowAlarms=detectLowAirflowAlarm(formatData(airflow),formatData(airflowSp),null==config?void 0:config.hasImportanceMultiplier),leakingDamper=(null==(_a2=comprehensiveFaults.find(f=&gt;"FC3"===f.code))?void 0:_a2.detected)||!1,detectHunting=()=&gt;{if(!damper.data||damper.data.length&lt;20)return{detected:!1,frequency:0};let oscillations=0,lastDirection=0;const oscillationTimes=[];let lastOscillationTime=damper.data[0][0];for(let i=1;i&lt;damper.data.length;i++){const change=damper.data[i][1]-damper.data[i-1][1],direction=change&gt;0?1:change&lt;0?-1:0;if(0!==direction&amp;&amp;direction!==lastDirection&amp;&amp;0!==lastDirection){oscillations++;const currentTime=damper.data[i][0];oscillationTimes.push(currentTime-lastOscillationTime),lastOscillationTime=currentTime}lastDirection=direction}const avgOscillationPeriod=oscillationTimes.length&gt;0?oscillationTimes.reduce((a,b)=&gt;a+b,0)/oscillationTimes.length:0,frequency=avgOscillationPeriod&gt;0?6e4/avgOscillationPeriod:0;return{detected:frequency&gt;4||oscillations&gt;.3*damper.data.length,frequency:frequency}},huntingResult=detectHunting(),huntingDetected=huntingResult.detected,calculateDamperEfficiency=()=&gt;{if(!damper.data||0===damper.data.length)return.5;const avgPosition=damper.data.reduce((sum,p)=&gt;sum+p[1],0)/damper.data.length;return avgPosition&lt;10||avgPosition&gt;90?.3:avgPosition&lt;20||avgPosition&gt;80?.6:.9},systemRequests={heating:heating.data.filter(p=&gt;p[1]&gt;50).length/Math.max(1,heating.data.length),cooling:damper.data.filter(p=&gt;p[1]&gt;70).length/Math.max(1,damper.data.length),pressure:airflow.data.filter((p,i)=&gt;airflowSp.data[i]&amp;&amp;p[1]&lt;.8*airflowSp.data[i][1]).length/Math.max(1,airflow.data.length)},recommendations=[],activeFaults=comprehensiveFaults.filter(f=&gt;f.detected);activeFaults.sort((a,b)=&gt;{const severityOrder={critical:0,high:1,medium:2,low:3};return severityOrder[a.severity]-severityOrder[b.severity]}),activeFaults.slice(0,5).forEach(fault=&gt;{if(fault.recommendations.length&gt;0){const topRec=fault.recommendations[0],recText=`${fault.name}: ${topRec.action} - ${topRec.detail}`;recommendations.push(recText)}}),sensorReliabilityAnalysis.forEach(sensor=&gt;{sensor.reliability&lt;80&amp;&amp;recommendations.push(`${sensor.sensorName}: ${sensor.recommendation} (Reliability: ${sensor.reliability}%)`)});const coolingSATRequests=calculateCoolingSATResetRequests(roomTemp.data.length&gt;0?roomTemp.data[roomTemp.data.length-1][1]:72,(null==config?void 0:config.coolingSetpoint)||75,damper.data.length&gt;0?damper.data[damper.data.length-1][1]:50,!1),staticPressureRequests=calculateStaticPressureResetRequests(airflow.data.length&gt;0?airflow.data[airflow.data.length-1][1]:0,airflowSp.data.length&gt;0?airflowSp.data[airflowSp.data.length-1][1]:100,damper.data.length&gt;0?damper.data[damper.data.length-1][1]:50),hotWaterRequests=calculateHotWaterResetRequests(dat.data.length&gt;0?dat.data[dat.data.length-1][1]:55,(null==config?void 0:config.datSetpoint)||65,heating.data.length&gt;0?heating.data[heating.data.length-1][1]:0);return persistentFaults.length&gt;0&amp;&amp;persistentFaults.forEach(fault=&gt;{recommendations.push(` ${fault.type}: ${fault.message} (Duration: ${(fault.duration/6e4).toFixed(1)} min)`)}),healthReport.overallHealth&lt;70?recommendations.unshift(` System Health: ${healthReport.overallHealth.toFixed(0)}% - ${healthReport.criticalIssues} critical issues detected`):healthReport.overallHealth&lt;85?recommendations.unshift(` System Health: ${healthReport.overallHealth.toFixed(0)}% - Performance can be improved`):recommendations.unshift(` System Health: ${healthReport.overallHealth.toFixed(0)}% - System operating efficiently`),{healthScore:healthReport.overallHealth,airflowAlarms:airflowAlarms,temperatureAlarms:[],damperAlarms:huntingDetected?[{type:"Hunting Detected",message:`Damper oscillation detected (${huntingResult.frequency.toFixed(1)} cycles/min)`,level:4,timestamp:Date.now()}]:[],huntingDetected:huntingDetected,leakingDamper:leakingDamper,damperEfficiency:calculateDamperEfficiency(),systemRequests:{heating:systemRequests.heating,cooling:systemRequests.cooling,pressure:systemRequests.pressure,coolingSATReset:coolingSATRequests,staticPressureReset:staticPressureRequests,hotWaterReset:hotWaterRequests},recommendations:recommendations.length&gt;0?recommendations:["System operating normally"],activeFaults:persistentFaults.concat(activeFaults.map(f=&gt;({type:f.code,severity:f.severity,duration:f.persistenceTime,message:f.name,timestamp:f.timestamp}))),comprehensiveFaults:comprehensiveFaults,sensorReliability:sensorReliabilityAnalysis,healthReport:healthReport}}catch(err){return console.error("Diagnostics error:",err),{healthScore:0,airflowAlarms:[],temperatureAlarms:[],damperAlarms:[],huntingDetected:!1,leakingDamper:!1,damperEfficiency:0,systemRequests:{heating:0,cooling:0,pressure:0,coolingSATReset:0,staticPressureReset:0,hotWaterReset:0},recommendations:["Error running diagnostics"],activeFaults:[],comprehensiveFaults:[],sensorReliability:[],healthReport:{overallHealth:0,criticalIssues:0,estimatedMonthlyCost:0,topPriorities:[],maintenanceSchedule:[]}}}},[validatedSeries,config]),handleDataZoom=reactExports.useCallback(params=&gt;{if(params.batch){const zoom=params.batch[0];zoom&amp;&amp;setZoomState({start:zoom.start,end:zoom.end})}},[]),chartOptions=reactExports.useMemo(()=&gt;{if(validatedSeries.length&lt;7)return{};const[airflow,airflowSp,damper,heating,dat,eat,roomTemp]=validatedSeries,dataZoomConfig=[{type:"inside",xAxisIndex:"panel"===viewMode?[0,1,2,3]:[0],start:zoomState.start,end:zoomState.end,filterMode:"none"},{type:"slider",xAxisIndex:"panel"===viewMode?[0,1,2,3]:[0],start:zoomState.start,end:zoomState.end,bottom:10,height:30,filterMode:"none"}],totalPoints=validatedSeries.reduce((sum,s)=&gt;{var _a2;return sum+((null==(_a2=s.data)?void 0:_a2.length)||0)},0),animationMode=CHART_DESIGN_TOKENS.adaptive.animationMode(totalPoints);return mergeChartOptions(baseOptions,"panel"===viewMode?{...CHART_DESIGN_TOKENS.animation[animationMode],title:title?{...CHART_DESIGN_TOKENS.title.base,text:title,textStyle:{...CHART_DESIGN_TOKENS.title.base.textStyle,color:theme.palette.text.primary}}:void 0,grid:[{...CHART_DESIGN_TOKENS.grid.base,left:95,right:55,top:calculateGridTop({hasTitle:!!title,hasToolbox:!0}),height:"18%"},{left:95,right:55,top:"29%",height:"18%"},{left:95,right:55,top:"52%",height:"18%"},{left:95,right:55,top:"75%",height:"18%"}],xAxis:[{type:"time",gridIndex:0,axisLabel:{show:!1}},{type:"time",gridIndex:1,axisLabel:{show:!1}},{type:"time",gridIndex:2,axisLabel:{show:!1}},{type:"time",gridIndex:3}],yAxis:[{type:"value",name:"Airflow (CFM)",gridIndex:0,position:"left",nameLocation:"middle",nameGap:60,nameTextStyle:{fontSize:12,fontWeight:"bold"},axisLabel:{fontSize:11,formatter:value=&gt;Math.abs(value)&gt;=1e4?(value/1e3).toFixed(0)+"k":Math.abs(value)&gt;=1e3?(value/1e3).toFixed(1)+"k":value.toFixed(0),rotate:0,margin:8},minInterval:1,splitNumber:4,splitLine:{show:!0,lineStyle:{color:"#e0e0e0",type:"dashed",opacity:.3}}},{type:"value",name:"Damper (%)",gridIndex:1,position:"left",max:100,nameLocation:"middle",nameGap:60,nameTextStyle:{fontSize:12,fontWeight:"bold"},axisLabel:{fontSize:10,formatter:value=&gt;value.toString()},minInterval:10,splitNumber:4,splitLine:{show:!0,lineStyle:{color:"#e0e0e0",type:"dashed",opacity:.3}}},{type:"value",name:"Temperature (F)",gridIndex:2,position:"left",nameLocation:"middle",nameGap:60,nameTextStyle:{fontSize:12,fontWeight:"bold"},axisLabel:{fontSize:10,formatter:value=&gt;value.toString()},minInterval:1,splitNumber:4,splitLine:{show:!0,lineStyle:{color:"#e0e0e0",type:"dashed",opacity:.3}}},{type:"value",name:"Heating (%)",gridIndex:3,position:"left",max:100,nameLocation:"middle",nameGap:60,nameTextStyle:{fontSize:12,fontWeight:"bold"},axisLabel:{fontSize:10,formatter:value=&gt;value.toString()},minInterval:10,splitNumber:4,splitLine:{show:!0,lineStyle:{color:"#e0e0e0",type:"dashed",opacity:.3}}}],series:[{name:"Airflow",type:"line",data:airflow.data,xAxisIndex:0,yAxisIndex:0,smooth:!0,lineStyle:{color:"#2196F3",width:1.5},areaStyle:{color:new LinearGradient(0,0,0,1,[{offset:0,color:alpha("#2196F3",.3)},{offset:1,color:alpha("#2196F3",.05)}])},markLine:{silent:!0,symbol:"none",label:{show:!1},lineStyle:{color:"#666",type:"dashed",width:1,opacity:.5},data:airflowSp.data.length&gt;0?[{yAxis:.7*Math.max(...airflowSp.data.map(d=&gt;d[1])),label:{formatter:"Min (70%)"}}]:[]},emphasis:{disabled:!0}},{name:"Airflow Setpoint",type:"line",data:airflowSp.data,xAxisIndex:0,yAxisIndex:0,smooth:!0,lineStyle:{color:"#4CAF50",width:1.5,type:"dashed"},emphasis:{disabled:!0}},{name:"Damper Position",type:"line",data:damper.data,xAxisIndex:1,yAxisIndex:1,smooth:!0,lineStyle:{color:"#FF9800",width:1.5},areaStyle:{color:new LinearGradient(0,0,0,1,[{offset:0,color:alpha("#FF9800",diagnostics.damperEfficiency&gt;.9?.3:.5)},{offset:1,color:alpha("#FF9800",.05)}])},markArea:diagnostics.huntingDetected?{silent:!0,data:[[{yAxis:0},{yAxis:100}]],itemStyle:{color:alpha("#f44336",.1)}}:void 0,emphasis:{disabled:!0}},{name:"Room Temp",type:"line",data:roomTemp.data,xAxisIndex:2,yAxisIndex:2,smooth:!0,lineStyle:{color:"#F44336",width:1.5},emphasis:{disabled:!0}},{name:"Discharge Air Temp",type:"line",data:dat.data,xAxisIndex:2,yAxisIndex:2,smooth:!0,lineStyle:{color:"#3F51B5",width:1.5},emphasis:{disabled:!0}},{name:"Entering Air Temp",type:"line",data:eat.data,xAxisIndex:2,yAxisIndex:2,smooth:!0,lineStyle:{color:"#009688",width:1.2},emphasis:{disabled:!0}},{name:"Heating Signal",type:"bar",data:heating.data,xAxisIndex:3,yAxisIndex:3,barWidth:"100%",itemStyle:{color:new LinearGradient(0,0,0,1,[{offset:0,color:"#FFA726"},{offset:1,color:alpha("#FFA726",.3)}])},emphasis:{disabled:!0}}],tooltip:{...CHART_DESIGN_TOKENS.tooltip.base,trigger:"axis",axisPointer:{type:"cross",link:{xAxisIndex:"all"},label:{backgroundColor:"#6a7985"},animation:!1,snap:!0},backgroundColor:"dark"===theme.palette.mode?"rgba(50, 50, 50, 0.95)":"rgba(255, 255, 255, 0.95)",borderColor:"dark"===theme.palette.mode?"rgba(255, 255, 255, 0.12)":"rgba(0, 0, 0, 0.12)",textStyle:{...CHART_DESIGN_TOKENS.tooltip.base.textStyle,color:theme.palette.text.primary},showContent:!0,formatter:params=&gt;{if(!params||0===params.length)return"";let content=`&lt;div style="font-weight:bold;margin-bottom:8px;border-bottom:1px solid #555;padding-bottom:5px"&gt;${new Date(params[0].axisValue).toLocaleString()}&lt;/div&gt;`;const timestamp=params[0].axisValue,allSeriesData=[];[airflow,airflowSp,damper,heating,dat,eat,roomTemp].forEach((series2,idx)=&gt;{const seriesNames=["Airflow","Airflow Setpoint","Damper Position","Heating Signal","Discharge Air Temp","Entering Air Temp","Room Temp"];if(series2&amp;&amp;series2.data){const dataPoint=series2.data.find(d=&gt;d[0]===timestamp)||series2.data.reduce((prev,curr)=&gt;Math.abs(curr[0]-timestamp)&lt;Math.abs(prev[0]-timestamp)?curr:prev,series2.data[0]);dataPoint&amp;&amp;allSeriesData.push({seriesName:seriesNames[idx],value:dataPoint[1],color:["#2196F3","#4CAF50","#FF9800","#FFA726","#3F51B5","#009688","#F44336"][idx]})}});return Object.entries({"Flow Control":["Airflow","Airflow Setpoint"],Damper:["Damper Position"],Temperatures:["Room Temp","Discharge Air Temp","Entering Air Temp"],Energy:["Heating Signal"]}).forEach(([category,seriesNames])=&gt;{const categoryItems=allSeriesData.filter(item=&gt;seriesNames.includes(item.seriesName)&amp;&amp;void 0!==item.value);categoryItems.length&gt;0&amp;&amp;(content+=`&lt;div style="margin-top:5px;font-size:10px;color:#aaa;font-weight:bold"&gt;${category}&lt;/div&gt;`,categoryItems.forEach(item=&gt;{const value="number"==typeof item.value?item.value.toFixed(2):item.value,unit=item.seriesName.includes("Temp")?"F":item.seriesName.includes("Airflow")?" CFM":"%",marker=`&lt;span style="display:inline-block;margin-right:5px;border-radius:10px;width:10px;height:10px;background-color:${item.color}"&gt;&lt;/span&gt;`;content+=`&lt;div style="margin-left:10px"&gt;${marker} ${item.seriesName}: &lt;b&gt;${value}${unit}&lt;/b&gt;&lt;/div&gt;`}))}),content}},legend:{type:"scroll",orient:"horizontal",top:95,left:"center",itemGap:15,itemWidth:25,itemHeight:12,textStyle:{fontSize:11},selected:{Airflow:!0,"Airflow Setpoint":!0,"Damper Position":!0,"Heating Signal":!0,"Room Temp":!0,DAT:!0,EAT:!0},data:[{name:"Airflow",icon:"roundRect"},{name:"Airflow Setpoint",icon:"line"},{name:"Damper Position",icon:"roundRect"},{name:"Heating Signal",icon:"rect"},{name:"Room Temp",icon:"circle"},{name:"DAT",icon:"circle"},{name:"EAT",icon:"circle"}]},dataZoom:dataZoomConfig}:{...CHART_DESIGN_TOKENS.animation[animationMode],title:title?{...CHART_DESIGN_TOKENS.title.base,text:title+" - Overlay View",textStyle:{...CHART_DESIGN_TOKENS.title.base.textStyle,color:theme.palette.text.primary}}:void 0,grid:{...CHART_DESIGN_TOKENS.grid.base,left:95,right:55,top:calculateGridTop({hasTitle:!!title,hasToolbox:!0})+50,bottom:80},xAxis:{type:"time"},yAxis:[{type:"value",name:"CFM / F",position:"left",nameGap:45,axisLabel:{fontSize:11,formatter:value=&gt;Math.abs(value)&gt;=1e4?(value/1e3).toFixed(0)+"k":Math.abs(value)&gt;=1e3?(value/1e3).toFixed(1)+"k":value.toFixed(0),rotate:0,margin:8},minInterval:1},{type:"value",name:"%",position:"right",max:100,nameGap:40,axisLabel:{fontSize:11,formatter:value=&gt;value.toFixed(0),rotate:0,margin:8},minInterval:10}],series:validatedSeries.map((s,i)=&gt;({name:s.name,type:"line",data:s.data,smooth:!0,yAxisIndex:s.name.includes("%")||s.name.toLowerCase().includes("damper")||s.name.toLowerCase().includes("heating")?1:0,lineStyle:{width:1.5},emphasis:{disabled:!0}})),legend:{top:110},tooltip:{...CHART_DESIGN_TOKENS.tooltip.base,trigger:"axis",backgroundColor:"dark"===theme.palette.mode?"rgba(50, 50, 50, 0.95)":"rgba(255, 255, 255, 0.95)",borderColor:"dark"===theme.palette.mode?"rgba(255, 255, 255, 0.12)":"rgba(0, 0, 0, 0.12)",textStyle:{...CHART_DESIGN_TOKENS.tooltip.base.textStyle,color:theme.palette.text.primary},formatter:params=&gt;{if(!params||0===params.length)return"";let content=`&lt;div&gt;&lt;strong&gt;${new Date(params[0].axisValue).toLocaleString()}&lt;/strong&gt;&lt;/div&gt;`;return params.forEach(item=&gt;{if(item.data&amp;&amp;void 0!==item.data[1]){const value="number"==typeof item.data[1]?item.data[1].toFixed(2):item.data[1];content+=`&lt;div&gt;${item.marker} ${item.seriesName}: ${value}&lt;/div&gt;`}}),content}},dataZoom:dataZoomConfig})},[validatedSeries,baseOptions,viewMode,title,zoomState,diagnostics]);return reactExports.useEffect(()=&gt;{if(chartRef.current){const instance=chartRef.current.getEchartsInstance();instance.off("datazoom"),instance.on("datazoom",handleDataZoom)}},[handleDataZoom]),loading?jsxRuntimeExports.jsx(Paper,{sx:{p:2,height:height},children:jsxRuntimeExports.jsx(Typography$1,{children:"Loading VAV diagnostic data..."})}):error?jsxRuntimeExports.jsx(Paper,{sx:{p:2,height:height},children:jsxRuntimeExports.jsxs(Alert,{severity:"error",children:["Error loading VAV data: ",error.message]})}):!validatedSeries||validatedSeries.length&lt;7?jsxRuntimeExports.jsx(Paper,{sx:{p:2,height:height},children:jsxRuntimeExports.jsxs(Alert,{severity:"info",children:[jsxRuntimeExports.jsx(Typography$1,{variant:"h6",children:"VAV Comprehensive Diagnostics"}),jsxRuntimeExports.jsx(Typography$1,{variant:"body2",sx:{mt:1},children:"Please select the following 7 points in order:"}),jsxRuntimeExports.jsxs("ol",{children:[jsxRuntimeExports.jsx("li",{children:"Airflow (CFM)"}),jsxRuntimeExports.jsx("li",{children:"Airflow Setpoint (CFM)"}),jsxRuntimeExports.jsx("li",{children:"Damper Position (%)"}),jsxRuntimeExports.jsx("li",{children:"Heating Signal (% or stages)"}),jsxRuntimeExports.jsx("li",{children:"Discharge Air Temperature (F)"}),jsxRuntimeExports.jsx("li",{children:"Entering Air Temperature (F)"}),jsxRuntimeExports.jsx("li",{children:"Room Temperature (F)"})]})]})}):jsxRuntimeExports.jsxs(Paper,{sx:{p:2,height:height,display:"flex",flexDirection:"column"},children:[jsxRuntimeExports.jsxs(Box,{sx:{mb:2,mt:8},children:[" ",jsxRuntimeExports.jsxs(Grid,{container:!0,spacing:2,alignItems:"center",children:[jsxRuntimeExports.jsx(Grid,{item:!0,xs:12,md:4,children:jsxRuntimeExports.jsxs(Box,{display:"flex",alignItems:"center",gap:2,children:[jsxRuntimeExports.jsx(Typography$1,{variant:"h6",children:"Health Score:"}),jsxRuntimeExports.jsx(Chip,{label:`${diagnostics.healthScore.toFixed(0)}%`,sx:{bgcolor:(score=&gt;{const level=HEALTH_SCORE_EXPLANATION.levels.find(l=&gt;score&gt;=l.min);return(null==level?void 0:level.color)||"#f44336"})(diagnostics.healthScore),color:"white",fontWeight:"bold",fontSize:"1rem"},icon:diagnostics.healthScore&gt;=75?jsxRuntimeExports.jsx(CheckCircleIcon,{}):diagnostics.healthScore&gt;=40?jsxRuntimeExports.jsx(WarningIcon,{}):jsxRuntimeExports.jsx(ErrorIcon,{})}),jsxRuntimeExports.jsx(Tooltip,{title:"How is this calculated?",children:jsxRuntimeExports.jsx(IconButton,{size:"small",onClick:()=&gt;setShowHelp(!showHelp),children:jsxRuntimeExports.jsx(HelpIcon,{})})})]})}),jsxRuntimeExports.jsx(Grid,{item:!0,xs:12,md:4,children:jsxRuntimeExports.jsxs(Stack,{direction:"row",spacing:1,justifyContent:"center",children:[jsxRuntimeExports.jsx(Chip,{label:`${(null==(_a=diagnostics.airflowAlarms)?void 0:_a.length)||0} Airflow Issues`,size:"small",color:(null==(_b=diagnostics.airflowAlarms)?void 0:_b.length)?"error":"default"}),jsxRuntimeExports.jsx(Chip,{label:diagnostics.huntingDetected?"Hunting Detected":"Stable Damper",size:"small",color:diagnostics.huntingDetected?"warning":"success"}),jsxRuntimeExports.jsx(Chip,{label:diagnostics.leakingDamper?"Damper Leak":"Damper OK",size:"small",color:diagnostics.leakingDamper?"error":"success"})]})}),jsxRuntimeExports.jsx(Grid,{item:!0,xs:12,md:4,children:jsxRuntimeExports.jsx(Box,{display:"flex",justifyContent:"flex-end",children:jsxRuntimeExports.jsxs(ToggleButtonGroup,{value:viewMode,exclusive:!0,onChange:(_,newMode)=&gt;newMode&amp;&amp;setViewMode(newMode),size:"small",children:[jsxRuntimeExports.jsx(ToggleButton,{value:"panel",children:jsxRuntimeExports.jsx(Tooltip,{title:"4-Panel View",children:jsxRuntimeExports.jsx(PanelIcon,{})})}),jsxRuntimeExports.jsx(ToggleButton,{value:"overlay",children:jsxRuntimeExports.jsx(Tooltip,{title:"Overlay View",children:jsxRuntimeExports.jsx(OverlayIcon,{})})})]})})})]}),jsxRuntimeExports.jsx(Collapse,{in:showHelp,children:jsxRuntimeExports.jsxs(Box,{sx:{mt:2,p:2,bgcolor:alpha(theme.palette.info.main,.1),borderRadius:1},children:[diagnostics.comprehensiveFaults&amp;&amp;diagnostics.comprehensiveFaults.length&gt;0&amp;&amp;jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(Typography$1,{variant:"subtitle2",gutterBottom:!0,color:"error",children:" Active Faults Detected (ASHRAE Guideline 36-2021):"}),jsxRuntimeExports.jsx(Box,{sx:{mb:2},children:diagnostics.comprehensiveFaults.filter(f=&gt;f.detected).map((fault,idx)=&gt;{var _a2,_b2,_c2,_d2;return jsxRuntimeExports.jsxs(Box,{sx:{mb:1,p:1,bgcolor:alpha(theme.palette.error.main,.1),borderRadius:1},children:[jsxRuntimeExports.jsxs(Typography$1,{variant:"caption",fontWeight:"bold",children:[fault.code,": ",fault.name," (",fault.severity,")"]}),jsxRuntimeExports.jsxs(Typography$1,{variant:"caption",display:"block",children:[" Current: ",null==(_a2=fault.currentValue)?void 0:_a2.toFixed(1)," | Threshold: ",null==(_b2=fault.threshold)?void 0:_b2.toFixed(1)]}),jsxRuntimeExports.jsxs(Typography$1,{variant:"caption",display:"block",children:[" Duration: ",(fault.persistenceTime/6e4).toFixed(1)," min (Required: ",(fault.requiredPersistence/6e4).toFixed(0)," min)"]}),(null==(_c2=fault.rootCauses)?void 0:_c2.length)&gt;0&amp;&amp;jsxRuntimeExports.jsxs(Typography$1,{variant:"caption",display:"block",children:[" Likely Causes: ",fault.rootCauses.slice(0,2).join(", ")]}),(null==(_d2=fault.recommendations)?void 0:_d2.length)&gt;0&amp;&amp;fault.recommendations[0]&amp;&amp;jsxRuntimeExports.jsxs(Typography$1,{variant:"caption",display:"block",color:"primary",children:[" Action: ",fault.recommendations[0].action]})]},idx)})}),jsxRuntimeExports.jsx(Divider,{sx:{my:1}})]}),diagnostics.sensorReliability&amp;&amp;diagnostics.sensorReliability.length&gt;0&amp;&amp;jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(Typography$1,{variant:"subtitle2",gutterBottom:!0,children:"Sensor Reliability Analysis:"}),jsxRuntimeExports.jsx(Grid,{container:!0,spacing:1,sx:{mb:2},children:diagnostics.sensorReliability.map((sensor,idx)=&gt;jsxRuntimeExports.jsx(Grid,{item:!0,xs:6,md:3,children:jsxRuntimeExports.jsxs(Box,{sx:{p:.5},children:[jsxRuntimeExports.jsxs(Typography$1,{variant:"caption",fontWeight:"bold",children:[sensor.sensorName,":"]}),jsxRuntimeExports.jsx(LinearProgress,{variant:"determinate",value:sensor.reliability,sx:{height:6,borderRadius:1,bgcolor:alpha(theme.palette.action.disabled,.2),"&amp; .MuiLinearProgress-bar":{bgcolor:sensor.reliability&gt;80?"success.main":sensor.reliability&gt;60?"warning.main":"error.main"}}}),jsxRuntimeExports.jsxs(Typography$1,{variant:"caption",display:"block",children:[sensor.reliability,"% reliable"]}),Object.entries(sensor.issues).filter(([_,v])=&gt;v).map(([issue])=&gt;jsxRuntimeExports.jsxs(Typography$1,{variant:"caption",display:"block",color:"error",children:[" ",issue]},issue))]})},idx))}),jsxRuntimeExports.jsx(Divider,{sx:{my:1}})]}),diagnostics.healthReport&amp;&amp;jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(Typography$1,{variant:"subtitle2",gutterBottom:!0,children:"System Health Report:"}),jsxRuntimeExports.jsxs(Grid,{container:!0,spacing:2,sx:{mb:2},children:[jsxRuntimeExports.jsxs(Grid,{item:!0,xs:12,md:6,children:[jsxRuntimeExports.jsxs(Typography$1,{variant:"caption",display:"block",children:[" Overall Health: ",null==(_c=diagnostics.healthReport.overallHealth)?void 0:_c.toFixed(0),"%"]}),jsxRuntimeExports.jsxs(Typography$1,{variant:"caption",display:"block",children:[" Critical Issues: ",diagnostics.healthReport.criticalIssues||0]}),jsxRuntimeExports.jsxs(Typography$1,{variant:"caption",display:"block",children:[" System Status: ",diagnostics.healthReport.overallHealth&gt;85?"Normal":diagnostics.healthReport.overallHealth&gt;70?"Degraded":"Critical"]})]}),jsxRuntimeExports.jsx(Grid,{item:!0,xs:12,md:6,children:null==(_d=diagnostics.healthReport.topPriorities)?void 0:_d.map((priority,idx)=&gt;jsxRuntimeExports.jsxs(Typography$1,{variant:"caption",display:"block",children:[idx+1,". ",priority]},idx))})]}),jsxRuntimeExports.jsx(Divider,{sx:{my:1}})]}),jsxRuntimeExports.jsx(Typography$1,{variant:"subtitle2",gutterBottom:!0,children:"Health Score Calculation:"}),jsxRuntimeExports.jsxs(Grid,{container:!0,spacing:2,children:[jsxRuntimeExports.jsxs(Grid,{item:!0,xs:12,md:6,children:[jsxRuntimeExports.jsx(Typography$1,{variant:"body2",gutterBottom:!0,children:"Scoring Factors:"}),HEALTH_SCORE_EXPLANATION.factors.map(factor=&gt;jsxRuntimeExports.jsxs(Box,{display:"flex",justifyContent:"space-between",mb:.5,children:[jsxRuntimeExports.jsxs(Typography$1,{variant:"caption",children:[factor.name,":"]}),jsxRuntimeExports.jsxs(Typography$1,{variant:"caption",fontWeight:"bold",children:[factor.weight,"%"]})]},factor.name))]}),jsxRuntimeExports.jsxs(Grid,{item:!0,xs:12,md:6,children:[jsxRuntimeExports.jsx(Typography$1,{variant:"body2",gutterBottom:!0,children:"Score Levels:"}),HEALTH_SCORE_EXPLANATION.levels.map(level=&gt;jsxRuntimeExports.jsxs(Box,{display:"flex",alignItems:"center",gap:1,mb:.5,children:[jsxRuntimeExports.jsx(Box,{sx:{width:20,height:20,bgcolor:level.color,borderRadius:.5}}),jsxRuntimeExports.jsxs(Typography$1,{variant:"caption",children:[level.min,"%+ = ",level.label]})]},level.label))]})]}),jsxRuntimeExports.jsx(Divider,{sx:{my:1}}),jsxRuntimeExports.jsx(Typography$1,{variant:"subtitle2",gutterBottom:!0,children:"View Modes:"}),jsxRuntimeExports.jsxs(Grid,{container:!0,spacing:2,children:[jsxRuntimeExports.jsxs(Grid,{item:!0,xs:12,md:6,children:[jsxRuntimeExports.jsxs(Typography$1,{variant:"body2",fontWeight:"bold",children:[VIEW_MODE_INFO.panel.title,":"]}),VIEW_MODE_INFO.panel.panels.map((panel,idx)=&gt;jsxRuntimeExports.jsxs(Typography$1,{variant:"caption",display:"block",children:[" Panel ",idx+1,": ",panel]},idx))]}),jsxRuntimeExports.jsxs(Grid,{item:!0,xs:12,md:6,children:[jsxRuntimeExports.jsxs(Typography$1,{variant:"body2",fontWeight:"bold",children:[VIEW_MODE_INFO.overlay.title,":"]}),VIEW_MODE_INFO.overlay.features.map((feature,idx)=&gt;jsxRuntimeExports.jsxs(Typography$1,{variant:"caption",display:"block",children:[" ",feature]},idx))]})]})]})}),diagnostics.systemRequests&amp;&amp;jsxRuntimeExports.jsx(Box,{sx:{mt:1},children:jsxRuntimeExports.jsxs(Typography$1,{variant:"caption",color:"text.secondary",children:["System Requests: Heating=",diagnostics.systemRequests.heating," | Cooling=",diagnostics.systemRequests.cooling," | Pressure=",diagnostics.systemRequests.pressure]})})]}),jsxRuntimeExports.jsx(Box,{sx:{flex:1,minHeight:0},children:jsxRuntimeExports.jsx(EChartsReact,{ref:chartRef,option:chartOptions,style:{height:"100%",width:"100%"},onChartReady:onChartReady,notMerge:!1,lazyUpdate:!0})}),diagnostics.recommendations&amp;&amp;diagnostics.recommendations.length&gt;0&amp;&amp;jsxRuntimeExports.jsx(Box,{sx:{mt:2},children:jsxRuntimeExports.jsxs(Alert,{severity:"info",icon:jsxRuntimeExports.jsx(Info,{}),children:[jsxRuntimeExports.jsx(Typography$1,{variant:"subtitle2",children:"Recommendations:"}),diagnostics.recommendations.slice(0,2).map((rec,idx)=&gt;jsxRuntimeExports.jsxs(Typography$1,{variant:"caption",display:"block",children:[" ",rec]},idx))]})})]})},ChilledWaterReset:({series:series=[],selectedPoints:selectedPoints=[],loading:loading=!1,error:error=null,height:height=400,title:title="Chilled Water Plant Reset Optimization",config:config={},onChartReady:onChartReady,showToolbox:showToolbox=!0,enableDataView:enableDataView=!1,showDataZoom:showDataZoom=!0,showLegend:showLegend=!0,onEdit:onEdit,onDelete:onDelete})=&gt;{const theme=useTheme(),baseOptions=useBaseChartOptions(),{data:availablePoints=[]}=usePoints(),[isSetupMode,setIsSetupMode]=reactExports.useState(!series.length&amp;&amp;0===selectedPoints.length),[pointSelections,setPointSelections]=reactExports.useState(new Map),[setupComplete,setSetupComplete]=reactExports.useState(!1),allSelectedPoints=reactExports.useMemo(()=&gt;{const points=[];return pointSelections.forEach(categoryPoints=&gt;{points.push(...categoryPoints)}),points},[pointSelections]),{data:chartData,isLoading:dataLoading,error:dataError}=useChartDataSimple({selectedPoints:allSelectedPoints,enabled:setupComplete&amp;&amp;allSelectedPoints.length&gt;0,timeRange:"24h"}),[plantConfig,setPlantConfig]=reactExports.useState({minSetpoint:config.minSetpoint||42,maxSetpoint:config.maxSetpoint||48,targetValvePosition:config.targetValvePosition||85,responseTime:config.responseTime||5,unit:config.unit||"F"}),processedData=reactExports.useMemo(()=&gt;{const dataSource=setupComplete&amp;&amp;(null==chartData?void 0:chartData.series)?chartData.series:series;if(!dataSource.length&amp;&amp;!setupComplete)return null;let valveSeries=[];if(setupComplete&amp;&amp;pointSelections.size&gt;0){const valvePoints=pointSelections.get("valve_positions")||[];valveSeries=dataSource.filter(s=&gt;valvePoints.some(p=&gt;p.id===s.pointId||p.name===s.name||p.id===s.name))}else valveSeries=dataSource.filter(s=&gt;{var _a,_b;return(null==(_a=s.name)?void 0:_a.toLowerCase().includes("valve"))||(null==(_b=s.name)?void 0:_b.toLowerCase().includes("vlv"))});const valveCount=valveSeries.length;let displayMode;displayMode=valveCount&lt;=10?"individual":valveCount&lt;=50?"grouped":"statistical";const allTimestamps=new Set;valveSeries.forEach(s=&gt;{var _a;null==(_a=s.data)||_a.forEach(d=&gt;allTimestamps.add(d[0]))});const timestamps=Array.from(allTimestamps).sort(),recommendations=timestamps.map(ts=&gt;{const stats=(timestamp=&gt;{const valuesAtTime=valveSeries.map(s=&gt;{var _a,_b;return null==(_b=null==(_a=s.data)?void 0:_a.find(d=&gt;Math.abs(d[0]-timestamp)&lt;6e4))?void 0:_b[1]}).filter(v=&gt;void 0!==v);return valuesAtTime.length?{min:Math.min(...valuesAtTime),max:Math.max(...valuesAtTime),avg:valuesAtTime.reduce((a,b)=&gt;a+b,0)/valuesAtTime.length,median:valuesAtTime.sort((a,b)=&gt;a-b)[Math.floor(valuesAtTime.length/2)],p95:valuesAtTime.sort((a,b)=&gt;a-b)[Math.floor(.95*valuesAtTime.length)],valvesAbove90:valuesAtTime.filter(v=&gt;v&gt;90).length,valvesAbove95:valuesAtTime.filter(v=&gt;v&gt;95).length}:null})(ts);if(!stats)return null;let resetRequest=0,message="";return stats.valvesAbove95&gt;=1?(resetRequest=-1,message=`${stats.valvesAbove95} valve(s) &gt; 95% - Decrease CHW setpoint`):stats.max&lt;plantConfig.targetValvePosition?(resetRequest=1,message=`Max valve ${stats.max.toFixed(0)}% - Increase CHW setpoint`):message="System in optimal range",{timestamp:ts,stats:stats,resetRequest:resetRequest,message:message}}).filter(r=&gt;null!==r);return{displayMode:displayMode,valveCount:valveCount,valveSeries:valveSeries,recommendations:recommendations,timestamps:timestamps}},[series,null==chartData?void 0:chartData.series,plantConfig,setupComplete,pointSelections]),chartOptions=reactExports.useMemo(()=&gt;{if(!processedData)return mergeChartOptions(baseOptions,{title:title?{...CHART_DESIGN_TOKENS.title.base,text:"No Data Available",textStyle:{...CHART_DESIGN_TOKENS.title.base.textStyle,color:theme.palette.text.primary}}:void 0,series:[]});const totalPoints=processedData.valveSeries.reduce((sum,s)=&gt;{var _a;return sum+((null==(_a=s.data)?void 0:_a.length)||0)},0),animationMode=CHART_DESIGN_TOKENS.adaptive.animationMode(totalPoints),{displayMode:displayMode,valveSeries:valveSeries,recommendations:recommendations}=processedData,chartSeries=[];if("individual"===displayMode)valveSeries.forEach((s,idx)=&gt;{chartSeries.push({name:s.name,type:"line",data:s.data,smooth:!0,symbol:"none",lineStyle:{width:2},emphasis:{focus:"series"}})});else if("grouped"===displayMode){const stats=["avg","p95","max"],colors=[getStatColor("average"),getStatColor("p95"),getStatColor("maximum")];stats.forEach((stat,idx)=&gt;{chartSeries.push({name:`Valve ${stat.toUpperCase()}`,type:"line",data:recommendations.map(r=&gt;[r.timestamp,r.stats[stat]]),smooth:!0,symbol:"none",lineStyle:{width:"avg"===stat?3:2},color:colors[idx],emphasis:{focus:"series"}})})}else chartSeries.push({name:"Valve Distribution",type:"custom",renderItem:(params,api)=&gt;{const point=api.coord([api.value(0),api.value(1)]),size=api.size([1,1]);return{type:"group",children:[{type:"rect",shape:{x:point[0]-size[0]/2,y:api.coord([0,api.value(2)])[1],width:size[0],height:api.coord([0,api.value(1)])[1]-api.coord([0,api.value(2)])[1]},style:{fill:"dark"===theme.palette.mode?"rgba(33, 150, 243, 0.4)":"rgba(33, 150, 243, 0.3)",stroke:getStatColor("average")}},{type:"line",shape:{x1:point[0]-size[0]/2,y1:api.coord([0,api.value(3)])[1],x2:point[0]+size[0]/2,y2:api.coord([0,api.value(3)])[1]},style:{stroke:theme.palette.error.main,lineWidth:2}}]}},data:recommendations.map(r=&gt;[r.timestamp,r.stats.p95,r.stats.min,r.stats.median]),z:1});chartSeries.push({name:"Target Position",type:"line",data:recommendations.map(r=&gt;[r.timestamp,plantConfig.targetValvePosition]),lineStyle:{type:"dashed",color:theme.palette.success.main,width:2},symbol:"none",silent:!0});const resetMarkers=recommendations.filter(r=&gt;0!==r.resetRequest).map(r=&gt;({coord:[r.timestamp,100],value:r.message,itemStyle:{color:r.resetRequest&gt;0?getHVACModeColor("integrated"):theme.palette.error.main}}));return resetMarkers.length&gt;0&amp;&amp;(chartSeries[0].markPoint={data:resetMarkers,symbol:"arrow",symbolSize:20,symbolRotate:value=&gt;value.data.resetRequest&gt;0?180:0}),mergeChartOptions(baseOptions,{...CHART_DESIGN_TOKENS.animation[animationMode],title:title?{...CHART_DESIGN_TOKENS.title.base,text:title,subtext:`${processedData.valveCount} valves monitored - ${displayMode} view`,textStyle:{...CHART_DESIGN_TOKENS.title.base.textStyle,color:theme.palette.text.primary}}:void 0,tooltip:{...CHART_DESIGN_TOKENS.tooltip.base,trigger:"axis",axisPointer:{type:"cross"},backgroundColor:"dark"===theme.palette.mode?"rgba(50, 50, 50, 0.95)":"rgba(255, 255, 255, 0.95)",borderColor:"dark"===theme.palette.mode?"rgba(255, 255, 255, 0.12)":"rgba(0, 0, 0, 0.12)",textStyle:{...CHART_DESIGN_TOKENS.tooltip.base.textStyle,color:theme.palette.text.primary},formatter:params=&gt;{let html=`&lt;strong&gt;${new Date(params[0].value[0]).toLocaleString()}&lt;/strong&gt;&lt;br/&gt;`;params.forEach(p=&gt;{var _a;html+=`${p.marker} ${p.seriesName}: ${null==(_a=p.value[1])?void 0:_a.toFixed(1)}%&lt;br/&gt;`});const rec=recommendations.find(r=&gt;Math.abs(r.timestamp-params[0].value[0])&lt;6e4);return rec&amp;&amp;(html+=`&lt;br/&gt;&lt;strong&gt;Recommendation:&lt;/strong&gt; ${rec.message}`),html}},xAxis:{type:"time",boundaryGap:!1},yAxis:{type:"value",name:"Valve Position (%)",min:0,max:100,axisLabel:{formatter:"{value}%"}},series:chartSeries,grid:{...CHART_DESIGN_TOKENS.grid.base,left:"3%",right:"4%",bottom:showDataZoom?"15%":"3%",top:calculateGridTop({hasTitle:!!title,hasToolbox:!0}),containLabel:!0},dataZoom:showDataZoom?[{type:"inside",start:0,end:100},{type:"slider",start:0,end:100}]:void 0,toolbox:showToolbox?{feature:{dataView:{show:enableDataView},restore:{show:!0},saveAsImage:{show:!0},dataZoom:{show:showDataZoom},magicType:{show:!0,type:["line","bar"]}}}:void 0,legend:showLegend?{data:chartSeries.map(s=&gt;s.name),bottom:0}:void 0},{showToolbox:showToolbox,enableDataView:enableDataView,showDataZoom:showDataZoom,showLegend:showLegend})},[processedData,plantConfig,baseOptions,title,showToolbox,enableDataView,showDataZoom,showLegend,onEdit,onDelete]),handlePointSelectionChange=(categoryId,points)=&gt;{setPointSelections(prev=&gt;{const updated=new Map(prev);return updated.set(categoryId,points),updated})},handleSetupComplete=()=&gt;{var _a,_b,_c;setSetupComplete(!0),setIsSetupMode(!1),console.log("CHW Reset setup complete. Selected points:",{totalPoints:allSelectedPoints.length,valvePoints:(null==(_a=pointSelections.get("valve_positions"))?void 0:_a.length)||0,supplyTemp:(null==(_b=pointSelections.get("supply_temp"))?void 0:_b.length)||0,returnTemp:(null==(_c=pointSelections.get("return_temp"))?void 0:_c.length)||0})};return isSetupMode?jsxRuntimeExports.jsxs(Paper,{sx:{p:3,height:height,overflow:"auto"},children:[jsxRuntimeExports.jsx(GuidedPointSelection,{categories:CHW_RESET_CATEGORIES,availablePoints:availablePoints,selectedPoints:pointSelections,onSelectionChange:handlePointSelectionChange,onComplete:handleSetupComplete,title:"Chilled Water Plant Reset Setup",description:"Select points for chilled water reset optimization analysis. The system will monitor valve positions and recommend temperature setpoint adjustments based on ASHRAE Guideline 36 Trim &amp; Respond logic."}),pointSelections.size&gt;0&amp;&amp;jsxRuntimeExports.jsxs(Box,{sx:{mt:4,pt:3,borderTop:1,borderColor:"divider"},children:[jsxRuntimeExports.jsx(Typography$1,{variant:"h6",gutterBottom:!0,children:"Reset Parameters"}),jsxRuntimeExports.jsxs(Grid,{container:!0,spacing:2,children:[jsxRuntimeExports.jsx(Grid,{item:!0,xs:6,children:jsxRuntimeExports.jsx(TextField,{label:"Min Setpoint (F)",type:"number",value:plantConfig.minSetpoint,onChange:e2=&gt;setPlantConfig(prev=&gt;({...prev,minSetpoint:Number(e2.target.value)})),fullWidth:!0,size:"small"})}),jsxRuntimeExports.jsx(Grid,{item:!0,xs:6,children:jsxRuntimeExports.jsx(TextField,{label:"Max Setpoint (F)",type:"number",value:plantConfig.maxSetpoint,onChange:e2=&gt;setPlantConfig(prev=&gt;({...prev,maxSetpoint:Number(e2.target.value)})),fullWidth:!0,size:"small"})}),jsxRuntimeExports.jsx(Grid,{item:!0,xs:6,children:jsxRuntimeExports.jsx(TextField,{label:"Target Valve Position (%)",type:"number",value:plantConfig.targetValvePosition,onChange:e2=&gt;setPlantConfig(prev=&gt;({...prev,targetValvePosition:Number(e2.target.value)})),fullWidth:!0,size:"small"})}),jsxRuntimeExports.jsx(Grid,{item:!0,xs:6,children:jsxRuntimeExports.jsx(TextField,{label:"Response Time (min)",type:"number",value:plantConfig.responseTime,onChange:e2=&gt;setPlantConfig(prev=&gt;({...prev,responseTime:Number(e2.target.value)})),fullWidth:!0,size:"small"})})]})]})]}):loading||setupComplete&amp;&amp;dataLoading?jsxRuntimeExports.jsxs(Box,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:height},children:[jsxRuntimeExports.jsx(CircularProgress,{}),setupComplete&amp;&amp;dataLoading&amp;&amp;jsxRuntimeExports.jsxs(Typography$1,{variant:"body2",sx:{ml:2},children:["Fetching data for ",allSelectedPoints.length," selected points..."]})]}):error||setupComplete&amp;&amp;dataError?jsxRuntimeExports.jsx(Alert,{severity:"error",sx:{height:height},children:(null==error?void 0:error.message)||(null==dataError?void 0:dataError.message)}):jsxRuntimeExports.jsxs(Box,{sx:{height:height,position:"relative"},children:[processedData&amp;&amp;jsxRuntimeExports.jsx(Box,{sx:{position:"absolute",top:8,right:8,zIndex:1e3},children:jsxRuntimeExports.jsxs(Stack,{direction:"row",spacing:1,children:[jsxRuntimeExports.jsx(Chip,{label:`${processedData.valveCount} Valves`,size:"small",color:"primary"}),jsxRuntimeExports.jsx(Chip,{label:processedData.displayMode.toUpperCase(),size:"small",variant:"outlined"}),processedData.recommendations.filter(r=&gt;0!==r.resetRequest).length&gt;0&amp;&amp;jsxRuntimeExports.jsx(Chip,{label:"Reset Needed",size:"small",color:"warning",icon:jsxRuntimeExports.jsx(WarningIcon,{})}),jsxRuntimeExports.jsx(IconButton,{size:"small",onClick:()=&gt;{setIsSetupMode(!0),setSetupComplete(!1)},title:"Configure Points",sx:{ml:1},children:jsxRuntimeExports.jsx(SettingsIcon,{})})]})}),!processedData&amp;&amp;!loading&amp;&amp;jsxRuntimeExports.jsxs(Box,{sx:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",textAlign:"center"},children:[jsxRuntimeExports.jsx(Typography$1,{variant:"h6",gutterBottom:!0,children:"Configure CHW Reset Analysis"}),jsxRuntimeExports.jsx(Typography$1,{variant:"body2",color:"text.secondary",paragraph:!0,children:"Select points to start monitoring valve positions and optimizing plant temperature setpoints"}),jsxRuntimeExports.jsx(Button,{variant:"contained",onClick:()=&gt;setIsSetupMode(!0),startIcon:jsxRuntimeExports.jsx(SettingsIcon,{}),children:"Setup Chart"})]}),jsxRuntimeExports.jsx(EChartsReact,{option:chartOptions,style:{height:"100%",width:"100%"},onChartReady:onChartReady,theme:theme.palette.mode})]})},DPOptimization:({series:series=[],selectedPoints:selectedPoints=[],loading:loading=!1,error:error=null,height:height=400,title:title="Duct Static Pressure Optimization",config:config={},onChartReady:onChartReady,showToolbox:showToolbox=!0,enableDataView:enableDataView=!1,showDataZoom:showDataZoom=!0,showLegend:showLegend=!0,onEdit:onEdit,onDelete:onDelete})=&gt;{const theme=useTheme(),baseOptions=useBaseChartOptions(),{data:availablePoints=[]}=usePoints(),[setupMode,setSetupMode]=reactExports.useState(!series.length),[setupComplete,setSetupComplete]=reactExports.useState(!1),[pointSelections,setPointSelections]=reactExports.useState(new Map),[pressureConfig,setPressureConfig]=reactExports.useState({minPressure:config.minPressure||.5,maxPressure:config.maxPressure||2,targetDamperPosition:config.targetDamperPosition||85,resetRate:config.resetRate||.05,unit:config.unit||"inWC"}),allSelectedPoints=reactExports.useMemo(()=&gt;{const points=[];return pointSelections.forEach(categoryPoints=&gt;{points.push(...categoryPoints)}),points},[pointSelections]),{data:chartData,isLoading:dataLoading,error:dataError}=useChartDataSimple({selectedPoints:allSelectedPoints,enabled:setupComplete&amp;&amp;allSelectedPoints.length&gt;0,timeRange:"24h"}),extractSeries=reactExports.useCallback((dataSource,damperPoints,pressurePoints,setupComplete2)=&gt;{let damperSeries=[],pressureSeries=null;return setupComplete2&amp;&amp;damperPoints.length&gt;0?(damperSeries=dataSource.filter(s=&gt;damperPoints.some(p=&gt;p.id===s.id||p.name===s.name||p.id===s.name)),pressurePoints.length&gt;0&amp;&amp;(pressureSeries=dataSource.find(s=&gt;pressurePoints.some(p=&gt;p.id===s.id||p.name===s.name||p.id===s.name)))):(damperSeries=dataSource.filter(s=&gt;{var _a,_b;return(null==(_a=s.name)?void 0:_a.toLowerCase().includes("damper"))||(null==(_b=s.name)?void 0:_b.toLowerCase().includes("dpr"))}),pressureSeries=dataSource.find(s=&gt;{var _a,_b,_c;return(null==(_a=s.name)?void 0:_a.toLowerCase().includes("static"))||(null==(_b=s.name)?void 0:_b.toLowerCase().includes("pressure"))||(null==(_c=s.name)?void 0:_c.toLowerCase().includes("sp"))})),{damperSeries:damperSeries,pressureSeries:pressureSeries}},[]),calculateOptimizationMetrics=reactExports.useCallback((timestamp,damperSeries,pressureSeries,pressureConfig2)=&gt;{var _a,_b;const damperValues=damperSeries.map(s=&gt;{var _a2,_b2;return null==(_b2=null==(_a2=s.data)?void 0:_a2.find(d=&gt;Math.abs(d[0]-timestamp)&lt;6e4))?void 0:_b2[1]}).filter(v=&gt;void 0!==v);if(!damperValues.length)return null;const pressureValue=null==(_b=null==(_a=null==pressureSeries?void 0:pressureSeries.data)?void 0:_a.find(d=&gt;Math.abs(d[0]-timestamp)&lt;6e4))?void 0:_b[1],maxDamper=Math.max(...damperValues),avgDamper=damperValues.reduce((a,b)=&gt;a+b,0)/damperValues.length,dampersAbove90=damperValues.filter(v=&gt;v&gt;90).length,dampersAbove95=damperValues.filter(v=&gt;v&gt;95).length;let resetRequest=0,message="";return dampersAbove90&gt;=1?(resetRequest=-1,message=`${dampersAbove90} damper(s) &gt; 90% - Decrease SP`):maxDamper&lt;pressureConfig2.targetDamperPosition?(resetRequest=1,message=`Max damper ${maxDamper.toFixed(0)}% &lt; ${pressureConfig2.targetDamperPosition}% - Increase SP`):message="System optimized",{timestamp:timestamp,maxDamper:maxDamper,avgDamper:avgDamper,dampersAbove90:dampersAbove90,dampersAbove95:dampersAbove95,pressure:pressureValue,resetRequest:resetRequest,message:message}},[]),processedData=reactExports.useMemo(()=&gt;{const dataSource=setupComplete&amp;&amp;(null==chartData?void 0:chartData.series)?chartData.series:series;if(!dataSource.length)return null;const damperPoints=pointSelections.get("dampers")||[],pressurePoints=pointSelections.get("pressure")||[],{damperSeries:damperSeries,pressureSeries:pressureSeries}=extractSeries(dataSource,damperPoints,pressurePoints,setupComplete),damperCount=damperSeries.length,vizMode=(damperCount=&gt;damperCount&lt;=10?"individual":damperCount&lt;=50?"grouped":"heatmap")(damperCount),timestamps=((damperSeries,pressureSeries)=&gt;{const allTimestamps=new Set;return[...damperSeries,pressureSeries].filter(Boolean).forEach(s=&gt;{var _a;null==(_a=s.data)||_a.forEach(d=&gt;allTimestamps.add(d[0]))}),Array.from(allTimestamps).sort()})(damperSeries,pressureSeries),metrics=timestamps.map(ts=&gt;{const baseMetrics=calculateOptimizationMetrics(ts,damperSeries,pressureSeries,pressureConfig);if(!baseMetrics)return null;const optimalPressure=(maxDamper=baseMetrics.maxDamper,(pressureConfig2=pressureConfig).minPressure+(pressureConfig2.maxPressure-pressureConfig2.minPressure)*(maxDamper/100));var maxDamper,pressureConfig2;const energySavings=((pressureValue,optimalPressure)=&gt;pressureValue?Math.max(0,(pressureValue-optimalPressure)/pressureValue*100):0)(baseMetrics.pressure,optimalPressure);return{...baseMetrics,optimalPressure:optimalPressure,energySavings:energySavings}}).filter(m=&gt;null!==m);return{vizMode:vizMode,damperCount:damperCount,damperSeries:damperSeries,pressureSeries:pressureSeries,metrics:metrics,timestamps:timestamps}},[series,null==chartData?void 0:chartData.series,pressureConfig,setupComplete,pointSelections,extractSeries,calculateOptimizationMetrics]),chartOptions=reactExports.useMemo(()=&gt;{const isDarkMode="dark"===theme.palette.mode;if(!processedData)return mergeChartOptions(baseOptions,{title:{text:"No Data Available"},series:[]});const{vizMode:vizMode,damperSeries:damperSeries,pressureSeries:pressureSeries,metrics:metrics}=processedData,totalPoints=damperSeries.reduce((sum,s)=&gt;{var _a;return sum+((null==(_a=s.data)?void 0:_a.length)||0)},0),animationMode=CHART_DESIGN_TOKENS.adaptive.animationMode(totalPoints),chartSeries=[];return"individual"===vizMode?damperSeries.forEach(s=&gt;{chartSeries.push({name:s.name,type:"line",data:s.data,yAxisIndex:0,smooth:!0,symbol:"none",lineStyle:{width:1,opacity:.8},emphasis:{focus:"series"}})}):"grouped"===vizMode?chartSeries.push({name:"Max Damper",type:"line",data:metrics.map(m=&gt;[m.timestamp,m.maxDamper]),yAxisIndex:0,smooth:!0,lineStyle:{width:3},color:"#f44336"},{name:"Avg Damper",type:"line",data:metrics.map(m=&gt;[m.timestamp,m.avgDamper]),yAxisIndex:0,smooth:!0,lineStyle:{width:2},color:"#2196f3"}):chartSeries.push({name:"Damper Heatmap",type:"heatmap",data:damperSeries.flatMap((s,idx)=&gt;{var _a;return(null==(_a=s.data)?void 0:_a.map(d=&gt;[d[0],idx,d[1]]))||[]}),yAxisIndex:0,label:{show:!1},emphasis:{itemStyle:{shadowBlur:10}}}),pressureSeries&amp;&amp;(chartSeries.push({name:"Static Pressure",type:"line",data:pressureSeries.data,yAxisIndex:1,smooth:!0,lineStyle:{width:2,type:"solid"},color:"#4caf50",areaStyle:{opacity:.1}}),chartSeries.push({name:"Optimal Pressure",type:"line",data:metrics.map(m=&gt;[m.timestamp,m.optimalPressure]),yAxisIndex:1,lineStyle:{width:2,type:"dashed"},color:"#ff9800",symbol:"none"})),metrics.some(m=&gt;m.energySavings&gt;0)&amp;&amp;chartSeries.push({name:"Energy Savings %",type:"bar",data:metrics.map(m=&gt;[m.timestamp,m.energySavings]),yAxisIndex:2,barWidth:"20%",itemStyle:{color:"#8bc34a",opacity:.5},z:-1}),mergeChartOptions(baseOptions,{...CHART_DESIGN_TOKENS.animation[animationMode],title:title?{...CHART_DESIGN_TOKENS.title.base,text:title,subtext:`${processedData.damperCount} dampers - ${vizMode} view`,textStyle:{...CHART_DESIGN_TOKENS.title.base.textStyle,color:theme.palette.text.primary}}:void 0,tooltip:{...CHART_DESIGN_TOKENS.tooltip.base,backgroundColor:isDarkMode?"rgba(50, 50, 50, 0.95)":"rgba(255, 255, 255, 0.95)",borderColor:isDarkMode?"rgba(255, 255, 255, 0.12)":"rgba(0, 0, 0, 0.12)",textStyle:{...CHART_DESIGN_TOKENS.tooltip.base.textStyle,color:theme.palette.text.primary},trigger:"axis",axisPointer:{type:"cross"},formatter:params=&gt;{let html=`&lt;strong&gt;${new Date(params[0].value[0]).toLocaleString()}&lt;/strong&gt;&lt;br/&gt;`;params.forEach(p=&gt;{const value=p.value[1],unit=p.seriesIndex===chartSeries.findIndex(s=&gt;"Static Pressure"===s.name)?pressureConfig.unit:(p.seriesName.includes("Savings"),"%");html+=`${p.marker} ${p.seriesName}: ${null==value?void 0:value.toFixed(2)} ${unit}&lt;br/&gt;`});const metric=metrics.find(m=&gt;Math.abs(m.timestamp-params[0].value[0])&lt;6e4);return metric&amp;&amp;(html+=`&lt;br/&gt;&lt;strong&gt;Status:&lt;/strong&gt; ${metric.message}`,metric.energySavings&gt;0&amp;&amp;(html+=`&lt;br/&gt;&lt;strong&gt;Potential Savings:&lt;/strong&gt; ${metric.energySavings.toFixed(1)}%`)),html}},grid:[{...CHART_DESIGN_TOKENS.grid.base,left:"3%",right:"3%",bottom:showDataZoom?"15%":"3%",top:calculateGridTop({hasTitle:!!title,hasToolbox:!0}),height:"heatmap"===vizMode?"70%":"65%",containLabel:!0}],xAxis:{type:"time",boundaryGap:!1},yAxis:[{type:"value",name:"Damper Position (%)",position:"left",min:0,max:100,axisLabel:{formatter:"{value}%"}},{type:"value",name:`Pressure (${pressureConfig.unit})`,position:"right",min:0,max:1.2*pressureConfig.maxPressure,axisLabel:{formatter:"{value}"}},{type:"value",name:"Savings (%)",position:"right",offset:60,min:0,max:100,axisLabel:{formatter:"{value}%"},show:metrics.some(m=&gt;m.energySavings&gt;0)}],visualMap:"heatmap"===vizMode?{min:0,max:100,calculable:!0,orient:"vertical",right:"10",top:"center",inRange:{color:["#2196f3","#ffeb3b","#f44336"]}}:void 0,series:chartSeries,dataZoom:showDataZoom?[{type:"inside",start:0,end:100},{type:"slider",start:0,end:100}]:void 0,toolbox:showToolbox?{feature:{dataView:{show:enableDataView},restore:{show:!0},saveAsImage:{show:!0},dataZoom:{show:showDataZoom},magicType:{show:!0,type:["line","bar","stack"]}}}:void 0,legend:showLegend?{data:chartSeries.map(s=&gt;s.name),bottom:0,selected:"individual"===vizMode?Object.fromEntries(chartSeries.map((s,i)=&gt;[s.name,i&lt;5])):void 0}:void 0},{showToolbox:showToolbox,enableDataView:enableDataView,showDataZoom:showDataZoom,showLegend:showLegend})},[processedData,pressureConfig,baseOptions,title,showToolbox,enableDataView,showDataZoom,showLegend,onEdit,onDelete]),handlePointSelectionChange=(categoryId,points)=&gt;{setPointSelections(prev=&gt;new Map(prev).set(categoryId,points))},handleSetupComplete=()=&gt;{var _a,_b,_c;setSetupMode(!1),setSetupComplete(!0),console.log("DP Optimization setup complete. Selected points:",{totalPoints:allSelectedPoints.length,damperPoints:(null==(_a=pointSelections.get("dampers"))?void 0:_a.length)||0,pressurePoints:(null==(_b=pointSelections.get("pressure"))?void 0:_b.length)||0,airflowPoints:(null==(_c=pointSelections.get("airflow"))?void 0:_c.length)||0})},handleSetupBack=()=&gt;{setSetupMode(!0)};return setupMode?jsxRuntimeExports.jsxs(Paper,{sx:{p:3,height:height,overflow:"auto"},children:[jsxRuntimeExports.jsx(GuidedPointSelection,{title:"Static Pressure Optimization Setup",description:"Select points to monitor for duct static pressure optimization",categories:DP_OPTIMIZATION_CATEGORIES,availablePoints:availablePoints,selectedPoints:pointSelections,onSelectionChange:handlePointSelectionChange,onComplete:handleSetupComplete}),Array.from(pointSelections.values()).some(pts=&gt;pts.length&gt;0)&amp;&amp;jsxRuntimeExports.jsxs(Box,{sx:{mt:3},children:[jsxRuntimeExports.jsx(Typography$1,{variant:"h6",gutterBottom:!0,children:"Pressure Configuration"}),jsxRuntimeExports.jsxs(Grid,{container:!0,spacing:2,children:[jsxRuntimeExports.jsxs(Grid,{item:!0,xs:12,children:[jsxRuntimeExports.jsxs(Typography$1,{gutterBottom:!0,children:["Pressure Range (",pressureConfig.unit,")"]}),jsxRuntimeExports.jsx(Slider,{value:[pressureConfig.minPressure,pressureConfig.maxPressure],onChange:(e2,value)=&gt;{const[min,max]=value;setPressureConfig(prev=&gt;({...prev,minPressure:min,maxPressure:max}))},valueLabelDisplay:"auto",min:0,max:5,step:.1,marks:!0})]}),jsxRuntimeExports.jsx(Grid,{item:!0,xs:6,children:jsxRuntimeExports.jsx(TextField,{label:"Target Damper Position (%)",type:"number",value:pressureConfig.targetDamperPosition,onChange:e2=&gt;setPressureConfig(prev=&gt;({...prev,targetDamperPosition:Number(e2.target.value)})),fullWidth:!0})}),jsxRuntimeExports.jsx(Grid,{item:!0,xs:6,children:jsxRuntimeExports.jsx(TextField,{label:"Reset Rate (inWC/min)",type:"number",value:pressureConfig.resetRate,onChange:e2=&gt;setPressureConfig(prev=&gt;({...prev,resetRate:Number(e2.target.value)})),fullWidth:!0})})]})]})]}):loading||setupComplete&amp;&amp;dataLoading?jsxRuntimeExports.jsxs(Box,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:height},children:[jsxRuntimeExports.jsx(CircularProgress,{}),setupComplete&amp;&amp;dataLoading&amp;&amp;jsxRuntimeExports.jsxs(Typography$1,{variant:"body2",sx:{ml:2},children:["Fetching data for ",allSelectedPoints.length," selected points..."]})]}):error||setupComplete&amp;&amp;dataError?jsxRuntimeExports.jsx(Alert,{severity:"error",sx:{height:height},children:(null==error?void 0:error.message)||(null==dataError?void 0:dataError.message)}):jsxRuntimeExports.jsxs(Box,{sx:{height:height,position:"relative"},children:[jsxRuntimeExports.jsx(Box,{sx:{position:"absolute",top:8,right:8,zIndex:1e3},children:jsxRuntimeExports.jsxs(Stack,{direction:"row",spacing:1,alignItems:"center",children:[processedData&amp;&amp;jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(Chip,{label:`${processedData.damperCount} Dampers`,size:"small",color:"primary"}),jsxRuntimeExports.jsx(Chip,{label:processedData.vizMode.toUpperCase(),size:"small",variant:"outlined"}),processedData.metrics.some(m=&gt;m.energySavings&gt;5)&amp;&amp;jsxRuntimeExports.jsx(Chip,{label:"Savings Available",size:"small",color:"success",icon:jsxRuntimeExports.jsx(TrendingDownIcon,{})})]}),jsxRuntimeExports.jsx(IconButton,{size:"small",onClick:handleSetupBack,children:jsxRuntimeExports.jsx(SettingsIcon,{})})]})}),processedData&amp;&amp;processedData.damperCount&gt;0?jsxRuntimeExports.jsx(EChartsReact,{option:chartOptions,style:{height:"100%",width:"100%"},onChartReady:onChartReady,theme:theme.palette.mode}):jsxRuntimeExports.jsxs(Box,{sx:{display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",height:"100%",gap:2},children:[jsxRuntimeExports.jsx(Typography$1,{variant:"h6",color:"text.secondary",children:"No valid data for DP Optimization"}),jsxRuntimeExports.jsx(Button,{variant:"contained",startIcon:jsxRuntimeExports.jsx(SettingsIcon,{}),onClick:handleSetupBack,children:"Configure Points"})]})]})},SimultaneousHC:({series:series=[],selectedPoints:selectedPoints=[],loading:loading=!1,error:error=null,height:height=400,title:title="Simultaneous Heating/Cooling Detection",config:config={},onChartReady:onChartReady,showToolbox:showToolbox=!0,enableDataView:enableDataView=!1,showDataZoom:showDataZoom=!0,showLegend:showLegend=!0,onEdit:onEdit,onDelete:onDelete})=&gt;{const theme=useTheme(),baseOptions=useBaseChartOptions(),{data:availablePoints=[]}=usePoints(),[setupMode,setSetupMode]=reactExports.useState(!series.length),[setupComplete,setSetupComplete]=reactExports.useState(!1),[pointSelections,setPointSelections]=reactExports.useState(new Map),[showCalculationInfo,setShowCalculationInfo]=reactExports.useState(!1),[detectionConfig,setDetectionConfig]=reactExports.useState({wasteThreshold:config.wasteThreshold||5,overlapDuration:config.overlapDuration||15,energyUnit:config.energyUnit||"kW",temperatureUnit:config.temperatureUnit||"F",heatingThreshold:config.heatingThreshold||10,coolingThreshold:config.coolingThreshold||10}),allSelectedPoints=reactExports.useMemo(()=&gt;{const points=[];return pointSelections.forEach(categoryPoints=&gt;{points.push(...categoryPoints)}),points},[pointSelections]),{data:chartData,isLoading:dataLoading,error:dataError}=useChartDataSimple({selectedPoints:allSelectedPoints,enabled:setupComplete&amp;&amp;allSelectedPoints.length&gt;0,timeRange:"24h"}),processedData=reactExports.useMemo(()=&gt;{const dataSource=setupComplete&amp;&amp;(null==chartData?void 0:chartData.series)?chartData.series:series;if(!dataSource.length)return null;const ahuHeatingPoints=pointSelections.get("ahuHeating")||[],ahuCoolingPoints=pointSelections.get("ahuCooling")||[],zoneReheatPoints=pointSelections.get("zoneReheat")||[],supplyTempPoints=pointSelections.get("supplyTemp")||[];let heatingSeries=[],coolingSeries=[],tempSeries=[];setupComplete&amp;&amp;(ahuHeatingPoints.length&gt;0||zoneReheatPoints.length&gt;0)?(heatingSeries=dataSource.filter(s=&gt;[...ahuHeatingPoints,...zoneReheatPoints].some(p=&gt;p.id===s.id||p.name===s.name||p.id===s.name)),coolingSeries=dataSource.filter(s=&gt;ahuCoolingPoints.some(p=&gt;p.id===s.id||p.name===s.name||p.id===s.name)),tempSeries=dataSource.filter(s=&gt;supplyTempPoints.some(p=&gt;p.id===s.id||p.name===s.name||p.id===s.name))):(heatingSeries=dataSource.filter(s=&gt;{var _a,_b,_c;return(null==(_a=s.name)?void 0:_a.toLowerCase().includes("heat"))||(null==(_b=s.name)?void 0:_b.toLowerCase().includes("htg"))||(null==(_c=s.name)?void 0:_c.toLowerCase().includes("reheat"))}),coolingSeries=dataSource.filter(s=&gt;{var _a,_b,_c;return(null==(_a=s.name)?void 0:_a.toLowerCase().includes("cool"))||(null==(_b=s.name)?void 0:_b.toLowerCase().includes("clg"))||(null==(_c=s.name)?void 0:_c.toLowerCase().includes("chw"))}),tempSeries=dataSource.filter(s=&gt;{var _a,_b,_c;return(null==(_a=s.name)?void 0:_a.toLowerCase().includes("temp"))||(null==(_b=s.name)?void 0:_b.toLowerCase().includes("sat"))||(null==(_c=s.name)?void 0:_c.toLowerCase().includes("supply"))}));const totalZones=Math.max(heatingSeries.length,coolingSeries.length);let vizMode;vizMode=totalZones&lt;=10?"individual":totalZones&lt;=50?"aggregated":"heatmap";const allTimestamps=new Set;[...heatingSeries,...coolingSeries,...tempSeries].forEach(s=&gt;{var _a;null==(_a=s.data)||_a.forEach(d=&gt;allTimestamps.add(d[0]))});const timestamps=Array.from(allTimestamps).sort(),wasteEvents=timestamps.map(ts=&gt;(timestamp=&gt;{const heatingValues=heatingSeries.map(s=&gt;{var _a,_b;return{name:s.name,value:(null==(_b=null==(_a=s.data)?void 0:_a.find(d=&gt;Math.abs(d[0]-timestamp)&lt;6e4))?void 0:_b[1])||0}}).filter(v=&gt;v.value&gt;detectionConfig.heatingThreshold),coolingValues=coolingSeries.map(s=&gt;{var _a,_b;return{name:s.name,value:(null==(_b=null==(_a=s.data)?void 0:_a.find(d=&gt;Math.abs(d[0]-timestamp)&lt;6e4))?void 0:_b[1])||0}}).filter(v=&gt;v.value&gt;detectionConfig.coolingThreshold),activeHeatingZones=heatingValues.length,activeCoolingZones=coolingValues.length;if(0===activeHeatingZones||0===activeCoolingZones)return null;const totalHeating=heatingValues.reduce((sum,h)=&gt;sum+h.value,0),totalCooling=coolingValues.reduce((sum,c)=&gt;sum+c.value,0),overlapPercent=Math.min(totalHeating,totalCooling),factors=ENERGY_FACTORS[detectionConfig.energyUnit],ahuCapacity=ahuHeating.length*factors.typicalAHUCapacity,zoneCapacity=affectedZones.length*factors.typicalZoneCapacity,efficiencyPenalty="kW"===detectionConfig.energyUnit?1/factors.heatingCOP+1/factors.coolingCOP:1/factors.heatingEfficiency+1/factors.coolingEfficiency,wasteKW=overlapPercent/100*Math.min(ahuCapacity,zoneCapacity)*efficiencyPenalty*.5;if(wasteKW&lt;detectionConfig.wasteThreshold)return null;let wasteType="simultaneous",message="";return heatingValues.some(h=&gt;h.name.toLowerCase().includes("reheat"))?(wasteType="reheat",message=`${activeHeatingZones} zone(s) reheat active while ${activeCoolingZones} zone(s) cooling (${wasteKW.toFixed(1)} ${detectionConfig.energyUnit} waste)`):totalHeating&gt;1.5*totalCooling?(wasteType="mixed",message=`${activeHeatingZones} heating vs ${activeCoolingZones} cooling zones (${wastePercent.toFixed(1)}% waste)`):message=`${activeHeatingZones} heating + ${activeCoolingZones} cooling zones active (${wasteKW.toFixed(1)} ${detectionConfig.energyUnit} waste)`,{timestamp:timestamp,duration:detectionConfig.overlapDuration,wasteKW:wasteKW,wastePercent:wastePercent,affectedZones:[...heatingValues,...coolingValues].map(v=&gt;v.name),type:wasteType,message:message}})(ts)).filter(event=&gt;null!==event),aggregatedStats=timestamps.map(timestamp=&gt;{const allHeating=heatingSeries.map(s=&gt;{var _a,_b;return(null==(_b=null==(_a=s.data)?void 0:_a.find(d=&gt;Math.abs(d[0]-timestamp)&lt;6e4))?void 0:_b[1])||0}),allCooling=coolingSeries.map(s=&gt;{var _a,_b;return(null==(_b=null==(_a=s.data)?void 0:_a.find(d=&gt;Math.abs(d[0]-timestamp)&lt;6e4))?void 0:_b[1])||0}),totalHeating=allHeating.reduce((sum,val)=&gt;sum+val,0),totalCooling=allCooling.reduce((sum,val)=&gt;sum+val,0),avgTemp=tempSeries.reduce((sum,s)=&gt;{var _a,_b;return sum+((null==(_b=null==(_a=s.data)?void 0:_a.find(d=&gt;Math.abs(d[0]-timestamp)&lt;6e4))?void 0:_b[1])||0)},0)/Math.max(tempSeries.length,1),activeHeating=allHeating.filter(v=&gt;v&gt;detectionConfig.heatingThreshold).length,activeCooling=allCooling.filter(v=&gt;v&gt;detectionConfig.coolingThreshold).length;return{timestamp:timestamp,totalHeating:totalHeating,totalCooling:totalCooling,avgTemp:avgTemp,activeHeating:activeHeating,activeCooling:activeCooling,conflict:activeHeating&gt;0&amp;&amp;activeCooling&gt;0}});return{vizMode:vizMode,totalZones:totalZones,heatingSeries:heatingSeries,coolingSeries:coolingSeries,tempSeries:tempSeries,wasteEvents:wasteEvents,aggregatedStats:aggregatedStats,timestamps:timestamps}},[series,null==chartData?void 0:chartData.series,detectionConfig,setupComplete,pointSelections]),chartOptions=reactExports.useMemo(()=&gt;{if(!processedData)return mergeChartOptions(baseOptions,{title:title?{...CHART_DESIGN_TOKENS.title.base,text:"No Data Available",textStyle:{...CHART_DESIGN_TOKENS.title.base.textStyle,color:theme.palette.text.primary}}:void 0,series:[]});const totalPoints=[...processedData.heatingSeries,...processedData.coolingSeries].reduce((sum,s)=&gt;{var _a;return sum+((null==(_a=s.data)?void 0:_a.length)||0)},0),animationMode=CHART_DESIGN_TOKENS.adaptive.animationMode(totalPoints),{vizMode:vizMode,heatingSeries:heatingSeries,coolingSeries:coolingSeries,wasteEvents:wasteEvents,aggregatedStats:aggregatedStats}=processedData,chartSeries=[];if("individual"===vizMode)heatingSeries.forEach((s,idx)=&gt;{chartSeries.push({name:s.name,type:"line",data:s.data,yAxisIndex:0,smooth:!0,symbol:"none",lineStyle:{width:2,color:"#ff5722"},areaStyle:{opacity:.2,color:"#ff5722"},stack:"heating"})}),coolingSeries.forEach((s,idx)=&gt;{chartSeries.push({name:s.name,type:"line",data:s.data,yAxisIndex:0,smooth:!0,symbol:"none",lineStyle:{width:2,color:"#2196f3"},areaStyle:{opacity:.2,color:"#2196f3"},stack:"cooling"})});else if("aggregated"===vizMode)chartSeries.push({name:"Total Heating",type:"line",data:aggregatedStats.map(s=&gt;[s.timestamp,s.totalHeating]),yAxisIndex:0,smooth:!0,lineStyle:{width:3,color:"#ff5722"},areaStyle:{opacity:.3,color:"#ff5722"}},{name:"Total Cooling",type:"line",data:aggregatedStats.map(s=&gt;[s.timestamp,s.totalCooling]),yAxisIndex:0,smooth:!0,lineStyle:{width:3,color:"#2196f3"},areaStyle:{opacity:.3,color:"#2196f3"}},{name:"Active H/C Zones",type:"bar",data:aggregatedStats.map(s=&gt;[s.timestamp,s.activeHeating+s.activeCooling]),yAxisIndex:1,itemStyle:{color:params=&gt;{const stats=aggregatedStats[params.dataIndex];return(null==stats?void 0:stats.conflict)?"#ff9800":"#4caf50"}},barWidth:"60%",z:1});else{const heatmapData=heatingSeries.flatMap((hSeries,hIdx)=&gt;coolingSeries.flatMap((cSeries,cIdx)=&gt;{var _a;const conflicts=[];return null==(_a=hSeries.data)||_a.forEach(hPoint=&gt;{var _a2;const cPoint=null==(_a2=cSeries.data)?void 0:_a2.find(d=&gt;Math.abs(d[0]-hPoint[0])&lt;6e4);if(cPoint&amp;&amp;hPoint[1]&gt;10&amp;&amp;cPoint[1]&gt;10){const intensity=Math.min(hPoint[1],cPoint[1]);conflicts.push([hPoint[0],`${hIdx}-${cIdx}`,intensity])}}),conflicts}));chartSeries.push({name:"HC Conflicts",type:"heatmap",data:heatmapData,yAxisIndex:0,label:{show:!1},emphasis:{itemStyle:{shadowBlur:10}}})}if(wasteEvents.length&gt;0){chartSeries.push({name:"Waste Events",type:"scatter",data:wasteEvents.map(event=&gt;[event.timestamp,100,event.wasteKW,event.type]),yAxisIndex:0,symbolSize:value=&gt;Math.max(8,Math.min(30,2*value[2])),itemStyle:{color:params=&gt;{switch(params.data[3]){case"reheat":return"#ff9800";case"mixed":return"#ff5722";default:return"#f44336"}},opacity:.8},emphasis:{itemStyle:{opacity:1}},z:100});const wasteRegions=wasteEvents.map(event=&gt;({xAxis:event.timestamp,itemStyle:{color:"rgba(244, 67, 54, 0.1)",borderColor:"#f44336",borderWidth:1,borderType:"dashed"}}));chartSeries[0]&amp;&amp;(chartSeries[0].markArea={silent:!0,data:wasteRegions.map(region=&gt;[region,region])})}return mergeChartOptions(baseOptions,{...CHART_DESIGN_TOKENS.animation[animationMode],title:title?{...CHART_DESIGN_TOKENS.title.base,text:title,subtext:`${processedData.totalZones} zones monitored - ${wasteEvents.length} waste events detected`,textStyle:{...CHART_DESIGN_TOKENS.title.base.textStyle,color:theme.palette.text.primary}}:void 0,tooltip:{...CHART_DESIGN_TOKENS.tooltip.base,trigger:"axis",axisPointer:{type:"cross"},backgroundColor:"dark"===theme.palette.mode?"rgba(50, 50, 50, 0.95)":"rgba(255, 255, 255, 0.95)",borderColor:"dark"===theme.palette.mode?"rgba(255, 255, 255, 0.12)":"rgba(0, 0, 0, 0.12)",textStyle:{...CHART_DESIGN_TOKENS.tooltip.base.textStyle,color:theme.palette.text.primary},formatter:params=&gt;{let html=`&lt;strong&gt;${new Date(params[0].value[0]).toLocaleString()}&lt;/strong&gt;&lt;br/&gt;`;params.forEach(p=&gt;{var _a,_b;if("Waste Events"===p.seriesName)html+=`${p.marker} &lt;strong&gt;WASTE DETECTED&lt;/strong&gt;&lt;br/&gt;`,html+=`Energy Waste: ${null==(_a=p.value[2])?void 0:_a.toFixed(1)} ${detectionConfig.energyUnit}&lt;br/&gt;`,html+=`Type: ${p.value[3]}&lt;br/&gt;`;else{const unit=p.seriesName.includes("Temp")?`${detectionConfig.temperatureUnit}`:"%";html+=`${p.marker} ${p.seriesName}: ${null==(_b=p.value[1])?void 0:_b.toFixed(1)}${unit}&lt;br/&gt;`}});const wasteEvent=wasteEvents.find(e2=&gt;Math.abs(e2.timestamp-params[0].value[0])&lt;6e4);return wasteEvent&amp;&amp;(html+=`&lt;br/&gt;&lt;strong style="color: #f44336"&gt; ${wasteEvent.message}&lt;/strong&gt;`,html+=`&lt;br/&gt;Affected Zones: ${wasteEvent.affectedZones.length}`,html+=`&lt;br/&gt;Energy Waste: ${wasteEvent.wasteKW.toFixed(1)} ${detectionConfig.energyUnit}`,html+=`&lt;br/&gt;&lt;em style="font-size: 0.9em"&gt;Calc: ${wasteEvent.wastePercent.toFixed(0)}% overlap  capacity&lt;/em&gt;`),html}},grid:{...CHART_DESIGN_TOKENS.grid.base,left:"3%",right:"4%",bottom:showDataZoom?"15%":"3%",top:calculateGridTop({hasTitle:!!title,hasToolbox:!0}),containLabel:!0},xAxis:{type:"time",boundaryGap:!1},yAxis:[{type:"value",name:"H/C Output (%)",position:"left",min:0,max:100,axisLabel:{formatter:"{value}%"}},{type:"value",name:"Zone Count",position:"right",min:0,axisLabel:{formatter:"{value}"},show:"aggregated"===vizMode}],visualMap:"heatmap"===vizMode?{min:0,max:100,calculable:!0,orient:"vertical",right:"10",top:"center",inRange:{color:["#4caf50","#ffeb3b","#ff9800","#f44336"]},text:["High Conflict","Low Conflict"]}:void 0,series:chartSeries,dataZoom:showDataZoom?[{type:"inside",start:0,end:100},{type:"slider",start:0,end:100}]:void 0,toolbox:showToolbox?{feature:{dataView:{show:enableDataView},restore:{show:!0},saveAsImage:{show:!0},dataZoom:{show:showDataZoom},magicType:{show:!0,type:["line","bar","stack"]}}}:void 0,legend:showLegend?{data:chartSeries.map(s=&gt;s.name),bottom:0,selected:"individual"===vizMode?Object.fromEntries(chartSeries.map((s,i)=&gt;[s.name,i&lt;6])):void 0}:void 0},{showToolbox:showToolbox,enableDataView:enableDataView,showDataZoom:showDataZoom,showLegend:showLegend})},[processedData,detectionConfig,baseOptions,title,showToolbox,enableDataView,showDataZoom,showLegend,onEdit,onDelete]),handlePointSelectionChange=(categoryId,points)=&gt;{setPointSelections(prev=&gt;new Map(prev).set(categoryId,points))},handleSetupComplete=()=&gt;{var _a,_b,_c,_d;setSetupMode(!1),setSetupComplete(!0),console.log("Simultaneous H/C setup complete. Selected points:",{totalPoints:allSelectedPoints.length,ahuHeating:(null==(_a=pointSelections.get("ahuHeating"))?void 0:_a.length)||0,ahuCooling:(null==(_b=pointSelections.get("ahuCooling"))?void 0:_b.length)||0,zoneReheat:(null==(_c=pointSelections.get("zoneReheat"))?void 0:_c.length)||0,supplyTemp:(null==(_d=pointSelections.get("supplyTemp"))?void 0:_d.length)||0})};return setupMode?jsxRuntimeExports.jsxs(Paper,{sx:{p:3,height:height,overflow:"auto"},children:[jsxRuntimeExports.jsx(GuidedPointSelection,{title:"Simultaneous Heating/Cooling Detection Setup",description:"Select points to monitor for simultaneous heating and cooling detection",categories:SIMULTANEOUS_HC_CATEGORIES,availablePoints:availablePoints,selectedPoints:pointSelections,onSelectionChange:handlePointSelectionChange,onComplete:handleSetupComplete}),Array.from(pointSelections.values()).some(pts=&gt;pts.length&gt;0)&amp;&amp;jsxRuntimeExports.jsxs(Box,{sx:{mt:3},children:[jsxRuntimeExports.jsx(Typography$1,{variant:"h6",gutterBottom:!0,children:"Detection Configuration"}),jsxRuntimeExports.jsxs(Grid,{container:!0,spacing:2,children:[jsxRuntimeExports.jsxs(Grid,{item:!0,xs:12,children:[jsxRuntimeExports.jsxs(Typography$1,{gutterBottom:!0,children:["Waste Threshold (",detectionConfig.energyUnit,")"]}),jsxRuntimeExports.jsx(Slider,{value:detectionConfig.wasteThreshold,onChange:(e2,value)=&gt;setDetectionConfig(prev=&gt;({...prev,wasteThreshold:value})),valueLabelDisplay:"auto",min:0,max:50,step:1,marks:!0})]}),jsxRuntimeExports.jsx(Grid,{item:!0,xs:6,children:jsxRuntimeExports.jsx(TextField,{label:"Heating Threshold (%)",type:"number",value:detectionConfig.heatingThreshold,onChange:e2=&gt;setDetectionConfig(prev=&gt;({...prev,heatingThreshold:Number(e2.target.value)})),fullWidth:!0})}),jsxRuntimeExports.jsx(Grid,{item:!0,xs:6,children:jsxRuntimeExports.jsx(TextField,{label:"Cooling Threshold (%)",type:"number",value:detectionConfig.coolingThreshold,onChange:e2=&gt;setDetectionConfig(prev=&gt;({...prev,coolingThreshold:Number(e2.target.value)})),fullWidth:!0})}),jsxRuntimeExports.jsx(Grid,{item:!0,xs:6,children:jsxRuntimeExports.jsxs(FormControl,{fullWidth:!0,children:[jsxRuntimeExports.jsx(InputLabel,{children:"Energy Unit"}),jsxRuntimeExports.jsxs(Select,{value:detectionConfig.energyUnit,onChange:e2=&gt;setDetectionConfig(prev=&gt;({...prev,energyUnit:e2.target.value})),children:[jsxRuntimeExports.jsx(MenuItem,{value:"kW",children:"kW"}),jsxRuntimeExports.jsx(MenuItem,{value:"BTU/hr",children:"BTU/hr"})]})]})}),jsxRuntimeExports.jsx(Grid,{item:!0,xs:6,children:jsxRuntimeExports.jsx(TextField,{label:"Overlap Duration (min)",type:"number",value:detectionConfig.overlapDuration,onChange:e2=&gt;setDetectionConfig(prev=&gt;({...prev,overlapDuration:Number(e2.target.value)})),fullWidth:!0})})]})]})]}):loading||setupComplete&amp;&amp;dataLoading?jsxRuntimeExports.jsxs(Box,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:height},children:[jsxRuntimeExports.jsx(CircularProgress,{}),setupComplete&amp;&amp;dataLoading&amp;&amp;jsxRuntimeExports.jsxs(Typography$1,{variant:"body2",sx:{ml:2},children:["Fetching data for ",allSelectedPoints.length," selected points..."]})]}):error||setupComplete&amp;&amp;dataError?jsxRuntimeExports.jsx(Alert,{severity:"error",sx:{height:height},children:(null==error?void 0:error.message)||(null==dataError?void 0:dataError.message)}):jsxRuntimeExports.jsxs(Box,{sx:{height:height,position:"relative"},children:[processedData&amp;&amp;jsxRuntimeExports.jsx(Box,{sx:{position:"absolute",top:8,right:8,zIndex:1e3},children:jsxRuntimeExports.jsxs(Stack,{direction:"row",spacing:1,alignItems:"center",children:[jsxRuntimeExports.jsx(Chip,{label:`${processedData.totalZones} Zones`,size:"small",color:"primary"}),jsxRuntimeExports.jsx(Chip,{label:processedData.vizMode.toUpperCase(),size:"small",variant:"outlined"}),processedData.wasteEvents.length&gt;0&amp;&amp;jsxRuntimeExports.jsx(Chip,{label:`${processedData.wasteEvents.length} Waste Events`,size:"small",color:"error",icon:jsxRuntimeExports.jsx(ErrorIcon,{})}),processedData.wasteEvents.length&gt;0&amp;&amp;jsxRuntimeExports.jsx(Chip,{label:`${processedData.wasteEvents.reduce((sum,e2)=&gt;sum+e2.wasteKW,0).toFixed(1)} ${detectionConfig.energyUnit} waste`,size:"small",color:"warning",icon:jsxRuntimeExports.jsx(Battery4Bar,{})}),jsxRuntimeExports.jsx(Tooltip,{title:"How is energy waste calculated?",children:jsxRuntimeExports.jsx(IconButton,{size:"small",onClick:()=&gt;setShowCalculationInfo(!0),children:jsxRuntimeExports.jsx(Info,{})})}),jsxRuntimeExports.jsx(IconButton,{size:"small",onClick:()=&gt;{setSetupMode(!0)},children:jsxRuntimeExports.jsx(SettingsIcon,{})})]})}),jsxRuntimeExports.jsx(EChartsReact,{option:chartOptions,style:{height:"100%",width:"100%"},onChartReady:onChartReady,theme:theme.palette.mode}),jsxRuntimeExports.jsxs(Dialog,{open:showCalculationInfo,onClose:()=&gt;setShowCalculationInfo(!1),maxWidth:"md",fullWidth:!0,children:[jsxRuntimeExports.jsx(DialogTitle,{children:jsxRuntimeExports.jsxs(Box,{sx:{display:"flex",alignItems:"center",gap:1},children:[jsxRuntimeExports.jsx(Calculate,{}),"Energy Waste Calculation Methodology"]})}),jsxRuntimeExports.jsx(DialogContent,{children:jsxRuntimeExports.jsxs(Stack,{spacing:3,sx:{mt:2},children:[jsxRuntimeExports.jsx(Alert,{severity:"info",children:"Energy waste is calculated based on the simultaneous operation of heating and cooling systems, which represents energy fighting against itself."}),jsxRuntimeExports.jsxs(Box,{children:[jsxRuntimeExports.jsx(Typography$1,{variant:"h6",gutterBottom:!0,children:"Calculation Formula"}),jsxRuntimeExports.jsx(Paper,{sx:{p:2,bgcolor:"grey.50"},children:jsxRuntimeExports.jsx(Typography$1,{variant:"body2",component:"pre",sx:{fontFamily:"monospace"},children:"Energy Waste = Overlap%  System Capacity  Efficiency Penalty  Load Factor"})})]}),jsxRuntimeExports.jsxs(Box,{children:[jsxRuntimeExports.jsx(Typography$1,{variant:"h6",gutterBottom:!0,children:"Components Explained"}),jsxRuntimeExports.jsxs(List,{children:[jsxRuntimeExports.jsx(ListItem,{children:jsxRuntimeExports.jsx(ListItemText,{primary:"Overlap Percentage",secondary:"The minimum of heating and cooling percentages. If heating is at 60% and cooling at 40%, overlap is 40%."})}),jsxRuntimeExports.jsx(ListItem,{children:jsxRuntimeExports.jsx(ListItemText,{primary:"System Capacity",secondary:`Estimated based on equipment count: ${ENERGY_FACTORS[detectionConfig.energyUnit].typicalAHUCapacity} ${detectionConfig.energyUnit} per AHU, ${ENERGY_FACTORS[detectionConfig.energyUnit].typicalZoneCapacity} ${detectionConfig.energyUnit} per zone`})}),jsxRuntimeExports.jsx(ListItem,{children:jsxRuntimeExports.jsx(ListItemText,{primary:"Efficiency Penalty",secondary:`Combined inefficiency of simultaneous operation: 1/HeatingCOP (${ENERGY_FACTORS[detectionConfig.energyUnit].heatingCOP||ENERGY_FACTORS[detectionConfig.energyUnit].heatingEfficiency}) + 1/CoolingCOP (${ENERGY_FACTORS[detectionConfig.energyUnit].coolingCOP||ENERGY_FACTORS[detectionConfig.energyUnit].coolingEfficiency})`})}),jsxRuntimeExports.jsx(ListItem,{children:jsxRuntimeExports.jsx(ListItemText,{primary:"Load Factor (0.5)",secondary:"Accounts for partial load conditions and diversity - systems rarely operate at full capacity"})})]})]}),jsxRuntimeExports.jsxs(Box,{children:[jsxRuntimeExports.jsx(Typography$1,{variant:"h6",gutterBottom:!0,children:"Detection Thresholds"}),jsxRuntimeExports.jsxs(Grid,{container:!0,spacing:2,children:[jsxRuntimeExports.jsx(Grid,{item:!0,xs:6,children:jsxRuntimeExports.jsxs(Typography$1,{variant:"body2",color:"text.secondary",children:["Minimum Heating Signal: ",detectionConfig.heatingThreshold,"%"]})}),jsxRuntimeExports.jsx(Grid,{item:!0,xs:6,children:jsxRuntimeExports.jsxs(Typography$1,{variant:"body2",color:"text.secondary",children:["Minimum Cooling Signal: ",detectionConfig.coolingThreshold,"%"]})}),jsxRuntimeExports.jsx(Grid,{item:!0,xs:6,children:jsxRuntimeExports.jsxs(Typography$1,{variant:"body2",color:"text.secondary",children:["Waste Threshold: ",detectionConfig.wasteThreshold," ",detectionConfig.energyUnit]})}),jsxRuntimeExports.jsx(Grid,{item:!0,xs:6,children:jsxRuntimeExports.jsxs(Typography$1,{variant:"body2",color:"text.secondary",children:["Duration Required: ",detectionConfig.overlapDuration," minutes"]})})]})]}),jsxRuntimeExports.jsx(Alert,{severity:"warning",children:jsxRuntimeExports.jsxs(Typography$1,{variant:"body2",children:[jsxRuntimeExports.jsx("strong",{children:"Note:"})," These calculations are estimates based on typical equipment capacities. For precise energy analysis, actual equipment capacities and measured flow rates should be used. The calculation assumes standard efficiency values which may vary based on your specific equipment."]})})]})}),jsxRuntimeExports.jsx(DialogActions,{children:jsxRuntimeExports.jsx(Button,{onClick:()=&gt;setShowCalculationInfo(!1),children:"Close"})})]})]})},Radar:EChartsRadar$1,radar:EChartsRadar$1,BoxPlot:EChartsBoxPlot$1,boxplot:EChartsBoxPlot$1,Candlestick:EChartsCandlestick$1,candlestick:EChartsCandlestick$1,ParallelCoordinates:({axes:axes=[],data:data=[],series:series=[],loading:loading=!1,error:error=null,height:height=500,title:title,highlightOnHover:highlightOnHover=!0,showDataLabels:showDataLabels=!1,enableToolbox:enableToolbox=!0,showMarkerTags:showMarkerTags=!0,timeSamplingMode:timeSamplingMode="sample",maxTimePoints:maxTimePoints=100,colorBy:colorBy="time",enableBrushing:enableBrushing=!0,showCorrelations:showCorrelations=!1,onEdit:onEdit,onDelete:onDelete})=&gt;{const baseOptions=useBaseChartOptions(),{transformedAxes:transformedAxes,transformedData:transformedData,colorMapping:colorMapping}=reactExports.useMemo(()=&gt;series&amp;&amp;series.length&gt;0?function transformTimeseriesForParallel(series,options){if(!series||0===series.length)return{transformedAxes:[],transformedData:[],colorMapping:new Map};const transformedAxes=series.map((s,index2)=&gt;{var _a;return{name:options.showMarkerTags&amp;&amp;(null==(_a=s.markerTags)?void 0:_a.length)?getPointDisplayLabel({name:s.name,marker_tags:s.markerTags,unit:s.unit},{displayMode:"smart",context:"axis"}):s.name,unit:s.unit,type:"value"}}),allTimestamps=new Set;series.forEach(s=&gt;{s.data.forEach(([timestamp])=&gt;allTimestamps.add(timestamp))});let selectedTimestamps=Array.from(allTimestamps).sort((a,b)=&gt;a-b);if("sample"===options.timeSamplingMode&amp;&amp;selectedTimestamps.length&gt;options.maxTimePoints){const step=Math.ceil(selectedTimestamps.length/options.maxTimePoints);selectedTimestamps=selectedTimestamps.filter((_,index2)=&gt;index2%step===0)}else"hourly"===options.timeSamplingMode?selectedTimestamps=sampleByInterval(selectedTimestamps,36e5):"daily"===options.timeSamplingMode&amp;&amp;(selectedTimestamps=sampleByInterval(selectedTimestamps,864e5));const transformedData=[],colorMapping=new Map;return selectedTimestamps.forEach((timestamp,timeIndex)=&gt;{var _a;const values=[];let hasValidData=!1;if(series.forEach(s=&gt;{const dataPoint=s.data.find(([t])=&gt;Math.abs(t-timestamp)&lt;3e4);if(dataPoint)values.push(dataPoint[1]),hasValidData=!0;else{const before=s.data.filter(([t])=&gt;t&lt;timestamp).pop(),after=s.data.find(([t])=&gt;t&gt;timestamp);if(before&amp;&amp;after){const ratio=(timestamp-before[0])/(after[0]-before[0]),interpolated=before[1]+ratio*(after[1]-before[1]);values.push(interpolated),hasValidData=!0}else before?(values.push(before[1]),hasValidData=!0):after?(values.push(after[1]),hasValidData=!0):values.push(0)}}),hasValidData){const pointName=new Date(timestamp).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0});let color;if("time"===options.colorBy){color=`hsl(${240-120*(timeIndex/(selectedTimestamps.length-1))}, 70%, 50%)`}else color=`hsl(${137.508*timeIndex%360}, 70%, 50%)`;colorMapping.set(pointName,color),transformedData.push({name:pointName,values:values,color:color,timestamp:timestamp,markerTags:null==(_a=series[0])?void 0:_a.markerTags})}}),{transformedAxes:transformedAxes,transformedData:transformedData,colorMapping:colorMapping}}(series,{timeSamplingMode:timeSamplingMode,maxTimePoints:maxTimePoints,colorBy:colorBy,showMarkerTags:showMarkerTags}):axes.length&gt;0&amp;&amp;data.length&gt;0?{transformedAxes:axes,transformedData:data,colorMapping:new Map}:{transformedAxes:[],transformedData:[],colorMapping:new Map},[series,axes,data,timeSamplingMode,maxTimePoints,colorBy,showMarkerTags]),axisConfigs=reactExports.useMemo(()=&gt;transformedAxes.map((axis,index2)=&gt;{let min=axis.min,max=axis.max;if(void 0===min||void 0===max){const values=transformedData.map(d=&gt;d.values[index2]).filter(v=&gt;null!=v&amp;&amp;!isNaN(v));if(values.length&gt;0){const calculatedMin=Math.min(...values),calculatedMax=Math.max(...values),padding=.1*(calculatedMax-calculatedMin);min=min??calculatedMin-padding,max=max??calculatedMax+padding}else min=min??0,max=max??100}return{dim:index2,name:axis.name+(axis.unit?` (${axis.unit})`:""),type:axis.type||"value",min:min,max:max,nameLocation:"end",nameGap:20,nameTextStyle:{fontSize:12,fontWeight:500},splitLine:{show:!1},...enableBrushing?{axisPointer:{show:!0,type:"shadow"}}:{}}}),[transformedAxes,transformedData,enableBrushing]),seriesData=reactExports.useMemo(()=&gt;transformedData.map((point,index2)=&gt;{let color=point.color;if(colorMapping.has(point.name))color=colorMapping.get(point.name);else if("time"===colorBy&amp;&amp;point.timestamp){color=function generateTimeBasedColor(timestamp,allData){const timestamps=allData.map(d=&gt;d.timestamp).filter(Boolean);if(0===timestamps.length)return"#1f77b4";const minTime=Math.min(...timestamps),maxTime=Math.max(...timestamps);return`hsl(${240-(timestamp-minTime)/(maxTime-minTime)*120}, 70%, 50%)`}(point.timestamp,transformedData)}return{name:showMarkerTags&amp;&amp;point.markerTags?getPointDisplayLabel({name:point.name,marker_tags:point.markerTags},{displayMode:"smart",context:"legend"}):point.name,value:point.values,lineStyle:{color:color||`hsl(${137.508*index2%360}, 70%, 50%)`,width:2.5,opacity:.8,type:"solid"},emphasis:highlightOnHover?{lineStyle:{width:4,opacity:1,shadowBlur:10,shadowColor:color||`hsl(${137.508*index2%360}, 70%, 50%)`}}:void 0,...point.timestamp?{timestamp:point.timestamp}:{},...point.markerTags?{markerTags:point.markerTags}:{}}}),[transformedData,colorMapping,colorBy,showMarkerTags,highlightOnHover]),chartOption=reactExports.useMemo(()=&gt;{var _a;const customOptions={title:title?{text:title,left:"center",top:10,textStyle:{fontSize:16,fontWeight:600}}:void 0,tooltip:{...baseOptions.tooltip,trigger:"item",formatter:function(params){var _a2,_b;if(!params.value)return"";let html=`&lt;div style="padding: 8px;"&gt;&lt;strong&gt;${params.name}&lt;/strong&gt;&lt;br/&gt;`;if(null==(_a2=params.data)?void 0:_a2.timestamp){const timestamp=new Date(params.data.timestamp).toLocaleString();html+=`&lt;div style="color: #666; font-size: 0.9em;"&gt;Time: ${timestamp}&lt;/div&gt;&lt;br/&gt;`}return transformedAxes.forEach((axis,index2)=&gt;{const value=params.value[index2];null==value||isNaN(value)||(html+=`${axis.name}: ${formatNumberForDisplay(value)}${axis.unit?` ${axis.unit}`:""}&lt;br/&gt;`)}),(null==(_b=params.data)?void 0:_b.markerTags)&amp;&amp;params.data.markerTags.length&gt;0&amp;&amp;(html+=`&lt;div style="margin-top: 8px; padding-top: 4px; border-top: 1px solid #eee;"&gt;&lt;small&gt;Tags: ${params.data.markerTags.join(", ")}&lt;/small&gt;&lt;/div&gt;`),html+="&lt;/div&gt;",html}},legend:{...baseOptions.legend,type:"scroll",bottom:10,data:transformedData.map(d=&gt;d.name),textStyle:{fontSize:12},...showCorrelations?{tooltip:{show:!0,formatter:function(params){return`Click to highlight correlations with ${params.name}`}}}:{}},parallelAxis:axisConfigs,parallel:{left:"10%",right:"10%",bottom:"15%",top:title?"15%":"10%",parallelAxisDefault:{type:"value",nameLocation:"end",nameGap:20,splitLine:{show:!1}}},series:{type:"parallel",lineStyle:{width:2.5,opacity:1,type:"solid"},emphasis:highlightOnHover?{lineStyle:{width:4,opacity:1}}:void 0,data:seriesData,smooth:!0,...showDataLabels?{label:{show:!0,position:"right",formatter:"{b}",fontSize:10}}:{}},...enableBrushing?{brush:{toolbox:["lineX","lineY","keep","clear"],brushLink:"all",brushStyle:{borderWidth:1,color:"rgba(120,140,180,0.15)",borderColor:"rgba(120,140,180,0.6)"},transformable:!0,brushMode:"multiple"}}:{},animation:!0,animationDuration:300,animationEasing:"cubicOut"},mergedOptions=mergeChartOptions(baseOptions,customOptions,{showDataZoom:!1,showLegend:!0,showToolbox:enableToolbox,enableDataView:!1});return applyStandardFeatures(mergedOptions,"ParallelCoordinates",{theme:"#fff"===(null==(_a=baseOptions.textStyle)?void 0:_a.color)?"dark":"light",onEdit:onEdit,onDelete:onDelete})},[baseOptions,title,transformedAxes,transformedData,axisConfigs,seriesData,highlightOnHover,showDataLabels,enableToolbox,enableBrushing,showCorrelations,onEdit,onDelete]);return jsxRuntimeExports.jsx(EChartsWrapper,{error:error,height:height,loading:loading,option:chartOption})},ControlBand:EChartsControlBandChart$1,controlband:EChartsControlBandChart$1,ControlBandChart:EChartsControlBandChart$1,SPC:EChartsControlBandChart$1,spc:EChartsControlBandChart$1,SPCChart:EChartsControlBandChart$1,CalendarHeatmap:EChartsCalendarHeatmap$1,CalendarYearHeatmap:({data:data,year:year,loading:loading,error:error,height:height="400px",title:title,unit:unit="",metric:metric="Value",colorScale:colorScale,groupId:groupId,chartId:chartId,onChartReady:onChartReady,onEdit:onEdit,onDelete:onDelete})=&gt;{const theme=useTheme(),baseOptions=useBaseChartOptions(),calendarData=reactExports.useMemo(()=&gt;{if(!data||0===data.length)return[];const dateGroups=new Map;return data.forEach(series=&gt;{series.data.forEach(([timestamp,value])=&gt;{const dateStr=format$1(new Date(timestamp),"yyyy-MM-dd");dateGroups.has(dateStr)||dateGroups.set(dateStr,[]),dateGroups.get(dateStr).push(value)})}),Array.from(dateGroups.entries()).map(([dateStr,values])=&gt;({date:dateStr,value:values.reduce((sum,val)=&gt;sum+val,0)/values.length,metadata:{count:values.length,min:Math.min(...values),max:Math.max(...values)}}))},[data]),{minValue:minValue,maxValue:maxValue}=reactExports.useMemo(()=&gt;{const values=calendarData.map(d=&gt;d.value).filter(v=&gt;!isNaN(v));return{minValue:values.length&gt;0?Math.min(...values):0,maxValue:values.length&gt;0?Math.max(...values):1}},[calendarData]),option=reactExports.useMemo(()=&gt;{const processedData=calendarData.map(item=&gt;{let dateStr;return dateStr="string"==typeof item.date?item.date:item.date instanceof Date?item.date.toISOString().split("T")[0]:"number"==typeof item.date?new Date(item.date).toISOString().split("T")[0]:"",[dateStr,item.value,item.metadata]}),defaultMinColor="dark"===theme.palette.mode?"#1e3a5f":"#e3f2fd",defaultMaxColor=theme.palette.primary.main,isDarkMode="dark"===theme.palette.mode,calendarSpecificOptions={title:title?{...CHART_DESIGN_TOKENS.title.base,text:title,textStyle:{...CHART_DESIGN_TOKENS.title.base.textStyle,color:theme.palette.text.primary}}:void 0,tooltip:{...CHART_DESIGN_TOKENS.tooltip.base,trigger:"item",backgroundColor:isDarkMode?"rgba(50, 50, 50, 0.95)":"rgba(255, 255, 255, 0.95)",borderColor:isDarkMode?"rgba(255, 255, 255, 0.12)":"rgba(0, 0, 0, 0.12)",textStyle:{...CHART_DESIGN_TOKENS.tooltip.base.textStyle,color:theme.palette.text.primary},formatter:params=&gt;{const date=new Date(params.data[0]),value=params.data[1],metadata=params.data[2];let tooltip=`&lt;strong&gt;${ChartTimeFormatter.calendar(date)}&lt;/strong&gt;&lt;br/&gt;`;return tooltip+=`${metric}: ${formatNumberForDisplay(value,2)} ${unit}`,metadata&amp;&amp;(metadata.details&amp;&amp;(tooltip+=`&lt;br/&gt;${metadata.details}`),metadata.anomaly&amp;&amp;(tooltip+=`&lt;br/&gt;&lt;span style="color: ${theme.palette.error.main}"&gt; Anomaly detected&lt;/span&gt;`)),tooltip}},visualMap:{type:"piecewise",orient:"horizontal",left:"center",bottom:20,pieces:(null==colorScale?void 0:colorScale.pieces)||[{min:minValue,max:minValue+.2*(maxValue-minValue),label:"Low",color:defaultMinColor},{min:minValue+.2*(maxValue-minValue),max:minValue+.4*(maxValue-minValue),label:"Below Average",color:theme.palette.info.light},{min:minValue+.4*(maxValue-minValue),max:minValue+.6*(maxValue-minValue),label:"Average",color:theme.palette.warning.light},{min:minValue+.6*(maxValue-minValue),max:minValue+.8*(maxValue-minValue),label:"Above Average",color:theme.palette.warning.main},{min:minValue+.8*(maxValue-minValue),max:maxValue,label:"High",color:defaultMaxColor}],inRange:{color:colorScale?[colorScale.min||defaultMinColor,colorScale.max||defaultMaxColor]:void 0},textStyle:{color:theme.palette.text.secondary}},calendar:{top:title?80:60,left:60,right:60,cellSize:["auto",20],range:year.toString(),itemStyle:{borderWidth:.5,borderColor:theme.palette.divider},yearLabel:{show:!0,position:"top",margin:40,fontSize:20,fontWeight:"bold",color:theme.palette.text.primary},monthLabel:{show:!0,nameMap:"en",color:theme.palette.text.secondary},dayLabel:{show:!0,nameMap:["S","M","T","W","T","F","S"],color:theme.palette.text.secondary},splitLine:{show:!0,lineStyle:{color:theme.palette.divider,width:1,type:"solid"}}},series:[{type:"heatmap",coordinateSystem:"calendar",data:processedData,label:{show:!1},emphasis:{itemStyle:{shadowBlur:10,shadowColor:"rgba(0, 0, 0, 0.5)"}},animation:!0,animationDuration:1e3,animationEasing:"cubicOut"}],aria:{enabled:!0,label:{enabled:!0,description:`Calendar heatmap showing daily ${metric} for the year ${year}`}}},totalPoints=calendarData.reduce((sum,_)=&gt;sum+1,0),animationMode=CHART_DESIGN_TOKENS.adaptive.animationMode(totalPoints);return mergeChartOptions(baseOptions,{...calendarSpecificOptions,...CHART_DESIGN_TOKENS.animation[animationMode]},{showToolbox:!0,enableDataView:!1,enableMagicType:!1,showDataZoom:!1,showLegend:!1})},[data,year,title,theme,unit,metric,colorScale,baseOptions,onEdit,onDelete,calendarData]);return jsxRuntimeExports.jsx(EChartsWrapper,{option:option,loading:loading,error:error,height:height,onChartReady:chart=&gt;{chartId&amp;&amp;registerChartForActions(chartId,chart),groupId&amp;&amp;chartId&amp;&amp;addChartToGroup(chart,groupId),onChartReady&amp;&amp;onChartReady(chart)}})},TimelineChart:EChartsTimelineChart,timeline:EChartsTimelineChart,Sankey:EChartsSankey$1,sankey:EChartsSankey$1,Treemap:EChartsTreemap$1,treemap:EChartsTreemap$1},UnifiedChartRenderer=({monitor:monitor,enableTools:enableTools=["edit","delete","export","refresh","fullscreen"],enableLazyLoad:enableLazyLoad=!0,enableAutoResize:enableAutoResize=!0,onEdit:onEdit,onDelete:onDelete,onRefresh:onRefresh,onExport:onExport,onFullscreen:onFullscreen,onUpdate:onUpdate,height:height=400,minHeight:minHeight=300,showLoading:showLoading=!0,loadingMessage:loadingMessage="Loading chart...",errorMessage:errorMessage="Error loading chart",emptyMessage:emptyMessage="No data available",debounceResize:debounceResize=300,lazyLoadThreshold:lazyLoadThreshold=.1})=&gt;{var _a,_b,_c,_d;const theme=useTheme(),containerRef=reactExports.useRef(null),chartInstanceRef=reactExports.useRef(null),[isFullscreen,setIsFullscreen]=reactExports.useState(!1),[exportMenuAnchor,setExportMenuAnchor]=reactExports.useState(null),[showDataView,setShowDataView]=reactExports.useState(!1),[isHovered,setIsHovered]=reactExports.useState(!1),[isRefreshing,setIsRefreshing]=reactExports.useState(!1),{ref:inViewRef,inView:inView}=useInView({threshold:lazyLoadThreshold,triggerOnce:!0,skip:!enableLazyLoad}),setRefs=reactExports.useCallback(node=&gt;{containerRef.current=node,enableLazyLoad&amp;&amp;inViewRef(node)},[inViewRef,enableLazyLoad]),isDebugChart="PerfectEconomizer"===monitor.chartType||"TimeSeries"===monitor.chartType||"line"===monitor.chartType;isDebugChart&amp;&amp;console.log("Debug data fetch setup for chart type:",{chartType:monitor.chartType,monitorId:monitor.id,monitorTitle:monitor.title,selectedPoints:null==(_a=monitor.selectedPoints)?void 0:_a.map(p=&gt;({id:p.id,name:p.name,unit:p.unit,hasId:!!p.id,hasName:!!p.name})),selectedPointsCount:(null==(_b=monitor.selectedPoints)?void 0:_b.length)||0,timeRange:monitor.timeRange||"24h",enabled:!!monitor.selectedPoints&amp;&amp;monitor.selectedPoints.length&gt;0&amp;&amp;(!enableLazyLoad||inView),lazyLoadEnabled:enableLazyLoad,inView:inView});const effectiveTimeRange=monitor.timeRange||"24h";console.log(" [UnifiedChartRenderer] TimeRange for chart:",{monitorId:monitor.id,chartType:monitor.chartType,monitorTimeRange:monitor.timeRange,effectiveTimeRange:effectiveTimeRange,selectedPointsCount:(null==(_c=monitor.selectedPoints)?void 0:_c.length)||0,enabled:!!monitor.selectedPoints&amp;&amp;monitor.selectedPoints.length&gt;0&amp;&amp;(!enableLazyLoad||inView)});const{data:data,series:series,isLoading:isLoading,error:error}=useChartDataSimple({selectedPoints:monitor.selectedPoints||[],timeRange:effectiveTimeRange,monitorId:monitor.id,enabled:!!monitor.selectedPoints&amp;&amp;monitor.selectedPoints.length&gt;0&amp;&amp;(!enableLazyLoad||inView)});isDebugChart&amp;&amp;console.log("Debug data response for chart type:",{chartType:monitor.chartType,monitorId:monitor.id,monitorTitle:monitor.title,isLoading:isLoading,hasError:!!error,errorMessage:null==error?void 0:error.message,hasData:!!data,hasSeries:!!series,seriesLength:(null==series?void 0:series.length)||0,dataLength:(null==data?void 0:data.length)||0,seriesDetails:(null==series?void 0:series.map(s=&gt;{var _a2,_b2,_c2;return{name:s.name,dataPoints:(null==(_a2=s.data)?void 0:_a2.length)||0,hasData:!!(s.data&amp;&amp;s.data.length&gt;0),firstDataPoint:null==(_b2=s.data)?void 0:_b2[0],lastDataPoint:null==(_c2=s.data)?void 0:_c2[s.data.length-1],unit:s.unit}}))||[],dataStructure:data?{isArray:Array.isArray(data),hasPointSamples:!(!data||"object"!=typeof data||!data.point_samples),keys:"object"==typeof data?Object.keys(data):[]}:null}),reactExports.useEffect(()=&gt;{if(!enableAutoResize||!containerRef.current||!chartInstanceRef.current)return;const handleResize=lodashExports.debounce(()=&gt;{chartInstanceRef.current&amp;&amp;"function"==typeof chartInstanceRef.current.resize&amp;&amp;chartInstanceRef.current.resize()},debounceResize),resizeObserver=new ResizeObserver(handleResize);return resizeObserver.observe(containerRef.current),window.addEventListener("resize",handleResize),()=&gt;{resizeObserver.disconnect(),window.removeEventListener("resize",handleResize),handleResize.cancel()}},[enableAutoResize,debounceResize]);const handleChartReady=reactExports.useCallback(instance=&gt;{chartInstanceRef.current=instance},[]);reactExports.useEffect(()=&gt;()=&gt;{if(chartInstanceRef.current&amp;&amp;"function"==typeof chartInstanceRef.current.dispose)try{chartInstanceRef.current.dispose(),chartInstanceRef.current=null}catch(error2){console.error("Failed to dispose chart instance:",error2)}},[]);const handleFullscreenToggle=reactExports.useCallback(()=&gt;{setIsFullscreen(!isFullscreen),null==onFullscreen||onFullscreen(),setTimeout(()=&gt;{chartInstanceRef.current&amp;&amp;"function"==typeof chartInstanceRef.current.resize&amp;&amp;chartInstanceRef.current.resize()},100)},[isFullscreen,onFullscreen]),handleRefresh=reactExports.useCallback(async()=&gt;{if(!isRefreshing){setIsRefreshing(!0);try{await(null==onRefresh?void 0:onRefresh())}catch(error2){console.error("Failed to refresh data:",error2)}finally{setIsRefreshing(!1)}}},[onRefresh,isRefreshing]),handleExport=reactExports.useCallback(format2=&gt;{if(setExportMenuAnchor(null),onExport)onExport(format2);else{if("png"===format2&amp;&amp;chartInstanceRef.current)try{const echartsInstance=chartInstanceRef.current.getEchartsInstance?chartInstanceRef.current.getEchartsInstance():chartInstanceRef.current;if(echartsInstance&amp;&amp;echartsInstance.getDataURL){const url=echartsInstance.getDataURL({type:"png",pixelRatio:2,backgroundColor:"#ffffff"}),link=document.createElement("a");link.download=`${monitor.title}-${(new Date).toISOString().slice(0,10)}.png`,link.href=url,document.body.appendChild(link),link.click(),document.body.removeChild(link)}else console.error("Chart instance not available for PNG export")}catch(error2){console.error("Failed to export PNG:",error2)}if("csv"===format2)try{if(series&amp;&amp;series.length&gt;0){const csvData=series.flatMap(s=&gt;{var _a2;return(null==(_a2=s.data)?void 0:_a2.map(point=&gt;({timestamp:new Date(point[0]||point.timestamp).toISOString(),value:point[1]||point.value,pointName:s.name,unit:s.unit||""})))||[]});csvData.length&gt;0?exportTimeseriesAsCSV(csvData,{filename:`${monitor.title}-${(new Date).toISOString().slice(0,10)}.csv`,includeHeaders:!0,dateFormat:"iso",precision:3,includeUnits:!0}):console.warn("No data available for CSV export")}}catch(error2){console.error("Failed to export CSV:",error2)}if("json"===format2)try{const jsonData={chartType:monitor.chartType,title:monitor.title,exportedAt:(new Date).toISOString(),config:monitor.config,series:series||[],selectedPoints:monitor.selectedPoints||[],timeRange:effectiveTimeRange};exportTimeseriesAsJSON(jsonData,`${monitor.title}-${(new Date).toISOString().slice(0,10)}.json`,!0)}catch(error2){console.error("Failed to export JSON:",error2)}}},[onExport,monitor.title,series,monitor.chartType,monitor.config,monitor.selectedPoints,effectiveTimeRange]),ChartComponent=CHART_COMPONENTS[monitor.chartType]||EChartsTimeSeriesChart$1;if(enableLazyLoad&amp;&amp;!inView)return jsxRuntimeExports.jsx(Box,{ref:setRefs,sx:{height:height,minHeight:minHeight,display:"flex",alignItems:"center",justifyContent:"center",bgcolor:alpha(theme.palette.background.paper,.8),borderRadius:1},children:jsxRuntimeExports.jsx(Typography$1,{variant:"body2",color:"text.secondary",children:"Scroll to load chart"})});if(isLoading&amp;&amp;showLoading)return jsxRuntimeExports.jsxs(Box,{ref:setRefs,sx:{height:height,minHeight:minHeight,display:"flex",alignItems:"center",justifyContent:"center",flexDirection:"column",gap:2},children:[jsxRuntimeExports.jsx(CircularProgress,{size:32}),jsxRuntimeExports.jsx(Typography$1,{variant:"body2",color:"text.secondary",children:loadingMessage})]});const hasError=!!error,isEmpty=!series||0===series.length||series.every(s=&gt;!s.data||0===s.data.length),chartProps=(()=&gt;{var _a2,_b2,_c2,_d2,_e,_f,_g,_h,_i,_j,_k,_l,_m,_n,_o,_p,_q,_r,_s,_t,_u,_v,_w,_x,_y,_z,_A,_B,_C,_D,_E,_F,_G,_H,_I,_J,_K,_L,_M,_N,_O,_P,_Q,_R;const baseProps={title:monitor.title,timeRange:effectiveTimeRange,height:"100%",width:"100%",onChartReady:handleChartReady,enableToolbox:!0,onEdit:enableTools.includes("edit")?onEdit:void 0,onDelete:enableTools.includes("delete")?onDelete:void 0,selectedPoints:monitor.selectedPoints,loading:isLoading,error:error,...monitor.config},chartType=monitor.chartType;if(["TimeSeries","line","Line","LineChart","timeline","TimelineChart"].includes(chartType)){const formattedSeries=(null==series?void 0:series.map(s=&gt;({...s,name:s.formattedName||s.name})))||[];return{...baseProps,data:formattedSeries,series:formattedSeries}}if(["area","AreaChart","StackedArea"].includes(chartType)){const formattedSeries=(null==series?void 0:series.map(s=&gt;({...s,name:s.formattedName||s.name})))||[];return{...baseProps,data:formattedSeries,series:formattedSeries,stacked:"StackedArea"===chartType}}if(["bar","Bar","BarChart"].includes(chartType)){const formattedSeries=(null==series?void 0:series.map(s=&gt;({...s,name:s.formattedName||s.name})))||[];return{...baseProps,data:formattedSeries,series:formattedSeries}}if(["heatmap","Heatmap"].includes(chartType))return{...baseProps,data:series||[],series:series};if(["scatter","Scatter","ScatterPlot"].includes(chartType))return{...baseProps,data:series||[],series:series};if(["gauge","Gauge","GaugeChart"].includes(chartType)){const latestValue=(null==(_c2=null==(_b2=null==(_a2=null==series?void 0:series[0])?void 0:_a2.data)?void 0:_b2.slice(-1)[0])?void 0:_c2[1])||0;return{...baseProps,data:series||[],series:series,value:latestValue}}if(["BoxPlot","boxplot"].includes(chartType))return{...baseProps,data:series||[],series:series};if(["Candlestick","candlestick"].includes(chartType))return{...baseProps,data:series||[],series:series};if(["CalendarHeatmap","CalendarYearHeatmap"].includes(chartType))return{...baseProps,data:series||[],series:series};if("Psychrometric"===chartType)return{...baseProps,data:series||[],series:series};if("VAVDiagnostic"===chartType)return{...baseProps,data:series||[],series:series,diagnosticMode:(null==(_d2=monitor.config)?void 0:_d2.diagnosticMode)||"general"};if("VAVComprehensive"===chartType)return{...baseProps,series:series||[],data:series||[]};if("ChilledWaterReset"===chartType)return{...baseProps,series:series||[],data:series||[],config:{mode:(null==(_e=monitor.config)?void 0:_e.mode)||"basic",resetStrategy:(null==(_f=monitor.config)?void 0:_f.resetStrategy)||"trim-respond",minSetpoint:(null==(_g=monitor.config)?void 0:_g.minSetpoint)||42,maxSetpoint:(null==(_h=monitor.config)?void 0:_h.maxSetpoint)||48,targetValvePosition:(null==(_i=monitor.config)?void 0:_i.targetValvePosition)||85,responseTime:(null==(_j=monitor.config)?void 0:_j.responseTime)||15,unit:(null==(_k=monitor.config)?void 0:_k.unit)||"F"}};if("DPOptimization"===chartType)return{...baseProps,series:series||[],data:series||[],config:{mode:(null==(_l=monitor.config)?void 0:_l.mode)||"basic",resetStrategy:(null==(_m=monitor.config)?void 0:_m.resetStrategy)||"trim-respond",minSetpoint:(null==(_n=monitor.config)?void 0:_n.minSetpoint)||.5,maxSetpoint:(null==(_o=monitor.config)?void 0:_o.maxSetpoint)||3,targetDamperPosition:(null==(_p=monitor.config)?void 0:_p.targetDamperPosition)||85,responseTime:(null==(_q=monitor.config)?void 0:_q.responseTime)||10,unit:(null==(_r=monitor.config)?void 0:_r.unit)||"inWC"}};if("SimultaneousHC"===chartType)return{...baseProps,series:series||[],data:series||[],config:{mode:(null==(_s=monitor.config)?void 0:_s.mode)||"basic",heatingThreshold:(null==(_t=monitor.config)?void 0:_t.heatingThreshold)||5,coolingThreshold:(null==(_u=monitor.config)?void 0:_u.coolingThreshold)||5,temperatureDifferenceThreshold:(null==(_v=monitor.config)?void 0:_v.temperatureDifferenceThreshold)||2,unit:(null==(_w=monitor.config)?void 0:_w.unit)||"F",detectionWindow:(null==(_x=monitor.config)?void 0:_x.detectionWindow)||15}};if("PerfectEconomizer"===chartType){const economizerConfig={mixedAirSetpoint:(null==(_y=monitor.config)?void 0:_y.mixedAirSetpoint)||55,minimumOAPercentage:(null==(_z=monitor.config)?void 0:_z.minimumOAPercentage)||20,preheatSetpoint:(null==(_A=monitor.config)?void 0:_A.preheatSetpoint)||45,coolingSetpoint:(null==(_B=monitor.config)?void 0:_B.coolingSetpoint)||75,returnAirTemp:(null==(_C=monitor.config)?void 0:_C.returnAirTemp)||72,economizerHighLimit:(null==(_D=monitor.config)?void 0:_D.economizerHighLimit)||75,unit:(null==(_E=monitor.config)?void 0:_E.unit)||"F"};return{...baseProps,data:series||[],series:series,config:economizerConfig}}return"DeviceDeviationHeatmap"===chartType?{...baseProps,data:void 0,series:series,pointConfigs:(null==(_F=monitor.config)?void 0:_F.pointConfigs)||[],selectedPoints:monitor.selectedPoints,timeRange:effectiveTimeRange,enableLiveData:!1,onConfigsChange:configs=&gt;{onUpdate&amp;&amp;onUpdate(monitor.id,{config:{...monitor.config,pointConfigs:configs}})}}:"ParallelCoordinates"===chartType||["Radar","radar"].includes(chartType)||["Sankey","sankey"].includes(chartType)||["Treemap","treemap"].includes(chartType)?{...baseProps,data:series||[],series:series}:["ControlBand","controlband","ControlBandChart","SPC","spc","SPCChart"].includes(chartType)?{...baseProps,data:{series:series||[]},series:series,upperLimit:"string"==typeof(null==(_G=monitor.config)?void 0:_G.upperLimit)?parseFloat(monitor.config.upperLimit):(null==(_H=monitor.config)?void 0:_H.upperLimit)||(null==(_I=monitor.config)?void 0:_I.upperControlLimit)||100,lowerLimit:"string"==typeof(null==(_J=monitor.config)?void 0:_J.lowerLimit)?parseFloat(monitor.config.lowerLimit):(null==(_K=monitor.config)?void 0:_K.lowerLimit)||(null==(_L=monitor.config)?void 0:_L.lowerControlLimit)||0,targetValue:"string"==typeof(null==(_M=monitor.config)?void 0:_M.targetValue)?parseFloat(monitor.config.targetValue):(null==(_N=monitor.config)?void 0:_N.targetValue)||(null==(_O=monitor.config)?void 0:_O.centerLine),warningThreshold:(null==(_P=monitor.config)?void 0:_P.warningThreshold)||10,showBackgroundZones:!1!==(null==(_Q=monitor.config)?void 0:_Q.showBackgroundZones),showAlerts:!1!==(null==(_R=monitor.config)?void 0:_R.showAlerts)}:{...baseProps,data:series||[],series:series}})();return jsxRuntimeExports.jsxs(Box,{ref:setRefs,onMouseEnter:()=&gt;setIsHovered(!0),onMouseLeave:()=&gt;setIsHovered(!1),sx:{height:height,minHeight:minHeight,position:"relative",bgcolor:theme.palette.background.paper,borderRadius:1,overflow:"hidden",transition:"all 0.3s ease-in-out",...isFullscreen&amp;&amp;{position:"fixed",top:0,left:0,right:0,bottom:0,zIndex:theme.zIndex.modal,height:"100vh",borderRadius:0}},children:[jsxRuntimeExports.jsxs(Box,{sx:{position:"absolute",top:8,left:8,display:"flex",gap:.5,zIndex:100,opacity:isHovered?1:.7,transition:"opacity 0.3s ease-in-out",bgcolor:alpha(theme.palette.background.paper,.9),borderRadius:1,p:.5,backdropFilter:"blur(8px)",pointerEvents:"auto"},children:[enableTools.includes("refresh")&amp;&amp;jsxRuntimeExports.jsx(Tooltip,{title:"Refresh data",children:jsxRuntimeExports.jsx(IconButton,{size:"small",onClick:handleRefresh,disabled:isRefreshing,children:jsxRuntimeExports.jsx(Refresh,{fontSize:"small",sx:{animation:isRefreshing?"spin 1s linear infinite":"none","@keyframes spin":{"0%":{transform:"rotate(0deg)"},"100%":{transform:"rotate(360deg)"}}}})})}),enableTools.includes("export")&amp;&amp;jsxRuntimeExports.jsx(Tooltip,{title:"Export data (CSV, JSON, PNG)",children:jsxRuntimeExports.jsx(IconButton,{size:"small",onClick:e2=&gt;setExportMenuAnchor(e2.currentTarget),children:jsxRuntimeExports.jsx(ExportIcon,{fontSize:"small"})})}),enableTools.includes("edit")&amp;&amp;jsxRuntimeExports.jsx(Tooltip,{title:"Edit",children:jsxRuntimeExports.jsx(IconButton,{size:"small",onClick:onEdit,children:jsxRuntimeExports.jsx(Edit,{fontSize:"small"})})}),enableTools.includes("delete")&amp;&amp;jsxRuntimeExports.jsx(Tooltip,{title:"Delete",children:jsxRuntimeExports.jsx(IconButton,{size:"small",onClick:onDelete,color:"error",children:jsxRuntimeExports.jsx(Delete,{fontSize:"small"})})}),enableTools.includes("fullscreen")&amp;&amp;jsxRuntimeExports.jsx(Tooltip,{title:isFullscreen?"Exit fullscreen":"Enter fullscreen",children:jsxRuntimeExports.jsx(IconButton,{size:"small",onClick:handleFullscreenToggle,children:isFullscreen?jsxRuntimeExports.jsx(FullscreenExitIcon,{fontSize:"small"}):jsxRuntimeExports.jsx(FullscreenIcon,{fontSize:"small"})})})]}),jsxRuntimeExports.jsx(Box,{sx:{height:"100%",width:"100%",position:"relative",zIndex:1,"&amp; &gt; div":{position:"relative !important",zIndex:"auto !important"}},children:hasError?jsxRuntimeExports.jsx(Box,{sx:{height:"100%",display:"flex",alignItems:"center",justifyContent:"center",p:2},children:jsxRuntimeExports.jsxs(Alert,{severity:"error",sx:{maxWidth:400},children:[jsxRuntimeExports.jsxs(Typography$1,{variant:"body2",children:[errorMessage,": ",error.message]}),jsxRuntimeExports.jsx(Typography$1,{variant:"caption",display:"block",sx:{mt:1,opacity:.8},children:"You can still edit or delete this chart."})]})}):isEmpty?jsxRuntimeExports.jsxs(Box,{sx:{height:"100%",display:"flex",alignItems:"center",justifyContent:"center"},children:[jsxRuntimeExports.jsx(Typography$1,{variant:"h6",color:"text.secondary",children:"No Data Available"}),jsxRuntimeExports.jsx(Typography$1,{variant:"body2",color:"text.secondary",sx:{mt:2},children:"The selected points do not have data for the chosen time range."}),(null==(_d=monitor.selectedPoints)?void 0:_d.length)&gt;0&amp;&amp;jsxRuntimeExports.jsxs(Box,{sx:{mt:2,p:2,bgcolor:"background.paper",borderRadius:1},children:[jsxRuntimeExports.jsx(Typography$1,{variant:"caption",color:"text.secondary",children:"Selected points:"}),jsxRuntimeExports.jsx(Typography$1,{variant:"body2",sx:{mt:.5},children:monitor.selectedPoints.map(p=&gt;p.name||p).join(", ")})]}),jsxRuntimeExports.jsx(Typography$1,{variant:"caption",display:"block",color:"text.secondary",sx:{mt:2},children:"Try selecting a different time range or checking if data collection is enabled for these points."})]}):jsxRuntimeExports.jsx(reactExports.Suspense,{fallback:jsxRuntimeExports.jsx(CircularProgress,{}),children:jsxRuntimeExports.jsx(SafeChartWrapper,{chartId:monitor.id,fallback:jsxRuntimeExports.jsx(Box,{sx:{p:2,height:"100%",minHeight:300,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},children:jsxRuntimeExports.jsxs(Alert,{severity:"error",sx:{maxWidth:400,backgroundColor:"rgba(255, 82, 82, 0.1)",border:"1px solid rgba(255, 82, 82, 0.2)",borderRadius:2},children:[jsxRuntimeExports.jsxs(Typography$1,{variant:"body2",sx:{color:"error.main"},children:["Failed to render ",monitor.chartType||"chart"]}),jsxRuntimeExports.jsx(Typography$1,{variant:"caption",display:"block",sx:{mt:1,opacity:.8},children:"The chart encountered an error but can still be edited or deleted."})]})}),children:jsxRuntimeExports.jsx(ChartComponent,{...chartProps})})})}),jsxRuntimeExports.jsxs(Menu,{anchorEl:exportMenuAnchor,open:Boolean(exportMenuAnchor),onClose:()=&gt;setExportMenuAnchor(null),PaperProps:{sx:{minWidth:250,"&amp; .MuiMenuItem-root":{px:2,py:1.5}}},children:[jsxRuntimeExports.jsx(MenuItem,{onClick:()=&gt;handleExport("csv"),children:jsxRuntimeExports.jsxs(Box,{children:[jsxRuntimeExports.jsx(Typography$1,{variant:"body2",fontWeight:600,children:" Export as CSV"}),jsxRuntimeExports.jsx(Typography$1,{variant:"caption",color:"text.secondary",display:"block",children:"Spreadsheet format (Excel compatible)"})]})}),jsxRuntimeExports.jsx(MenuItem,{onClick:()=&gt;handleExport("json"),children:jsxRuntimeExports.jsxs(Box,{children:[jsxRuntimeExports.jsx(Typography$1,{variant:"body2",fontWeight:600,children:" Export as JSON"}),jsxRuntimeExports.jsx(Typography$1,{variant:"caption",color:"text.secondary",display:"block",children:"Raw data with full precision"})]})}),jsxRuntimeExports.jsx(MenuItem,{onClick:()=&gt;handleExport("png"),children:jsxRuntimeExports.jsxs(Box,{children:[jsxRuntimeExports.jsx(Typography$1,{variant:"body2",fontWeight:600,children:" Export as PNG"}),jsxRuntimeExports.jsx(Typography$1,{variant:"caption",color:"text.secondary",display:"block",children:"High-quality image of the chart"})]})})]})]})},ResponsiveGridLayout=reactGridLayoutExports.WidthProvider(reactGridLayoutExports.Responsive),SimpleGridDashboard=({monitors:monitors,onEditMonitor:onEditMonitor,onDeleteMonitor:onDeleteMonitor,onLayoutChange:onLayoutChange,onRefresh:onRefresh,isViewer:isViewer})=&gt;{const theme=useTheme(),{isMobile:isMobile,isTablet:isTablet,isTouchDevice:isTouchDevice}=useMobileDetection(),[draggingId,setDraggingId]=reactExports.useState(null),[resizingId,setResizingId]=reactExports.useState(null),gridRef=reactExports.useRef(null),{updateMonitor:updateMonitor}=useDashboardContext(),layouts=reactExports.useMemo(()=&gt;{if(isMobile){const mobileLayout=monitors.map((monitor,index2)=&gt;({i:monitor.id,x:0,y:10*index2,w:12,h:10,minW:12,maxW:12,minH:8,maxH:12,static:isTouchDevice,isDraggable:!isTouchDevice,isResizable:!1}));return{lg:mobileLayout,md:mobileLayout,sm:mobileLayout,xs:mobileLayout,xxs:mobileLayout}}const layout=monitors.map(monitor=&gt;{var _a,_b,_c,_d;return{i:monitor.id,x:(null==(_a=monitor.layout)?void 0:_a.x)??0,y:(null==(_b=monitor.layout)?void 0:_b.y)??0,w:(null==(_c=monitor.layout)?void 0:_c.w)??6,h:(null==(_d=monitor.layout)?void 0:_d.h)??10,minW:3,minH:6,maxH:20}});return{lg:layout,md:layout.map(item=&gt;({...item,w:Math.min(item.w,8)})),sm:layout.map(item=&gt;({...item,w:Math.min(item.w,6)})),xs:layout.map(item=&gt;({...item,w:12,h:Math.max(item.h,8)})),xxs:layout.map(item=&gt;({...item,w:12,h:Math.max(item.h,8)}))}},[monitors,isMobile,isTablet,isTouchDevice]),handleLayoutChange=reactExports.useCallback((layout,allLayouts)=&gt;{const updatedLayouts=layout.map(item=&gt;({id:item.i,x:item.x,y:item.y,width:item.w,height:item.h}));onLayoutChange(updatedLayouts);const dispatchResize=()=&gt;{window.dispatchEvent(new CustomEvent("grid-resize",{detail:{layout:layout,timestamp:Date.now()}})),window.dispatchEvent(new Event("resize"))};dispatchResize(),setTimeout(dispatchResize,50),setTimeout(dispatchResize,200)},[onLayoutChange]);reactExports.useEffect(()=&gt;{if(!isMobile||isViewer)return;const handleTouchToMouse=touchEvent=&gt;{var _a;const touch=touchEvent.touches[0]||touchEvent.changedTouches[0];if(!touch)return;const mouseEventType={touchstart:"mousedown",touchmove:"mousemove",touchend:"mouseup"}[touchEvent.type];if(!mouseEventType)return;const mouseEvent=new MouseEvent(mouseEventType,{bubbles:!0,cancelable:!0,view:window,clientX:touch.clientX,clientY:touch.clientY,screenX:touch.screenX,screenY:touch.screenY});null==(_a=touch.target)||_a.dispatchEvent(mouseEvent),"touchmove"===touchEvent.type&amp;&amp;(resizingId||draggingId)&amp;&amp;touchEvent.preventDefault()},gridElement=gridRef.current;return gridElement?(gridElement.addEventListener("touchstart",handleTouchToMouse,{passive:!1}),gridElement.addEventListener("touchmove",handleTouchToMouse,{passive:!1}),gridElement.addEventListener("touchend",handleTouchToMouse,{passive:!1}),()=&gt;{gridElement.removeEventListener("touchstart",handleTouchToMouse),gridElement.removeEventListener("touchmove",handleTouchToMouse),gridElement.removeEventListener("touchend",handleTouchToMouse)}):void 0},[isMobile,isViewer,resizingId,draggingId]);const handleBreakpointChange=reactExports.useCallback((newBreakpoint,newCols)=&gt;{console.log(`Breakpoint changed to ${newBreakpoint} with ${newCols} columns`);const dispatchBreakpointResize=()=&gt;{window.dispatchEvent(new CustomEvent("grid-resize",{detail:{breakpoint:newBreakpoint,cols:newCols,timestamp:Date.now()}})),window.dispatchEvent(new Event("resize"))};dispatchBreakpointResize(),setTimeout(dispatchBreakpointResize,100),setTimeout(dispatchBreakpointResize,300)},[]);return jsxRuntimeExports.jsx(Box,{ref:gridRef,className:"gpu-dashboard-grid gpu-accelerated gpu-scroll",sx:{width:"100%",minHeight:"100%",position:"relative","&amp; .react-grid-layout":{position:"relative",minHeight:"100vh"},"&amp; .react-grid-item":{transition:"all 200ms ease",overflow:"visible","&amp;.react-grid-item.cssTransforms":{transitionProperty:"transform, width, height"},"&amp;.react-grid-item.resizing":{opacity:.9,zIndex:3,willChange:"width, height",transform:"translateZ(0)"},"&amp;.react-grid-item.react-draggable-dragging":{transition:"none",zIndex:3,opacity:.9,willChange:"transform",transform:"translate3d(0, 0, 0)"},"&amp; .react-resizable-handle":{position:"absolute",width:isMobile?"40px":"20px",height:isMobile?"40px":"20px",bottom:0,right:0,background:isMobile?`radial-gradient(circle at 70% 70%, ${alpha(theme.palette.primary.main,.3)} 0%, transparent 50%)`:`linear-gradient(-45deg, transparent 0%, transparent 40%, ${theme.palette.primary.main} 40%, ${theme.palette.primary.main} 60%, transparent 60%)`,backgroundSize:isMobile?"100% 100%":"10px 10px",cursor:"se-resize",opacity:isMobile?.6:.4,transition:"opacity 0.2s ease",touchAction:"none","&amp;::after":{content:'""',position:"absolute",right:isMobile?"8px":"3px",bottom:isMobile?"8px":"3px",width:isMobile?"8px":"5px",height:isMobile?"8px":"5px",borderRight:`2px solid ${theme.palette.primary.main}`,borderBottom:`2px solid ${theme.palette.primary.main}`},"&amp;::before":isMobile?{content:'""',position:"absolute",right:"12px",bottom:"12px",fontSize:"16px",color:theme.palette.primary.main,opacity:.6,transform:"rotate(-45deg)"}:{},"&amp;:hover, &amp;:active":{opacity:isMobile?1:.8,background:isMobile?`radial-gradient(circle at 70% 70%, ${alpha(theme.palette.primary.main,.5)} 0%, transparent 50%)`:void 0}}},...isViewer&amp;&amp;{"&amp; .react-grid-item":{"&amp;.react-grid-item.react-draggable":{cursor:"default !important"},"&amp; .react-resizable-handle":{display:"none !important"}}}},children:jsxRuntimeExports.jsx(ResponsiveGridLayout,{className:"layout",layouts:layouts,breakpoints:{lg:1280,md:960,sm:600,xs:480,xxs:0},cols:{lg:12,md:12,sm:12,xs:12,xxs:12},rowHeight:80,margin:[16,16],containerPadding:[0,0],isDraggable:!isViewer,isResizable:!isViewer,isBounded:!1,useCSSTransforms:!0,preventCollision:!1,compactType:"vertical",onLayoutChange:handleLayoutChange,onBreakpointChange:handleBreakpointChange,measureBeforeMount:!1,draggableCancel:".chart-no-drag",draggableHandle:".chart-drag-handle",onDragStart:(layout,oldItem,newItem)=&gt;{setDraggingId(newItem.i)},onDragStop:(layout,oldItem,newItem)=&gt;{setDraggingId(null),setTimeout(()=&gt;{window.dispatchEvent(new CustomEvent("grid-resize",{detail:{action:"drag-stop",item:newItem,timestamp:Date.now()}})),window.dispatchEvent(new Event("resize"))},50)},onResizeStart:(layout,oldItem,newItem)=&gt;{setResizingId(newItem.i)},onResizeStop:(layout,oldItem,newItem)=&gt;{setResizingId(null);const notifyChartResize=()=&gt;{window.dispatchEvent(new CustomEvent("grid-resize",{detail:{action:"resize-stop",item:newItem,timestamp:Date.now()}})),window.dispatchEvent(new Event("resize"))};notifyChartResize(),setTimeout(notifyChartResize,50),setTimeout(notifyChartResize,150),setTimeout(notifyChartResize,300),setTimeout(notifyChartResize,500)},onResize:(layout,oldItem,newItem)=&gt;{resizingId===newItem.i&amp;&amp;window.dispatchEvent(new CustomEvent("grid-resize",{detail:{action:"resizing",item:newItem,timestamp:Date.now()}}))},children:monitors.map(monitor=&gt;jsxRuntimeExports.jsxs(Box,{sx:{height:"100%",width:"100%",position:"relative",borderRadius:1,overflow:"hidden",backgroundColor:"dark"===theme.palette.mode?alpha(theme.palette.background.paper,.6):alpha(theme.palette.background.paper,.8),backdropFilter:"blur(20px) saturate(180%)",WebkitBackdropFilter:"blur(20px) saturate(180%)",border:`1px solid ${alpha(theme.palette.primary.main,.1)}`,boxShadow:`\n                0 8px 32px ${alpha("#000000",.3)},\n                inset 0 1px 0 ${alpha("#ffffff",.1)}\n              `,transition:"all 0.3s cubic-bezier(0.4, 0, 0.2, 1)","&amp;:hover":{backgroundColor:"dark"===theme.palette.mode?alpha(theme.palette.background.paper,.7):alpha(theme.palette.background.paper,.9),boxShadow:`\n                  0 12px 40px ${alpha("#000000",.4)},\n                  inset 0 1px 0 ${alpha("#ffffff",.15)},\n                  0 0 0 1px ${alpha(theme.palette.primary.main,.2)}\n                `,borderColor:alpha(theme.palette.primary.main,.3),transform:"translateY(-2px)"}},children:[!isViewer&amp;&amp;jsxRuntimeExports.jsx(Box,{className:"chart-drag-handle",sx:{position:"absolute",top:4,left:8,right:8,height:20,background:"transparent",cursor:"move",touchAction:"none",zIndex:2,display:"flex",alignItems:"center",justifyContent:"center",opacity:isMobile?.5:.3,transition:"all 0.2s ease",borderRadius:1,...isMobile&amp;&amp;{height:32,top:0},"&amp;:hover":{opacity:1,background:alpha(theme.palette.primary.main,.1)},".react-grid-item:hover &amp;":{opacity:.8}},children:jsxRuntimeExports.jsx(Box,{sx:{display:"flex",gap:"3px"},children:[0,1,2].map(i=&gt;jsxRuntimeExports.jsx(Box,{sx:{width:4,height:4,borderRadius:"50%",backgroundColor:theme.palette.primary.main,opacity:.6}},i))})}),jsxRuntimeExports.jsx(Box,{className:"grid-chart-container",sx:{position:"relative",paddingTop:"48px",width:"100%",height:"100%",minHeight:350,"&amp; &gt; div":{width:"100%",height:"100%",position:"relative"}},children:jsxRuntimeExports.jsx(UnifiedChartRenderer,{monitor:monitor,enableAutoResize:!0,height:"100%",onEdit:()=&gt;onEditMonitor(monitor),onDelete:()=&gt;onDeleteMonitor(monitor.id),onRefresh:onRefresh,onUpdate:updateMonitor})})]},monitor.id))})})},ChartWizard$2=reactExports.lazy(()=&gt;__vitePreload(()=&gt;Promise.resolve().then(()=&gt;ChartWizard$1),void 0)),ShareDashboardDialog$2=reactExports.lazy(()=&gt;__vitePreload(()=&gt;Promise.resolve().then(()=&gt;ShareDashboardDialog$1),void 0)),DashboardSettingsDialog$2=reactExports.lazy(()=&gt;__vitePreload(()=&gt;Promise.resolve().then(()=&gt;DashboardSettingsDialog$1),void 0)),MonitorFoldersDialog$2=reactExports.lazy(()=&gt;__vitePreload(()=&gt;Promise.resolve().then(()=&gt;MonitorFoldersDialog$1),void 0)),MonitorSnapshotsDialog$2=reactExports.lazy(()=&gt;__vitePreload(()=&gt;Promise.resolve().then(()=&gt;MonitorSnapshotsDialog$1),void 0)),KeyboardShortcutsDialog=reactExports.lazy(()=&gt;__vitePreload(()=&gt;import("./app-core-rH6lZf1X.js").then(n=&gt;n.ai),__vite__mapDeps([0,1,2,3,4,5,6,7,8])).then(module=&gt;({default:module.KeyboardShortcutsDialog}))),DialogLoadingFallback=()=&gt;jsxRuntimeExports.jsxs(Box,{sx:{position:"fixed",top:"50%",left:"50%",transform:"translate(-50%, -50%)",zIndex:1300,display:"flex",flexDirection:"column",alignItems:"center",gap:2},children:[jsxRuntimeExports.jsx(CircularProgress,{size:48}),jsxRuntimeExports.jsx(Box,{sx:{color:"text.secondary",fontSize:"0.875rem"},children:"Loading..."})]}),DashboardModals=({wizardOpen:wizardOpen,editingMonitor:editingMonitor,shortcutsDialogOpen:shortcutsDialogOpen,shareDialogOpen:shareDialogOpen,settingsDialogOpen:settingsDialogOpen,foldersDialogOpen:foldersDialogOpen,snapshotsDialogOpen:snapshotsDialogOpen,snapshotMonitor:snapshotMonitor,setWizardOpen:setWizardOpen,setEditingMonitor:setEditingMonitor,setShortcutsDialogOpen:setShortcutsDialogOpen,setShareDialogOpen:setShareDialogOpen,setSettingsDialogOpen:setSettingsDialogOpen,setFoldersDialogOpen:setFoldersDialogOpen,setSnapshotsDialogOpen:setSnapshotsDialogOpen,currentDashboardId:currentDashboardId,dashboardName:dashboardName,folders:folders,monitors:monitors,snapshots:snapshots,aceSites:aceSites=[],acePoints:acePoints=[],aceDataRefresh:aceDataRefresh,onMonitorCreate:onMonitorCreate,onMonitorUpdate:onMonitorUpdate,onMonitorMove:onMonitorMove,onDashboardNameChange:onDashboardNameChange,onFoldersChange:onFoldersChange,onSnapshotSave:onSnapshotSave,onSnapshotDelete:onSnapshotDelete,onSnapshotExport:onSnapshotExport,onSnapshotRestore:onSnapshotRestore})=&gt;jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[wizardOpen&amp;&amp;jsxRuntimeExports.jsx(reactExports.Suspense,{fallback:jsxRuntimeExports.jsx(DialogLoadingFallback,{}),children:jsxRuntimeExports.jsx(ChartWizard$2,{open:wizardOpen,onClose:()=&gt;{setWizardOpen(!1),setEditingMonitor(null)},onComplete:editingMonitor?onMonitorUpdate:onMonitorCreate,editingMonitor:editingMonitor,aceSites:aceSites,acePoints:acePoints,aceDataRefresh:aceDataRefresh})}),shortcutsDialogOpen&amp;&amp;jsxRuntimeExports.jsx(reactExports.Suspense,{fallback:jsxRuntimeExports.jsx(DialogLoadingFallback,{}),children:jsxRuntimeExports.jsx(KeyboardShortcutsDialog,{open:shortcutsDialogOpen,onClose:()=&gt;setShortcutsDialogOpen(!1)})}),shareDialogOpen&amp;&amp;jsxRuntimeExports.jsx(reactExports.Suspense,{fallback:jsxRuntimeExports.jsx(DialogLoadingFallback,{}),children:jsxRuntimeExports.jsx(ShareDashboardDialog$2,{dashboardId:currentDashboardId||"new",dashboardName:dashboardName,open:shareDialogOpen,onClose:()=&gt;setShareDialogOpen(!1)})}),settingsDialogOpen&amp;&amp;jsxRuntimeExports.jsx(reactExports.Suspense,{fallback:jsxRuntimeExports.jsx(DialogLoadingFallback,{}),children:jsxRuntimeExports.jsx(DashboardSettingsDialog$2,{dashboardName:dashboardName,open:settingsDialogOpen,onClose:()=&gt;setSettingsDialogOpen(!1),onSettingsChange:settings=&gt;{onDashboardNameChange(settings.name)}})}),foldersDialogOpen&amp;&amp;jsxRuntimeExports.jsx(reactExports.Suspense,{fallback:jsxRuntimeExports.jsx(DialogLoadingFallback,{}),children:jsxRuntimeExports.jsx(MonitorFoldersDialog$2,{folders:folders,monitors:monitors.map(m=&gt;({id:m.id,title:m.title})),open:foldersDialogOpen,onClose:()=&gt;setFoldersDialogOpen(!1),onFoldersChange:onFoldersChange,onMonitorMove:onMonitorMove})}),snapshotsDialogOpen&amp;&amp;jsxRuntimeExports.jsx(reactExports.Suspense,{fallback:jsxRuntimeExports.jsx(DialogLoadingFallback,{}),children:jsxRuntimeExports.jsx(MonitorSnapshotsDialog$2,{currentMonitor:snapshotMonitor?{id:snapshotMonitor.id,title:snapshotMonitor.title,data:null,timeRange:snapshotMonitor.timeRange||"24h",config:snapshotMonitor.config}:void 0,open:snapshotsDialogOpen,snapshots:snapshots,onClose:()=&gt;setSnapshotsDialogOpen(!1),onSnapshotCreate:snapshot=&gt;{onSnapshotSave(snapshot)},onSnapshotDelete:onSnapshotDelete,onSnapshotExport:onSnapshotExport,onSnapshotRestore:onSnapshotRestore})})]}),DashboardActions=({isViewer:isViewer,speedDialOpen:speedDialOpen,onSpeedDialToggle:onSpeedDialToggle,onAddMonitor:onAddMonitor,onSaveDashboard:onSaveDashboard,onShareDashboard:onShareDashboard,onOpenSettings:onOpenSettings,onOrganizeMonitors:onOrganizeMonitors,onViewSnapshots:onViewSnapshots,onShowOnboarding:onShowOnboarding})=&gt;{const actions=isViewer?[{icon:jsxRuntimeExports.jsx(Share,{}),name:"Share Dashboard",action:onShareDashboard,tooltip:" Share this dashboard with colleagues via link or email"},{icon:jsxRuntimeExports.jsx(CameraAlt,{}),name:"Take Snapshot",action:onViewSnapshots,tooltip:" Capture current dashboard state for later comparison"}]:[{icon:jsxRuntimeExports.jsx(AddIcon,{}),name:"Add Monitor",action:onAddMonitor,tooltip:" Create a new chart to visualize your building data (Ctrl+N)"},{icon:jsxRuntimeExports.jsx(SaveIcon,{}),name:"Save Dashboard",action:onSaveDashboard,tooltip:" Save your dashboard layout and configurations (Ctrl+S)"},{icon:jsxRuntimeExports.jsx(FolderIcon,{}),name:"Organize Monitors",action:onOrganizeMonitors,tooltip:" Group related charts into folders for better organization"},{icon:jsxRuntimeExports.jsx(CameraAlt,{}),name:"View Snapshots",action:onViewSnapshots,tooltip:" View and compare historical dashboard snapshots"},{icon:jsxRuntimeExports.jsx(Share,{}),name:"Share Dashboard",action:onShareDashboard},{icon:jsxRuntimeExports.jsx(SettingsIcon,{}),name:"Dashboard Settings",action:onOpenSettings},{icon:jsxRuntimeExports.jsx(HelpIcon,{}),name:"View Tutorial",action:onShowOnboarding,tooltip:" View the onboarding tutorial again"}];return jsxRuntimeExports.jsx(SpeedDial,{FabProps:{onClick:e2=&gt;{e2.stopPropagation(),onSpeedDialToggle(!speedDialOpen)}},ariaLabel:"Dashboard actions",icon:jsxRuntimeExports.jsx(SpeedDialIcon,{}),open:speedDialOpen,sx:{position:"fixed",bottom:120,right:24,zIndex:theme=&gt;theme.zIndex.speedDial||1050,"&amp; .MuiSpeedDial-fab":{background:"linear-gradient(135deg, #00E5FF 0%, #00BFA5 100%)",boxShadow:"0 4px 20px rgba(0, 229, 255, 0.4)","&amp;:hover":{background:"linear-gradient(135deg, #00E5FF 0%, #00BFA5 100%)"}}},onClose:()=&gt;onSpeedDialToggle(!1),onOpen:()=&gt;onSpeedDialToggle(!0),children:actions.map(action=&gt;jsxRuntimeExports.jsx(SpeedDialAction,{icon:action.icon,sx:{...glassEffect.light,"&amp;:hover":{...glassEffect.medium}},tooltipTitle:jsxRuntimeExports.jsxs(Box,{children:[jsxRuntimeExports.jsx(Typography$1,{variant:"body2",children:action.name}),action.tooltip&amp;&amp;jsxRuntimeExports.jsx(Typography$1,{variant:"caption",sx:{display:"block",mt:.5,opacity:.8},children:action.tooltip})]}),onClick:()=&gt;(action=&gt;{action(),onSpeedDialToggle(!1)})(action.action)},action.name))})},DashboardLoadingStates=({isLoading:isLoading,error:error,onErrorReset:onErrorReset})=&gt;isLoading?jsxRuntimeExports.jsxs(Box,{sx:{display:"flex",alignItems:"center",justifyContent:"center",height:"100vh",flexDirection:"column",gap:2},children:[jsxRuntimeExports.jsx(CircularProgress,{size:48}),jsxRuntimeExports.jsx(Typography$1,{variant:"h6",color:"text.secondary",children:"Loading Dashboard..."})]}):error?jsxRuntimeExports.jsxs(Box,{sx:{display:"flex",alignItems:"center",justifyContent:"center",height:"100vh",flexDirection:"column",gap:2,p:3},children:[jsxRuntimeExports.jsx(ErrorIcon,{sx:{fontSize:64,color:"error.main"}}),jsxRuntimeExports.jsx(Typography$1,{variant:"h5",color:"error",children:"Dashboard Error"}),jsxRuntimeExports.jsx(Alert,{severity:"error",sx:{maxWidth:600},children:jsxRuntimeExports.jsx(Typography$1,{variant:"body1",children:(null==error?void 0:error.message)||"An unexpected error occurred"})}),jsxRuntimeExports.jsx(Button,{variant:"contained",onClick:onErrorReset,children:"Reload Dashboard"})]}):null,DashboardEmptyState=({dashboards:dashboards,currentDashboardId:currentDashboardId,onDashboardChange:onDashboardChange,onCreateNewDashboard:onCreateNewDashboard})=&gt;jsxRuntimeExports.jsxs(Box,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"calc(100vh - 120px)",...glassEffect.medium,borderRadius:3,p:6,maxWidth:600,mx:"auto"},children:[jsxRuntimeExports.jsx(Dashboard,{sx:{fontSize:80,color:"primary.main",mb:3}}),jsxRuntimeExports.jsx(Typography$1,{sx:{mb:2,fontWeight:600},variant:"h4",children:"Welcome to Building Vitals "}),jsxRuntimeExports.jsx(Typography$1,{sx:{mb:4,color:"text.secondary",textAlign:"center"},variant:"body1",children:"You have existing dashboards. Select one to continue or create a new dashboard."}),jsxRuntimeExports.jsx(Box,{sx:{width:"100%",p:2,mb:3,backgroundColor:"primary.main",borderRadius:2,opacity:.1}}),jsxRuntimeExports.jsxs(Box,{sx:{width:"100%",p:3,mb:3,backgroundColor:"background.paper",borderRadius:2,border:"1px solid",borderColor:"divider",mt:-5.5},children:[jsxRuntimeExports.jsx(Typography$1,{variant:"subtitle2",sx:{mb:2,fontWeight:600},children:" Quick Start Tips:"}),jsxRuntimeExports.jsxs(Box,{sx:{display:"flex",flexDirection:"column",gap:1,ml:2},children:[jsxRuntimeExports.jsxs(Typography$1,{variant:"body2",color:"text.secondary",children:[" Press ",jsxRuntimeExports.jsx("strong",{children:"Ctrl+N"})," to quickly add a new chart"]}),jsxRuntimeExports.jsx(Typography$1,{variant:"body2",color:"text.secondary",children:" Drag and resize charts to customize your layout"}),jsxRuntimeExports.jsx(Typography$1,{variant:"body2",color:"text.secondary",children:" Use keyboard shortcuts for quick navigation"}),jsxRuntimeExports.jsxs(Typography$1,{variant:"body2",color:"text.secondary",children:[" Press ",jsxRuntimeExports.jsx("strong",{children:"?"})," to see all keyboard shortcuts"]})]})]}),jsxRuntimeExports.jsxs(Box,{sx:{display:"flex",gap:2,flexDirection:"column",width:"100%",maxWidth:400},children:[jsxRuntimeExports.jsxs(FormControl,{fullWidth:!0,children:[jsxRuntimeExports.jsx(InputLabel,{children:"Select Dashboard"}),jsxRuntimeExports.jsx(Select,{label:"Select Dashboard",value:currentDashboardId,onChange:e2=&gt;onDashboardChange(e2.target.value),children:dashboards.map(dashboard=&gt;jsxRuntimeExports.jsx(MenuItem,{value:dashboard.id,children:dashboard.name},dashboard.id))})]}),jsxRuntimeExports.jsx(Button,{fullWidth:!0,size:"large",startIcon:jsxRuntimeExports.jsx(AddIcon,{}),variant:"contained",onClick:onCreateNewDashboard,children:"Create New Dashboard"})]})]}),pulse=keyframes`</span>
<span class="cstat-no" title="statement not covered" >  0%, 100% {</span>
<span class="cstat-no" title="statement not covered" >    transform: scale(1);</span>
<span class="cstat-no" title="statement not covered" >    opacity: 1;</span>
<span class="cstat-no" title="statement not covered" >  }</span>
<span class="cstat-no" title="statement not covered" >  50% {</span>
<span class="cstat-no" title="statement not covered" >    transform: scale(1.05);</span>
<span class="cstat-no" title="statement not covered" >    opacity: 0.8;</span>
<span class="cstat-no" title="statement not covered" >  }</span>
<span class="cstat-no" title="statement not covered" >`,rotate=keyframes`</span>
<span class="cstat-no" title="statement not covered" >  from {</span>
<span class="cstat-no" title="statement not covered" >    transform: rotate(0deg);</span>
<span class="cstat-no" title="statement not covered" >  }</span>
<span class="cstat-no" title="statement not covered" >  to {</span>
<span class="cstat-no" title="statement not covered" >    transform: rotate(360deg);</span>
<span class="cstat-no" title="statement not covered" >  }</span>
<span class="cstat-no" title="statement not covered" >`,shimmer=keyframes`</span>
<span class="cstat-no" title="statement not covered" >  0% {</span>
<span class="cstat-no" title="statement not covered" >    background-position: -200% 0;</span>
<span class="cstat-no" title="statement not covered" >  }</span>
<span class="cstat-no" title="statement not covered" >  100% {</span>
<span class="cstat-no" title="statement not covered" >    background-position: 200% 0;</span>
<span class="cstat-no" title="statement not covered" >  }</span>
<span class="cstat-no" title="statement not covered" >`,DEFAULT_METRICS={apiLatency:{value:124,unit:"ms",trend:"down",status:"good"},dataFreshness:{value:2.5,unit:"min",trend:"stable",status:"good"},cacheHitRate:{value:87,unit:"%",trend:"up",status:"good"},activeConnections:{value:12,unit:"",status:"good"},errorRate:{value:.2,unit:"%",trend:"down",status:"good"},throughput:{value:1250,unit:"req/s",trend:"up",status:"good"}},GAUGE_CONFIGS={apiLatency:{icon:jsxRuntimeExports.jsx(Speed,{}),label:"API Latency",thresholds:{good:200,warning:500},max:1e3,format:value=&gt;`${value}ms`},dataFreshness:{icon:jsxRuntimeExports.jsx(TimerIcon,{}),label:"Data Freshness",thresholds:{good:5,warning:15},max:30,format:value=&gt;`${value.toFixed(1)}min`},cacheHitRate:{icon:jsxRuntimeExports.jsx(StorageIcon,{}),label:"Cache Hit Rate",thresholds:{warning:70,good:85},max:100,format:value=&gt;`${value}%`},activeConnections:{icon:jsxRuntimeExports.jsx(NetworkCheckIcon,{}),label:"Active Connections",thresholds:{good:50,warning:100},max:150,format:value=&gt;value.toString()},errorRate:{icon:jsxRuntimeExports.jsx(WarningIcon,{}),label:"Error Rate",thresholds:{good:1,warning:5},max:10,format:value=&gt;`${value.toFixed(1)}%`,inverse:!0},throughput:{icon:jsxRuntimeExports.jsx(TrendingUp,{}),label:"Throughput",thresholds:{warning:500,good:1e3},max:2e3,format:value=&gt;`${value} req/s`}},PerformanceIndicators=({metrics:metrics={},onRefresh:onRefresh,compact:compact=!1,showTrends:showTrends=!0,updateInterval:updateInterval=3e4})=&gt;{const theme=useTheme(),[isRefreshing,setIsRefreshing]=reactExports.useState(!1),[lastUpdate,setLastUpdate]=reactExports.useState(new Date),[animatedMetrics,setAnimatedMetrics]=reactExports.useState(DEFAULT_METRICS),mergedMetrics={...DEFAULT_METRICS,...metrics};reactExports.useEffect(()=&gt;{const interval=setInterval(()=&gt;{setLastUpdate(new Date)},updateInterval);return()=&gt;clearInterval(interval)},[updateInterval]),reactExports.useEffect(()=&gt;{Object.keys(mergedMetrics).forEach(key=&gt;{const startValue=animatedMetrics[key].value,endValue=mergedMetrics[key].value;let currentStep=0;const animationInterval=setInterval(()=&gt;{currentStep++;const progress=currentStep/20,easedProgress=1-Math.pow(1-progress,3);setAnimatedMetrics(prev=&gt;({...prev,[key]:{...mergedMetrics[key],value:startValue+(endValue-startValue)*easedProgress}})),currentStep&gt;=20&amp;&amp;clearInterval(animationInterval)},30)})},[metrics]);const getStatusColor=status=&gt;{switch(status){case"good":return theme.palette.success.main;case"warning":return theme.palette.warning.main;case"error":return theme.palette.error.main;default:return theme.palette.text.secondary}},getTrendIcon=trend=&gt;{switch(trend){case"up":return jsxRuntimeExports.jsx(TrendingUp,{sx:{fontSize:16}});case"down":return jsxRuntimeExports.jsx(TrendingDownIcon,{sx:{fontSize:16}});default:return null}},renderGauge=(key,metric)=&gt;{const config=GAUGE_CONFIGS[key],percentage=metric.value/config.max*100,rotation=percentage/100*270-135;return jsxRuntimeExports.jsxs(Paper,{sx:{p:compact?1.5:2,textAlign:"center",backgroundColor:alpha(theme.palette.background.paper,.8),backdropFilter:"blur(20px)",WebkitBackdropFilter:"blur(20px)",border:`1px solid ${alpha(theme.palette.divider,.1)}`,borderRadius:2,position:"relative",overflow:"hidden",transition:"all 0.3s ease","&amp;:hover":{transform:"translateY(-2px)",boxShadow:`0 8px 32px ${alpha(getStatusColor(metric.status),.2)}`}},children:[jsxRuntimeExports.jsx(Box,{sx:{position:"absolute",top:0,left:0,right:0,height:3,background:`linear-gradient(90deg, transparent 0%, ${alpha(getStatusColor(metric.status),.3)} 50%, transparent 100%)`,backgroundSize:"200% 100%",animation:`${shimmer} 3s linear infinite`}}),jsxRuntimeExports.jsxs(Box,{sx:{position:"relative",mb:compact?1:2},children:[jsxRuntimeExports.jsxs(Box,{sx:{width:compact?60:80,height:compact?60:80,margin:"0 auto",position:"relative"},children:[jsxRuntimeExports.jsx("svg",{width:compact?60:80,height:compact?60:80,style:{position:"absolute",transform:"rotate(-45deg)"},children:jsxRuntimeExports.jsx("circle",{cx:compact?30:40,cy:compact?30:40,r:compact?25:35,fill:"none",stroke:alpha(theme.palette.divider,.2),strokeWidth:compact?4:6,strokeDasharray:`${Math.PI*(compact?50:70)*.75} ${Math.PI*(compact?50:70)*.25}`})}),jsxRuntimeExports.jsx("svg",{width:compact?60:80,height:compact?60:80,style:{position:"absolute",transform:"rotate(-45deg)",transition:"all 0.5s ease"},children:jsxRuntimeExports.jsx("circle",{cx:compact?30:40,cy:compact?30:40,r:compact?25:35,fill:"none",stroke:getStatusColor(metric.status),strokeWidth:compact?4:6,strokeDasharray:`${Math.PI*(compact?50:70)*.75*(percentage/100)} ${Math.PI*(compact?50:70)}`,strokeLinecap:"round"})}),jsxRuntimeExports.jsx(Box,{sx:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",color:getStatusColor(metric.status)},children:React.cloneElement(config.icon,{fontSize:compact?"small":"medium"})})]}),jsxRuntimeExports.jsx(Box,{sx:{position:"absolute",top:"50%",left:"50%",width:2,height:compact?20:30,backgroundColor:getStatusColor(metric.status),transformOrigin:"bottom center",transform:`translate(-50%, -100%) rotate(${rotation}deg)`,transition:"transform 0.5s ease","&amp;::after":{content:'""',position:"absolute",bottom:-4,left:"50%",transform:"translateX(-50%)",width:8,height:8,borderRadius:"50%",backgroundColor:getStatusColor(metric.status)}}})]}),jsxRuntimeExports.jsx(Typography$1,{variant:compact?"caption":"body2",sx:{opacity:.7},children:config.label}),jsxRuntimeExports.jsxs(Typography$1,{variant:compact?"body2":"h6",sx:{fontWeight:600,color:getStatusColor(metric.status),display:"flex",alignItems:"center",justifyContent:"center",gap:.5},children:[config.format(animatedMetrics[key].value),showTrends&amp;&amp;metric.trend&amp;&amp;jsxRuntimeExports.jsx(Box,{sx:{color:"up"===metric.trend?theme.palette.success.main:theme.palette.error.main},children:getTrendIcon(metric.trend)})]})]})},renderCompactIndicator=(key,metric)=&gt;{const config=GAUGE_CONFIGS[key],percentage=metric.value/config.max*100;return jsxRuntimeExports.jsx(Tooltip,{title:`${config.label}: ${config.format(metric.value)}`,children:jsxRuntimeExports.jsxs(Box,{sx:{display:"flex",alignItems:"center",gap:1,p:1,borderRadius:1,backgroundColor:alpha(theme.palette.background.paper,.6),backdropFilter:"blur(10px)",WebkitBackdropFilter:"blur(10px)",border:`1px solid ${alpha(theme.palette.divider,.1)}`,cursor:"pointer",transition:"all 0.2s ease","&amp;:hover":{backgroundColor:alpha(theme.palette.background.paper,.8),transform:"scale(1.02)"}},children:[jsxRuntimeExports.jsx(Box,{sx:{color:getStatusColor(metric.status)},children:React.cloneElement(config.icon,{fontSize:"small"})}),jsxRuntimeExports.jsx(Box,{sx:{flex:1},children:jsxRuntimeExports.jsx(LinearProgress,{variant:"determinate",value:Math.min(percentage,100),sx:{height:4,borderRadius:2,backgroundColor:alpha(theme.palette.divider,.1),"&amp; .MuiLinearProgress-bar":{backgroundColor:getStatusColor(metric.status),borderRadius:2}}})}),jsxRuntimeExports.jsx(Typography$1,{variant:"caption",sx:{fontWeight:600,minWidth:50,textAlign:"right"},children:config.format(metric.value)})]})})};return jsxRuntimeExports.jsxs(Box,{children:[jsxRuntimeExports.jsxs(Box,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:2},children:[jsxRuntimeExports.jsxs(Typography$1,{variant:"h6",sx:{display:"flex",alignItems:"center",gap:1},children:[jsxRuntimeExports.jsx(Speed,{}),"Performance Metrics"]}),jsxRuntimeExports.jsxs(Box,{sx:{display:"flex",alignItems:"center",gap:1},children:[jsxRuntimeExports.jsx(Chip,{icon:jsxRuntimeExports.jsx(SyncIcon,{sx:{fontSize:16}}),label:`Updated ${Math.floor(((new Date).getTime()-lastUpdate.getTime())/1e3)}s ago`,size:"small",sx:{backgroundColor:alpha(theme.palette.info.main,.1),color:theme.palette.info.main}}),onRefresh&amp;&amp;jsxRuntimeExports.jsx(IconButton,{size:"small",onClick:async()=&gt;{setIsRefreshing(!0),await(null==onRefresh?void 0:onRefresh()),setTimeout(()=&gt;setIsRefreshing(!1),1e3)},disabled:isRefreshing,sx:{animation:isRefreshing?`${rotate} 1s linear infinite`:"none"},children:jsxRuntimeExports.jsx(Refresh,{})})]})]}),compact?jsxRuntimeExports.jsx(Box,{sx:{display:"flex",flexDirection:"column",gap:1},children:Object.entries(animatedMetrics).map(([key,metric])=&gt;jsxRuntimeExports.jsx(Fade,{in:!0,timeout:300,children:jsxRuntimeExports.jsx(Box,{children:renderCompactIndicator(key,metric)})},key))}):jsxRuntimeExports.jsx(Grid,{container:!0,spacing:2,children:Object.entries(animatedMetrics).map(([key,metric],index2)=&gt;jsxRuntimeExports.jsx(Grid,{item:!0,xs:12,sm:6,md:4,children:jsxRuntimeExports.jsx(Zoom,{in:!0,timeout:300+100*index2,children:jsxRuntimeExports.jsx(Box,{children:renderGauge(key,metric)})})},key))}),jsxRuntimeExports.jsxs(Box,{sx:{mt:3,p:2,borderRadius:2,backgroundColor:alpha(theme.palette.background.paper,.6),backdropFilter:"blur(10px)",WebkitBackdropFilter:"blur(10px)",border:`1px solid ${alpha(theme.palette.divider,.1)}`,display:"flex",alignItems:"center",justifyContent:"space-between"},children:[jsxRuntimeExports.jsxs(Box,{sx:{display:"flex",alignItems:"center",gap:2},children:[jsxRuntimeExports.jsx(Box,{sx:{p:1,borderRadius:"50%",backgroundColor:alpha(theme.palette.success.main,.1),color:theme.palette.success.main,animation:`${pulse} 2s ease-in-out infinite`},children:jsxRuntimeExports.jsx(CheckCircleIcon,{})}),jsxRuntimeExports.jsxs(Box,{children:[jsxRuntimeExports.jsx(Typography$1,{variant:"body2",sx:{fontWeight:600},children:"System Status: Operational"}),jsxRuntimeExports.jsx(Typography$1,{variant:"caption",sx:{opacity:.7},children:"All systems functioning within normal parameters"})]})]}),jsxRuntimeExports.jsxs(Box,{sx:{display:"flex",gap:1},children:[jsxRuntimeExports.jsx(Tooltip,{title:"Network Status",children:jsxRuntimeExports.jsx(Chip,{icon:jsxRuntimeExports.jsx(SignalIcon,{}),label:"Strong",size:"small",color:"success",variant:"outlined"})}),jsxRuntimeExports.jsx(Tooltip,{title:"Cloud Sync",children:jsxRuntimeExports.jsx(Chip,{icon:jsxRuntimeExports.jsx(CloudIcon,{}),label:"Synced",size:"small",color:"info",variant:"outlined"})}),jsxRuntimeExports.jsx(Tooltip,{title:"System Health",children:jsxRuntimeExports.jsx(Chip,{icon:jsxRuntimeExports.jsx(BatteryIcon,{}),label:"98%",size:"small",color:"success",variant:"outlined"})})]})]})]})},NetworkStatusIndicator=({status:status,latency:latency,compact:compact=!1})=&gt;{const theme=useTheme(),config=(()=&gt;{switch(status){case"online":return{color:theme.palette.success.main,icon:jsxRuntimeExports.jsx(SignalIcon,{}),label:"Online",description:latency?`${latency}ms`:"Connected"};case"offline":return{color:theme.palette.error.main,icon:jsxRuntimeExports.jsx(SignalIcon,{}),label:"Offline",description:"No connection"};case"slow":return{color:theme.palette.warning.main,icon:jsxRuntimeExports.jsx(SignalIcon,{}),label:"Slow",description:"High latency"}}})();return compact?jsxRuntimeExports.jsx(Tooltip,{title:`${config.label}: ${config.description}`,children:jsxRuntimeExports.jsxs(Box,{sx:{display:"inline-flex",alignItems:"center",gap:.5,color:config.color},children:[config.icon,jsxRuntimeExports.jsx(Box,{sx:{width:8,height:8,borderRadius:"50%",backgroundColor:config.color,animation:"online"===status?`${pulse} 2s ease-in-out infinite`:"none"}})]})}):jsxRuntimeExports.jsxs(Paper,{sx:{p:2,display:"flex",alignItems:"center",gap:2,backgroundColor:alpha(theme.palette.background.paper,.8),backdropFilter:"blur(20px)",WebkitBackdropFilter:"blur(20px)",border:`1px solid ${alpha(config.color,.3)}`,borderRadius:2},children:[jsxRuntimeExports.jsx(Box,{sx:{color:config.color},children:config.icon}),jsxRuntimeExports.jsxs(Box,{children:[jsxRuntimeExports.jsx(Typography$1,{variant:"body2",sx:{fontWeight:600},children:config.label}),jsxRuntimeExports.jsx(Typography$1,{variant:"caption",sx:{opacity:.7},children:config.description})]})]})},DashboardPerformance=({showPerformance:showPerformance,performanceMetrics:performanceMetrics,onRefresh:onRefresh,isMobile:isMobile,isTablet:isTablet,monitorsCount:monitorsCount})=&gt;jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[showPerformance&amp;&amp;!isMobile&amp;&amp;monitorsCount&gt;0&amp;&amp;jsxRuntimeExports.jsx(Box,{sx:{mb:3},children:jsxRuntimeExports.jsx(PerformanceIndicators,{metrics:performanceMetrics,onRefresh:onRefresh,compact:isTablet,showTrends:!0,updateInterval:3e4})}),isMobile&amp;&amp;jsxRuntimeExports.jsx(Box,{sx:{position:"fixed",top:16,right:16,zIndex:1e3},children:jsxRuntimeExports.jsx(NetworkStatusIndicator,{status:"online",latency:124,compact:!0})})]}),EmptyDashboardState=({isViewer:isViewer,onAddMonitor:onAddMonitor})=&gt;jsxRuntimeExports.jsxs(Box,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"calc(100vh - 120px)",...glassEffect.medium,borderRadius:3,p:6,maxWidth:600,mx:"auto"},children:[jsxRuntimeExports.jsx(Dashboard,{sx:{fontSize:80,color:"primary.main",mb:3}}),jsxRuntimeExports.jsx(Typography$1,{sx:{mb:2,fontWeight:600},variant:"h4",children:isViewer?"No Monitors Yet":"Let's Build Your Dashboard! "}),jsxRuntimeExports.jsx(Typography$1,{sx:{mb:2,color:"text.secondary",textAlign:"center"},variant:"body1",children:isViewer?"No monitors have been configured for this dashboard yet. Contact your administrator to add monitors.":"Start building your dashboard by adding monitors to visualize your building data"}),!isViewer&amp;&amp;jsxRuntimeExports.jsxs(Box,{sx:{width:"100%",maxWidth:500,mb:4,p:3,backgroundColor:"background.paper",borderRadius:2,border:"1px solid",borderColor:"divider"},children:[jsxRuntimeExports.jsx(Typography$1,{variant:"subtitle2",sx:{mb:2,fontWeight:600},children:" Getting Started Guide:"}),jsxRuntimeExports.jsxs(Box,{sx:{display:"flex",flexDirection:"column",gap:2},children:[jsxRuntimeExports.jsxs(Box,{sx:{display:"flex",alignItems:"flex-start",gap:2},children:[jsxRuntimeExports.jsx(Typography$1,{variant:"body2",sx:{fontWeight:600,color:"primary.main"},children:"1."}),jsxRuntimeExports.jsxs(Box,{children:[jsxRuntimeExports.jsx(Typography$1,{variant:"body2",sx:{fontWeight:500},children:'Click "Add First Monitor"'}),jsxRuntimeExports.jsx(Typography$1,{variant:"caption",color:"text.secondary",children:"Or press Ctrl+N to open the chart wizard"})]})]}),jsxRuntimeExports.jsxs(Box,{sx:{display:"flex",alignItems:"flex-start",gap:2},children:[jsxRuntimeExports.jsx(Typography$1,{variant:"body2",sx:{fontWeight:600,color:"primary.main"},children:"2."}),jsxRuntimeExports.jsxs(Box,{children:[jsxRuntimeExports.jsx(Typography$1,{variant:"body2",sx:{fontWeight:500},children:"Select your site and data points"}),jsxRuntimeExports.jsx(Typography$1,{variant:"caption",color:"text.secondary",children:"Choose from temperature, humidity, energy, and more"})]})]}),jsxRuntimeExports.jsxs(Box,{sx:{display:"flex",alignItems:"flex-start",gap:2},children:[jsxRuntimeExports.jsx(Typography$1,{variant:"body2",sx:{fontWeight:600,color:"primary.main"},children:"3."}),jsxRuntimeExports.jsxs(Box,{children:[jsxRuntimeExports.jsx(Typography$1,{variant:"body2",sx:{fontWeight:500},children:"Pick a chart type"}),jsxRuntimeExports.jsx(Typography$1,{variant:"caption",color:"text.secondary",children:"Time series, heatmaps, gauges, and 15+ more options"})]})]})]})]}),!isViewer&amp;&amp;jsxRuntimeExports.jsx(Button,{size:"large",startIcon:jsxRuntimeExports.jsx(AddIcon,{}),sx:{px:4,py:1.5,fontSize:"1rem"},variant:"contained",onClick:onAddMonitor,children:"Add First Monitor"})]}),OptimisticUpdateNotification=({open:open,status:status,message:message,onClose:onClose,onRetry:onRetry,actionLabel:actionLabel="Retry",autoHideDuration:autoHideDuration=6e3})=&gt;{const[showProgress,setShowProgress]=reactExports.useState(!1);reactExports.useEffect(()=&gt;{if("pending"===status){const timer=setTimeout(()=&gt;setShowProgress(!0),300);return()=&gt;clearTimeout(timer)}setShowProgress(!1)},[status]);return jsxRuntimeExports.jsx(Snackbar,{open:open,autoHideDuration:"pending"===status?null:autoHideDuration,onClose:onClose,anchorOrigin:{vertical:"bottom",horizontal:"left"},children:jsxRuntimeExports.jsxs(Alert,{onClose:onClose,severity:(()=&gt;{switch(status){case"success":return"success";case"error":return"error";default:return"info"}})(),icon:(()=&gt;{switch(status){case"success":return jsxRuntimeExports.jsx(Check,{});case"error":return jsxRuntimeExports.jsx(ErrorIcon,{});default:return showProgress?jsxRuntimeExports.jsx(CircularProgress,{size:20}):null}})(),action:"error"===status&amp;&amp;onRetry?jsxRuntimeExports.jsx(Button,{color:"inherit",size:"small",startIcon:jsxRuntimeExports.jsx(Refresh,{}),onClick:onRetry,children:actionLabel}):void 0,sx:{minWidth:300,"&amp; .MuiAlert-icon":{alignItems:"center"}},children:[jsxRuntimeExports.jsx(AlertTitle,{children:(()=&gt;{switch(status){case"success":return"Success";case"error":return"Error";default:return"Saving..."}})()}),message]})})},useOptimisticNotification=()=&gt;{const[notification,setNotification]=reactExports.useState({open:!1,status:"pending",message:""});return{notification:notification,showPending:message=&gt;{setNotification({open:!0,status:"pending",message:message})},showSuccess:message=&gt;{setNotification({open:!0,status:"success",message:message})},showError:message=&gt;{setNotification({open:!0,status:"error",message:message})},hide:()=&gt;{setNotification(prev=&gt;({...prev,open:!1}))}}},OptimisticNotifications=({autoHideDuration:autoHideDuration=4e3})=&gt;{const{loadingState:loadingState,errorState:errorState,setErrorState:setErrorState}=useDashboardContext(),handleCloseError=()=&gt;{setErrorState(prev=&gt;({...prev,general:null}))},operationStatus=loadingState.creatingMonitor?{type:"loading",message:"Creating monitor..."}:loadingState.updatingMonitor?{type:"loading",message:"Updating monitor..."}:loadingState.deletingMonitor?{type:"loading",message:"Deleting monitor..."}:loadingState.creatingFolder?{type:"loading",message:"Creating folder..."}:loadingState.updatingFolder?{type:"loading",message:"Updating folder..."}:loadingState.deletingFolder?{type:"loading",message:"Deleting folder..."}:loadingState.savingDashboard?{type:"loading",message:"Saving dashboard..."}:null,hasError=errorState.general;return jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[operationStatus&amp;&amp;jsxRuntimeExports.jsx(Snackbar,{open:!0,anchorOrigin:{vertical:"bottom",horizontal:"right"},TransitionComponent:Fade,children:jsxRuntimeExports.jsxs(Alert,{severity:"info",variant:"filled",icon:jsxRuntimeExports.jsx(Box,{display:"flex",alignItems:"center",children:jsxRuntimeExports.jsx(CircularProgress,{size:20,color:"inherit"})}),sx:{backgroundColor:"#1976d2",color:"white"},children:[jsxRuntimeExports.jsx(AlertTitle,{children:"Processing"}),operationStatus.message]})}),jsxRuntimeExports.jsx(Snackbar,{open:!!hasError,autoHideDuration:autoHideDuration+2e3,onClose:handleCloseError,anchorOrigin:{vertical:"bottom",horizontal:"right"},TransitionComponent:Fade,children:jsxRuntimeExports.jsxs(Alert,{onClose:handleCloseError,severity:"error",variant:"filled",icon:jsxRuntimeExports.jsx(ErrorIcon,{}),sx:{backgroundColor:"#d32f2f",color:"white"},children:[jsxRuntimeExports.jsx(AlertTitle,{children:"Operation Failed"}),(null==hasError?void 0:hasError.message)||"An unexpected error occurred"]})})]})},SlideTransition=React.forwardRef(function Transition2(props,ref){return jsxRuntimeExports.jsx(Slide,{direction:"up",ref:ref,...props})}),ConfirmationDialog=({open:open,config:config,onConfirm:onConfirm,onCancel:onCancel,loading:loading=!1})=&gt;{const[doubleConfirmStep,setDoubleConfirmStep]=reactExports.useState(!1),[confirmationText,setConfirmationText]=reactExports.useState(""),styles=((type,destructive)=&gt;{const styles={delete:{icon:jsxRuntimeExports.jsx(Delete,{}),color:"#FF5252",bgColor:"rgba(255, 82, 82, 0.1)",borderColor:"rgba(255, 82, 82, 0.3)"},save:{icon:jsxRuntimeExports.jsx(SaveIcon,{}),color:"#4CAF50",bgColor:"rgba(76, 175, 80, 0.1)",borderColor:"rgba(76, 175, 80, 0.3)"},discard:{icon:jsxRuntimeExports.jsx(ErrorIcon,{}),color:"#FF9800",bgColor:"rgba(255, 152, 0, 0.1)",borderColor:"rgba(255, 152, 0, 0.3)"},reset:{icon:jsxRuntimeExports.jsx(Refresh,{}),color:"#00E5FF",bgColor:"rgba(0, 229, 255, 0.1)",borderColor:"rgba(0, 229, 255, 0.3)"},warning:{icon:jsxRuntimeExports.jsx(WarningIcon,{}),color:"#FF9800",bgColor:"rgba(255, 152, 0, 0.1)",borderColor:"rgba(255, 152, 0, 0.3)"},info:{icon:jsxRuntimeExports.jsx(CheckCircleIcon,{}),color:"#00E5FF",bgColor:"rgba(0, 229, 255, 0.1)",borderColor:"rgba(0, 229, 255, 0.3)"}},style=styles[type]||styles.info;return destructive?{...style,color:"#FF5252",bgColor:"rgba(255, 82, 82, 0.1)",borderColor:"rgba(255, 82, 82, 0.3)"}:style})(config.type,config.destructive),handleClose=reactExports.useCallback(()=&gt;{loading||(setDoubleConfirmStep(!1),setConfirmationText(""),onCancel({confirmed:!1,metadata:config.metadata}))},[loading,onCancel,config.metadata]),handleConfirm=reactExports.useCallback(()=&gt;{loading||(!config.requireDoubleConfirm||doubleConfirmStep?(setDoubleConfirmStep(!1),setConfirmationText(""),onConfirm({confirmed:!0,metadata:config.metadata})):setDoubleConfirmStep(!0))},[loading,config.requireDoubleConfirm,doubleConfirmStep,onConfirm,config.metadata]),isDoubleConfirmReady=!config.requireDoubleConfirm||doubleConfirmStep&amp;&amp;"confirm"===confirmationText.toLowerCase();return jsxRuntimeExports.jsxs(Dialog,{open:open,onClose:handleClose,TransitionComponent:SlideTransition,maxWidth:"sm",fullWidth:!0,PaperProps:{sx:{...glassEffect.strong,backgroundColor:styles.bgColor,border:`1px solid ${styles.borderColor}`,borderRadius:3,backdropFilter:"blur(20px)","&amp;::before":{content:'""',position:"absolute",top:0,left:0,right:0,height:"4px",background:`linear-gradient(90deg, ${styles.color}, transparent)`,borderRadius:"12px 12px 0 0"}}},BackdropProps:{sx:{backgroundColor:"rgba(0, 0, 0, 0.8)",backdropFilter:"blur(8px)"}},children:[jsxRuntimeExports.jsxs(DialogTitle,{sx:{display:"flex",alignItems:"center",gap:2,pb:1,pr:1},children:[jsxRuntimeExports.jsx(Box,{sx:{display:"flex",alignItems:"center",justifyContent:"center",width:48,height:48,borderRadius:"50%",backgroundColor:`${styles.color}20`,color:styles.color,filter:`drop-shadow(0 0 12px ${styles.color}40)`},children:styles.icon}),jsxRuntimeExports.jsx(Typography$1,{variant:"h6",sx:{flex:1,fontWeight:600,color:styles.color},children:config.title}),jsxRuntimeExports.jsx(IconButton,{onClick:handleClose,disabled:loading,sx:{color:"rgba(255, 255, 255, 0.7)","&amp;:hover":{color:"rgba(255, 255, 255, 0.9)",backgroundColor:"rgba(255, 255, 255, 0.1)"}},children:jsxRuntimeExports.jsx(Close,{})})]}),jsxRuntimeExports.jsxs(DialogContent,{sx:{pb:2},children:[jsxRuntimeExports.jsx(Typography$1,{variant:"body1",sx:{color:"rgba(255, 255, 255, 0.9)",lineHeight:1.6,mb:config.details?2:0},children:config.message}),config.details&amp;&amp;jsxRuntimeExports.jsx(Alert,{severity:config.destructive?"error":"info",sx:{backgroundColor:`${styles.color}10`,border:`1px solid ${styles.color}30`,"&amp; .MuiAlert-icon":{color:styles.color}},children:jsxRuntimeExports.jsx(Typography$1,{variant:"body2",children:config.details})}),config.requireDoubleConfirm&amp;&amp;doubleConfirmStep&amp;&amp;jsxRuntimeExports.jsx(Fade,{in:doubleConfirmStep,children:jsxRuntimeExports.jsxs(Box,{sx:{mt:3},children:[jsxRuntimeExports.jsx(Typography$1,{variant:"body2",sx:{mb:2,color:"rgba(255, 255, 255, 0.8)",fontWeight:500},children:'Type "confirm" to proceed:'}),jsxRuntimeExports.jsx("input",{type:"text",value:confirmationText,onChange:e2=&gt;setConfirmationText(e2.target.value),placeholder:"Type 'confirm' here",style:{width:"100%",padding:"12px 16px",borderRadius:"8px",border:`1px solid ${styles.color}40`,backgroundColor:"rgba(255, 255, 255, 0.05)",color:"rgba(255, 255, 255, 0.9)",fontSize:"14px",outline:"none"},autoFocus:!0})]})})]}),jsxRuntimeExports.jsxs(DialogActions,{sx:{p:3,pt:1},children:[!1!==config.showCancel&amp;&amp;jsxRuntimeExports.jsx(Button,{onClick:handleClose,disabled:loading,sx:{color:"rgba(255, 255, 255, 0.7)",borderColor:"rgba(255, 255, 255, 0.3)","&amp;:hover":{borderColor:"rgba(255, 255, 255, 0.5)",backgroundColor:"rgba(255, 255, 255, 0.05)"}},variant:"outlined",children:config.cancelLabel||"Cancel"}),jsxRuntimeExports.jsx(Button,{onClick:handleConfirm,disabled:loading||!isDoubleConfirmReady,variant:"contained",sx:{background:`linear-gradient(135deg, ${styles.color} 0%, ${styles.color}DD 100%)`,boxShadow:`0 8px 32px ${styles.color}40`,"&amp;:hover":{background:`linear-gradient(135deg, ${styles.color}DD 0%, ${styles.color} 100%)`,boxShadow:`0 12px 40px ${styles.color}60`},"&amp;:disabled":{background:"rgba(255, 255, 255, 0.1)",color:"rgba(255, 255, 255, 0.3)"}},children:loading?"Processing...":doubleConfirmStep?"Confirm Action":config.confirmLabel||"Confirm"})]})]})},ConfirmationContext=React.createContext(null),ConfirmationProvider=({children:children})=&gt;{const[confirmation,setConfirmation]=reactExports.useState(null),[loading,setLoading]=reactExports.useState(!1),showConfirmation=reactExports.useCallback(config=&gt;new Promise(resolve=&gt;{setConfirmation({config:config,resolve:resolve})}),[]),handleConfirm=reactExports.useCallback(result=&gt;{confirmation&amp;&amp;(setLoading(!0),setTimeout(()=&gt;{confirmation.resolve(!0),setConfirmation(null),setLoading(!1)},300))},[confirmation]),handleCancel=reactExports.useCallback(result=&gt;{confirmation&amp;&amp;(confirmation.resolve(!1),setConfirmation(null),setLoading(!1))},[confirmation]),contextValue={showConfirmation:showConfirmation};return jsxRuntimeExports.jsxs(ConfirmationContext.Provider,{value:contextValue,children:[children,confirmation&amp;&amp;jsxRuntimeExports.jsx(ConfirmationDialog,{open:!!confirmation,config:confirmation.config,onConfirm:handleConfirm,onCancel:handleCancel,loading:loading})]})},FeedbackProvider=({children:children,notificationConfig:notificationConfig={}})=&gt;React.createElement(NotificationProvider,notificationConfig,React.createElement(ConfirmationProvider,null,children)),DEFAULT_SETTINGS={enableRealTimeFeatures:!0,enableSSEStreaming:!1,enableAutoRefresh:!0,minRefreshInterval:30,maxLiveChartsPerUser:5,maxPointsPerLiveChart:10,maxSSEConnectionsPerUser:3,defaultRefreshMode:"interval",defaultRefreshInterval:300,allowUserOverride:!0,requireAdminApprovalForLive:!1,autoDisableOnCostThreshold:!0,monthlyApiCallLimit:1e6,dailyApiCallLimit:5e4,costWarningThreshold:100},SystemSettings=()=&gt;{var _a;const[settings,setSettings]=reactExports.useState(DEFAULT_SETTINGS),[_loading,setLoading]=reactExports.useState(!0),[saving,setSaving]=reactExports.useState(!1),[showResetDialog,setShowResetDialog]=reactExports.useState(!1),[saveMessage,setSaveMessage]=reactExports.useState(null),{firebaseUser:firebaseUser}=useAppSelector(state=&gt;state.auth),{userProfile:userProfile}=useAppSelector(state=&gt;state.auth),isAdmin="admin"===(null==userProfile?void 0:userProfile.role);reactExports.useEffect(()=&gt;{loadSettings()},[]);const loadSettings=async()=&gt;{try{setLoading(!0);const settingsDoc=await getDoc(doc(db,"systemSettings","realTimeConfig"));settingsDoc.exists()?setSettings({...DEFAULT_SETTINGS,...settingsDoc.data()}):await saveSettings(DEFAULT_SETTINGS)}catch(error){debugService.error("SystemSettings","Failed to load settings",error)}finally{setLoading(!1)}},saveSettings=async newSettings=&gt;{try{setSaving(!0),await setDoc(doc(db,"systemSettings","realTimeConfig"),{...newSettings,updatedAt:(new Date).toISOString(),updatedBy:null==firebaseUser?void 0:firebaseUser.email}),setSaveMessage({type:"success",text:"Settings saved successfully"}),!newSettings.enableRealTimeFeatures&amp;&amp;settings.enableRealTimeFeatures&amp;&amp;debugService.info("SystemSettings","Real-time features disabled globally")}catch(error){debugService.error("SystemSettings","Failed to save settings",error),setSaveMessage({type:"error",text:"Failed to save settings"})}finally{setSaving(!1),setTimeout(()=&gt;setSaveMessage(null),3e3)}},handleChange=(field,value)=&gt;{const updatedSettings={...settings,[field]:value};"enableRealTimeFeatures"!==field||value||(updatedSettings.enableSSEStreaming=!1,updatedSettings.defaultRefreshMode="none"),"minRefreshInterval"===field&amp;&amp;value&lt;5&amp;&amp;(updatedSettings.minRefreshInterval=5),setSettings(updatedSettings)};return isAdmin?jsxRuntimeExports.jsxs(Box,{children:[jsxRuntimeExports.jsxs(Card,{children:[jsxRuntimeExports.jsx(CardHeader,{action:jsxRuntimeExports.jsxs(Box,{sx:{display:"flex",gap:1},children:[jsxRuntimeExports.jsx(Button,{disabled:saving,startIcon:jsxRuntimeExports.jsx(ResetIcon,{}),variant:"outlined",onClick:()=&gt;setShowResetDialog(!0),children:"Reset"}),jsxRuntimeExports.jsx(Button,{disabled:saving,startIcon:jsxRuntimeExports.jsx(SaveIcon,{}),variant:"contained",onClick:()=&gt;{saveSettings(settings)},children:"Save Settings"})]}),subheader:"Control system-wide real-time features and costs",title:"Real-Time Data Settings"}),jsxRuntimeExports.jsxs(CardContent,{children:[saveMessage&amp;&amp;jsxRuntimeExports.jsx(Alert,{severity:saveMessage.type,sx:{mb:2},children:saveMessage.text}),jsxRuntimeExports.jsxs(Accordion,{defaultExpanded:!0,children:[jsxRuntimeExports.jsx(AccordionSummary,{expandIcon:jsxRuntimeExports.jsx(ExpandMoreIcon,{}),children:jsxRuntimeExports.jsxs(Typography$1,{variant:"h6",children:[jsxRuntimeExports.jsx(Speed,{sx:{mr:1,verticalAlign:"middle"}}),"Master Controls"]})}),jsxRuntimeExports.jsx(AccordionDetails,{children:jsxRuntimeExports.jsxs(FormGroup,{children:[jsxRuntimeExports.jsx(FormControlLabel,{control:jsxRuntimeExports.jsx(Switch,{checked:settings.enableRealTimeFeatures,color:settings.enableRealTimeFeatures?"primary":"default",onChange:e2=&gt;handleChange("enableRealTimeFeatures",e2.target.checked)}),label:jsxRuntimeExports.jsxs(Box,{children:[jsxRuntimeExports.jsxs(Typography$1,{variant:"body1",children:["Enable Real-Time Features",!settings.enableRealTimeFeatures&amp;&amp;jsxRuntimeExports.jsx(Chip,{color:"error",label:"ALL REAL-TIME DISABLED",size:"small",sx:{ml:1}})]}),jsxRuntimeExports.jsx(Typography$1,{color:"text.secondary",variant:"caption",children:"Master switch to disable all real-time data features system-wide"})]})}),jsxRuntimeExports.jsx(FormControlLabel,{control:jsxRuntimeExports.jsx(Switch,{checked:settings.enableSSEStreaming,disabled:!settings.enableRealTimeFeatures,onChange:e2=&gt;handleChange("enableSSEStreaming",e2.target.checked)}),label:jsxRuntimeExports.jsxs(Box,{children:[jsxRuntimeExports.jsx(Typography$1,{variant:"body1",children:"Enable Live Streaming (SSE)"}),jsxRuntimeExports.jsx(Typography$1,{color:"text.secondary",variant:"caption",children:"Allow Server-Sent Events for real-time data (higher cost)"})]})}),jsxRuntimeExports.jsx(FormControlLabel,{control:jsxRuntimeExports.jsx(Switch,{checked:settings.enableAutoRefresh,disabled:!settings.enableRealTimeFeatures,onChange:e2=&gt;handleChange("enableAutoRefresh",e2.target.checked)}),label:jsxRuntimeExports.jsxs(Box,{children:[jsxRuntimeExports.jsx(Typography$1,{variant:"body1",children:"Enable Auto-Refresh"}),jsxRuntimeExports.jsx(Typography$1,{color:"text.secondary",variant:"caption",children:"Allow charts to refresh automatically at intervals"})]})})]})})]}),jsxRuntimeExports.jsxs(Accordion,{children:[jsxRuntimeExports.jsx(AccordionSummary,{expandIcon:jsxRuntimeExports.jsx(ExpandMoreIcon,{}),children:jsxRuntimeExports.jsxs(Typography$1,{variant:"h6",children:[jsxRuntimeExports.jsx(MoneyIcon,{sx:{mr:1,verticalAlign:"middle"}}),"Cost Management"]})}),jsxRuntimeExports.jsx(AccordionDetails,{children:jsxRuntimeExports.jsxs(Box,{sx:{display:"flex",flexDirection:"column",gap:2},children:[jsxRuntimeExports.jsx(Alert,{icon:jsxRuntimeExports.jsx(Info,{}),severity:"info",children:jsxRuntimeExports.jsxs(Typography$1,{variant:"body2",children:["Estimated Monthly Cost: ",jsxRuntimeExports.jsxs("strong",{children:["$",(30*(settings.dailyApiCallLimit||5e4)/1e6*.4).toFixed(2)]}),"(based on ",null==(_a=settings.dailyApiCallLimit)?void 0:_a.toLocaleString()," calls/day)"]})}),jsxRuntimeExports.jsx(TextField,{fullWidth:!0,helperText:"Maximum API calls per day before throttling",label:"Daily API Call Limit",type:"text",...createNumericInputProps(settings.dailyApiCallLimit||"",value=&gt;handleChange("dailyApiCallLimit","number"==typeof value?value:parseInt(value)||void 0))}),jsxRuntimeExports.jsx(TextField,{fullWidth:!0,helperText:"Maximum API calls per month",label:"Monthly API Call Limit",type:"text",...createNumericInputProps(settings.monthlyApiCallLimit||"",value=&gt;handleChange("monthlyApiCallLimit","number"==typeof value?value:parseInt(value)||void 0))}),jsxRuntimeExports.jsx(TextField,{fullWidth:!0,InputProps:{startAdornment:jsxRuntimeExports.jsx(InputAdornment,{position:"start",children:"$"})},helperText:"Alert when estimated monthly cost exceeds this amount",label:"Cost Warning Threshold",type:"text",...createNumericInputProps(settings.costWarningThreshold||"",value=&gt;handleChange("costWarningThreshold","number"==typeof value?value:parseFloat(value)||void 0))}),jsxRuntimeExports.jsx(FormControlLabel,{control:jsxRuntimeExports.jsx(Switch,{checked:settings.autoDisableOnCostThreshold,onChange:e2=&gt;handleChange("autoDisableOnCostThreshold",e2.target.checked)}),label:"Auto-disable real-time features when cost threshold exceeded"})]})})]}),jsxRuntimeExports.jsxs(Accordion,{children:[jsxRuntimeExports.jsx(AccordionSummary,{expandIcon:jsxRuntimeExports.jsx(ExpandMoreIcon,{}),children:jsxRuntimeExports.jsxs(Typography$1,{variant:"h6",children:[jsxRuntimeExports.jsx(DataUsageIcon,{sx:{mr:1,verticalAlign:"middle"}}),"Rate Limits &amp; Defaults"]})}),jsxRuntimeExports.jsx(AccordionDetails,{children:jsxRuntimeExports.jsxs(Box,{sx:{display:"flex",flexDirection:"column",gap:2},children:[jsxRuntimeExports.jsx(TextField,{fullWidth:!0,InputProps:{endAdornment:jsxRuntimeExports.jsx(InputAdornment,{position:"end",children:"seconds"})},helperText:"Minimum allowed refresh interval for any chart",label:"Minimum Refresh Interval",type:"text",...createNumericInputProps(settings.minRefreshInterval,value=&gt;handleChange("minRefreshInterval","number"==typeof value?value:parseInt(value)||5))}),jsxRuntimeExports.jsx(TextField,{fullWidth:!0,InputProps:{endAdornment:jsxRuntimeExports.jsx(InputAdornment,{position:"end",children:"seconds"})},helperText:"Default interval for new charts",label:"Default Refresh Interval",type:"text",...createNumericInputProps(settings.defaultRefreshInterval,value=&gt;handleChange("defaultRefreshInterval","number"==typeof value?value:parseInt(value)||300))}),jsxRuntimeExports.jsx(TextField,{fullWidth:!0,helperText:"Maximum number of live streaming charts per user",label:"Max Live Charts Per User",type:"text",...createNumericInputProps(settings.maxLiveChartsPerUser,value=&gt;handleChange("maxLiveChartsPerUser","number"==typeof value?value:parseInt(value)||5))}),jsxRuntimeExports.jsx(TextField,{fullWidth:!0,helperText:"Maximum data points per live chart",label:"Max Points Per Live Chart",type:"text",...createNumericInputProps(settings.maxPointsPerLiveChart,value=&gt;handleChange("maxPointsPerLiveChart","number"==typeof value?value:parseInt(value)||10))}),jsxRuntimeExports.jsx(FormControlLabel,{control:jsxRuntimeExports.jsx(Switch,{checked:settings.allowUserOverride,onChange:e2=&gt;handleChange("allowUserOverride",e2.target.checked)}),label:"Allow users to override defaults (within limits)"})]})})]}),jsxRuntimeExports.jsxs(Box,{sx:{mt:3,p:2,bgcolor:"background.default",borderRadius:1},children:[jsxRuntimeExports.jsx(Typography$1,{gutterBottom:!0,variant:"h6",children:"Current Status"}),jsxRuntimeExports.jsxs(Box,{sx:{display:"flex",flexWrap:"wrap",gap:1},children:[!settings.enableRealTimeFeatures&amp;&amp;jsxRuntimeExports.jsx(Chip,{color:"error",icon:jsxRuntimeExports.jsx(WarningIcon,{}),label:"Real-Time Features Disabled"}),settings.enableSSEStreaming&amp;&amp;jsxRuntimeExports.jsx(Chip,{color:"primary",label:"Live Streaming Enabled"}),settings.enableAutoRefresh&amp;&amp;jsxRuntimeExports.jsx(Chip,{color:"primary",label:"Auto-Refresh Enabled"}),jsxRuntimeExports.jsx(Chip,{label:`Min Interval: ${settings.minRefreshInterval}s`,variant:"outlined"}),jsxRuntimeExports.jsx(Chip,{label:`Default: ${settings.defaultRefreshInterval}s`,variant:"outlined"})]})]})]})]}),jsxRuntimeExports.jsxs(Dialog,{open:showResetDialog,onClose:()=&gt;setShowResetDialog(!1),children:[jsxRuntimeExports.jsx(DialogTitle,{children:"Reset to Default Settings?"}),jsxRuntimeExports.jsx(DialogContent,{children:jsxRuntimeExports.jsx(Typography$1,{children:"This will reset all real-time settings to their default values. This action cannot be undone."})}),jsxRuntimeExports.jsxs(DialogActions,{children:[jsxRuntimeExports.jsx(Button,{onClick:()=&gt;setShowResetDialog(!1),children:"Cancel"}),jsxRuntimeExports.jsx(Button,{color:"error",variant:"contained",onClick:()=&gt;{setSettings(DEFAULT_SETTINGS),saveSettings(DEFAULT_SETTINGS),setShowResetDialog(!1)},children:"Reset Settings"})]})]})]}):jsxRuntimeExports.jsx(Alert,{severity:"error",children:"Access denied. Only administrators can modify system settings."})},LoadingProgress=({message:message="Loading...",size:size=60})=&gt;jsxRuntimeExports.jsxs(Box,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",minHeight:"100vh",gap:3,backgroundColor:"background.default"},children:[jsxRuntimeExports.jsx(CircularProgress,{size:size,sx:{color:"primary.main","&amp; .MuiCircularProgress-circle":{strokeLinecap:"round"}}}),jsxRuntimeExports.jsx(Typography$1,{variant:"h6",color:"text.secondary",sx:{animation:"pulse 2s ease-in-out infinite","@keyframes pulse":{"0%":{opacity:.6},"50%":{opacity:1},"100%":{opacity:.6}}},children:message})]}),RootRedirect$1=Object.freeze(Object.defineProperty({__proto__:null,default:()=&gt;{const{isAuthenticated:isAuthenticated,aceToken:aceToken,loading:loading,tokenLoading:tokenLoading,loadingProfile:loadingProfile}=useAppSelector(state=&gt;state.auth);return loading||loadingProfile||tokenLoading?jsxRuntimeExports.jsx(LoadingProgress,{message:"Checking your account setup..."}):isAuthenticated?aceToken?jsxRuntimeExports.jsx(Navigate,{replace:!0,to:"/dashboard"}):jsxRuntimeExports.jsx(Navigate,{replace:!0,to:"/settings?setup=token"}):jsxRuntimeExports.jsx(Navigate,{replace:!0,to:"/login"})}},Symbol.toStringTag,{value:"Module"})),DeviceDeviationHeatmapTest$1=Object.freeze(Object.defineProperty({__proto__:null,default:()=&gt;{const testPointConfigs=[{pointId:"OR_1_Pressure",pointName:"OR_1_Pressure",mode:"target",targetValue:.02,colorSensitivity:10,deviationTolerance:.001,unit:"inH2O"},{pointId:"Zone_1_Temp",pointName:"Zone_1_Temp",mode:"target",targetValue:72,colorSensitivity:5,unit:"F"},{pointId:"Zone_1_Humidity",pointName:"Zone_1_Humidity",mode:"range",minValue:40,maxValue:60,colorSensitivity:5,unit:"%RH"}];return jsxRuntimeExports.jsxs(Box,{sx:{p:3},children:[jsxRuntimeExports.jsx(Typography$1,{variant:"h4",sx:{mb:3},children:"DeviceDeviationHeatmap Test"}),jsxRuntimeExports.jsxs(Paper,{sx:{p:2,mb:3},children:[jsxRuntimeExports.jsx(Typography$1,{variant:"h6",sx:{mb:1},children:"Test Configuration:"}),jsxRuntimeExports.jsx(Typography$1,{variant:"body2",component:"pre",children:JSON.stringify(testPointConfigs,null,2)})]}),jsxRuntimeExports.jsx(Paper,{sx:{p:2,height:500},children:jsxRuntimeExports.jsx(EChartsDeviceDeviationHeatmap,{pointConfigs:testPointConfigs,selectedPoints:[{id:"OR_1_Pressure",name:"OR_1_Pressure",unit:"inH2O",marker_tags:["ahu","pressure","critical"]},{id:"Zone_1_Temp",name:"Zone_1_Temp",unit:"F",marker_tags:["zone","temp","sensor"]},{id:"Zone_1_Humidity",name:"Zone_1_Humidity",unit:"%RH",marker_tags:["zone","humidity","comfort"]}],timeRange:"24h",enableLiveData:!0,title:"Device Deviation Test Chart",height:"100%",onEdit:()=&gt;console.log("Edit clicked"),onDelete:()=&gt;console.log("Delete clicked")})}),jsxRuntimeExports.jsxs(Paper,{sx:{p:2,mt:3},children:[jsxRuntimeExports.jsx(Typography$1,{variant:"h6",sx:{mb:1},children:"Expected Behavior:"}),jsxRuntimeExports.jsx(Typography$1,{variant:"body2",children:"1. Chart should fetch data for the 3 selected points"}),jsxRuntimeExports.jsx(Typography$1,{variant:"body2",children:"2. OR_1_Pressure should show high sensitivity to deviations from 0.02"}),jsxRuntimeExports.jsx(Typography$1,{variant:"body2",children:"3. Zone_1_Temp should show deviations from 72F target"}),jsxRuntimeExports.jsx(Typography$1,{variant:"body2",children:"4. Zone_1_Humidity should show range compliance (40-60%)"}),jsxRuntimeExports.jsx(Typography$1,{variant:"body2",children:"5. Colors: Green = on target, Blue = below, Yellow/Red = above"}),jsxRuntimeExports.jsx(Typography$1,{variant:"body2",children:'6. Y-axis labels should include marker tags: "OR_1_Pressure [ahu, pressure]", "Zone_1_Temp [zone, temp]", etc.'})]})]})}},Symbol.toStringTag,{value:"Module"}));use([install$h,install$i,install$j,install$k,install$l,install$m]);const MetricsChart=({historical:historical,timeRange:timeRange})=&gt;{const theme=useTheme(),[selectedView,setSelectedView]=React.useState("latency"),isDark="dark"===theme.palette.mode,textColor=isDark?"rgba(255, 255, 255, 0.85)":"rgba(0, 0, 0, 0.85)",gridColor=isDark?"rgba(255, 255, 255, 0.1)":"rgba(0, 0, 0, 0.1)",chartOption=reactExports.useMemo(()=&gt;{const baseOption={backgroundColor:"transparent",textStyle:{color:textColor},tooltip:{trigger:"axis",backgroundColor:isDark?"rgba(10, 14, 39, 0.95)":"rgba(255, 255, 255, 0.95)",borderColor:theme.palette.primary.main,textStyle:{color:textColor},formatter:params=&gt;{let html=`&lt;div style="font-weight: bold; margin-bottom: 8px;"&gt;${format$1(new Date(params[0].value[0]),"MMM dd, HH:mm")}&lt;/div&gt;`;return params.forEach(param=&gt;{const value=param.value[1],formattedValue="cache"===selectedView||"errors"===selectedView?`${(100*value).toFixed(2)}%`:"latency"===selectedView?`${value.toFixed(1)}ms`:value.toFixed(0);html+=`\n              &lt;div style="display: flex; align-items: center; gap: 8px; margin: 4px 0;"&gt;\n                &lt;span style="display: inline-block; width: 10px; height: 10px; border-radius: 50%; background: ${param.color};"&gt;&lt;/span&gt;\n                &lt;span&gt;${param.seriesName}: &lt;strong&gt;${formattedValue}&lt;/strong&gt;&lt;/span&gt;\n              &lt;/div&gt;\n            `}),html}},legend:{data:[],textStyle:{color:textColor},top:10},grid:{left:"3%",right:"4%",bottom:"15%",top:"15%",containLabel:!0},xAxis:{type:"time",boundaryGap:!1,axisLine:{lineStyle:{color:gridColor}},axisLabel:{color:textColor,formatter:value=&gt;format$1(new Date(value),"1h"===timeRange?"HH:mm":"MMM dd")},splitLine:{show:!1}},yAxis:{type:"value",axisLine:{lineStyle:{color:gridColor}},axisLabel:{color:textColor},splitLine:{lineStyle:{color:gridColor,type:"dashed"}}},dataZoom:[{type:"inside",start:0,end:100},{start:0,end:100,handleIcon:"path://M10.7,11.9v-1.3H9.3v1.3c-4.9,0.3-8.8,4.4-8.8,9.4c0,5,3.9,9.1,8.8,9.4v1.3h1.3v-1.3c4.9-0.3,8.8-4.4,8.8-9.4C19.5,16.3,15.6,12.2,10.7,11.9z M13.3,24.4H6.7V23h6.6V24.4z M13.3,19.6H6.7v-1.4h6.6V19.6z",handleSize:"80%",handleStyle:{color:theme.palette.primary.main},textStyle:{color:textColor}}],series:[]};switch(selectedView){case"latency":return{...baseOption,legend:{...baseOption.legend,data:["P50 Latency","P95 Latency","P99 Latency"]},yAxis:{...baseOption.yAxis,axisLabel:{...baseOption.yAxis.axisLabel,formatter:value=&gt;`${value}ms`}},series:[{name:"P50 Latency",type:"line",smooth:!0,data:historical.latency.p50.map(p=&gt;[p.timestamp,p.value]),itemStyle:{color:theme.palette.success.main},lineStyle:{width:2},areaStyle:{color:new LinearGradient(0,0,0,1,[{offset:0,color:`${theme.palette.success.main}40`},{offset:1,color:`${theme.palette.success.main}05`}])}},{name:"P95 Latency",type:"line",smooth:!0,data:historical.latency.p95.map(p=&gt;[p.timestamp,p.value]),itemStyle:{color:theme.palette.warning.main},lineStyle:{width:2}},{name:"P99 Latency",type:"line",smooth:!0,data:historical.latency.p99.map(p=&gt;[p.timestamp,p.value]),itemStyle:{color:theme.palette.error.main},lineStyle:{width:2}}]};case"cache":return{...baseOption,legend:{...baseOption.legend,data:["Cache Hit Rate"]},yAxis:{...baseOption.yAxis,min:0,max:1,axisLabel:{...baseOption.yAxis.axisLabel,formatter:value=&gt;`${(100*value).toFixed(0)}%`}},series:[{name:"Cache Hit Rate",type:"line",smooth:!0,data:historical.cacheHitRate.map(p=&gt;[p.timestamp,p.value]),itemStyle:{color:theme.palette.primary.main},lineStyle:{width:3},areaStyle:{color:new LinearGradient(0,0,0,1,[{offset:0,color:`${theme.palette.primary.main}60`},{offset:1,color:`${theme.palette.primary.main}10`}])}}]};case"errors":return{...baseOption,legend:{...baseOption.legend,data:["Error Rate"]},yAxis:{...baseOption.yAxis,axisLabel:{...baseOption.yAxis.axisLabel,formatter:value=&gt;`${(100*value).toFixed(2)}%`}},series:[{name:"Error Rate",type:"line",smooth:!0,data:historical.errorRate.map(p=&gt;[p.timestamp,p.value]),itemStyle:{color:theme.palette.error.main},lineStyle:{width:3},areaStyle:{color:new LinearGradient(0,0,0,1,[{offset:0,color:`${theme.palette.error.main}40`},{offset:1,color:`${theme.palette.error.main}05`}])}}]};case"volume":return{...baseOption,legend:{...baseOption.legend,data:["Request Volume"]},yAxis:{...baseOption.yAxis,axisLabel:{...baseOption.yAxis.axisLabel,formatter:value=&gt;value.toLocaleString()}},series:[{name:"Request Volume",type:"line",smooth:!0,data:historical.requestVolume.map(p=&gt;[p.timestamp,p.value]),itemStyle:{color:theme.palette.secondary.main},lineStyle:{width:3},areaStyle:{color:new LinearGradient(0,0,0,1,[{offset:0,color:`${theme.palette.secondary.main}40`},{offset:1,color:`${theme.palette.secondary.main}05`}])}}]};default:return baseOption}},[historical,selectedView,theme,isDark,textColor,gridColor,timeRange]);return jsxRuntimeExports.jsxs(Box,{children:[jsxRuntimeExports.jsxs(Stack,{direction:"row",justifyContent:"space-between",alignItems:"center",sx:{mb:3},children:[jsxRuntimeExports.jsx(Typography$1,{variant:"h6",children:"Performance Metrics"}),jsxRuntimeExports.jsxs(ToggleButtonGroup,{value:selectedView,exclusive:!0,onChange:(_,value)=&gt;value&amp;&amp;setSelectedView(value),size:"small","aria-label":"metric view selector",children:[jsxRuntimeExports.jsx(ToggleButton,{value:"latency","aria-label":"latency view",children:"Latency"}),jsxRuntimeExports.jsx(ToggleButton,{value:"cache","aria-label":"cache view",children:"Cache"}),jsxRuntimeExports.jsx(ToggleButton,{value:"errors","aria-label":"errors view",children:"Errors"}),jsxRuntimeExports.jsx(ToggleButton,{value:"volume","aria-label":"volume view",children:"Volume"})]})]}),jsxRuntimeExports.jsx(Box,{sx:{height:400},children:jsxRuntimeExports.jsx(ReactEChartsCore,{echarts:echarts$1,option:chartOption,style:{height:"100%",width:"100%"},notMerge:!0,lazyUpdate:!0})})]})},ErrorLogViewer=({errors:errors,timeRange:timeRange})=&gt;{const[page,setPage]=reactExports.useState(0),[rowsPerPage,setRowsPerPage]=reactExports.useState(5),[searchQuery,setSearchQuery]=reactExports.useState(""),[filterType,setFilterType]=reactExports.useState("all"),[expandedRow,setExpandedRow]=reactExports.useState(null),errorTypes=reactExports.useMemo(()=&gt;{const types=new Set(errors.map(e2=&gt;e2.errorType));return["all",...Array.from(types)]},[errors]),filteredErrors=reactExports.useMemo(()=&gt;errors.filter(error=&gt;{const matchesSearch=""===searchQuery||error.errorMessage.toLowerCase().includes(searchQuery.toLowerCase())||error.endpoint.toLowerCase().includes(searchQuery.toLowerCase()),matchesType="all"===filterType||error.errorType===filterType;return matchesSearch&amp;&amp;matchesType}),[errors,searchQuery,filterType]),errorGroups=reactExports.useMemo(()=&gt;{const groups=new Map;return errors.forEach(error=&gt;{const existing=groups.get(error.errorType)||[];groups.set(error.errorType,[...existing,error])}),Array.from(groups.entries()).map(([type,logs])=&gt;({type:type,count:logs.length,percentage:logs.length/errors.length*100})).sort((a,b)=&gt;b.count-a.count)},[errors]),getErrorIcon=errorType=&gt;errorType.includes("Error")||errorType.includes("Exception")?jsxRuntimeExports.jsx(ErrorIcon,{color:"error"}):errorType.includes("Warning")?jsxRuntimeExports.jsx(WarningIcon,{color:"warning"}):jsxRuntimeExports.jsx(Info,{color:"info"}),paginatedErrors=filteredErrors.slice(page*rowsPerPage,page*rowsPerPage+rowsPerPage);return jsxRuntimeExports.jsxs(Box,{children:[jsxRuntimeExports.jsx(Typography$1,{variant:"h6",gutterBottom:!0,children:"Error Logs"}),jsxRuntimeExports.jsxs(Accordion,{sx:{mb:2},children:[jsxRuntimeExports.jsx(AccordionSummary,{expandIcon:jsxRuntimeExports.jsx(ExpandMoreIcon,{}),children:jsxRuntimeExports.jsxs(Typography$1,{variant:"subtitle2",children:["Error Distribution (",errors.length," total)"]})}),jsxRuntimeExports.jsx(AccordionDetails,{children:jsxRuntimeExports.jsx(Stack,{spacing:1,children:errorGroups.map(group=&gt;jsxRuntimeExports.jsxs(Box,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[jsxRuntimeExports.jsxs(Stack,{direction:"row",spacing:1,alignItems:"center",children:[getErrorIcon(group.type),jsxRuntimeExports.jsx(Typography$1,{variant:"body2",children:group.type})]}),jsxRuntimeExports.jsxs(Stack,{direction:"row",spacing:2,alignItems:"center",children:[jsxRuntimeExports.jsxs(Typography$1,{variant:"body2",color:"text.secondary",children:[group.count," (",group.percentage.toFixed(1),"%)"]}),jsxRuntimeExports.jsx(Box,{sx:{width:100,height:6,bgcolor:"action.hover",borderRadius:1,overflow:"hidden"},children:jsxRuntimeExports.jsx(Box,{sx:{width:`${group.percentage}%`,height:"100%",bgcolor:"error.main"}})})]})]},group.type))})})]}),jsxRuntimeExports.jsxs(Stack,{direction:{xs:"column",sm:"row"},spacing:2,sx:{mb:2},children:[jsxRuntimeExports.jsx(TextField,{fullWidth:!0,size:"small",placeholder:"Search errors...",value:searchQuery,onChange:e2=&gt;setSearchQuery(e2.target.value),InputProps:{startAdornment:jsxRuntimeExports.jsx(InputAdornment,{position:"start",children:jsxRuntimeExports.jsx(SearchIcon,{})})}}),jsxRuntimeExports.jsxs(FormControl,{size:"small",sx:{minWidth:200},children:[jsxRuntimeExports.jsx(InputLabel,{children:"Error Type"}),jsxRuntimeExports.jsx(Select,{value:filterType,label:"Error Type",onChange:e2=&gt;setFilterType(e2.target.value),children:errorTypes.map(type=&gt;jsxRuntimeExports.jsx(MenuItem,{value:type,children:"all"===type?"All Types":type},type))})]})]}),jsxRuntimeExports.jsx(TableContainer,{sx:{maxHeight:400},children:jsxRuntimeExports.jsxs(Table,{stickyHeader:!0,size:"small",children:[jsxRuntimeExports.jsx(TableHead,{children:jsxRuntimeExports.jsxs(TableRow,{children:[jsxRuntimeExports.jsx(TableCell,{width:40}),jsxRuntimeExports.jsx(TableCell,{children:"Timestamp"}),jsxRuntimeExports.jsx(TableCell,{children:"Type"}),jsxRuntimeExports.jsx(TableCell,{children:"Endpoint"}),jsxRuntimeExports.jsx(TableCell,{children:"Status"}),jsxRuntimeExports.jsx(TableCell,{children:"Message"})]})}),jsxRuntimeExports.jsx(TableBody,{children:0===paginatedErrors.length?jsxRuntimeExports.jsx(TableRow,{children:jsxRuntimeExports.jsx(TableCell,{colSpan:6,align:"center",children:jsxRuntimeExports.jsx(Typography$1,{variant:"body2",color:"text.secondary",sx:{py:4},children:"No errors found"})})}):paginatedErrors.map(error=&gt;{return jsxRuntimeExports.jsxs(React.Fragment,{children:[jsxRuntimeExports.jsxs(TableRow,{hover:!0,sx:{cursor:"pointer","&amp; &gt; *":{borderBottom:expandedRow===error.id?"none":void 0}},onClick:()=&gt;setExpandedRow(expandedRow===error.id?null:error.id),children:[jsxRuntimeExports.jsx(TableCell,{children:jsxRuntimeExports.jsx(IconButton,{size:"small",children:jsxRuntimeExports.jsx(ExpandMoreIcon,{sx:{transform:expandedRow===error.id?"rotate(180deg)":"rotate(0deg)",transition:"transform 0.3s"}})})}),jsxRuntimeExports.jsx(TableCell,{children:jsxRuntimeExports.jsx(Typography$1,{variant:"caption",children:format$1(error.timestamp,"MMM dd, HH:mm:ss")})}),jsxRuntimeExports.jsx(TableCell,{children:jsxRuntimeExports.jsxs(Stack,{direction:"row",spacing:1,alignItems:"center",children:[getErrorIcon(error.errorType),jsxRuntimeExports.jsx(Typography$1,{variant:"caption",children:error.errorType})]})}),jsxRuntimeExports.jsx(TableCell,{children:jsxRuntimeExports.jsx(Typography$1,{variant:"caption",sx:{fontFamily:"monospace"},children:error.endpoint})}),jsxRuntimeExports.jsx(TableCell,{children:error.statusCode&amp;&amp;jsxRuntimeExports.jsx(Chip,{label:error.statusCode,size:"small",color:(statusCode=error.statusCode,statusCode?statusCode&gt;=500?"error":statusCode&gt;=400?"warning":"success":"default")})}),jsxRuntimeExports.jsx(TableCell,{children:jsxRuntimeExports.jsx(Typography$1,{variant:"caption",sx:{display:"-webkit-box",WebkitLineClamp:1,WebkitBoxOrient:"vertical",overflow:"hidden"},children:error.errorMessage})})]}),jsxRuntimeExports.jsx(TableRow,{children:jsxRuntimeExports.jsx(TableCell,{colSpan:6,sx:{py:0},children:jsxRuntimeExports.jsx(Collapse,{in:expandedRow===error.id,timeout:"auto",unmountOnExit:!0,children:jsxRuntimeExports.jsxs(Box,{sx:{py:2},children:[jsxRuntimeExports.jsx(Typography$1,{variant:"subtitle2",gutterBottom:!0,children:"Error Details"}),jsxRuntimeExports.jsx(Divider,{sx:{my:1}}),jsxRuntimeExports.jsxs(Stack,{spacing:1,children:[jsxRuntimeExports.jsxs(Box,{children:[jsxRuntimeExports.jsx(Typography$1,{variant:"caption",color:"text.secondary",children:"Full Message:"}),jsxRuntimeExports.jsx(Typography$1,{variant:"body2",children:error.errorMessage})]}),error.stackTrace&amp;&amp;jsxRuntimeExports.jsxs(Box,{children:[jsxRuntimeExports.jsx(Typography$1,{variant:"caption",color:"text.secondary",children:"Stack Trace:"}),jsxRuntimeExports.jsx(Box,{component:"pre",sx:{p:1,bgcolor:"action.hover",borderRadius:1,fontSize:"0.75rem",overflow:"auto",fontFamily:"monospace"},children:error.stackTrace})]}),error.metadata&amp;&amp;jsxRuntimeExports.jsxs(Box,{children:[jsxRuntimeExports.jsx(Typography$1,{variant:"caption",color:"text.secondary",children:"Metadata:"}),jsxRuntimeExports.jsx(Box,{component:"pre",sx:{p:1,bgcolor:"action.hover",borderRadius:1,fontSize:"0.75rem",overflow:"auto",fontFamily:"monospace"},children:JSON.stringify(error.metadata,null,2)})]})]})]})})})})]},error.id);var statusCode})})]})}),jsxRuntimeExports.jsx(TablePagination,{rowsPerPageOptions:[5,10,25],component:"div",count:filteredErrors.length,rowsPerPage:rowsPerPage,page:page,onPageChange:(_,newPage)=&gt;{setPage(newPage)},onRowsPerPageChange:event=&gt;{setRowsPerPage(parseInt(event.target.value,10)),setPage(0)}})]})};use([install$n,install$o,install$i,install$j,install$k,install$p,install$m]);const CacheAnalytics=({data:data,timeRange:timeRange})=&gt;{const theme=useTheme(),isDark="dark"===theme.palette.mode,textColor=isDark?"rgba(255, 255, 255, 0.85)":"rgba(0, 0, 0, 0.85)",pieOption={backgroundColor:"transparent",tooltip:{trigger:"item",formatter:"{b}: {c} ({d}%)",backgroundColor:isDark?"rgba(10, 14, 39, 0.95)":"rgba(255, 255, 255, 0.95)",borderColor:theme.palette.primary.main,textStyle:{color:textColor}},legend:{orient:"vertical",left:"left",textStyle:{color:textColor}},series:[{type:"pie",radius:["40%","70%"],avoidLabelOverlap:!1,itemStyle:{borderRadius:8,borderColor:isDark?"#0a0a0b":"#fff",borderWidth:2},label:{show:!1,position:"center"},emphasis:{label:{show:!0,fontSize:18,fontWeight:"bold",formatter:"{d}%"}},labelLine:{show:!1},data:[{value:Math.round(data.totalRequests*data.hitRate),name:"Cache Hits",itemStyle:{color:theme.palette.success.main}},{value:Math.round(data.totalRequests*data.missRate),name:"Cache Misses",itemStyle:{color:theme.palette.error.main}}]}]},barOption={backgroundColor:"transparent",tooltip:{trigger:"axis",axisPointer:{type:"shadow"},backgroundColor:isDark?"rgba(10, 14, 39, 0.95)":"rgba(255, 255, 255, 0.95)",borderColor:theme.palette.primary.main,textStyle:{color:textColor},formatter:params=&gt;{const data2=params[0];return`\n          &lt;div style="font-weight: bold; margin-bottom: 4px;"&gt;${data2.name}&lt;/div&gt;\n          &lt;div&gt;Hit Rate: &lt;strong&gt;${(100*data2.value).toFixed(1)}%&lt;/strong&gt;&lt;/div&gt;\n        `}},grid:{left:"15%",right:"10%",top:"10%",bottom:"15%"},xAxis:{type:"value",min:0,max:1,axisLabel:{formatter:value=&gt;`${(100*value).toFixed(0)}%`,color:textColor},splitLine:{lineStyle:{color:isDark?"rgba(255, 255, 255, 0.1)":"rgba(0, 0, 0, 0.1)"}}},yAxis:{type:"category",data:data.topEndpoints.map(e2=&gt;e2.endpoint),axisLabel:{color:textColor}},series:[{type:"bar",data:data.topEndpoints.map(e2=&gt;({value:e2.hitRate,itemStyle:{color:e2.hitRate&gt;=.9?theme.palette.success.main:e2.hitRate&gt;=.7?theme.palette.warning.main:theme.palette.error.main}})),barWidth:"60%",itemStyle:{borderRadius:[0,4,4,0]}}]};return jsxRuntimeExports.jsxs(Box,{children:[jsxRuntimeExports.jsx(Typography$1,{variant:"h6",gutterBottom:!0,children:"Cache Analytics"}),jsxRuntimeExports.jsxs(Stack,{direction:"row",spacing:2,sx:{mb:3},children:[jsxRuntimeExports.jsxs(Box,{sx:{flex:1},children:[jsxRuntimeExports.jsx(Typography$1,{variant:"caption",color:"text.secondary",children:"Total Requests"}),jsxRuntimeExports.jsx(Typography$1,{variant:"h6",children:data.totalRequests.toLocaleString()})]}),jsxRuntimeExports.jsxs(Box,{sx:{flex:1},children:[jsxRuntimeExports.jsx(Typography$1,{variant:"caption",color:"text.secondary",children:"Hit Rate"}),jsxRuntimeExports.jsxs(Typography$1,{variant:"h6",color:"success.main",children:[(100*data.hitRate).toFixed(1),"%"]})]}),jsxRuntimeExports.jsxs(Box,{sx:{flex:1},children:[jsxRuntimeExports.jsx(Typography$1,{variant:"caption",color:"text.secondary",children:"Optimal TTL"}),jsxRuntimeExports.jsxs(Typography$1,{variant:"h6",children:[data.optimalTTL,"s"]})]})]}),jsxRuntimeExports.jsx(Box,{sx:{height:250,mb:3},children:jsxRuntimeExports.jsx(ReactEChartsCore,{echarts:echarts$1,option:pieOption,style:{height:"100%",width:"100%"},notMerge:!0,lazyUpdate:!0})}),jsxRuntimeExports.jsx(Typography$1,{variant:"subtitle2",gutterBottom:!0,sx:{mt:3},children:"Endpoint Hit Rates"}),jsxRuntimeExports.jsx(Box,{sx:{height:200,mb:3},children:jsxRuntimeExports.jsx(ReactEChartsCore,{echarts:echarts$1,option:barOption,style:{height:"100%",width:"100%"},notMerge:!0,lazyUpdate:!0})}),jsxRuntimeExports.jsx(Typography$1,{variant:"subtitle2",gutterBottom:!0,sx:{mt:3},children:"Top Cached Endpoints"}),jsxRuntimeExports.jsx(TableContainer,{sx:{maxHeight:200},children:jsxRuntimeExports.jsxs(Table,{size:"small",stickyHeader:!0,children:[jsxRuntimeExports.jsx(TableHead,{children:jsxRuntimeExports.jsxs(TableRow,{children:[jsxRuntimeExports.jsx(TableCell,{children:"Endpoint"}),jsxRuntimeExports.jsx(TableCell,{align:"right",children:"Requests"}),jsxRuntimeExports.jsx(TableCell,{align:"right",children:"Hit Rate"}),jsxRuntimeExports.jsx(TableCell,{align:"right",children:"Avg Latency"})]})}),jsxRuntimeExports.jsx(TableBody,{children:data.topEndpoints.map((endpoint,index2)=&gt;jsxRuntimeExports.jsxs(TableRow,{hover:!0,children:[jsxRuntimeExports.jsx(TableCell,{children:jsxRuntimeExports.jsx(Typography$1,{variant:"caption",sx:{fontFamily:"monospace"},children:endpoint.endpoint})}),jsxRuntimeExports.jsx(TableCell,{align:"right",children:jsxRuntimeExports.jsx(Typography$1,{variant:"caption",children:endpoint.requests.toLocaleString()})}),jsxRuntimeExports.jsx(TableCell,{align:"right",children:jsxRuntimeExports.jsx(Chip,{label:`${(100*endpoint.hitRate).toFixed(1)}%`,size:"small",color:endpoint.hitRate&gt;=.9?"success":endpoint.hitRate&gt;=.7?"warning":"error"})}),jsxRuntimeExports.jsx(TableCell,{align:"right",children:jsxRuntimeExports.jsxs(Typography$1,{variant:"caption",children:[endpoint.avgLatency.toFixed(0),"ms"]})})]},index2))})]})}),jsxRuntimeExports.jsx(Typography$1,{variant:"subtitle2",gutterBottom:!0,sx:{mt:3},children:"Cache Key Patterns"}),jsxRuntimeExports.jsx(Stack,{spacing:1,children:data.keyPatterns.map((pattern,index2)=&gt;jsxRuntimeExports.jsxs(Box,{sx:{p:1.5,bgcolor:"action.hover",borderRadius:1,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[jsxRuntimeExports.jsx(Typography$1,{variant:"body2",sx:{fontFamily:"monospace"},children:pattern.pattern}),jsxRuntimeExports.jsxs(Stack,{direction:"row",spacing:2,alignItems:"center",children:[jsxRuntimeExports.jsxs(Typography$1,{variant:"caption",color:"text.secondary",children:[pattern.count.toLocaleString()," keys"]}),jsxRuntimeExports.jsxs(Typography$1,{variant:"caption",color:"text.secondary",children:["~",pattern.avgSize.toFixed(1)," KB"]})]})]},index2))})]})},MetricCard=({title:title,value:value,subtitle:subtitle,color:color="primary"})=&gt;{const theme=useTheme();return jsxRuntimeExports.jsx(Card,{sx:{height:"100%",background:`linear-gradient(135deg, ${theme.palette[color].dark}20 0%, ${theme.palette[color].main}10 100%)`,borderLeft:`4px solid ${theme.palette[color].main}`},children:jsxRuntimeExports.jsxs(CardContent,{children:[jsxRuntimeExports.jsx(Typography$1,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:title}),jsxRuntimeExports.jsx(Typography$1,{variant:"h4",component:"div",fontWeight:"bold",color:`${color}.main`,children:value}),subtitle&amp;&amp;jsxRuntimeExports.jsx(Typography$1,{variant:"caption",color:"text.secondary",sx:{mt:1,display:"block"},children:subtitle})]})})},MonitoringDashboard$1=Object.freeze(Object.defineProperty({__proto__:null,default:()=&gt;{useTheme();const[timeRange,setTimeRange]=reactExports.useState("24h"),[autoRefresh,setAutoRefresh]=reactExports.useState(!0),{data:metrics,isLoading:metricsLoading,refetch:refetchMetrics}=useQuery({queryKey:["monitoring-metrics",timeRange],queryFn:()=&gt;fetchMetrics(timeRange),refetchInterval:!!autoRefresh&amp;&amp;5e3,staleTime:4e3}),{data:historical,isLoading:historicalLoading}=useQuery({queryKey:["monitoring-historical",timeRange],queryFn:()=&gt;fetchHistoricalMetrics(timeRange),refetchInterval:!!autoRefresh&amp;&amp;1e4,staleTime:8e3}),{data:errors,isLoading:errorsLoading}=useQuery({queryKey:["monitoring-errors",timeRange],queryFn:()=&gt;fetchErrorLogs(timeRange),refetchInterval:!!autoRefresh&amp;&amp;1e4,staleTime:8e3}),{data:cacheData,isLoading:cacheLoading}=useQuery({queryKey:["monitoring-cache",timeRange],queryFn:()=&gt;fetchCacheAnalytics(timeRange),refetchInterval:!!autoRefresh&amp;&amp;1e4,staleTime:8e3}),{data:status}=useQuery({queryKey:["monitoring-status"],queryFn:fetchSystemStatus,refetchInterval:!!autoRefresh&amp;&amp;5e3,staleTime:4e3}),isLoading=metricsLoading||historicalLoading||errorsLoading||cacheLoading;return jsxRuntimeExports.jsxs(Container,{maxWidth:"xl",sx:{py:4},children:[jsxRuntimeExports.jsxs(Box,{sx:{mb:4},children:[jsxRuntimeExports.jsxs(Stack,{direction:"row",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:2,children:[jsxRuntimeExports.jsxs(Box,{children:[jsxRuntimeExports.jsx(Typography$1,{variant:"h4",component:"h1",fontWeight:"bold",gutterBottom:!0,children:"System Monitoring"}),jsxRuntimeExports.jsx(Typography$1,{variant:"body2",color:"text.secondary",children:"Real-time performance metrics and analytics"})]}),jsxRuntimeExports.jsxs(Stack,{direction:"row",spacing:2,alignItems:"center",children:[status&amp;&amp;jsxRuntimeExports.jsx(Chip,{icon:"online"===status.workerStatus?jsxRuntimeExports.jsx(CheckCircleIcon,{}):"degraded"===status.workerStatus?jsxRuntimeExports.jsx(WarningIcon,{}):jsxRuntimeExports.jsx(ErrorIcon,{}),label:`Worker: ${status.workerStatus}`,color:"online"===status.workerStatus?"success":"degraded"===status.workerStatus?"warning":"error",variant:"outlined"}),jsxRuntimeExports.jsxs(FormControl,{size:"small",sx:{minWidth:120},children:[jsxRuntimeExports.jsx(InputLabel,{children:"Time Range"}),jsxRuntimeExports.jsxs(Select,{value:timeRange,label:"Time Range",onChange:e2=&gt;setTimeRange(e2.target.value),children:[jsxRuntimeExports.jsx(MenuItem,{value:"1h",children:"Last Hour"}),jsxRuntimeExports.jsx(MenuItem,{value:"24h",children:"Last 24 Hours"}),jsxRuntimeExports.jsx(MenuItem,{value:"7d",children:"Last 7 Days"}),jsxRuntimeExports.jsx(MenuItem,{value:"30d",children:"Last 30 Days"})]})]}),jsxRuntimeExports.jsx(Tooltip,{title:"Refresh data",children:jsxRuntimeExports.jsx(IconButton,{onClick:()=&gt;{refetchMetrics()},color:"primary",children:jsxRuntimeExports.jsx(Refresh,{})})})]})]}),autoRefresh&amp;&amp;metrics&amp;&amp;jsxRuntimeExports.jsxs(Typography$1,{variant:"caption",color:"text.secondary",sx:{mt:1,display:"block"},children:["Last updated: ",metrics.lastUpdated.toLocaleTimeString(),"  Auto-refresh enabled"]})]}),isLoading&amp;&amp;jsxRuntimeExports.jsx(Box,{sx:{display:"flex",justifyContent:"center",py:8},children:jsxRuntimeExports.jsx(CircularProgress,{})}),!isLoading&amp;&amp;!metrics&amp;&amp;jsxRuntimeExports.jsx(Alert,{severity:"error",sx:{mb:4},children:"Failed to load monitoring data. Please check your Analytics Engine configuration."}),!isLoading&amp;&amp;metrics&amp;&amp;jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsxs(Grid,{container:!0,spacing:3,sx:{mb:4},children:[jsxRuntimeExports.jsx(Grid,{item:!0,xs:12,sm:6,md:3,children:jsxRuntimeExports.jsx(MetricCard,{title:"Total Requests",value:metrics.requestCount.toLocaleString(),subtitle:`${timeRange.toUpperCase()} period`,color:"primary"})}),jsxRuntimeExports.jsx(Grid,{item:!0,xs:12,sm:6,md:3,children:jsxRuntimeExports.jsx(MetricCard,{title:"Cache Hit Rate",value:`${(100*metrics.cacheHitRate).toFixed(1)}%`,subtitle:`${metrics.cacheHits.toLocaleString()} hits`,color:"success"})}),jsxRuntimeExports.jsx(Grid,{item:!0,xs:12,sm:6,md:3,children:jsxRuntimeExports.jsx(MetricCard,{title:"Avg Latency",value:`${metrics.avgLatency.toFixed(0)}ms`,subtitle:`P95: ${metrics.p95Latency.toFixed(0)}ms`,color:"secondary"})}),jsxRuntimeExports.jsx(Grid,{item:!0,xs:12,sm:6,md:3,children:jsxRuntimeExports.jsx(MetricCard,{title:"Error Rate",value:`${(100*metrics.errorRate).toFixed(2)}%`,subtitle:`${metrics.errorCount} errors`,color:metrics.errorRate&gt;.01?"error":"success"})})]}),historical&amp;&amp;jsxRuntimeExports.jsx(Paper,{sx:{p:3,mb:4},children:jsxRuntimeExports.jsx(MetricsChart,{historical:historical,timeRange:timeRange})}),jsxRuntimeExports.jsxs(Grid,{container:!0,spacing:3,sx:{mb:4},children:[cacheData&amp;&amp;jsxRuntimeExports.jsx(Grid,{item:!0,xs:12,lg:6,children:jsxRuntimeExports.jsx(Paper,{sx:{p:3,height:"100%"},children:jsxRuntimeExports.jsx(CacheAnalytics,{data:cacheData,timeRange:timeRange})})}),errors&amp;&amp;jsxRuntimeExports.jsx(Grid,{item:!0,xs:12,lg:6,children:jsxRuntimeExports.jsx(Paper,{sx:{p:3,height:"100%"},children:jsxRuntimeExports.jsx(ErrorLogViewer,{errors:errors,timeRange:timeRange})})})]}),jsxRuntimeExports.jsxs(Grid,{container:!0,spacing:3,children:[jsxRuntimeExports.jsx(Grid,{item:!0,xs:12,md:6,children:jsxRuntimeExports.jsx(Card,{children:jsxRuntimeExports.jsxs(CardContent,{children:[jsxRuntimeExports.jsx(Typography$1,{variant:"h6",gutterBottom:!0,children:"API Call Reduction"}),jsxRuntimeExports.jsxs(Typography$1,{variant:"h3",color:"success.main",fontWeight:"bold",children:[(100*metrics.apiCallReduction).toFixed(1),"%"]}),jsxRuntimeExports.jsx(Typography$1,{variant:"body2",color:"text.secondary",sx:{mt:1},children:"Reduction in external API calls through intelligent caching"})]})})}),jsxRuntimeExports.jsx(Grid,{item:!0,xs:12,md:6,children:jsxRuntimeExports.jsx(Card,{children:jsxRuntimeExports.jsxs(CardContent,{children:[jsxRuntimeExports.jsx(Typography$1,{variant:"h6",gutterBottom:!0,children:"Bandwidth Saved"}),jsxRuntimeExports.jsxs(Typography$1,{variant:"h3",color:"secondary.main",fontWeight:"bold",children:[metrics.bandwidthSaved.toFixed(1)," MB"]}),jsxRuntimeExports.jsx(Typography$1,{variant:"body2",color:"text.secondary",sx:{mt:1},children:"Total bandwidth saved through caching and optimization"})]})})})]})]})]})}},Symbol.toStringTag,{value:"Module"})),focusGlow=keyframes`</span>
<span class="cstat-no" title="statement not covered" >  0% {</span>
<span class="cstat-no" title="statement not covered" >    box-shadow: 0 0 0 0 rgba(0, 229, 255, 0.4);</span>
<span class="cstat-no" title="statement not covered" >  }</span>
<span class="cstat-no" title="statement not covered" >  100% {</span>
<span class="cstat-no" title="statement not covered" >    box-shadow: 0 0 0 4px rgba(0, 229, 255, 0);</span>
<span class="cstat-no" title="statement not covered" >  }</span>
<span class="cstat-no" title="statement not covered" >`,successPulse=keyframes`</span>
<span class="cstat-no" title="statement not covered" >  0% {</span>
<span class="cstat-no" title="statement not covered" >    transform: scale(0);</span>
<span class="cstat-no" title="statement not covered" >    opacity: 1;</span>
<span class="cstat-no" title="statement not covered" >  }</span>
<span class="cstat-no" title="statement not covered" >  100% {</span>
<span class="cstat-no" title="statement not covered" >    transform: scale(1.5);</span>
<span class="cstat-no" title="statement not covered" >    opacity: 0;</span>
<span class="cstat-no" title="statement not covered" >  }</span>
<span class="cstat-no" title="statement not covered" >`,EnhancedTextField=({label:label,value:value,onChange:onChange,onBlur:onBlur,error:error,helperText:helperText,placeholder:placeholder,required:required=!1,type:type="text",autoComplete:autoComplete,fullWidth:fullWidth=!0,multiline:multiline=!1,rows:rows=4,maxLength:maxLength,validation:validation,showCharCount:showCharCount=!1,clearable:clearable=!0,loading:loading=!1,success:success=!1})=&gt;{const theme=useTheme(),[isFocused,setIsFocused]=reactExports.useState(!1),[showPassword,setShowPassword]=reactExports.useState(!1),[internalError,setInternalError]=reactExports.useState(""),[showSuccess,setShowSuccess]=reactExports.useState(!1),inputRef=reactExports.useRef(null);reactExports.useEffect(()=&gt;{success&amp;&amp;(setShowSuccess(!0),setTimeout(()=&gt;setShowSuccess(!1),2e3))},[success]);const displayError=error||internalError,isPasswordField="password"===type,inputType=isPasswordField&amp;&amp;showPassword?"text":type;return jsxRuntimeExports.jsxs(Box,{sx:{position:"relative",width:fullWidth?"100%":"auto"},children:[jsxRuntimeExports.jsx(TextField,{ref:inputRef,label:label,placeholder:placeholder,value:value,onChange:e2=&gt;{const newValue=e2.target.value;if(maxLength&amp;&amp;newValue.length&gt;maxLength)return;onChange(newValue);const validationError=(inputValue=newValue,validation?validation.pattern&amp;&amp;!validation.pattern.test(inputValue)?"Invalid format":void 0!==validation.min&amp;&amp;inputValue.length&lt;validation.min?`Minimum ${validation.min} characters required`:void 0!==validation.max&amp;&amp;inputValue.length&gt;validation.max?`Maximum ${validation.max} characters allowed`:validation.custom?validation.custom(inputValue):null:null);var inputValue;setInternalError(validationError||"")},onFocus:()=&gt;setIsFocused(!0),onBlur:()=&gt;{setIsFocused(!1),onBlur&amp;&amp;onBlur()},error:!!displayError,helperText:jsxRuntimeExports.jsxs(Box,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[jsxRuntimeExports.jsx("span",{children:displayError||helperText}),showCharCount&amp;&amp;maxLength&amp;&amp;jsxRuntimeExports.jsx(Chip,{label:`${value.length}/${maxLength}`,size:"small",color:value.length&gt;.9*maxLength?"warning":"default",sx:{height:20,fontSize:"0.75rem"}})]}),required:required,type:inputType,autoComplete:autoComplete,fullWidth:fullWidth,multiline:multiline,rows:rows,InputProps:{sx:{transition:"all 0.3s ease",backgroundColor:alpha(theme.palette.background.paper,isFocused?.95:.7),backdropFilter:"blur(10px)",WebkitBackdropFilter:"blur(10px)",borderRadius:2,"&amp;.Mui-focused":{animation:`${focusGlow} 0.6s ease-out`,boxShadow:`0 0 0 3px ${alpha(displayError?theme.palette.error.main:theme.palette.primary.main,.2)}`,"&amp; .MuiOutlinedInput-notchedOutline":{borderColor:displayError?theme.palette.error.main:"#00E5FF",borderWidth:2}},"&amp;:hover":{backgroundColor:alpha(theme.palette.background.paper,.85),"&amp; .MuiOutlinedInput-notchedOutline":{borderColor:alpha(displayError?theme.palette.error.main:theme.palette.primary.main,.6)}}},endAdornment:jsxRuntimeExports.jsx(InputAdornment,{position:"end",children:jsxRuntimeExports.jsxs(Box,{sx:{display:"flex",gap:.5},children:[loading&amp;&amp;jsxRuntimeExports.jsx(Box,{sx:{width:20,mr:1},children:jsxRuntimeExports.jsx(LinearProgress,{sx:{borderRadius:1,backgroundColor:alpha(theme.palette.primary.main,.2)}})}),showSuccess&amp;&amp;jsxRuntimeExports.jsx(Fade,{in:showSuccess,children:jsxRuntimeExports.jsx(Check,{sx:{color:theme.palette.success.main,animation:`${successPulse} 0.6s ease-out`}})}),displayError&amp;&amp;jsxRuntimeExports.jsx(Tooltip,{title:displayError,children:jsxRuntimeExports.jsx(ErrorIcon,{sx:{color:theme.palette.error.main}})}),isPasswordField&amp;&amp;jsxRuntimeExports.jsx(IconButton,{onClick:()=&gt;setShowPassword(!showPassword),edge:"end",size:"small",children:showPassword?jsxRuntimeExports.jsx(VisibilityOffIcon,{}):jsxRuntimeExports.jsx(VisibilityIcon,{})}),clearable&amp;&amp;value&amp;&amp;!loading&amp;&amp;jsxRuntimeExports.jsx(IconButton,{onClick:()=&gt;{var _a;onChange(""),setInternalError(""),null==(_a=inputRef.current)||_a.focus()},edge:"end",size:"small",sx:{opacity:.6,transition:"opacity 0.2s","&amp;:hover":{opacity:1}},children:jsxRuntimeExports.jsx(ClearIcon,{})})]})})},sx:{"&amp; .MuiFormLabel-asterisk":{color:theme.palette.error.main},"&amp; .MuiInputLabel-root":{"&amp;.Mui-focused":{color:displayError?theme.palette.error.main:theme.palette.primary.main}}}}),showSuccess&amp;&amp;jsxRuntimeExports.jsx(Box,{sx:{position:"absolute",top:"50%",right:40,width:40,height:40,borderRadius:"50%",backgroundColor:alpha(theme.palette.success.main,.2),transform:"translate(50%, -50%)",animation:`${successPulse} 0.6s ease-out`,pointerEvents:"none"}})]})},ChartPreviewImage=({type:type})=&gt;{const theme=useTheme(),previewStyles={timeseries:jsxRuntimeExports.jsxs("svg",{viewBox:"0 0 200 120",style:{width:"100%",height:"100%"},children:[jsxRuntimeExports.jsx("path",{d:"M20 80 L60 60 L100 70 L140 40 L180 50",stroke:theme.palette.primary.main,strokeWidth:"2",fill:"none"}),jsxRuntimeExports.jsx("path",{d:"M20 80 L60 60 L100 70 L140 40 L180 50 L180 100 L20 100 Z",fill:`${theme.palette.primary.main}20`})]}),line:jsxRuntimeExports.jsxs("svg",{viewBox:"0 0 200 120",style:{width:"100%",height:"100%"},children:[jsxRuntimeExports.jsx("path",{d:"M20 80 L60 60 L100 70 L140 40 L180 50",stroke:theme.palette.primary.main,strokeWidth:"2",fill:"none"}),jsxRuntimeExports.jsx("path",{d:"M20 80 L60 60 L100 70 L140 40 L180 50 L180 100 L20 100 Z",fill:`${theme.palette.primary.main}20`})]}),bar:jsxRuntimeExports.jsx("svg",{viewBox:"0 0 200 120",style:{width:"100%",height:"100%"},children:[30,60,90,120,150].map((x,i)=&gt;jsxRuntimeExports.jsx("rect",{x:x,y:100-15*(i+1),width:"20",height:15*(i+1),fill:theme.palette.primary.main,opacity:.8-.1*i,rx:"2"},i))}),gauge:jsxRuntimeExports.jsxs("svg",{viewBox:"0 0 200 120",style:{width:"100%",height:"100%"},children:[jsxRuntimeExports.jsx("path",{d:"M40 100 A60 60 0 0 1 160 100",stroke:`${theme.palette.primary.main}30`,strokeWidth:"8",fill:"none"}),jsxRuntimeExports.jsx("path",{d:"M40 100 A60 60 0 0 1 130 80",stroke:theme.palette.primary.main,strokeWidth:"8",fill:"none",strokeLinecap:"round"})]}),scatter:jsxRuntimeExports.jsx("svg",{viewBox:"0 0 200 120",style:{width:"100%",height:"100%"},children:Array.from({length:15}).map((_,i)=&gt;jsxRuntimeExports.jsx("circle",{cx:20+160*Math.random(),cy:20+80*Math.random(),r:"4",fill:theme.palette.primary.main,opacity:.7},i))}),heatmap:jsxRuntimeExports.jsx("svg",{viewBox:"0 0 200 120",style:{width:"100%",height:"100%"},children:Array.from({length:5}).map((_,row)=&gt;Array.from({length:8}).map((_2,col)=&gt;jsxRuntimeExports.jsx("rect",{x:25*col,y:24*row,width:"24",height:"23",fill:theme.palette.primary.main,opacity:.3+.7*Math.random()},`${row}-${col}`)))}),pie:jsxRuntimeExports.jsxs("svg",{viewBox:"0 0 200 120",style:{width:"100%",height:"100%"},children:[jsxRuntimeExports.jsx("circle",{cx:"100",cy:"60",r:"40",fill:"none",stroke:`${theme.palette.primary.main}20`,strokeWidth:"20"}),jsxRuntimeExports.jsx("path",{d:"M100 20 A40 40 0 0 1 140 60 L100 60 Z",fill:theme.palette.primary.main}),jsxRuntimeExports.jsx("path",{d:"M140 60 A40 40 0 0 1 100 100 L100 60 Z",fill:`${theme.palette.primary.main}80`}),jsxRuntimeExports.jsx("path",{d:"M100 100 A40 40 0 0 1 60 60 L100 60 Z",fill:`${theme.palette.primary.main}60`})]}),areachart:jsxRuntimeExports.jsxs("svg",{viewBox:"0 0 200 120",style:{width:"100%",height:"100%"},children:[jsxRuntimeExports.jsx("path",{d:"M20 80 L60 50 L100 60 L140 30 L180 40 L180 100 L20 100 Z",fill:`${theme.palette.primary.main}40`}),jsxRuntimeExports.jsx("path",{d:"M20 80 L60 50 L100 60 L140 30 L180 40",stroke:theme.palette.primary.main,strokeWidth:"2",fill:"none"})]}),stackedarea:jsxRuntimeExports.jsxs("svg",{viewBox:"0 0 200 120",style:{width:"100%",height:"100%"},children:[jsxRuntimeExports.jsx("path",{d:"M20 80 L60 70 L100 75 L140 65 L180 70 L180 100 L20 100 Z",fill:`${theme.palette.primary.main}60`}),jsxRuntimeExports.jsx("path",{d:"M20 60 L60 50 L100 55 L140 45 L180 50 L180 70 L140 65 L100 75 L60 70 L20 80 Z",fill:`${theme.palette.primary.main}40`}),jsxRuntimeExports.jsx("path",{d:"M20 40 L60 30 L100 35 L140 25 L180 30 L180 50 L140 45 L100 55 L60 50 L20 60 Z",fill:`${theme.palette.primary.main}20`})]}),boxplot:jsxRuntimeExports.jsx("svg",{viewBox:"0 0 200 120",style:{width:"100%",height:"100%"},children:[40,80,120,160].map((x,i)=&gt;jsxRuntimeExports.jsxs("g",{children:[jsxRuntimeExports.jsx("line",{x1:x,y1:"30",x2:x,y2:"90",stroke:theme.palette.primary.main,strokeWidth:"1"}),jsxRuntimeExports.jsx("rect",{x:x-10,y:"45",width:"20",height:"30",fill:`${theme.palette.primary.main}40`,stroke:theme.palette.primary.main,strokeWidth:"1"}),jsxRuntimeExports.jsx("line",{x1:x-10,y1:"60",x2:x+10,y2:"60",stroke:theme.palette.primary.main,strokeWidth:"2"})]},i))}),candlestick:jsxRuntimeExports.jsx("svg",{viewBox:"0 0 200 120",style:{width:"100%",height:"100%"},children:[30,70,110,150].map((x,i)=&gt;jsxRuntimeExports.jsxs("g",{children:[jsxRuntimeExports.jsx("line",{x1:x,y1:"20",x2:x,y2:"100",stroke:theme.palette.primary.main,strokeWidth:"1"}),jsxRuntimeExports.jsx("rect",{x:x-10,y:40+5*i,width:"20",height:"30",fill:i%2==0?theme.palette.primary.main:"none",stroke:theme.palette.primary.main,strokeWidth:"2"})]},i))}),parallelcoordinates:jsxRuntimeExports.jsxs("svg",{viewBox:"0 0 200 120",style:{width:"100%",height:"100%"},children:[[40,80,120,160].map(x=&gt;jsxRuntimeExports.jsx("line",{x1:x,y1:"20",x2:x,y2:"100",stroke:`${theme.palette.primary.main}30`,strokeWidth:"1"},x)),jsxRuntimeExports.jsx("path",{d:"M40 80 L80 40 L120 60 L160 30",stroke:theme.palette.primary.main,strokeWidth:"2",fill:"none"}),jsxRuntimeExports.jsx("path",{d:"M40 60 L80 70 L120 50 L160 70",stroke:`${theme.palette.primary.main}70`,strokeWidth:"2",fill:"none"})]}),radar:jsxRuntimeExports.jsxs("svg",{viewBox:"0 0 200 120",style:{width:"100%",height:"100%"},children:[jsxRuntimeExports.jsx("polygon",{points:"100,20 150,50 130,90 70,90 50,50",fill:"none",stroke:`${theme.palette.primary.main}30`,strokeWidth:"1"}),jsxRuntimeExports.jsx("polygon",{points:"100,40 130,55 120,80 80,80 70,55",fill:`${theme.palette.primary.main}30`,stroke:theme.palette.primary.main,strokeWidth:"2"})]}),timelinechart:jsxRuntimeExports.jsxs("svg",{viewBox:"0 0 200 120",style:{width:"100%",height:"100%"},children:[jsxRuntimeExports.jsx("line",{x1:"20",y1:"60",x2:"180",y2:"60",stroke:`${theme.palette.primary.main}30`,strokeWidth:"2"}),[40,80,120,160].map((x,i)=&gt;jsxRuntimeExports.jsxs("g",{children:[jsxRuntimeExports.jsx("circle",{cx:x,cy:"60",r:"8",fill:theme.palette.primary.main,opacity:.8-.1*i}),jsxRuntimeExports.jsx("line",{x1:x,y1:"60",x2:x,y2:40-5*i,stroke:theme.palette.primary.main,strokeWidth:"1"})]},i))]}),scatter3d:jsxRuntimeExports.jsxs("svg",{viewBox:"0 0 200 120",style:{width:"100%",height:"100%"},children:[jsxRuntimeExports.jsx("line",{x1:"50",y1:"90",x2:"150",y2:"90",stroke:`${theme.palette.primary.main}50`,strokeWidth:"1"}),jsxRuntimeExports.jsx("line",{x1:"50",y1:"90",x2:"50",y2:"30",stroke:`${theme.palette.primary.main}50`,strokeWidth:"1"}),jsxRuntimeExports.jsx("line",{x1:"50",y1:"90",x2:"30",y2:"110",stroke:`${theme.palette.primary.main}50`,strokeWidth:"1"}),Array.from({length:12}).map((_,i)=&gt;jsxRuntimeExports.jsx("circle",{cx:60+80*Math.random(),cy:40+40*Math.random(),r:"4",fill:theme.palette.primary.main,opacity:.4+.6*Math.random()},i))]}),calendaryearheatmap:jsxRuntimeExports.jsx("svg",{viewBox:"0 0 200 120",style:{width:"100%",height:"100%"},children:Array.from({length:7}).map((_,row)=&gt;Array.from({length:12}).map((_2,col)=&gt;jsxRuntimeExports.jsx("rect",{x:10+15*col,y:10+15*row,width:"13",height:"13",fill:theme.palette.primary.main,opacity:.2+.8*Math.random(),rx:"2"},`${row}-${col}`)))}),sankey:jsxRuntimeExports.jsxs("svg",{viewBox:"0 0 200 120",style:{width:"100%",height:"100%"},children:[jsxRuntimeExports.jsx("path",{d:"M30 30 Q 100 30 100 50",stroke:theme.palette.primary.main,strokeWidth:"15",fill:"none",opacity:"0.6"}),jsxRuntimeExports.jsx("path",{d:"M30 60 Q 100 60 100 70",stroke:theme.palette.primary.main,strokeWidth:"10",fill:"none",opacity:"0.4"}),jsxRuntimeExports.jsx("path",{d:"M100 50 Q 170 50 170 40",stroke:theme.palette.primary.main,strokeWidth:"8",fill:"none",opacity:"0.5"}),jsxRuntimeExports.jsx("path",{d:"M100 70 Q 170 70 170 80",stroke:theme.palette.primary.main,strokeWidth:"12",fill:"none",opacity:"0.5"})]}),treemap:jsxRuntimeExports.jsxs("svg",{viewBox:"0 0 200 120",style:{width:"100%",height:"100%"},children:[jsxRuntimeExports.jsx("rect",{x:"20",y:"20",width:"80",height:"80",fill:theme.palette.primary.main,opacity:"0.8"}),jsxRuntimeExports.jsx("rect",{x:"105",y:"20",width:"75",height:"40",fill:theme.palette.primary.main,opacity:"0.6"}),jsxRuntimeExports.jsx("rect",{x:"105",y:"65",width:"35",height:"35",fill:theme.palette.primary.main,opacity:"0.5"}),jsxRuntimeExports.jsx("rect",{x:"145",y:"65",width:"35",height:"35",fill:theme.palette.primary.main,opacity:"0.4"})]}),perfecteconomizer:jsxRuntimeExports.jsxs("svg",{viewBox:"0 0 200 120",style:{width:"100%",height:"100%"},children:[jsxRuntimeExports.jsx("rect",{x:"20",y:"20",width:"160",height:"80",fill:"none",stroke:`${theme.palette.primary.main}30`,strokeWidth:"1"}),jsxRuntimeExports.jsx("path",{d:"M20 100 L180 20",stroke:`${theme.palette.primary.main}50`,strokeWidth:"1",strokeDasharray:"5,5"}),jsxRuntimeExports.jsx("path",{d:"M20 80 L60 70 L100 60 L140 50 L180 40",stroke:theme.palette.success.main,strokeWidth:"2",fill:"none"}),jsxRuntimeExports.jsx("path",{d:"M20 60 L60 65 L100 70 L140 75 L180 80",stroke:theme.palette.error.main,strokeWidth:"2",fill:"none"})]}),psychrometric:jsxRuntimeExports.jsxs("svg",{viewBox:"0 0 200 120",style:{width:"100%",height:"100%"},children:[jsxRuntimeExports.jsx("path",{d:"M20 100 Q 60 100 100 80 T 180 40",stroke:`${theme.palette.primary.main}30`,strokeWidth:"1",fill:"none"}),jsxRuntimeExports.jsx("rect",{x:"60",y:"50",width:"80",height:"40",fill:`${theme.palette.info.main}20`,stroke:`${theme.palette.info.main}50`,strokeWidth:"1",rx:"5"}),Array.from({length:8}).map((_,i)=&gt;jsxRuntimeExports.jsx("circle",{cx:40+20*i,cy:90-6*i,r:"3",fill:theme.palette.primary.main,opacity:.7},i))]}),devicedeviationheatmap:jsxRuntimeExports.jsx("svg",{viewBox:"0 0 200 120",style:{width:"100%",height:"100%"},children:Array.from({length:5}).map((_,row)=&gt;Array.from({length:8}).map((_2,col)=&gt;{const deviation=10*Math.random()-5,color=deviation&gt;2?theme.palette.error.main:deviation&lt;-2?theme.palette.info.main:theme.palette.success.main;return jsxRuntimeExports.jsx("rect",{x:25*col,y:24*row,width:"24",height:"23",fill:color,opacity:Math.abs(deviation)/10+.3},`${row}-${col}`)}))}),calendarheatmap:jsxRuntimeExports.jsx("svg",{viewBox:"0 0 200 120",style:{width:"100%",height:"100%"},children:Array.from({length:4}).map((_,row)=&gt;Array.from({length:7}).map((_2,col)=&gt;jsxRuntimeExports.jsx("rect",{x:20+24*col,y:20+24*row,width:"20",height:"20",fill:theme.palette.primary.main,opacity:.2+.8*Math.random(),rx:"3"},`${row}-${col}`)))})};return jsxRuntimeExports.jsx(Box,{sx:{width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center",background:"dark"===theme.palette.mode?"rgba(255, 255, 255, 0.02)":"rgba(0, 0, 0, 0.02)",borderRadius:1,overflow:"hidden"},children:previewStyles[type]||previewStyles.line})},QUICK_FILTERS=[{label:"Temperature",tags:["temp","temperature"],icon:jsxRuntimeExports.jsx(Thermostat,{})},{label:"Humidity",tags:["humidity","rh"],icon:jsxRuntimeExports.jsx(WaterDrop,{})},{label:"Pressure",tags:["pressure"],icon:jsxRuntimeExports.jsx(Air,{})},{label:"Flow",tags:["flow"],icon:jsxRuntimeExports.jsx(Air,{})},{label:"Power",tags:["power","kw"],icon:jsxRuntimeExports.jsx(ElectricBolt,{})},{label:"Setpoint",tags:["setpoint","sp"],icon:jsxRuntimeExports.jsx(Speed,{})}],VirtualRow=React.memo(({index:index2,style:style,data:data})=&gt;{const{points:points,selectedPoints:selectedPoints,handlePointToggle:handlePointToggle,maxPoints:maxPoints,enableMultiSelect:enableMultiSelect}=data,point=points[index2];if(!point)return null;const isSelected=selectedPoints.some(p=&gt;(null==p?void 0:p.id)===point.id),hasReachedMax=!!maxPoints&amp;&amp;selectedPoints.length&gt;=maxPoints,isDisabled=!enableMultiSelect&amp;&amp;hasReachedMax&amp;&amp;!isSelected;return jsxRuntimeExports.jsx("div",{style:style,children:jsxRuntimeExports.jsx("button",{onClick:()=&gt;{console.log(" [VAV Debug] Button clicked:",{pointName:point.name,pointId:point.id,isDisabled:isDisabled,isSelected:isSelected,hasReachedMax:hasReachedMax,selectedCount:selectedPoints.length,maxPoints:maxPoints,enableMultiSelect:enableMultiSelect}),!isDisabled&amp;&amp;point?(console.log(" [VAV Debug] Calling handlePointToggle for:",point.name),handlePointToggle(point)):console.log(" [VAV Debug] Click blocked - disabled:",isDisabled)},disabled:isDisabled,style:{width:"100%",border:"none",background:isSelected?"rgba(25, 118, 210, 0.08)":"transparent",cursor:isDisabled?"default":"pointer",padding:0,textAlign:"left",display:"block",transition:"background-color 0.15s"},onMouseEnter:e2=&gt;{isDisabled||(e2.currentTarget.style.backgroundColor=isSelected?"rgba(25, 118, 210, 0.12)":"rgba(0, 0, 0, 0.04)")},onMouseLeave:e2=&gt;{e2.currentTarget.style.backgroundColor=isSelected?"rgba(25, 118, 210, 0.08)":"transparent"},children:jsxRuntimeExports.jsxs(Box,{sx:{display:"flex",alignItems:"center",width:"100%",px:2,py:1},children:[jsxRuntimeExports.jsx(ListItemIcon,{sx:{minWidth:42},children:jsxRuntimeExports.jsx(Checkbox,{edge:"start",checked:isSelected,tabIndex:-1,disableRipple:!0,disabled:isDisabled,inputProps:{"aria-label":`Select ${point.name}`},style:{pointerEvents:"none"}})}),jsxRuntimeExports.jsx(ListItemText,{primary:jsxRuntimeExports.jsx(Tooltip,{title:point.name||point.Name,placement:"right",arrow:!0,children:jsxRuntimeExports.jsx(Typography$1,{variant:"body2",noWrap:!0,children:point.display_name||point.displayName||point.name||point.Name})}),secondary:jsxRuntimeExports.jsx(Stack,{direction:"row",spacing:.5,alignItems:"center",children:point.unit&amp;&amp;jsxRuntimeExports.jsx(Chip,{label:point.unit,size:"small",variant:"outlined"})})})]})})})}),PointSelector=({siteId:siteId,selectedPoints:selectedPoints,onPointsChange:onPointsChange,maxPoints:maxPoints=null,minPoints:minPoints=0,markerTagFilter:markerTagFilter=[],placeholder:placeholder="Search points... (50ms instant search)",description:description,error:error,height:height=500,enableMultiSelect:enableMultiSelect=!0,showStats:showStats=!0,showQuickFilters:showQuickFilters=!0,chartType:chartType,title:title,enableVirtualScroll:enableVirtualScroll=!0,enableIndexedDB:enableIndexedDB=!0,enablePrefetch:enablePrefetch=!0,enableProgressive:enableProgressive=!0})=&gt;{const[searchInput,setSearchInput]=reactExports.useState(""),[activeFilter,setActiveFilter]=reactExports.useState(markerTagFilter),listRef=reactExports.useRef(null),searchFieldRef=reactExports.useRef(null),{points:points,totalCount:totalCount,isLoading:isLoading,isSearching:isSearching,isPrefetching:isPrefetching,error:loadError,search:search,refresh:refresh,clearCache:clearCache,prefetchSite:prefetchSite,fromCache:fromCache,cacheStats:cacheStats,loadTime:loadTime,renderTime:renderTime}=usePointData({siteId:siteId,searchQuery:searchInput,markerTags:activeFilter,pageSize:1e5,debounceMs:50,enableIndexedDB:enableIndexedDB,enablePrefetch:enablePrefetch,enableProgressive:enableProgressive,virtualScrolling:enableVirtualScroll});reactExports.useEffect(()=&gt;{siteId&amp;&amp;totalCount&gt;0&amp;&amp;console.log(" [PointSelector] Component data:",{siteId:siteId,totalCount:totalCount,pointsLength:points.length,fromCache:fromCache,loadTime:loadTime,renderTime:renderTime})},[siteId,totalCount,points.length,fromCache,loadTime,renderTime]);const handleSearchChange=reactExports.useCallback(event=&gt;{const value=event.target.value;setSearchInput(value),search(value)},[search]),handleClearSearch=reactExports.useCallback(()=&gt;{var _a;setSearchInput(""),search(""),null==(_a=searchFieldRef.current)||_a.focus()},[search]),handlePointToggle=reactExports.useCallback(point=&gt;{console.log(" [VAV Debug] handlePointToggle called with:",{pointName:null==point?void 0:point.name,pointId:null==point?void 0:point.id,enableMultiSelect:enableMultiSelect,maxPoints:maxPoints}),point?onPointsChange(prev=&gt;{const currentSelection=Array.isArray(prev)?prev:[],isSelected=currentSelection.some(p=&gt;(null==p?void 0:p.id)===point.id);if(console.log(" [VAV Debug] Selection state:",{currentCount:currentSelection.length,isAlreadySelected:isSelected,willSelect:!isSelected,mode:enableMultiSelect?"multi":"single"}),isSelected)return console.log(" [VAV Debug] Deselecting point:",point.name),currentSelection.filter(p=&gt;(null==p?void 0:p.id)!==point.id);if(!maxPoints||currentSelection.length&lt;maxPoints){const newSelection=enableMultiSelect?[...currentSelection,point]:[point];return console.log(" [VAV Debug] Selecting point:",point.name,"New selection count:",newSelection.length),newSelection}return console.log(" [VAV Debug] Max points reached, cannot select:",point.name),currentSelection}):console.log(" [VAV Debug] No point provided to handlePointToggle")},[onPointsChange,maxPoints,enableMultiSelect]),handleSelectAll=reactExports.useCallback(()=&gt;{if(points.every(p=&gt;selectedPoints.some(sp=&gt;sp.id===p.id))){const visibleIds=new Set(points.map(p=&gt;p.id));onPointsChange(prev=&gt;prev.filter(p=&gt;!visibleIds.has(p.id)))}else onPointsChange(prev=&gt;{const toAdd=points.filter(p=&gt;!prev.some(sp=&gt;sp.id===p.id)),canAdd=maxPoints?Math.min(toAdd.length,maxPoints-prev.length):toAdd.length;return[...prev,...toAdd.slice(0,canAdd)]})},[points,selectedPoints,onPointsChange,maxPoints]),handleQuickFilter=reactExports.useCallback(tags=&gt;{setActiveFilter(prev=&gt;prev.length===tags.length&amp;&amp;prev.every(tag=&gt;tags.includes(tag))?[]:tags)},[]);reactExports.useCallback(hoveredSiteId=&gt;{hoveredSiteId&amp;&amp;hoveredSiteId!==siteId&amp;&amp;prefetchSite(hoveredSiteId)},[siteId,prefetchSite]);const itemData=reactExports.useMemo(()=&gt;({points:points,selectedPoints:selectedPoints,handlePointToggle:handlePointToggle,maxPoints:maxPoints,enableMultiSelect:enableMultiSelect}),[points,selectedPoints,handlePointToggle,maxPoints,enableMultiSelect]),listHeight=Math.min(height-200,72*points.length);return jsxRuntimeExports.jsxs(Box,{sx:{height:"100%",display:"flex",flexDirection:"column"},children:[jsxRuntimeExports.jsxs(Box,{sx:{p:2,borderBottom:1,borderColor:"divider"},children:[title&amp;&amp;jsxRuntimeExports.jsx(Typography$1,{variant:"h6",gutterBottom:!0,children:title}),description&amp;&amp;jsxRuntimeExports.jsx(Typography$1,{variant:"body2",color:"text.secondary",sx:{mb:1},children:description}),showStats&amp;&amp;jsxRuntimeExports.jsxs(Stack,{direction:"row",spacing:1,sx:{mb:1},children:[jsxRuntimeExports.jsx(Chip,{icon:fromCache?jsxRuntimeExports.jsx(CachedOutlined,{}):jsxRuntimeExports.jsx(FlashOn,{}),label:fromCache?`Cached (${null==loadTime?void 0:loadTime.toFixed(0)}ms)`:`API (${null==loadTime?void 0:loadTime.toFixed(0)}ms)`,size:"small",color:fromCache?"success":"default"}),jsxRuntimeExports.jsx(Chip,{icon:jsxRuntimeExports.jsx(Speed,{}),label:searchInput?`Showing ${points.length} of ${totalCount} points`:`${totalCount} total points loaded`,size:"small",color:searchInput?"warning":"success",variant:searchInput?"filled":"outlined"}),(null==cacheStats?void 0:cacheStats.hitRate)&gt;0&amp;&amp;jsxRuntimeExports.jsx(Chip,{icon:jsxRuntimeExports.jsx(MemoryIcon,{}),label:`${(100*cacheStats.hitRate).toFixed(0)}% hit rate`,size:"small",color:"primary"}),isPrefetching&amp;&amp;jsxRuntimeExports.jsx(Chip,{icon:jsxRuntimeExports.jsx(CircularProgress,{size:12}),label:"Prefetching...",size:"small"})]}),jsxRuntimeExports.jsxs(Box,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:1,children:[jsxRuntimeExports.jsxs(Typography$1,{variant:"body2",color:"text.secondary",children:[selectedPoints.length," selected"]}),jsxRuntimeExports.jsx(Badge,{badgeContent:totalCount,color:"primary",max:99999,anchorOrigin:{vertical:"top",horizontal:"left"},children:jsxRuntimeExports.jsx(Chip,{label:searchInput&amp;&amp;points.length&lt;totalCount?`Filtered: ${points.length} points match`:"All points available",size:"small",color:searchInput&amp;&amp;points.length&lt;totalCount?"warning":"success"})})]}),jsxRuntimeExports.jsx(TextField,{ref:searchFieldRef,fullWidth:!0,size:"small",placeholder:placeholder,value:searchInput,onChange:handleSearchChange,sx:{mb:1},InputProps:{startAdornment:jsxRuntimeExports.jsx(InputAdornment,{position:"start",children:isSearching?jsxRuntimeExports.jsx(CircularProgress,{size:20}):jsxRuntimeExports.jsx(SearchIcon,{})}),endAdornment:searchInput&amp;&amp;jsxRuntimeExports.jsx(InputAdornment,{position:"end",children:jsxRuntimeExports.jsx(IconButton,{size:"small",onClick:handleClearSearch,children:jsxRuntimeExports.jsx(ClearIcon,{})})})}}),showQuickFilters&amp;&amp;jsxRuntimeExports.jsx(Stack,{direction:"row",spacing:1,flexWrap:"wrap",sx:{mb:1},children:QUICK_FILTERS.map(filter=&gt;jsxRuntimeExports.jsx(Chip,{icon:filter.icon,label:filter.label,size:"small",onClick:()=&gt;handleQuickFilter(filter.tags),color:activeFilter.some(tag=&gt;filter.tags.includes(tag))?"primary":"default",variant:activeFilter.some(tag=&gt;filter.tags.includes(tag))?"filled":"outlined"},filter.label))}),jsxRuntimeExports.jsxs(Stack,{direction:"row",justifyContent:"space-between",alignItems:"center",children:[jsxRuntimeExports.jsxs(Typography$1,{variant:"body2",color:"text.secondary",children:[selectedPoints.length," / ",maxPoints||""," selected",minPoints&gt;0&amp;&amp;` (min: ${minPoints})`]}),enableMultiSelect&amp;&amp;points.length&gt;0&amp;&amp;jsxRuntimeExports.jsxs(Button,{size:"small",onClick:handleSelectAll,startIcon:points.every(p=&gt;selectedPoints.some(sp=&gt;sp.id===p.id))?jsxRuntimeExports.jsx(ClearIcon,{}):jsxRuntimeExports.jsx(CheckCircleIcon,{}),children:[points.every(p=&gt;selectedPoints.some(sp=&gt;sp.id===p.id))?"Deselect":"Select"," All"]})]})]}),(error||loadError)&amp;&amp;jsxRuntimeExports.jsx(Alert,{severity:"error",sx:{m:2},children:error||(null==loadError?void 0:loadError.message)}),isLoading&amp;&amp;!fromCache&amp;&amp;jsxRuntimeExports.jsxs(Box,{sx:{p:4,textAlign:"center"},children:[jsxRuntimeExports.jsx(CircularProgress,{}),jsxRuntimeExports.jsx(Typography$1,{variant:"body2",sx:{mt:2},children:"Loading points..."})]}),!isLoading&amp;&amp;points.length&gt;0&amp;&amp;enableVirtualScroll&amp;&amp;enableMultiSelect&amp;&amp;jsxRuntimeExports.jsx(Box,{sx:{flex:1,minHeight:0},children:jsxRuntimeExports.jsx(FixedSizeList,{ref:listRef,height:listHeight,itemCount:points.length,itemSize:72,itemData:itemData,width:"100%",overscanCount:3,children:VirtualRow})}),!isLoading&amp;&amp;points.length&gt;0&amp;&amp;enableVirtualScroll&amp;&amp;!enableMultiSelect&amp;&amp;jsxRuntimeExports.jsx(Box,{sx:{flex:1,overflow:"auto",maxHeight:listHeight},children:points.map(point=&gt;{const isSelected=selectedPoints.some(p=&gt;(null==p?void 0:p.id)===point.id),isDisabled=!!maxPoints&amp;&amp;selectedPoints.length&gt;=maxPoints&amp;&amp;!isSelected;return jsxRuntimeExports.jsxs(ListItem,{disablePadding:!0,onClick:()=&gt;{console.log(" [VAV Single-Select] Direct click on:",point.name),!isDisabled&amp;&amp;point&amp;&amp;handlePointToggle(point)},sx:{cursor:isDisabled?"default":"pointer",backgroundColor:isSelected?"action.selected":"transparent","&amp;:hover":isDisabled?{}:{backgroundColor:isSelected?"action.hover":"rgba(0, 0, 0, 0.04)"}},children:[jsxRuntimeExports.jsx(ListItemIcon,{children:jsxRuntimeExports.jsx(Checkbox,{edge:"start",checked:isSelected,tabIndex:-1,disableRipple:!0,disabled:isDisabled,inputProps:{"aria-label":`Select ${point.name}`},sx:{pointerEvents:"none"}})}),jsxRuntimeExports.jsx(ListItemText,{primary:jsxRuntimeExports.jsx(Tooltip,{title:point.name||point.Name,placement:"right",arrow:!0,children:jsxRuntimeExports.jsx(Typography$1,{variant:"body2",noWrap:!0,children:point.display_name||point.displayName||point.name||point.Name})}),secondary:jsxRuntimeExports.jsx(Stack,{direction:"row",spacing:.5,alignItems:"center",children:point.unit&amp;&amp;jsxRuntimeExports.jsx(Chip,{label:point.unit,size:"small",variant:"outlined"})})})]},point.id)})}),!isLoading&amp;&amp;points.length&gt;0&amp;&amp;!enableVirtualScroll&amp;&amp;jsxRuntimeExports.jsxs(Box,{sx:{flex:1,overflow:"auto",maxHeight:listHeight},children:[points.slice(0,100).map((point,index2)=&gt;jsxRuntimeExports.jsx(VirtualRow,{index:index2,style:{},data:itemData},point.id)),points.length&gt;100&amp;&amp;jsxRuntimeExports.jsxs(Typography$1,{variant:"body2",sx:{p:2,textAlign:"center",color:"text.secondary"},children:["Showing first 100 of ",points.length," points. Use search to find specific points."]})]}),!isLoading&amp;&amp;0===points.length&amp;&amp;jsxRuntimeExports.jsx(Box,{sx:{p:4,textAlign:"center"},children:jsxRuntimeExports.jsx(Typography$1,{color:"text.secondary",children:searchInput?"No points match your search":"No points available"})}),jsxRuntimeExports.jsx(Box,{sx:{p:1,borderTop:1,borderColor:"divider",display:"flex",justifyContent:"flex-end"},children:jsxRuntimeExports.jsx(Tooltip,{title:"Clear cache and reload from API",children:jsxRuntimeExports.jsx(IconButton,{size:"small",onClick:()=&gt;{clearCache(),refresh()},children:jsxRuntimeExports.jsx(Refresh,{})})})})]})},SPCWizardConfig=({config:config,setConfig:setConfig})=&gt;{const updateSPCConfig=(key,value)=&gt;{setConfig({...config,config:{...config.config,[key]:value}})};return jsxRuntimeExports.jsx(jsxRuntimeExports.Fragment,{children:jsxRuntimeExports.jsx(Grid,{item:!0,xs:12,children:jsxRuntimeExports.jsxs(Paper,{sx:{p:3,bgcolor:"background.paper",borderRadius:2},children:[jsxRuntimeExports.jsxs(Typography$1,{variant:"h6",gutterBottom:!0,sx:{display:"flex",alignItems:"center",gap:1},children:[jsxRuntimeExports.jsx(QueryStats,{color:"primary"}),"Setup Process Monitoring"]}),jsxRuntimeExports.jsx(Typography$1,{variant:"body2",color:"text.secondary",sx:{mb:3},children:"This chart will automatically track your process and alert you to any unusual patterns or issues"}),jsxRuntimeExports.jsxs(Box,{sx:{mb:4},children:[jsxRuntimeExports.jsx(Typography$1,{variant:"subtitle1",gutterBottom:!0,sx:{fontWeight:600,mb:2},children:"How do you want to monitor your data?"}),jsxRuntimeExports.jsxs(FormControl,{fullWidth:!0,children:[jsxRuntimeExports.jsxs(Select,{value:config.config.spcChartType||"xmr",onChange:e2=&gt;updateSPCConfig("spcChartType",e2.target.value),displayEmpty:!0,children:[jsxRuntimeExports.jsx(MenuItem,{value:"xmr",children:jsxRuntimeExports.jsxs(Box,{children:[jsxRuntimeExports.jsx(Typography$1,{variant:"body2",sx:{fontWeight:600},children:"Individual Values (X-mR)"}),jsxRuntimeExports.jsx(Typography$1,{variant:"caption",color:"text.secondary",children:"Best for: Single measurements taken over time (temperature, pressure, humidity)"})]})}),jsxRuntimeExports.jsx(MenuItem,{value:"xbar-r",children:jsxRuntimeExports.jsxs(Box,{children:[jsxRuntimeExports.jsx(Typography$1,{variant:"body2",sx:{fontWeight:600},children:"Sample Averages (X-bar R)"}),jsxRuntimeExports.jsx(Typography$1,{variant:"caption",color:"text.secondary",children:"Best for: Multiple samples taken at each time point (batch processes)"})]})}),jsxRuntimeExports.jsx(MenuItem,{value:"xbar-s",children:jsxRuntimeExports.jsxs(Box,{children:[jsxRuntimeExports.jsx(Typography$1,{variant:"body2",sx:{fontWeight:600},children:"Sample Averages with Standard Deviation (X-bar S)"}),jsxRuntimeExports.jsx(Typography$1,{variant:"caption",color:"text.secondary",children:"Best for: Larger sample groups (10+ samples) for higher precision"})]})})]}),jsxRuntimeExports.jsx(Typography$1,{variant:"caption",color:"text.secondary",sx:{mt:1,display:"block"},children:' Not sure? Start with "Individual Values" for most building sensors'})]})]}),"xmr"!==config.config.spcChartType&amp;&amp;jsxRuntimeExports.jsxs(Box,{sx:{mb:4},children:[jsxRuntimeExports.jsx(Typography$1,{variant:"subtitle1",gutterBottom:!0,sx:{fontWeight:600,mb:2},children:"How many samples do you take at each time?"}),jsxRuntimeExports.jsxs(Grid,{container:!0,spacing:2,alignItems:"center",children:[jsxRuntimeExports.jsx(Grid,{item:!0,xs:12,sm:6,children:jsxRuntimeExports.jsx(TextField,{fullWidth:!0,label:"Samples per Group",type:"number",value:config.config.subgroupSize||5,onChange:e2=&gt;updateSPCConfig("subgroupSize",parseInt(e2.target.value)),InputProps:{inputProps:{min:2,max:25},endAdornment:jsxRuntimeExports.jsx(Tooltip,{title:"Number of readings taken at the same time point",children:jsxRuntimeExports.jsx(IconButton,{size:"small",children:jsxRuntimeExports.jsx(HelpOutlineIcon,{fontSize:"small"})})})},helperText:"Typically 3-7 samples per group"})}),jsxRuntimeExports.jsx(Grid,{item:!0,xs:12,sm:6,children:jsxRuntimeExports.jsx(Alert,{severity:"info",icon:jsxRuntimeExports.jsx(Info,{}),children:'Example: If you measure 5 rooms at 2pm daily, enter "5"'})})]})]}),jsxRuntimeExports.jsxs(Box,{sx:{mb:4},children:[jsxRuntimeExports.jsx(Typography$1,{variant:"subtitle1",gutterBottom:!0,sx:{fontWeight:600,mb:2},children:"How sensitive should the monitoring be?"}),jsxRuntimeExports.jsxs(Grid,{container:!0,spacing:2,children:[jsxRuntimeExports.jsx(Grid,{item:!0,xs:12,sm:6,children:jsxRuntimeExports.jsxs(FormControl,{fullWidth:!0,children:[jsxRuntimeExports.jsx(InputLabel,{children:"Alert Sensitivity"}),jsxRuntimeExports.jsxs(Select,{value:config.config.sigmaMultiplier||3,onChange:e2=&gt;updateSPCConfig("sigmaMultiplier",parseFloat(e2.target.value)),children:[jsxRuntimeExports.jsx(MenuItem,{value:2,children:jsxRuntimeExports.jsxs(Box,{children:[jsxRuntimeExports.jsx(Typography$1,{variant:"body2",children:"High Sensitivity"}),jsxRuntimeExports.jsx(Typography$1,{variant:"caption",color:"text.secondary",children:"More frequent alerts for minor changes"})]})}),jsxRuntimeExports.jsx(MenuItem,{value:3,children:jsxRuntimeExports.jsxs(Box,{children:[jsxRuntimeExports.jsx(Typography$1,{variant:"body2",children:"Balanced (Recommended)"}),jsxRuntimeExports.jsx(Typography$1,{variant:"caption",color:"text.secondary",children:"Alerts for significant changes only"})]})}),jsxRuntimeExports.jsx(MenuItem,{value:4,children:jsxRuntimeExports.jsxs(Box,{children:[jsxRuntimeExports.jsx(Typography$1,{variant:"body2",children:"Low Sensitivity"}),jsxRuntimeExports.jsx(Typography$1,{variant:"caption",color:"text.secondary",children:"Alerts only for major deviations"})]})})]})]})}),jsxRuntimeExports.jsx(Grid,{item:!0,xs:12,sm:6,children:jsxRuntimeExports.jsxs(Box,{sx:{display:"flex",flexDirection:"column",gap:1},children:[jsxRuntimeExports.jsx(Chip,{icon:jsxRuntimeExports.jsx(TrendingUp,{}),label:"Recommended: Balanced",color:"primary",variant:"outlined"}),jsxRuntimeExports.jsx(Typography$1,{variant:"caption",color:"text.secondary",children:"Best for most monitoring scenarios"})]})})]})]}),jsxRuntimeExports.jsxs(Box,{sx:{mb:3},children:[jsxRuntimeExports.jsx(Typography$1,{variant:"subtitle1",gutterBottom:!0,sx:{fontWeight:600,mb:2},children:"Control limit calculation"}),jsxRuntimeExports.jsx(FormControlLabel,{control:jsxRuntimeExports.jsx(Switch,{checked:!1!==config.config.autoCalculateLimits,onChange:e2=&gt;updateSPCConfig("autoCalculateLimits",e2.target.checked),color:"primary"}),label:jsxRuntimeExports.jsxs(Box,{children:[jsxRuntimeExports.jsx(Typography$1,{variant:"body2",children:"Automatically calculate from historical data"}),jsxRuntimeExports.jsx(Typography$1,{variant:"caption",color:"text.secondary",children:"The system will analyze your data to set appropriate control limits"})]})})]}),!config.config.autoCalculateLimits&amp;&amp;jsxRuntimeExports.jsxs(Box,{sx:{mb:3},children:[jsxRuntimeExports.jsxs(Alert,{severity:"warning",sx:{mb:2},children:[jsxRuntimeExports.jsx(Typography$1,{variant:"body2",sx:{fontWeight:600},children:"Manual Configuration Required"}),jsxRuntimeExports.jsx(Typography$1,{variant:"caption",children:"Enter your control limits based on process specifications or historical analysis"})]}),jsxRuntimeExports.jsxs(Grid,{container:!0,spacing:2,children:[jsxRuntimeExports.jsx(Grid,{item:!0,xs:12,sm:4,children:jsxRuntimeExports.jsx(TextField,{fullWidth:!0,label:"Upper Control Limit (UCL)",type:"text",...createNumericInputProps(config.config.upperControlLimit||"",value=&gt;updateSPCConfig("upperControlLimit",value)),InputProps:{startAdornment:jsxRuntimeExports.jsx(InputAdornment,{position:"start",children:""})},helperText:"Maximum acceptable value"})}),jsxRuntimeExports.jsx(Grid,{item:!0,xs:12,sm:4,children:jsxRuntimeExports.jsx(TextField,{fullWidth:!0,label:"Center Line (Target)",type:"text",...createNumericInputProps(config.config.centerLine||"",value=&gt;updateSPCConfig("centerLine",value)),InputProps:{startAdornment:jsxRuntimeExports.jsx(InputAdornment,{position:"start",children:""})},helperText:"Target or average value"})}),jsxRuntimeExports.jsx(Grid,{item:!0,xs:12,sm:4,children:jsxRuntimeExports.jsx(TextField,{fullWidth:!0,label:"Lower Control Limit (LCL)",type:"text",...createNumericInputProps(config.config.lowerControlLimit||"",value=&gt;updateSPCConfig("lowerControlLimit",value)),InputProps:{startAdornment:jsxRuntimeExports.jsx(InputAdornment,{position:"start",children:""})},helperText:"Minimum acceptable value"})})]})]}),jsxRuntimeExports.jsxs(Box,{sx:{mt:3,p:2,bgcolor:theme=&gt;alpha(theme.palette.primary.main,.08),borderRadius:2,border:"1px solid",borderColor:theme=&gt;alpha(theme.palette.primary.main,.2)},children:[jsxRuntimeExports.jsxs(Typography$1,{variant:"subtitle2",gutterBottom:!0,sx:{display:"flex",alignItems:"center",gap:1},children:[jsxRuntimeExports.jsx(ShowChart,{color:"primary"}),"Your chart will automatically:"]}),jsxRuntimeExports.jsxs(Grid,{container:!0,spacing:2,sx:{mt:.5},children:[jsxRuntimeExports.jsxs(Grid,{item:!0,xs:12,sm:6,children:[jsxRuntimeExports.jsx(Typography$1,{variant:"body2",sx:{display:"flex",alignItems:"center",gap:1},children:" Track process stability"}),jsxRuntimeExports.jsx(Typography$1,{variant:"body2",sx:{display:"flex",alignItems:"center",gap:1},children:" Detect unusual patterns"})]}),jsxRuntimeExports.jsxs(Grid,{item:!0,xs:12,sm:6,children:[jsxRuntimeExports.jsx(Typography$1,{variant:"body2",sx:{display:"flex",alignItems:"center",gap:1},children:" Identify gradual changes"}),jsxRuntimeExports.jsx(Typography$1,{variant:"body2",sx:{display:"flex",alignItems:"center",gap:1},children:" Alert when action is needed"})]})]}),jsxRuntimeExports.jsx(Typography$1,{variant:"caption",color:"text.secondary",sx:{mt:2,display:"block"},children:"Issues are detected using proven statistical methods and displayed with clear recommendations"})]})]})})})},VisualRangeHelper=({visualRangeMin:visualRangeMin,visualRangeMax:visualRangeMax,onVisualRangeChange:onVisualRangeChange,showInline:showInline=!1})=&gt;{const handleMinChange=value=&gt;{const numValue=""===value?void 0:parseFloat(value);onVisualRangeChange&amp;&amp;onVisualRangeChange(numValue,visualRangeMax)},handleMaxChange=value=&gt;{const numValue=""===value?void 0:parseFloat(value);onVisualRangeChange&amp;&amp;onVisualRangeChange(visualRangeMin,numValue)},presets=[{label:"Ultra Precise (1%)",min:-1,max:1},{label:"Tight Control (5%)",min:-5,max:5},{label:"Normal (10%)",min:-10,max:10},{label:"Wide (25%)",min:-25,max:25},{label:"Auto",min:void 0,max:void 0}],helpTooltip=jsxRuntimeExports.jsxs(Box,{sx:{maxWidth:400,p:1},children:[jsxRuntimeExports.jsx(Typography$1,{variant:"subtitle2",gutterBottom:!0,sx:{fontWeight:"bold"},children:" Color Scale Focus"}),jsxRuntimeExports.jsx(Typography$1,{variant:"body2",paragraph:!0,children:"Control which deviation range gets the full color gradient."}),jsxRuntimeExports.jsx(Typography$1,{variant:"body2",sx:{mb:1},children:jsxRuntimeExports.jsx("strong",{children:"Why use this?"})}),jsxRuntimeExports.jsx(Typography$1,{variant:"caption",component:"div",sx:{mb:2},children:"If you have outliers (like -95% deviation), they can compress the color scale, making normal variations (5%) hard to see. Setting limits focuses the colors on your operating range."}),jsxRuntimeExports.jsx(Typography$1,{variant:"body2",sx:{mb:1},children:jsxRuntimeExports.jsx("strong",{children:"Example:"})}),jsxRuntimeExports.jsxs(Typography$1,{variant:"caption",component:"div",children:[" OR Pressure: Use 2% to see tiny variations",jsxRuntimeExports.jsx("br",{})," Zone Temps: Use 10% for comfort monitoring",jsxRuntimeExports.jsx("br",{})," Leave empty for automatic scaling"]})]});return showInline?jsxRuntimeExports.jsxs(Box,{sx:{mt:2},children:[jsxRuntimeExports.jsxs(Box,{sx:{display:"flex",alignItems:"center",gap:1,mb:1},children:[jsxRuntimeExports.jsx(Typography$1,{variant:"subtitle2",children:"Color Scale Focus"}),jsxRuntimeExports.jsx(Tooltip,{title:helpTooltip,placement:"right",children:jsxRuntimeExports.jsx(IconButton,{size:"small",children:jsxRuntimeExports.jsx(HelpOutlineIcon,{fontSize:"small"})})}),(void 0!==visualRangeMin||void 0!==visualRangeMax)&amp;&amp;jsxRuntimeExports.jsx(Chip,{label:"Custom Range Active",size:"small",color:"info",variant:"outlined",icon:jsxRuntimeExports.jsx(AutoFixHighIcon,{})})]}),jsxRuntimeExports.jsxs(Grid,{container:!0,spacing:2,children:[jsxRuntimeExports.jsx(Grid,{item:!0,xs:12,md:6,children:jsxRuntimeExports.jsx(TextField,{fullWidth:!0,size:"small",type:"number",label:"Focus From (%)",placeholder:"Auto",helperText:"Lower limit (e.g., -10 for -10%)",value:void 0!==visualRangeMin?visualRangeMin.toString():"",onChange:e2=&gt;handleMinChange(e2.target.value),inputProps:{step:1,min:-100,max:0}})}),jsxRuntimeExports.jsx(Grid,{item:!0,xs:12,md:6,children:jsxRuntimeExports.jsx(TextField,{fullWidth:!0,size:"small",type:"number",label:"Focus To (%)",placeholder:"Auto",helperText:"Upper limit (e.g., 10 for +10%)",value:void 0!==visualRangeMax?visualRangeMax.toString():"",onChange:e2=&gt;handleMaxChange(e2.target.value),inputProps:{step:1,min:0,max:100}})}),jsxRuntimeExports.jsx(Grid,{item:!0,xs:12,children:jsxRuntimeExports.jsxs(Box,{sx:{display:"flex",gap:1,flexWrap:"wrap"},children:[jsxRuntimeExports.jsx(Typography$1,{variant:"caption",color:"text.secondary",sx:{mr:1},children:"Quick presets:"}),presets.map(preset=&gt;jsxRuntimeExports.jsx(Chip,{label:preset.label,size:"small",variant:"outlined",onClick:()=&gt;{onVisualRangeChange&amp;&amp;onVisualRangeChange(preset.min,preset.max)},color:visualRangeMin===preset.min&amp;&amp;visualRangeMax===preset.max?"primary":"default"},preset.label))]})})]})]}):jsxRuntimeExports.jsxs(Box,{sx:{display:"flex",gap:2,alignItems:"center"},children:[jsxRuntimeExports.jsx(TextField,{size:"small",type:"number",label:"Min %",sx:{width:100},value:void 0!==visualRangeMin?visualRangeMin.toString():"",onChange:e2=&gt;handleMinChange(e2.target.value),inputProps:{step:1,min:-100,max:0}}),jsxRuntimeExports.jsx(Typography$1,{variant:"caption",children:"to"}),jsxRuntimeExports.jsx(TextField,{size:"small",type:"number",label:"Max %",sx:{width:100},value:void 0!==visualRangeMax?visualRangeMax.toString():"",onChange:e2=&gt;handleMaxChange(e2.target.value),inputProps:{step:1,min:0,max:100}}),jsxRuntimeExports.jsx(Tooltip,{title:helpTooltip,children:jsxRuntimeExports.jsx(IconButton,{size:"small",children:jsxRuntimeExports.jsx(HelpOutlineIcon,{fontSize:"small"})})})]})},getPointTypeHints=(chartType,pointType,vavMode)=&gt;{switch(chartType){case"Psychrometric":if("temperature"===pointType)return"Filter by marker tags: air, temp, zone, space, return, supply, discharge";if("humidity"===pointType)return"Filter by marker tags: humidity, rh, wetBulb, dewPoint, moisture";break;case"PerfectEconomizer":if("outdoor_temp"===pointType)return"Filter by marker tags: outside, outdoor, oat, weather, ambient";if("mixed_temp"===pointType)return"Filter by marker tags: mixed, mat, supply, discharge, leaving";if("return_temp"===pointType)return"Filter by marker tags: return, rat, entering, space";break;case"DeviceDeviationHeatmap":return"Select measurement points like temperature, humidity, or pressure sensors"}return"Use the marker tag filter above to find relevant points"},getChartRequirements=(chartType,vavMode)=&gt;{switch(chartType){case"scatter":return{minPoints:2,maxPoints:1e5,description:"Select 2 or more points to compare",pointTypes:[]};case"Psychrometric":return{minPoints:2,maxPoints:2,description:"Select temperature and humidity/dewpoint",pointTypes:[{type:"temperature",label:"Temperature",required:!0},{type:"humidity",label:"Humidity or Dewpoint",required:!0}]};case"PerfectEconomizer":return{minPoints:2,maxPoints:1e5,description:"Select outdoor and mixed air temperatures (additional points optional)",pointTypes:[{type:"outdoor_temp",label:"Outdoor Air Temperature",required:!0},{type:"mixed_temp",label:"Mixed Air Temperature",required:!0},{type:"return_temp",label:"Return Air Temperature",required:!1}]};case"VAVComprehensive":return{minPoints:7,maxPoints:7,description:"Select exactly 7 points in order: 1) Airflow (CFM), 2) Airflow Setpoint (CFM), 3) Damper Position (%), 4) Heating Signal (%), 5) Discharge Air Temp (F), 6) Entering Air Temp (F), 7) Room Temp (F)",pointTypes:[{type:"airflow",label:"Airflow (CFM)",required:!0},{type:"airflow_sp",label:"Airflow Setpoint (CFM)",required:!0},{type:"damper",label:"Damper Position (%)",required:!0},{type:"heating",label:"Heating Signal (%)",required:!0},{type:"dat",label:"Discharge Air Temp (F)",required:!0},{type:"eat",label:"Entering Air Temp (F)",required:!0},{type:"room_temp",label:"Room Temperature (F)",required:!0}]};case"DeviceDeviationHeatmap":return{minPoints:1,maxPoints:1e5,description:"Select measurement points to compare against user-defined targets or ranges",pointTypes:[]};case"Radar":return{minPoints:3,maxPoints:1e5,description:"Select 3 or more metrics for multi-dimensional comparison",pointTypes:[]};case"TimelineChart":return{minPoints:1,maxPoints:1e5,description:"Select points to animate over time",pointTypes:[]};case"CalendarYearHeatmap":return{minPoints:1,maxPoints:1,description:"Select one metric to visualize across the year",pointTypes:[]};case"Sankey":return{minPoints:2,maxPoints:1e5,description:"Select flow points (sources and targets)",pointTypes:[]};case"Treemap":return{minPoints:1,maxPoints:1e5,description:"Select metrics for hierarchical comparison",pointTypes:[]};default:return{minPoints:1,maxPoints:void 0,description:"",pointTypes:[]}}},chartTypes=[{id:"TimeSeries",name:"Line Chart",icon:ShowChart,description:"Track values over time",category:"time-series",tooltip:"Best for: Temperature trends, power consumption, flow rates",useCases:["Monitor equipment performance","Track energy usage","Compare multiple sensors"]},{id:"AreaChart",name:"Area Chart (Overlapping)",icon:Timeline,description:"Compare independent values with overlapping areas",category:"time-series",tooltip:"Best for: Comparing multiple independent metrics with visual emphasis",useCases:["Compare temperatures across zones","Show pressure vs flow rate","Display independent sensor readings"]},{id:"StackedArea",name:"Stacked Area Chart",icon:Timeline,description:"Show cumulative totals and part-to-whole relationships",category:"time-series",tooltip:"Best for: Showing how parts contribute to a total",useCases:["Total energy = sum of all equipment","Building load = sum of all zones","Total flow = sum of all branches"]},{id:"bar",name:"Bar Chart",icon:BarChart,description:"Compare values by time period",category:"time-series",tooltip:"Best for: Daily/hourly comparisons, consumption summaries",useCases:["Daily energy totals","Peak demand by hour","Monthly comparisons"]},{id:"scatter",name:"Scatter Plot",icon:BubbleChart,description:"Find correlations between variables",category:"statistical",tooltip:"Requires: Exactly 2 points to compare",useCases:["OAT vs energy use","Pressure vs flow","Setpoint vs actual"]},{id:"heatmap",name:"Heat Map",icon:Thermostat,description:"Visualize patterns by hour and day",category:"patterns",tooltip:"Best for: Identifying scheduling issues, occupancy patterns",useCases:["Equipment schedules","Peak usage times","Comfort complaints by time"]},{id:"DeviceDeviationHeatmap",name:"Deviation Heatmap",icon:Thermostat,description:"Monitor values against targets",category:"patterns",tooltip:"Shows deviation from user-defined targets or acceptable ranges",useCases:["Monitor comfort conditions","Track equipment performance","Identify out-of-range values"]},{id:"CalendarHeatmap",name:"Calendar View",icon:Timeline,description:"See patterns across months",category:"patterns",tooltip:"Best for: Long-term patterns, seasonal changes",useCases:["Monthly energy patterns","Seasonal equipment usage","Year-over-year comparison"]},{id:"BoxPlot",name:"Box Plot",icon:Assessment,description:"Analyze data distribution",category:"statistical",tooltip:"Best for: Understanding variation, finding outliers",useCases:["Temperature stability","Pressure variations","Identify anomalies"]},{id:"Candlestick",name:"Candlestick",icon:Assessment,description:"Show high/low/open/close",category:"statistical",tooltip:"Best for: Daily ranges, demand patterns",useCases:["Daily temperature range","Peak/min demand","Price volatility"]},{id:"ParallelCoordinates",name:"Parallel Coordinates",icon:AccountTree,description:"Compare many variables at once",category:"statistical",tooltip:"Requires: 3+ related points",useCases:["Multi-zone comparison","Equipment parameters","Complex system analysis"]},{id:"Radar",name:"Radar Chart",icon:Assessment,description:"Multi-metric performance scoring",category:"statistical",tooltip:"Best for: Comparing multiple KPIs in one view",useCases:["Building performance score","Energy efficiency metrics","Equipment health assessment"]},{id:"TimelineChart",name:"Timeline Playback",icon:AccessTime,description:"Animate data evolution over time",category:"advanced",tooltip:"Best for: Showing system changes, event progression",useCases:["Fault progression","Daily operation cycles","Seasonal pattern changes"]},{id:"CalendarYearHeatmap",name:"Yearly Calendar Heatmap",icon:DateRange,description:"Full year daily patterns",category:"advanced",tooltip:"Best for: Annual patterns, seasonal trends",useCases:["Yearly energy consumption","Maintenance patterns","Seasonal equipment usage"]},{id:"Sankey",name:"Sankey Diagram",icon:AccountTree,description:"Visualize energy or resource flows",category:"flow",tooltip:"Best for: Energy distribution, flow analysis",useCases:["Energy flow from utility to end use","Chilled water distribution","Air flow paths"]},{id:"Treemap",name:"Treemap",icon:Assessment,description:"Hierarchical data visualization",category:"flow",tooltip:"Best for: Proportional comparisons, space usage",useCases:["Energy use by building/floor/zone","Equipment runtime proportions","Cost breakdown"]},{id:"ControlBand",name:"Control Band Chart",icon:QueryStats,description:"Monitor values against operating limits",category:"patterns",tooltip:"Visualize data with user-defined upper/lower limits and colored zones",useCases:["Monitor room pressures and humidity","Track equipment performance stability","Identify process anomalies and trends","Quality control for critical parameters"]},{id:"PerfectEconomizer",name:"Perfect Economizer",icon:Air,description:"Analyze free cooling performance",category:"hvac",tooltip:"Requires: OAT, MAT, and optionally RAT",useCases:["Economizer diagnostics","Free cooling savings","Damper operation"]},{id:"Psychrometric",name:"Psychrometric Chart",icon:WbCloudy,description:"Visualize air conditions",category:"hvac",tooltip:"Requires: Temperature and humidity points",useCases:["Comfort analysis","Humidity control","Coil performance"]},{id:"VAVComprehensive",name:"VAV System Diagnostics",icon:DeviceHub,description:"Comprehensive VAV diagnostics with fault detection and health monitoring",category:"hvac",tooltip:"Requires exactly 7 points: Airflow, Airflow SP, Damper %, Heating %, DAT, EAT, Room Temp",useCases:["Fault detection","Energy waste analysis","Performance monitoring","System optimization"]},{id:"ChilledWaterReset",name:"Chilled Water Reset",icon:WaterDrop,description:"Optimize chilled water supply temperature based on load conditions",category:"hvac",tooltip:"Requires: Chilled water supply temp, return temp, and load indicators",useCases:["Energy optimization","System efficiency","Load-based control","Temperature reset strategies"],requiredPoints:3,configurable:!0},{id:"DPOptimization",name:"Differential Pressure Optimization",icon:Speed,description:"Optimize system differential pressure for efficient operation",category:"hvac",tooltip:"Requires: Differential pressure sensor and pump/fan status points",useCases:["Energy savings","Pump optimization","System balancing","Pressure control"],requiredPoints:2,configurable:!0},{id:"SimultaneousHC",name:"Simultaneous Heating &amp; Cooling",icon:SettingsIcon,description:"Detect and analyze simultaneous heating and cooling inefficiencies",category:"hvac",tooltip:"Requires: Heating valve/coil position and cooling valve/coil position",useCases:["Energy waste detection","Control system diagnostics","Efficiency analysis","Fault detection"],requiredPoints:2,configurable:!0}],ChartWizard$1=Object.freeze(Object.defineProperty({__proto__:null,default:({open:open,onClose:onClose,onComplete:onComplete,editingMonitor:editingMonitor,timeRange:dashboardTimeRange})=&gt;{const[activeStep,setActiveStep]=reactExports.useState(0),[selectedWizardTemplate,setSelectedWizardTemplate]=reactExports.useState(null),[deviationConfigs,setDeviationConfigs]=reactExports.useState([]),[activeDeviationTab,setActiveDeviationTab]=reactExports.useState(0),[vavDiagnosticMode,setVavDiagnosticMode]=reactExports.useState("general"),[visualRangeMin,setVisualRangeMin]=reactExports.useState(void 0),[visualRangeMax,setVisualRangeMax]=reactExports.useState(void 0),[config,setConfig]=reactExports.useState({title:"",chartType:"",siteId:"",siteName:"",selectedPoints:[],timeRange:dashboardTimeRange||"24h",config:{aggregation:"none",showLegend:!0,showGrid:!0,yAxisLabel:""}}),[showRestorePrompt,setShowRestorePrompt]=reactExports.useState(!1),{savedState:savedState,clearWizardState:clearWizardState,hasSavedState:hasSavedState}=useWizardStatePersistence(),shouldAutoSave=!editingMonitor&amp;&amp;config.chartType;useWizardAutoSave({step:activeStep,siteId:config.siteId,siteName:config.siteName,selectedPoints:config.selectedPoints.filter(p=&gt;null!=p).map(p=&gt;({id:p.id,name:p.name,unit:p.unit,displayName:p.displayName||void 0,markerTag:p.markerTag||void 0})),chartType:config.chartType,chartTitle:config.title,config:config.config},shouldAutoSave);const[showSuggestions,setShowSuggestions]=reactExports.useState(!1),[appliedSuggestions,setAppliedSuggestions]=reactExports.useState(new Set),[customDateAnchor,setCustomDateAnchor]=reactExports.useState(null),[customStartDate,setCustomStartDate]=reactExports.useState(""),[customEndDate,setCustomEndDate]=reactExports.useState(""),steps=["Chart Type","Site Selection","Data Points","Time Range &amp; Settings"];reactExports.useEffect(()=&gt;{var _a,_b,_c;if(open){if(editingMonitor)return setActiveStep(0),setSelectedWizardTemplate(editingMonitor.template||null),setConfig(editingMonitor),void 0!==(null==(_a=editingMonitor.config)?void 0:_a.visualRangeMinPercent)&amp;&amp;setVisualRangeMin(editingMonitor.config.visualRangeMinPercent),void 0!==(null==(_b=editingMonitor.config)?void 0:_b.visualRangeMaxPercent)&amp;&amp;setVisualRangeMax(editingMonitor.config.visualRangeMaxPercent),(null==(_c=editingMonitor.config)?void 0:_c.pointConfigs)&amp;&amp;setDeviationConfigs(editingMonitor.config.pointConfigs),void setShowRestorePrompt(!1);hasSavedState()&amp;&amp;savedState?setShowRestorePrompt(!0):resetWizardState()}},[open,editingMonitor,hasSavedState,savedState]);const resetWizardState=()=&gt;{setActiveStep(0),setSelectedWizardTemplate(null),setConfig({title:"",chartType:"",siteId:"",siteName:"",selectedPoints:[],timeRange:dashboardTimeRange||"24h",config:{aggregation:"none",showLegend:!0,showGrid:!0,yAxisLabel:""}}),setShowRestorePrompt(!1)};reactExports.useEffect(()=&gt;{selectedWizardTemplate&amp;&amp;setConfig(prev=&gt;({...prev,chartType:selectedWizardTemplate.chartType,config:{...prev.config,...selectedWizardTemplate.defaultConfig},template:selectedWizardTemplate}))},[selectedWizardTemplate]);const{sites:sites,sitesLoading:sitesLoading,sitesError:sitesError,points:pythonPoints,pointsLoading:loadingPythonPoints,selectSite:selectPythonSite,selectedSite:selectedSite}=useSitePoints();reactExports.useEffect(()=&gt;{},[activeStep,sites]),reactExports.useEffect(()=&gt;{config.siteId&amp;&amp;(console.log("[ChartWizard] Selecting site:",config.siteId,"current selectedSite:",null==selectedSite?void 0:selectedSite.id),selectPythonSite(config.siteId))},[config.siteId,selectPythonSite]);const points=pythonPoints,pointsLoading=loadingPythonPoints;reactExports.useEffect(()=&gt;{console.log("[ChartWizard] Points debug:",{siteId:config.siteId,siteName:config.siteName,pointsCount:(null==points?void 0:points.length)||0,pointsLoading:pointsLoading,selectedSite:selectedSite,firstFewPoints:(null==points?void 0:points.slice(0,3).map(p=&gt;({id:p.id,name:p.name})))||[]})},[points,pointsLoading,config.siteId,config.siteName,selectedSite]);const pointSuggestions=reactExports.useMemo(()=&gt;{var _a,_b;if(!config.chartType||!points||0===points.length)return[];const suggestions=[],selectedIds=new Set(config.selectedPoints.filter(p=&gt;null!=p).map(p=&gt;p.id)),availablePoints=points.filter(p=&gt;!selectedIds.has(p.id)),hasZoneTemp=config.selectedPoints.some(p=&gt;{var _a2,_b2;return p&amp;&amp;(null==(_a2=p.markerTag)?void 0:_a2.includes("zone"))&amp;&amp;(null==(_b2=p.markerTag)?void 0:_b2.includes("temp"))}),hasOutdoorTemp=config.selectedPoints.some(p=&gt;{var _a2,_b2;return p&amp;&amp;((null==(_a2=p.markerTag)?void 0:_a2.includes("weather"))||(null==(_b2=p.name)?void 0:_b2.toLowerCase().includes("outdoor")))}),hasEnergy=config.selectedPoints.some(p=&gt;{var _a2,_b2;return p&amp;&amp;((null==(_a2=p.markerTag)?void 0:_a2.includes("energy"))||(null==(_b2=p.unit)?void 0:_b2.toLowerCase().includes("kw")))}),hasHumidity=config.selectedPoints.some(p=&gt;{var _a2,_b2;return p&amp;&amp;((null==(_a2=p.markerTag)?void 0:_a2.includes("humidity"))||(null==(_b2=p.markerTag)?void 0:_b2.includes("rh")))});if(hasEnergy&amp;&amp;!hasOutdoorTemp){availablePoints.filter(p=&gt;{var _a2;return(null==(_a2=p.marker_tags)?void 0:_a2.includes("weather"))||p.name.toLowerCase().includes("weather/")||p.name.toLowerCase().includes("outdoor")||p.name.toLowerCase().includes("oat")}).slice(0,3).forEach((point,idx)=&gt;{suggestions.push({id:`weather-${point.id}`,point:point,reason:"Weather normalization for energy analysis",category:"Weather Correlation",priority:8-idx,complementsSelected:config.selectedPoints.filter(p=&gt;hasEnergy).map(p=&gt;p.name)})})}if(hasZoneTemp&amp;&amp;!hasHumidity){availablePoints.filter(p=&gt;{var _a2,_b2,_c,_d;return(null==(_a2=p.marker_tags)?void 0:_a2.includes("zone"))&amp;&amp;(null==(_b2=p.marker_tags)?void 0:_b2.includes("humidity"))||(null==(_c=p.marker_tags)?void 0:_c.includes("zone"))&amp;&amp;(null==(_d=p.marker_tags)?void 0:_d.includes("rh"))}).slice(0,3).forEach((point,idx)=&gt;{suggestions.push({id:`humidity-${point.id}`,point:point,reason:"Complete comfort analysis with humidity data",category:"Comfort Analysis",priority:7-idx,complementsSelected:config.selectedPoints.filter(p=&gt;{var _a2,_b2;return(null==(_a2=p.markerTag)?void 0:_a2.includes("zone"))&amp;&amp;(null==(_b2=p.markerTag)?void 0:_b2.includes("temp"))}).map(p=&gt;p.name)})})}if("Psychrometric"===config.chartType){const hasTemp=config.selectedPoints.some(p=&gt;{var _a2,_b2;return p&amp;&amp;((null==(_a2=p.markerTag)?void 0:_a2.includes("temp"))||(null==(_b2=p.unit)?void 0:_b2.toLowerCase().includes("")))}),hasRH=config.selectedPoints.some(p=&gt;{var _a2;return p&amp;&amp;((null==(_a2=p.markerTag)?void 0:_a2.includes("humidity"))||"%"===p.unit)});if(hasTemp&amp;&amp;!hasRH){availablePoints.filter(p=&gt;{var _a2,_b2;return(null==(_a2=p.marker_tags)?void 0:_a2.includes("humidity"))||(null==(_b2=p.marker_tags)?void 0:_b2.includes("rh"))}).slice(0,2).forEach((point,idx)=&gt;{suggestions.push({id:`psych-rh-${point.id}`,point:point,reason:"Required for psychrometric analysis",category:"Chart Requirements",priority:10-idx})})}if(hasRH&amp;&amp;!hasTemp){availablePoints.filter(p=&gt;{var _a2,_b2;return(null==(_a2=p.marker_tags)?void 0:_a2.includes("temp"))&amp;&amp;(null==(_b2=p.marker_tags)?void 0:_b2.includes("air"))}).slice(0,2).forEach((point,idx)=&gt;{suggestions.push({id:`psych-temp-${point.id}`,point:point,reason:"Required for psychrometric analysis",category:"Chart Requirements",priority:10-idx})})}}if("scatter"===config.chartType&amp;&amp;1===config.selectedPoints.length){const firstPoint=config.selectedPoints.find(p=&gt;null!=p);if(!firstPoint)return suggestions;let complementaryPoints=[];(null==(_a=firstPoint.markerTag)?void 0:_a.includes("energy"))?complementaryPoints=availablePoints.filter(p=&gt;{var _a2;return(null==(_a2=p.marker_tags)?void 0:_a2.includes("weather"))||p.name.toLowerCase().includes("outdoor")}):(null==(_b=firstPoint.markerTag)?void 0:_b.includes("weather"))&amp;&amp;(complementaryPoints=availablePoints.filter(p=&gt;{var _a2;return null==(_a2=p.marker_tags)?void 0:_a2.includes("energy")})),complementaryPoints.slice(0,3).forEach((point,idx)=&gt;{suggestions.push({id:`scatter-${point.id}`,point:point,reason:"Creates meaningful correlation analysis",category:"Correlation Analysis",priority:8-idx,complementsSelected:[firstPoint.name]})})}if(config.selectedPoints.some(p=&gt;{var _a2,_b2;return p&amp;&amp;(null==(_a2=p.markerTag)?void 0:_a2.includes("temp"))&amp;&amp;(null==(_b2=p.markerTag)?void 0:_b2.includes("sensor"))})){availablePoints.filter(p=&gt;{var _a2;return(null==(_a2=p.marker_tags)?void 0:_a2.includes("setpoint"))||p.name.toLowerCase().includes("setpoint")}).slice(0,2).forEach((point,idx)=&gt;{suggestions.push({id:`setpoint-${point.id}`,point:point,reason:"Compare actual vs setpoint performance",category:"Performance Analysis",priority:6-idx,complementsSelected:config.selectedPoints.filter(p=&gt;{var _a2,_b2;return(null==(_a2=p.markerTag)?void 0:_a2.includes("temp"))&amp;&amp;(null==(_b2=p.markerTag)?void 0:_b2.includes("sensor"))}).map(p=&gt;p.name)})})}return suggestions.sort((a,b)=&gt;b.priority-a.priority)},[config.chartType,config.selectedPoints,points]);reactExports.useMemo(()=&gt;{const groups=[],categorized=new Map;pointSuggestions.forEach(suggestion=&gt;{categorized.has(suggestion.category)||categorized.set(suggestion.category,[]),categorized.get(suggestion.category).push(suggestion)});const categoryIcons={"Weather Correlation":jsxRuntimeExports.jsx(WbCloudy,{}),"Comfort Analysis":jsxRuntimeExports.jsx(Thermostat,{}),"Chart Requirements":jsxRuntimeExports.jsx(CheckCircleIcon,{}),"Correlation Analysis":jsxRuntimeExports.jsx(QueryStats,{}),"Performance Analysis":jsxRuntimeExports.jsx(Assessment,{})};return categorized.forEach((suggestions,category)=&gt;{groups.push({category:category,description:`${suggestions.length} suggestion${1!==suggestions.length?"s":""}`,icon:categoryIcons[category]||jsxRuntimeExports.jsx(TipsAndUpdates,{}),suggestions:suggestions})}),groups},[pointSuggestions]),reactExports.useMemo(()=&gt;(chartType=&gt;{switch(chartType){case"TimeSeries":return[{id:"zone-comfort",name:"Zone Comfort Analysis",description:"Monitor zone temperature, humidity, and outdoor conditions",icon:jsxRuntimeExports.jsx(Thermostat,{}),chartType:"TimeSeries",requiredTags:[["zone","temp","sensor"],["zone","humidity","sensor"]],optionalTags:[["weather"],["setpoint"]],benefits:["Track comfort conditions over time","Correlate indoor conditions with outdoor weather","Identify HVAC performance issues"]},{id:"energy-weather",name:"Energy vs Weather",description:"Analyze energy consumption against outdoor temperature",icon:jsxRuntimeExports.jsx(ElectricBolt,{}),chartType:"TimeSeries",requiredTags:[["energy"],["weather"]],optionalTags:[["setpoint"]],benefits:["Understand energy usage patterns","Identify weather-driven consumption","Optimize control strategies"]}];case"PerfectEconomizer":return[{id:"economizer-opportunity",name:"Economizer Opportunity",description:"Analyze free cooling potential with OAT, RAT, and MAT",icon:jsxRuntimeExports.jsx(Air,{}),chartType:"PerfectEconomizer",requiredTags:[["weather"],["mixed"],["return"]],benefits:["Identify free cooling opportunities","Optimize damper control","Reduce mechanical cooling energy"]}];case"scatter":return[{id:"vav-performance",name:"VAV Performance",description:"Analyze damper position vs zone temperature relationship",icon:jsxRuntimeExports.jsx(DeviceHub,{}),chartType:"scatter",requiredTags:[["damper"],["zone","temp"]],benefits:["Validate VAV control logic","Identify hunting or overshooting","Optimize damper tuning"]}];case"DeviceDeviationHeatmap":return[{id:"zone-deviation",name:"Zone Temperature Deviation",description:"Monitor all zone temperatures against setpoints",icon:jsxRuntimeExports.jsx(Thermostat,{}),chartType:"DeviceDeviationHeatmap",requiredTags:[["zone","temp","sensor"]],optionalTags:[["setpoint"]],benefits:["Instant comfort compliance overview","Identify problem zones","Track setpoint adherence"]}];default:return[]}})(config.chartType),[config.chartType]),reactExports.useEffect(()=&gt;{2===activeStep&amp;&amp;(console.log("[ChartWizard] Step 2 - Points available:",(null==points?void 0:points.length)||0),console.log("[ChartWizard] Points loading:",pointsLoading),console.log("[ChartWizard] Selected site:",selectedSite),console.log("[ChartWizard] Smart suggestions:",pointSuggestions.length))},[activeStep,points,pointsLoading,selectedSite,pointSuggestions.length]);reactExports.useCallback(suggestion=&gt;{var _a;if(config.selectedPoints.some(p=&gt;p&amp;&amp;p.id===suggestion.point.id))return;const newPoint={id:suggestion.point.id,name:suggestion.point.name,unit:suggestion.point.unit||"",markerTag:null==(_a=suggestion.point.marker_tags)?void 0:_a[0]};setConfig(prev=&gt;({...prev,selectedPoints:[...prev.selectedPoints,newPoint]})),setAppliedSuggestions(prev=&gt;new Set([...prev,suggestion.id]))},[config.selectedPoints]),reactExports.useCallback(template=&gt;{var _a;if(!points)return;const newPoints=[];template.requiredTags.forEach(tagGroup=&gt;{var _a2;const matchingPoint=points.find(p=&gt;tagGroup.every(tag=&gt;{var _a3;return null==(_a3=p.marker_tags)?void 0:_a3.includes(tag)}));matchingPoint&amp;&amp;newPoints.push({id:matchingPoint.id,name:matchingPoint.name,unit:matchingPoint.unit||"",markerTag:null==(_a2=matchingPoint.marker_tags)?void 0:_a2[0]})}),null==(_a=template.optionalTags)||_a.forEach(tagGroup=&gt;{var _a2;const matchingPoint=points.find(p=&gt;tagGroup.every(tag=&gt;{var _a3;return null==(_a3=p.marker_tags)?void 0:_a3.includes(tag)}));matchingPoint&amp;&amp;newPoints.push({id:matchingPoint.id,name:matchingPoint.name,unit:matchingPoint.unit||"",markerTag:null==(_a2=matchingPoint.marker_tags)?void 0:_a2[0]})}),setConfig(prev=&gt;({...prev,selectedPoints:newPoints,chartType:template.chartType})),setSelectedWizardTemplate(template)},[points]);const handleStandardPointsChange=reactExports.useCallback(selectedPointsOrUpdater=&gt;{console.log("[ChartWizard] handleStandardPointsChange CALLED:",{updaterType:typeof selectedPointsOrUpdater,isFunction:"function"==typeof selectedPointsOrUpdater,isArray:Array.isArray(selectedPointsOrUpdater),value:Array.isArray(selectedPointsOrUpdater)?`Array(${selectedPointsOrUpdater.length})`:selectedPointsOrUpdater}),setConfig(prevConfig=&gt;{const currentPoints=Array.isArray(prevConfig.selectedPoints)?prevConfig.selectedPoints:[],newPoints="function"==typeof selectedPointsOrUpdater?selectedPointsOrUpdater(currentPoints):selectedPointsOrUpdater;if(!newPoints||!Array.isArray(newPoints))return console.error("[ChartWizard] Invalid points returned:",newPoints),prevConfig;const finalPoints=[...newPoints];return console.log("[ChartWizard] Points changed for standard chart:",{chartType:prevConfig.chartType,previousCount:currentPoints.length,newCount:finalPoints.length,finalPoints:finalPoints}),{...prevConfig,selectedPoints:finalPoints}})},[]),handleSpecialPointsChange=reactExports.useCallback((pointType,index2)=&gt;pointsOrUpdater=&gt;{console.log("[ChartWizard] handleSpecialPointsChange wrapper called:",{pointType:pointType.type,index:index2,updaterType:typeof pointsOrUpdater,isFunction:"function"==typeof pointsOrUpdater}),setConfig(prevConfig=&gt;{var _a,_b;const currentPointArray=(null==(_a=prevConfig.selectedPoints)?void 0:_a[index2])?[prevConfig.selectedPoints[index2]]:[],points2="function"==typeof pointsOrUpdater?pointsOrUpdater(currentPointArray):pointsOrUpdater;console.log("[ChartWizard] Special points processed:",{pointType:pointType.type,index:index2,pointsLength:points2?points2.length:0,points:points2,currentPointArray:currentPointArray});const requiredLength=(null==(_b=getChartRequirements(prevConfig.chartType).pointTypes)?void 0:_b.length)||7,currentPoints=Array.isArray(prevConfig.selectedPoints)?[...prevConfig.selectedPoints]:new Array(requiredLength).fill(null);for(;currentPoints.length&lt;requiredLength;)currentPoints.push(null);if(points2&amp;&amp;points2.length&gt;0){const point=points2[0];console.log("[ChartWizard] Point selected for special chart:",{chartType:prevConfig.chartType,pointType:pointType.type,index:index2,point:point,pointKeys:point?Object.keys(point):[],hasUnit:!!(null==point?void 0:point.unit),unit:null==point?void 0:point.unit,name:null==point?void 0:point.name,id:null==point?void 0:point.id}),currentPoints[index2]=point}else currentPoints[index2]=null;return console.log("[ChartWizard] Updated points array:",{index:index2,updatedPoints:currentPoints,filledSlots:currentPoints.filter(p=&gt;null!==p).length}),{...prevConfig,selectedPoints:currentPoints}})},[vavDiagnosticMode]);reactExports.useEffect(()=&gt;{2===activeStep&amp;&amp;config.chartType&amp;&amp;points&amp;&amp;points.length&gt;0?setShowSuggestions(!0):setShowSuggestions(!1)},[activeStep,config.chartType,points]);const isStepValid=()=&gt;{var _a;let valid=!1;switch(activeStep){case 0:valid=!!config.chartType;break;case 1:valid=!!config.siteId;break;case 2:valid=Array.isArray(config.selectedPoints)&amp;&amp;config.selectedPoints.length&gt;0;break;case 3:valid="DeviceDeviationHeatmap"!==config.chartType||deviationConfigs&amp;&amp;deviationConfigs.length&gt;0;break;default:valid=!1}return console.log("[ChartWizard] Step validation:",{activeStep:activeStep,valid:valid,chartType:config.chartType,siteId:config.siteId,selectedPointsCount:(null==(_a=config.selectedPoints)?void 0:_a.length)||0,selectedPoints:config.selectedPoints}),valid},theme=useTheme(),isMobile=useMediaQuery(theme.breakpoints.down("sm"));useMediaQuery(theme.breakpoints.down("md"));const progress=(activeStep+1)/steps.length*100;return jsxRuntimeExports.jsxs(Dialog,{fullWidth:!0,PaperProps:{sx:{height:isMobile?"100%":"85vh",maxHeight:"85vh",width:"85vw",maxWidth:"900px",display:"flex",flexDirection:"column",bgcolor:"background.paper",backgroundImage:"none"}},className:"chart-wizard-dialog",maxWidth:!1,open:open,onClose:onClose,fullScreen:isMobile,TransitionComponent:isMobile?Slide:void 0,TransitionProps:isMobile?{direction:"up"}:void 0,children:[jsxRuntimeExports.jsxs(DialogTitle,{sx:{p:2,pb:1},children:[jsxRuntimeExports.jsxs(Box,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[jsxRuntimeExports.jsxs(Box,{sx:{display:"flex",alignItems:"center",gap:2},children:[jsxRuntimeExports.jsx(Typography$1,{variant:"h6",sx:{fontSize:"1.1rem",fontWeight:500},children:editingMonitor?"Edit Monitor":"Create Monitor"}),jsxRuntimeExports.jsx(Box,{sx:{display:"flex",gap:1},children:steps.map((label,index2)=&gt;jsxRuntimeExports.jsx(Chip,{label:label,size:"small",color:index2===activeStep?"primary":"default",variant:index2&lt;=activeStep?"filled":"outlined",sx:{fontSize:"0.7rem",height:20,opacity:index2&lt;=activeStep?1:.5}},label))})]}),jsxRuntimeExports.jsx(IconButton,{onClick:onClose,size:"small",children:jsxRuntimeExports.jsx(Close,{fontSize:"small"})})]}),jsxRuntimeExports.jsx(LinearProgress,{variant:"determinate",value:progress,sx:{mt:1,height:2,borderRadius:1,bgcolor:alpha(theme.palette.primary.main,.1),"&amp; .MuiLinearProgress-bar":{borderRadius:1,background:`linear-gradient(90deg, ${theme.palette.primary.main}, ${theme.palette.primary.light})`}}})]}),jsxRuntimeExports.jsx(Divider,{}),jsxRuntimeExports.jsx(DialogContent,{sx:{flex:1,overflow:"auto",p:2},children:jsxRuntimeExports.jsxs(Box,{className:"wizard-content-area",sx:{pb:1},children:[showRestorePrompt&amp;&amp;jsxRuntimeExports.jsxs(Alert,{severity:"info",sx:{mb:3},action:jsxRuntimeExports.jsxs(Box,{sx:{display:"flex",gap:1},children:[jsxRuntimeExports.jsx(Button,{color:"inherit",size:"small",onClick:()=&gt;{clearWizardState(),resetWizardState()},children:"Start Fresh"}),jsxRuntimeExports.jsx(Button,{color:"inherit",size:"small",variant:"outlined",onClick:()=&gt;{savedState&amp;&amp;(setActiveStep(savedState.step||0),setConfig({title:savedState.chartTitle||"",chartType:savedState.chartType||"",siteId:savedState.siteId||"",siteName:savedState.siteName||"",selectedPoints:savedState.selectedPoints||[],timeRange:savedState.timeRange||dashboardTimeRange||"24h",config:savedState.config||{aggregation:"none",showLegend:!0,showGrid:!0,yAxisLabel:""}})),setShowRestorePrompt(!1)},children:"Resume Previous"})]}),children:[jsxRuntimeExports.jsx(Typography$1,{variant:"body2",sx:{fontWeight:500},children:"Previous Session Found"}),jsxRuntimeExports.jsx(Typography$1,{variant:"caption",sx:{display:"block",mt:.5},children:"Would you like to continue where you left off or start a new monitor?"})]}),!showRestorePrompt&amp;&amp;(()=&gt;{var _a,_b,_c,_d,_e,_f,_g,_h,_i,_j,_k,_l,_m,_n,_o,_p,_q,_r,_s,_t,_u,_v,_w,_x,_y,_z,_A,_B,_C,_D;switch(activeStep){case 0:const chartCategories=[{name:"Time Series",types:chartTypes.filter(t=&gt;"time-series"===t.category)},{name:"Pattern Analysis",types:chartTypes.filter(t=&gt;"patterns"===t.category)},{name:"Statistical",types:chartTypes.filter(t=&gt;"statistical"===t.category)},{name:"Advanced Analytics",types:chartTypes.filter(t=&gt;"advanced"===t.category)},{name:"Flow &amp; Hierarchy",types:chartTypes.filter(t=&gt;"flow"===t.category)},{name:"HVAC Diagnostics",types:chartTypes.filter(t=&gt;"hvac"===t.category)}];return jsxRuntimeExports.jsxs(Box,{sx:{maxWidth:"100%"},children:[jsxRuntimeExports.jsx(Typography$1,{sx:{mb:1,fontSize:"1.4rem",fontWeight:600},variant:"h5",children:"Step 1: Choose Your Visualization Type"}),jsxRuntimeExports.jsx(Typography$1,{sx:{mb:3,color:"text.secondary",fontSize:"1rem"},variant:"body1",children:"Select the chart that best fits your analysis needs. Click on any category to explore options."}),chartCategories.map((category,categoryIndex)=&gt;jsxRuntimeExports.jsxs(Accordion,{defaultExpanded:0===categoryIndex,sx:{mb:2,...glassEffect.light,"&amp;:before":{display:"none"},borderRadius:2,overflow:"hidden"},children:[jsxRuntimeExports.jsxs(AccordionSummary,{expandIcon:jsxRuntimeExports.jsx(ExpandMoreIcon,{}),sx:{bgcolor:"rgba(0, 229, 255, 0.05)","&amp;:hover":{bgcolor:"rgba(0, 229, 255, 0.1)"}},children:[jsxRuntimeExports.jsx(Typography$1,{sx:{fontSize:"1.1rem",fontWeight:600,color:"primary.main"},children:category.name}),jsxRuntimeExports.jsxs(Typography$1,{sx:{ml:2,color:"text.secondary"},children:["(",category.types.length," chart types)"]})]}),jsxRuntimeExports.jsx(AccordionDetails,{children:jsxRuntimeExports.jsx(Grid,{container:!0,spacing:2,children:category.types.map(type=&gt;jsxRuntimeExports.jsx(Grid,{item:!0,xs:12,sm:6,md:4,children:jsxRuntimeExports.jsx(Card,{className:"chart-type-card","data-testid":`chart-type-${type.id.toLowerCase()}`,sx:{cursor:"pointer",...glassEffect.light,border:config.chartType===type.id?"2px solid":"1px solid rgba(255, 255, 255, 0.1)",borderColor:config.chartType===type.id?"primary.main":"transparent",transition:"all 0.3s",height:"100%",position:"relative",zIndex:1,"&amp;:hover":{transform:"translateY(-1px)",boxShadow:"0 4px 12px rgba(0, 229, 255, 0.15)",borderColor:"primary.main","&amp; .chart-icon":{color:"primary.main",transform:"scale(1.05)"}}},onClick:()=&gt;setConfig(prevConfig=&gt;({...prevConfig,chartType:type.id})),children:jsxRuntimeExports.jsx(Tooltip,{arrow:!0,placement:"right",title:jsxRuntimeExports.jsxs(Box,{children:[jsxRuntimeExports.jsx(Typography$1,{sx:{fontWeight:"bold",mb:.5},variant:"body2",children:type.tooltip}),jsxRuntimeExports.jsx(Typography$1,{component:"div",variant:"caption",children:"Use cases:"}),type.useCases.map((useCase,i)=&gt;jsxRuntimeExports.jsxs(Typography$1,{component:"div",sx:{ml:1},variant:"caption",children:[" ",useCase]},i))]}),children:jsxRuntimeExports.jsxs(Box,{sx:{height:"100%",position:"relative"},children:[jsxRuntimeExports.jsxs(Box,{className:"chart-preview-overlay",sx:{position:"absolute",top:0,left:0,right:0,bottom:0,opacity:0,transition:"opacity 0.3s",background:"rgba(10, 14, 39, 0.95)",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",zIndex:2,borderRadius:1,pointerEvents:"none",".chart-type-card:hover &amp;":{opacity:1}},children:[jsxRuntimeExports.jsx(Box,{sx:{width:"80%",height:"50%",mb:1},children:jsxRuntimeExports.jsx(ChartPreviewImage,{type:type.id.toLowerCase()})}),jsxRuntimeExports.jsxs(Typography$1,{variant:"caption",sx:{color:"primary.light",fontSize:"0.75rem"},children:[type.name," Preview"]})]}),jsxRuntimeExports.jsxs(CardContent,{sx:{textAlign:"center",p:1.5},children:[jsxRuntimeExports.jsx(type.icon,{className:"chart-icon",sx:{fontSize:28,mb:.5,color:config.chartType===type.id?"primary.main":"text.secondary",transition:"all 0.3s"}}),jsxRuntimeExports.jsx(Typography$1,{sx:{fontSize:"0.85rem",mb:.25,fontWeight:500},variant:"body2",children:type.name}),jsxRuntimeExports.jsx(Typography$1,{sx:{color:"text.secondary",display:"block",fontSize:"0.7rem",lineHeight:1.2},variant:"caption",children:type.description})]})]})})})},type.id))})})]},category.name))]});case 1:return jsxRuntimeExports.jsxs(Box,{children:[jsxRuntimeExports.jsx(Typography$1,{sx:{mb:1,fontSize:"1.4rem",fontWeight:600},variant:"h5",children:"Step 2: Select Your Building or Site"}),jsxRuntimeExports.jsx(Typography$1,{sx:{mb:3,color:"text.secondary",fontSize:"1rem"},variant:"body1",children:"Choose which building or site you want to analyze"}),sitesLoading?jsxRuntimeExports.jsx(Box,{sx:{display:"flex",justifyContent:"center",py:3},children:jsxRuntimeExports.jsx(CircularProgress,{})}):sitesError?jsxRuntimeExports.jsxs(Alert,{severity:"error",sx:{mb:2},children:["Error loading sites:"," ",sitesError instanceof Error?sitesError.message:"Unknown error"]}):Array.isArray(sites)&amp;&amp;0!==sites.length?jsxRuntimeExports.jsx(Grid,{container:!0,spacing:1.5,children:Array.isArray(sites)&amp;&amp;sites.map(site=&gt;jsxRuntimeExports.jsx(Grid,{item:!0,xs:12,sm:6,md:4,children:jsxRuntimeExports.jsx(Card,{className:"site-selection-card","data-testid":`site-card-${site.id}`,sx:{cursor:"pointer",...glassEffect.light,height:"100%",position:"relative",zIndex:1,border:config.siteId===site.name?"3px solid":"1px solid rgba(255, 255, 255, 0.1)",borderColor:config.siteId===site.name?"primary.main":"transparent",transition:"all 0.3s",background:config.siteId===site.name?"linear-gradient(135deg, rgba(0, 229, 255, 0.1) 0%, rgba(0, 229, 255, 0.05) 100%)":"rgba(255, 255, 255, 0.02)","&amp;:hover":{transform:"translateY(-4px)",boxShadow:"0 8px 16px rgba(0, 229, 255, 0.2)",borderColor:"primary.light",background:"linear-gradient(135deg, rgba(0, 229, 255, 0.08) 0%, rgba(0, 229, 255, 0.03) 100%)"}},onClick:()=&gt;{const siteIdentifier=site.name,displayName=site.nice_name||site.name||`Site ${site.id}`;setConfig(prevConfig=&gt;({...prevConfig,siteId:siteIdentifier,siteName:displayName}))},children:jsxRuntimeExports.jsxs(CardContent,{sx:{p:3},children:[jsxRuntimeExports.jsxs(Box,{sx:{display:"flex",alignItems:"center",mb:1},children:[jsxRuntimeExports.jsx(Typography$1,{sx:{fontSize:"1.1rem",fontWeight:600},variant:"h6",children:site.nice_name||site.name||`Site ${site.id}`}),config.siteId===site.name&amp;&amp;jsxRuntimeExports.jsx(CheckCircleIcon,{sx:{ml:"auto",color:"primary.main",fontSize:24}})]}),jsxRuntimeExports.jsx(Typography$1,{sx:{color:"text.secondary",fontSize:"0.875rem"},variant:"body2",children:site.id?`Site ID: ${site.id}`:site.address||site.description||"No site ID"}),site.client&amp;&amp;jsxRuntimeExports.jsx(Chip,{label:`Client: ${site.client}`,size:"small",sx:{mt:1,fontSize:"0.75rem",height:20,bgcolor:"rgba(255, 255, 255, 0.1)"}})]})})},site.id))}):jsxRuntimeExports.jsx(Alert,{severity:"warning",sx:{mb:2},children:"No sites available"})]});case 2:const chartRequirements=getChartRequirements(config.chartType);return chartRequirements.pointTypes.length&gt;0?jsxRuntimeExports.jsxs(Box,{children:[jsxRuntimeExports.jsx(Typography$1,{sx:{mb:1,fontSize:"1.4rem",fontWeight:600},variant:"h5",children:"Step 3: Select Data Points"}),jsxRuntimeExports.jsx(Alert,{severity:"info",sx:{mb:3},children:jsxRuntimeExports.jsx(Typography$1,{sx:{fontWeight:"bold"},variant:"body2",children:chartRequirements.description})}),!1,chartRequirements.pointTypes.map((pointType,index2)=&gt;{var _a2,_b2;return jsxRuntimeExports.jsxs(Paper,{sx:{...glassEffect.light,p:3,mb:2},"data-selector-index":index2,children:[jsxRuntimeExports.jsxs(Typography$1,{sx:{mb:2,display:"flex",alignItems:"center",gap:1},variant:"h6",children:[jsxRuntimeExports.jsx(CheckCircleIcon,{sx:{color:Array.isArray(config.selectedPoints)&amp;&amp;config.selectedPoints[index2]?"success.main":"text.disabled",fontSize:20}}),"Step ",index2+1,": Select ",pointType.label,!pointType.required&amp;&amp;jsxRuntimeExports.jsx(Chip,{label:"Optional",size:"small"})]}),Array.isArray(config.selectedPoints)&amp;&amp;config.selectedPoints[index2]?jsxRuntimeExports.jsxs(Box,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[jsxRuntimeExports.jsxs(Box,{children:[jsxRuntimeExports.jsx(Typography$1,{variant:"body1",children:config.selectedPoints[index2]&amp;&amp;config.selectedPoints[index2].name||"Unknown Point"}),jsxRuntimeExports.jsx(Typography$1,{color:"text.secondary",variant:"caption",children:config.selectedPoints[index2]&amp;&amp;config.selectedPoints[index2].unit||config.selectedPoints[index2]&amp;&amp;(null==(_a2=config.selectedPoints[index2].kv_tags)?void 0:_a2.unit)||config.selectedPoints[index2]&amp;&amp;(null==(_b2=config.selectedPoints[index2].metadata)?void 0:_b2.unit)||pointType.unit||"No unit specified"})]}),jsxRuntimeExports.jsx(Button,{size:"small",onClick:()=&gt;{const newPoints=[...Array.isArray(config.selectedPoints)?config.selectedPoints:[]];newPoints[index2]=null,setConfig(prevConfig=&gt;({...prevConfig,selectedPoints:newPoints}))},children:"Change"})]}):jsxRuntimeExports.jsx(PointSelector,{siteId:(null==selectedSite?void 0:selectedSite.id)||config.siteId,description:getPointTypeHints(config.chartType,pointType.type),error:null,maxPoints:1,selectedPoints:config.selectedPoints&amp;&amp;config.selectedPoints[index2]&amp;&amp;null!==config.selectedPoints[index2]?[config.selectedPoints[index2]]:[],showQuickFilters:!1,enableMultiSelect:!1,enablePreload:!0,showStats:!0,onPointsChange:handleSpecialPointsChange(pointType,index2)})]},pointType.type)}),(!Array.isArray(config.selectedPoints)||config.selectedPoints.length&lt;chartRequirements.minPoints)&amp;&amp;jsxRuntimeExports.jsxs(Alert,{severity:"warning",sx:{mt:2},children:["Please select at least ",chartRequirements.minPoints," points to continue"]})]}):jsxRuntimeExports.jsxs(Box,{children:[jsxRuntimeExports.jsxs(Typography$1,{sx:{mb:1,fontSize:"1.4rem",fontWeight:600},variant:"h5",children:["Step 3: Select Data Points from ",config.siteName]}),jsxRuntimeExports.jsx(Typography$1,{sx:{mb:3,color:"text.secondary",fontSize:"1rem"},variant:"body1",children:"Choose the data points you want to visualize. All available points are shown below."}),!1,jsxRuntimeExports.jsx(PointSelector,{siteId:(null==selectedSite?void 0:selectedSite.id)||config.siteId,description:chartRequirements.description||"",error:null,maxPoints:chartRequirements.maxPoints||void 0,selectedPoints:Array.isArray(config.selectedPoints)?config.selectedPoints:[],enableMultiSelect:!0,onPointsChange:handleStandardPointsChange,showQuickFilters:!1,height:600,enablePreload:!0,showStats:!0})]});case 3:return jsxRuntimeExports.jsxs(Box,{children:[jsxRuntimeExports.jsx(Typography$1,{sx:{mb:1,fontSize:"1.4rem",fontWeight:600},variant:"h5",children:"Step 4: Configure Time Range &amp; Settings"}),jsxRuntimeExports.jsx(Typography$1,{sx:{mb:3,color:"text.secondary",fontSize:"1rem"},variant:"body1",children:"Choose your time range and finalize your chart settings"}),jsxRuntimeExports.jsxs(Grid,{container:!0,spacing:3,children:[jsxRuntimeExports.jsx(Grid,{item:!0,xs:12,children:jsxRuntimeExports.jsx(EnhancedTextField,{label:"Monitor Title",placeholder:selectedWizardTemplate?`${config.siteName} - ${selectedWizardTemplate.name}`:`${config.siteName} ${(null==(_a=chartTypes.find(ct=&gt;ct.id===config.chartType))?void 0:_a.name)||"Chart"}`,value:config.title,onChange:value=&gt;setConfig(prevConfig=&gt;({...prevConfig,title:value})),required:!0,helperText:"Give your monitor a descriptive name",maxLength:100,showCharCount:!0,validation:{min:3,custom:value=&gt;value.trim().length&lt;3?"Title must be at least 3 characters":null}})}),jsxRuntimeExports.jsx(Grid,{item:!0,xs:12,children:jsxRuntimeExports.jsxs(Paper,{sx:{...glassEffect.light,p:3},children:[jsxRuntimeExports.jsxs(Typography$1,{sx:{mb:2,display:"flex",alignItems:"center",gap:1,fontSize:"1.1rem",fontWeight:600},variant:"h6",children:[jsxRuntimeExports.jsx(AccessTime,{sx:{fontSize:24,color:"primary.main"}}),"Select Time Range"]}),jsxRuntimeExports.jsx(Typography$1,{sx:{mb:3,color:"text.secondary"},variant:"body2",children:"How much historical data should the chart display?"}),jsxRuntimeExports.jsxs(Box,{sx:{display:"flex",flexDirection:"column",gap:2},children:[jsxRuntimeExports.jsxs(ToggleButtonGroup,{exclusive:!0,fullWidth:!0,sx:{flexWrap:"wrap","&amp; .MuiToggleButton-root":{flex:"1 1 calc(25% - 8px)",minWidth:120,m:.5}},value:config.timeRange,onChange:(event,newTimeRange)=&gt;{newTimeRange&amp;&amp;"custom"!==newTimeRange&amp;&amp;setConfig({...config,timeRange:newTimeRange})},children:[jsxRuntimeExports.jsx(ToggleButton,{value:"1h",sx:{py:2},children:jsxRuntimeExports.jsxs(Box,{sx:{display:"flex",flexDirection:"column",alignItems:"center",gap:.5},children:[jsxRuntimeExports.jsx(Typography$1,{variant:"h6",sx:{fontWeight:600},children:"1h"}),jsxRuntimeExports.jsx(Typography$1,{color:"text.secondary",variant:"caption",children:"Last Hour"})]})}),jsxRuntimeExports.jsx(ToggleButton,{value:"4h",sx:{py:2},children:jsxRuntimeExports.jsxs(Box,{sx:{display:"flex",flexDirection:"column",alignItems:"center",gap:.5},children:[jsxRuntimeExports.jsx(Typography$1,{variant:"h6",sx:{fontWeight:600},children:"4h"}),jsxRuntimeExports.jsx(Typography$1,{color:"text.secondary",variant:"caption",children:"Last 4 Hours"})]})}),jsxRuntimeExports.jsx(ToggleButton,{value:"24h",sx:{py:2},children:jsxRuntimeExports.jsxs(Box,{sx:{display:"flex",flexDirection:"column",alignItems:"center",gap:.5},children:[jsxRuntimeExports.jsx(Typography$1,{variant:"h6",sx:{fontWeight:600},children:"24h"}),jsxRuntimeExports.jsx(Typography$1,{color:"text.secondary",variant:"caption",children:"Last Day"})]})}),jsxRuntimeExports.jsx(ToggleButton,{value:"7d",sx:{py:2},children:jsxRuntimeExports.jsxs(Box,{sx:{display:"flex",flexDirection:"column",alignItems:"center",gap:.5},children:[jsxRuntimeExports.jsx(Typography$1,{variant:"h6",sx:{fontWeight:600},children:"7d"}),jsxRuntimeExports.jsx(Typography$1,{color:"text.secondary",variant:"caption",children:"Last Week"})]})}),jsxRuntimeExports.jsx(ToggleButton,{value:"30d",sx:{py:2},children:jsxRuntimeExports.jsxs(Box,{sx:{display:"flex",flexDirection:"column",alignItems:"center",gap:.5},children:[jsxRuntimeExports.jsx(Typography$1,{variant:"h6",sx:{fontWeight:600},children:"30d"}),jsxRuntimeExports.jsx(Typography$1,{color:"text.secondary",variant:"caption",children:"Last Month"})]})}),jsxRuntimeExports.jsx(ToggleButton,{value:"90d",sx:{py:2},children:jsxRuntimeExports.jsxs(Box,{sx:{display:"flex",flexDirection:"column",alignItems:"center",gap:.5},children:[jsxRuntimeExports.jsx(Typography$1,{variant:"h6",sx:{fontWeight:600},children:"90d"}),jsxRuntimeExports.jsx(Typography$1,{color:"text.secondary",variant:"caption",children:"Last 90 Days"})]})}),jsxRuntimeExports.jsx(ToggleButton,{value:"180d",sx:{py:2},children:jsxRuntimeExports.jsxs(Box,{sx:{display:"flex",flexDirection:"column",alignItems:"center",gap:.5},children:[jsxRuntimeExports.jsx(Typography$1,{variant:"h6",sx:{fontWeight:600},children:"180d"}),jsxRuntimeExports.jsx(Typography$1,{color:"text.secondary",variant:"caption",children:"Last 6 Months"})]})}),jsxRuntimeExports.jsx(ToggleButton,{value:"365d",sx:{py:2},children:jsxRuntimeExports.jsxs(Box,{sx:{display:"flex",flexDirection:"column",alignItems:"center",gap:.5},children:[jsxRuntimeExports.jsx(Typography$1,{variant:"h6",sx:{fontWeight:600},children:"365d"}),jsxRuntimeExports.jsx(Typography$1,{color:"text.secondary",variant:"caption",children:"Last Year"})]})}),jsxRuntimeExports.jsx(ToggleButton,{value:"custom",sx:{py:2},onClick:e2=&gt;{setCustomDateAnchor(e2.currentTarget),setConfig({...config,timeRange:"custom"})},children:jsxRuntimeExports.jsxs(Box,{sx:{display:"flex",flexDirection:"column",alignItems:"center",gap:.5},children:[jsxRuntimeExports.jsx(DateRange,{sx:{fontSize:28}}),jsxRuntimeExports.jsx(Typography$1,{variant:"caption",sx:{fontWeight:500},children:"Custom Range"})]})})]}),"custom"===config.timeRange&amp;&amp;customStartDate&amp;&amp;customEndDate&amp;&amp;jsxRuntimeExports.jsx(Alert,{severity:"info",sx:{...glassEffect.light},children:jsxRuntimeExports.jsxs(Typography$1,{variant:"caption",children:["Custom range: ",new Date(customStartDate).toLocaleString()," to"," ",new Date(customEndDate).toLocaleString()]})})]}),jsxRuntimeExports.jsx(Popover,{anchorEl:customDateAnchor,anchorOrigin:{vertical:"bottom",horizontal:"left"},open:Boolean(customDateAnchor),onClose:()=&gt;setCustomDateAnchor(null),children:jsxRuntimeExports.jsxs(Box,{sx:{p:3,display:"flex",flexDirection:"column",gap:2,minWidth:300},children:[jsxRuntimeExports.jsx(Typography$1,{variant:"subtitle2",children:"Select Custom Date Range"}),jsxRuntimeExports.jsx(TextField,{fullWidth:!0,InputLabelProps:{shrink:!0},label:"Start Date &amp; Time",type:"datetime-local",value:customStartDate,onChange:e2=&gt;setCustomStartDate(e2.target.value)}),jsxRuntimeExports.jsx(TextField,{fullWidth:!0,InputLabelProps:{shrink:!0},label:"End Date &amp; Time",type:"datetime-local",value:customEndDate,onChange:e2=&gt;setCustomEndDate(e2.target.value)}),jsxRuntimeExports.jsxs(Box,{sx:{display:"flex",gap:1,justifyContent:"flex-end"},children:[jsxRuntimeExports.jsx(Button,{onClick:()=&gt;setCustomDateAnchor(null),children:"Cancel"}),jsxRuntimeExports.jsx(Button,{disabled:!customStartDate||!customEndDate,variant:"contained",onClick:()=&gt;{customStartDate&amp;&amp;customEndDate&amp;&amp;(setConfig({...config,timeRange:`custom:${customStartDate}:${customEndDate}`}),setCustomDateAnchor(null))},children:"Apply"})]})]})})]})}),jsxRuntimeExports.jsx(Grid,{item:!0,xs:12,children:jsxRuntimeExports.jsxs(Paper,{sx:{...glassEffect.light,p:2},children:[jsxRuntimeExports.jsx(Typography$1,{sx:{mb:2},variant:"subtitle2",children:"Configuration Summary"}),jsxRuntimeExports.jsxs(Grid,{container:!0,spacing:2,children:[jsxRuntimeExports.jsxs(Grid,{item:!0,xs:6,children:[jsxRuntimeExports.jsx(Typography$1,{color:"text.secondary",variant:"caption",children:"Template"}),jsxRuntimeExports.jsx(Typography$1,{variant:"body2",children:(null==selectedWizardTemplate?void 0:selectedWizardTemplate.name)||"Custom Chart"})]}),jsxRuntimeExports.jsxs(Grid,{item:!0,xs:6,children:[jsxRuntimeExports.jsx(Typography$1,{color:"text.secondary",variant:"caption",children:"Chart Type"}),jsxRuntimeExports.jsx(Typography$1,{variant:"body2",children:null==(_b=chartTypes.find(ct=&gt;ct.id===config.chartType))?void 0:_b.name})]}),jsxRuntimeExports.jsxs(Grid,{item:!0,xs:6,children:[jsxRuntimeExports.jsx(Typography$1,{color:"text.secondary",variant:"caption",children:"Site"}),jsxRuntimeExports.jsx(Typography$1,{variant:"body2",children:config.siteName})]}),jsxRuntimeExports.jsxs(Grid,{item:!0,xs:6,children:[jsxRuntimeExports.jsx(Typography$1,{color:"text.secondary",variant:"caption",children:"Points Selected"}),jsxRuntimeExports.jsx(Typography$1,{variant:"body2",children:Array.isArray(config.selectedPoints)?config.selectedPoints.length:0})]}),jsxRuntimeExports.jsxs(Grid,{item:!0,xs:6,children:[jsxRuntimeExports.jsx(Typography$1,{color:"text.secondary",variant:"caption",children:"Time Range"}),jsxRuntimeExports.jsxs(Typography$1,{variant:"body2",children:["24h"===config.timeRange&amp;&amp;"Last 24 Hours","7d"===config.timeRange&amp;&amp;"Last 7 Days","30d"===config.timeRange&amp;&amp;"Last 30 Days","6M"===config.timeRange&amp;&amp;"Last 6 Months","1y"===config.timeRange&amp;&amp;"Last Year",(null==(_c=config.timeRange)?void 0:_c.startsWith("custom:"))&amp;&amp;"Custom Range"]})]}),jsxRuntimeExports.jsxs(Grid,{item:!0,xs:12,children:[jsxRuntimeExports.jsx(Typography$1,{color:"text.secondary",variant:"caption",children:"Data Points"}),jsxRuntimeExports.jsx(Box,{sx:{mt:1,display:"flex",flexWrap:"wrap",gap:.5},children:(Array.isArray(config.selectedPoints)?config.selectedPoints:[]).map(point=&gt;jsxRuntimeExports.jsx(Chip,{"data-testid":`selected-point-${point.id}`,label:`${point.name} (${point.unit})`,size:"small",sx:{...glassEffect.light}},point.id))})]})]})]})}),jsxRuntimeExports.jsxs(Grid,{item:!0,xs:12,children:[jsxRuntimeExports.jsxs(Typography$1,{sx:{mb:2,display:"flex",alignItems:"center",gap:1},variant:"subtitle2",children:[jsxRuntimeExports.jsx(SettingsIcon,{sx:{fontSize:20}}),"Chart Settings"]}),jsxRuntimeExports.jsxs(Grid,{container:!0,spacing:2,children:["gauge"!==config.chartType&amp;&amp;"DeviceDeviationHeatmap"!==config.chartType&amp;&amp;jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(Grid,{item:!0,xs:12,sm:6,children:jsxRuntimeExports.jsxs(FormControl,{fullWidth:!0,size:"small",children:[jsxRuntimeExports.jsx(InputLabel,{children:"Data Aggregation"}),jsxRuntimeExports.jsxs(Select,{value:config.config.aggregation||"none",onChange:e2=&gt;setConfig({...config,config:{...config.config,aggregation:e2.target.value}}),children:[jsxRuntimeExports.jsx(MenuItem,{value:"none",children:"None (Raw Data)"}),jsxRuntimeExports.jsx(MenuItem,{value:"avg",children:"Average"}),jsxRuntimeExports.jsx(MenuItem,{value:"sum",children:"Sum"}),jsxRuntimeExports.jsx(MenuItem,{value:"min",children:"Minimum"}),jsxRuntimeExports.jsx(MenuItem,{value:"max",children:"Maximum"})]})]})}),jsxRuntimeExports.jsx(Grid,{item:!0,xs:12,sm:6,children:jsxRuntimeExports.jsx(TextField,{fullWidth:!0,label:"Y-Axis Label",placeholder:"Auto",size:"small",value:config.config.yAxisLabel||"",onChange:e2=&gt;setConfig({...config,config:{...config.config,yAxisLabel:e2.target.value}})})})]}),"PerfectEconomizer"===config.chartType&amp;&amp;jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(Grid,{item:!0,xs:12,children:jsxRuntimeExports.jsx(Typography$1,{sx:{color:"text.secondary",mb:1,display:"block"},variant:"caption",children:"Economizer Configuration"})}),jsxRuntimeExports.jsx(Grid,{item:!0,xs:6,sm:3,children:jsxRuntimeExports.jsx(TextField,{fullWidth:!0,label:"Mixed Air Setpoint (F)",size:"small",type:"number",value:config.config.mixedAirSetpoint||53,onChange:e2=&gt;setConfig({...config,config:{...config.config,mixedAirSetpoint:Number(e2.target.value)}})})}),jsxRuntimeExports.jsx(Grid,{item:!0,xs:6,sm:3,children:jsxRuntimeExports.jsx(TextField,{fullWidth:!0,label:"Min OA %",size:"small",type:"number",value:config.config.minimumOAPercentage||30,onChange:e2=&gt;setConfig({...config,config:{...config.config,minimumOAPercentage:Number(e2.target.value)}})})}),jsxRuntimeExports.jsx(Grid,{item:!0,xs:6,sm:3,children:jsxRuntimeExports.jsx(TextField,{fullWidth:!0,label:"Economizer High Limit (F)",size:"small",type:"number",value:config.config.economizerHighLimit||66,onChange:e2=&gt;setConfig({...config,config:{...config.config,economizerHighLimit:Number(e2.target.value)}})})}),jsxRuntimeExports.jsx(Grid,{item:!0,xs:6,sm:3,children:jsxRuntimeExports.jsx(TextField,{fullWidth:!0,label:"Return Air Temp (F)",size:"small",type:"number",value:config.config.returnAirTemp||73,onChange:e2=&gt;setConfig({...config,config:{...config.config,returnAirTemp:Number(e2.target.value)}})})})]}),"Psychrometric"===config.chartType&amp;&amp;jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(Grid,{item:!0,xs:12,sm:6,children:jsxRuntimeExports.jsxs(FormControl,{fullWidth:!0,size:"small",children:[jsxRuntimeExports.jsx(InputLabel,{children:"Temperature Unit"}),jsxRuntimeExports.jsxs(Select,{value:config.config.temperatureUnit||"F",onChange:e2=&gt;setConfig({...config,config:{...config.config,temperatureUnit:e2.target.value}}),children:[jsxRuntimeExports.jsx(MenuItem,{value:"F",children:"Fahrenheit"}),jsxRuntimeExports.jsx(MenuItem,{value:"C",children:"Celsius"})]})]})}),jsxRuntimeExports.jsx(Grid,{item:!0,xs:12,sm:6,children:jsxRuntimeExports.jsx(FormControlLabel,{control:jsxRuntimeExports.jsx(Switch,{checked:config.config.showComfortZone||!0,onChange:e2=&gt;setConfig({...config,config:{...config.config,showComfortZone:e2.target.checked}})}),label:"Show Comfort Zone"})})]}),"DeviceDeviationHeatmap"===config.chartType&amp;&amp;config.selectedPoints&amp;&amp;config.selectedPoints.length&gt;0&amp;&amp;jsxRuntimeExports.jsx(Grid,{item:!0,xs:12,children:jsxRuntimeExports.jsxs(Box,{sx:{mt:2,p:2,bgcolor:"background.paper",borderRadius:2,border:"1px solid",borderColor:"divider"},children:[jsxRuntimeExports.jsxs(Typography$1,{variant:"h6",gutterBottom:!0,sx:{display:"flex",alignItems:"center",gap:1},children:[jsxRuntimeExports.jsx(SettingsIcon,{}),"Configure Deviation Monitoring"]}),config.selectedPoints.length&gt;1&amp;&amp;jsxRuntimeExports.jsx(Tabs,{value:activeDeviationTab,onChange:(_,v)=&gt;setActiveDeviationTab(v),sx:{mb:2,borderBottom:1,borderColor:"divider"},children:config.selectedPoints.filter(point=&gt;null!=point).map((point,index2)=&gt;jsxRuntimeExports.jsx(Tab,{label:point.name},point.id||index2))}),(()=&gt;{var _a2,_b2,_c2,_d2,_e2,_f2,_g2,_h2,_i2,_j2,_k2,_l2,_m2,_n2,_o2,_p2,_q2,_r2,_s2,_t2,_u2,_v2,_w2,_x2,_y2,_z2,_A2,_B2,_C2,_D2,_E;const activePoint=config.selectedPoints&amp;&amp;config.selectedPoints[activeDeviationTab];return activePoint&amp;&amp;null!==activePoint?jsxRuntimeExports.jsxs(Box,{children:[jsxRuntimeExports.jsxs(Box,{sx:{mb:3},children:[jsxRuntimeExports.jsx(Typography$1,{variant:"subtitle2",gutterBottom:!0,children:"Color Preview"}),jsxRuntimeExports.jsxs(Box,{sx:{height:60,borderRadius:1,background:"linear-gradient(90deg, \n                                  rgb(0, 0, 255) 0%, \n                                  rgb(0, 128, 128) 25%, \n                                  rgb(0, 255, 0) 50%, \n                                  rgb(255, 255, 0) 75%, \n                                  rgb(255, 0, 0) 100%)",display:"flex",alignItems:"center",justifyContent:"space-around",px:2},children:[jsxRuntimeExports.jsx(Typography$1,{variant:"caption",sx:{color:"white",fontWeight:600},children:"Below"}),jsxRuntimeExports.jsx(Typography$1,{variant:"caption",sx:{color:"black",fontWeight:600},children:"Target"}),jsxRuntimeExports.jsx(Typography$1,{variant:"caption",sx:{color:"white",fontWeight:600},children:"Above"})]})]}),jsxRuntimeExports.jsxs(Grid,{container:!0,spacing:2,children:[jsxRuntimeExports.jsx(Grid,{item:!0,xs:12,children:jsxRuntimeExports.jsxs(FormControl,{component:"fieldset",children:[jsxRuntimeExports.jsx(FormLabel,{component:"legend",children:"Monitoring Mode"}),jsxRuntimeExports.jsxs(RadioGroup,{row:!0,value:(null==(_a2=null==deviationConfigs?void 0:deviationConfigs[activeDeviationTab])?void 0:_a2.mode)||"target",onChange:e2=&gt;{const newConfigs=[...deviationConfigs||[]];newConfigs[activeDeviationTab]||(newConfigs[activeDeviationTab]={pointId:activePoint.id||activePoint.name,pointName:activePoint.name,mode:"target",targetValue:0,minValue:0,maxValue:100,colorSensitivity:5,unit:activePoint.unit}),newConfigs[activeDeviationTab].mode=e2.target.value,setDeviationConfigs(newConfigs),setConfig({...config,config:{...config.config,pointConfigs:newConfigs}})},children:[jsxRuntimeExports.jsx(FormControlLabel,{value:"target",control:jsxRuntimeExports.jsx(Radio,{}),label:"Single Target Value"}),jsxRuntimeExports.jsx(FormControlLabel,{value:"range",control:jsxRuntimeExports.jsx(Radio,{}),label:"Min/Max Range"})]})]})}),(!(null==(_b2=null==deviationConfigs?void 0:deviationConfigs[activeDeviationTab])?void 0:_b2.mode)||"target"===(null==(_c2=null==deviationConfigs?void 0:deviationConfigs[activeDeviationTab])?void 0:_c2.mode))&amp;&amp;jsxRuntimeExports.jsx(Grid,{item:!0,xs:12,md:6,children:jsxRuntimeExports.jsx(TextField,{fullWidth:!0,type:"number",label:"Target Value",helperText:`Enter the ideal ${activePoint.name} value`,value:(null==(_d2=null==deviationConfigs?void 0:deviationConfigs[activeDeviationTab])?void 0:_d2.targetValue)||0,onChange:e2=&gt;{const newConfigs=[...deviationConfigs||[]];newConfigs[activeDeviationTab]||(newConfigs[activeDeviationTab]={pointId:activePoint.id||activePoint.name,pointName:activePoint.name,mode:"target",targetValue:0,colorSensitivity:5,unit:activePoint.unit}),newConfigs[activeDeviationTab].targetValue=parseFloat(e2.target.value),setDeviationConfigs(newConfigs),setConfig({...config,config:{...config.config,pointConfigs:newConfigs}})},InputProps:{endAdornment:activePoint.unit&amp;&amp;jsxRuntimeExports.jsx(InputAdornment,{position:"end",children:activePoint.unit})},inputProps:{step:1e-4,min:-9999.9999,max:9999.9999}})}),"range"===(null==(_e2=null==deviationConfigs?void 0:deviationConfigs[activeDeviationTab])?void 0:_e2.mode)&amp;&amp;jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(Grid,{item:!0,xs:12,md:6,children:jsxRuntimeExports.jsx(TextField,{fullWidth:!0,type:"number",label:"Minimum Value",helperText:"Lower bound of acceptable range",value:(null==(_f2=null==deviationConfigs?void 0:deviationConfigs[activeDeviationTab])?void 0:_f2.minValue)||0,onChange:e2=&gt;{const newConfigs=[...deviationConfigs||[]];newConfigs[activeDeviationTab]||(newConfigs[activeDeviationTab]={pointId:activePoint.id||activePoint.name,pointName:activePoint.name,mode:"range",minValue:0,maxValue:100,colorSensitivity:5,unit:activePoint.unit}),newConfigs[activeDeviationTab].minValue=parseFloat(e2.target.value),setDeviationConfigs(newConfigs),setConfig({...config,config:{...config.config,pointConfigs:newConfigs}})},InputProps:{endAdornment:activePoint.unit&amp;&amp;jsxRuntimeExports.jsx(InputAdornment,{position:"end",children:activePoint.unit})},inputProps:{step:1e-4,min:-9999.9999,max:9999.9999}})}),jsxRuntimeExports.jsx(Grid,{item:!0,xs:12,md:6,children:jsxRuntimeExports.jsx(TextField,{fullWidth:!0,type:"number",label:"Maximum Value",helperText:"Upper bound of acceptable range",value:(null==(_g2=null==deviationConfigs?void 0:deviationConfigs[activeDeviationTab])?void 0:_g2.maxValue)||100,onChange:e2=&gt;{const newConfigs=[...deviationConfigs||[]];newConfigs[activeDeviationTab]||(newConfigs[activeDeviationTab]={pointId:activePoint.id||activePoint.name,pointName:activePoint.name,mode:"range",minValue:0,maxValue:100,colorSensitivity:5,unit:activePoint.unit}),newConfigs[activeDeviationTab].maxValue=parseFloat(e2.target.value),setDeviationConfigs(newConfigs),setConfig({...config,config:{...config.config,pointConfigs:newConfigs}})},InputProps:{endAdornment:activePoint.unit&amp;&amp;jsxRuntimeExports.jsx(InputAdornment,{position:"end",children:activePoint.unit})},inputProps:{step:1e-4,min:-9999.9999,max:9999.9999}})})]})]}),jsxRuntimeExports.jsx(Grid,{item:!0,xs:12,md:6,children:jsxRuntimeExports.jsxs(Box,{children:[jsxRuntimeExports.jsx(Typography$1,{variant:"subtitle2",gutterBottom:!0,children:"Color Sensitivity"}),jsxRuntimeExports.jsxs(ButtonGroup,{fullWidth:!0,children:[jsxRuntimeExports.jsx(Button,{variant:(null==(_h2=null==deviationConfigs?void 0:deviationConfigs[activeDeviationTab])?void 0:_h2.colorSensitivity)&gt;=7?"contained":"outlined",onClick:()=&gt;{const newConfigs=[...deviationConfigs||[]];newConfigs[activeDeviationTab]||(newConfigs[activeDeviationTab]={pointId:activePoint.id||activePoint.name,pointName:activePoint.name,mode:"target",targetValue:0,colorSensitivity:8,unit:activePoint.unit}),newConfigs[activeDeviationTab].colorSensitivity=8,setDeviationConfigs(newConfigs),setConfig({...config,config:{...config.config,pointConfigs:newConfigs}})},children:"Tight"}),jsxRuntimeExports.jsx(Button,{variant:(null==(_i2=null==deviationConfigs?void 0:deviationConfigs[activeDeviationTab])?void 0:_i2.colorSensitivity)&gt;=4&amp;&amp;(null==(_j2=null==deviationConfigs?void 0:deviationConfigs[activeDeviationTab])?void 0:_j2.colorSensitivity)&lt;7?"contained":"outlined",onClick:()=&gt;{const newConfigs=[...deviationConfigs||[]];newConfigs[activeDeviationTab]||(newConfigs[activeDeviationTab]={pointId:activePoint.id||activePoint.name,pointName:activePoint.name,mode:"target",targetValue:0,colorSensitivity:5,unit:activePoint.unit}),newConfigs[activeDeviationTab].colorSensitivity=5,setDeviationConfigs(newConfigs),setConfig({...config,config:{...config.config,pointConfigs:newConfigs}})},children:"Normal"}),jsxRuntimeExports.jsx(Button,{variant:(null==(_k2=null==deviationConfigs?void 0:deviationConfigs[activeDeviationTab])?void 0:_k2.colorSensitivity)&lt;4?"contained":"outlined",onClick:()=&gt;{const newConfigs=[...deviationConfigs||[]];newConfigs[activeDeviationTab]||(newConfigs[activeDeviationTab]={pointId:activePoint.id||activePoint.name,pointName:activePoint.name,mode:"target",targetValue:0,colorSensitivity:2,unit:activePoint.unit}),newConfigs[activeDeviationTab].colorSensitivity=2,setDeviationConfigs(newConfigs),setConfig({...config,config:{...config.config,pointConfigs:newConfigs}})},children:"Relaxed"})]}),jsxRuntimeExports.jsx(Typography$1,{variant:"caption",color:"text.secondary",sx:{mt:1,display:"block"},children:(null==(_l2=null==deviationConfigs?void 0:deviationConfigs[activeDeviationTab])?void 0:_l2.colorSensitivity)&gt;=7?"Small deviations will show strong colors":(null==(_m2=null==deviationConfigs?void 0:deviationConfigs[activeDeviationTab])?void 0:_m2.colorSensitivity)&gt;=4?"Balanced sensitivity for typical monitoring":"Only large deviations will show strong colors"})]})}),jsxRuntimeExports.jsxs(Grid,{item:!0,xs:12,children:[jsxRuntimeExports.jsx(Typography$1,{variant:"subtitle2",gutterBottom:!0,children:"Fine-tune Sensitivity"}),jsxRuntimeExports.jsx(Slider,{value:(null==(_n2=null==deviationConfigs?void 0:deviationConfigs[activeDeviationTab])?void 0:_n2.colorSensitivity)||5,onChange:(_,value)=&gt;{const newConfigs=[...deviationConfigs||[]];newConfigs[activeDeviationTab]||(newConfigs[activeDeviationTab]={pointId:activePoint.id||activePoint.name,pointName:activePoint.name,mode:"target",targetValue:0,colorSensitivity:value,unit:activePoint.unit}),newConfigs[activeDeviationTab].colorSensitivity=value,setDeviationConfigs(newConfigs),setConfig({...config,config:{...config.config,pointConfigs:newConfigs}})},min:1,max:10,marks:[{value:1,label:"1"},{value:5,label:"5"},{value:10,label:"10"}],valueLabelDisplay:"auto"})]}),(!(null==(_o2=null==deviationConfigs?void 0:deviationConfigs[activeDeviationTab])?void 0:_o2.mode)||"target"===(null==(_p2=null==deviationConfigs?void 0:deviationConfigs[activeDeviationTab])?void 0:_p2.mode))&amp;&amp;jsxRuntimeExports.jsxs(Grid,{item:!0,xs:12,children:[jsxRuntimeExports.jsx(Divider,{sx:{my:2}}),jsxRuntimeExports.jsxs(Typography$1,{variant:"subtitle2",gutterBottom:!0,sx:{display:"flex",alignItems:"center",gap:1},children:[jsxRuntimeExports.jsx(SettingsIcon,{sx:{fontSize:16}}),"Enhanced Tolerance Configuration (Optional)"]}),jsxRuntimeExports.jsx(Typography$1,{variant:"body2",color:"text.secondary",sx:{mb:2},children:"For precision measurements like room pressure, configure exact tolerance thresholds."}),jsxRuntimeExports.jsxs(Grid,{container:!0,spacing:2,children:[jsxRuntimeExports.jsx(Grid,{item:!0,xs:12,md:4,children:jsxRuntimeExports.jsxs(FormControl,{fullWidth:!0,size:"small",children:[jsxRuntimeExports.jsx(InputLabel,{children:"Tolerance Mode"}),jsxRuntimeExports.jsxs(Select,{value:(null==(_q2=null==deviationConfigs?void 0:deviationConfigs[activeDeviationTab])?void 0:_q2.toleranceMode)||"auto",onChange:e2=&gt;{const newConfigs=[...deviationConfigs||[]];newConfigs[activeDeviationTab]||(newConfigs[activeDeviationTab]={pointId:activePoint.id||activePoint.name,pointName:activePoint.name,mode:"target",targetValue:0,colorSensitivity:5,unit:activePoint.unit}),newConfigs[activeDeviationTab].toleranceMode=e2.target.value,setDeviationConfigs(newConfigs),setConfig({...config,config:{...config.config,pointConfigs:newConfigs}})},children:[jsxRuntimeExports.jsx(MenuItem,{value:"auto",children:"Auto (Use Sensitivity)"}),jsxRuntimeExports.jsx(MenuItem,{value:"absolute",children:"Absolute Values"}),jsxRuntimeExports.jsx(MenuItem,{value:"percentage",children:"Percentage"})]})]})}),(null==(_r2=null==deviationConfigs?void 0:deviationConfigs[activeDeviationTab])?void 0:_r2.toleranceMode)&amp;&amp;"auto"!==(null==(_s2=null==deviationConfigs?void 0:deviationConfigs[activeDeviationTab])?void 0:_s2.toleranceMode)&amp;&amp;jsxRuntimeExports.jsx(Grid,{item:!0,xs:12,md:4,children:jsxRuntimeExports.jsx(TextField,{fullWidth:!0,size:"small",type:"number",label:"Tolerance "+("percentage"===(null==(_t2=null==deviationConfigs?void 0:deviationConfigs[activeDeviationTab])?void 0:_t2.toleranceMode)?"(%)":"("+(activePoint.unit||"")+")"),helperText:"Green to yellow gradient threshold",value:(null==(_u2=null==deviationConfigs?void 0:deviationConfigs[activeDeviationTab])?void 0:_u2.tolerance)||("percentage"===(null==(_v2=null==deviationConfigs?void 0:deviationConfigs[activeDeviationTab])?void 0:_v2.toleranceMode)?1:.001),onChange:e2=&gt;{const newConfigs=[...deviationConfigs||[]];newConfigs[activeDeviationTab]||(newConfigs[activeDeviationTab]={pointId:activePoint.id||activePoint.name,pointName:activePoint.name,mode:"target",targetValue:0,colorSensitivity:5,unit:activePoint.unit}),newConfigs[activeDeviationTab].tolerance=parseFloat(e2.target.value),setDeviationConfigs(newConfigs),setConfig({...config,config:{...config.config,pointConfigs:newConfigs}})},inputProps:{step:"percentage"===(null==(_w2=null==deviationConfigs?void 0:deviationConfigs[activeDeviationTab])?void 0:_w2.toleranceMode)?.1:1e-4,min:0,max:"percentage"===(null==(_x2=null==deviationConfigs?void 0:deviationConfigs[activeDeviationTab])?void 0:_x2.toleranceMode)?100:9999}})}),(null==(_y2=null==deviationConfigs?void 0:deviationConfigs[activeDeviationTab])?void 0:_y2.toleranceMode)&amp;&amp;"auto"!==(null==(_z2=null==deviationConfigs?void 0:deviationConfigs[activeDeviationTab])?void 0:_z2.toleranceMode)&amp;&amp;jsxRuntimeExports.jsx(Grid,{item:!0,xs:12,md:4,children:jsxRuntimeExports.jsx(TextField,{fullWidth:!0,size:"small",type:"number",label:"Critical "+("percentage"===(null==(_A2=null==deviationConfigs?void 0:deviationConfigs[activeDeviationTab])?void 0:_A2.toleranceMode)?"(%)":"("+(activePoint.unit||"")+")"),helperText:"Orange to red gradient threshold",value:(null==(_B2=null==deviationConfigs?void 0:deviationConfigs[activeDeviationTab])?void 0:_B2.criticalThreshold)||("percentage"===(null==(_C2=null==deviationConfigs?void 0:deviationConfigs[activeDeviationTab])?void 0:_C2.toleranceMode)?3:.003),onChange:e2=&gt;{const newConfigs=[...deviationConfigs||[]];newConfigs[activeDeviationTab]||(newConfigs[activeDeviationTab]={pointId:activePoint.id||activePoint.name,pointName:activePoint.name,mode:"target",targetValue:0,colorSensitivity:5,unit:activePoint.unit}),newConfigs[activeDeviationTab].criticalThreshold=parseFloat(e2.target.value),setDeviationConfigs(newConfigs),setConfig({...config,config:{...config.config,pointConfigs:newConfigs}})},inputProps:{step:"percentage"===(null==(_D2=null==deviationConfigs?void 0:deviationConfigs[activeDeviationTab])?void 0:_D2.toleranceMode)?.1:1e-4,min:0,max:"percentage"===(null==(_E=null==deviationConfigs?void 0:deviationConfigs[activeDeviationTab])?void 0:_E.toleranceMode)?100:9999}})}),jsxRuntimeExports.jsxs(Grid,{item:!0,xs:12,children:[jsxRuntimeExports.jsx(Typography$1,{variant:"caption",color:"text.secondary",sx:{mb:1,display:"block"},children:"Quick Presets:"}),jsxRuntimeExports.jsxs(Box,{sx:{display:"flex",gap:1,flexWrap:"wrap"},children:[jsxRuntimeExports.jsx(Button,{size:"small",variant:"outlined",onClick:()=&gt;{const newConfigs=[...deviationConfigs||[]];newConfigs[activeDeviationTab]||(newConfigs[activeDeviationTab]={pointId:activePoint.id||activePoint.name,pointName:activePoint.name,mode:"target",targetValue:.02,colorSensitivity:9,unit:activePoint.unit}),newConfigs[activeDeviationTab]={...newConfigs[activeDeviationTab],targetValue:.02,toleranceMode:"absolute",tolerance:.001,criticalThreshold:.003,colorSensitivity:9},setDeviationConfigs(newConfigs),setConfig({...config,config:{...config.config,pointConfigs:newConfigs}})},children:"Room Pressure"}),jsxRuntimeExports.jsx(Button,{size:"small",variant:"outlined",onClick:()=&gt;{const newConfigs=[...deviationConfigs||[]];newConfigs[activeDeviationTab]||(newConfigs[activeDeviationTab]={pointId:activePoint.id||activePoint.name,pointName:activePoint.name,mode:"target",targetValue:72,colorSensitivity:6,unit:activePoint.unit}),newConfigs[activeDeviationTab]={...newConfigs[activeDeviationTab],targetValue:72,toleranceMode:"absolute",tolerance:1,criticalThreshold:3,colorSensitivity:6},setDeviationConfigs(newConfigs),setConfig({...config,config:{...config.config,pointConfigs:newConfigs}})},children:"Temperature"})]})]})]})]})]}):null})()]})}),("heatmap"===config.chartType||"CalendarHeatmap"===config.chartType)&amp;&amp;jsxRuntimeExports.jsx(jsxRuntimeExports.Fragment,{children:jsxRuntimeExports.jsx(Grid,{item:!0,xs:12,sm:6,children:jsxRuntimeExports.jsxs(FormControl,{fullWidth:!0,size:"small",children:[jsxRuntimeExports.jsx(InputLabel,{children:"Color Scale"}),jsxRuntimeExports.jsxs(Select,{value:config.config.colorScale||"auto",onChange:e2=&gt;setConfig({...config,config:{...config.config,colorScale:e2.target.value}}),children:[jsxRuntimeExports.jsx(MenuItem,{value:"auto",children:"Auto"}),jsxRuntimeExports.jsx(MenuItem,{value:"blue-red",children:"Blue to Red"}),jsxRuntimeExports.jsx(MenuItem,{value:"green-red",children:"Green to Red"}),jsxRuntimeExports.jsx(MenuItem,{value:"viridis",children:"Viridis"})]})]})})}),"DeviceDeviationHeatmap"===config.chartType&amp;&amp;jsxRuntimeExports.jsxs(Grid,{item:!0,xs:12,children:[jsxRuntimeExports.jsx(Divider,{sx:{my:2}}),jsxRuntimeExports.jsx(VisualRangeHelper,{visualRangeMin:visualRangeMin,visualRangeMax:visualRangeMax,onVisualRangeChange:(min,max)=&gt;{setVisualRangeMin(min),setVisualRangeMax(max),setConfig({...config,config:{...config.config,visualRangeMinPercent:min,visualRangeMaxPercent:max}})},showInline:!0})]}),"scatter"===config.chartType&amp;&amp;Array.isArray(config.selectedPoints)&amp;&amp;config.selectedPoints.length&gt;=2&amp;&amp;jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(Grid,{item:!0,xs:12,sm:6,children:jsxRuntimeExports.jsxs(FormControl,{fullWidth:!0,size:"small",children:[jsxRuntimeExports.jsx(InputLabel,{children:"X-Axis Point"}),jsxRuntimeExports.jsx(Select,{value:config.config.xAxisPoint||(Array.isArray(config.selectedPoints)?null==(_d=config.selectedPoints[0])?void 0:_d.id:""),onChange:e2=&gt;setConfig({...config,config:{...config.config,xAxisPoint:e2.target.value}}),children:(Array.isArray(config.selectedPoints)?config.selectedPoints:[]).map(point=&gt;jsxRuntimeExports.jsx(MenuItem,{value:point.id,children:point.name},point.id))})]})}),jsxRuntimeExports.jsx(Grid,{item:!0,xs:12,sm:6,children:jsxRuntimeExports.jsxs(FormControl,{fullWidth:!0,size:"small",children:[jsxRuntimeExports.jsx(InputLabel,{children:"Y-Axis Point"}),jsxRuntimeExports.jsx(Select,{value:config.config.yAxisPoint||(Array.isArray(config.selectedPoints)?null==(_e=config.selectedPoints[1])?void 0:_e.id:""),onChange:e2=&gt;setConfig({...config,config:{...config.config,yAxisPoint:e2.target.value}}),children:(Array.isArray(config.selectedPoints)?config.selectedPoints:[]).map(point=&gt;jsxRuntimeExports.jsx(MenuItem,{value:point.id,children:point.name},point.id))})]})})]}),"SPC"===config.chartType&amp;&amp;jsxRuntimeExports.jsx(SPCWizardConfig,{config:config,setConfig:setConfig}),"ControlBand"===config.chartType&amp;&amp;jsxRuntimeExports.jsx(Grid,{item:!0,xs:12,children:jsxRuntimeExports.jsxs(Paper,{sx:{...glassEffect.light,p:3,mt:2},children:[jsxRuntimeExports.jsxs(Typography$1,{sx:{mb:2,fontWeight:600,display:"flex",alignItems:"center",gap:1},variant:"h6",children:[jsxRuntimeExports.jsx(Tune,{sx:{fontSize:24,color:"primary.main"}}),"Control Band Settings"]}),jsxRuntimeExports.jsx(Typography$1,{sx:{mb:3,color:"text.secondary"},variant:"body2",children:"Define the operating limits and target values for your control band chart"}),jsxRuntimeExports.jsxs(Grid,{container:!0,spacing:3,children:[jsxRuntimeExports.jsx(Grid,{item:!0,xs:12,md:6,children:jsxRuntimeExports.jsx(TextField,{fullWidth:!0,label:"Upper Limit *",type:"text",...createNumericInputProps((null==(_f=config.config)?void 0:_f.upperLimit)??"",value=&gt;setConfig({...config,config:{...config.config,upperLimit:value}})),InputProps:{startAdornment:jsxRuntimeExports.jsx(InputAdornment,{position:"start",children:jsxRuntimeExports.jsx(Typography$1,{color:"error",children:""})})},helperText:"Maximum acceptable value (required)",required:!0})}),jsxRuntimeExports.jsx(Grid,{item:!0,xs:12,md:6,children:jsxRuntimeExports.jsx(TextField,{fullWidth:!0,label:"Lower Limit *",type:"text",...createNumericInputProps((null==(_g=config.config)?void 0:_g.lowerLimit)??"",value=&gt;setConfig({...config,config:{...config.config,lowerLimit:value}})),InputProps:{startAdornment:jsxRuntimeExports.jsx(InputAdornment,{position:"start",children:jsxRuntimeExports.jsx(Typography$1,{color:"error",children:""})})},helperText:"Minimum acceptable value (required)",required:!0})}),jsxRuntimeExports.jsx(Grid,{item:!0,xs:12,md:6,children:jsxRuntimeExports.jsx(TextField,{fullWidth:!0,label:"Target Value",type:"text",...createNumericInputProps((null==(_h=config.config)?void 0:_h.targetValue)??"",value=&gt;setConfig({...config,config:{...config.config,targetValue:value}})),InputProps:{startAdornment:jsxRuntimeExports.jsx(InputAdornment,{position:"start",children:jsxRuntimeExports.jsx(Typography$1,{color:"success.main",children:""})})},helperText:`Ideal operating point (defaults to ${"number"==typeof(null==(_i=config.config)?void 0:_i.upperLimit)&amp;&amp;"number"==typeof(null==(_j=config.config)?void 0:_j.lowerLimit)?((config.config.upperLimit+config.config.lowerLimit)/2).toFixed(4):"midpoint"})`})}),jsxRuntimeExports.jsx(Grid,{item:!0,xs:12,md:6,children:jsxRuntimeExports.jsxs(Box,{children:[jsxRuntimeExports.jsxs(Typography$1,{gutterBottom:!0,children:["Warning Threshold: ",(null==(_k=config.config)?void 0:_k.warningThreshold)||10,"%"]}),jsxRuntimeExports.jsx(Slider,{value:(null==(_l=config.config)?void 0:_l.warningThreshold)||10,onChange:(_,value)=&gt;{setConfig({...config,config:{...config.config,warningThreshold:value}})},min:0,max:50,step:5,marks:[{value:0,label:"0%"},{value:10,label:"10%"},{value:25,label:"25%"},{value:50,label:"50%"}],valueLabelDisplay:"auto",color:"warning"}),jsxRuntimeExports.jsx(Typography$1,{variant:"caption",color:"text.secondary",children:"Distance from limits to trigger warning zone"})]})}),jsxRuntimeExports.jsxs(Grid,{item:!0,xs:12,children:[jsxRuntimeExports.jsx(Divider,{sx:{my:1}}),jsxRuntimeExports.jsx(Typography$1,{sx:{my:2},variant:"subtitle2",children:"Visual Options"})]}),jsxRuntimeExports.jsxs(Grid,{item:!0,xs:12,md:6,children:[jsxRuntimeExports.jsx(FormControlLabel,{control:jsxRuntimeExports.jsx(Switch,{checked:!1!==(null==(_m=config.config)?void 0:_m.showBackgroundZones),onChange:e2=&gt;{setConfig({...config,config:{...config.config,showBackgroundZones:e2.target.checked}})},color:"primary"}),label:"Show Background Zones"}),jsxRuntimeExports.jsx(Typography$1,{variant:"caption",color:"text.secondary",display:"block",children:"Display colored zones for optimal, warning, and out-of-bounds areas"})]}),jsxRuntimeExports.jsxs(Grid,{item:!0,xs:12,md:6,children:[jsxRuntimeExports.jsx(FormControlLabel,{control:jsxRuntimeExports.jsx(Switch,{checked:!1!==(null==(_n=config.config)?void 0:_n.showAlerts),onChange:e2=&gt;{setConfig({...config,config:{...config.config,showAlerts:e2.target.checked}})},color:"primary"}),label:"Show Alert Panel"}),jsxRuntimeExports.jsx(Typography$1,{variant:"caption",color:"text.secondary",display:"block",children:"Display real-time alerts for out-of-bounds readings"})]}),("number"==typeof(null==(_o=config.config)?void 0:_o.upperLimit)&amp;&amp;!isNaN(config.config.upperLimit)||"string"==typeof(null==(_p=config.config)?void 0:_p.upperLimit)&amp;&amp;""!==config.config.upperLimit&amp;&amp;!isNaN(parseFloat(config.config.upperLimit)))&amp;&amp;("number"==typeof(null==(_q=config.config)?void 0:_q.lowerLimit)&amp;&amp;!isNaN(config.config.lowerLimit)||"string"==typeof(null==(_r=config.config)?void 0:_r.lowerLimit)&amp;&amp;""!==config.config.lowerLimit&amp;&amp;!isNaN(parseFloat(config.config.lowerLimit)))&amp;&amp;jsxRuntimeExports.jsx(Grid,{item:!0,xs:12,children:jsxRuntimeExports.jsx(Alert,{severity:"info",sx:{mt:2},children:jsxRuntimeExports.jsxs(Typography$1,{variant:"body2",children:[jsxRuntimeExports.jsx("strong",{children:"Preview:"})," Values between"," ",jsxRuntimeExports.jsx("strong",{children:(config.config.lowerLimit,config.config.lowerLimit)})," and"," ",jsxRuntimeExports.jsx("strong",{children:(config.config.upperLimit,config.config.upperLimit)})," will be considered normal.",void 0!==config.config.targetValue&amp;&amp;""!==config.config.targetValue&amp;&amp;jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[" Target value is ",jsxRuntimeExports.jsx("strong",{children:config.config.targetValue}),"."]}),config.config.warningThreshold&amp;&amp;jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[" Warning zones will be within ",jsxRuntimeExports.jsxs("strong",{children:[config.config.warningThreshold,"%"]})," of limits."]})]})})})]})]})}),"ChilledWaterReset"===config.chartType&amp;&amp;jsxRuntimeExports.jsx(Grid,{item:!0,xs:12,children:jsxRuntimeExports.jsxs(Paper,{sx:{...glassEffect.light,p:3,mt:2},children:[jsxRuntimeExports.jsxs(Typography$1,{sx:{mb:2,fontWeight:600,display:"flex",alignItems:"center",gap:1},variant:"h6",children:[jsxRuntimeExports.jsx(WaterDrop,{sx:{fontSize:24,color:"primary.main"}}),"Chilled Water Reset Settings"]}),jsxRuntimeExports.jsx(Typography$1,{sx:{mb:3,color:"text.secondary"},variant:"body2",children:"Configure the optimal chilled water supply temperature reset strategy"}),jsxRuntimeExports.jsxs(Grid,{container:!0,spacing:3,children:[jsxRuntimeExports.jsx(Grid,{item:!0,xs:12,md:6,children:jsxRuntimeExports.jsx(TextField,{fullWidth:!0,label:"Minimum CHW Supply Temp (F)",type:"text",...createNumericInputProps((null==(_s=config.config)?void 0:_s.minSupplyTemp)??"42",value=&gt;setConfig({...config,config:{...config.config,minSupplyTemp:value}})),helperText:"Lowest allowable chilled water supply temperature"})}),jsxRuntimeExports.jsx(Grid,{item:!0,xs:12,md:6,children:jsxRuntimeExports.jsx(TextField,{fullWidth:!0,label:"Maximum CHW Supply Temp (F)",type:"text",...createNumericInputProps((null==(_t=config.config)?void 0:_t.maxSupplyTemp)??"58",value=&gt;setConfig({...config,config:{...config.config,maxSupplyTemp:value}})),helperText:"Highest allowable chilled water supply temperature"})}),jsxRuntimeExports.jsx(Grid,{item:!0,xs:12,md:6,children:jsxRuntimeExports.jsx(TextField,{fullWidth:!0,label:"Reset Rate (F per unit load)",type:"text",...createNumericInputProps((null==(_u=config.config)?void 0:_u.resetRate)??"0.5",value=&gt;setConfig({...config,config:{...config.config,resetRate:value}})),helperText:"Temperature adjustment rate based on load"})}),jsxRuntimeExports.jsxs(Grid,{item:!0,xs:12,md:6,children:[jsxRuntimeExports.jsx(FormControlLabel,{control:jsxRuntimeExports.jsx(Switch,{checked:!1!==(null==(_v=config.config)?void 0:_v.enableDeadband),onChange:e2=&gt;{setConfig({...config,config:{...config.config,enableDeadband:e2.target.checked}})},color:"primary"}),label:"Enable Reset Deadband"}),jsxRuntimeExports.jsx(Typography$1,{variant:"caption",color:"text.secondary",display:"block",children:"Prevent frequent adjustments within deadband range"})]})]})]})}),"DPOptimization"===config.chartType&amp;&amp;jsxRuntimeExports.jsx(Grid,{item:!0,xs:12,children:jsxRuntimeExports.jsxs(Paper,{sx:{...glassEffect.light,p:3,mt:2},children:[jsxRuntimeExports.jsxs(Typography$1,{sx:{mb:2,fontWeight:600,display:"flex",alignItems:"center",gap:1},variant:"h6",children:[jsxRuntimeExports.jsx(Speed,{sx:{fontSize:24,color:"primary.main"}}),"Differential Pressure Settings"]}),jsxRuntimeExports.jsx(Typography$1,{sx:{mb:3,color:"text.secondary"},variant:"body2",children:"Configure optimal differential pressure control parameters"}),jsxRuntimeExports.jsxs(Grid,{container:!0,spacing:3,children:[jsxRuntimeExports.jsx(Grid,{item:!0,xs:12,md:6,children:jsxRuntimeExports.jsx(TextField,{fullWidth:!0,label:"Target DP Setpoint (in. WC)",type:"text",...createNumericInputProps((null==(_w=config.config)?void 0:_w.targetDP)??"2.0",value=&gt;setConfig({...config,config:{...config.config,targetDP:value}})),helperText:"Desired differential pressure setpoint"})}),jsxRuntimeExports.jsx(Grid,{item:!0,xs:12,md:6,children:jsxRuntimeExports.jsx(TextField,{fullWidth:!0,label:"Minimum DP (in. WC)",type:"text",...createNumericInputProps((null==(_x=config.config)?void 0:_x.minDP)??"0.5",value=&gt;setConfig({...config,config:{...config.config,minDP:value}})),helperText:"Minimum allowable differential pressure"})}),jsxRuntimeExports.jsx(Grid,{item:!0,xs:12,md:6,children:jsxRuntimeExports.jsx(TextField,{fullWidth:!0,label:"Optimization Tolerance (%)",type:"text",...createNumericInputProps((null==(_y=config.config)?void 0:_y.tolerance)??"10",value=&gt;setConfig({...config,config:{...config.config,tolerance:value}})),helperText:"Acceptable variance from target DP"})}),jsxRuntimeExports.jsxs(Grid,{item:!0,xs:12,md:6,children:[jsxRuntimeExports.jsx(FormControlLabel,{control:jsxRuntimeExports.jsx(Switch,{checked:!1!==(null==(_z=config.config)?void 0:_z.enableTrimRespond),onChange:e2=&gt;{setConfig({...config,config:{...config.config,enableTrimRespond:e2.target.checked}})},color:"primary"}),label:"Enable Trim &amp; Respond"}),jsxRuntimeExports.jsx(Typography$1,{variant:"caption",color:"text.secondary",display:"block",children:"Automatic DP setpoint adjustment based on valve positions"})]})]})]})}),"SimultaneousHC"===config.chartType&amp;&amp;jsxRuntimeExports.jsx(Grid,{item:!0,xs:12,children:jsxRuntimeExports.jsxs(Paper,{sx:{...glassEffect.light,p:3,mt:2},children:[jsxRuntimeExports.jsxs(Typography$1,{sx:{mb:2,fontWeight:600,display:"flex",alignItems:"center",gap:1},variant:"h6",children:[jsxRuntimeExports.jsx(SettingsIcon,{sx:{fontSize:24,color:"primary.main"}}),"Simultaneous H&amp;C Detection Settings"]}),jsxRuntimeExports.jsx(Typography$1,{sx:{mb:3,color:"text.secondary"},variant:"body2",children:"Configure thresholds for detecting simultaneous heating and cooling waste"}),jsxRuntimeExports.jsxs(Grid,{container:!0,spacing:3,children:[jsxRuntimeExports.jsx(Grid,{item:!0,xs:12,md:6,children:jsxRuntimeExports.jsx(TextField,{fullWidth:!0,label:"Heating Threshold (%)",type:"text",...createNumericInputProps((null==(_A=config.config)?void 0:_A.heatingThreshold)??"10",value=&gt;setConfig({...config,config:{...config.config,heatingThreshold:value}})),helperText:"Minimum heating valve position to consider active"})}),jsxRuntimeExports.jsx(Grid,{item:!0,xs:12,md:6,children:jsxRuntimeExports.jsx(TextField,{fullWidth:!0,label:"Cooling Threshold (%)",type:"text",...createNumericInputProps((null==(_B=config.config)?void 0:_B.coolingThreshold)??"10",value=&gt;setConfig({...config,config:{...config.config,coolingThreshold:value}})),helperText:"Minimum cooling valve position to consider active"})}),jsxRuntimeExports.jsx(Grid,{item:!0,xs:12,md:6,children:jsxRuntimeExports.jsx(TextField,{fullWidth:!0,label:"Duration Threshold (minutes)",type:"text",...createNumericInputProps((null==(_C=config.config)?void 0:_C.durationThreshold)??"15",value=&gt;setConfig({...config,config:{...config.config,durationThreshold:value}})),helperText:"Minimum duration for fault detection"})}),jsxRuntimeExports.jsxs(Grid,{item:!0,xs:12,md:6,children:[jsxRuntimeExports.jsx(FormControlLabel,{control:jsxRuntimeExports.jsx(Switch,{checked:!1!==(null==(_D=config.config)?void 0:_D.enableAlerts),onChange:e2=&gt;{setConfig({...config,config:{...config.config,enableAlerts:e2.target.checked}})},color:"primary"}),label:"Enable Energy Waste Alerts"}),jsxRuntimeExports.jsx(Typography$1,{variant:"caption",color:"text.secondary",display:"block",children:"Display alerts when simultaneous H&amp;C is detected"})]})]})]})})]})]})]})]});default:return null}})()]})}),jsxRuntimeExports.jsx(Divider,{}),jsxRuntimeExports.jsxs(DialogActions,{sx:{p:1.5,gap:1},children:[jsxRuntimeExports.jsx(Button,{"data-testid":"wizard-back",onClick:()=&gt;{setActiveStep(prev=&gt;prev-1)},disabled:0===activeStep,size:"small",startIcon:jsxRuntimeExports.jsx(ArrowBack,{fontSize:"small"}),sx:{textTransform:"none"},children:"Back"}),jsxRuntimeExports.jsx(Box,{sx:{flex:1}}),jsxRuntimeExports.jsx(Button,{onClick:()=&gt;{onClose()},size:"small",sx:{textTransform:"none"},children:"Cancel"}),activeStep===steps.length-1?jsxRuntimeExports.jsx(Button,{onClick:()=&gt;{var _a,_b,_c;if(!config.title)if(selectedWizardTemplate)config.title=`${config.siteName} - ${selectedWizardTemplate.name}`;else if(selectedWizardTemplate)config.title=`${config.siteName} - ${selectedWizardTemplate.name}`;else{const chartName=(null==(_a=chartTypes.find(ct=&gt;ct.id===config.chartType))?void 0:_a.name)||"Chart";config.title=`${config.siteName} ${chartName}`}const enhancedConfig={...config};switch(enhancedConfig.timeRange&amp;&amp;""!==enhancedConfig.timeRange||(enhancedConfig.timeRange=dashboardTimeRange||"24h"),config.chartType){case"DeviceDeviationHeatmap":if(deviationConfigs&amp;&amp;deviationConfigs.length&gt;0)enhancedConfig.config.pointConfigs=deviationConfigs;else{console.log("[ChartWizard] Generating default deviation configs for points");const{generateDeviationConfig:generateDeviationConfig}=require("../../utils/deviationConfigGenerator");enhancedConfig.config.pointConfigs=enhancedConfig.selectedPoints.map(point=&gt;generateDeviationConfig(point))}break;case"bar":enhancedConfig.config.aggregation||(enhancedConfig.config.aggregation="latest");break;case"Psychrometric":enhancedConfig.config.temperatureUnit||(enhancedConfig.config.temperatureUnit="F"),enhancedConfig.config.showComfortZone||(enhancedConfig.config.showComfortZone=!0);break;case"SPC":enhancedConfig.config.spcChartType||(enhancedConfig.config.spcChartType="xmr"),enhancedConfig.config.sigmaMultiplier||(enhancedConfig.config.sigmaMultiplier=3),void 0===enhancedConfig.config.autoCalculateLimits&amp;&amp;(enhancedConfig.config.autoCalculateLimits=!0),"xmr"===enhancedConfig.config.spcChartType||enhancedConfig.config.subgroupSize||(enhancedConfig.config.subgroupSize=5);break;case"PerfectEconomizer":enhancedConfig.config.mixedAirSetpoint=55,enhancedConfig.config.minimumOAPercentage=20,enhancedConfig.config.preheatSetpoint=45,enhancedConfig.config.coolingSetpoint=75,enhancedConfig.config.returnAirTemp=72,enhancedConfig.config.economizerHighLimit=75,enhancedConfig.config.unit="F";break;case"VAVComprehensive":break;case"gauge":enhancedConfig.config.ranges||(enhancedConfig.config.ranges={normal:{min:0,max:70},warning:{min:70,max:85},critical:{min:85,max:100}})}editingMonitor||clearWizardState(),console.warn("[ChartWizard] Final config being sent to onComplete:",{chartType:enhancedConfig.chartType,title:enhancedConfig.title,siteId:enhancedConfig.siteId,siteName:enhancedConfig.siteName,selectedPointsCount:(null==(_b=enhancedConfig.selectedPoints)?void 0:_b.length)||0,selectedPoints:null==(_c=enhancedConfig.selectedPoints)?void 0:_c.map((p,idx)=&gt;({index:idx,id:p.id,name:p.name,unit:p.unit,hasId:!!p.id,hasName:!!p.name,allKeys:Object.keys(p)})),configKeys:Object.keys(enhancedConfig.config)}),onComplete(enhancedConfig)},variant:"contained",disabled:!isStepValid(),size:"small",startIcon:jsxRuntimeExports.jsx(Check,{fontSize:"small"}),sx:{textTransform:"none"},children:"Create"}):jsxRuntimeExports.jsx(Button,{"data-testid":"wizard-next",onClick:()=&gt;{setActiveStep(prev=&gt;prev+1)},variant:"contained",disabled:!isStepValid(),size:"small",endIcon:jsxRuntimeExports.jsx(ArrowForward,{fontSize:"small"}),sx:{textTransform:"none"},children:"Next"})]})]})}},Symbol.toStringTag,{value:"Module"})),ShareDashboardDialog$1=Object.freeze(Object.defineProperty({__proto__:null,default:({open:open,onClose:onClose,dashboardId:propDashboardId,dashboardName:propDashboardName,dashboard:dashboard})=&gt;{const dashboardId=propDashboardId||(null==dashboard?void 0:dashboard.dashboardId)||(null==dashboard?void 0:dashboard.id),dashboardName=propDashboardName||(null==dashboard?void 0:dashboard.name),user=useSelector(state=&gt;state.auth.firebaseUser),snackbar=useSnackbar(),[shareMode,setShareMode]=reactExports.useState("link"),[isPublic,setIsPublic]=reactExports.useState(!1),[expiresIn,setExpiresIn]=reactExports.useState("never"),[emailAddresses,setEmailAddresses]=reactExports.useState(""),[message,setMessage]=reactExports.useState(""),[copied,setCopied]=reactExports.useState(!1),[permissions,_setPermissions]=reactExports.useState("view"),[_isLoading,setIsLoading]=reactExports.useState(!1),[shareUrl,setShareUrl]=reactExports.useState(""),[_existingShare,_setExistingShare]=reactExports.useState(null),calculateExpirationDate=()=&gt;{if("never"===expiresIn)return null;const now=new Date;switch(expiresIn){case"1d":now.setDate(now.getDate()+1);break;case"7d":now.setDate(now.getDate()+7);break;case"30d":now.setDate(now.getDate()+30);break;case"90d":now.setDate(now.getDate()+90)}return now.toISOString()};return jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsxs(Dialog,{fullWidth:!0,PaperProps:{sx:{...glassEffect.strong}},maxWidth:"sm",open:open,onClose:onClose,children:[jsxRuntimeExports.jsx(DialogTitle,{children:jsxRuntimeExports.jsxs(Box,{sx:{display:"flex",alignItems:"center",gap:2},children:[jsxRuntimeExports.jsx(Share,{}),jsxRuntimeExports.jsx(Typography$1,{variant:"h6",children:"Share Dashboard"})]})}),jsxRuntimeExports.jsx(DialogContent,{children:jsxRuntimeExports.jsxs(Box,{sx:{display:"flex",flexDirection:"column",gap:3,pt:2},children:[jsxRuntimeExports.jsxs(Alert,{severity:"info",sx:{...glassEffect.light},children:["Sharing: ",jsxRuntimeExports.jsx("strong",{children:dashboardName})]}),jsxRuntimeExports.jsxs(Box,{sx:{display:"flex",gap:1},children:[jsxRuntimeExports.jsx(Chip,{color:"link"===shareMode?"primary":"default",icon:jsxRuntimeExports.jsx(LinkIcon,{}),label:"Share Link",sx:{flex:1},onClick:()=&gt;setShareMode("link")}),jsxRuntimeExports.jsx(Chip,{color:"email"===shareMode?"primary":"default",icon:jsxRuntimeExports.jsx(Email,{}),label:"Email Invite",sx:{flex:1},onClick:()=&gt;setShareMode("email")})]}),"link"===shareMode?jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(FormControlLabel,{control:jsxRuntimeExports.jsx(Switch,{checked:isPublic,onChange:e2=&gt;setIsPublic(e2.target.checked)}),label:"Allow public access (no login required)"}),jsxRuntimeExports.jsx(TextField,{fullWidth:!0,InputProps:{readOnly:!0,endAdornment:jsxRuntimeExports.jsx(InputAdornment,{position:"end",children:jsxRuntimeExports.jsx(Tooltip,{title:"Copy link",children:jsxRuntimeExports.jsx(IconButton,{onClick:()=&gt;{navigator.clipboard.writeText(shareUrl),setCopied(!0),setTimeout(()=&gt;setCopied(!1),2e3)},children:jsxRuntimeExports.jsx(ContentCopy,{})})})})},label:"Share Link",value:shareUrl}),jsxRuntimeExports.jsxs(TextField,{fullWidth:!0,select:!0,SelectProps:{native:!0},label:"Link expires",value:expiresIn,onChange:e2=&gt;setExpiresIn(e2.target.value),children:[jsxRuntimeExports.jsx("option",{value:"never",children:"Never"}),jsxRuntimeExports.jsx("option",{value:"1d",children:"1 day"}),jsxRuntimeExports.jsx("option",{value:"7d",children:"7 days"}),jsxRuntimeExports.jsx("option",{value:"30d",children:"30 days"}),jsxRuntimeExports.jsx("option",{value:"90d",children:"90 days"})]})]}):jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(TextField,{fullWidth:!0,multiline:!0,helperText:"Separate multiple emails with commas",label:"Email addresses",placeholder:"Enter email addresses separated by commas",rows:3,value:emailAddresses,onChange:e2=&gt;setEmailAddresses(e2.target.value)}),jsxRuntimeExports.jsx(TextField,{fullWidth:!0,multiline:!0,label:"Message (optional)",placeholder:"Add a personal message...",rows:3,value:message,onChange:e2=&gt;setMessage(e2.target.value)})]}),jsxRuntimeExports.jsx(Alert,{severity:"warning",sx:{...glassEffect.light},children:jsxRuntimeExports.jsx(Typography$1,{variant:"caption",children:isPublic?"Anyone with the link can view this dashboard":"Only users with Building Vitals accounts can access this dashboard"})})]})}),jsxRuntimeExports.jsxs(DialogActions,{children:[jsxRuntimeExports.jsx(Button,{onClick:onClose,children:"Cancel"}),jsxRuntimeExports.jsx(Button,{startIcon:"link"===shareMode?jsxRuntimeExports.jsx(LinkIcon,{}):jsxRuntimeExports.jsx(Email,{}),variant:"contained",onClick:async()=&gt;{if(dashboardId){setIsLoading(!0);try{const shareDashboard=firebaseFunctions.httpsCallable("shareDashboard"),data=(await shareDashboard({dashboardId:dashboardId,isPublic:isPublic,expiresAt:calculateExpirationDate(),permissions:[permissions]})).data;if(data.success){if(setShareUrl(data.shareUrl),snackbar.success("Dashboard shared successfully!"),"email"===shareMode&amp;&amp;emailAddresses.length&gt;0){const subject=encodeURIComponent(`You've been invited to view "${dashboardName}"`),body=encodeURIComponent(`Hi,\n\nYou've been invited to view the dashboard "${dashboardName}".\n\nClick the link below to access it:\n${data.shareUrl}\n\nPermission level: ${permissions}\nThis link expires: ${"never"===expiresIn?"Never":`In ${expiresIn}`}\n\nBest regards,\n${(null==user?void 0:user.email)||"Dashboard Owner"}`),mailtoLink=`mailto:${emailAddresses}?subject=${subject}&amp;body=${body}`;window.open(mailtoLink,"_blank")}}else snackbar.error(data.message||"Failed to share dashboard")}catch(error){console.error("Error sharing dashboard:",error),snackbar.error(error.message||"Failed to share dashboard")}finally{setIsLoading(!1)}}else snackbar.error("Dashboard ID is missing")},children:"link"===shareMode?"Create Link":"Send Invites"})]})]}),jsxRuntimeExports.jsx(Snackbar,{anchorOrigin:{vertical:"bottom",horizontal:"center"},autoHideDuration:2e3,message:"Link copied to clipboard!",open:copied})]})}},Symbol.toStringTag,{value:"Module"})),DashboardSettingsDialog$1=Object.freeze(Object.defineProperty({__proto__:null,default:({open:open,onClose:onClose,dashboardName:dashboardName,onSettingsChange:onSettingsChange})=&gt;{const[settings,setSettings]=reactExports.useState({name:dashboardName,refreshInterval:60,gridColumns:12,animationSpeed:"normal",theme:"dark",autoSave:!0,showTimestamps:!0,compactMode:!1});return jsxRuntimeExports.jsxs(Dialog,{fullWidth:!0,PaperProps:{sx:{...glassEffect.strong}},maxWidth:"sm",open:open,onClose:onClose,children:[jsxRuntimeExports.jsx(DialogTitle,{children:jsxRuntimeExports.jsxs(Box,{sx:{display:"flex",alignItems:"center",gap:2},children:[jsxRuntimeExports.jsx(SettingsIcon,{}),jsxRuntimeExports.jsx(Typography$1,{variant:"h6",children:"Dashboard Settings"})]})}),jsxRuntimeExports.jsx(DialogContent,{children:jsxRuntimeExports.jsxs(Box,{sx:{display:"flex",flexDirection:"column",gap:3,pt:2},children:[jsxRuntimeExports.jsx(TextField,{fullWidth:!0,helperText:"Give your dashboard a descriptive name",label:"Dashboard Name",value:settings.name,onChange:e2=&gt;setSettings({...settings,name:e2.target.value})}),jsxRuntimeExports.jsx(Divider,{sx:{borderColor:"rgba(255, 255, 255, 0.1)"}}),jsxRuntimeExports.jsxs(Box,{children:[jsxRuntimeExports.jsxs(Box,{sx:{display:"flex",alignItems:"center",gap:1,mb:2},children:[jsxRuntimeExports.jsx(Refresh,{}),jsxRuntimeExports.jsx(Typography$1,{variant:"subtitle2",children:"Data Refresh"})]}),jsxRuntimeExports.jsxs(FormControl,{fullWidth:!0,children:[jsxRuntimeExports.jsx(InputLabel,{children:"Refresh Interval"}),jsxRuntimeExports.jsx(Select,{label:"Refresh Interval",value:settings.refreshInterval,onChange:e2=&gt;setSettings({...settings,refreshInterval:Number(e2.target.value)}),children:[{value:0,label:"Manual"},{value:30,label:"30 seconds"},{value:60,label:"1 minute"},{value:300,label:"5 minutes"},{value:600,label:"10 minutes"},{value:1800,label:"30 minutes"}].map(interval=&gt;jsxRuntimeExports.jsx(MenuItem,{value:interval.value,children:interval.label},interval.value))})]})]}),jsxRuntimeExports.jsx(Divider,{sx:{borderColor:"rgba(255, 255, 255, 0.1)"}}),jsxRuntimeExports.jsxs(Box,{children:[jsxRuntimeExports.jsxs(Box,{sx:{display:"flex",alignItems:"center",gap:1,mb:2},children:[jsxRuntimeExports.jsx(GridOn,{}),jsxRuntimeExports.jsx(Typography$1,{variant:"subtitle2",children:"Layout"})]}),jsxRuntimeExports.jsxs(Box,{sx:{px:2},children:[jsxRuntimeExports.jsxs(Typography$1,{gutterBottom:!0,children:["Grid Columns: ",settings.gridColumns]}),jsxRuntimeExports.jsx(Slider,{marks:!0,max:24,min:8,step:2,value:settings.gridColumns,valueLabelDisplay:"auto",onChange:(_,value)=&gt;setSettings({...settings,gridColumns:value})})]}),jsxRuntimeExports.jsx(FormControlLabel,{control:jsxRuntimeExports.jsx(Switch,{checked:settings.compactMode,onChange:e2=&gt;setSettings({...settings,compactMode:e2.target.checked})}),label:"Compact Mode (smaller spacing)",sx:{mt:2}})]}),jsxRuntimeExports.jsx(Divider,{sx:{borderColor:"rgba(255, 255, 255, 0.1)"}}),jsxRuntimeExports.jsxs(Box,{children:[jsxRuntimeExports.jsxs(Box,{sx:{display:"flex",alignItems:"center",gap:1,mb:2},children:[jsxRuntimeExports.jsx(Speed,{}),jsxRuntimeExports.jsx(Typography$1,{variant:"subtitle2",children:"Performance"})]}),jsxRuntimeExports.jsxs(FormControl,{fullWidth:!0,children:[jsxRuntimeExports.jsx(InputLabel,{children:"Animation Speed"}),jsxRuntimeExports.jsxs(Select,{label:"Animation Speed",value:settings.animationSpeed,onChange:e2=&gt;setSettings({...settings,animationSpeed:e2.target.value}),children:[jsxRuntimeExports.jsx(MenuItem,{value:"off",children:"Off"}),jsxRuntimeExports.jsx(MenuItem,{value:"fast",children:"Fast"}),jsxRuntimeExports.jsx(MenuItem,{value:"normal",children:"Normal"}),jsxRuntimeExports.jsx(MenuItem,{value:"slow",children:"Slow"})]})]})]}),jsxRuntimeExports.jsx(Divider,{sx:{borderColor:"rgba(255, 255, 255, 0.1)"}}),jsxRuntimeExports.jsxs(Box,{children:[jsxRuntimeExports.jsx(Typography$1,{sx:{mb:2},variant:"subtitle2",children:"Additional Options"}),jsxRuntimeExports.jsx(FormControlLabel,{control:jsxRuntimeExports.jsx(Switch,{checked:settings.autoSave,onChange:e2=&gt;setSettings({...settings,autoSave:e2.target.checked})}),label:"Auto-save dashboard changes"}),jsxRuntimeExports.jsx(FormControlLabel,{control:jsxRuntimeExports.jsx(Switch,{checked:settings.showTimestamps,onChange:e2=&gt;setSettings({...settings,showTimestamps:e2.target.checked})}),label:"Show last update timestamps"})]}),jsxRuntimeExports.jsx(Alert,{severity:"info",sx:{...glassEffect.light},children:jsxRuntimeExports.jsx(Typography$1,{variant:"caption",children:"These settings apply only to this dashboard and will be saved with your dashboard configuration."})})]})}),jsxRuntimeExports.jsxs(DialogActions,{children:[jsxRuntimeExports.jsx(Button,{onClick:onClose,children:"Cancel"}),jsxRuntimeExports.jsx(Button,{variant:"contained",onClick:()=&gt;{onSettingsChange(settings),onClose()},children:"Save Settings"})]})]})}},Symbol.toStringTag,{value:"Module"})),folderColors=["#00E5FF","#00BFA5","#FF6E40","#FFD740","#7C4DFF","#FF4081","#69F0AE","#FFB74D"],MonitorFoldersDialog$1=Object.freeze(Object.defineProperty({__proto__:null,default:({open:open,onClose:onClose,monitors:monitors,folders:folders,onFoldersChange:onFoldersChange,onMonitorMove:onMonitorMove})=&gt;{const[newFolderName,setNewFolderName]=reactExports.useState(""),[editingFolder,setEditingFolder]=reactExports.useState(null),[editingName,setEditingName]=reactExports.useState(""),[anchorEl,setAnchorEl]=reactExports.useState(null),[selectedFolder,setSelectedFolder]=reactExports.useState(null),handleCreateFolder=()=&gt;{if(newFolderName.trim()){const newFolder={id:`folder-${Date.now()}`,name:newFolderName.trim(),color:folderColors[folders.length%folderColors.length],monitorIds:[],isExpanded:!0};onFoldersChange([...folders,newFolder]),setNewFolderName("")}},getUnassignedMonitors=()=&gt;{const assignedMonitorIds=folders.flatMap(f=&gt;f.monitorIds);return monitors.filter(m=&gt;!assignedMonitorIds.includes(m.id))},getMonitorsInFolder=folderId=&gt;{const folder=folders.find(f=&gt;f.id===folderId);return folder?monitors.filter(m=&gt;folder.monitorIds.includes(m.id)):[]};return jsxRuntimeExports.jsxs(Dialog,{fullWidth:!0,PaperProps:{sx:{...glassEffect.strong,height:"80vh"}},maxWidth:"md",open:open,onClose:onClose,children:[jsxRuntimeExports.jsx(DialogTitle,{children:jsxRuntimeExports.jsxs(Box,{sx:{display:"flex",alignItems:"center",gap:2},children:[jsxRuntimeExports.jsx(FolderIcon,{}),jsxRuntimeExports.jsx(Typography$1,{variant:"h6",children:"Organize Monitors"})]})}),jsxRuntimeExports.jsx(DialogContent,{children:jsxRuntimeExports.jsxs(Box,{sx:{display:"flex",flexDirection:"column",gap:2,height:"100%"},children:[jsxRuntimeExports.jsxs(Box,{sx:{display:"flex",gap:1},children:[jsxRuntimeExports.jsx(TextField,{fullWidth:!0,placeholder:"New folder name...",size:"small",sx:{flex:1},value:newFolderName,onChange:e2=&gt;setNewFolderName(e2.target.value),onKeyPress:e2=&gt;{"Enter"===e2.key&amp;&amp;handleCreateFolder()}}),jsxRuntimeExports.jsx(Button,{disabled:!newFolderName.trim(),startIcon:jsxRuntimeExports.jsx(CreateNewFolder,{}),variant:"contained",onClick:handleCreateFolder,children:"Create"})]}),jsxRuntimeExports.jsx(Divider,{}),jsxRuntimeExports.jsx(DragDropContext,{onDragEnd:result=&gt;{if(!result.destination)return;const{source:source,destination:destination,draggableId:draggableId}=result,monitorId=draggableId.replace("monitor-",""),sourceFolderId="unassigned"===source.droppableId?null:source.droppableId,destFolderId="unassigned"===destination.droppableId?null:destination.droppableId;sourceFolderId!==destFolderId&amp;&amp;onMonitorMove(monitorId,destFolderId)},children:jsxRuntimeExports.jsxs(Box,{sx:{flex:1,overflow:"auto"},children:[folders.map(folder=&gt;jsxRuntimeExports.jsxs(Box,{sx:{mb:2},children:[jsxRuntimeExports.jsxs(Box,{sx:{display:"flex",alignItems:"center",p:1,borderRadius:1,...glassEffect.light,cursor:"pointer"},onClick:()=&gt;{return folderId=folder.id,void onFoldersChange(folders.map(f=&gt;f.id===folderId?{...f,isExpanded:!f.isExpanded}:f));var folderId},children:[jsxRuntimeExports.jsx(IconButton,{size:"small",children:folder.isExpanded?jsxRuntimeExports.jsx(ExpandLess,{}):jsxRuntimeExports.jsx(ExpandMoreIcon,{})}),folder.isExpanded?jsxRuntimeExports.jsx(FolderOpen,{}):jsxRuntimeExports.jsx(FolderIcon,{}),editingFolder===folder.id?jsxRuntimeExports.jsx(TextField,{autoFocus:!0,size:"small",sx:{ml:1,flex:1},value:editingName,onChange:e2=&gt;setEditingName(e2.target.value),onClick:e2=&gt;e2.stopPropagation(),onKeyPress:e2=&gt;{var folderId;"Enter"===e2.key&amp;&amp;(folderId=folder.id,folders.find(f=&gt;f.id===folderId)&amp;&amp;editingName.trim()&amp;&amp;onFoldersChange(folders.map(f=&gt;f.id===folderId?{...f,name:editingName.trim()}:f)),setEditingFolder(null),setEditingName("")),e2.stopPropagation()}}):jsxRuntimeExports.jsx(Typography$1,{sx:{ml:1,flex:1},children:folder.name}),jsxRuntimeExports.jsx(Chip,{label:getMonitorsInFolder(folder.id).length,size:"small",sx:{mr:1,backgroundColor:folder.color}}),jsxRuntimeExports.jsx(IconButton,{size:"small",onClick:e2=&gt;{e2.stopPropagation(),setAnchorEl(e2.currentTarget),setSelectedFolder(folder.id)},children:jsxRuntimeExports.jsx(MoreVert,{})})]}),jsxRuntimeExports.jsx(Collapse,{in:folder.isExpanded,children:jsxRuntimeExports.jsx(ConnectedDroppable,{droppableId:folder.id,children:(provided,snapshot)=&gt;jsxRuntimeExports.jsxs(List,{ref:provided.innerRef,...provided.droppableProps,sx:{ml:4,minHeight:50,backgroundColor:snapshot.isDraggingOver?"rgba(0, 229, 255, 0.1)":"transparent",borderRadius:1,transition:"background-color 0.2s"},children:[getMonitorsInFolder(folder.id).map((monitor,index2)=&gt;jsxRuntimeExports.jsx(PublicDraggable,{draggableId:`monitor-${monitor.id}`,index:index2,children:(provided2,snapshot2)=&gt;jsxRuntimeExports.jsxs(ListItem,{ref:provided2.innerRef,...provided2.draggableProps,sx:{...glassEffect.light,mb:1,borderRadius:1,opacity:snapshot2.isDragging?.5:1},children:[jsxRuntimeExports.jsx(ListItemIcon,{...provided2.dragHandleProps,children:jsxRuntimeExports.jsx(DragIndicator,{})}),jsxRuntimeExports.jsx(ListItemIcon,{children:jsxRuntimeExports.jsx(Dashboard,{fontSize:"small"})}),jsxRuntimeExports.jsx(ListItemText,{primary:monitor.title})]})},monitor.id)),provided.placeholder]})})})]},folder.id)),jsxRuntimeExports.jsxs(Box,{sx:{mt:3},children:[jsxRuntimeExports.jsx(Typography$1,{sx:{mb:1,color:"text.secondary"},variant:"subtitle2",children:"Unassigned Monitors"}),jsxRuntimeExports.jsx(ConnectedDroppable,{droppableId:"unassigned",children:(provided,snapshot)=&gt;jsxRuntimeExports.jsxs(List,{ref:provided.innerRef,...provided.droppableProps,sx:{minHeight:100,backgroundColor:snapshot.isDraggingOver?"rgba(0, 229, 255, 0.1)":"rgba(255, 255, 255, 0.05)",borderRadius:1,border:"2px dashed rgba(255, 255, 255, 0.2)",p:1},children:[getUnassignedMonitors().map((monitor,index2)=&gt;jsxRuntimeExports.jsx(PublicDraggable,{draggableId:`monitor-${monitor.id}`,index:index2,children:(provided2,snapshot2)=&gt;jsxRuntimeExports.jsxs(ListItem,{ref:provided2.innerRef,...provided2.draggableProps,sx:{...glassEffect.light,mb:1,borderRadius:1,opacity:snapshot2.isDragging?.5:1},children:[jsxRuntimeExports.jsx(ListItemIcon,{...provided2.dragHandleProps,children:jsxRuntimeExports.jsx(DragIndicator,{})}),jsxRuntimeExports.jsx(ListItemIcon,{children:jsxRuntimeExports.jsx(Dashboard,{fontSize:"small"})}),jsxRuntimeExports.jsx(ListItemText,{primary:monitor.title})]})},monitor.id)),provided.placeholder,0===getUnassignedMonitors().length&amp;&amp;jsxRuntimeExports.jsx(Typography$1,{sx:{textAlign:"center",color:"text.secondary",py:3},variant:"body2",children:"Drag monitors here to unassign them"})]})})]})]})}),jsxRuntimeExports.jsx(Alert,{severity:"info",sx:{...glassEffect.light},children:jsxRuntimeExports.jsx(Typography$1,{variant:"caption",children:"Drag and drop monitors between folders to organize your dashboard. Folders help you group related monitors together."})})]})}),jsxRuntimeExports.jsx(DialogActions,{children:jsxRuntimeExports.jsx(Button,{onClick:onClose,children:"Close"})}),jsxRuntimeExports.jsxs(Menu,{anchorEl:anchorEl,open:Boolean(anchorEl),onClose:()=&gt;setAnchorEl(null),children:[jsxRuntimeExports.jsxs(MenuItem,{onClick:()=&gt;{var _a;setEditingFolder(selectedFolder),setEditingName((null==(_a=folders.find(f=&gt;f.id===selectedFolder))?void 0:_a.name)||""),setAnchorEl(null)},children:[jsxRuntimeExports.jsx(Edit,{fontSize:"small",sx:{mr:1}}),"Rename"]}),jsxRuntimeExports.jsxs(MenuItem,{sx:{color:"error.main"},onClick:()=&gt;{selectedFolder&amp;&amp;(folderId=&gt;{const folder=folders.find(f=&gt;f.id===folderId);folder&amp;&amp;(folder.monitorIds.forEach(monitorId=&gt;{onMonitorMove(monitorId,null)}),onFoldersChange(folders.filter(f=&gt;f.id!==folderId))),setAnchorEl(null)})(selectedFolder)},children:[jsxRuntimeExports.jsx(Delete,{fontSize:"small",sx:{mr:1}}),"Delete"]})]})]})}},Symbol.toStringTag,{value:"Module"})),MonitorSnapshotsDialog$1=Object.freeze(Object.defineProperty({__proto__:null,default:({open:open,onClose:onClose,snapshots:snapshots,onSnapshotCreate:onSnapshotCreate,onSnapshotDelete:onSnapshotDelete,onSnapshotRestore:onSnapshotRestore,onSnapshotExport:onSnapshotExport,currentMonitor:currentMonitor})=&gt;{const[showCreateForm,setShowCreateForm]=reactExports.useState(!1),[snapshotName,setSnapshotName]=reactExports.useState(""),[snapshotDescription,setSnapshotDescription]=reactExports.useState(""),[snapshotTags,setSnapshotTags]=reactExports.useState(""),[filterTag,setFilterTag]=reactExports.useState(null),allTags=Array.from(new Set(snapshots.flatMap(s=&gt;s.tags))),filteredSnapshots=filterTag?snapshots.filter(s=&gt;s.tags.includes(filterTag)):snapshots,groupedSnapshots=filteredSnapshots.reduce((acc,snapshot)=&gt;(acc[snapshot.monitorId]||(acc[snapshot.monitorId]={monitorTitle:snapshot.monitorTitle,snapshots:[]}),acc[snapshot.monitorId].snapshots.push(snapshot),acc),{});return jsxRuntimeExports.jsxs(Dialog,{fullWidth:!0,PaperProps:{sx:{...glassEffect.strong,height:"80vh"}},maxWidth:"md",open:open,onClose:onClose,children:[jsxRuntimeExports.jsx(DialogTitle,{children:jsxRuntimeExports.jsxs(Box,{sx:{display:"flex",alignItems:"center",gap:2},children:[jsxRuntimeExports.jsx(CameraAlt,{}),jsxRuntimeExports.jsx(Typography$1,{variant:"h6",children:"Monitor Snapshots"}),jsxRuntimeExports.jsx(Box,{sx:{flex:1}}),currentMonitor&amp;&amp;jsxRuntimeExports.jsx(Button,{size:"small",startIcon:jsxRuntimeExports.jsx(CameraAlt,{}),variant:"contained",onClick:()=&gt;setShowCreateForm(!showCreateForm),children:"Create Snapshot"})]})}),jsxRuntimeExports.jsx(DialogContent,{children:jsxRuntimeExports.jsxs(Box,{sx:{display:"flex",flexDirection:"column",gap:2},children:[showCreateForm&amp;&amp;currentMonitor&amp;&amp;jsxRuntimeExports.jsxs(Card,{sx:{...glassEffect.medium,p:2},children:[jsxRuntimeExports.jsxs(Typography$1,{sx:{mb:2},variant:"subtitle1",children:['Create Snapshot for "',currentMonitor.title,'"']}),jsxRuntimeExports.jsxs(Box,{sx:{display:"flex",flexDirection:"column",gap:2},children:[jsxRuntimeExports.jsx(TextField,{fullWidth:!0,required:!0,label:"Snapshot Name",placeholder:"e.g., Peak Temperature Alert",value:snapshotName,onChange:e2=&gt;setSnapshotName(e2.target.value)}),jsxRuntimeExports.jsx(TextField,{fullWidth:!0,multiline:!0,label:"Description",placeholder:"Optional description...",rows:2,value:snapshotDescription,onChange:e2=&gt;setSnapshotDescription(e2.target.value)}),jsxRuntimeExports.jsx(TextField,{fullWidth:!0,helperText:"Use tags to organize and filter snapshots",label:"Tags",placeholder:"Comma-separated tags: alert, temperature, peak",value:snapshotTags,onChange:e2=&gt;setSnapshotTags(e2.target.value)}),jsxRuntimeExports.jsxs(Box,{sx:{display:"flex",gap:1,justifyContent:"flex-end"},children:[jsxRuntimeExports.jsx(Button,{onClick:()=&gt;setShowCreateForm(!1),children:"Cancel"}),jsxRuntimeExports.jsx(Button,{disabled:!snapshotName.trim(),variant:"contained",onClick:()=&gt;{if(!currentMonitor||!snapshotName.trim())return;const tags=snapshotTags.split(",").map(tag=&gt;tag.trim()).filter(tag=&gt;tag);onSnapshotCreate({monitorId:currentMonitor.id,monitorTitle:currentMonitor.title,name:snapshotName.trim(),description:snapshotDescription.trim()||void 0,tags:tags,chartImage:currentMonitor.chartImage,data:currentMonitor.data,timeRange:currentMonitor.timeRange,config:currentMonitor.config}),setSnapshotName(""),setSnapshotDescription(""),setSnapshotTags(""),setShowCreateForm(!1)},children:"Create"})]})]})]}),allTags.length&gt;0&amp;&amp;jsxRuntimeExports.jsxs(Box,{sx:{display:"flex",gap:1,flexWrap:"wrap"},children:[jsxRuntimeExports.jsx(Chip,{color:filterTag?"default":"primary",label:"All",sx:{...glassEffect.light},onClick:()=&gt;setFilterTag(null)}),allTags.map(tag=&gt;jsxRuntimeExports.jsx(Chip,{color:filterTag===tag?"primary":"default",label:tag,sx:{...glassEffect.light},onClick:()=&gt;setFilterTag(tag)},tag))]}),jsxRuntimeExports.jsx(Divider,{}),0===filteredSnapshots.length?jsxRuntimeExports.jsx(Alert,{severity:"info",sx:{...glassEffect.light},children:0===snapshots.length?"No snapshots created yet. Create a snapshot to bookmark important chart states.":"No snapshots match the selected filter."}):jsxRuntimeExports.jsx(Box,{sx:{flex:1,overflow:"auto"},children:Object.entries(groupedSnapshots).map(([monitorId,group])=&gt;jsxRuntimeExports.jsxs(Box,{sx:{mb:3},children:[jsxRuntimeExports.jsx(Typography$1,{sx:{mb:1,color:"text.secondary"},variant:"subtitle2",children:group.monitorTitle}),jsxRuntimeExports.jsx(Grid,{container:!0,spacing:2,children:group.snapshots.map(snapshot=&gt;jsxRuntimeExports.jsx(Grid,{item:!0,xs:12,sm:6,children:jsxRuntimeExports.jsxs(Card,{sx:{...glassEffect.medium,height:"100%"},children:[snapshot.chartImage&amp;&amp;jsxRuntimeExports.jsx(Box,{alt:snapshot.name,component:"img",src:snapshot.chartImage,sx:{width:"100%",height:150,objectFit:"cover",borderBottom:"1px solid rgba(255, 255, 255, 0.1)"}}),jsxRuntimeExports.jsxs(CardContent,{children:[jsxRuntimeExports.jsx(Typography$1,{gutterBottom:!0,variant:"h6",children:snapshot.name}),snapshot.description&amp;&amp;jsxRuntimeExports.jsx(Typography$1,{color:"text.secondary",sx:{mb:1},variant:"body2",children:snapshot.description}),jsxRuntimeExports.jsxs(Box,{sx:{display:"flex",alignItems:"center",gap:1,mb:1},children:[jsxRuntimeExports.jsx(AccessTime,{fontSize:"small"}),jsxRuntimeExports.jsx(Typography$1,{variant:"caption",children:format$1(new Date(snapshot.timestamp),"PPpp")})]}),jsxRuntimeExports.jsx(Box,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:snapshot.tags.map(tag=&gt;jsxRuntimeExports.jsx(Chip,{label:tag,size:"small",sx:{...glassEffect.light}},tag))})]}),jsxRuntimeExports.jsxs(CardActions,{children:[jsxRuntimeExports.jsx(Tooltip,{title:"Restore this view",children:jsxRuntimeExports.jsx(IconButton,{size:"small",onClick:()=&gt;onSnapshotRestore(snapshot.id),children:jsxRuntimeExports.jsx(RestoreFromTrash,{})})}),jsxRuntimeExports.jsx(Tooltip,{title:"Export snapshot",children:jsxRuntimeExports.jsx(IconButton,{size:"small",onClick:()=&gt;onSnapshotExport(snapshot.id),children:jsxRuntimeExports.jsx(Download,{})})}),jsxRuntimeExports.jsx(Tooltip,{title:"Share snapshot",children:jsxRuntimeExports.jsx(IconButton,{size:"small",children:jsxRuntimeExports.jsx(Share,{})})}),jsxRuntimeExports.jsx(Box,{sx:{flex:1}}),jsxRuntimeExports.jsx(Tooltip,{title:"Delete snapshot",children:jsxRuntimeExports.jsx(IconButton,{size:"small",sx:{color:"error.main"},onClick:()=&gt;onSnapshotDelete(snapshot.id),children:jsxRuntimeExports.jsx(Delete,{})})})]})]})},snapshot.id))})]},monitorId))}),jsxRuntimeExports.jsx(Alert,{severity:"info",sx:{...glassEffect.light},children:jsxRuntimeExports.jsx(Typography$1,{variant:"caption",children:"Snapshots save the current state of a monitor including data, configuration, and time range. Use them to bookmark important findings or share specific views with team members."})})]})}),jsxRuntimeExports.jsx(DialogActions,{children:jsxRuntimeExports.jsx(Button,{onClick:onClose,children:"Close"})})]})}},Symbol.toStringTag,{value:"Module"})),pulseAnimation=keyframes`</span>
<span class="cstat-no" title="statement not covered" >  0% { opacity: 1; }</span>
<span class="cstat-no" title="statement not covered" >  50% { opacity: 0.6; }</span>
<span class="cstat-no" title="statement not covered" >  100% { opacity: 1; }</span>
<span class="cstat-no" title="statement not covered" >`,sizeStyles={small:{fontSize:"0.75rem",height:24,"&amp; .MuiChip-icon":{fontSize:"0.875rem"}},medium:{fontSize:"0.875rem",height:32,"&amp; .MuiChip-icon":{fontSize:"1rem"}},large:{fontSize:"1rem",height:40,"&amp; .MuiChip-icon":{fontSize:"1.25rem"}}},TokenStatusBadge=({validation:validation,size:size="medium",showDays:showDays=!0})=&gt;{const statusConfig=((validation,showDays)=&gt;{if(!validation.isValid)return{label:"Invalid",color:"default",icon:jsxRuntimeExports.jsx(WarningIcon,{fontSize:"small"})};if(validation.isExpired)return{label:"Expired",color:"error",icon:jsxRuntimeExports.jsx(ErrorIcon,{fontSize:"small"})};const days=validation.daysUntilExpiration??0;return days&gt;7?{label:showDays?`Active (${days}d)`:"Active",color:"success",icon:jsxRuntimeExports.jsx(CheckCircleIcon,{fontSize:"small"})}:days&gt;3?{label:showDays?`Expiring Soon (${days}d)`:"Warning",color:"warning",icon:jsxRuntimeExports.jsx(WarningIcon,{fontSize:"small"})}:days&gt;1?{label:showDays?`Urgent (${days}d)`:"Urgent",color:"error",icon:jsxRuntimeExports.jsx(ErrorIcon,{fontSize:"small"}),pulse:!0}:{label:showDays?"Critical (&lt;1d)":"Critical",color:"error",icon:jsxRuntimeExports.jsx(ErrorIcon,{fontSize:"small"}),pulse:!0}})(validation,showDays),tooltipContent=(validation=&gt;{return jsxRuntimeExports.jsxs(Box,{sx:{p:.5},children:[jsxRuntimeExports.jsx(Typography$1,{variant:"caption",display:"block",sx:{fontWeight:600,mb:.5},children:validation.isValid?"Valid Token":"Invalid Token"}),validation.expiresAt&amp;&amp;jsxRuntimeExports.jsxs(Typography$1,{variant:"caption",display:"block",sx:{mb:.25},children:["Expires: ",(date=validation.expiresAt,date?date.toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric"}):"N/A")]}),void 0!==validation.daysUntilExpiration&amp;&amp;null!==validation.daysUntilExpiration&amp;&amp;validation.daysUntilExpiration&gt;=0&amp;&amp;jsxRuntimeExports.jsxs(Typography$1,{variant:"caption",display:"block",sx:{mb:.25},children:["Days Remaining: ",validation.daysUntilExpiration]}),validation.isExpired&amp;&amp;jsxRuntimeExports.jsx(Typography$1,{variant:"caption",display:"block",sx:{color:"error.light"},children:"Token has expired. Please update."}),!validation.isValid&amp;&amp;!validation.isExpired&amp;&amp;jsxRuntimeExports.jsx(Typography$1,{variant:"caption",display:"block",sx:{color:"warning.light"},children:"Token format is invalid."})]});var date})(validation),ariaLabel=`Token status: ${statusConfig.label}. ${validation.isExpired?"Token has expired.":validation.isValid&amp;&amp;void 0!==validation.daysUntilExpiration&amp;&amp;null!==validation.daysUntilExpiration?`Expires in ${validation.daysUntilExpiration} days.`:"Token is invalid."}`;return jsxRuntimeExports.jsx(Tooltip,{title:tooltipContent,arrow:!0,placement:"top",children:jsxRuntimeExports.jsx(Chip,{label:statusConfig.label,color:statusConfig.color,icon:statusConfig.icon,size:"large"===size?"medium":"small","aria-label":ariaLabel,sx:{...sizeStyles[size],animation:statusConfig.pulse?`${pulseAnimation} 2s ease-in-out infinite`:"none",fontWeight:500,"&amp; .MuiChip-label":{px:1}}})})},TokenStatusBadge$1=Object.freeze(Object.defineProperty({__proto__:null,TokenStatusBadge:TokenStatusBadge,default:TokenStatusBadge},Symbol.toStringTag,{value:"Module"})),TokenExpiryWarning$1=Object.freeze(Object.defineProperty({__proto__:null,TokenExpiryWarning:({siteTokens:siteTokens,validations:validations,onTokenClick:onTokenClick})=&gt;{const[expanded,setExpanded]=reactExports.useState(!1),[dismissed,setDismissed]=reactExports.useState(!1),[forceUpdateKey,setForceUpdateKey]=reactExports.useState(0);reactExports.useEffect(()=&gt;{const dismissedData=localStorage.getItem("token_warning_dismissed");if(dismissedData)try{const{timestamp:timestamp}=JSON.parse(dismissedData);Date.now()-timestamp&lt;864e5?setDismissed(!0):localStorage.removeItem("token_warning_dismissed")}catch(e2){localStorage.removeItem("token_warning_dismissed")}},[]),reactExports.useEffect(()=&gt;{const interval=setInterval(()=&gt;{setForceUpdateKey(prev=&gt;prev+1)},3e5);return()=&gt;clearInterval(interval)},[]);const warningData=reactExports.useCallback(()=&gt;{const expiredSites=[],criticalSites=[],urgentSites=[],warningSites=[];for(const[siteId,validation]of validations)!validation.valid||validation.expired?expiredSites.push(siteId):void 0!==validation.daysUntilExpiry&amp;&amp;validation.daysUntilExpiry&lt;1?criticalSites.push(siteId):void 0!==validation.daysUntilExpiry&amp;&amp;validation.daysUntilExpiry&lt;3?urgentSites.push(siteId):void 0!==validation.daysUntilExpiry&amp;&amp;validation.daysUntilExpiry&lt;7&amp;&amp;warningSites.push(siteId);return expiredSites.length&gt;0?{status:"expired",siteIds:expiredSites}:criticalSites.length&gt;0?{status:"critical",siteIds:criticalSites}:urgentSites.length&gt;0?{status:"urgent",siteIds:urgentSites}:warningSites.length&gt;0?{status:"warning",siteIds:warningSites}:{status:null,siteIds:[]}},[validations,forceUpdateKey])(),handleDismiss=()=&gt;{setDismissed(!0),localStorage.setItem("token_warning_dismissed",JSON.stringify({timestamp:Date.now()}))},handleTokenClick=siteId=&gt;{onTokenClick&amp;&amp;onTokenClick(siteId)},renderSiteDetails=siteIds=&gt;jsxRuntimeExports.jsx(Collapse,{in:expanded,children:jsxRuntimeExports.jsx(Box,{sx:{mt:2,pl:2,borderLeft:2,borderColor:"divider"},children:siteIds.map(siteId=&gt;{const token=siteTokens.get(siteId),validation=validations.get(siteId);return jsxRuntimeExports.jsxs(Box,{sx:{display:"flex",alignItems:"center",gap:2,mb:1,p:1,bgcolor:"background.paper",borderRadius:1},children:[jsxRuntimeExports.jsx(Typography$1,{variant:"body2",sx:{flex:1,fontWeight:500},children:(null==token?void 0:token.siteName)||siteId}),validation&amp;&amp;jsxRuntimeExports.jsx(TokenStatusBadge,{validation:validation,size:"small"}),jsxRuntimeExports.jsx(Button,{size:"small",variant:"outlined",onClick:()=&gt;handleTokenClick(siteId),children:"Update"})]},siteId)})})});if(!warningData.status||dismissed&amp;&amp;"warning"===warningData.status)return null;const siteCount=warningData.siteIds.length,siteNames=warningData.siteIds.map(id=&gt;{var _a;return(null==(_a=siteTokens.get(id))?void 0:_a.siteName)||id}).join(", ");return jsxRuntimeExports.jsx(Slide,{direction:"down",in:!0,mountOnEnter:!0,unmountOnExit:!0,children:jsxRuntimeExports.jsx(Box,{sx:{position:"sticky",top:0,zIndex:1100,mb:2,"&amp; .MuiAlert-root":{borderRadius:0,borderBottom:1,borderColor:"divider"}},children:(()=&gt;{switch(warningData.status){case"expired":return jsxRuntimeExports.jsxs(Alert,{severity:"error",variant:"filled",icon:jsxRuntimeExports.jsx(ErrorIcon,{}),action:jsxRuntimeExports.jsx(Button,{color:"inherit",size:"small",onClick:()=&gt;handleTokenClick(warningData.siteIds[0]),children:"Update Token"}),sx:{mb:0},children:[jsxRuntimeExports.jsxs(Box,{sx:{display:"flex",alignItems:"center",gap:1},children:[jsxRuntimeExports.jsxs(Box,{sx:{flex:1},children:[jsxRuntimeExports.jsx(AlertTitle,{sx:{mb:1},children:"Token Expired"}),jsxRuntimeExports.jsxs(Typography$1,{variant:"body2",children:[siteCount," site token",siteCount&gt;1?"s have":" has"," expired: ",jsxRuntimeExports.jsx("strong",{children:siteNames})]}),jsxRuntimeExports.jsx(Typography$1,{variant:"body2",sx:{mt:.5},children:"Please update your tokens to continue using the application."})]}),siteCount&gt;1&amp;&amp;jsxRuntimeExports.jsx(IconButton,{size:"small",onClick:()=&gt;setExpanded(!expanded),sx:{color:"inherit",transform:expanded?"rotate(180deg)":"rotate(0deg)",transition:"transform 0.3s"},children:jsxRuntimeExports.jsx(ExpandMoreIcon,{})})]}),siteCount&gt;1&amp;&amp;renderSiteDetails(warningData.siteIds)]});case"critical":return jsxRuntimeExports.jsxs(Alert,{severity:"error",icon:jsxRuntimeExports.jsx(WarningIcon,{}),action:jsxRuntimeExports.jsx(Button,{color:"inherit",size:"small",onClick:()=&gt;handleTokenClick(warningData.siteIds[0]),children:"Renew Now"}),sx:{mb:0},children:[jsxRuntimeExports.jsxs(Box,{sx:{display:"flex",alignItems:"center",gap:1},children:[jsxRuntimeExports.jsxs(Box,{sx:{flex:1},children:[jsxRuntimeExports.jsx(AlertTitle,{sx:{mb:1},children:"Token Expiring Today!"}),jsxRuntimeExports.jsxs(Typography$1,{variant:"body2",children:[siteCount," site token",siteCount&gt;1?"s expire":" expires"," within 24 hours: ",jsxRuntimeExports.jsx("strong",{children:siteNames})]})]}),siteCount&gt;1&amp;&amp;jsxRuntimeExports.jsx(IconButton,{size:"small",onClick:()=&gt;setExpanded(!expanded),sx:{transform:expanded?"rotate(180deg)":"rotate(0deg)",transition:"transform 0.3s"},children:jsxRuntimeExports.jsx(ExpandMoreIcon,{})})]}),siteCount&gt;1&amp;&amp;renderSiteDetails(warningData.siteIds)]});case"urgent":return jsxRuntimeExports.jsxs(Alert,{severity:"warning",action:jsxRuntimeExports.jsx(Button,{color:"inherit",size:"small",onClick:()=&gt;setExpanded(!expanded),children:"View Details"}),sx:{mb:0},children:[jsxRuntimeExports.jsxs(Box,{sx:{display:"flex",alignItems:"center",gap:1},children:[jsxRuntimeExports.jsxs(Box,{sx:{flex:1},children:[jsxRuntimeExports.jsx(AlertTitle,{sx:{mb:1},children:"Token Expiring Soon"}),jsxRuntimeExports.jsxs(Typography$1,{variant:"body2",children:[siteCount," site token",siteCount&gt;1?"s expire":" expires"," within 3 days: ",jsxRuntimeExports.jsx("strong",{children:siteNames})]})]}),jsxRuntimeExports.jsx(IconButton,{size:"small",onClick:()=&gt;setExpanded(!expanded),sx:{transform:expanded?"rotate(180deg)":"rotate(0deg)",transition:"transform 0.3s"},children:jsxRuntimeExports.jsx(ExpandMoreIcon,{})})]}),renderSiteDetails(warningData.siteIds)]});case"warning":return jsxRuntimeExports.jsxs(Alert,{severity:"info",onClose:handleDismiss,sx:{mb:0},children:[jsxRuntimeExports.jsxs(Box,{sx:{display:"flex",alignItems:"center",gap:1},children:[jsxRuntimeExports.jsxs(Box,{sx:{flex:1},children:[jsxRuntimeExports.jsx(AlertTitle,{sx:{mb:1},children:"Token Renewal Reminder"}),jsxRuntimeExports.jsxs(Typography$1,{variant:"body2",children:[siteCount," site token",siteCount&gt;1?"s expire":" expires"," within 7 days: ",jsxRuntimeExports.jsx("strong",{children:siteNames})]}),jsxRuntimeExports.jsx(Typography$1,{variant:"caption",sx:{mt:.5,display:"block",opacity:.8},children:"Click the  to dismiss this reminder for 24 hours"})]}),jsxRuntimeExports.jsx(IconButton,{size:"small",onClick:()=&gt;setExpanded(!expanded),sx:{transform:expanded?"rotate(180deg)":"rotate(0deg)",transition:"transform 0.3s"},children:jsxRuntimeExports.jsx(ExpandMoreIcon,{})})]}),renderSiteDetails(warningData.siteIds)]});default:return null}})()})})}},Symbol.toStringTag,{value:"Module"}));export{AccessibilityProvider as A,CircuitBreakerStatus as C,DashboardLoadingStates as D,EnhancedAuthError as E,FeedbackProvider as F,KeyboardNavigationProvider as K,Layout as L,MigrationBanner as M,NetworkStatus as N,OnboardingFlow as O,ParticleBackground as P,RememberMeCheckbox as R,SSOButtons as S,TokenExpirationBanner as T,UnifiedChartRenderer as U,useSetBreadcrumbs as a,useRememberMe as b,DashboardPullToRefresh as c,DashboardEmptyState as d,EmptyDashboardState as e,DashboardPerformance as f,SimpleGridDashboard as g,DashboardActions as h,DashboardModals as i,OptimisticUpdateNotification as j,OptimisticNotifications as k,ErrorBoundary as l,SystemSettings as m,PointPreloadIndicator as n,NotificationProvider as o,PWAInstallPrompt as p,index as q,RootRedirect$1 as r,DeviceDeviationHeatmapTest$1 as s,MonitoringDashboard$1 as t,useOptimisticNotification as u,TokenStatusBadge$1 as v,TokenExpiryWarning$1 as w};</span>
&nbsp;</pre></td></tr></table></pre>

                <div class='push'></div><!-- for sticky footer -->
            </div><!-- /wrapper -->
            <div class='footer quiet pad2 space-top1 center small'>
                Code coverage generated by
                <a href="https://istanbul.js.org/" target="_blank" rel="noopener noreferrer">istanbul</a>
                at 2025-10-16T12:41:31.984Z
            </div>
        <script src="../../../../prettify.js"></script>
        <script>
            window.onload = function () {
                prettyPrint();
            };
        </script>
        <script src="../../../../sorter.js"></script>
        <script src="../../../../block-navigation.js"></script>
    </body>
</html>
    