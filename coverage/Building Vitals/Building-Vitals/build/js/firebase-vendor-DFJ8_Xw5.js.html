
<!doctype html>
<html lang="en">

<head>
    <title>Code coverage report for Building Vitals/Building-Vitals/build/js/firebase-vendor-DFJ8_Xw5.js</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="../../../../prettify.css" />
    <link rel="stylesheet" href="../../../../base.css" />
    <link rel="shortcut icon" type="image/x-icon" href="../../../../favicon.png" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style type='text/css'>
        .coverage-summary .sorter {
            background-image: url(../../../../sort-arrow-sprite.png);
        }
    </style>
</head>
    
<body>
<div class='wrapper'>
    <div class='pad1'>
        <h1><a href="../../../../index.html">All files</a> / <a href="index.html">Building Vitals/Building-Vitals/build/js</a> firebase-vendor-DFJ8_Xw5.js</h1>
        <div class='clearfix'>
            
            <div class='fl pad1y space-right2'>
                <span class="strong">0% </span>
                <span class="quiet">Statements</span>
                <span class='fraction'>0/1</span>
            </div>
        
            
            <div class='fl pad1y space-right2'>
                <span class="strong">0% </span>
                <span class="quiet">Branches</span>
                <span class='fraction'>0/1</span>
            </div>
        
            
            <div class='fl pad1y space-right2'>
                <span class="strong">0% </span>
                <span class="quiet">Functions</span>
                <span class='fraction'>0/1</span>
            </div>
        
            
            <div class='fl pad1y space-right2'>
                <span class="strong">0% </span>
                <span class="quiet">Lines</span>
                <span class='fraction'>0/1</span>
            </div>
        
            
        </div>
        <p class="quiet">
            Press <em>n</em> or <em>j</em> to go to the next uncovered block, <em>b</em>, <em>p</em> or <em>k</em> for the previous block.
        </p>
        <template id="filterTemplate">
            <div class="quiet">
                Filter:
                <input type="search" id="fileSearch">
            </div>
        </template>
    </div>
    <div class='status-line low'></div>
    <pre><table class="coverage">
<tr><td class="line-count quiet"><a name='L1'></a><a href='#L1'>1</a>
<a name='L2'></a><a href='#L2'>2</a></td><td class="line-coverage quiet"><span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js"><span class="cstat-no" title="statement not covered" ><span class="fstat-no" title="function not covered" ><span class="branch-0 cbranch-no" title="branch not covered" >import{e0 as openDB,e1 as __rest,e2 as deleteDB}from"./vendor-CFMRQ_Yt.js";var define_process_env_default={};const stringToByteArray$1=function(str){const out=[];let p=0;for(let i=0;i&lt;str.length;i++){let c=str.charCodeAt(i);c&lt;128?out[p++]=c:c&lt;2048?(out[p++]=c&gt;&gt;6|192,out[p++]=63&amp;c|128):55296==(64512&amp;c)&amp;&amp;i+1&lt;str.length&amp;&amp;56320==(64512&amp;str.charCodeAt(i+1))?(c=65536+((1023&amp;c)&lt;&lt;10)+(1023&amp;str.charCodeAt(++i)),out[p++]=c&gt;&gt;18|240,out[p++]=c&gt;&gt;12&amp;63|128,out[p++]=c&gt;&gt;6&amp;63|128,out[p++]=63&amp;c|128):(out[p++]=c&gt;&gt;12|224,out[p++]=c&gt;&gt;6&amp;63|128,out[p++]=63&amp;c|128)}return out},base64={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(input,webSafe){if(!Array.isArray(input))throw Error("encodeByteArray takes an array as a parameter");this.init_();const byteToCharMap=webSafe?this.byteToCharMapWebSafe_:this.byteToCharMap_,output=[];for(let i=0;i&lt;input.length;i+=3){const byte1=input[i],haveByte2=i+1&lt;input.length,byte2=haveByte2?input[i+1]:0,haveByte3=i+2&lt;input.length,byte3=haveByte3?input[i+2]:0,outByte1=byte1&gt;&gt;2,outByte2=(3&amp;byte1)&lt;&lt;4|byte2&gt;&gt;4;let outByte3=(15&amp;byte2)&lt;&lt;2|byte3&gt;&gt;6,outByte4=63&amp;byte3;haveByte3||(outByte4=64,haveByte2||(outByte3=64)),output.push(byteToCharMap[outByte1],byteToCharMap[outByte2],byteToCharMap[outByte3],byteToCharMap[outByte4])}return output.join("")},encodeString(input,webSafe){return this.HAS_NATIVE_SUPPORT&amp;&amp;!webSafe?btoa(input):this.encodeByteArray(stringToByteArray$1(input),webSafe)},decodeString(input,webSafe){return this.HAS_NATIVE_SUPPORT&amp;&amp;!webSafe?atob(input):function(bytes){const out=[];let pos=0,c=0;for(;pos&lt;bytes.length;){const c1=bytes[pos++];if(c1&lt;128)out[c++]=String.fromCharCode(c1);else if(c1&gt;191&amp;&amp;c1&lt;224){const c2=bytes[pos++];out[c++]=String.fromCharCode((31&amp;c1)&lt;&lt;6|63&amp;c2)}else if(c1&gt;239&amp;&amp;c1&lt;365){const u=((7&amp;c1)&lt;&lt;18|(63&amp;bytes[pos++])&lt;&lt;12|(63&amp;bytes[pos++])&lt;&lt;6|63&amp;bytes[pos++])-65536;out[c++]=String.fromCharCode(55296+(u&gt;&gt;10)),out[c++]=String.fromCharCode(56320+(1023&amp;u))}else{const c2=bytes[pos++],c3=bytes[pos++];out[c++]=String.fromCharCode((15&amp;c1)&lt;&lt;12|(63&amp;c2)&lt;&lt;6|63&amp;c3)}}return out.join("")}(this.decodeStringToByteArray(input,webSafe))},decodeStringToByteArray(input,webSafe){this.init_();const charToByteMap=webSafe?this.charToByteMapWebSafe_:this.charToByteMap_,output=[];for(let i=0;i&lt;input.length;){const byte1=charToByteMap[input.charAt(i++)],byte2=i&lt;input.length?charToByteMap[input.charAt(i)]:0;++i;const byte3=i&lt;input.length?charToByteMap[input.charAt(i)]:64;++i;const byte4=i&lt;input.length?charToByteMap[input.charAt(i)]:64;if(++i,null==byte1||null==byte2||null==byte3||null==byte4)throw new DecodeBase64StringError;const outByte1=byte1&lt;&lt;2|byte2&gt;&gt;4;if(output.push(outByte1),64!==byte3){const outByte2=byte2&lt;&lt;4&amp;240|byte3&gt;&gt;2;if(output.push(outByte2),64!==byte4){const outByte3=byte3&lt;&lt;6&amp;192|byte4;output.push(outByte3)}}}return output},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let i=0;i&lt;this.ENCODED_VALS.length;i++)this.byteToCharMap_[i]=this.ENCODED_VALS.charAt(i),this.charToByteMap_[this.byteToCharMap_[i]]=i,this.byteToCharMapWebSafe_[i]=this.ENCODED_VALS_WEBSAFE.charAt(i),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[i]]=i,i&gt;=this.ENCODED_VALS_BASE.length&amp;&amp;(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(i)]=i,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(i)]=i)}}};class DecodeBase64StringError extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const base64urlEncodeWithoutPadding=function(str){return function(str){const utf8Bytes=stringToByteArray$1(str);return base64.encodeByteArray(utf8Bytes,!0)}(str).replace(/\./g,"")},base64Decode=function(str){try{return base64.decodeString(str,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function getGlobal(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if("undefined"!=typeof global)return global;throw new Error("Unable to locate global object.")}const getDefaults=()=&gt;{try{return getGlobal().__FIREBASE_DEFAULTS__||(()=&gt;{if("undefined"==typeof process)return;const defaultsJsonString=define_process_env_default.__FIREBASE_DEFAULTS__;return defaultsJsonString?JSON.parse(defaultsJsonString):void 0})()||(()=&gt;{if("undefined"==typeof document)return;let match;try{match=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(e){return}const decoded=match&amp;&amp;base64Decode(match[1]);return decoded&amp;&amp;JSON.parse(decoded)})()}catch(e){return void console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${e}`)}},getDefaultEmulatorHost=productName=&gt;{var _a,_b;return null===(_b=null===(_a=getDefaults())||void 0===_a?void 0:_a.emulatorHosts)||void 0===_b?void 0:_b[productName]},getDefaultEmulatorHostnameAndPort=productName=&gt;{const host=getDefaultEmulatorHost(productName);if(!host)return;const separatorIndex=host.lastIndexOf(":");if(separatorIndex&lt;=0||separatorIndex+1===host.length)throw new Error(`Invalid host ${host} with no separate hostname and port!`);const port=parseInt(host.substring(separatorIndex+1),10);return"["===host[0]?[host.substring(1,separatorIndex-1),port]:[host.substring(0,separatorIndex),port]},getDefaultAppConfig=()=&gt;{var _a;return null===(_a=getDefaults())||void 0===_a?void 0:_a.config},getExperimentalSetting=name2=&gt;{var _a;return null===(_a=getDefaults())||void 0===_a?void 0:_a[`_${name2}`]};class Deferred{constructor(){this.reject=()=&gt;{},this.resolve=()=&gt;{},this.promise=new Promise((resolve,reject)=&gt;{this.resolve=resolve,this.reject=reject})}wrapCallback(callback){return(error,value)=&gt;{error?this.reject(error):this.resolve(value),"function"==typeof callback&amp;&amp;(this.promise.catch(()=&gt;{}),1===callback.length?callback(error):callback(error,value))}}}function isCloudWorkstation(url){try{return(url.startsWith("http://")||url.startsWith("https://")?new URL(url).hostname:url).endsWith(".cloudworkstations.dev")}catch(_a){return!1}}async function pingServer(endpoint){return(await fetch(endpoint,{credentials:"include"})).ok}function createMockUserToken(token,projectId){if(token.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const project=projectId||"demo-project",iat=token.iat||0,sub=token.sub||token.user_id;if(!sub)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const payload=Object.assign({iss:`https://securetoken.google.com/${project}`,aud:project,iat:iat,exp:iat+3600,auth_time:iat,sub:sub,user_id:sub,firebase:{sign_in_provider:"custom",identities:{}}},token);return[base64urlEncodeWithoutPadding(JSON.stringify({alg:"none",type:"JWT"})),base64urlEncodeWithoutPadding(JSON.stringify(payload)),""].join(".")}const emulatorStatus={};let previouslyDismissed=!1;function updateEmulatorBanner(name2,isRunningEmulator){if("undefined"==typeof window||"undefined"==typeof document||!isCloudWorkstation(window.location.host)||emulatorStatus[name2]===isRunningEmulator||emulatorStatus[name2]||previouslyDismissed)return;function prefixedId(id){return`__firebase__banner__${id}`}emulatorStatus[name2]=isRunningEmulator;const showError=function getEmulatorSummary(){const summary={prod:[],emulator:[]};for(const key of Object.keys(emulatorStatus))emulatorStatus[key]?summary.emulator.push(key):summary.prod.push(key);return summary}().prod.length&gt;0;function setupCloseBtn(){const closeBtn=document.createElement("span");return closeBtn.style.cursor="pointer",closeBtn.style.marginLeft="16px",closeBtn.style.fontSize="24px",closeBtn.innerHTML=" &amp;times;",closeBtn.onclick=()=&gt;{previouslyDismissed=!0,function tearDown(){const element=document.getElementById("__firebase__banner");element&amp;&amp;element.remove()}()},closeBtn}function setupDom(){const banner=function getOrCreateEl(id){let parentDiv=document.getElementById(id),created=!1;return parentDiv||(parentDiv=document.createElement("div"),parentDiv.setAttribute("id",id),created=!0),{created:created,element:parentDiv}}("__firebase__banner"),firebaseTextId=prefixedId("text"),firebaseText=document.getElementById(firebaseTextId)||document.createElement("span"),learnMoreId=prefixedId("learnmore"),learnMoreLink=document.getElementById(learnMoreId)||document.createElement("a"),prependIconId=prefixedId("preprendIcon"),prependIcon=document.getElementById(prependIconId)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(banner.created){const bannerEl=banner.element;!function setupBannerStyles(bannerEl){bannerEl.style.display="flex",bannerEl.style.background="#7faaf0",bannerEl.style.position="fixed",bannerEl.style.bottom="5px",bannerEl.style.left="5px",bannerEl.style.padding=".5em",bannerEl.style.borderRadius="5px",bannerEl.style.alignItems="center"}(bannerEl),function setupLinkStyles(learnMoreLink,learnMoreId){learnMoreLink.setAttribute("id",learnMoreId),learnMoreLink.innerText="Learn more",learnMoreLink.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",learnMoreLink.setAttribute("target","__blank"),learnMoreLink.style.paddingLeft="5px",learnMoreLink.style.textDecoration="underline"}(learnMoreLink,learnMoreId);const closeBtn=setupCloseBtn();!function setupIconStyles(prependIcon,iconId){prependIcon.setAttribute("width","24"),prependIcon.setAttribute("id",iconId),prependIcon.setAttribute("height","24"),prependIcon.setAttribute("viewBox","0 0 24 24"),prependIcon.setAttribute("fill","none"),prependIcon.style.marginLeft="-6px"}(prependIcon,prependIconId),bannerEl.append(prependIcon,firebaseText,learnMoreLink,closeBtn),document.body.appendChild(bannerEl)}showError?(firebaseText.innerText="Preview backend disconnected.",prependIcon.innerHTML='&lt;g clip-path="url(#clip0_6013_33858)"&gt;\n&lt;path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/&gt;\n&lt;/g&gt;\n&lt;defs&gt;\n&lt;clipPath id="clip0_6013_33858"&gt;\n&lt;rect width="24" height="24" fill="white"/&gt;\n&lt;/clipPath&gt;\n&lt;/defs&gt;'):(prependIcon.innerHTML='&lt;g clip-path="url(#clip0_6083_34804)"&gt;\n&lt;path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/&gt;\n&lt;/g&gt;\n&lt;defs&gt;\n&lt;clipPath id="clip0_6083_34804"&gt;\n&lt;rect width="24" height="24" fill="white"/&gt;\n&lt;/clipPath&gt;\n&lt;/defs&gt;',firebaseText.innerText="Preview backend running in this workspace."),firebaseText.setAttribute("id",firebaseTextId)}"loading"===document.readyState?window.addEventListener("DOMContentLoaded",setupDom):setupDom()}function getUA(){return"undefined"!=typeof navigator&amp;&amp;"string"==typeof navigator.userAgent?navigator.userAgent:""}function isNode(){var _a;const forceEnvironment=null===(_a=getDefaults())||void 0===_a?void 0:_a.forceEnvironment;if("node"===forceEnvironment)return!0;if("browser"===forceEnvironment)return!1;try{return"[object process]"===Object.prototype.toString.call(global.process)}catch(e){return!1}}function isBrowserExtension(){const runtime="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0;return"object"==typeof runtime&amp;&amp;void 0!==runtime.id}function isSafari(){return!isNode()&amp;&amp;!!navigator.userAgent&amp;&amp;navigator.userAgent.includes("Safari")&amp;&amp;!navigator.userAgent.includes("Chrome")}function isSafariOrWebkit(){return!isNode()&amp;&amp;!!navigator.userAgent&amp;&amp;(navigator.userAgent.includes("Safari")||navigator.userAgent.includes("WebKit"))&amp;&amp;!navigator.userAgent.includes("Chrome")}function isIndexedDBAvailable(){try{return"object"==typeof indexedDB}catch(e){return!1}}function validateIndexedDBOpenable(){return new Promise((resolve,reject)=&gt;{try{let preExist=!0;const DB_CHECK_NAME="validate-browser-context-for-indexeddb-analytics-module",request=self.indexedDB.open(DB_CHECK_NAME);request.onsuccess=()=&gt;{request.result.close(),preExist||self.indexedDB.deleteDatabase(DB_CHECK_NAME),resolve(!0)},request.onupgradeneeded=()=&gt;{preExist=!1},request.onerror=()=&gt;{var _a;reject((null===(_a=request.error)||void 0===_a?void 0:_a.message)||"")}}catch(error){reject(error)}})}function areCookiesEnabled(){return!("undefined"==typeof navigator||!navigator.cookieEnabled)}class FirebaseError extends Error{constructor(code,message,customData){super(message),this.code=code,this.customData=customData,this.name="FirebaseError",Object.setPrototypeOf(this,FirebaseError.prototype),Error.captureStackTrace&amp;&amp;Error.captureStackTrace(this,ErrorFactory.prototype.create)}}class ErrorFactory{constructor(service,serviceName,errors){this.service=service,this.serviceName=serviceName,this.errors=errors}create(code,...data){const customData=data[0]||{},fullCode=`${this.service}/${code}`,template=this.errors[code],message=template?function replaceTemplate(template,data){return template.replace(PATTERN,(_,key)=&gt;{const value=data[key];return null!=value?String(value):`&lt;${key}?&gt;`})}(template,customData):"Error",fullMessage=`${this.serviceName}: ${message} (${fullCode}).`;return new FirebaseError(fullCode,fullMessage,customData)}}const PATTERN=/\{\$([^}]+)}/g;function deepEqual(a,b){if(a===b)return!0;const aKeys=Object.keys(a),bKeys=Object.keys(b);for(const k2 of aKeys){if(!bKeys.includes(k2))return!1;const aProp=a[k2],bProp=b[k2];if(isObject(aProp)&amp;&amp;isObject(bProp)){if(!deepEqual(aProp,bProp))return!1}else if(aProp!==bProp)return!1}for(const k2 of bKeys)if(!aKeys.includes(k2))return!1;return!0}function isObject(thing){return null!==thing&amp;&amp;"object"==typeof thing}function querystring(querystringParams){const params=[];for(const[key,value]of Object.entries(querystringParams))Array.isArray(value)?value.forEach(arrayVal=&gt;{params.push(encodeURIComponent(key)+"="+encodeURIComponent(arrayVal))}):params.push(encodeURIComponent(key)+"="+encodeURIComponent(value));return params.length?"&amp;"+params.join("&amp;"):""}function querystringDecode(querystring2){const obj={};return querystring2.replace(/^\?/,"").split("&amp;").forEach(token=&gt;{if(token){const[key,value]=token.split("=");obj[decodeURIComponent(key)]=decodeURIComponent(value)}}),obj}function extractQuerystring(url){const queryStart=url.indexOf("?");if(!queryStart)return"";const fragmentStart=url.indexOf("#",queryStart);return url.substring(queryStart,fragmentStart&gt;0?fragmentStart:void 0)}class ObserverProxy{constructor(executor,onNoObservers){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=onNoObservers,this.task.then(()=&gt;{executor(this)}).catch(e=&gt;{this.error(e)})}next(value){this.forEachObserver(observer=&gt;{observer.next(value)})}error(error){this.forEachObserver(observer=&gt;{observer.error(error)}),this.close(error)}complete(){this.forEachObserver(observer=&gt;{observer.complete()}),this.close()}subscribe(nextOrObserver,error,complete){let observer;if(void 0===nextOrObserver&amp;&amp;void 0===error&amp;&amp;void 0===complete)throw new Error("Missing Observer.");observer=function implementsAnyMethods(obj,methods){if("object"!=typeof obj||null===obj)return!1;for(const method of methods)if(method in obj&amp;&amp;"function"==typeof obj[method])return!0;return!1}(nextOrObserver,["next","error","complete"])?nextOrObserver:{next:nextOrObserver,error:error,complete:complete},void 0===observer.next&amp;&amp;(observer.next=noop),void 0===observer.error&amp;&amp;(observer.error=noop),void 0===observer.complete&amp;&amp;(observer.complete=noop);const unsub=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&amp;&amp;this.task.then(()=&gt;{try{this.finalError?observer.error(this.finalError):observer.complete()}catch(e){}}),this.observers.push(observer),unsub}unsubscribeOne(i){void 0!==this.observers&amp;&amp;void 0!==this.observers[i]&amp;&amp;(delete this.observers[i],this.observerCount-=1,0===this.observerCount&amp;&amp;void 0!==this.onNoObservers&amp;&amp;this.onNoObservers(this))}forEachObserver(fn){if(!this.finalized)for(let i=0;i&lt;this.observers.length;i++)this.sendOne(i,fn)}sendOne(i,fn){this.task.then(()=&gt;{if(void 0!==this.observers&amp;&amp;void 0!==this.observers[i])try{fn(this.observers[i])}catch(e){"undefined"!=typeof console&amp;&amp;console.error&amp;&amp;console.error(e)}})}close(err){this.finalized||(this.finalized=!0,void 0!==err&amp;&amp;(this.finalError=err),this.task.then(()=&gt;{this.observers=void 0,this.onNoObservers=void 0}))}}function noop(){}function calculateBackoffMillis(backoffCount,intervalMillis=1e3,backoffFactor=2){const currBaseValue=intervalMillis*Math.pow(backoffFactor,backoffCount),randomWait=Math.round(.5*currBaseValue*(Math.random()-.5)*2);return Math.min(144e5,currBaseValue+randomWait)}function getModularInstance(service){return service&amp;&amp;service._delegate?service._delegate:service}class Component{constructor(name2,instanceFactory,type){this.name=name2,this.instanceFactory=instanceFactory,this.type=type,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(mode){return this.instantiationMode=mode,this}setMultipleInstances(multipleInstances){return this.multipleInstances=multipleInstances,this}setServiceProps(props){return this.serviceProps=props,this}setInstanceCreatedCallback(callback){return this.onInstanceCreated=callback,this}}class Provider{constructor(name2,container){this.name=name2,this.container=container,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(identifier){const normalizedIdentifier=this.normalizeInstanceIdentifier(identifier);if(!this.instancesDeferred.has(normalizedIdentifier)){const deferred=new Deferred;if(this.instancesDeferred.set(normalizedIdentifier,deferred),this.isInitialized(normalizedIdentifier)||this.shouldAutoInitialize())try{const instance=this.getOrInitializeService({instanceIdentifier:normalizedIdentifier});instance&amp;&amp;deferred.resolve(instance)}catch(e){}}return this.instancesDeferred.get(normalizedIdentifier).promise}getImmediate(options){var _a;const normalizedIdentifier=this.normalizeInstanceIdentifier(null==options?void 0:options.identifier),optional=null!==(_a=null==options?void 0:options.optional)&amp;&amp;void 0!==_a&amp;&amp;_a;if(!this.isInitialized(normalizedIdentifier)&amp;&amp;!this.shouldAutoInitialize()){if(optional)return null;throw Error(`Service ${this.name} is not available`)}try{return this.getOrInitializeService({instanceIdentifier:normalizedIdentifier})}catch(e){if(optional)return null;throw e}}getComponent(){return this.component}setComponent(component){if(component.name!==this.name)throw Error(`Mismatching Component ${component.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=component,this.shouldAutoInitialize()){if(function isComponentEager(component){return"EAGER"===component.instantiationMode}(component))try{this.getOrInitializeService({instanceIdentifier:"[DEFAULT]"})}catch(e){}for(const[instanceIdentifier,instanceDeferred]of this.instancesDeferred.entries()){const normalizedIdentifier=this.normalizeInstanceIdentifier(instanceIdentifier);try{const instance=this.getOrInitializeService({instanceIdentifier:normalizedIdentifier});instanceDeferred.resolve(instance)}catch(e){}}}}clearInstance(identifier="[DEFAULT]"){this.instancesDeferred.delete(identifier),this.instancesOptions.delete(identifier),this.instances.delete(identifier)}async delete(){const services=Array.from(this.instances.values());await Promise.all([...services.filter(service=&gt;"INTERNAL"in service).map(service=&gt;service.INTERNAL.delete()),...services.filter(service=&gt;"_delete"in service).map(service=&gt;service._delete())])}isComponentSet(){return null!=this.component}isInitialized(identifier="[DEFAULT]"){return this.instances.has(identifier)}getOptions(identifier="[DEFAULT]"){return this.instancesOptions.get(identifier)||{}}initialize(opts={}){const{options:options={}}=opts,normalizedIdentifier=this.normalizeInstanceIdentifier(opts.instanceIdentifier);if(this.isInitialized(normalizedIdentifier))throw Error(`${this.name}(${normalizedIdentifier}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const instance=this.getOrInitializeService({instanceIdentifier:normalizedIdentifier,options:options});for(const[instanceIdentifier,instanceDeferred]of this.instancesDeferred.entries()){normalizedIdentifier===this.normalizeInstanceIdentifier(instanceIdentifier)&amp;&amp;instanceDeferred.resolve(instance)}return instance}onInit(callback,identifier){var _a;const normalizedIdentifier=this.normalizeInstanceIdentifier(identifier),existingCallbacks=null!==(_a=this.onInitCallbacks.get(normalizedIdentifier))&amp;&amp;void 0!==_a?_a:new Set;existingCallbacks.add(callback),this.onInitCallbacks.set(normalizedIdentifier,existingCallbacks);const existingInstance=this.instances.get(normalizedIdentifier);return existingInstance&amp;&amp;callback(existingInstance,normalizedIdentifier),()=&gt;{existingCallbacks.delete(callback)}}invokeOnInitCallbacks(instance,identifier){const callbacks=this.onInitCallbacks.get(identifier);if(callbacks)for(const callback of callbacks)try{callback(instance,identifier)}catch(_a){}}getOrInitializeService({instanceIdentifier:instanceIdentifier,options:options={}}){let instance=this.instances.get(instanceIdentifier);if(!instance&amp;&amp;this.component&amp;&amp;(instance=this.component.instanceFactory(this.container,{instanceIdentifier:(identifier=instanceIdentifier,"[DEFAULT]"===identifier?void 0:identifier),options:options}),this.instances.set(instanceIdentifier,instance),this.instancesOptions.set(instanceIdentifier,options),this.invokeOnInitCallbacks(instance,instanceIdentifier),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,instanceIdentifier,instance)}catch(_a){}var identifier;return instance||null}normalizeInstanceIdentifier(identifier="[DEFAULT]"){return this.component?this.component.multipleInstances?identifier:"[DEFAULT]":identifier}shouldAutoInitialize(){return!!this.component&amp;&amp;"EXPLICIT"!==this.component.instantiationMode}}class ComponentContainer{constructor(name2){this.name=name2,this.providers=new Map}addComponent(component){const provider=this.getProvider(component.name);if(provider.isComponentSet())throw new Error(`Component ${component.name} has already been registered with ${this.name}`);provider.setComponent(component)}addOrOverwriteComponent(component){this.getProvider(component.name).isComponentSet()&amp;&amp;this.providers.delete(component.name),this.addComponent(component)}getProvider(name2){if(this.providers.has(name2))return this.providers.get(name2);const provider=new Provider(name2,this);return this.providers.set(name2,provider),provider}getProviders(){return Array.from(this.providers.values())}}var LogLevel,LogLevel2;(LogLevel2=LogLevel||(LogLevel={}))[LogLevel2.DEBUG=0]="DEBUG",LogLevel2[LogLevel2.VERBOSE=1]="VERBOSE",LogLevel2[LogLevel2.INFO=2]="INFO",LogLevel2[LogLevel2.WARN=3]="WARN",LogLevel2[LogLevel2.ERROR=4]="ERROR",LogLevel2[LogLevel2.SILENT=5]="SILENT";const levelStringToEnum={debug:LogLevel.DEBUG,verbose:LogLevel.VERBOSE,info:LogLevel.INFO,warn:LogLevel.WARN,error:LogLevel.ERROR,silent:LogLevel.SILENT},defaultLogLevel=LogLevel.INFO,ConsoleMethod={[LogLevel.DEBUG]:"log",[LogLevel.VERBOSE]:"log",[LogLevel.INFO]:"info",[LogLevel.WARN]:"warn",[LogLevel.ERROR]:"error"},defaultLogHandler=(instance,logType,...args)=&gt;{if(logType&lt;instance.logLevel)return;const now=(new Date).toISOString(),method=ConsoleMethod[logType];if(!method)throw new Error(`Attempted to log a message with an invalid logType (value: ${logType})`);console[method](`[${now}]  ${instance.name}:`,...args)};class Logger{constructor(name2){this.name=name2,this._logLevel=defaultLogLevel,this._logHandler=defaultLogHandler,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(val){if(!(val in LogLevel))throw new TypeError(`Invalid value "${val}" assigned to \`logLevel\``);this._logLevel=val}setLogLevel(val){this._logLevel="string"==typeof val?levelStringToEnum[val]:val}get logHandler(){return this._logHandler}set logHandler(val){if("function"!=typeof val)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=val}get userLogHandler(){return this._userLogHandler}set userLogHandler(val){this._userLogHandler=val}debug(...args){this._userLogHandler&amp;&amp;this._userLogHandler(this,LogLevel.DEBUG,...args),this._logHandler(this,LogLevel.DEBUG,...args)}log(...args){this._userLogHandler&amp;&amp;this._userLogHandler(this,LogLevel.VERBOSE,...args),this._logHandler(this,LogLevel.VERBOSE,...args)}info(...args){this._userLogHandler&amp;&amp;this._userLogHandler(this,LogLevel.INFO,...args),this._logHandler(this,LogLevel.INFO,...args)}warn(...args){this._userLogHandler&amp;&amp;this._userLogHandler(this,LogLevel.WARN,...args),this._logHandler(this,LogLevel.WARN,...args)}error(...args){this._userLogHandler&amp;&amp;this._userLogHandler(this,LogLevel.ERROR,...args),this._logHandler(this,LogLevel.ERROR,...args)}}class PlatformLoggerServiceImpl{constructor(container){this.container=container}getPlatformInfoString(){return this.container.getProviders().map(provider=&gt;{if(function isVersionServiceProvider(provider){const component=provider.getComponent();return"VERSION"===(null==component?void 0:component.type)}(provider)){const service=provider.getImmediate();return`${service.library}/${service.version}`}return null}).filter(logString=&gt;logString).join(" ")}}const name$q="@firebase/app",logger$2=new Logger("@firebase/app"),name$p="@firebase/app-compat",name$o="@firebase/analytics-compat",name$n="@firebase/analytics",name$m="@firebase/app-check-compat",name$l="@firebase/app-check",name$k="@firebase/auth",name$j="@firebase/auth-compat",name$i="@firebase/database",name$h="@firebase/data-connect",name$g="@firebase/database-compat",name$f="@firebase/functions",name$e="@firebase/functions-compat",name$d="@firebase/installations",name$c="@firebase/installations-compat",name$b="@firebase/messaging",name$a="@firebase/messaging-compat",name$9="@firebase/performance",name$8="@firebase/performance-compat",name$7$1="@firebase/remote-config",name$6$1="@firebase/remote-config-compat",name$5$1="@firebase/storage",name$4$1="@firebase/storage-compat",name$3$1="@firebase/firestore",name$2$1="@firebase/ai",name$1$1="@firebase/firestore-compat",name$r="firebase",PLATFORM_LOG_STRING={[name$q]:"fire-core",[name$p]:"fire-core-compat",[name$n]:"fire-analytics",[name$o]:"fire-analytics-compat",[name$l]:"fire-app-check",[name$m]:"fire-app-check-compat",[name$k]:"fire-auth",[name$j]:"fire-auth-compat",[name$i]:"fire-rtdb",[name$h]:"fire-data-connect",[name$g]:"fire-rtdb-compat",[name$f]:"fire-fn",[name$e]:"fire-fn-compat",[name$d]:"fire-iid",[name$c]:"fire-iid-compat",[name$b]:"fire-fcm",[name$a]:"fire-fcm-compat",[name$9]:"fire-perf",[name$8]:"fire-perf-compat",[name$7$1]:"fire-rc",[name$6$1]:"fire-rc-compat",[name$5$1]:"fire-gcs",[name$4$1]:"fire-gcs-compat",[name$3$1]:"fire-fst",[name$1$1]:"fire-fst-compat",[name$2$1]:"fire-vertex","fire-js":"fire-js",[name$r]:"fire-js-all"},_apps=new Map,_serverApps=new Map,_components=new Map;function _addComponent(app,component){try{app.container.addComponent(component)}catch(e){logger$2.debug(`Component ${component.name} failed to register with FirebaseApp ${app.name}`,e)}}function _registerComponent(component){const componentName=component.name;if(_components.has(componentName))return logger$2.debug(`There were multiple attempts to register component ${componentName}.`),!1;_components.set(componentName,component);for(const app of _apps.values())_addComponent(app,component);for(const serverApp of _serverApps.values())_addComponent(serverApp,component);return!0}function _getProvider(app,name2){const heartbeatController=app.container.getProvider("heartbeat").getImmediate({optional:!0});return heartbeatController&amp;&amp;heartbeatController.triggerHeartbeat(),app.container.getProvider(name2)}function _isFirebaseServerApp(obj){return null!=obj&amp;&amp;void 0!==obj.settings}const ERROR_FACTORY$4=new ErrorFactory("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."});class FirebaseAppImpl{constructor(options,config,container){this._isDeleted=!1,this._options=Object.assign({},options),this._config=Object.assign({},config),this._name=config.name,this._automaticDataCollectionEnabled=config.automaticDataCollectionEnabled,this._container=container,this.container.addComponent(new Component("app",()=&gt;this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(val){this.checkDestroyed(),this._automaticDataCollectionEnabled=val}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(val){this._isDeleted=val}checkDestroyed(){if(this.isDeleted)throw ERROR_FACTORY$4.create("app-deleted",{appName:this._name})}}function initializeApp(_options,rawConfig={}){let options=_options;if("object"!=typeof rawConfig){rawConfig={name:rawConfig}}const config=Object.assign({name:"[DEFAULT]",automaticDataCollectionEnabled:!0},rawConfig),name2=config.name;if("string"!=typeof name2||!name2)throw ERROR_FACTORY$4.create("bad-app-name",{appName:String(name2)});if(options||(options=getDefaultAppConfig()),!options)throw ERROR_FACTORY$4.create("no-options");const existingApp=_apps.get(name2);if(existingApp){if(deepEqual(options,existingApp.options)&amp;&amp;deepEqual(config,existingApp.config))return existingApp;throw ERROR_FACTORY$4.create("duplicate-app",{appName:name2})}const container=new ComponentContainer(name2);for(const component of _components.values())container.addComponent(component);const newApp=new FirebaseAppImpl(options,config,container);return _apps.set(name2,newApp),newApp}function getApp(name2="[DEFAULT]"){const app=_apps.get(name2);if(!app&amp;&amp;"[DEFAULT]"===name2&amp;&amp;getDefaultAppConfig())return initializeApp();if(!app)throw ERROR_FACTORY$4.create("no-app",{appName:name2});return app}function registerVersion(libraryKeyOrName,version2,variant){var _a;let library=null!==(_a=PLATFORM_LOG_STRING[libraryKeyOrName])&amp;&amp;void 0!==_a?_a:libraryKeyOrName;variant&amp;&amp;(library+=`-${variant}`);const libraryMismatch=library.match(/\s|\//),versionMismatch=version2.match(/\s|\//);if(libraryMismatch||versionMismatch){const warning=[`Unable to register library "${library}" with version "${version2}":`];return libraryMismatch&amp;&amp;warning.push(`library name "${library}" contains illegal characters (whitespace or "/")`),libraryMismatch&amp;&amp;versionMismatch&amp;&amp;warning.push("and"),versionMismatch&amp;&amp;warning.push(`version name "${version2}" contains illegal characters (whitespace or "/")`),void logger$2.warn(warning.join(" "))}_registerComponent(new Component(`${library}-version`,()=&gt;({library:library,version:version2}),"VERSION"))}const STORE_NAME$1="firebase-heartbeat-store";let dbPromise$3=null;function getDbPromise$2(){return dbPromise$3||(dbPromise$3=openDB("firebase-heartbeat-database",1,{upgrade:(db,oldVersion)=&gt;{if(0===oldVersion)try{db.createObjectStore(STORE_NAME$1)}catch(e){console.warn(e)}}}).catch(e=&gt;{throw ERROR_FACTORY$4.create("idb-open",{originalErrorMessage:e.message})})),dbPromise$3}async function writeHeartbeatsToIndexedDB(app,heartbeatObject){try{const tx=(await getDbPromise$2()).transaction(STORE_NAME$1,"readwrite"),objectStore=tx.objectStore(STORE_NAME$1);await objectStore.put(heartbeatObject,computeKey$1(app)),await tx.done}catch(e){if(e instanceof FirebaseError)logger$2.warn(e.message);else{const idbGetError=ERROR_FACTORY$4.create("idb-set",{originalErrorMessage:null==e?void 0:e.message});logger$2.warn(idbGetError.message)}}}function computeKey$1(app){return`${app.name}!${app.options.appId}`}class HeartbeatServiceImpl{constructor(container){this.container=container,this._heartbeatsCache=null;const app=this.container.getProvider("app").getImmediate();this._storage=new HeartbeatStorageImpl(app),this._heartbeatsCachePromise=this._storage.read().then(result=&gt;(this._heartbeatsCache=result,result))}async triggerHeartbeat(){var _a,_b;try{const agent=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),date=getUTCDateString();if(null==(null===(_a=this._heartbeatsCache)||void 0===_a?void 0:_a.heartbeats)&amp;&amp;(this._heartbeatsCache=await this._heartbeatsCachePromise,null==(null===(_b=this._heartbeatsCache)||void 0===_b?void 0:_b.heartbeats)))return;if(this._heartbeatsCache.lastSentHeartbeatDate===date||this._heartbeatsCache.heartbeats.some(singleDateHeartbeat=&gt;singleDateHeartbeat.date===date))return;if(this._heartbeatsCache.heartbeats.push({date:date,agent:agent}),this._heartbeatsCache.heartbeats.length&gt;30){const earliestHeartbeatIdx=function getEarliestHeartbeatIdx(heartbeats){if(0===heartbeats.length)return-1;let earliestHeartbeatIdx=0,earliestHeartbeatDate=heartbeats[0].date;for(let i=1;i&lt;heartbeats.length;i++)heartbeats[i].date&lt;earliestHeartbeatDate&amp;&amp;(earliestHeartbeatDate=heartbeats[i].date,earliestHeartbeatIdx=i);return earliestHeartbeatIdx}(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(earliestHeartbeatIdx,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(e){logger$2.warn(e)}}async getHeartbeatsHeader(){var _a;try{if(null===this._heartbeatsCache&amp;&amp;await this._heartbeatsCachePromise,null==(null===(_a=this._heartbeatsCache)||void 0===_a?void 0:_a.heartbeats)||0===this._heartbeatsCache.heartbeats.length)return"";const date=getUTCDateString(),{heartbeatsToSend:heartbeatsToSend,unsentEntries:unsentEntries}=function extractHeartbeatsForHeader(heartbeatsCache,maxSize=1024){const heartbeatsToSend=[];let unsentEntries=heartbeatsCache.slice();for(const singleDateHeartbeat of heartbeatsCache){const heartbeatEntry=heartbeatsToSend.find(hb=&gt;hb.agent===singleDateHeartbeat.agent);if(heartbeatEntry){if(heartbeatEntry.dates.push(singleDateHeartbeat.date),countBytes(heartbeatsToSend)&gt;maxSize){heartbeatEntry.dates.pop();break}}else if(heartbeatsToSend.push({agent:singleDateHeartbeat.agent,dates:[singleDateHeartbeat.date]}),countBytes(heartbeatsToSend)&gt;maxSize){heartbeatsToSend.pop();break}unsentEntries=unsentEntries.slice(1)}return{heartbeatsToSend:heartbeatsToSend,unsentEntries:unsentEntries}}(this._heartbeatsCache.heartbeats),headerString=base64urlEncodeWithoutPadding(JSON.stringify({version:2,heartbeats:heartbeatsToSend}));return this._heartbeatsCache.lastSentHeartbeatDate=date,unsentEntries.length&gt;0?(this._heartbeatsCache.heartbeats=unsentEntries,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),headerString}catch(e){return logger$2.warn(e),""}}}function getUTCDateString(){return(new Date).toISOString().substring(0,10)}class HeartbeatStorageImpl{constructor(app){this.app=app,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!isIndexedDBAvailable()&amp;&amp;validateIndexedDBOpenable().then(()=&gt;!0).catch(()=&gt;!1)}async read(){if(await this._canUseIndexedDBPromise){const idbHeartbeatObject=await async function readHeartbeatsFromIndexedDB(app){try{const tx=(await getDbPromise$2()).transaction(STORE_NAME$1),result=await tx.objectStore(STORE_NAME$1).get(computeKey$1(app));return await tx.done,result}catch(e){if(e instanceof FirebaseError)logger$2.warn(e.message);else{const idbGetError=ERROR_FACTORY$4.create("idb-get",{originalErrorMessage:null==e?void 0:e.message});logger$2.warn(idbGetError.message)}}}(this.app);return(null==idbHeartbeatObject?void 0:idbHeartbeatObject.heartbeats)?idbHeartbeatObject:{heartbeats:[]}}return{heartbeats:[]}}async overwrite(heartbeatsObject){var _a;if(await this._canUseIndexedDBPromise){const existingHeartbeatsObject=await this.read();return writeHeartbeatsToIndexedDB(this.app,{lastSentHeartbeatDate:null!==(_a=heartbeatsObject.lastSentHeartbeatDate)&amp;&amp;void 0!==_a?_a:existingHeartbeatsObject.lastSentHeartbeatDate,heartbeats:heartbeatsObject.heartbeats})}}async add(heartbeatsObject){var _a;if(await this._canUseIndexedDBPromise){const existingHeartbeatsObject=await this.read();return writeHeartbeatsToIndexedDB(this.app,{lastSentHeartbeatDate:null!==(_a=heartbeatsObject.lastSentHeartbeatDate)&amp;&amp;void 0!==_a?_a:existingHeartbeatsObject.lastSentHeartbeatDate,heartbeats:[...existingHeartbeatsObject.heartbeats,...heartbeatsObject.heartbeats]})}}}function countBytes(heartbeatsCache){return base64urlEncodeWithoutPadding(JSON.stringify({version:2,heartbeats:heartbeatsCache})).length}!function registerCoreComponents(variant){_registerComponent(new Component("platform-logger",container=&gt;new PlatformLoggerServiceImpl(container),"PRIVATE")),_registerComponent(new Component("heartbeat",container=&gt;new HeartbeatServiceImpl(container),"PRIVATE")),registerVersion(name$q,"0.13.2",variant),registerVersion(name$q,"0.13.2","esm2017"),registerVersion("fire-js","")}("");var Integer,Md5,commonjsGlobal$1="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};(function(){var h;function m(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}function n(f,a,c){c||(c=0);var d=Array(16);if("string"==typeof a)for(var e=0;16&gt;e;++e)d[e]=a.charCodeAt(c++)|a.charCodeAt(c++)&lt;&lt;8|a.charCodeAt(c++)&lt;&lt;16|a.charCodeAt(c++)&lt;&lt;24;else for(e=0;16&gt;e;++e)d[e]=a[c++]|a[c++]&lt;&lt;8|a[c++]&lt;&lt;16|a[c++]&lt;&lt;24;a=f.g[0],c=f.g[1],e=f.g[2];var g=f.g[3],b=a+(g^c&amp;(e^g))+d[0]+3614090360&amp;4294967295;b=(c=(e=(g=(a=(c=(e=(g=(a=(c=(e=(g=(a=(c=(e=(g=(a=(c=(e=(g=(a=(c=(e=(g=(a=(c=(e=(g=(a=(c=(e=(g=(a=(c=(e=(g=(a=(c=(e=(g=(a=(c=(e=(g=(a=(c=(e=(g=(a=(c=(e=(g=(a=(c=(e=(g=(a=(c=(e=(g=(a=c+(b&lt;&lt;7&amp;4294967295|b&gt;&gt;&gt;25))+((b=g+(e^a&amp;(c^e))+d[1]+3905402710&amp;4294967295)&lt;&lt;12&amp;4294967295|b&gt;&gt;&gt;20))+((b=e+(c^g&amp;(a^c))+d[2]+606105819&amp;4294967295)&lt;&lt;17&amp;4294967295|b&gt;&gt;&gt;15))+((b=c+(a^e&amp;(g^a))+d[3]+3250441966&amp;4294967295)&lt;&lt;22&amp;4294967295|b&gt;&gt;&gt;10))+((b=a+(g^c&amp;(e^g))+d[4]+4118548399&amp;4294967295)&lt;&lt;7&amp;4294967295|b&gt;&gt;&gt;25))+((b=g+(e^a&amp;(c^e))+d[5]+1200080426&amp;4294967295)&lt;&lt;12&amp;4294967295|b&gt;&gt;&gt;20))+((b=e+(c^g&amp;(a^c))+d[6]+2821735955&amp;4294967295)&lt;&lt;17&amp;4294967295|b&gt;&gt;&gt;15))+((b=c+(a^e&amp;(g^a))+d[7]+4249261313&amp;4294967295)&lt;&lt;22&amp;4294967295|b&gt;&gt;&gt;10))+((b=a+(g^c&amp;(e^g))+d[8]+1770035416&amp;4294967295)&lt;&lt;7&amp;4294967295|b&gt;&gt;&gt;25))+((b=g+(e^a&amp;(c^e))+d[9]+2336552879&amp;4294967295)&lt;&lt;12&amp;4294967295|b&gt;&gt;&gt;20))+((b=e+(c^g&amp;(a^c))+d[10]+4294925233&amp;4294967295)&lt;&lt;17&amp;4294967295|b&gt;&gt;&gt;15))+((b=c+(a^e&amp;(g^a))+d[11]+2304563134&amp;4294967295)&lt;&lt;22&amp;4294967295|b&gt;&gt;&gt;10))+((b=a+(g^c&amp;(e^g))+d[12]+1804603682&amp;4294967295)&lt;&lt;7&amp;4294967295|b&gt;&gt;&gt;25))+((b=g+(e^a&amp;(c^e))+d[13]+4254626195&amp;4294967295)&lt;&lt;12&amp;4294967295|b&gt;&gt;&gt;20))+((b=e+(c^g&amp;(a^c))+d[14]+2792965006&amp;4294967295)&lt;&lt;17&amp;4294967295|b&gt;&gt;&gt;15))+((b=c+(a^e&amp;(g^a))+d[15]+1236535329&amp;4294967295)&lt;&lt;22&amp;4294967295|b&gt;&gt;&gt;10))+((b=a+(e^g&amp;(c^e))+d[1]+4129170786&amp;4294967295)&lt;&lt;5&amp;4294967295|b&gt;&gt;&gt;27))+((b=g+(c^e&amp;(a^c))+d[6]+3225465664&amp;4294967295)&lt;&lt;9&amp;4294967295|b&gt;&gt;&gt;23))+((b=e+(a^c&amp;(g^a))+d[11]+643717713&amp;4294967295)&lt;&lt;14&amp;4294967295|b&gt;&gt;&gt;18))+((b=c+(g^a&amp;(e^g))+d[0]+3921069994&amp;4294967295)&lt;&lt;20&amp;4294967295|b&gt;&gt;&gt;12))+((b=a+(e^g&amp;(c^e))+d[5]+3593408605&amp;4294967295)&lt;&lt;5&amp;4294967295|b&gt;&gt;&gt;27))+((b=g+(c^e&amp;(a^c))+d[10]+38016083&amp;4294967295)&lt;&lt;9&amp;4294967295|b&gt;&gt;&gt;23))+((b=e+(a^c&amp;(g^a))+d[15]+3634488961&amp;4294967295)&lt;&lt;14&amp;4294967295|b&gt;&gt;&gt;18))+((b=c+(g^a&amp;(e^g))+d[4]+3889429448&amp;4294967295)&lt;&lt;20&amp;4294967295|b&gt;&gt;&gt;12))+((b=a+(e^g&amp;(c^e))+d[9]+568446438&amp;4294967295)&lt;&lt;5&amp;4294967295|b&gt;&gt;&gt;27))+((b=g+(c^e&amp;(a^c))+d[14]+3275163606&amp;4294967295)&lt;&lt;9&amp;4294967295|b&gt;&gt;&gt;23))+((b=e+(a^c&amp;(g^a))+d[3]+4107603335&amp;4294967295)&lt;&lt;14&amp;4294967295|b&gt;&gt;&gt;18))+((b=c+(g^a&amp;(e^g))+d[8]+1163531501&amp;4294967295)&lt;&lt;20&amp;4294967295|b&gt;&gt;&gt;12))+((b=a+(e^g&amp;(c^e))+d[13]+2850285829&amp;4294967295)&lt;&lt;5&amp;4294967295|b&gt;&gt;&gt;27))+((b=g+(c^e&amp;(a^c))+d[2]+4243563512&amp;4294967295)&lt;&lt;9&amp;4294967295|b&gt;&gt;&gt;23))+((b=e+(a^c&amp;(g^a))+d[7]+1735328473&amp;4294967295)&lt;&lt;14&amp;4294967295|b&gt;&gt;&gt;18))+((b=c+(g^a&amp;(e^g))+d[12]+2368359562&amp;4294967295)&lt;&lt;20&amp;4294967295|b&gt;&gt;&gt;12))+((b=a+(c^e^g)+d[5]+4294588738&amp;4294967295)&lt;&lt;4&amp;4294967295|b&gt;&gt;&gt;28))+((b=g+(a^c^e)+d[8]+2272392833&amp;4294967295)&lt;&lt;11&amp;4294967295|b&gt;&gt;&gt;21))+((b=e+(g^a^c)+d[11]+1839030562&amp;4294967295)&lt;&lt;16&amp;4294967295|b&gt;&gt;&gt;16))+((b=c+(e^g^a)+d[14]+4259657740&amp;4294967295)&lt;&lt;23&amp;4294967295|b&gt;&gt;&gt;9))+((b=a+(c^e^g)+d[1]+2763975236&amp;4294967295)&lt;&lt;4&amp;4294967295|b&gt;&gt;&gt;28))+((b=g+(a^c^e)+d[4]+1272893353&amp;4294967295)&lt;&lt;11&amp;4294967295|b&gt;&gt;&gt;21))+((b=e+(g^a^c)+d[7]+4139469664&amp;4294967295)&lt;&lt;16&amp;4294967295|b&gt;&gt;&gt;16))+((b=c+(e^g^a)+d[10]+3200236656&amp;4294967295)&lt;&lt;23&amp;4294967295|b&gt;&gt;&gt;9))+((b=a+(c^e^g)+d[13]+681279174&amp;4294967295)&lt;&lt;4&amp;4294967295|b&gt;&gt;&gt;28))+((b=g+(a^c^e)+d[0]+3936430074&amp;4294967295)&lt;&lt;11&amp;4294967295|b&gt;&gt;&gt;21))+((b=e+(g^a^c)+d[3]+3572445317&amp;4294967295)&lt;&lt;16&amp;4294967295|b&gt;&gt;&gt;16))+((b=c+(e^g^a)+d[6]+76029189&amp;4294967295)&lt;&lt;23&amp;4294967295|b&gt;&gt;&gt;9))+((b=a+(c^e^g)+d[9]+3654602809&amp;4294967295)&lt;&lt;4&amp;4294967295|b&gt;&gt;&gt;28))+((b=g+(a^c^e)+d[12]+3873151461&amp;4294967295)&lt;&lt;11&amp;4294967295|b&gt;&gt;&gt;21))+((b=e+(g^a^c)+d[15]+530742520&amp;4294967295)&lt;&lt;16&amp;4294967295|b&gt;&gt;&gt;16))+((b=c+(e^g^a)+d[2]+3299628645&amp;4294967295)&lt;&lt;23&amp;4294967295|b&gt;&gt;&gt;9))+((b=a+(e^(c|~g))+d[0]+4096336452&amp;4294967295)&lt;&lt;6&amp;4294967295|b&gt;&gt;&gt;26))+((b=g+(c^(a|~e))+d[7]+1126891415&amp;4294967295)&lt;&lt;10&amp;4294967295|b&gt;&gt;&gt;22))+((b=e+(a^(g|~c))+d[14]+2878612391&amp;4294967295)&lt;&lt;15&amp;4294967295|b&gt;&gt;&gt;17))+((b=c+(g^(e|~a))+d[5]+4237533241&amp;4294967295)&lt;&lt;21&amp;4294967295|b&gt;&gt;&gt;11))+((b=a+(e^(c|~g))+d[12]+1700485571&amp;4294967295)&lt;&lt;6&amp;4294967295|b&gt;&gt;&gt;26))+((b=g+(c^(a|~e))+d[3]+2399980690&amp;4294967295)&lt;&lt;10&amp;4294967295|b&gt;&gt;&gt;22))+((b=e+(a^(g|~c))+d[10]+4293915773&amp;4294967295)&lt;&lt;15&amp;4294967295|b&gt;&gt;&gt;17))+((b=c+(g^(e|~a))+d[1]+2240044497&amp;4294967295)&lt;&lt;21&amp;4294967295|b&gt;&gt;&gt;11))+((b=a+(e^(c|~g))+d[8]+1873313359&amp;4294967295)&lt;&lt;6&amp;4294967295|b&gt;&gt;&gt;26))+((b=g+(c^(a|~e))+d[15]+4264355552&amp;4294967295)&lt;&lt;10&amp;4294967295|b&gt;&gt;&gt;22))+((b=e+(a^(g|~c))+d[6]+2734768916&amp;4294967295)&lt;&lt;15&amp;4294967295|b&gt;&gt;&gt;17))+((b=c+(g^(e|~a))+d[13]+1309151649&amp;4294967295)&lt;&lt;21&amp;4294967295|b&gt;&gt;&gt;11))+((g=(a=c+((b=a+(e^(c|~g))+d[4]+4149444226&amp;4294967295)&lt;&lt;6&amp;4294967295|b&gt;&gt;&gt;26))+((b=g+(c^(a|~e))+d[11]+3174756917&amp;4294967295)&lt;&lt;10&amp;4294967295|b&gt;&gt;&gt;22))^((e=g+((b=e+(a^(g|~c))+d[2]+718787259&amp;4294967295)&lt;&lt;15&amp;4294967295|b&gt;&gt;&gt;17))|~a))+d[9]+3951481745&amp;4294967295,f.g[0]=f.g[0]+a&amp;4294967295,f.g[1]=f.g[1]+(e+(b&lt;&lt;21&amp;4294967295|b&gt;&gt;&gt;11))&amp;4294967295,f.g[2]=f.g[2]+e&amp;4294967295,f.g[3]=f.g[3]+g&amp;4294967295}function t(f,a){this.h=a;for(var c=[],d=!0,e=f.length-1;0&lt;=e;e--){var g=0|f[e];d&amp;&amp;g==a||(c[e]=g,d=!1)}this.g=c}!function k2(f,a){function c(){}c.prototype=a.prototype,f.D=a.prototype,f.prototype=new c,f.prototype.constructor=f,f.C=function(d,e,g){for(var b=Array(arguments.length-2),r=2;r&lt;arguments.length;r++)b[r-2]=arguments[r];return a.prototype[e].apply(d,b)}}(m,function l(){this.blockSize=-1}),m.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0},m.prototype.u=function(f,a){void 0===a&amp;&amp;(a=f.length);for(var c=a-this.blockSize,d=this.B,e=this.h,g=0;g&lt;a;){if(0==e)for(;g&lt;=c;)n(this,f,g),g+=this.blockSize;if("string"==typeof f){for(;g&lt;a;)if(d[e++]=f.charCodeAt(g++),e==this.blockSize){n(this,d),e=0;break}}else for(;g&lt;a;)if(d[e++]=f[g++],e==this.blockSize){n(this,d),e=0;break}}this.h=e,this.o+=a},m.prototype.v=function(){var f=Array((56&gt;this.h?this.blockSize:2*this.blockSize)-this.h);f[0]=128;for(var a=1;a&lt;f.length-8;++a)f[a]=0;var c=8*this.o;for(a=f.length-8;a&lt;f.length;++a)f[a]=255&amp;c,c/=256;for(this.u(f),f=Array(16),a=c=0;4&gt;a;++a)for(var d=0;32&gt;d;d+=8)f[c++]=this.g[a]&gt;&gt;&gt;d&amp;255;return f};var q2={};function u(f){return-128&lt;=f&amp;&amp;128&gt;f?function p(f,a){var c=q2;return Object.prototype.hasOwnProperty.call(c,f)?c[f]:c[f]=a(f)}(f,function(a){return new t([0|a],0&gt;a?-1:0)}):new t([0|f],0&gt;f?-1:0)}function v(f){if(isNaN(f)||!isFinite(f))return w;if(0&gt;f)return x2(v(-f));for(var a=[],c=1,d=0;f&gt;=c;d++)a[d]=f/c|0,c*=4294967296;return new t(a,0)}var w=u(0),z2=u(1),A=u(16777216);function C(f){if(0!=f.h)return!1;for(var a=0;a&lt;f.g.length;a++)if(0!=f.g[a])return!1;return!0}function B2(f){return-1==f.h}function x2(f){for(var a=f.g.length,c=[],d=0;d&lt;a;d++)c[d]=~f.g[d];return new t(c,~f.h).add(z2)}function F2(f,a){return f.add(x2(a))}function G2(f,a){for(;(65535&amp;f[a])!=f[a];)f[a+1]+=f[a]&gt;&gt;&gt;16,f[a]&amp;=65535,a++}function H2(f,a){this.g=f,this.h=a}function D(f,a){if(C(a))throw Error("division by zero");if(C(f))return new H2(w,w);if(B2(f))return a=D(x2(f),a),new H2(x2(a.g),x2(a.h));if(B2(a))return a=D(f,x2(a)),new H2(x2(a.g),a.h);if(30&lt;f.g.length){if(B2(f)||B2(a))throw Error("slowDivide_ only works with positive integers.");for(var c=z2,d=a;0&gt;=d.l(f);)c=I(c),d=I(d);var e=J2(c,1),g=J2(d,1);for(d=J2(d,2),c=J2(c,2);!C(d);){var b=g.add(d);0&gt;=b.l(f)&amp;&amp;(e=e.add(c),g=b),d=J2(d,1),c=J2(c,1)}return a=F2(f,e.j(a)),new H2(e,a)}for(e=w;0&lt;=f.l(a);){for(c=Math.max(1,Math.floor(f.m()/a.m())),d=48&gt;=(d=Math.ceil(Math.log(c)/Math.LN2))?1:Math.pow(2,d-48),b=(g=v(c)).j(a);B2(b)||0&lt;b.l(f);)b=(g=v(c-=d)).j(a);C(g)&amp;&amp;(g=z2),e=e.add(g),f=F2(f,b)}return new H2(e,f)}function I(f){for(var a=f.g.length+1,c=[],d=0;d&lt;a;d++)c[d]=f.i(d)&lt;&lt;1|f.i(d-1)&gt;&gt;&gt;31;return new t(c,f.h)}function J2(f,a){var c=a&gt;&gt;5;a%=32;for(var d=f.g.length-c,e=[],g=0;g&lt;d;g++)e[g]=0&lt;a?f.i(g+c)&gt;&gt;&gt;a|f.i(g+c+1)&lt;&lt;32-a:f.i(g+c);return new t(e,f.h)}(h=t.prototype).m=function(){if(B2(this))return-x2(this).m();for(var f=0,a=1,c=0;c&lt;this.g.length;c++){var d=this.i(c);f+=(0&lt;=d?d:4294967296+d)*a,a*=4294967296}return f},h.toString=function(f){if(2&gt;(f=f||10)||36&lt;f)throw Error("radix out of range: "+f);if(C(this))return"0";if(B2(this))return"-"+x2(this).toString(f);for(var a=v(Math.pow(f,6)),c=this,d="";;){var e=D(c,a).g,g=((0&lt;(c=F2(c,e.j(a))).g.length?c.g[0]:c.h)&gt;&gt;&gt;0).toString(f);if(C(c=e))return g+d;for(;6&gt;g.length;)g="0"+g;d=g+d}},h.i=function(f){return 0&gt;f?0:f&lt;this.g.length?this.g[f]:this.h},h.l=function(f){return B2(f=F2(this,f))?-1:C(f)?0:1},h.abs=function(){return B2(this)?x2(this):this},h.add=function(f){for(var a=Math.max(this.g.length,f.g.length),c=[],d=0,e=0;e&lt;=a;e++){var g=d+(65535&amp;this.i(e))+(65535&amp;f.i(e)),b=(g&gt;&gt;&gt;16)+(this.i(e)&gt;&gt;&gt;16)+(f.i(e)&gt;&gt;&gt;16);d=b&gt;&gt;&gt;16,g&amp;=65535,b&amp;=65535,c[e]=b&lt;&lt;16|g}return new t(c,-2147483648&amp;c[c.length-1]?-1:0)},h.j=function(f){if(C(this)||C(f))return w;if(B2(this))return B2(f)?x2(this).j(x2(f)):x2(x2(this).j(f));if(B2(f))return x2(this.j(x2(f)));if(0&gt;this.l(A)&amp;&amp;0&gt;f.l(A))return v(this.m()*f.m());for(var a=this.g.length+f.g.length,c=[],d=0;d&lt;2*a;d++)c[d]=0;for(d=0;d&lt;this.g.length;d++)for(var e=0;e&lt;f.g.length;e++){var g=this.i(d)&gt;&gt;&gt;16,b=65535&amp;this.i(d),r=f.i(e)&gt;&gt;&gt;16,E=65535&amp;f.i(e);c[2*d+2*e]+=b*E,G2(c,2*d+2*e),c[2*d+2*e+1]+=g*E,G2(c,2*d+2*e+1),c[2*d+2*e+1]+=b*r,G2(c,2*d+2*e+1),c[2*d+2*e+2]+=g*r,G2(c,2*d+2*e+2)}for(d=0;d&lt;a;d++)c[d]=c[2*d+1]&lt;&lt;16|c[2*d];for(d=a;d&lt;2*a;d++)c[d]=0;return new t(c,0)},h.A=function(f){return D(this,f).h},h.and=function(f){for(var a=Math.max(this.g.length,f.g.length),c=[],d=0;d&lt;a;d++)c[d]=this.i(d)&amp;f.i(d);return new t(c,this.h&amp;f.h)},h.or=function(f){for(var a=Math.max(this.g.length,f.g.length),c=[],d=0;d&lt;a;d++)c[d]=this.i(d)|f.i(d);return new t(c,this.h|f.h)},h.xor=function(f){for(var a=Math.max(this.g.length,f.g.length),c=[],d=0;d&lt;a;d++)c[d]=this.i(d)^f.i(d);return new t(c,this.h^f.h)},m.prototype.digest=m.prototype.v,m.prototype.reset=m.prototype.s,m.prototype.update=m.prototype.u,Md5=m,t.prototype.add=t.prototype.add,t.prototype.multiply=t.prototype.j,t.prototype.modulo=t.prototype.A,t.prototype.compare=t.prototype.l,t.prototype.toNumber=t.prototype.m,t.prototype.toString=t.prototype.toString,t.prototype.getBits=t.prototype.i,t.fromNumber=v,t.fromString=function y(f,a){if(0==f.length)throw Error("number format error: empty string");if(2&gt;(a=a||10)||36&lt;a)throw Error("radix out of range: "+a);if("-"==f.charAt(0))return x2(y(f.substring(1),a));if(0&lt;=f.indexOf("-"))throw Error('number format error: interior "-" character');for(var c=v(Math.pow(a,8)),d=w,e=0;e&lt;f.length;e+=8){var g=Math.min(8,f.length-e),b=parseInt(f.substring(e,e+g),a);8&gt;g?(g=v(Math.pow(a,g)),d=d.j(g).add(v(b))):d=(d=d.j(c)).add(v(b))}return d},Integer=t}).apply(void 0!==commonjsGlobal$1?commonjsGlobal$1:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{});var XhrIo,WebChannel,EventType,ErrorCode$1,Stat,Event,getStatEventTarget,createWebChannelTransport,commonjsGlobal="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};(function(){var h,aa="function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){return a==Array.prototype||a==Object.prototype||(a[b]=c.value),a};var ca=function ba(a){a=["object"==typeof globalThis&amp;&amp;globalThis,a,"object"==typeof window&amp;&amp;window,"object"==typeof self&amp;&amp;self,"object"==typeof commonjsGlobal&amp;&amp;commonjsGlobal];for(var b=0;b&lt;a.length;++b){var c=a[b];if(c&amp;&amp;c.Math==Math)return c}throw Error("Cannot find global object")}(this);!function da(a,b){if(b)a:{var c=ca;a=a.split(".");for(var d=0;d&lt;a.length-1;d++){var e=a[d];if(!(e in c))break a;c=c[e]}(b=b(d=c[a=a[a.length-1]]))!=d&amp;&amp;null!=b&amp;&amp;aa(c,a,{configurable:!0,writable:!0,value:b})}}("Array.prototype.values",function(a){return a||function(){return function ea(a,b){a instanceof String&amp;&amp;(a+="");var c=0,d=!1,e={next:function(){if(!d&amp;&amp;c&lt;a.length){var f=c++;return{value:b(f,a[f]),done:!1}}return d=!0,{done:!0,value:void 0}}};return e[Symbol.iterator]=function(){return e},e}(this,function(b,c){return c})}});var fa=fa||{},k2=this||self;function ha(a){var b=typeof a;return"array"==(b="object"!=b?b:a?Array.isArray(a)?"array":b:"null")||"object"==b&amp;&amp;"number"==typeof a.length}function n(a){var b=typeof a;return"object"==b&amp;&amp;null!=a||"function"==b}function ia(a,b,c){return a.call.apply(a.bind,arguments)}function ja(a,b,c){if(!a)throw Error();if(2&lt;arguments.length){var d=Array.prototype.slice.call(arguments,2);return function(){var e=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(e,d),a.apply(b,e)}}return function(){return a.apply(b,arguments)}}function p(a,b,c){return(p=Function.prototype.bind&amp;&amp;-1!=Function.prototype.bind.toString().indexOf("native code")?ia:ja).apply(null,arguments)}function ka(a,b){var c=Array.prototype.slice.call(arguments,1);return function(){var d=c.slice();return d.push.apply(d,arguments),a.apply(this,d)}}function r(a,b){function c(){}c.prototype=b.prototype,a.aa=b.prototype,a.prototype=new c,a.prototype.constructor=a,a.Qb=function(d,e,f){for(var g=Array(arguments.length-2),m=2;m&lt;arguments.length;m++)g[m-2]=arguments[m];return b.prototype[e].apply(d,g)}}function la(a){const b=a.length;if(0&lt;b){const c=Array(b);for(let d=0;d&lt;b;d++)c[d]=a[d];return c}return[]}function ma(a,b){for(let c=1;c&lt;arguments.length;c++){const d=arguments[c];if(ha(d)){const e=a.length||0,f=d.length||0;a.length=e+f;for(let g=0;g&lt;f;g++)a[e+g]=d[g]}else a.push(d)}}function t(a){return/^[\s\xa0]*$/.test(a)}function u(){var a=k2.navigator;return a&amp;&amp;(a=a.userAgent)?a:""}function oa(a){return oa[" "](a),a}oa[" "]=function(){};var pa=!(-1==u().indexOf("Gecko")||-1!=u().toLowerCase().indexOf("webkit")&amp;&amp;-1==u().indexOf("Edge")||-1!=u().indexOf("Trident")||-1!=u().indexOf("MSIE")||-1!=u().indexOf("Edge"));function qa(a,b,c){for(const d in a)b.call(c,a[d],d,a)}function sa(a){const b={};for(const c in a)b[c]=a[c];return b}const ta="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function ua(a,b){let c,d;for(let e=1;e&lt;arguments.length;e++){for(c in d=arguments[e],d)a[c]=d[c];for(let f=0;f&lt;ta.length;f++)c=ta[f],Object.prototype.hasOwnProperty.call(d,c)&amp;&amp;(a[c]=d[c])}}function va(a){var b=1;a=a.split(":");const c=[];for(;0&lt;b&amp;&amp;a.length;)c.push(a.shift()),b--;return a.length&amp;&amp;c.push(a.join(":")),c}function wa(a){k2.setTimeout(()=&gt;{throw a},0)}function xa(){var a=za;let b=null;return a.g&amp;&amp;(b=a.g,a.g=a.g.next,a.g||(a.h=null),b.next=null),b}var Ba=new class na{constructor(a,b){this.i=a,this.j=b,this.h=0,this.g=null}get(){let a;return 0&lt;this.h?(this.h--,a=this.g,this.g=a.next,a.next=null):a=this.i(),a}}(()=&gt;new Ca,a=&gt;a.reset());class Ca{constructor(){this.next=this.g=this.h=null}set(a,b){this.h=a,this.g=b,this.next=null}reset(){this.next=this.g=this.h=null}}let x2,y=!1,za=new class Aa{constructor(){this.h=this.g=null}add(a,b){const c=Ba.get();c.set(a,b),this.h?this.h.next=c:this.g=c,this.h=c}},Ea=()=&gt;{const a=k2.Promise.resolve(void 0);x2=()=&gt;{a.then(Da)}};var Da=()=&gt;{for(var a;a=xa();){try{a.h.call(a.g)}catch(c){wa(c)}var b=Ba;b.j(a),100&gt;b.h&amp;&amp;(b.h++,a.next=b.g,b.g=a)}y=!1};function z2(){this.s=this.s,this.C=this.C}function A(a,b){this.type=a,this.g=this.target=b,this.defaultPrevented=!1}z2.prototype.s=!1,z2.prototype.ma=function(){this.s||(this.s=!0,this.N())},z2.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()},A.prototype.h=function(){this.defaultPrevented=!0};var Fa=function(){if(!k2.addEventListener||!Object.defineProperty)return!1;var a=!1,b=Object.defineProperty({},"passive",{get:function(){a=!0}});try{const c=()=&gt;{};k2.addEventListener("test",c,b),k2.removeEventListener("test",c,b)}catch(c){}return a}();function C(a,b){if(A.call(this,a?a.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,a){var c=this.type=a.type,d=a.changedTouches&amp;&amp;a.changedTouches.length?a.changedTouches[0]:null;if(this.target=a.target||a.srcElement,this.g=b,b=a.relatedTarget){if(pa){a:{try{oa(b.nodeName);var e=!0;break a}catch(f){}e=!1}e||(b=null)}}else"mouseover"==c?b=a.fromElement:"mouseout"==c&amp;&amp;(b=a.toElement);this.relatedTarget=b,d?(this.clientX=void 0!==d.clientX?d.clientX:d.pageX,this.clientY=void 0!==d.clientY?d.clientY:d.pageY,this.screenX=d.screenX||0,this.screenY=d.screenY||0):(this.clientX=void 0!==a.clientX?a.clientX:a.pageX,this.clientY=void 0!==a.clientY?a.clientY:a.pageY,this.screenX=a.screenX||0,this.screenY=a.screenY||0),this.button=a.button,this.key=a.key||"",this.ctrlKey=a.ctrlKey,this.altKey=a.altKey,this.shiftKey=a.shiftKey,this.metaKey=a.metaKey,this.pointerId=a.pointerId||0,this.pointerType="string"==typeof a.pointerType?a.pointerType:Ga[a.pointerType]||"",this.state=a.state,this.i=a,a.defaultPrevented&amp;&amp;C.aa.h.call(this)}}r(C,A);var Ga={2:"touch",3:"pen",4:"mouse"};C.prototype.h=function(){C.aa.h.call(this);var a=this.i;a.preventDefault?a.preventDefault():a.returnValue=!1};var D="closure_listenable_"+(1e6*Math.random()|0),Ha=0;function Ia(a,b,c,d,e){this.listener=a,this.proxy=null,this.src=b,this.type=c,this.capture=!!d,this.ha=e,this.key=++Ha,this.da=this.fa=!1}function Ja(a){a.da=!0,a.listener=null,a.proxy=null,a.src=null,a.ha=null}function Ka(a){this.src=a,this.g={},this.h=0}function Ma(a,b){var c=b.type;if(c in a.g){var f,d=a.g[c],e=Array.prototype.indexOf.call(d,b,void 0);(f=0&lt;=e)&amp;&amp;Array.prototype.splice.call(d,e,1),f&amp;&amp;(Ja(b),0==a.g[c].length&amp;&amp;(delete a.g[c],a.h--))}}function La(a,b,c,d){for(var e=0;e&lt;a.length;++e){var f=a[e];if(!f.da&amp;&amp;f.listener==b&amp;&amp;f.capture==!!c&amp;&amp;f.ha==d)return e}return-1}Ka.prototype.add=function(a,b,c,d,e){var f=a.toString();(a=this.g[f])||(a=this.g[f]=[],this.h++);var g=La(a,b,d,e);return-1&lt;g?(b=a[g],c||(b.fa=!1)):((b=new Ia(b,this.src,f,!!d,e)).fa=c,a.push(b)),b};var Na="closure_lm_"+(1e6*Math.random()|0),Oa={};function Qa(a,b,c,d,e){if(Array.isArray(b)){for(var f=0;f&lt;b.length;f++)Qa(a,b[f],c,d,e);return null}return c=Sa(c),a&amp;&amp;a[D]?a.K(b,c,!!n(d)&amp;&amp;!!d.capture,e):function Ta(a,b,c,d,e,f){if(!b)throw Error("Invalid event type");var g=n(e)?!!e.capture:!!e,m=Ua(a);if(m||(a[Na]=m=new Ka(a)),c=m.add(b,c,d,g,f),c.proxy)return c;if(d=function Va(){function a(c){return b.call(a.src,a.listener,c)}const b=Xa;return a}(),c.proxy=d,d.src=a,d.listener=c,a.addEventListener)Fa||(e=g),void 0===e&amp;&amp;(e=!1),a.addEventListener(b.toString(),d,e);else if(a.attachEvent)a.attachEvent(Wa(b.toString()),d);else{if(!a.addListener||!a.removeListener)throw Error("addEventListener and attachEvent are unavailable.");a.addListener(d)}return c}(a,b,c,!1,d,e)}function Ya(a,b,c,d,e){if(Array.isArray(b))for(var f=0;f&lt;b.length;f++)Ya(a,b[f],c,d,e);else d=n(d)?!!d.capture:!!d,c=Sa(c),a&amp;&amp;a[D]?(a=a.i,(b=String(b).toString())in a.g&amp;&amp;(-1&lt;(c=La(f=a.g[b],c,d,e))&amp;&amp;(Ja(f[c]),Array.prototype.splice.call(f,c,1),0==f.length&amp;&amp;(delete a.g[b],a.h--)))):a&amp;&amp;(a=Ua(a))&amp;&amp;(b=a.g[b.toString()],a=-1,b&amp;&amp;(a=La(b,c,d,e)),(c=-1&lt;a?b[a]:null)&amp;&amp;Za(c))}function Za(a){if("number"!=typeof a&amp;&amp;a&amp;&amp;!a.da){var b=a.src;if(b&amp;&amp;b[D])Ma(b.i,a);else{var c=a.type,d=a.proxy;b.removeEventListener?b.removeEventListener(c,d,a.capture):b.detachEvent?b.detachEvent(Wa(c),d):b.addListener&amp;&amp;b.removeListener&amp;&amp;b.removeListener(d),(c=Ua(b))?(Ma(c,a),0==c.h&amp;&amp;(c.src=null,b[Na]=null)):Ja(a)}}}function Wa(a){return a in Oa?Oa[a]:Oa[a]="on"+a}function Xa(a,b){if(a.da)a=!0;else{b=new C(b,this);var c=a.listener,d=a.ha||a.src;a.fa&amp;&amp;Za(a),a=c.call(d,b)}return a}function Ua(a){return(a=a[Na])instanceof Ka?a:null}var $a="__closure_events_fn_"+(1e9*Math.random()&gt;&gt;&gt;0);function Sa(a){return"function"==typeof a?a:(a[$a]||(a[$a]=function(b){return a.handleEvent(b)}),a[$a])}function E(){z2.call(this),this.i=new Ka(this),this.M=this,this.F=null}function F2(a,b){var c,d=a.F;if(d)for(c=[];d;d=d.F)c.push(d);if(a=a.M,d=b.type||b,"string"==typeof b)b=new A(b,a);else if(b instanceof A)b.target=b.target||a;else{var e=b;ua(b=new A(d,a),e)}if(e=!0,c)for(var f=c.length-1;0&lt;=f;f--){var g=b.g=c[f];e=ab(g,d,!0,b)&amp;&amp;e}if(e=ab(g=b.g=a,d,!0,b)&amp;&amp;e,e=ab(g,d,!1,b)&amp;&amp;e,c)for(f=0;f&lt;c.length;f++)e=ab(g=b.g=c[f],d,!1,b)&amp;&amp;e}function ab(a,b,c,d){if(!(b=a.i.g[String(b)]))return!0;b=b.concat();for(var e=!0,f=0;f&lt;b.length;++f){var g=b[f];if(g&amp;&amp;!g.da&amp;&amp;g.capture==c){var m=g.listener,q2=g.ha||g.src;g.fa&amp;&amp;Ma(a.i,g),e=!1!==m.call(q2,d)&amp;&amp;e}}return e&amp;&amp;!d.defaultPrevented}function bb(a,b,c){if("function"==typeof a)c&amp;&amp;(a=p(a,c));else{if(!a||"function"!=typeof a.handleEvent)throw Error("Invalid listener argument");a=p(a.handleEvent,a)}return 2147483647&lt;Number(b)?-1:k2.setTimeout(a,b||0)}function cb(a){a.g=bb(()=&gt;{a.g=null,a.i&amp;&amp;(a.i=!1,cb(a))},a.l);const b=a.h;a.h=null,a.m.apply(null,b)}r(E,z2),E.prototype[D]=!0,E.prototype.removeEventListener=function(a,b,c,d){Ya(this,a,b,c,d)},E.prototype.N=function(){if(E.aa.N.call(this),this.i){var c,a=this.i;for(c in a.g){for(var d=a.g[c],e=0;e&lt;d.length;e++)Ja(d[e]);delete a.g[c],a.h--}}this.F=null},E.prototype.K=function(a,b,c,d){return this.i.add(String(a),b,!1,c,d)},E.prototype.L=function(a,b,c,d){return this.i.add(String(a),b,!0,c,d)};class eb extends z2{constructor(a,b){super(),this.m=a,this.l=b,this.h=null,this.i=!1,this.g=null}j(a){this.h=arguments,this.g?this.i=!0:cb(this)}N(){super.N(),this.g&amp;&amp;(k2.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function G2(a){z2.call(this),this.h=a,this.g={}}r(G2,z2);var fb=[];function gb(a){qa(a.g,function(b,c){this.g.hasOwnProperty(c)&amp;&amp;Za(b)},a),a.g={}}G2.prototype.N=function(){G2.aa.N.call(this),gb(this)},G2.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var hb=k2.JSON.stringify,ib=k2.JSON.parse,jb=class{stringify(a){return k2.JSON.stringify(a,void 0)}parse(a){return k2.JSON.parse(a,void 0)}};function kb(){}function lb(a){return a.h||(a.h=a.i())}function mb(){}kb.prototype.h=null;var H2={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function nb(){A.call(this,"d")}function ob(){A.call(this,"c")}r(nb,A),r(ob,A);var I={},pb=null;function qb(){return pb=pb||new E}function rb(a){A.call(this,I.La,a)}function J2(a){const b=qb();F2(b,new rb(b))}function sb(a,b){A.call(this,I.STAT_EVENT,a),this.stat=b}function K2(a){const b=qb();F2(b,new sb(b,a))}function tb(a,b){A.call(this,I.Ma,a),this.size=b}function ub(a,b){if("function"!=typeof a)throw Error("Fn must not be null and must be a function");return k2.setTimeout(function(){a()},b)}function vb(){this.g=!0}function L2(a,b,c,d){a.info(function(){return"XMLHTTP TEXT ("+b+"): "+function yb(a,b){if(!a.g)return b;if(!b)return null;try{var c=JSON.parse(b);if(c)for(a=0;a&lt;c.length;a++)if(Array.isArray(c[a])){var d=c[a];if(!(2&gt;d.length)){var e=d[1];if(Array.isArray(e)&amp;&amp;!(1&gt;e.length)){var f=e[0];if("noop"!=f&amp;&amp;"stop"!=f&amp;&amp;"close"!=f)for(var g=1;g&lt;e.length;g++)e[g]=""}}}return hb(c)}catch(m){return b}}(a,c)+(d?" "+d:"")})}I.La="serverreachability",r(rb,A),I.STAT_EVENT="statevent",r(sb,A),I.Ma="timingevent",r(tb,A),vb.prototype.xa=function(){this.g=!1},vb.prototype.info=function(){};var Cb,Ab={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},Bb={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"};function Db(){}function M2(a,b,c,d){this.j=a,this.i=b,this.l=c,this.R=d||1,this.U=new G2(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new Eb}function Eb(){this.i=null,this.g="",this.h=!1}r(Db,kb),Db.prototype.g=function(){return new XMLHttpRequest},Db.prototype.i=function(){return{}},Cb=new Db;var Fb={},Gb={};function Hb(a,b,c){a.L=1,a.v=Ib(N2(b)),a.m=c,a.P=!0,Jb(a,null)}function Jb(a,b){a.F=Date.now(),Kb(a),a.A=N2(a.v);var c=a.A,d=a.R;Array.isArray(d)||(d=[String(d)]),Lb(c.i,"t",d),a.C=0,c=a.j.J,a.h=new Eb,a.g=Mb(a.j,c?b:null,!a.m),0&lt;a.O&amp;&amp;(a.M=new eb(p(a.Y,a,a.g),a.O)),b=a.U,c=a.g,d=a.ca;var e="readystatechange";Array.isArray(e)||(e&amp;&amp;(fb[0]=e.toString()),e=fb);for(var f=0;f&lt;e.length;f++){var g=Qa(c,e[f],d||b.handleEvent,!1,b.h||b);if(!g)break;b.g[g.key]=g}b=a.H?sa(a.H):{},a.m?(a.u||(a.u="POST"),b["Content-Type"]="application/x-www-form-urlencoded",a.g.ea(a.A,a.u,a.m,b)):(a.u="GET",a.g.ea(a.A,a.u,null,b)),J2(),function wb(a,b,c,d,e,f){a.info(function(){if(a.g)if(f)for(var g="",m=f.split("&amp;"),q2=0;q2&lt;m.length;q2++){var l=m[q2].split("=");if(1&lt;l.length){var v=l[0];l=l[1];var w=v.split("_");g=2&lt;=w.length&amp;&amp;"type"==w[1]?g+(v+"=")+l+"&amp;":g+(v+"=redacted&amp;")}}else g=null;else g=f;return"XMLHTTP REQ ("+d+") [attempt "+e+"]: "+b+"\n"+c+"\n"+g})}(a.i,a.u,a.A,a.l,a.R,a.m)}function Pb(a){return!!a.g&amp;&amp;("GET"==a.u&amp;&amp;2!=a.L&amp;&amp;a.j.Ca)}function Sb(a,b){var c=a.C,d=b.indexOf("\n",c);return-1==d?Gb:(c=Number(b.substring(c,d)),isNaN(c)?Fb:(d+=1)+c&gt;b.length?Gb:(b=b.slice(d,d+c),a.C=d+c,b))}function Kb(a){a.S=Date.now()+a.I,Wb(a,a.I)}function Wb(a,b){if(null!=a.B)throw Error("WatchDog timer not null");a.B=ub(p(a.ba,a),b)}function Ob(a){a.B&amp;&amp;(k2.clearTimeout(a.B),a.B=null)}function Qb(a){0==a.j.G||a.J||Ub(a.j,a)}function Q2(a){Ob(a);var b=a.M;b&amp;&amp;"function"==typeof b.ma&amp;&amp;b.ma(),a.M=null,gb(a.U),a.g&amp;&amp;(b=a.g,a.g=null,b.abort(),b.ma())}function Rb(a,b){try{var c=a.j;if(0!=c.G&amp;&amp;(c.g==a||Xb(c.h,a)))if(!a.K&amp;&amp;Xb(c.h,a)&amp;&amp;3==c.G){try{var d=c.Da.g.parse(b)}catch(l){d=null}if(Array.isArray(d)&amp;&amp;3==d.length){var e=d;if(0==e[0]){a:if(!c.u){if(c.g){if(!(c.g.F+3e3&lt;a.F))break a;Yb(c),Zb(c)}$b(c),K2(18)}}else c.za=e[1],0&lt;c.za-c.T&amp;&amp;37500&gt;e[2]&amp;&amp;c.F&amp;&amp;0==c.v&amp;&amp;!c.C&amp;&amp;(c.C=ub(p(c.Za,c),6e3));if(1&gt;=ac(c.h)&amp;&amp;c.ca){try{c.ca()}catch(l){}c.ca=void 0}}else R(c,11)}else if((a.K||c.g==a)&amp;&amp;Yb(c),!t(b))for(e=c.Da.g.parse(b),b=0;b&lt;e.length;b++){let l=e[b];if(c.T=l[0],l=l[1],2==c.G)if("c"==l[0]){c.K=l[1],c.ia=l[2];const v=l[3];null!=v&amp;&amp;(c.la=v,c.j.info("VER="+c.la));const w=l[4];null!=w&amp;&amp;(c.Aa=w,c.j.info("SVER="+c.Aa));const O2=l[5];null!=O2&amp;&amp;"number"==typeof O2&amp;&amp;0&lt;O2&amp;&amp;(d=1.5*O2,c.L=d,c.j.info("backChannelRequestTimeoutMs_="+d)),d=c;const B2=a.g;if(B2){const ya=B2.g?B2.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(ya){var f=d.h;f.g||-1==ya.indexOf("spdy")&amp;&amp;-1==ya.indexOf("quic")&amp;&amp;-1==ya.indexOf("h2")||(f.j=f.l,f.g=new Set,f.h&amp;&amp;(bc(f,f.h),f.h=null))}if(d.D){const db=B2.g?B2.g.getResponseHeader("X-HTTP-Session-Id"):null;db&amp;&amp;(d.ya=db,S(d.I,d.D,db))}}c.G=3,c.l&amp;&amp;c.l.ua(),c.ba&amp;&amp;(c.R=Date.now()-a.F,c.j.info("Handshake RTT: "+c.R+"ms"));var g=a;if((d=c).qa=cc(d,d.J?d.ia:null,d.W),g.K){dc(d.h,g);var m=g,q2=d.L;q2&amp;&amp;(m.I=q2),m.B&amp;&amp;(Ob(m),Kb(m)),d.g=g}else ec(d);0&lt;c.i.length&amp;&amp;fc(c)}else"stop"!=l[0]&amp;&amp;"close"!=l[0]||R(c,7);else 3==c.G&amp;&amp;("stop"==l[0]||"close"==l[0]?"stop"==l[0]?R(c,7):gc(c):"noop"!=l[0]&amp;&amp;c.l&amp;&amp;c.l.ta(l),c.v=0)}J2()}catch(l){}}M2.prototype.ca=function(a){a=a.target;const b=this.M;b&amp;&amp;3==P(a)?b.j():this.Y(a)},M2.prototype.Y=function(a){try{if(a==this.g)a:{const w=P(this.g);var b=this.g.Ba();this.g.Z();if(!(3&gt;w)&amp;&amp;(3!=w||this.g&amp;&amp;(this.h.h||this.g.oa()||Nb(this.g)))){this.J||4!=w||7==b||J2(),Ob(this);var c=this.g.Z();this.X=c;b:if(Pb(this)){var d=Nb(this.g);a="";var e=d.length,f=4==P(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){Q2(this),Qb(this);var g="";break b}this.h.i=new k2.TextDecoder}for(b=0;b&lt;e;b++)this.h.h=!0,a+=this.h.i.decode(d[b],{stream:!(f&amp;&amp;b==e-1)});d.length=0,this.h.g+=a,this.C=0,g=this.h.g}else g=this.g.oa();if(this.o=200==c,function xb(a,b,c,d,e,f,g){a.info(function(){return"XMLHTTP RESP ("+d+") [ attempt "+e+"]: "+b+"\n"+c+"\n"+f+" "+g})}(this.i,this.u,this.A,this.l,this.R,w,c),this.o){if(this.T&amp;&amp;!this.K){b:{if(this.g){var m,q2=this.g;if((m=q2.g?q2.g.getResponseHeader("X-HTTP-Initial-Response"):null)&amp;&amp;!t(m)){var l=m;break b}}l=null}if(!(c=l)){this.o=!1,this.s=3,K2(12),Q2(this),Qb(this);break a}L2(this.i,this.l,c,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,Rb(this,c)}if(this.P){let B2;for(c=!0;!this.J&amp;&amp;this.C&lt;g.length;){if(B2=Sb(this,g),B2==Gb){4==w&amp;&amp;(this.s=4,K2(14),c=!1),L2(this.i,this.l,null,"[Incomplete Response]");break}if(B2==Fb){this.s=4,K2(15),L2(this.i,this.l,g,"[Invalid Chunk]"),c=!1;break}L2(this.i,this.l,B2,null),Rb(this,B2)}if(Pb(this)&amp;&amp;0!=this.C&amp;&amp;(this.h.g=this.h.g.slice(this.C),this.C=0),4!=w||0!=g.length||this.h.h||(this.s=1,K2(16),c=!1),this.o=this.o&amp;&amp;c,c){if(0&lt;g.length&amp;&amp;!this.W){this.W=!0;var v=this.j;v.g==this&amp;&amp;v.ba&amp;&amp;!v.M&amp;&amp;(v.j.info("Great, no buffering proxy detected. Bytes received: "+g.length),Tb(v),v.M=!0,K2(11))}}else L2(this.i,this.l,g,"[Invalid Chunked Response]"),Q2(this),Qb(this)}else L2(this.i,this.l,g,null),Rb(this,g);4==w&amp;&amp;Q2(this),this.o&amp;&amp;!this.J&amp;&amp;(4==w?Ub(this.j,this):(this.o=!1,Kb(this)))}else(function Vb(a){const b={};a=(a.g&amp;&amp;2&lt;=P(a)&amp;&amp;a.g.getAllResponseHeaders()||"").split("\r\n");for(let d=0;d&lt;a.length;d++){if(t(a[d]))continue;var c=va(a[d]);const e=c[0];if("string"!=typeof(c=c[1]))continue;c=c.trim();const f=b[e]||[];b[e]=f,f.push(c)}!function ra(a,b){for(const c in a)b.call(void 0,a[c],c,a)}(b,function(d){return d.join(", ")})})(this.g),400==c&amp;&amp;0&lt;g.indexOf("Unknown SID")?(this.s=3,K2(12)):(this.s=0,K2(13)),Q2(this),Qb(this)}}}catch(w){}},M2.prototype.cancel=function(){this.J=!0,Q2(this)},M2.prototype.ba=function(){this.B=null;const a=Date.now();0&lt;=a-this.S?(function zb(a,b){a.info(function(){return"TIMEOUT: "+b})}(this.i,this.A),2!=this.L&amp;&amp;(J2(),K2(17)),Q2(this),this.s=2,Qb(this)):Wb(this,this.S-a)};var hc=class{constructor(a,b){this.g=a,this.map=b}};function ic(a){this.l=a||10,k2.PerformanceNavigationTiming?a=0&lt;(a=k2.performance.getEntriesByType("navigation")).length&amp;&amp;("hq"==a[0].nextHopProtocol||"h2"==a[0].nextHopProtocol):a=!!(k2.chrome&amp;&amp;k2.chrome.loadTimes&amp;&amp;k2.chrome.loadTimes()&amp;&amp;k2.chrome.loadTimes().wasFetchedViaSpdy),this.j=a?this.l:1,this.g=null,1&lt;this.j&amp;&amp;(this.g=new Set),this.h=null,this.i=[]}function jc(a){return!!a.h||!!a.g&amp;&amp;a.g.size&gt;=a.j}function ac(a){return a.h?1:a.g?a.g.size:0}function Xb(a,b){return a.h?a.h==b:!!a.g&amp;&amp;a.g.has(b)}function bc(a,b){a.g?a.g.add(b):a.h=b}function dc(a,b){a.h&amp;&amp;a.h==b?a.h=null:a.g&amp;&amp;a.g.has(b)&amp;&amp;a.g.delete(b)}function kc(a){if(null!=a.h)return a.i.concat(a.h.D);if(null!=a.g&amp;&amp;0!==a.g.size){let b=a.i;for(const c of a.g.values())b=b.concat(c.D);return b}return la(a.i)}function nc(a,b){if(a.forEach&amp;&amp;"function"==typeof a.forEach)a.forEach(b,void 0);else if(ha(a)||"string"==typeof a)Array.prototype.forEach.call(a,b,void 0);else for(var c=function mc(a){if(a.na&amp;&amp;"function"==typeof a.na)return a.na();if(!a.V||"function"!=typeof a.V){if("undefined"!=typeof Map&amp;&amp;a instanceof Map)return Array.from(a.keys());if(!("undefined"!=typeof Set&amp;&amp;a instanceof Set)){if(ha(a)||"string"==typeof a){var b=[];a=a.length;for(var c=0;c&lt;a;c++)b.push(c);return b}b=[],c=0;for(const d in a)b[c++]=d;return b}}}(a),d=function lc(a){if(a.V&amp;&amp;"function"==typeof a.V)return a.V();if("undefined"!=typeof Map&amp;&amp;a instanceof Map||"undefined"!=typeof Set&amp;&amp;a instanceof Set)return Array.from(a.values());if("string"==typeof a)return a.split("");if(ha(a)){for(var b=[],c=a.length,d=0;d&lt;c;d++)b.push(a[d]);return b}for(d in b=[],c=0,a)b[c++]=a[d];return b}(a),e=d.length,f=0;f&lt;e;f++)b.call(void 0,d[f],c&amp;&amp;c[f],a)}ic.prototype.cancel=function(){if(this.i=kc(this),this.h)this.h.cancel(),this.h=null;else if(this.g&amp;&amp;0!==this.g.size){for(const a of this.g.values())a.cancel();this.g.clear()}};var oc=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function T(a){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,a instanceof T){this.h=a.h,qc(this,a.j),this.o=a.o,this.g=a.g,rc(this,a.s),this.l=a.l;var b=a.i,c=new sc;c.i=b.i,b.g&amp;&amp;(c.g=new Map(b.g),c.h=b.h),tc(this,c),this.m=a.m}else a&amp;&amp;(b=String(a).match(oc))?(this.h=!1,qc(this,b[1]||"",!0),this.o=uc(b[2]||""),this.g=uc(b[3]||"",!0),rc(this,b[4]),this.l=uc(b[5]||"",!0),tc(this,b[6]||"",!0),this.m=uc(b[7]||"")):(this.h=!1,this.i=new sc(null,this.h))}function N2(a){return new T(a)}function qc(a,b,c){a.j=c?uc(b,!0):b,a.j&amp;&amp;(a.j=a.j.replace(/:$/,""))}function rc(a,b){if(b){if(b=Number(b),isNaN(b)||0&gt;b)throw Error("Bad port number "+b);a.s=b}else a.s=null}function tc(a,b,c){b instanceof sc?(a.i=b,function Ac(a,b){b&amp;&amp;!a.j&amp;&amp;(U2(a),a.i=null,a.g.forEach(function(c,d){var e=d.toLowerCase();d!=e&amp;&amp;(Dc(this,d),Lb(this,e,c))},a)),a.j=b}(a.i,a.h)):(c||(b=vc(b,Bc)),a.i=new sc(b,a.h))}function S(a,b,c){a.i.set(b,c)}function Ib(a){return S(a,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),a}function uc(a,b){return a?b?decodeURI(a.replace(/%25/g,"%2525")):decodeURIComponent(a):""}function vc(a,b,c){return"string"==typeof a?(a=encodeURI(a).replace(b,Cc),c&amp;&amp;(a=a.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),a):null}function Cc(a){return"%"+((a=a.charCodeAt(0))&gt;&gt;4&amp;15).toString(16)+(15&amp;a).toString(16)}T.prototype.toString=function(){var a=[],b=this.j;b&amp;&amp;a.push(vc(b,wc,!0),":");var c=this.g;return(c||"file"==b)&amp;&amp;(a.push("//"),(b=this.o)&amp;&amp;a.push(vc(b,wc,!0),"@"),a.push(encodeURIComponent(String(c)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(c=this.s)&amp;&amp;a.push(":",String(c))),(c=this.l)&amp;&amp;(this.g&amp;&amp;"/"!=c.charAt(0)&amp;&amp;a.push("/"),a.push(vc(c,"/"==c.charAt(0)?xc:yc,!0))),(c=this.i.toString())&amp;&amp;a.push("?",c),(c=this.m)&amp;&amp;a.push("#",vc(c,zc)),a.join("")};var wc=/[#\/\?@]/g,yc=/[#\?:]/g,xc=/[#\?]/g,Bc=/[#\?@]/g,zc=/#/g;function sc(a,b){this.h=this.g=null,this.i=a||null,this.j=!!b}function U2(a){a.g||(a.g=new Map,a.h=0,a.i&amp;&amp;function pc(a,b){if(a){a=a.split("&amp;");for(var c=0;c&lt;a.length;c++){var d=a[c].indexOf("="),e=null;if(0&lt;=d){var f=a[c].substring(0,d);e=a[c].substring(d+1)}else f=a[c];b(f,e?decodeURIComponent(e.replace(/\+/g," ")):"")}}}(a.i,function(b,c){a.add(decodeURIComponent(b.replace(/\+/g," ")),c)}))}function Dc(a,b){U2(a),b=V(a,b),a.g.has(b)&amp;&amp;(a.i=null,a.h-=a.g.get(b).length,a.g.delete(b))}function Ec(a,b){return U2(a),b=V(a,b),a.g.has(b)}function Lb(a,b,c){Dc(a,b),0&lt;c.length&amp;&amp;(a.i=null,a.g.set(V(a,b),la(c)),a.h+=c.length)}function V(a,b){return b=String(b),a.j&amp;&amp;(b=b.toLowerCase()),b}function W2(a,b,c,d,e){try{e&amp;&amp;(e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null),d(c)}catch(f){}}function Hc(){this.g=new jb}function Ic(a,b,c){const d=c||"";try{nc(a,function(e,f){let g=e;n(e)&amp;&amp;(g=hb(e)),b.push(d+f+"="+encodeURIComponent(g))})}catch(e){throw b.push(d+"type="+encodeURIComponent("_badmap")),e}}function Jc(a){this.l=a.Ub||null,this.j=a.eb||!1}function Kc(a,b){E.call(this),this.D=a,this.o=b,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}function Nc(a){a.j.read().then(a.Pa.bind(a)).catch(a.ga.bind(a))}function Mc(a){a.readyState=4,a.l=null,a.j=null,a.v=null,Lc(a)}function Lc(a){a.onreadystatechange&amp;&amp;a.onreadystatechange.call(a)}function Oc(a){let b="";return qa(a,function(c,d){b+=d,b+=":",b+=c,b+="\r\n"}),b}function Pc(a,b,c){a:{for(d in c){var d=!1;break a}d=!0}d||(c=Oc(c),"string"==typeof a?null!=c&amp;&amp;encodeURIComponent(String(c)):S(a,b,c))}function X2(a){E.call(this),this.headers=new Map,this.o=a||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}(h=sc.prototype).add=function(a,b){U2(this),this.i=null,a=V(this,a);var c=this.g.get(a);return c||this.g.set(a,c=[]),c.push(b),this.h+=1,this},h.forEach=function(a,b){U2(this),this.g.forEach(function(c,d){c.forEach(function(e){a.call(b,e,d,this)},this)},this)},h.na=function(){U2(this);const a=Array.from(this.g.values()),b=Array.from(this.g.keys()),c=[];for(let d=0;d&lt;b.length;d++){const e=a[d];for(let f=0;f&lt;e.length;f++)c.push(b[d])}return c},h.V=function(a){U2(this);let b=[];if("string"==typeof a)Ec(this,a)&amp;&amp;(b=b.concat(this.g.get(V(this,a))));else{a=Array.from(this.g.values());for(let c=0;c&lt;a.length;c++)b=b.concat(a[c])}return b},h.set=function(a,b){return U2(this),this.i=null,Ec(this,a=V(this,a))&amp;&amp;(this.h-=this.g.get(a).length),this.g.set(a,[b]),this.h+=1,this},h.get=function(a,b){return a&amp;&amp;0&lt;(a=this.V(a)).length?String(a[0]):b},h.toString=function(){if(this.i)return this.i;if(!this.g)return"";const a=[],b=Array.from(this.g.keys());for(var c=0;c&lt;b.length;c++){var d=b[c];const f=encodeURIComponent(String(d)),g=this.V(d);for(d=0;d&lt;g.length;d++){var e=f;""!==g[d]&amp;&amp;(e+="="+encodeURIComponent(String(g[d]))),a.push(e)}}return this.i=a.join("&amp;")},r(Jc,kb),Jc.prototype.g=function(){return new Kc(this.l,this.j)},Jc.prototype.i=function(a){return function(){return a}}({}),r(Kc,E),(h=Kc.prototype).open=function(a,b){if(0!=this.readyState)throw this.abort(),Error("Error reopening a connection");this.B=a,this.A=b,this.readyState=1,Lc(this)},h.send=function(a){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const b={headers:this.u,method:this.B,credentials:this.m,cache:void 0};a&amp;&amp;(b.body=a),(this.D||k2).fetch(new Request(this.A,b)).then(this.Sa.bind(this),this.ga.bind(this))},h.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&amp;&amp;this.j.cancel("Request was aborted.").catch(()=&gt;{}),1&lt;=this.readyState&amp;&amp;this.g&amp;&amp;4!=this.readyState&amp;&amp;(this.g=!1,Mc(this)),this.readyState=0},h.Sa=function(a){if(this.g&amp;&amp;(this.l=a,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=a.headers,this.readyState=2,Lc(this)),this.g&amp;&amp;(this.readyState=3,Lc(this),this.g)))if("arraybuffer"===this.responseType)a.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(void 0!==k2.ReadableStream&amp;&amp;"body"in a){if(this.j=a.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;Nc(this)}else a.text().then(this.Ra.bind(this),this.ga.bind(this))},h.Pa=function(a){if(this.g){if(this.o&amp;&amp;a.value)this.response.push(a.value);else if(!this.o){var b=a.value?a.value:new Uint8Array(0);(b=this.v.decode(b,{stream:!a.done}))&amp;&amp;(this.response=this.responseText+=b)}a.done?Mc(this):Lc(this),3==this.readyState&amp;&amp;Nc(this)}},h.Ra=function(a){this.g&amp;&amp;(this.response=this.responseText=a,Mc(this))},h.Qa=function(a){this.g&amp;&amp;(this.response=a,Mc(this))},h.ga=function(){this.g&amp;&amp;Mc(this)},h.setRequestHeader=function(a,b){this.u.append(a,b)},h.getResponseHeader=function(a){return this.h&amp;&amp;this.h.get(a.toLowerCase())||""},h.getAllResponseHeaders=function(){if(!this.h)return"";const a=[],b=this.h.entries();for(var c=b.next();!c.done;)c=c.value,a.push(c[0]+": "+c[1]),c=b.next();return a.join("\r\n")},Object.defineProperty(Kc.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(a){this.m=a?"include":"same-origin"}}),r(X2,E);var Qc=/^https?$/i,Rc=["POST","PUT"];function Sc(a,b){a.h=!1,a.g&amp;&amp;(a.j=!0,a.g.abort(),a.j=!1),a.l=b,a.m=5,Uc(a),Vc(a)}function Uc(a){a.A||(a.A=!0,F2(a,"complete"),F2(a,"error"))}function Wc(a){if(a.h&amp;&amp;void 0!==fa&amp;&amp;(!a.v[1]||4!=P(a)||2!=a.Z()))if(a.u&amp;&amp;4==P(a))bb(a.Ea,0,a);else if(F2(a,"readystatechange"),4==P(a)){a.h=!1;try{const g=a.Z();a:switch(g){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var b=!0;break a;default:b=!1}var c;if(!(c=b)){var d;if(d=0===g){var e=String(a.D).match(oc)[1]||null;!e&amp;&amp;k2.self&amp;&amp;k2.self.location&amp;&amp;(e=k2.self.location.protocol.slice(0,-1)),d=!Qc.test(e?e.toLowerCase():"")}c=d}if(c)F2(a,"complete"),F2(a,"success");else{a.m=6;try{var f=2&lt;P(a)?a.g.statusText:""}catch(m){f=""}a.l=f+" ["+a.Z()+"]",Uc(a)}}finally{Vc(a)}}}function Vc(a,b){if(a.g){Tc(a);const c=a.g,d=a.v[0]?()=&gt;{}:null;a.g=null,a.v=null,b||F2(a,"ready");try{c.onreadystatechange=d}catch(e){}}}function Tc(a){a.I&amp;&amp;(k2.clearTimeout(a.I),a.I=null)}function P(a){return a.g?a.g.readyState:0}function Nb(a){try{if(!a.g)return null;if("response"in a.g)return a.g.response;switch(a.H){case"":case"text":return a.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in a.g)return a.g.mozResponseArrayBuffer}return null}catch(b){return null}}function Xc(a,b,c){return c&amp;&amp;c.internalChannelParams&amp;&amp;c.internalChannelParams[a]||b}function Yc(a){this.Aa=0,this.i=[],this.j=new vb,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=Xc("failFast",!1,a),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=Xc("baseRetryDelayMs",5e3,a),this.cb=Xc("retryDelaySeedMs",1e4,a),this.Wa=Xc("forwardChannelMaxRetries",2,a),this.wa=Xc("forwardChannelRequestTimeoutMs",2e4,a),this.pa=a&amp;&amp;a.xmlHttpFactory||void 0,this.Xa=a&amp;&amp;a.Tb||void 0,this.Ca=a&amp;&amp;a.useFetchStreams||!1,this.L=void 0,this.J=a&amp;&amp;a.supportsCrossDomainXhr||!1,this.K="",this.h=new ic(a&amp;&amp;a.concurrentRequestLimit),this.Da=new Hc,this.P=a&amp;&amp;a.fastHandshake||!1,this.O=a&amp;&amp;a.encodeInitMessageHeaders||!1,this.P&amp;&amp;this.O&amp;&amp;(this.O=!1),this.Ua=a&amp;&amp;a.Rb||!1,a&amp;&amp;a.xa&amp;&amp;this.j.xa(),a&amp;&amp;a.forceLongPolling&amp;&amp;(this.X=!1),this.ba=!this.P&amp;&amp;this.X&amp;&amp;a&amp;&amp;a.detectBufferingProxy||!1,this.ja=void 0,a&amp;&amp;a.longPollingTimeout&amp;&amp;0&lt;a.longPollingTimeout&amp;&amp;(this.ja=a.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}function gc(a){if(Zc(a),3==a.G){var b=a.U++,c=N2(a.I);if(S(c,"SID",a.K),S(c,"RID",b),S(c,"TYPE","terminate"),$c(a,c),(b=new M2(a,a.j,b)).L=2,b.v=Ib(N2(c)),c=!1,k2.navigator&amp;&amp;k2.navigator.sendBeacon)try{c=k2.navigator.sendBeacon(b.v.toString(),"")}catch(d){}!c&amp;&amp;k2.Image&amp;&amp;((new Image).src=b.v,c=!0),c||(b.g=Mb(b.j,null),b.g.ea(b.v)),b.F=Date.now(),Kb(b)}ad(a)}function Zb(a){a.g&amp;&amp;(Tb(a),a.g.cancel(),a.g=null)}function Zc(a){Zb(a),a.u&amp;&amp;(k2.clearTimeout(a.u),a.u=null),Yb(a),a.h.cancel(),a.s&amp;&amp;("number"==typeof a.s&amp;&amp;k2.clearTimeout(a.s),a.s=null)}function fc(a){if(!jc(a.h)&amp;&amp;!a.s){a.s=!0;var b=a.Ga;x2||Ea(),y||(x2(),y=!0),za.add(b,a),a.B=0}}function ed(a,b){var c;c=b?b.l:a.U++;const d=N2(a.I);S(d,"SID",a.K),S(d,"RID",c),S(d,"AID",a.T),$c(a,d),a.m&amp;&amp;a.o&amp;&amp;Pc(d,a.m,a.o),c=new M2(a,a.j,c,a.B+1),null===a.m&amp;&amp;(c.H=a.o),b&amp;&amp;(a.i=b.D.concat(a.i)),b=dd(a,c,1e3),c.I=Math.round(.5*a.wa)+Math.round(.5*a.wa*Math.random()),bc(a.h,c),Hb(c,d,b)}function $c(a,b){a.H&amp;&amp;qa(a.H,function(c,d){S(b,d,c)}),a.l&amp;&amp;nc({},function(c,d){S(b,d,c)})}function dd(a,b,c){c=Math.min(a.i.length,c);var d=a.l?p(a.l.Na,a.l,a):null;a:{var e=a.i;let f=-1;for(;;){const g=["count="+c];-1==f?0&lt;c?(f=e[0].g,g.push("ofs="+f)):f=0:g.push("ofs="+f);let m=!0;for(let q2=0;q2&lt;c;q2++){let l=e[q2].g;const v=e[q2].map;if(l-=f,0&gt;l)f=Math.max(0,e[q2].g-100),m=!1;else try{Ic(v,g,"req"+l+"_")}catch(w){d&amp;&amp;d(v)}}if(m){d=g.join("&amp;");break a}}}return a=a.i.splice(0,c),b.D=a,d}function ec(a){if(!a.g&amp;&amp;!a.u){a.Y=1;var b=a.Fa;x2||Ea(),y||(x2(),y=!0),za.add(b,a),a.v=0}}function $b(a){return!(a.g||a.u||3&lt;=a.v)&amp;&amp;(a.Y++,a.u=ub(p(a.Fa,a),cd(a,a.v)),a.v++,!0)}function Tb(a){null!=a.A&amp;&amp;(k2.clearTimeout(a.A),a.A=null)}function fd(a){a.g=new M2(a,a.j,"rpc",a.Y),null===a.m&amp;&amp;(a.g.H=a.o),a.g.O=0;var b=N2(a.qa);S(b,"RID","rpc"),S(b,"SID",a.K),S(b,"AID",a.T),S(b,"CI",a.F?"0":"1"),!a.F&amp;&amp;a.ja&amp;&amp;S(b,"TO",a.ja),S(b,"TYPE","xmlhttp"),$c(a,b),a.m&amp;&amp;a.o&amp;&amp;Pc(b,a.m,a.o),a.L&amp;&amp;(a.g.I=a.L);var c=a.g;a=a.ia,c.L=1,c.v=Ib(N2(b)),c.m=null,c.P=!0,Jb(c,a)}function Yb(a){null!=a.C&amp;&amp;(k2.clearTimeout(a.C),a.C=null)}function Ub(a,b){var c=null;if(a.g==b){Yb(a),Tb(a),a.g=null;var d=2}else{if(!Xb(a.h,b))return;c=b.D,dc(a.h,b),d=1}if(0!=a.G)if(b.o)if(1==d){c=b.m?b.m.length:0,b=Date.now()-b.F;var e=a.B;F2(d=qb(),new tb(d,c)),fc(a)}else ec(a);else if(3==(e=b.s)||0==e&amp;&amp;0&lt;b.X||!(1==d&amp;&amp;function bd(a,b){return!(ac(a.h)&gt;=a.h.j-(a.s?1:0)||(a.s?(a.i=b.D.concat(a.i),0):1==a.G||2==a.G||a.B&gt;=(a.Va?0:a.Wa)||(a.s=ub(p(a.Ga,a,b),cd(a,a.B)),a.B++,0)))}(a,b)||2==d&amp;&amp;$b(a)))switch(c&amp;&amp;0&lt;c.length&amp;&amp;(b=a.h,b.i=b.i.concat(c)),e){case 1:R(a,5);break;case 4:R(a,10);break;case 3:R(a,6);break;default:R(a,2)}}function cd(a,b){let c=a.Ta+Math.floor(Math.random()*a.cb);return a.isActive()||(c*=2),c*b}function R(a,b){if(a.j.info("Error code "+b),2==b){var c=p(a.fb,a),d=a.Xa;const e=!d;d=new T(d||"//www.google.com/images/cleardot.gif"),k2.location&amp;&amp;"http"==k2.location.protocol||qc(d,"https"),Ib(d),e?function Fc(a,b){const c=new vb;if(k2.Image){const d=new Image;d.onload=ka(W2,c,"TestLoadImage: loaded",!0,b,d),d.onerror=ka(W2,c,"TestLoadImage: error",!1,b,d),d.onabort=ka(W2,c,"TestLoadImage: abort",!1,b,d),d.ontimeout=ka(W2,c,"TestLoadImage: timeout",!1,b,d),k2.setTimeout(function(){d.ontimeout&amp;&amp;d.ontimeout()},1e4),d.src=a}else b(!1)}(d.toString(),c):function Gc(a,b){new vb;const d=new AbortController,e=setTimeout(()=&gt;{d.abort(),W2(0,0,!1,b)},1e4);fetch(a,{signal:d.signal}).then(f=&gt;{clearTimeout(e),f.ok?W2(0,0,!0,b):W2(0,0,!1,b)}).catch(()=&gt;{clearTimeout(e),W2(0,0,!1,b)})}(d.toString(),c)}else K2(2);a.G=0,a.l&amp;&amp;a.l.sa(b),ad(a),Zc(a)}function ad(a){if(a.G=0,a.ka=[],a.l){const b=kc(a.h);0==b.length&amp;&amp;0==a.i.length||(ma(a.ka,b),ma(a.ka,a.i),a.h.i.length=0,la(a.i),a.i.length=0),a.l.ra()}}function cc(a,b,c){var d=c instanceof T?N2(c):new T(c);if(""!=d.g)b&amp;&amp;(d.g=b+"."+d.g),rc(d,d.s);else{var e=k2.location;d=e.protocol,b=b?b+"."+e.hostname:e.hostname,e=+e.port;var f=new T(null);d&amp;&amp;qc(f,d),b&amp;&amp;(f.g=b),e&amp;&amp;rc(f,e),c&amp;&amp;(f.l=c),d=f}return c=a.D,b=a.ya,c&amp;&amp;b&amp;&amp;S(d,c,b),S(d,"VER",a.la),$c(a,d),d}function Mb(a,b,c){if(b&amp;&amp;!a.J)throw Error("Can't create secondary domain capable XhrIo object.");return(b=a.Ca&amp;&amp;!a.pa?new X2(new Jc({eb:c})):new X2(a.pa)).Ha(a.J),b}function gd(){}function hd(){}function Y2(a,b){E.call(this),this.g=new Yc(b),this.l=a,this.h=b&amp;&amp;b.messageUrlParams||null,a=b&amp;&amp;b.messageHeaders||null,b&amp;&amp;b.clientProtocolHeaderRequired&amp;&amp;(a?a["X-Client-Protocol"]="webchannel":a={"X-Client-Protocol":"webchannel"}),this.g.o=a,a=b&amp;&amp;b.initMessageHeaders||null,b&amp;&amp;b.messageContentType&amp;&amp;(a?a["X-WebChannel-Content-Type"]=b.messageContentType:a={"X-WebChannel-Content-Type":b.messageContentType}),b&amp;&amp;b.va&amp;&amp;(a?a["X-WebChannel-Client-Profile"]=b.va:a={"X-WebChannel-Client-Profile":b.va}),this.g.S=a,(a=b&amp;&amp;b.Sb)&amp;&amp;!t(a)&amp;&amp;(this.g.m=a),this.v=b&amp;&amp;b.supportsCrossDomainXhr||!1,this.u=b&amp;&amp;b.sendRawJson||!1,(b=b&amp;&amp;b.httpSessionIdParam)&amp;&amp;!t(b)&amp;&amp;(this.g.D=b,null!==(a=this.h)&amp;&amp;b in a&amp;&amp;(b in(a=this.h)&amp;&amp;delete a[b])),this.j=new Z2(this)}function id(a){nb.call(this),a.__headers__&amp;&amp;(this.headers=a.__headers__,this.statusCode=a.__status__,delete a.__headers__,delete a.__status__);var b=a.__sm__;if(b){a:{for(const c in b){a=c;break a}a=void 0}(this.i=a)&amp;&amp;(a=this.i,b=null!==b&amp;&amp;a in b?b[a]:void 0),this.data=b}else this.data=a}function jd(){ob.call(this),this.status=1}function Z2(a){this.g=a}(h=X2.prototype).Ha=function(a){this.J=a},h.ea=function(a,b,c,d){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+a);b=b?b.toUpperCase():"GET",this.D=a,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():Cb.g(),this.v=this.o?lb(this.o):lb(Cb),this.g.onreadystatechange=p(this.Ea,this);try{this.B=!0,this.g.open(b,String(a),!0),this.B=!1}catch(f){return void Sc(this,f)}if(a=c||"",c=new Map(this.headers),d)if(Object.getPrototypeOf(d)===Object.prototype)for(var e in d)c.set(e,d[e]);else{if("function"!=typeof d.keys||"function"!=typeof d.get)throw Error("Unknown input type for opt_headers: "+String(d));for(const f of d.keys())c.set(f,d.get(f))}d=Array.from(c.keys()).find(f=&gt;"content-type"==f.toLowerCase()),e=k2.FormData&amp;&amp;a instanceof k2.FormData,!(0&lt;=Array.prototype.indexOf.call(Rc,b,void 0))||d||e||c.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[f,g]of c)this.g.setRequestHeader(f,g);this.H&amp;&amp;(this.g.responseType=this.H),"withCredentials"in this.g&amp;&amp;this.g.withCredentials!==this.J&amp;&amp;(this.g.withCredentials=this.J);try{Tc(this),this.u=!0,this.g.send(a),this.u=!1}catch(f){Sc(this,f)}},h.abort=function(a){this.g&amp;&amp;this.h&amp;&amp;(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=a||7,F2(this,"complete"),F2(this,"abort"),Vc(this))},h.N=function(){this.g&amp;&amp;(this.h&amp;&amp;(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Vc(this,!0)),X2.aa.N.call(this)},h.Ea=function(){this.s||(this.B||this.u||this.j?Wc(this):this.bb())},h.bb=function(){Wc(this)},h.isActive=function(){return!!this.g},h.Z=function(){try{return 2&lt;P(this)?this.g.status:-1}catch(a){return-1}},h.oa=function(){try{return this.g?this.g.responseText:""}catch(a){return""}},h.Oa=function(a){if(this.g){var b=this.g.responseText;return a&amp;&amp;0==b.indexOf(a)&amp;&amp;(b=b.substring(a.length)),ib(b)}},h.Ba=function(){return this.m},h.Ka=function(){return"string"==typeof this.l?this.l:String(this.l)},(h=Yc.prototype).la=8,h.G=1,h.connect=function(a,b,c,d){K2(0),this.W=a,this.H=b||{},c&amp;&amp;void 0!==d&amp;&amp;(this.H.OSID=c,this.H.OAID=d),this.F=this.X,this.I=cc(this,null,this.W),fc(this)},h.Ga=function(a){if(this.s)if(this.s=null,1==this.G){if(!a){this.U=Math.floor(1e5*Math.random()),a=this.U++;const e=new M2(this,this.j,a);let f=this.o;if(this.S&amp;&amp;(f?(f=sa(f),ua(f,this.S)):f=this.S),null!==this.m||this.O||(e.H=f,f=null),this.P)a:{for(var b=0,c=0;c&lt;this.i.length;c++){var d=this.i[c];if(void 0===(d="__data__"in d.map&amp;&amp;"string"==typeof(d=d.map.__data__)?d.length:void 0))break;if(4096&lt;(b+=d)){b=c;break a}if(4096===b||c===this.i.length-1){b=c+1;break a}}b=1e3}else b=1e3;b=dd(this,e,b),S(c=N2(this.I),"RID",a),S(c,"CVER",22),this.D&amp;&amp;S(c,"X-HTTP-Session-Id",this.D),$c(this,c),f&amp;&amp;(this.O?b="headers="+encodeURIComponent(String(Oc(f)))+"&amp;"+b:this.m&amp;&amp;Pc(c,this.m,f)),bc(this.h,e),this.Ua&amp;&amp;S(c,"TYPE","init"),this.P?(S(c,"$req",b),S(c,"SID","null"),e.T=!0,Hb(e,c,null)):Hb(e,c,b),this.G=2}}else 3==this.G&amp;&amp;(a?ed(this,a):0==this.i.length||jc(this.h)||ed(this))},h.Fa=function(){if(this.u=null,fd(this),this.ba&amp;&amp;!(this.M||null==this.g||0&gt;=this.R)){var a=2*this.R;this.j.info("BP detection timer enabled: "+a),this.A=ub(p(this.ab,this),a)}},h.ab=function(){this.A&amp;&amp;(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,K2(10),Zb(this),fd(this))},h.Za=function(){null!=this.C&amp;&amp;(this.C=null,Zb(this),$b(this),K2(19))},h.fb=function(a){a?(this.j.info("Successfully pinged google.com"),K2(2)):(this.j.info("Failed to ping google.com"),K2(1))},h.isActive=function(){return!!this.l&amp;&amp;this.l.isActive(this)},(h=gd.prototype).ua=function(){},h.ta=function(){},h.sa=function(){},h.ra=function(){},h.isActive=function(){return!0},h.Na=function(){},hd.prototype.g=function(a,b){return new Y2(a,b)},r(Y2,E),Y2.prototype.m=function(){this.g.l=this.j,this.v&amp;&amp;(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},Y2.prototype.close=function(){gc(this.g)},Y2.prototype.o=function(a){var b=this.g;if("string"==typeof a){var c={};c.__data__=a,a=c}else this.u&amp;&amp;((c={}).__data__=hb(a),a=c);b.i.push(new hc(b.Ya++,a)),3==b.G&amp;&amp;fc(b)},Y2.prototype.N=function(){this.g.l=null,delete this.j,gc(this.g),delete this.g,Y2.aa.N.call(this)},r(id,nb),r(jd,ob),r(Z2,gd),Z2.prototype.ua=function(){F2(this.g,"a")},Z2.prototype.ta=function(a){F2(this.g,new id(a))},Z2.prototype.sa=function(a){F2(this.g,new jd)},Z2.prototype.ra=function(){F2(this.g,"b")},hd.prototype.createWebChannel=hd.prototype.g,Y2.prototype.send=Y2.prototype.o,Y2.prototype.open=Y2.prototype.m,Y2.prototype.close=Y2.prototype.close,createWebChannelTransport=function(){return new hd},getStatEventTarget=function(){return qb()},Event=I,Stat={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},Ab.NO_ERROR=0,Ab.TIMEOUT=8,Ab.HTTP_ERROR=6,ErrorCode$1=Ab,Bb.COMPLETE="complete",EventType=Bb,mb.EventType=H2,H2.OPEN="a",H2.CLOSE="b",H2.ERROR="c",H2.MESSAGE="d",E.prototype.listen=E.prototype.K,WebChannel=mb,X2.prototype.listenOnce=X2.prototype.L,X2.prototype.getLastError=X2.prototype.Ka,X2.prototype.getLastErrorCode=X2.prototype.Ba,X2.prototype.getStatus=X2.prototype.Z,X2.prototype.getResponseJson=X2.prototype.Oa,X2.prototype.getResponseText=X2.prototype.oa,X2.prototype.send=X2.prototype.ea,X2.prototype.setWithCredentials=X2.prototype.Ha,XhrIo=X2}).apply(void 0!==commonjsGlobal?commonjsGlobal:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{});const F="@firebase/firestore",M="4.8.0";class User{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}User.UNAUTHENTICATED=new User(null),User.GOOGLE_CREDENTIALS=new User("google-credentials-uid"),User.FIRST_PARTY=new User("first-party-uid"),User.MOCK_USER=new User("mock-user");let x="11.10.0";const O=new Logger("@firebase/firestore");function __PRIVATE_getLogLevel(){return O.logLevel}function __PRIVATE_logDebug(e,...t){if(O.logLevel&lt;=LogLevel.DEBUG){const n=t.map(__PRIVATE_argToString);O.debug(`Firestore (${x}): ${e}`,...n)}}function __PRIVATE_logError(e,...t){if(O.logLevel&lt;=LogLevel.ERROR){const n=t.map(__PRIVATE_argToString);O.error(`Firestore (${x}): ${e}`,...n)}}function __PRIVATE_logWarn(e,...t){if(O.logLevel&lt;=LogLevel.WARN){const n=t.map(__PRIVATE_argToString);O.warn(`Firestore (${x}): ${e}`,...n)}}function __PRIVATE_argToString(e){if("string"==typeof e)return e;try{return function __PRIVATE_formatJSON(e2){return JSON.stringify(e2)}(e)}catch(t){return e}}function fail(e,t,n){let r="Unexpected state";"string"==typeof t?r=t:n=t,__PRIVATE__fail(e,r,n)}function __PRIVATE__fail(e,t,n){let r=`FIRESTORE (${x}) INTERNAL ASSERTION FAILED: ${t} (ID: ${e.toString(16)})`;if(void 0!==n)try{r+=" CONTEXT: "+JSON.stringify(n)}catch(e2){r+=" CONTEXT: "+n}throw __PRIVATE_logError(r),new Error(r)}function __PRIVATE_hardAssert(e,t,n,r){let i="Unexpected state";"string"==typeof n?i=n:r=n,e||__PRIVATE__fail(t,i,r)}function __PRIVATE_debugCast(e,t){return e}const N={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class FirestoreError extends FirebaseError{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=&gt;`${this.name}: [code=${this.code}]: ${this.message}`}}class __PRIVATE_Deferred{constructor(){this.promise=new Promise((e,t)=&gt;{this.resolve=e,this.reject=t})}}class __PRIVATE_OAuthToken{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class __PRIVATE_EmptyAuthCredentialsProvider{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=&gt;t(User.UNAUTHENTICATED))}shutdown(){}}class __PRIVATE_EmulatorAuthCredentialsProvider{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=&gt;t(this.token.user))}shutdown(){this.changeListener=null}}class __PRIVATE_FirebaseAuthCredentialsProvider{constructor(e){this.t=e,this.currentUser=User.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){__PRIVATE_hardAssert(void 0===this.o,42304);let n=this.i;const __PRIVATE_guardedChangeListener=e2=&gt;this.i!==n?(n=this.i,t(e2)):Promise.resolve();let r=new __PRIVATE_Deferred;this.o=()=&gt;{this.i++,this.currentUser=this.u(),r.resolve(),r=new __PRIVATE_Deferred,e.enqueueRetryable(()=&gt;__PRIVATE_guardedChangeListener(this.currentUser))};const __PRIVATE_awaitNextToken=()=&gt;{const t2=r;e.enqueueRetryable(async()=&gt;{await t2.promise,await __PRIVATE_guardedChangeListener(this.currentUser)})},__PRIVATE_registerAuth=e2=&gt;{__PRIVATE_logDebug("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=e2,this.o&amp;&amp;(this.auth.addAuthTokenListener(this.o),__PRIVATE_awaitNextToken())};this.t.onInit(e2=&gt;__PRIVATE_registerAuth(e2)),setTimeout(()=&gt;{if(!this.auth){const e2=this.t.getImmediate({optional:!0});e2?__PRIVATE_registerAuth(e2):(__PRIVATE_logDebug("FirebaseAuthCredentialsProvider","Auth not yet detected"),r.resolve(),r=new __PRIVATE_Deferred)}},0),__PRIVATE_awaitNextToken()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(t2=&gt;this.i!==e?(__PRIVATE_logDebug("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):t2?(__PRIVATE_hardAssert("string"==typeof t2.accessToken,31837,{l:t2}),new __PRIVATE_OAuthToken(t2.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&amp;&amp;this.o&amp;&amp;this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&amp;&amp;this.auth.getUid();return __PRIVATE_hardAssert(null===e||"string"==typeof e,2055,{h:e}),new User(e)}}class __PRIVATE_FirstPartyToken{constructor(e,t,n){this.P=e,this.T=t,this.I=n,this.type="FirstParty",this.user=User.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);const e=this.R();return e&amp;&amp;this.A.set("Authorization",e),this.T&amp;&amp;this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class __PRIVATE_FirstPartyAuthCredentialsProvider{constructor(e,t,n){this.P=e,this.T=t,this.I=n}getToken(){return Promise.resolve(new __PRIVATE_FirstPartyToken(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable(()=&gt;t(User.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class AppCheckToken{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&amp;&amp;e.length&gt;0&amp;&amp;this.headers.set("x-firebase-appcheck",this.value)}}class __PRIVATE_FirebaseAppCheckTokenProvider{constructor(t,n){this.V=n,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,_isFirebaseServerApp(t)&amp;&amp;t.settings.appCheckToken&amp;&amp;(this.p=t.settings.appCheckToken)}start(e,t){__PRIVATE_hardAssert(void 0===this.o,3512);const onTokenChanged=e2=&gt;{null!=e2.error&amp;&amp;__PRIVATE_logDebug("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${e2.error.message}`);const n=e2.token!==this.m;return this.m=e2.token,__PRIVATE_logDebug("FirebaseAppCheckTokenProvider",`Received ${n?"new":"existing"} token.`),n?t(e2.token):Promise.resolve()};this.o=t2=&gt;{e.enqueueRetryable(()=&gt;onTokenChanged(t2))};const __PRIVATE_registerAppCheck=e2=&gt;{__PRIVATE_logDebug("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=e2,this.o&amp;&amp;this.appCheck.addTokenListener(this.o)};this.V.onInit(e2=&gt;__PRIVATE_registerAppCheck(e2)),setTimeout(()=&gt;{if(!this.appCheck){const e2=this.V.getImmediate({optional:!0});e2?__PRIVATE_registerAppCheck(e2):__PRIVATE_logDebug("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.p)return Promise.resolve(new AppCheckToken(this.p));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(e2=&gt;e2?(__PRIVATE_hardAssert("string"==typeof e2.token,44558,{tokenResult:e2}),this.m=e2.token,new AppCheckToken(e2.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&amp;&amp;this.o&amp;&amp;this.appCheck.removeTokenListener(this.o),this.o=void 0}}function __PRIVATE_randomBytes(e){const t="undefined"!=typeof self&amp;&amp;(self.crypto||self.msCrypto),n=new Uint8Array(e);if(t&amp;&amp;"function"==typeof t.getRandomValues)t.getRandomValues(n);else for(let t2=0;t2&lt;e;t2++)n[t2]=Math.floor(256*Math.random());return n}function __PRIVATE_newTextEncoder(){return new TextEncoder}class __PRIVATE_AutoId{static newId(){const t=62*Math.floor(256/62);let n="";for(;n.length&lt;20;){const r=__PRIVATE_randomBytes(40);for(let i=0;i&lt;r.length;++i)n.length&lt;20&amp;&amp;r[i]&lt;t&amp;&amp;(n+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(r[i]%62))}return n}}function __PRIVATE_primitiveComparator(e,t){return e&lt;t?-1:e&gt;t?1:0}function __PRIVATE_compareUtf8Strings(e,t){let n=0;for(;n&lt;e.length&amp;&amp;n&lt;t.length;){const r=e.codePointAt(n),i=t.codePointAt(n);if(r!==i){if(r&lt;128&amp;&amp;i&lt;128)return __PRIVATE_primitiveComparator(r,i);{const s=__PRIVATE_newTextEncoder(),o=__PRIVATE_compareByteArrays$1(s.encode(__PRIVATE_getUtf8SafeSubstring(e,n)),s.encode(__PRIVATE_getUtf8SafeSubstring(t,n)));return 0!==o?o:__PRIVATE_primitiveComparator(r,i)}}n+=r&gt;65535?2:1}return __PRIVATE_primitiveComparator(e.length,t.length)}function __PRIVATE_getUtf8SafeSubstring(e,t){return e.codePointAt(t)&gt;65535?e.substring(t,t+2):e.substring(t,t+1)}function __PRIVATE_compareByteArrays$1(e,t){for(let n=0;n&lt;e.length&amp;&amp;n&lt;t.length;++n)if(e[n]!==t[n])return __PRIVATE_primitiveComparator(e[n],t[n]);return __PRIVATE_primitiveComparator(e.length,t.length)}function __PRIVATE_arrayEquals(e,t,n){return e.length===t.length&amp;&amp;e.every((e2,r)=&gt;n(e2,t[r]))}function __PRIVATE_immediateSuccessor(e){return e+"\0"}const B="__name__";class BasePath{constructor(e,t,n){void 0===t?t=0:t&gt;e.length&amp;&amp;fail(637,{offset:t,range:e.length}),void 0===n?n=e.length-t:n&gt;e.length-t&amp;&amp;fail(1746,{length:n,range:e.length-t}),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return 0===BasePath.comparator(this,e)}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof BasePath?e.forEach(e2=&gt;{t.push(e2)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=void 0===e?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length&lt;this.length)return!1;for(let t=0;t&lt;this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t&lt;this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t&lt;n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const n=Math.min(e.length,t.length);for(let r=0;r&lt;n;r++){const n2=BasePath.compareSegments(e.get(r),t.get(r));if(0!==n2)return n2}return __PRIVATE_primitiveComparator(e.length,t.length)}static compareSegments(e,t){const n=BasePath.isNumericId(e),r=BasePath.isNumericId(t);return n&amp;&amp;!r?-1:!n&amp;&amp;r?1:n&amp;&amp;r?BasePath.extractNumericId(e).compare(BasePath.extractNumericId(t)):__PRIVATE_compareUtf8Strings(e,t)}static isNumericId(e){return e.startsWith("__id")&amp;&amp;e.endsWith("__")}static extractNumericId(e){return Integer.fromString(e.substring(4,e.length-2))}}class ResourcePath extends BasePath{construct(e,t,n){return new ResourcePath(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const n of e){if(n.indexOf("//")&gt;=0)throw new FirestoreError(N.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);t.push(...n.split("/").filter(e2=&gt;e2.length&gt;0))}return new ResourcePath(t)}static emptyPath(){return new ResourcePath([])}}const L=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class FieldPath$1 extends BasePath{construct(e,t,n){return new FieldPath$1(e,t,n)}static isValidIdentifier(e){return L.test(e)}canonicalString(){return this.toArray().map(e=&gt;(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),FieldPath$1.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&amp;&amp;this.get(0)===B}static keyField(){return new FieldPath$1([B])}static fromServerFormat(e){const t=[];let n="",r=0;const __PRIVATE_addCurrentSegment=()=&gt;{if(0===n.length)throw new FirestoreError(N.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(n),n=""};let i=!1;for(;r&lt;e.length;){const t2=e[r];if("\\"===t2){if(r+1===e.length)throw new FirestoreError(N.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const t3=e[r+1];if("\\"!==t3&amp;&amp;"."!==t3&amp;&amp;"`"!==t3)throw new FirestoreError(N.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=t3,r+=2}else"`"===t2?(i=!i,r++):"."!==t2||i?(n+=t2,r++):(__PRIVATE_addCurrentSegment(),r++)}if(__PRIVATE_addCurrentSegment(),i)throw new FirestoreError(N.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new FieldPath$1(t)}static emptyPath(){return new FieldPath$1([])}}class DocumentKey{constructor(e){this.path=e}static fromPath(e){return new DocumentKey(ResourcePath.fromString(e))}static fromName(e){return new DocumentKey(ResourcePath.fromString(e).popFirst(5))}static empty(){return new DocumentKey(ResourcePath.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length&gt;=2&amp;&amp;this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&amp;&amp;0===ResourcePath.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return ResourcePath.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new DocumentKey(new ResourcePath(e.slice()))}}function __PRIVATE_validateNonEmptyArgument(e,t,n){if(!n)throw new FirestoreError(N.INVALID_ARGUMENT,`Function ${e}() cannot be called with an empty ${t}.`)}function __PRIVATE_validateIsNotUsedTogether(e,t,n,r){if(!0===t&amp;&amp;!0===r)throw new FirestoreError(N.INVALID_ARGUMENT,`${e} and ${n} cannot be used together.`)}function __PRIVATE_validateDocumentPath(e){if(!DocumentKey.isDocumentKey(e))throw new FirestoreError(N.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${e} has ${e.length}.`)}function __PRIVATE_validateCollectionPath(e){if(DocumentKey.isDocumentKey(e))throw new FirestoreError(N.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${e} has ${e.length}.`)}function __PRIVATE_isPlainObject(e){return"object"==typeof e&amp;&amp;null!==e&amp;&amp;(Object.getPrototypeOf(e)===Object.prototype||null===Object.getPrototypeOf(e))}function __PRIVATE_valueDescription(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return e.length&gt;20&amp;&amp;(e=`${e.substring(0,20)}...`),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"==typeof e){if(e instanceof Array)return"an array";{const t=function __PRIVATE_tryGetCustomObjectType(e2){return e2.constructor?e2.constructor.name:null}(e);return t?`a custom ${t} object`:"an object"}}return"function"==typeof e?"a function":fail(12329,{type:typeof e})}function __PRIVATE_cast(e,t){if("_delegate"in e&amp;&amp;(e=e._delegate),!(e instanceof t)){if(t.name===e.constructor.name)throw new FirestoreError(N.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=__PRIVATE_valueDescription(e);throw new FirestoreError(N.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${n}`)}}return e}function property(e,t){const n={typeString:e};return t&amp;&amp;(n.value=t),n}function __PRIVATE_validateJSON(e,t){if(!__PRIVATE_isPlainObject(e))throw new FirestoreError(N.INVALID_ARGUMENT,"JSON must be an object");let n;for(const r in t)if(t[r]){const i=t[r].typeString,s="value"in t[r]?{value:t[r].value}:void 0;if(!(r in e)){n=`JSON missing required field: '${r}'`;break}const o=e[r];if(i&amp;&amp;typeof o!==i){n=`JSON field '${r}' must be a ${i}.`;break}if(void 0!==s&amp;&amp;o!==s.value){n=`Expected '${r}' field to equal '${s.value}'`;break}}if(n)throw new FirestoreError(N.INVALID_ARGUMENT,n);return!0}const k=-62135596800,q=1e6;class Timestamp{static now(){return Timestamp.fromMillis(Date.now())}static fromDate(e){return Timestamp.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),n=Math.floor((e-1e3*t)*q);return new Timestamp(t,n)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t&lt;0)throw new FirestoreError(N.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t&gt;=1e9)throw new FirestoreError(N.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e&lt;k)throw new FirestoreError(N.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e&gt;=253402300800)throw new FirestoreError(N.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/q}_compareTo(e){return this.seconds===e.seconds?__PRIVATE_primitiveComparator(this.nanoseconds,e.nanoseconds):__PRIVATE_primitiveComparator(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&amp;&amp;e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:Timestamp._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(__PRIVATE_validateJSON(e,Timestamp._jsonSchema))return new Timestamp(e.seconds,e.nanoseconds)}valueOf(){const e=this.seconds-k;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}Timestamp._jsonSchemaVersion="firestore/timestamp/1.0",Timestamp._jsonSchema={type:property("string",Timestamp._jsonSchemaVersion),seconds:property("number"),nanoseconds:property("number")};class SnapshotVersion{static fromTimestamp(e){return new SnapshotVersion(e)}static min(){return new SnapshotVersion(new Timestamp(0,0))}static max(){return new SnapshotVersion(new Timestamp(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}const Q=-1;class FieldIndex{constructor(e,t,n,r){this.indexId=e,this.collectionGroup=t,this.fields=n,this.indexState=r}}function __PRIVATE_fieldIndexGetArraySegment(e){return e.fields.find(e2=&gt;2===e2.kind)}function __PRIVATE_fieldIndexGetDirectionalSegments(e){return e.fields.filter(e2=&gt;2!==e2.kind)}FieldIndex.UNKNOWN_ID=-1;class IndexSegment{constructor(e,t){this.fieldPath=e,this.kind=t}}class IndexState{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new IndexState(0,IndexOffset.min())}}function __PRIVATE_newIndexOffsetSuccessorFromReadTime(e,t){const n=e.toTimestamp().seconds,r=e.toTimestamp().nanoseconds+1,i=SnapshotVersion.fromTimestamp(1e9===r?new Timestamp(n+1,0):new Timestamp(n,r));return new IndexOffset(i,DocumentKey.empty(),t)}function __PRIVATE_newIndexOffsetFromDocument(e){return new IndexOffset(e.readTime,e.key,Q)}class IndexOffset{constructor(e,t,n){this.readTime=e,this.documentKey=t,this.largestBatchId=n}static min(){return new IndexOffset(SnapshotVersion.min(),DocumentKey.empty(),Q)}static max(){return new IndexOffset(SnapshotVersion.max(),DocumentKey.empty(),Q)}}function __PRIVATE_indexOffsetComparator(e,t){let n=e.readTime.compareTo(t.readTime);return 0!==n?n:(n=DocumentKey.comparator(e.documentKey,t.documentKey),0!==n?n:__PRIVATE_primitiveComparator(e.largestBatchId,t.largestBatchId))}const $="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class PersistenceTransaction{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=&gt;e())}}async function __PRIVATE_ignoreIfPrimaryLeaseLoss(e){if(e.code!==N.FAILED_PRECONDITION||e.message!==$)throw e;__PRIVATE_logDebug("LocalStore","Unexpectedly lost primary lease")}class PersistencePromise{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(e2=&gt;{this.isDone=!0,this.result=e2,this.nextCallback&amp;&amp;this.nextCallback(e2)},e2=&gt;{this.isDone=!0,this.error=e2,this.catchCallback&amp;&amp;this.catchCallback(e2)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&amp;&amp;fail(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new PersistencePromise((n,r)=&gt;{this.nextCallback=t2=&gt;{this.wrapSuccess(e,t2).next(n,r)},this.catchCallback=e2=&gt;{this.wrapFailure(t,e2).next(n,r)}})}toPromise(){return new Promise((e,t)=&gt;{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof PersistencePromise?t:PersistencePromise.resolve(t)}catch(e2){return PersistencePromise.reject(e2)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=&gt;e(t)):PersistencePromise.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=&gt;e(t)):PersistencePromise.reject(t)}static resolve(e){return new PersistencePromise((t,n)=&gt;{t(e)})}static reject(e){return new PersistencePromise((t,n)=&gt;{n(e)})}static waitFor(e){return new PersistencePromise((t,n)=&gt;{let r=0,i=0,s=!1;e.forEach(e2=&gt;{++r,e2.next(()=&gt;{++i,s&amp;&amp;i===r&amp;&amp;t()},e3=&gt;n(e3))}),s=!0,i===r&amp;&amp;t()})}static or(e){let t=PersistencePromise.resolve(!1);for(const n of e)t=t.next(e2=&gt;e2?PersistencePromise.resolve(e2):n());return t}static forEach(e,t){const n=[];return e.forEach((e2,r)=&gt;{n.push(t.call(this,e2,r))}),this.waitFor(n)}static mapArray(e,t){return new PersistencePromise((n,r)=&gt;{const i=e.length,s=new Array(i);let o=0;for(let _=0;_&lt;i;_++){const a=_;t(e[a]).next(e2=&gt;{s[a]=e2,++o,o===i&amp;&amp;n(s)},e2=&gt;r(e2))}})}static doWhile(e,t){return new PersistencePromise((n,r)=&gt;{const process2=()=&gt;{!0===e()?t().next(()=&gt;{process2()},r):n()};process2()})}}const U="SimpleDb";class __PRIVATE_SimpleDbTransaction{static open(e,t,n,r){try{return new __PRIVATE_SimpleDbTransaction(t,e.transaction(r,n))}catch(e2){throw new __PRIVATE_IndexedDbTransactionError(t,e2)}}constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.S=new __PRIVATE_Deferred,this.transaction.oncomplete=()=&gt;{this.S.resolve()},this.transaction.onabort=()=&gt;{t.error?this.S.reject(new __PRIVATE_IndexedDbTransactionError(e,t.error)):this.S.resolve()},this.transaction.onerror=t2=&gt;{const n=__PRIVATE_checkForAndReportiOSError(t2.target.error);this.S.reject(new __PRIVATE_IndexedDbTransactionError(e,n))}}get D(){return this.S.promise}abort(e){e&amp;&amp;this.S.reject(e),this.aborted||(__PRIVATE_logDebug(U,"Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}v(){const e=this.transaction;this.aborted||"function"!=typeof e.commit||e.commit()}store(e){const t=this.transaction.objectStore(e);return new __PRIVATE_SimpleDbStore(t)}}class __PRIVATE_SimpleDb{static delete(e){return __PRIVATE_logDebug(U,"Removing database:",e),__PRIVATE_wrapRequest(getGlobal().indexedDB.deleteDatabase(e)).toPromise()}static C(){if(!isIndexedDBAvailable())return!1;if(__PRIVATE_SimpleDb.F())return!0;const e=getUA(),t=__PRIVATE_SimpleDb.M(e),n=0&lt;t&amp;&amp;t&lt;10,r=__PRIVATE_getAndroidVersion(e),i=0&lt;r&amp;&amp;r&lt;4.5;return!(e.indexOf("MSIE ")&gt;0||e.indexOf("Trident/")&gt;0||e.indexOf("Edge/")&gt;0||n||i)}static F(){var e;return"undefined"!=typeof process&amp;&amp;"YES"===(null===(e=process.__PRIVATE_env)||void 0===e?void 0:e.O)}static N(e,t){return e.store(t)}static M(e){const t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(n)}constructor(e,t,n){this.name=e,this.version=t,this.B=n,this.L=null,12.2===__PRIVATE_SimpleDb.M(getUA())&amp;&amp;__PRIVATE_logError("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}async k(e){return this.db||(__PRIVATE_logDebug(U,"Opening database:",this.name),this.db=await new Promise((t,n)=&gt;{const r=indexedDB.open(this.name,this.version);r.onsuccess=e2=&gt;{const n2=e2.target.result;t(n2)},r.onblocked=()=&gt;{n(new __PRIVATE_IndexedDbTransactionError(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},r.onerror=t2=&gt;{const r2=t2.target.error;"VersionError"===r2.name?n(new FirestoreError(N.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):"InvalidStateError"===r2.name?n(new FirestoreError(N.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+r2)):n(new __PRIVATE_IndexedDbTransactionError(e,r2))},r.onupgradeneeded=e2=&gt;{__PRIVATE_logDebug(U,'Database "'+this.name+'" requires upgrade from version:',e2.oldVersion);const t2=e2.target.result;if(null!==this.L&amp;&amp;this.L!==e2.oldVersion)throw new Error(`refusing to open IndexedDB database due to potential corruption of the IndexedDB database data; this corruption could be caused by clicking the "clear site data" button in a web browser; try reloading the web page to re-initialize the IndexedDB database: lastClosedDbVersion=${this.L}, event.oldVersion=${e2.oldVersion}, event.newVersion=${e2.newVersion}, db.version=${t2.version}`);this.B.q(t2,r.transaction,e2.oldVersion,this.version).next(()=&gt;{__PRIVATE_logDebug(U,"Database upgrade to version "+this.version+" complete")})}}),this.db.addEventListener("close",e2=&gt;{const t=e2.target;this.L=t.version},{passive:!0})),this.db.addEventListener("versionchange",e2=&gt;{var t;null===e2.newVersion&amp;&amp;(__PRIVATE_logWarn('Received "versionchange" event with newVersion===null; notifying the registered DatabaseDeletedListener, if any'),null===(t=this.databaseDeletedListener)||void 0===t||t.call(this))},{passive:!0}),this.db}setDatabaseDeletedListener(e){if(this.databaseDeletedListener)throw new Error("setDatabaseDeletedListener() may only be called once, and it has already been called");this.databaseDeletedListener=e}async runTransaction(e,t,n,r){const i="readonly"===t;let s=0;for(;;){++s;try{this.db=await this.k(e);const t2=__PRIVATE_SimpleDbTransaction.open(this.db,e,i?"readonly":"readwrite",n),s2=r(t2).next(e2=&gt;(t2.v(),e2)).catch(e2=&gt;(t2.abort(e2),PersistencePromise.reject(e2))).toPromise();return s2.catch(()=&gt;{}),await t2.D,s2}catch(e2){const t2=e2,n2="FirebaseError"!==t2.name&amp;&amp;s&lt;3;if(__PRIVATE_logDebug(U,"Transaction failed with error:",t2.message,"Retrying:",n2),this.close(),!n2)return Promise.reject(t2)}}}close(){this.db&amp;&amp;this.db.close(),this.db=void 0}}function __PRIVATE_getAndroidVersion(e){const t=e.match(/Android ([\d.]+)/i),n=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(n)}class __PRIVATE_IterationController{constructor(e){this.$=e,this.U=!1,this.K=null}get isDone(){return this.U}get W(){return this.K}set cursor(e){this.$=e}done(){this.U=!0}G(e){this.K=e}delete(){return __PRIVATE_wrapRequest(this.$.delete())}}class __PRIVATE_IndexedDbTransactionError extends FirestoreError{constructor(e,t){super(N.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function __PRIVATE_isIndexedDbTransactionError(e){return"IndexedDbTransactionError"===e.name}class __PRIVATE_SimpleDbStore{constructor(e){this.store=e}put(e,t){let n;return void 0!==t?(__PRIVATE_logDebug(U,"PUT",this.store.name,e,t),n=this.store.put(t,e)):(__PRIVATE_logDebug(U,"PUT",this.store.name,"&lt;auto-key&gt;",e),n=this.store.put(e)),__PRIVATE_wrapRequest(n)}add(e){return __PRIVATE_logDebug(U,"ADD",this.store.name,e,e),__PRIVATE_wrapRequest(this.store.add(e))}get(e){return __PRIVATE_wrapRequest(this.store.get(e)).next(t=&gt;(void 0===t&amp;&amp;(t=null),__PRIVATE_logDebug(U,"GET",this.store.name,e,t),t))}delete(e){return __PRIVATE_logDebug(U,"DELETE",this.store.name,e),__PRIVATE_wrapRequest(this.store.delete(e))}count(){return __PRIVATE_logDebug(U,"COUNT",this.store.name),__PRIVATE_wrapRequest(this.store.count())}j(e,t){const n=this.options(e,t),r=n.index?this.store.index(n.index):this.store;if("function"==typeof r.getAll){const e2=r.getAll(n.range);return new PersistencePromise((t2,n2)=&gt;{e2.onerror=e3=&gt;{n2(e3.target.error)},e2.onsuccess=e3=&gt;{t2(e3.target.result)}})}{const e2=this.cursor(n),t2=[];return this.J(e2,(e3,n2)=&gt;{t2.push(n2)}).next(()=&gt;t2)}}H(e,t){const n=this.store.getAll(e,null===t?void 0:t);return new PersistencePromise((e2,t2)=&gt;{n.onerror=e3=&gt;{t2(e3.target.error)},n.onsuccess=t3=&gt;{e2(t3.target.result)}})}Y(e,t){__PRIVATE_logDebug(U,"DELETE ALL",this.store.name);const n=this.options(e,t);n.Z=!1;const r=this.cursor(n);return this.J(r,(e2,t2,n2)=&gt;n2.delete())}X(e,t){let n;t?n=e:(n={},t=e);const r=this.cursor(n);return this.J(r,t)}ee(e){const t=this.cursor({});return new PersistencePromise((n,r)=&gt;{t.onerror=e2=&gt;{const t2=__PRIVATE_checkForAndReportiOSError(e2.target.error);r(t2)},t.onsuccess=t2=&gt;{const r2=t2.target.result;r2?e(r2.primaryKey,r2.value).next(e2=&gt;{e2?r2.continue():n()}):n()}})}J(e,t){const n=[];return new PersistencePromise((r,i)=&gt;{e.onerror=e2=&gt;{i(e2.target.error)},e.onsuccess=e2=&gt;{const i2=e2.target.result;if(!i2)return void r();const s=new __PRIVATE_IterationController(i2),o=t(i2.primaryKey,i2.value,s);if(o instanceof PersistencePromise){const e3=o.catch(e4=&gt;(s.done(),PersistencePromise.reject(e4)));n.push(e3)}s.isDone?r():null===s.W?i2.continue():i2.continue(s.W)}}).next(()=&gt;PersistencePromise.waitFor(n))}options(e,t){let n;return void 0!==e&amp;&amp;("string"==typeof e?n=e:t=e),{index:n,range:t}}cursor(e){let t="next";if(e.reverse&amp;&amp;(t="prev"),e.index){const n=this.store.index(e.index);return e.Z?n.openKeyCursor(e.range,t):n.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function __PRIVATE_wrapRequest(e){return new PersistencePromise((t,n)=&gt;{e.onsuccess=e2=&gt;{const n2=e2.target.result;t(n2)},e.onerror=e2=&gt;{const t2=__PRIVATE_checkForAndReportiOSError(e2.target.error);n(t2)}})}let K=!1;function __PRIVATE_checkForAndReportiOSError(e){const t=__PRIVATE_SimpleDb.M(getUA());if(t&gt;=12.2&amp;&amp;t&lt;13){const t2="An internal error was encountered in the Indexed Database server";if(e.message.indexOf(t2)&gt;=0){const e2=new FirestoreError("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t2}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return K||(K=!0,setTimeout(()=&gt;{throw e2},0)),e2}}return e}const W="IndexBackfiller";class __PRIVATE_IndexBackfillerScheduler{constructor(e,t){this.asyncQueue=e,this.te=t,this.task=null}start(){this.ne(15e3)}stop(){this.task&amp;&amp;(this.task.cancel(),this.task=null)}get started(){return null!==this.task}ne(e){__PRIVATE_logDebug(W,`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,async()=&gt;{this.task=null;try{const e2=await this.te.re();__PRIVATE_logDebug(W,`Documents written: ${e2}`)}catch(e2){__PRIVATE_isIndexedDbTransactionError(e2)?__PRIVATE_logDebug(W,"Ignoring IndexedDB error during index backfill: ",e2):await __PRIVATE_ignoreIfPrimaryLeaseLoss(e2)}await this.ne(6e4)})}}class __PRIVATE_IndexBackfiller{constructor(e,t){this.localStore=e,this.persistence=t}async re(e=50){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",t=&gt;this.ie(t,e))}ie(e,t){const n=new Set;let r=t,i=!0;return PersistencePromise.doWhile(()=&gt;!0===i&amp;&amp;r&gt;0,()=&gt;this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(t2=&gt;{if(null!==t2&amp;&amp;!n.has(t2))return __PRIVATE_logDebug(W,`Processing collection: ${t2}`),this.se(e,t2,r).next(e2=&gt;{r-=e2,n.add(t2)});i=!1})).next(()=&gt;t-r)}se(e,t,n){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(r=&gt;this.localStore.localDocuments.getNextDocuments(e,t,r,n).next(n2=&gt;{const i=n2.changes;return this.localStore.indexManager.updateIndexEntries(e,i).next(()=&gt;this.oe(r,n2)).next(n3=&gt;(__PRIVATE_logDebug(W,`Updating offset: ${n3}`),this.localStore.indexManager.updateCollectionGroup(e,t,n3))).next(()=&gt;i.size)}))}oe(e,t){let n=e;return t.changes.forEach((e2,t2)=&gt;{const r=__PRIVATE_newIndexOffsetFromDocument(t2);__PRIVATE_indexOffsetComparator(r,n)&gt;0&amp;&amp;(n=r)}),new IndexOffset(n.readTime,n.documentKey,Math.max(t.batchId,e.largestBatchId))}}class __PRIVATE_ListenSequence{constructor(e,t){this.previousValue=e,t&amp;&amp;(t.sequenceNumberHandler=e2=&gt;this._e(e2),this.ae=e2=&gt;t.writeSequenceNumber(e2))}_e(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ae&amp;&amp;this.ae(e),e}}__PRIVATE_ListenSequence.ue=-1;const G=-1;function __PRIVATE_isNullOrUndefined(e){return null==e}function __PRIVATE_isNegativeZero(e){return 0===e&amp;&amp;1/e==-1/0}function isSafeInteger(e){return"number"==typeof e&amp;&amp;Number.isInteger(e)&amp;&amp;!__PRIVATE_isNegativeZero(e)&amp;&amp;e&lt;=Number.MAX_SAFE_INTEGER&amp;&amp;e&gt;=Number.MIN_SAFE_INTEGER}const z="<";function __PRIVATE_encodeResourcePath(e){let t="";for(let n=0;n&lt;e.length;n++)t.length&gt;0&amp;&amp;(t=__PRIVATE_encodeSeparator(t)),t=__PRIVATE_encodeSegment(e.get(n),t);return __PRIVATE_encodeSeparator(t)}function __PRIVATE_encodeSegment(e,t){let n=t;const r=e.length;for(let t2=0;t2&lt;r;t2++){const r2=e.charAt(t2);switch(r2){case"\0":n+="<";break;case z:n+="<";break;default:n+=r2}}return n}function __PRIVATE_encodeSeparator(e){return e+z+"<"}function __PRIVATE_decodeResourcePath(e){const t=e.length;if(__PRIVATE_hardAssert(t&gt;=2,64408,{path:e}),2===t)return __PRIVATE_hardAssert(e.charAt(0)===z&amp;&amp;"<"===e.charAt(1),56145,{path:e}),ResourcePath.emptyPath();const __PRIVATE_lastReasonableEscapeIndex=t-2,n=[];let r="";for(let i=0;i&lt;t;){const t2=e.indexOf(z,i);switch((t2&lt;0||t2&gt;__PRIVATE_lastReasonableEscapeIndex)&amp;&amp;fail(50515,{path:e}),e.charAt(t2+1)){case"<":const s=e.substring(i,t2);let o;0===r.length?o=s:(r+=s,o=r,r=""),n.push(o);break;case"":r+=e.substring(i,t2),r+="\0";break;case"":r+=e.substring(i,t2+1);break;default:fail(61167,{path:e})}i=t2+2}return new ResourcePath(n)}const j="remoteDocuments",J="owner",H="owner",Y="mutationQueues",X="mutations",ee="batchId",te="userMutationsIndex",ne=["userId","batchId"];function __PRIVATE_newDbDocumentMutationPrefixForPath(e,t){return[e,__PRIVATE_encodeResourcePath(t)]}function __PRIVATE_newDbDocumentMutationKey(e,t,n){return[e,__PRIVATE_encodeResourcePath(t),n]}const re={},ie="documentMutations",se="remoteDocumentsV14",oe=["prefixPath","collectionGroup","readTime","documentId"],_e="documentKeyIndex",ae=["prefixPath","collectionGroup","documentId"],ue="collectionGroupIndex",ce=["collectionGroup","readTime","prefixPath","documentId"],le="remoteDocumentGlobal",he="remoteDocumentGlobalKey",Pe="targets",Te="queryTargetsIndex",Ie=["canonicalId","targetId"],de="targetDocuments",Ee=["targetId","path"],Ae="documentTargetsIndex",Re=["path","targetId"],Ve="targetGlobalKey",me="targetGlobal",fe="collectionParents",ge=["collectionId","parent"],pe="clientMetadata",we="bundles",be="namedQueries",ve="indexConfiguration",Fe="collectionGroupIndex",xe="indexState",Oe=["indexId","uid"],Ne="sequenceNumberIndex",Be=["uid","sequenceNumber"],Le="indexEntries",ke=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],qe="documentKeyIndex",Qe=["indexId","uid","orderedDocumentKey"],$e="documentOverlays",Ue=["userId","collectionPath","documentId"],Ke="collectionPathOverlayIndex",We=["userId","collectionPath","largestBatchId"],Ge="collectionGroupOverlayIndex",ze=["userId","collectionGroup","largestBatchId"],je="globals",He=[Y,X,ie,j,Pe,J,me,de,pe,le,fe,we,be],Ye=[...He,$e],Ze=[Y,X,ie,se,Pe,J,me,de,pe,le,fe,we,be,$e],Xe=Ze,et=[...Xe,ve,xe,Le],tt=et,nt=[...et,je],rt=nt;class __PRIVATE_IndexedDbTransaction extends PersistenceTransaction{constructor(e,t){super(),this.ce=e,this.currentSequenceNumber=t}}function __PRIVATE_getStore(e,t){const n=__PRIVATE_debugCast(e);return __PRIVATE_SimpleDb.N(n.ce,t)}function __PRIVATE_objectSize(e){let t=0;for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&amp;&amp;t++;return t}function forEach(e,t){for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&amp;&amp;t(n,e[n])}function isEmpty(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}class SortedMap{constructor(e,t){this.comparator=e,this.root=t||LLRBNode.EMPTY}insert(e,t){return new SortedMap(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,LLRBNode.BLACK,null,null))}remove(e){return new SortedMap(this.comparator,this.root.remove(e,this.comparator).copy(null,null,LLRBNode.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const n=this.comparator(e,t.key);if(0===n)return t.value;n&lt;0?t=t.left:n&gt;0&amp;&amp;(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){const r=this.comparator(e,n.key);if(0===r)return t+n.left.size;r&lt;0?n=n.left:(t+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,n)=&gt;(e(t,n),!1))}toString(){const e=[];return this.inorderTraversal((t,n)=&gt;(e.push(`${t}:${n}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new SortedMapIterator(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new SortedMapIterator(this.root,e,this.comparator,!1)}getReverseIterator(){return new SortedMapIterator(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new SortedMapIterator(this.root,e,this.comparator,!0)}}class SortedMapIterator{constructor(e,t,n,r){this.isReverse=r,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?n(e.key,t):1,t&amp;&amp;r&amp;&amp;(i*=-1),i&lt;0)e=this.isReverse?e.left:e.right;else{if(0===i){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length&gt;0}peek(){if(0===this.nodeStack.length)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class LLRBNode{constructor(e,t,n,r,i){this.key=e,this.value=t,this.color=null!=n?n:LLRBNode.RED,this.left=null!=r?r:LLRBNode.EMPTY,this.right=null!=i?i:LLRBNode.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,r,i){return new LLRBNode(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let r=this;const i=n(e,r.key);return r=i&lt;0?r.copy(null,null,null,r.left.insert(e,t,n),null):0===i?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n)),r.fixUp()}removeMin(){if(this.left.isEmpty())return LLRBNode.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let n,r=this;if(t(e,r.key)&lt;0)r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(e,t),null);else{if(r.left.isRed()&amp;&amp;(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),0===t(e,r.key)){if(r.right.isEmpty())return LLRBNode.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(e,t))}return r.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&amp;&amp;!e.left.isRed()&amp;&amp;(e=e.rotateLeft()),e.left.isRed()&amp;&amp;e.left.left.isRed()&amp;&amp;(e=e.rotateRight()),e.left.isRed()&amp;&amp;e.right.isRed()&amp;&amp;(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&amp;&amp;(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&amp;&amp;(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,LLRBNode.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,LLRBNode.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)&lt;=this.size+1}check(){if(this.isRed()&amp;&amp;this.left.isRed())throw fail(43730,{key:this.key,value:this.value});if(this.right.isRed())throw fail(14113,{key:this.key,value:this.value});const e=this.left.check();if(e!==this.right.check())throw fail(27949);return e+(this.isRed()?0:1)}}LLRBNode.EMPTY=null,LLRBNode.RED=!0,LLRBNode.BLACK=!1,LLRBNode.EMPTY=new class LLRBEmptyNode{constructor(){this.size=0}get key(){throw fail(57766)}get value(){throw fail(16141)}get color(){throw fail(16727)}get left(){throw fail(29726)}get right(){throw fail(36894)}copy(e,t,n,r,i){return this}insert(e,t,n){return new LLRBNode(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class SortedSet{constructor(e){this.comparator=e,this.data=new SortedMap(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,n)=&gt;(e(t),!1))}forEachInRange(e,t){const n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){const r=n.getNext();if(this.comparator(r.key,e[1])&gt;=0)return;t(r.key)}}forEachWhile(e,t){let n;for(n=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new SortedSetIterator(this.data.getIterator())}getIteratorFrom(e){return new SortedSetIterator(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size&lt;e.size&amp;&amp;(t=e,e=this),e.forEach(e2=&gt;{t=t.add(e2)}),t}isEqual(e){if(!(e instanceof SortedSet))return!1;if(this.size!==e.size)return!1;const t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){const e2=t.getNext().key,r=n.getNext().key;if(0!==this.comparator(e2,r))return!1}return!0}toArray(){const e=[];return this.forEach(t=&gt;{e.push(t)}),e}toString(){const e=[];return this.forEach(t=&gt;e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new SortedSet(this.comparator);return t.data=e,t}}class SortedSetIterator{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function __PRIVATE_advanceIterator(e){return e.hasNext()?e.getNext():void 0}class FieldMask{constructor(e){this.fields=e,e.sort(FieldPath$1.comparator)}static empty(){return new FieldMask([])}unionWith(e){let t=new SortedSet(FieldPath$1.comparator);for(const e2 of this.fields)t=t.add(e2);for(const n of e)t=t.add(n);return new FieldMask(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return __PRIVATE_arrayEquals(this.fields,e.fields,(e2,t)=&gt;e2.isEqual(t))}}class __PRIVATE_Base64DecodeError extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class ByteString{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function __PRIVATE_decodeBase64(e2){try{return atob(e2)}catch(e3){throw"undefined"!=typeof DOMException&amp;&amp;e3 instanceof DOMException?new __PRIVATE_Base64DecodeError("Invalid base64 string: "+e3):e3}}(e);return new ByteString(t)}static fromUint8Array(e){const t=function __PRIVATE_binaryStringFromUint8Array(e2){let t2="";for(let n=0;n&lt;e2.length;++n)t2+=String.fromCharCode(e2[n]);return t2}(e);return new ByteString(t)}[Symbol.iterator](){let e=0;return{next:()=&gt;e&lt;this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function __PRIVATE_encodeBase64(e){return btoa(e)}(this.binaryString)}toUint8Array(){return function __PRIVATE_uint8ArrayFromBinaryString(e){const t=new Uint8Array(e.length);for(let n=0;n&lt;e.length;n++)t[n]=e.charCodeAt(n);return t}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return __PRIVATE_primitiveComparator(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}ByteString.EMPTY_BYTE_STRING=new ByteString("");const it=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function __PRIVATE_normalizeTimestamp(e){if(__PRIVATE_hardAssert(!!e,39018),"string"==typeof e){let t=0;const n=it.exec(e);if(__PRIVATE_hardAssert(!!n,46558,{timestamp:e}),n[1]){let e2=n[1];e2=(e2+"000000000").substr(0,9),t=Number(e2)}const r=new Date(e);return{seconds:Math.floor(r.getTime()/1e3),nanos:t}}return{seconds:__PRIVATE_normalizeNumber(e.seconds),nanos:__PRIVATE_normalizeNumber(e.nanos)}}function __PRIVATE_normalizeNumber(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function __PRIVATE_normalizeByteString(e){return"string"==typeof e?ByteString.fromBase64String(e):ByteString.fromUint8Array(e)}const st="server_timestamp",ot="__type__",_t="__previous_value__",at="__local_write_time__";function __PRIVATE_isServerTimestamp(e){var t,n;return(null===(n=((null===(t=null==e?void 0:e.mapValue)||void 0===t?void 0:t.fields)||{})[ot])||void 0===n?void 0:n.stringValue)===st}function __PRIVATE_getPreviousValue(e){const t=e.mapValue.fields[_t];return __PRIVATE_isServerTimestamp(t)?__PRIVATE_getPreviousValue(t):t}function __PRIVATE_getLocalWriteTime(e){const t=__PRIVATE_normalizeTimestamp(e.mapValue.fields[at].timestampValue);return new Timestamp(t.seconds,t.nanos)}class DatabaseInfo{constructor(e,t,n,r,i,s,o,_,a,u){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=r,this.ssl=i,this.forceLongPolling=s,this.autoDetectLongPolling=o,this.longPollingOptions=_,this.useFetchStreams=a,this.isUsingEmulator=u}}const ut="(default)";class DatabaseId{constructor(e,t){this.projectId=e,this.database=t||ut}static empty(){return new DatabaseId("","")}get isDefaultDatabase(){return this.database===ut}isEqual(e){return e instanceof DatabaseId&amp;&amp;e.projectId===this.projectId&amp;&amp;e.database===this.database}}const ct="__type__",lt="__max__",ht={mapValue:{fields:{__type__:{stringValue:lt}}}},Pt="__vector__",Tt="value",It={nullValue:"NULL_VALUE"};function __PRIVATE_typeOrder(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?__PRIVATE_isServerTimestamp(e)?4:__PRIVATE_isMaxValue(e)?9007199254740991:__PRIVATE_isVectorValue(e)?10:11:fail(28295,{value:e})}function __PRIVATE_valueEquals(e,t){if(e===t)return!0;const n=__PRIVATE_typeOrder(e);if(n!==__PRIVATE_typeOrder(t))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return e.booleanValue===t.booleanValue;case 4:return __PRIVATE_getLocalWriteTime(e).isEqual(__PRIVATE_getLocalWriteTime(t));case 3:return function __PRIVATE_timestampEquals(e2,t2){if("string"==typeof e2.timestampValue&amp;&amp;"string"==typeof t2.timestampValue&amp;&amp;e2.timestampValue.length===t2.timestampValue.length)return e2.timestampValue===t2.timestampValue;const n2=__PRIVATE_normalizeTimestamp(e2.timestampValue),r=__PRIVATE_normalizeTimestamp(t2.timestampValue);return n2.seconds===r.seconds&amp;&amp;n2.nanos===r.nanos}(e,t);case 5:return e.stringValue===t.stringValue;case 6:return function __PRIVATE_blobEquals(e2,t2){return __PRIVATE_normalizeByteString(e2.bytesValue).isEqual(__PRIVATE_normalizeByteString(t2.bytesValue))}(e,t);case 7:return e.referenceValue===t.referenceValue;case 8:return function __PRIVATE_geoPointEquals(e2,t2){return __PRIVATE_normalizeNumber(e2.geoPointValue.latitude)===__PRIVATE_normalizeNumber(t2.geoPointValue.latitude)&amp;&amp;__PRIVATE_normalizeNumber(e2.geoPointValue.longitude)===__PRIVATE_normalizeNumber(t2.geoPointValue.longitude)}(e,t);case 2:return function __PRIVATE_numberEquals(e2,t2){if("integerValue"in e2&amp;&amp;"integerValue"in t2)return __PRIVATE_normalizeNumber(e2.integerValue)===__PRIVATE_normalizeNumber(t2.integerValue);if("doubleValue"in e2&amp;&amp;"doubleValue"in t2){const n2=__PRIVATE_normalizeNumber(e2.doubleValue),r=__PRIVATE_normalizeNumber(t2.doubleValue);return n2===r?__PRIVATE_isNegativeZero(n2)===__PRIVATE_isNegativeZero(r):isNaN(n2)&amp;&amp;isNaN(r)}return!1}(e,t);case 9:return __PRIVATE_arrayEquals(e.arrayValue.values||[],t.arrayValue.values||[],__PRIVATE_valueEquals);case 10:case 11:return function __PRIVATE_objectEquals(e2,t2){const n2=e2.mapValue.fields||{},r=t2.mapValue.fields||{};if(__PRIVATE_objectSize(n2)!==__PRIVATE_objectSize(r))return!1;for(const e3 in n2)if(n2.hasOwnProperty(e3)&amp;&amp;(void 0===r[e3]||!__PRIVATE_valueEquals(n2[e3],r[e3])))return!1;return!0}(e,t);default:return fail(52216,{left:e})}}function __PRIVATE_arrayValueContains(e,t){return void 0!==(e.values||[]).find(e2=&gt;__PRIVATE_valueEquals(e2,t))}function __PRIVATE_valueCompare(e,t){if(e===t)return 0;const n=__PRIVATE_typeOrder(e),r=__PRIVATE_typeOrder(t);if(n!==r)return __PRIVATE_primitiveComparator(n,r);switch(n){case 0:case 9007199254740991:return 0;case 1:return __PRIVATE_primitiveComparator(e.booleanValue,t.booleanValue);case 2:return function __PRIVATE_compareNumbers(e2,t2){const n2=__PRIVATE_normalizeNumber(e2.integerValue||e2.doubleValue),r2=__PRIVATE_normalizeNumber(t2.integerValue||t2.doubleValue);return n2&lt;r2?-1:n2&gt;r2?1:n2===r2?0:isNaN(n2)?isNaN(r2)?0:-1:1}(e,t);case 3:return __PRIVATE_compareTimestamps(e.timestampValue,t.timestampValue);case 4:return __PRIVATE_compareTimestamps(__PRIVATE_getLocalWriteTime(e),__PRIVATE_getLocalWriteTime(t));case 5:return __PRIVATE_compareUtf8Strings(e.stringValue,t.stringValue);case 6:return function __PRIVATE_compareBlobs(e2,t2){const n2=__PRIVATE_normalizeByteString(e2),r2=__PRIVATE_normalizeByteString(t2);return n2.compareTo(r2)}(e.bytesValue,t.bytesValue);case 7:return function __PRIVATE_compareReferences(e2,t2){const n2=e2.split("/"),r2=t2.split("/");for(let e3=0;e3&lt;n2.length&amp;&amp;e3&lt;r2.length;e3++){const t3=__PRIVATE_primitiveComparator(n2[e3],r2[e3]);if(0!==t3)return t3}return __PRIVATE_primitiveComparator(n2.length,r2.length)}(e.referenceValue,t.referenceValue);case 8:return function __PRIVATE_compareGeoPoints(e2,t2){const n2=__PRIVATE_primitiveComparator(__PRIVATE_normalizeNumber(e2.latitude),__PRIVATE_normalizeNumber(t2.latitude));return 0!==n2?n2:__PRIVATE_primitiveComparator(__PRIVATE_normalizeNumber(e2.longitude),__PRIVATE_normalizeNumber(t2.longitude))}(e.geoPointValue,t.geoPointValue);case 9:return __PRIVATE_compareArrays(e.arrayValue,t.arrayValue);case 10:return function __PRIVATE_compareVectors(e2,t2){var n2,r2,i,s;const o=e2.fields||{},_=t2.fields||{},a=null===(n2=o[Tt])||void 0===n2?void 0:n2.arrayValue,u=null===(r2=_[Tt])||void 0===r2?void 0:r2.arrayValue,c=__PRIVATE_primitiveComparator((null===(i=null==a?void 0:a.values)||void 0===i?void 0:i.length)||0,(null===(s=null==u?void 0:u.values)||void 0===s?void 0:s.length)||0);return 0!==c?c:__PRIVATE_compareArrays(a,u)}(e.mapValue,t.mapValue);case 11:return function __PRIVATE_compareMaps(e2,t2){if(e2===ht.mapValue&amp;&amp;t2===ht.mapValue)return 0;if(e2===ht.mapValue)return 1;if(t2===ht.mapValue)return-1;const n2=e2.fields||{},r2=Object.keys(n2),i=t2.fields||{},s=Object.keys(i);r2.sort(),s.sort();for(let e3=0;e3&lt;r2.length&amp;&amp;e3&lt;s.length;++e3){const t3=__PRIVATE_compareUtf8Strings(r2[e3],s[e3]);if(0!==t3)return t3;const o=__PRIVATE_valueCompare(n2[r2[e3]],i[s[e3]]);if(0!==o)return o}return __PRIVATE_primitiveComparator(r2.length,s.length)}(e.mapValue,t.mapValue);default:throw fail(23264,{le:n})}}function __PRIVATE_compareTimestamps(e,t){if("string"==typeof e&amp;&amp;"string"==typeof t&amp;&amp;e.length===t.length)return __PRIVATE_primitiveComparator(e,t);const n=__PRIVATE_normalizeTimestamp(e),r=__PRIVATE_normalizeTimestamp(t),i=__PRIVATE_primitiveComparator(n.seconds,r.seconds);return 0!==i?i:__PRIVATE_primitiveComparator(n.nanos,r.nanos)}function __PRIVATE_compareArrays(e,t){const n=e.values||[],r=t.values||[];for(let e2=0;e2&lt;n.length&amp;&amp;e2&lt;r.length;++e2){const t2=__PRIVATE_valueCompare(n[e2],r[e2]);if(t2)return t2}return __PRIVATE_primitiveComparator(n.length,r.length)}function canonicalId(e){return __PRIVATE_canonifyValue(e)}function __PRIVATE_canonifyValue(e){return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?function __PRIVATE_canonifyTimestamp(e2){const t=__PRIVATE_normalizeTimestamp(e2);return`time(${t.seconds},${t.nanos})`}(e.timestampValue):"stringValue"in e?e.stringValue:"bytesValue"in e?function __PRIVATE_canonifyByteString(e2){return __PRIVATE_normalizeByteString(e2).toBase64()}(e.bytesValue):"referenceValue"in e?function __PRIVATE_canonifyReference(e2){return DocumentKey.fromName(e2).toString()}(e.referenceValue):"geoPointValue"in e?function __PRIVATE_canonifyGeoPoint(e2){return`geo(${e2.latitude},${e2.longitude})`}(e.geoPointValue):"arrayValue"in e?function __PRIVATE_canonifyArray(e2){let t="[",n=!0;for(const r of e2.values||[])n?n=!1:t+=",",t+=__PRIVATE_canonifyValue(r);return t+"]"}(e.arrayValue):"mapValue"in e?function __PRIVATE_canonifyMap(e2){const t=Object.keys(e2.fields||{}).sort();let n="{",r=!0;for(const i of t)r?r=!1:n+=",",n+=`${i}:${__PRIVATE_canonifyValue(e2.fields[i])}`;return n+"}"}(e.mapValue):fail(61005,{value:e})}function __PRIVATE_estimateByteSize(e){switch(__PRIVATE_typeOrder(e)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const t=__PRIVATE_getPreviousValue(e);return t?16+__PRIVATE_estimateByteSize(t):16;case 5:return 2*e.stringValue.length;case 6:return __PRIVATE_normalizeByteString(e.bytesValue).approximateByteSize();case 7:return e.referenceValue.length;case 9:return function __PRIVATE_estimateArrayByteSize(e2){return(e2.values||[]).reduce((e3,t2)=&gt;e3+__PRIVATE_estimateByteSize(t2),0)}(e.arrayValue);case 10:case 11:return function __PRIVATE_estimateMapByteSize(e2){let t2=0;return forEach(e2.fields,(e3,n)=&gt;{t2+=e3.length+__PRIVATE_estimateByteSize(n)}),t2}(e.mapValue);default:throw fail(13486,{value:e})}}function __PRIVATE_refValue(e,t){return{referenceValue:`projects/${e.projectId}/databases/${e.database}/documents/${t.path.canonicalString()}`}}function isInteger(e){return!!e&amp;&amp;"integerValue"in e}function isArray(e){return!!e&amp;&amp;"arrayValue"in e}function __PRIVATE_isNullValue(e){return!!e&amp;&amp;"nullValue"in e}function __PRIVATE_isNanValue(e){return!!e&amp;&amp;"doubleValue"in e&amp;&amp;isNaN(Number(e.doubleValue))}function __PRIVATE_isMapValue(e){return!!e&amp;&amp;"mapValue"in e}function __PRIVATE_isVectorValue(e){var t,n;return(null===(n=((null===(t=null==e?void 0:e.mapValue)||void 0===t?void 0:t.fields)||{})[ct])||void 0===n?void 0:n.stringValue)===Pt}function __PRIVATE_deepClone(e){if(e.geoPointValue)return{geoPointValue:Object.assign({},e.geoPointValue)};if(e.timestampValue&amp;&amp;"object"==typeof e.timestampValue)return{timestampValue:Object.assign({},e.timestampValue)};if(e.mapValue){const t={mapValue:{fields:{}}};return forEach(e.mapValue.fields,(e2,n)=&gt;t.mapValue.fields[e2]=__PRIVATE_deepClone(n)),t}if(e.arrayValue){const t={arrayValue:{values:[]}};for(let n=0;n&lt;(e.arrayValue.values||[]).length;++n)t.arrayValue.values[n]=__PRIVATE_deepClone(e.arrayValue.values[n]);return t}return Object.assign({},e)}function __PRIVATE_isMaxValue(e){return(((e.mapValue||{}).fields||{}).__type__||{}).stringValue===lt}const dt={mapValue:{fields:{[ct]:{stringValue:Pt},[Tt]:{arrayValue:{}}}}};function __PRIVATE_valuesGetLowerBound(e){return"nullValue"in e?It:"booleanValue"in e?{booleanValue:!1}:"integerValue"in e||"doubleValue"in e?{doubleValue:NaN}:"timestampValue"in e?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in e?{stringValue:""}:"bytesValue"in e?{bytesValue:""}:"referenceValue"in e?__PRIVATE_refValue(DatabaseId.empty(),DocumentKey.empty()):"geoPointValue"in e?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in e?{arrayValue:{}}:"mapValue"in e?__PRIVATE_isVectorValue(e)?dt:{mapValue:{}}:fail(35942,{value:e})}function __PRIVATE_valuesGetUpperBound(e){return"nullValue"in e?{booleanValue:!1}:"booleanValue"in e?{doubleValue:NaN}:"integerValue"in e||"doubleValue"in e?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in e?{stringValue:""}:"stringValue"in e?{bytesValue:""}:"bytesValue"in e?__PRIVATE_refValue(DatabaseId.empty(),DocumentKey.empty()):"referenceValue"in e?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in e?{arrayValue:{}}:"arrayValue"in e?dt:"mapValue"in e?__PRIVATE_isVectorValue(e)?{mapValue:{}}:ht:fail(61959,{value:e})}function __PRIVATE_lowerBoundCompare(e,t){const n=__PRIVATE_valueCompare(e.value,t.value);return 0!==n?n:e.inclusive&amp;&amp;!t.inclusive?-1:!e.inclusive&amp;&amp;t.inclusive?1:0}function __PRIVATE_upperBoundCompare(e,t){const n=__PRIVATE_valueCompare(e.value,t.value);return 0!==n?n:e.inclusive&amp;&amp;!t.inclusive?1:!e.inclusive&amp;&amp;t.inclusive?-1:0}class ObjectValue{constructor(e){this.value=e}static empty(){return new ObjectValue({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let n=0;n&lt;e.length-1;++n)if(t=(t.mapValue.fields||{})[e.get(n)],!__PRIVATE_isMapValue(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=__PRIVATE_deepClone(t)}setAll(e){let t=FieldPath$1.emptyPath(),n={},r=[];e.forEach((e2,i2)=&gt;{if(!t.isImmediateParentOf(i2)){const e3=this.getFieldsMap(t);this.applyChanges(e3,n,r),n={},r=[],t=i2.popLast()}e2?n[i2.lastSegment()]=__PRIVATE_deepClone(e2):r.push(i2.lastSegment())});const i=this.getFieldsMap(t);this.applyChanges(i,n,r)}delete(e){const t=this.field(e.popLast());__PRIVATE_isMapValue(t)&amp;&amp;t.mapValue.fields&amp;&amp;delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return __PRIVATE_valueEquals(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let n=0;n&lt;e.length;++n){let r=t.mapValue.fields[e.get(n)];__PRIVATE_isMapValue(r)&amp;&amp;r.mapValue.fields||(r={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=r),t=r}return t.mapValue.fields}applyChanges(e,t,n){forEach(t,(t2,n2)=&gt;e[t2]=n2);for(const t2 of n)delete e[t2]}clone(){return new ObjectValue(__PRIVATE_deepClone(this.value))}}function __PRIVATE_extractFieldMask(e){const t=[];return forEach(e.fields,(e2,n)=&gt;{const r=new FieldPath$1([e2]);if(__PRIVATE_isMapValue(n)){const e3=__PRIVATE_extractFieldMask(n.mapValue).fields;if(0===e3.length)t.push(r);else for(const n2 of e3)t.push(r.child(n2))}else t.push(r)}),new FieldMask(t)}class MutableDocument{constructor(e,t,n,r,i,s,o){this.key=e,this.documentType=t,this.version=n,this.readTime=r,this.createTime=i,this.data=s,this.documentState=o}static newInvalidDocument(e){return new MutableDocument(e,0,SnapshotVersion.min(),SnapshotVersion.min(),SnapshotVersion.min(),ObjectValue.empty(),0)}static newFoundDocument(e,t,n,r){return new MutableDocument(e,1,t,SnapshotVersion.min(),n,r,0)}static newNoDocument(e,t){return new MutableDocument(e,2,t,SnapshotVersion.min(),SnapshotVersion.min(),ObjectValue.empty(),0)}static newUnknownDocument(e,t){return new MutableDocument(e,3,t,SnapshotVersion.min(),SnapshotVersion.min(),ObjectValue.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(SnapshotVersion.min())||2!==this.documentType&amp;&amp;0!==this.documentType||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=ObjectValue.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=ObjectValue.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=SnapshotVersion.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof MutableDocument&amp;&amp;this.key.isEqual(e.key)&amp;&amp;this.version.isEqual(e.version)&amp;&amp;this.documentType===e.documentType&amp;&amp;this.documentState===e.documentState&amp;&amp;this.data.isEqual(e.data)}mutableCopy(){return new MutableDocument(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class Bound{constructor(e,t){this.position=e,this.inclusive=t}}function __PRIVATE_boundCompareToDocument(e,t,n){let r=0;for(let i=0;i&lt;e.position.length;i++){const s=t[i],o=e.position[i];if(r=s.field.isKeyField()?DocumentKey.comparator(DocumentKey.fromName(o.referenceValue),n.key):__PRIVATE_valueCompare(o,n.data.field(s.field)),"desc"===s.dir&amp;&amp;(r*=-1),0!==r)break}return r}function __PRIVATE_boundEquals(e,t){if(null===e)return null===t;if(null===t)return!1;if(e.inclusive!==t.inclusive||e.position.length!==t.position.length)return!1;for(let n=0;n&lt;e.position.length;n++)if(!__PRIVATE_valueEquals(e.position[n],t.position[n]))return!1;return!0}class OrderBy{constructor(e,t="asc"){this.field=e,this.dir=t}}function __PRIVATE_orderByEquals(e,t){return e.dir===t.dir&amp;&amp;e.field.isEqual(t.field)}class Filter{}class FieldFilter extends Filter{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,n):new __PRIVATE_KeyFieldFilter(e,t,n):"array-contains"===t?new __PRIVATE_ArrayContainsFilter(e,n):"in"===t?new __PRIVATE_InFilter(e,n):"not-in"===t?new __PRIVATE_NotInFilter(e,n):"array-contains-any"===t?new __PRIVATE_ArrayContainsAnyFilter(e,n):new FieldFilter(e,t,n)}static createKeyFieldInFilter(e,t,n){return"in"===t?new __PRIVATE_KeyFieldInFilter(e,n):new __PRIVATE_KeyFieldNotInFilter(e,n)}matches(e){const t=e.data.field(this.field);return"!="===this.op?null!==t&amp;&amp;void 0===t.nullValue&amp;&amp;this.matchesComparison(__PRIVATE_valueCompare(t,this.value)):null!==t&amp;&amp;__PRIVATE_typeOrder(this.value)===__PRIVATE_typeOrder(t)&amp;&amp;this.matchesComparison(__PRIVATE_valueCompare(t,this.value))}matchesComparison(e){switch(this.op){case"&lt;":return e&lt;0;case"&lt;=":return e&lt;=0;case"==":return 0===e;case"!=":return 0!==e;case"&gt;":return e&gt;0;case"&gt;=":return e&gt;=0;default:return fail(47266,{operator:this.op})}}isInequality(){return["&lt;","&lt;=","&gt;","&gt;=","!=","not-in"].indexOf(this.op)&gt;=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class CompositeFilter extends Filter{constructor(e,t){super(),this.filters=e,this.op=t,this.he=null}static create(e,t){return new CompositeFilter(e,t)}matches(e){return __PRIVATE_compositeFilterIsConjunction(this)?void 0===this.filters.find(t=&gt;!t.matches(e)):void 0!==this.filters.find(t=&gt;t.matches(e))}getFlattenedFilters(){return null!==this.he||(this.he=this.filters.reduce((e,t)=&gt;e.concat(t.getFlattenedFilters()),[])),this.he}getFilters(){return Object.assign([],this.filters)}}function __PRIVATE_compositeFilterIsConjunction(e){return"and"===e.op}function __PRIVATE_compositeFilterIsDisjunction(e){return"or"===e.op}function __PRIVATE_compositeFilterIsFlatConjunction(e){return __PRIVATE_compositeFilterIsFlat(e)&amp;&amp;__PRIVATE_compositeFilterIsConjunction(e)}function __PRIVATE_compositeFilterIsFlat(e){for(const t of e.filters)if(t instanceof CompositeFilter)return!1;return!0}function __PRIVATE_canonifyFilter(e){if(e instanceof FieldFilter)return e.field.canonicalString()+e.op.toString()+canonicalId(e.value);if(__PRIVATE_compositeFilterIsFlatConjunction(e))return e.filters.map(e2=&gt;__PRIVATE_canonifyFilter(e2)).join(",");{const t=e.filters.map(e2=&gt;__PRIVATE_canonifyFilter(e2)).join(",");return`${e.op}(${t})`}}function __PRIVATE_filterEquals(e,t){return e instanceof FieldFilter?function __PRIVATE_fieldFilterEquals(e2,t2){return t2 instanceof FieldFilter&amp;&amp;e2.op===t2.op&amp;&amp;e2.field.isEqual(t2.field)&amp;&amp;__PRIVATE_valueEquals(e2.value,t2.value)}(e,t):e instanceof CompositeFilter?function __PRIVATE_compositeFilterEquals(e2,t2){return t2 instanceof CompositeFilter&amp;&amp;e2.op===t2.op&amp;&amp;e2.filters.length===t2.filters.length&amp;&amp;e2.filters.reduce((e3,n,r)=&gt;e3&amp;&amp;__PRIVATE_filterEquals(n,t2.filters[r]),!0)}(e,t):void fail(19439)}function __PRIVATE_compositeFilterWithAddedFilters(e,t){const n=e.filters.concat(t);return CompositeFilter.create(n,e.op)}function __PRIVATE_stringifyFilter(e){return e instanceof FieldFilter?function __PRIVATE_stringifyFieldFilter(e2){return`${e2.field.canonicalString()} ${e2.op} ${canonicalId(e2.value)}`}(e):e instanceof CompositeFilter?function __PRIVATE_stringifyCompositeFilter(e2){return e2.op.toString()+" {"+e2.getFilters().map(__PRIVATE_stringifyFilter).join(" ,")+"}"}(e):"Filter"}class __PRIVATE_KeyFieldFilter extends FieldFilter{constructor(e,t,n){super(e,t,n),this.key=DocumentKey.fromName(n.referenceValue)}matches(e){const t=DocumentKey.comparator(e.key,this.key);return this.matchesComparison(t)}}class __PRIVATE_KeyFieldInFilter extends FieldFilter{constructor(e,t){super(e,"in",t),this.keys=__PRIVATE_extractDocumentKeysFromArrayValue("in",t)}matches(e){return this.keys.some(t=&gt;t.isEqual(e.key))}}class __PRIVATE_KeyFieldNotInFilter extends FieldFilter{constructor(e,t){super(e,"not-in",t),this.keys=__PRIVATE_extractDocumentKeysFromArrayValue("not-in",t)}matches(e){return!this.keys.some(t=&gt;t.isEqual(e.key))}}function __PRIVATE_extractDocumentKeysFromArrayValue(e,t){var n;return((null===(n=t.arrayValue)||void 0===n?void 0:n.values)||[]).map(e2=&gt;DocumentKey.fromName(e2.referenceValue))}class __PRIVATE_ArrayContainsFilter extends FieldFilter{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return isArray(t)&amp;&amp;__PRIVATE_arrayValueContains(t.arrayValue,this.value)}}class __PRIVATE_InFilter extends FieldFilter{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return null!==t&amp;&amp;__PRIVATE_arrayValueContains(this.value.arrayValue,t)}}class __PRIVATE_NotInFilter extends FieldFilter{constructor(e,t){super(e,"not-in",t)}matches(e){if(__PRIVATE_arrayValueContains(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return null!==t&amp;&amp;void 0===t.nullValue&amp;&amp;!__PRIVATE_arrayValueContains(this.value.arrayValue,t)}}class __PRIVATE_ArrayContainsAnyFilter extends FieldFilter{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!isArray(t)||!t.arrayValue.values)&amp;&amp;t.arrayValue.values.some(e2=&gt;__PRIVATE_arrayValueContains(this.value.arrayValue,e2))}}class __PRIVATE_TargetImpl{constructor(e,t=null,n=[],r=[],i=null,s=null,o=null){this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=s,this.endAt=o,this.Pe=null}}function __PRIVATE_newTarget(e,t=null,n=[],r=[],i=null,s=null,o=null){return new __PRIVATE_TargetImpl(e,t,n,r,i,s,o)}function __PRIVATE_canonifyTarget(e){const t=__PRIVATE_debugCast(e);if(null===t.Pe){let e2=t.path.canonicalString();null!==t.collectionGroup&amp;&amp;(e2+="|cg:"+t.collectionGroup),e2+="|f:",e2+=t.filters.map(e3=&gt;__PRIVATE_canonifyFilter(e3)).join(","),e2+="|ob:",e2+=t.orderBy.map(e3=&gt;function __PRIVATE_canonifyOrderBy(e4){return e4.field.canonicalString()+e4.dir}(e3)).join(","),__PRIVATE_isNullOrUndefined(t.limit)||(e2+="|l:",e2+=t.limit),t.startAt&amp;&amp;(e2+="|lb:",e2+=t.startAt.inclusive?"b:":"a:",e2+=t.startAt.position.map(e3=&gt;canonicalId(e3)).join(",")),t.endAt&amp;&amp;(e2+="|ub:",e2+=t.endAt.inclusive?"a:":"b:",e2+=t.endAt.position.map(e3=&gt;canonicalId(e3)).join(",")),t.Pe=e2}return t.Pe}function __PRIVATE_targetEquals(e,t){if(e.limit!==t.limit)return!1;if(e.orderBy.length!==t.orderBy.length)return!1;for(let n=0;n&lt;e.orderBy.length;n++)if(!__PRIVATE_orderByEquals(e.orderBy[n],t.orderBy[n]))return!1;if(e.filters.length!==t.filters.length)return!1;for(let n=0;n&lt;e.filters.length;n++)if(!__PRIVATE_filterEquals(e.filters[n],t.filters[n]))return!1;return e.collectionGroup===t.collectionGroup&amp;&amp;!!e.path.isEqual(t.path)&amp;&amp;!!__PRIVATE_boundEquals(e.startAt,t.startAt)&amp;&amp;__PRIVATE_boundEquals(e.endAt,t.endAt)}function __PRIVATE_targetIsDocumentTarget(e){return DocumentKey.isDocumentKey(e.path)&amp;&amp;null===e.collectionGroup&amp;&amp;0===e.filters.length}function __PRIVATE_targetGetFieldFiltersForPath(e,t){return e.filters.filter(e2=&gt;e2 instanceof FieldFilter&amp;&amp;e2.field.isEqual(t))}function __PRIVATE_targetGetAscendingBound(e,t,n){let r=It,i=!0;for(const n2 of __PRIVATE_targetGetFieldFiltersForPath(e,t)){let e2=It,t2=!0;switch(n2.op){case"&lt;":case"&lt;=":e2=__PRIVATE_valuesGetLowerBound(n2.value);break;case"==":case"in":case"&gt;=":e2=n2.value;break;case"&gt;":e2=n2.value,t2=!1;break;case"!=":case"not-in":e2=It}__PRIVATE_lowerBoundCompare({value:r,inclusive:i},{value:e2,inclusive:t2})&lt;0&amp;&amp;(r=e2,i=t2)}if(null!==n)for(let s=0;s&lt;e.orderBy.length;++s)if(e.orderBy[s].field.isEqual(t)){const e2=n.position[s];__PRIVATE_lowerBoundCompare({value:r,inclusive:i},{value:e2,inclusive:n.inclusive})&lt;0&amp;&amp;(r=e2,i=n.inclusive);break}return{value:r,inclusive:i}}function __PRIVATE_targetGetDescendingBound(e,t,n){let r=ht,i=!0;for(const n2 of __PRIVATE_targetGetFieldFiltersForPath(e,t)){let e2=ht,t2=!0;switch(n2.op){case"&gt;=":case"&gt;":e2=__PRIVATE_valuesGetUpperBound(n2.value),t2=!1;break;case"==":case"in":case"&lt;=":e2=n2.value;break;case"&lt;":e2=n2.value,t2=!1;break;case"!=":case"not-in":e2=ht}__PRIVATE_upperBoundCompare({value:r,inclusive:i},{value:e2,inclusive:t2})&gt;0&amp;&amp;(r=e2,i=t2)}if(null!==n)for(let s=0;s&lt;e.orderBy.length;++s)if(e.orderBy[s].field.isEqual(t)){const e2=n.position[s];__PRIVATE_upperBoundCompare({value:r,inclusive:i},{value:e2,inclusive:n.inclusive})&gt;0&amp;&amp;(r=e2,i=n.inclusive);break}return{value:r,inclusive:i}}class __PRIVATE_QueryImpl{constructor(e,t=null,n=[],r=[],i=null,s="F",o=null,_=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=r,this.limit=i,this.limitType=s,this.startAt=o,this.endAt=_,this.Te=null,this.Ie=null,this.de=null,this.startAt,this.endAt}}function __PRIVATE_newQuery(e,t,n,r,i,s,o,_){return new __PRIVATE_QueryImpl(e,t,n,r,i,s,o,_)}function __PRIVATE_newQueryForPath(e){return new __PRIVATE_QueryImpl(e)}function __PRIVATE_queryMatchesAllDocuments(e){return 0===e.filters.length&amp;&amp;null===e.limit&amp;&amp;null==e.startAt&amp;&amp;null==e.endAt&amp;&amp;(0===e.explicitOrderBy.length||1===e.explicitOrderBy.length&amp;&amp;e.explicitOrderBy[0].field.isKeyField())}function __PRIVATE_isCollectionGroupQuery(e){return null!==e.collectionGroup}function __PRIVATE_queryNormalizedOrderBy(e){const t=__PRIVATE_debugCast(e);if(null===t.Te){t.Te=[];const e2=new Set;for(const n2 of t.explicitOrderBy)t.Te.push(n2),e2.add(n2.field.canonicalString());const n=t.explicitOrderBy.length&gt;0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc";(function __PRIVATE_getInequalityFilterFields(e3){let t2=new SortedSet(FieldPath$1.comparator);return e3.filters.forEach(e4=&gt;{e4.getFlattenedFilters().forEach(e5=&gt;{e5.isInequality()&amp;&amp;(t2=t2.add(e5.field))})}),t2})(t).forEach(r2=&gt;{e2.has(r2.canonicalString())||r2.isKeyField()||t.Te.push(new OrderBy(r2,n))}),e2.has(FieldPath$1.keyField().canonicalString())||t.Te.push(new OrderBy(FieldPath$1.keyField(),n))}return t.Te}function __PRIVATE_queryToTarget(e){const t=__PRIVATE_debugCast(e);return t.Ie||(t.Ie=function __PRIVATE__queryToTarget(e,t){if("F"===e.limitType)return __PRIVATE_newTarget(e.path,e.collectionGroup,t,e.filters,e.limit,e.startAt,e.endAt);{t=t.map(e2=&gt;{const t2="desc"===e2.dir?"asc":"desc";return new OrderBy(e2.field,t2)});const n=e.endAt?new Bound(e.endAt.position,e.endAt.inclusive):null,r=e.startAt?new Bound(e.startAt.position,e.startAt.inclusive):null;return __PRIVATE_newTarget(e.path,e.collectionGroup,t,e.filters,e.limit,n,r)}}(t,__PRIVATE_queryNormalizedOrderBy(e))),t.Ie}function __PRIVATE_queryWithAddedFilter(e,t){const n=e.filters.concat([t]);return new __PRIVATE_QueryImpl(e.path,e.collectionGroup,e.explicitOrderBy.slice(),n,e.limit,e.limitType,e.startAt,e.endAt)}function __PRIVATE_queryWithLimit(e,t,n){return new __PRIVATE_QueryImpl(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,n,e.startAt,e.endAt)}function __PRIVATE_queryEquals(e,t){return __PRIVATE_targetEquals(__PRIVATE_queryToTarget(e),__PRIVATE_queryToTarget(t))&amp;&amp;e.limitType===t.limitType}function __PRIVATE_canonifyQuery(e){return`${__PRIVATE_canonifyTarget(__PRIVATE_queryToTarget(e))}|lt:${e.limitType}`}function __PRIVATE_stringifyQuery(e){return`Query(target=${function __PRIVATE_stringifyTarget(e2){let t=e2.path.canonicalString();return null!==e2.collectionGroup&amp;&amp;(t+=" collectionGroup="+e2.collectionGroup),e2.filters.length&gt;0&amp;&amp;(t+=`, filters: [${e2.filters.map(e3=&gt;__PRIVATE_stringifyFilter(e3)).join(", ")}]`),__PRIVATE_isNullOrUndefined(e2.limit)||(t+=", limit: "+e2.limit),e2.orderBy.length&gt;0&amp;&amp;(t+=`, orderBy: [${e2.orderBy.map(e3=&gt;function __PRIVATE_stringifyOrderBy(e4){return`${e4.field.canonicalString()} (${e4.dir})`}(e3)).join(", ")}]`),e2.startAt&amp;&amp;(t+=", startAt: ",t+=e2.startAt.inclusive?"b:":"a:",t+=e2.startAt.position.map(e3=&gt;canonicalId(e3)).join(",")),e2.endAt&amp;&amp;(t+=", endAt: ",t+=e2.endAt.inclusive?"a:":"b:",t+=e2.endAt.position.map(e3=&gt;canonicalId(e3)).join(",")),`Target(${t})`}(__PRIVATE_queryToTarget(e))}; limitType=${e.limitType})`}function __PRIVATE_queryMatches(e,t){return t.isFoundDocument()&amp;&amp;function __PRIVATE_queryMatchesPathAndCollectionGroup(e2,t2){const n=t2.key.path;return null!==e2.collectionGroup?t2.key.hasCollectionId(e2.collectionGroup)&amp;&amp;e2.path.isPrefixOf(n):DocumentKey.isDocumentKey(e2.path)?e2.path.isEqual(n):e2.path.isImmediateParentOf(n)}(e,t)&amp;&amp;function __PRIVATE_queryMatchesOrderBy(e2,t2){for(const n of __PRIVATE_queryNormalizedOrderBy(e2))if(!n.field.isKeyField()&amp;&amp;null===t2.data.field(n.field))return!1;return!0}(e,t)&amp;&amp;function __PRIVATE_queryMatchesFilters(e2,t2){for(const n of e2.filters)if(!n.matches(t2))return!1;return!0}(e,t)&amp;&amp;function __PRIVATE_queryMatchesBounds(e2,t2){return!(e2.startAt&amp;&amp;!function __PRIVATE_boundSortsBeforeDocument(e3,t3,n){const r=__PRIVATE_boundCompareToDocument(e3,t3,n);return e3.inclusive?r&lt;=0:r&lt;0}(e2.startAt,__PRIVATE_queryNormalizedOrderBy(e2),t2))&amp;&amp;!(e2.endAt&amp;&amp;!function __PRIVATE_boundSortsAfterDocument(e3,t3,n){const r=__PRIVATE_boundCompareToDocument(e3,t3,n);return e3.inclusive?r&gt;=0:r&gt;0}(e2.endAt,__PRIVATE_queryNormalizedOrderBy(e2),t2))}(e,t)}function __PRIVATE_queryCollectionGroup(e){return e.collectionGroup||(e.path.length%2==1?e.path.lastSegment():e.path.get(e.path.length-2))}function __PRIVATE_newQueryComparator(e){return(t,n)=&gt;{let r=!1;for(const i of __PRIVATE_queryNormalizedOrderBy(e)){const e2=__PRIVATE_compareDocs(i,t,n);if(0!==e2)return e2;r=r||i.field.isKeyField()}return 0}}function __PRIVATE_compareDocs(e,t,n){const r=e.field.isKeyField()?DocumentKey.comparator(t.key,n.key):function __PRIVATE_compareDocumentsByField(e2,t2,n2){const r2=t2.data.field(e2),i=n2.data.field(e2);return null!==r2&amp;&amp;null!==i?__PRIVATE_valueCompare(r2,i):fail(42886)}(e.field,t,n);switch(e.dir){case"asc":return r;case"desc":return-1*r;default:return fail(19790,{direction:e.dir})}}class ObjectMap{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0!==n)for(const[t2,r]of n)if(this.equalsFn(t2,e))return r}has(e){return void 0!==this.get(e)}set(e,t){const n=this.mapKeyFn(e),r=this.inner[n];if(void 0===r)return this.inner[n]=[[e,t]],void this.innerSize++;for(let n2=0;n2&lt;r.length;n2++)if(this.equalsFn(r[n2][0],e))return void(r[n2]=[e,t]);r.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0===n)return!1;for(let r=0;r&lt;n.length;r++)if(this.equalsFn(n[r][0],e))return 1===n.length?delete this.inner[t]:n.splice(r,1),this.innerSize--,!0;return!1}forEach(e){forEach(this.inner,(t,n)=&gt;{for(const[t2,r]of n)e(t2,r)})}isEmpty(){return isEmpty(this.inner)}size(){return this.innerSize}}const Et=new SortedMap(DocumentKey.comparator);function __PRIVATE_mutableDocumentMap(){return Et}const At=new SortedMap(DocumentKey.comparator);function documentMap(...e){let t=At;for(const n of e)t=t.insert(n.key,n);return t}function __PRIVATE_convertOverlayedDocumentMapToDocumentMap(e){let t=At;return e.forEach((e2,n)=&gt;t=t.insert(e2,n.overlayedDocument)),t}function __PRIVATE_newOverlayMap(){return __PRIVATE_newDocumentKeyMap()}function __PRIVATE_newMutationMap(){return __PRIVATE_newDocumentKeyMap()}function __PRIVATE_newDocumentKeyMap(){return new ObjectMap(e=&gt;e.toString(),(e,t)=&gt;e.isEqual(t))}const Rt=new SortedMap(DocumentKey.comparator),Vt=new SortedSet(DocumentKey.comparator);function __PRIVATE_documentKeySet(...e){let t=Vt;for(const n of e)t=t.add(n);return t}const mt=new SortedSet(__PRIVATE_primitiveComparator);function __PRIVATE_targetIdSet(){return mt}function __PRIVATE_toDouble(e,t){if(e.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:__PRIVATE_isNegativeZero(t)?"-0":t}}function __PRIVATE_toInteger(e){return{integerValue:""+e}}class TransformOperation{constructor(){this._=void 0}}function __PRIVATE_applyTransformOperationToLocalView(e,t,n){return e instanceof __PRIVATE_ServerTimestampTransform?function serverTimestamp$1(e2,t2){const n2={fields:{[ot]:{stringValue:st},[at]:{timestampValue:{seconds:e2.seconds,nanos:e2.nanoseconds}}}};return t2&amp;&amp;__PRIVATE_isServerTimestamp(t2)&amp;&amp;(t2=__PRIVATE_getPreviousValue(t2)),t2&amp;&amp;(n2.fields[_t]=t2),{mapValue:n2}}(n,t):e instanceof __PRIVATE_ArrayUnionTransformOperation?__PRIVATE_applyArrayUnionTransformOperation(e,t):e instanceof __PRIVATE_ArrayRemoveTransformOperation?__PRIVATE_applyArrayRemoveTransformOperation(e,t):function __PRIVATE_applyNumericIncrementTransformOperationToLocalView(e2,t2){const n2=__PRIVATE_computeTransformOperationBaseValue(e2,t2),r=asNumber(n2)+asNumber(e2.Ee);return isInteger(n2)&amp;&amp;isInteger(e2.Ee)?__PRIVATE_toInteger(r):__PRIVATE_toDouble(e2.serializer,r)}(e,t)}function __PRIVATE_applyTransformOperationToRemoteDocument(e,t,n){return e instanceof __PRIVATE_ArrayUnionTransformOperation?__PRIVATE_applyArrayUnionTransformOperation(e,t):e instanceof __PRIVATE_ArrayRemoveTransformOperation?__PRIVATE_applyArrayRemoveTransformOperation(e,t):n}function __PRIVATE_computeTransformOperationBaseValue(e,t){return e instanceof __PRIVATE_NumericIncrementTransformOperation?function __PRIVATE_isNumber(e2){return isInteger(e2)||function __PRIVATE_isDouble(e3){return!!e3&amp;&amp;"doubleValue"in e3}(e2)}(t)?t:{integerValue:0}:null}class __PRIVATE_ServerTimestampTransform extends TransformOperation{}class __PRIVATE_ArrayUnionTransformOperation extends TransformOperation{constructor(e){super(),this.elements=e}}function __PRIVATE_applyArrayUnionTransformOperation(e,t){const n=__PRIVATE_coercedFieldValuesArray(t);for(const t2 of e.elements)n.some(e2=&gt;__PRIVATE_valueEquals(e2,t2))||n.push(t2);return{arrayValue:{values:n}}}class __PRIVATE_ArrayRemoveTransformOperation extends TransformOperation{constructor(e){super(),this.elements=e}}function __PRIVATE_applyArrayRemoveTransformOperation(e,t){let n=__PRIVATE_coercedFieldValuesArray(t);for(const t2 of e.elements)n=n.filter(e2=&gt;!__PRIVATE_valueEquals(e2,t2));return{arrayValue:{values:n}}}class __PRIVATE_NumericIncrementTransformOperation extends TransformOperation{constructor(e,t){super(),this.serializer=e,this.Ee=t}}function asNumber(e){return __PRIVATE_normalizeNumber(e.integerValue||e.doubleValue)}function __PRIVATE_coercedFieldValuesArray(e){return isArray(e)&amp;&amp;e.arrayValue.values?e.arrayValue.values.slice():[]}class FieldTransform{constructor(e,t){this.field=e,this.transform=t}}class MutationResult{constructor(e,t){this.version=e,this.transformResults=t}}class Precondition{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new Precondition}static exists(e){return new Precondition(void 0,e)}static updateTime(e){return new Precondition(e)}get isNone(){return void 0===this.updateTime&amp;&amp;void 0===this.exists}isEqual(e){return this.exists===e.exists&amp;&amp;(this.updateTime?!!e.updateTime&amp;&amp;this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function __PRIVATE_preconditionIsValidForDocument(e,t){return void 0!==e.updateTime?t.isFoundDocument()&amp;&amp;t.version.isEqual(e.updateTime):void 0===e.exists||e.exists===t.isFoundDocument()}class Mutation{}function __PRIVATE_calculateOverlayMutation(e,t){if(!e.hasLocalMutations||t&amp;&amp;0===t.fields.length)return null;if(null===t)return e.isNoDocument()?new __PRIVATE_DeleteMutation(e.key,Precondition.none()):new __PRIVATE_SetMutation(e.key,e.data,Precondition.none());{const n=e.data,r=ObjectValue.empty();let i=new SortedSet(FieldPath$1.comparator);for(let e2 of t.fields)if(!i.has(e2)){let t2=n.field(e2);null===t2&amp;&amp;e2.length&gt;1&amp;&amp;(e2=e2.popLast(),t2=n.field(e2)),null===t2?r.delete(e2):r.set(e2,t2),i=i.add(e2)}return new __PRIVATE_PatchMutation(e.key,r,new FieldMask(i.toArray()),Precondition.none())}}function __PRIVATE_mutationApplyToRemoteDocument(e,t,n){e instanceof __PRIVATE_SetMutation?function __PRIVATE_setMutationApplyToRemoteDocument(e2,t2,n2){const r=e2.value.clone(),i=__PRIVATE_serverTransformResults(e2.fieldTransforms,t2,n2.transformResults);r.setAll(i),t2.convertToFoundDocument(n2.version,r).setHasCommittedMutations()}(e,t,n):e instanceof __PRIVATE_PatchMutation?function __PRIVATE_patchMutationApplyToRemoteDocument(e2,t2,n2){if(!__PRIVATE_preconditionIsValidForDocument(e2.precondition,t2))return void t2.convertToUnknownDocument(n2.version);const r=__PRIVATE_serverTransformResults(e2.fieldTransforms,t2,n2.transformResults),i=t2.data;i.setAll(__PRIVATE_getPatch(e2)),i.setAll(r),t2.convertToFoundDocument(n2.version,i).setHasCommittedMutations()}(e,t,n):function __PRIVATE_deleteMutationApplyToRemoteDocument(e2,t2,n2){t2.convertToNoDocument(n2.version).setHasCommittedMutations()}(0,t,n)}function __PRIVATE_mutationApplyToLocalView(e,t,n,r){return e instanceof __PRIVATE_SetMutation?function __PRIVATE_setMutationApplyToLocalView(e2,t2,n2,r2){if(!__PRIVATE_preconditionIsValidForDocument(e2.precondition,t2))return n2;const i=e2.value.clone(),s=__PRIVATE_localTransformResults(e2.fieldTransforms,r2,t2);return i.setAll(s),t2.convertToFoundDocument(t2.version,i).setHasLocalMutations(),null}(e,t,n,r):e instanceof __PRIVATE_PatchMutation?function __PRIVATE_patchMutationApplyToLocalView(e2,t2,n2,r2){if(!__PRIVATE_preconditionIsValidForDocument(e2.precondition,t2))return n2;const i=__PRIVATE_localTransformResults(e2.fieldTransforms,r2,t2),s=t2.data;return s.setAll(__PRIVATE_getPatch(e2)),s.setAll(i),t2.convertToFoundDocument(t2.version,s).setHasLocalMutations(),null===n2?null:n2.unionWith(e2.fieldMask.fields).unionWith(e2.fieldTransforms.map(e3=&gt;e3.field))}(e,t,n,r):function __PRIVATE_deleteMutationApplyToLocalView(e2,t2,n2){return __PRIVATE_preconditionIsValidForDocument(e2.precondition,t2)?(t2.convertToNoDocument(t2.version).setHasLocalMutations(),null):n2}(e,t,n)}function __PRIVATE_mutationExtractBaseValue(e,t){let n=null;for(const r of e.fieldTransforms){const e2=t.data.field(r.field),i=__PRIVATE_computeTransformOperationBaseValue(r.transform,e2||null);null!=i&amp;&amp;(null===n&amp;&amp;(n=ObjectValue.empty()),n.set(r.field,i))}return n||null}function __PRIVATE_mutationEquals(e,t){return e.type===t.type&amp;&amp;!!e.key.isEqual(t.key)&amp;&amp;!!e.precondition.isEqual(t.precondition)&amp;&amp;!!function __PRIVATE_fieldTransformsAreEqual(e2,t2){return void 0===e2&amp;&amp;void 0===t2||!(!e2||!t2)&amp;&amp;__PRIVATE_arrayEquals(e2,t2,(e3,t3)=&gt;function __PRIVATE_fieldTransformEquals(e,t){return e.field.isEqual(t.field)&amp;&amp;function __PRIVATE_transformOperationEquals(e2,t2){return e2 instanceof __PRIVATE_ArrayUnionTransformOperation&amp;&amp;t2 instanceof __PRIVATE_ArrayUnionTransformOperation||e2 instanceof __PRIVATE_ArrayRemoveTransformOperation&amp;&amp;t2 instanceof __PRIVATE_ArrayRemoveTransformOperation?__PRIVATE_arrayEquals(e2.elements,t2.elements,__PRIVATE_valueEquals):e2 instanceof __PRIVATE_NumericIncrementTransformOperation&amp;&amp;t2 instanceof __PRIVATE_NumericIncrementTransformOperation?__PRIVATE_valueEquals(e2.Ee,t2.Ee):e2 instanceof __PRIVATE_ServerTimestampTransform&amp;&amp;t2 instanceof __PRIVATE_ServerTimestampTransform}(e.transform,t.transform)}(e3,t3))}(e.fieldTransforms,t.fieldTransforms)&amp;&amp;(0===e.type?e.value.isEqual(t.value):1!==e.type||e.data.isEqual(t.data)&amp;&amp;e.fieldMask.isEqual(t.fieldMask))}class __PRIVATE_SetMutation extends Mutation{constructor(e,t,n,r=[]){super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=r,this.type=0}getFieldMask(){return null}}class __PRIVATE_PatchMutation extends Mutation{constructor(e,t,n,r,i=[]){super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=r,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function __PRIVATE_getPatch(e){const t=new Map;return e.fieldMask.fields.forEach(n=&gt;{if(!n.isEmpty()){const r=e.data.field(n);t.set(n,r)}}),t}function __PRIVATE_serverTransformResults(e,t,n){const r=new Map;__PRIVATE_hardAssert(e.length===n.length,32656,{Ae:n.length,Re:e.length});for(let i=0;i&lt;n.length;i++){const s=e[i],o=s.transform,_=t.data.field(s.field);r.set(s.field,__PRIVATE_applyTransformOperationToRemoteDocument(o,_,n[i]))}return r}function __PRIVATE_localTransformResults(e,t,n){const r=new Map;for(const i of e){const e2=i.transform,s=n.data.field(i.field);r.set(i.field,__PRIVATE_applyTransformOperationToLocalView(e2,s,t))}return r}class __PRIVATE_DeleteMutation extends Mutation{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class __PRIVATE_VerifyMutation extends Mutation{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class MutationBatch{constructor(e,t,n,r){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=r}applyToRemoteDocument(e,t){const n=t.mutationResults;for(let t2=0;t2&lt;this.mutations.length;t2++){const r=this.mutations[t2];r.key.isEqual(e.key)&amp;&amp;__PRIVATE_mutationApplyToRemoteDocument(r,e,n[t2])}}applyToLocalView(e,t){for(const n of this.baseMutations)n.key.isEqual(e.key)&amp;&amp;(t=__PRIVATE_mutationApplyToLocalView(n,e,t,this.localWriteTime));for(const n of this.mutations)n.key.isEqual(e.key)&amp;&amp;(t=__PRIVATE_mutationApplyToLocalView(n,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const n=__PRIVATE_newMutationMap();return this.mutations.forEach(r=&gt;{const i=e.get(r.key),s=i.overlayedDocument;let o=this.applyToLocalView(s,i.mutatedFields);o=t.has(r.key)?null:o;const _=__PRIVATE_calculateOverlayMutation(s,o);null!==_&amp;&amp;n.set(r.key,_),s.isValidDocument()||s.convertToNoDocument(SnapshotVersion.min())}),n}keys(){return this.mutations.reduce((e,t)=&gt;e.add(t.key),__PRIVATE_documentKeySet())}isEqual(e){return this.batchId===e.batchId&amp;&amp;__PRIVATE_arrayEquals(this.mutations,e.mutations,(e2,t)=&gt;__PRIVATE_mutationEquals(e2,t))&amp;&amp;__PRIVATE_arrayEquals(this.baseMutations,e.baseMutations,(e2,t)=&gt;__PRIVATE_mutationEquals(e2,t))}}class MutationBatchResult{constructor(e,t,n,r){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=r}static from(e,t,n){__PRIVATE_hardAssert(e.mutations.length===n.length,58842,{Ve:e.mutations.length,me:n.length});let r=function __PRIVATE_documentVersionMap(){return Rt}();const i=e.mutations;for(let e2=0;e2&lt;i.length;e2++)r=r.insert(i[e2].key,n[e2].version);return new MutationBatchResult(e,t,n,r)}}class Overlay{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&amp;&amp;this.mutation===e.mutation}toString(){return`Overlay{\n      largestBatchId: ${this.largestBatchId},\n      mutation: ${this.mutation.toString()}\n    }`}}class ExistenceFilter{constructor(e,t){this.count=e,this.unchangedNames=t}}var ft,gt;function __PRIVATE_mapCodeFromRpcCode(e){if(void 0===e)return __PRIVATE_logError("GRPC error has no .code"),N.UNKNOWN;switch(e){case ft.OK:return N.OK;case ft.CANCELLED:return N.CANCELLED;case ft.UNKNOWN:return N.UNKNOWN;case ft.DEADLINE_EXCEEDED:return N.DEADLINE_EXCEEDED;case ft.RESOURCE_EXHAUSTED:return N.RESOURCE_EXHAUSTED;case ft.INTERNAL:return N.INTERNAL;case ft.UNAVAILABLE:return N.UNAVAILABLE;case ft.UNAUTHENTICATED:return N.UNAUTHENTICATED;case ft.INVALID_ARGUMENT:return N.INVALID_ARGUMENT;case ft.NOT_FOUND:return N.NOT_FOUND;case ft.ALREADY_EXISTS:return N.ALREADY_EXISTS;case ft.PERMISSION_DENIED:return N.PERMISSION_DENIED;case ft.FAILED_PRECONDITION:return N.FAILED_PRECONDITION;case ft.ABORTED:return N.ABORTED;case ft.OUT_OF_RANGE:return N.OUT_OF_RANGE;case ft.UNIMPLEMENTED:return N.UNIMPLEMENTED;case ft.DATA_LOSS:return N.DATA_LOSS;default:return fail(39323,{code:e})}}(gt=ft||(ft={}))[gt.OK=0]="OK",gt[gt.CANCELLED=1]="CANCELLED",gt[gt.UNKNOWN=2]="UNKNOWN",gt[gt.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",gt[gt.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",gt[gt.NOT_FOUND=5]="NOT_FOUND",gt[gt.ALREADY_EXISTS=6]="ALREADY_EXISTS",gt[gt.PERMISSION_DENIED=7]="PERMISSION_DENIED",gt[gt.UNAUTHENTICATED=16]="UNAUTHENTICATED",gt[gt.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",gt[gt.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",gt[gt.ABORTED=10]="ABORTED",gt[gt.OUT_OF_RANGE=11]="OUT_OF_RANGE",gt[gt.UNIMPLEMENTED=12]="UNIMPLEMENTED",gt[gt.INTERNAL=13]="INTERNAL",gt[gt.UNAVAILABLE=14]="UNAVAILABLE",gt[gt.DATA_LOSS=15]="DATA_LOSS";const yt=new Integer([4294967295,4294967295],0);function __PRIVATE_getMd5HashValue(e){const t=__PRIVATE_newTextEncoder().encode(e),n=new Md5;return n.update(t),new Uint8Array(n.digest())}function __PRIVATE_get64BitUints(e){const t=new DataView(e.buffer),n=t.getUint32(0,!0),r=t.getUint32(4,!0),i=t.getUint32(8,!0),s=t.getUint32(12,!0);return[new Integer([n,r],0),new Integer([i,s],0)]}class BloomFilter{constructor(e,t,n){if(this.bitmap=e,this.padding=t,this.hashCount=n,t&lt;0||t&gt;=8)throw new __PRIVATE_BloomFilterError(`Invalid padding: ${t}`);if(n&lt;0)throw new __PRIVATE_BloomFilterError(`Invalid hash count: ${n}`);if(e.length&gt;0&amp;&amp;0===this.hashCount)throw new __PRIVATE_BloomFilterError(`Invalid hash count: ${n}`);if(0===e.length&amp;&amp;0!==t)throw new __PRIVATE_BloomFilterError(`Invalid padding when bitmap length is 0: ${t}`);this.fe=8*e.length-t,this.ge=Integer.fromNumber(this.fe)}pe(e,t,n){let r=e.add(t.multiply(Integer.fromNumber(n)));return 1===r.compare(yt)&amp;&amp;(r=new Integer([r.getBits(0),r.getBits(1)],0)),r.modulo(this.ge).toNumber()}ye(e){return!!(this.bitmap[Math.floor(e/8)]&amp;1&lt;&lt;e%8)}mightContain(e){if(0===this.fe)return!1;const t=__PRIVATE_getMd5HashValue(e),[n,r]=__PRIVATE_get64BitUints(t);for(let e2=0;e2&lt;this.hashCount;e2++){const t2=this.pe(n,r,e2);if(!this.ye(t2))return!1}return!0}static create(e,t,n){const r=e%8==0?0:8-e%8,i=new Uint8Array(Math.ceil(e/8)),s=new BloomFilter(i,r,t);return n.forEach(e2=&gt;s.insert(e2)),s}insert(e){if(0===this.fe)return;const t=__PRIVATE_getMd5HashValue(e),[n,r]=__PRIVATE_get64BitUints(t);for(let e2=0;e2&lt;this.hashCount;e2++){const t2=this.pe(n,r,e2);this.we(t2)}}we(e){const t=Math.floor(e/8),n=e%8;this.bitmap[t]|=1&lt;&lt;n}}class __PRIVATE_BloomFilterError extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class RemoteEvent{constructor(e,t,n,r,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t,n){const r=new Map;return r.set(e,TargetChange.createSynthesizedTargetChangeForCurrentChange(e,t,n)),new RemoteEvent(SnapshotVersion.min(),r,new SortedMap(__PRIVATE_primitiveComparator),__PRIVATE_mutableDocumentMap(),__PRIVATE_documentKeySet())}}class TargetChange{constructor(e,t,n,r,i){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t,n){return new TargetChange(n,t,__PRIVATE_documentKeySet(),__PRIVATE_documentKeySet(),__PRIVATE_documentKeySet())}}class __PRIVATE_DocumentWatchChange{constructor(e,t,n,r){this.Se=e,this.removedTargetIds=t,this.key=n,this.be=r}}class __PRIVATE_ExistenceFilterChange{constructor(e,t){this.targetId=e,this.De=t}}class __PRIVATE_WatchTargetChange{constructor(e,t,n=ByteString.EMPTY_BYTE_STRING,r=null){this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=r}}class __PRIVATE_TargetState{constructor(){this.ve=0,this.Ce=__PRIVATE_snapshotChangesMap(),this.Fe=ByteString.EMPTY_BYTE_STRING,this.Me=!1,this.xe=!0}get current(){return this.Me}get resumeToken(){return this.Fe}get Oe(){return 0!==this.ve}get Ne(){return this.xe}Be(e){e.approximateByteSize()&gt;0&amp;&amp;(this.xe=!0,this.Fe=e)}Le(){let e=__PRIVATE_documentKeySet(),t=__PRIVATE_documentKeySet(),n=__PRIVATE_documentKeySet();return this.Ce.forEach((r,i)=&gt;{switch(i){case 0:e=e.add(r);break;case 2:t=t.add(r);break;case 1:n=n.add(r);break;default:fail(38017,{changeType:i})}}),new TargetChange(this.Fe,this.Me,e,t,n)}ke(){this.xe=!1,this.Ce=__PRIVATE_snapshotChangesMap()}qe(e,t){this.xe=!0,this.Ce=this.Ce.insert(e,t)}Qe(e){this.xe=!0,this.Ce=this.Ce.remove(e)}$e(){this.ve+=1}Ue(){this.ve-=1,__PRIVATE_hardAssert(this.ve&gt;=0,3241,{ve:this.ve})}Ke(){this.xe=!0,this.Me=!0}}class __PRIVATE_WatchChangeAggregator{constructor(e){this.We=e,this.Ge=new Map,this.ze=__PRIVATE_mutableDocumentMap(),this.je=__PRIVATE_documentTargetMap(),this.Je=__PRIVATE_documentTargetMap(),this.He=new SortedMap(__PRIVATE_primitiveComparator)}Ye(e){for(const t of e.Se)e.be&amp;&amp;e.be.isFoundDocument()?this.Ze(t,e.be):this.Xe(t,e.key,e.be);for(const t of e.removedTargetIds)this.Xe(t,e.key,e.be)}et(e){this.forEachTarget(e,t=&gt;{const n=this.tt(t);switch(e.state){case 0:this.nt(t)&amp;&amp;n.Be(e.resumeToken);break;case 1:n.Ue(),n.Oe||n.ke(),n.Be(e.resumeToken);break;case 2:n.Ue(),n.Oe||this.removeTarget(t);break;case 3:this.nt(t)&amp;&amp;(n.Ke(),n.Be(e.resumeToken));break;case 4:this.nt(t)&amp;&amp;(this.rt(t),n.Be(e.resumeToken));break;default:fail(56790,{state:e.state})}})}forEachTarget(e,t){e.targetIds.length&gt;0?e.targetIds.forEach(t):this.Ge.forEach((e2,n)=&gt;{this.nt(n)&amp;&amp;t(n)})}it(e){const t=e.targetId,n=e.De.count,r=this.st(t);if(r){const i=r.target;if(__PRIVATE_targetIsDocumentTarget(i))if(0===n){const e2=new DocumentKey(i.path);this.Xe(t,e2,MutableDocument.newNoDocument(e2,SnapshotVersion.min()))}else __PRIVATE_hardAssert(1===n,20013,{expectedCount:n});else{const r2=this.ot(t);if(r2!==n){const n2=this._t(e),i2=n2?this.ut(n2,e,r2):1;if(0!==i2){this.rt(t);const e2=2===i2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.He=this.He.insert(t,e2)}}}}}_t(e){const t=e.De.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:n="",padding:r=0},hashCount:i=0}=t;let s,o;try{s=__PRIVATE_normalizeByteString(n).toUint8Array()}catch(e2){if(e2 instanceof __PRIVATE_Base64DecodeError)return __PRIVATE_logWarn("Decoding the base64 bloom filter in existence filter failed ("+e2.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw e2}try{o=new BloomFilter(s,r,i)}catch(e2){return __PRIVATE_logWarn(e2 instanceof __PRIVATE_BloomFilterError?"BloomFilter error: ":"Applying bloom filter failed: ",e2),null}return 0===o.fe?null:o}ut(e,t,n){return t.De.count===n-this.ht(e,t.targetId)?0:2}ht(e,t){const n=this.We.getRemoteKeysForTarget(t);let r=0;return n.forEach(n2=&gt;{const i=this.We.lt(),s=`projects/${i.projectId}/databases/${i.database}/documents/${n2.path.canonicalString()}`;e.mightContain(s)||(this.Xe(t,n2,null),r++)}),r}Pt(e){const t=new Map;this.Ge.forEach((n2,r2)=&gt;{const i=this.st(r2);if(i){if(n2.current&amp;&amp;__PRIVATE_targetIsDocumentTarget(i.target)){const t2=new DocumentKey(i.target.path);this.Tt(t2).has(r2)||this.It(r2,t2)||this.Xe(r2,t2,MutableDocument.newNoDocument(t2,e))}n2.Ne&amp;&amp;(t.set(r2,n2.Le()),n2.ke())}});let n=__PRIVATE_documentKeySet();this.Je.forEach((e2,t2)=&gt;{let r2=!0;t2.forEachWhile(e3=&gt;{const t3=this.st(e3);return!t3||"TargetPurposeLimboResolution"===t3.purpose||(r2=!1,!1)}),r2&amp;&amp;(n=n.add(e2))}),this.ze.forEach((t2,n2)=&gt;n2.setReadTime(e));const r=new RemoteEvent(e,t,this.He,this.ze,n);return this.ze=__PRIVATE_mutableDocumentMap(),this.je=__PRIVATE_documentTargetMap(),this.Je=__PRIVATE_documentTargetMap(),this.He=new SortedMap(__PRIVATE_primitiveComparator),r}Ze(e,t){if(!this.nt(e))return;const n=this.It(e,t.key)?2:0;this.tt(e).qe(t.key,n),this.ze=this.ze.insert(t.key,t),this.je=this.je.insert(t.key,this.Tt(t.key).add(e)),this.Je=this.Je.insert(t.key,this.dt(t.key).add(e))}Xe(e,t,n){if(!this.nt(e))return;const r=this.tt(e);this.It(e,t)?r.qe(t,1):r.Qe(t),this.Je=this.Je.insert(t,this.dt(t).delete(e)),this.Je=this.Je.insert(t,this.dt(t).add(e)),n&amp;&amp;(this.ze=this.ze.insert(t,n))}removeTarget(e){this.Ge.delete(e)}ot(e){const t=this.tt(e).Le();return this.We.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}$e(e){this.tt(e).$e()}tt(e){let t=this.Ge.get(e);return t||(t=new __PRIVATE_TargetState,this.Ge.set(e,t)),t}dt(e){let t=this.Je.get(e);return t||(t=new SortedSet(__PRIVATE_primitiveComparator),this.Je=this.Je.insert(e,t)),t}Tt(e){let t=this.je.get(e);return t||(t=new SortedSet(__PRIVATE_primitiveComparator),this.je=this.je.insert(e,t)),t}nt(e){const t=null!==this.st(e);return t||__PRIVATE_logDebug("WatchChangeAggregator","Detected inactive target",e),t}st(e){const t=this.Ge.get(e);return t&amp;&amp;t.Oe?null:this.We.Et(e)}rt(e){this.Ge.set(e,new __PRIVATE_TargetState),this.We.getRemoteKeysForTarget(e).forEach(t=&gt;{this.Xe(e,t,null)})}It(e,t){return this.We.getRemoteKeysForTarget(e).has(t)}}function __PRIVATE_documentTargetMap(){return new SortedMap(DocumentKey.comparator)}function __PRIVATE_snapshotChangesMap(){return new SortedMap(DocumentKey.comparator)}const wt=(()=&gt;({asc:"ASCENDING",desc:"DESCENDING"}))(),St=(()=&gt;({"&lt;":"LESS_THAN","&lt;=":"LESS_THAN_OR_EQUAL","&gt;":"GREATER_THAN","&gt;=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"}))(),bt=(()=&gt;({and:"AND",or:"OR"}))();class JsonProtoSerializer{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function __PRIVATE_toInt32Proto(e,t){return e.useProto3Json||__PRIVATE_isNullOrUndefined(t)?t:{value:t}}function toTimestamp(e,t){return e.useProto3Json?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function __PRIVATE_toBytes(e,t){return e.useProto3Json?t.toBase64():t.toUint8Array()}function __PRIVATE_toVersion(e,t){return toTimestamp(e,t.toTimestamp())}function __PRIVATE_fromVersion(e){return __PRIVATE_hardAssert(!!e,49232),SnapshotVersion.fromTimestamp(function fromTimestamp(e2){const t=__PRIVATE_normalizeTimestamp(e2);return new Timestamp(t.seconds,t.nanos)}(e))}function __PRIVATE_toResourceName(e,t){return __PRIVATE_toResourcePath(e,t).canonicalString()}function __PRIVATE_toResourcePath(e,t){const n=function __PRIVATE_fullyQualifiedPrefixPath(e2){return new ResourcePath(["projects",e2.projectId,"databases",e2.database])}(e).child("documents");return void 0===t?n:n.child(t)}function __PRIVATE_fromResourceName(e){const t=ResourcePath.fromString(e);return __PRIVATE_hardAssert(__PRIVATE_isValidResourceName(t),10190,{key:t.toString()}),t}function __PRIVATE_toName(e,t){return __PRIVATE_toResourceName(e.databaseId,t.path)}function fromName(e,t){const n=__PRIVATE_fromResourceName(t);if(n.get(1)!==e.databaseId.projectId)throw new FirestoreError(N.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+e.databaseId.projectId);if(n.get(3)!==e.databaseId.database)throw new FirestoreError(N.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+e.databaseId.database);return new DocumentKey(__PRIVATE_extractLocalPathFromResourceName(n))}function __PRIVATE_toQueryPath(e,t){return __PRIVATE_toResourceName(e.databaseId,t)}function __PRIVATE_fromQueryPath(e){const t=__PRIVATE_fromResourceName(e);return 4===t.length?ResourcePath.emptyPath():__PRIVATE_extractLocalPathFromResourceName(t)}function __PRIVATE_getEncodedDatabaseId(e){return new ResourcePath(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function __PRIVATE_extractLocalPathFromResourceName(e){return __PRIVATE_hardAssert(e.length&gt;4&amp;&amp;"documents"===e.get(4),29091,{key:e.toString()}),e.popFirst(5)}function __PRIVATE_toMutationDocument(e,t,n){return{name:__PRIVATE_toName(e,t),fields:n.value.mapValue.fields}}function toMutation(e,t){let n;if(t instanceof __PRIVATE_SetMutation)n={update:__PRIVATE_toMutationDocument(e,t.key,t.value)};else if(t instanceof __PRIVATE_DeleteMutation)n={delete:__PRIVATE_toName(e,t.key)};else if(t instanceof __PRIVATE_PatchMutation)n={update:__PRIVATE_toMutationDocument(e,t.key,t.data),updateMask:__PRIVATE_toDocumentMask(t.fieldMask)};else{if(!(t instanceof __PRIVATE_VerifyMutation))return fail(16599,{Rt:t.type});n={verify:__PRIVATE_toName(e,t.key)}}return t.fieldTransforms.length&gt;0&amp;&amp;(n.updateTransforms=t.fieldTransforms.map(e2=&gt;function __PRIVATE_toFieldTransform(e3,t2){const n2=t2.transform;if(n2 instanceof __PRIVATE_ServerTimestampTransform)return{fieldPath:t2.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n2 instanceof __PRIVATE_ArrayUnionTransformOperation)return{fieldPath:t2.field.canonicalString(),appendMissingElements:{values:n2.elements}};if(n2 instanceof __PRIVATE_ArrayRemoveTransformOperation)return{fieldPath:t2.field.canonicalString(),removeAllFromArray:{values:n2.elements}};if(n2 instanceof __PRIVATE_NumericIncrementTransformOperation)return{fieldPath:t2.field.canonicalString(),increment:n2.Ee};throw fail(20930,{transform:t2.transform})}(0,e2))),t.precondition.isNone||(n.currentDocument=function __PRIVATE_toPrecondition(e2,t2){return void 0!==t2.updateTime?{updateTime:__PRIVATE_toVersion(e2,t2.updateTime)}:void 0!==t2.exists?{exists:t2.exists}:fail(27497)}(e,t.precondition)),n}function __PRIVATE_fromMutation(e,t){const n=t.currentDocument?function __PRIVATE_fromPrecondition(e2){return void 0!==e2.updateTime?Precondition.updateTime(__PRIVATE_fromVersion(e2.updateTime)):void 0!==e2.exists?Precondition.exists(e2.exists):Precondition.none()}(t.currentDocument):Precondition.none(),r=t.updateTransforms?t.updateTransforms.map(t2=&gt;function __PRIVATE_fromFieldTransform(e2,t3){let n2=null;if("setToServerValue"in t3)__PRIVATE_hardAssert("REQUEST_TIME"===t3.setToServerValue,16630,{proto:t3}),n2=new __PRIVATE_ServerTimestampTransform;else if("appendMissingElements"in t3){const e3=t3.appendMissingElements.values||[];n2=new __PRIVATE_ArrayUnionTransformOperation(e3)}else if("removeAllFromArray"in t3){const e3=t3.removeAllFromArray.values||[];n2=new __PRIVATE_ArrayRemoveTransformOperation(e3)}else"increment"in t3?n2=new __PRIVATE_NumericIncrementTransformOperation(e2,t3.increment):fail(16584,{proto:t3});const r2=FieldPath$1.fromServerFormat(t3.fieldPath);return new FieldTransform(r2,n2)}(e,t2)):[];if(t.update){t.update.name;const i=fromName(e,t.update.name),s=new ObjectValue({mapValue:{fields:t.update.fields}});if(t.updateMask){const e2=function __PRIVATE_fromDocumentMask(e3){const t2=e3.fieldPaths||[];return new FieldMask(t2.map(e4=&gt;FieldPath$1.fromServerFormat(e4)))}(t.updateMask);return new __PRIVATE_PatchMutation(i,s,e2,n,r)}return new __PRIVATE_SetMutation(i,s,n,r)}if(t.delete){const r2=fromName(e,t.delete);return new __PRIVATE_DeleteMutation(r2,n)}if(t.verify){const r2=fromName(e,t.verify);return new __PRIVATE_VerifyMutation(r2,n)}return fail(1463,{proto:t})}function __PRIVATE_toDocumentsTarget(e,t){return{documents:[__PRIVATE_toQueryPath(e,t.path)]}}function __PRIVATE_toQueryTarget(e,t){const n={structuredQuery:{}},r=t.path;let i;null!==t.collectionGroup?(i=r,n.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(i=r.popLast(),n.structuredQuery.from=[{collectionId:r.lastSegment()}]),n.parent=__PRIVATE_toQueryPath(e,i);const s=function __PRIVATE_toFilters(e2){if(0!==e2.length)return __PRIVATE_toFilter(CompositeFilter.create(e2,"and"))}(t.filters);s&amp;&amp;(n.structuredQuery.where=s);const o=function __PRIVATE_toOrder(e2){if(0!==e2.length)return e2.map(e3=&gt;function __PRIVATE_toPropertyOrder(e4){return{field:__PRIVATE_toFieldPathReference(e4.field),direction:__PRIVATE_toDirection(e4.dir)}}(e3))}(t.orderBy);o&amp;&amp;(n.structuredQuery.orderBy=o);const _=__PRIVATE_toInt32Proto(e,t.limit);return null!==_&amp;&amp;(n.structuredQuery.limit=_),t.startAt&amp;&amp;(n.structuredQuery.startAt=function __PRIVATE_toStartAtCursor(e2){return{before:e2.inclusive,values:e2.position}}(t.startAt)),t.endAt&amp;&amp;(n.structuredQuery.endAt=function __PRIVATE_toEndAtCursor(e2){return{before:!e2.inclusive,values:e2.position}}(t.endAt)),{Vt:n,parent:i}}function __PRIVATE_convertQueryTargetToQuery(e){let t=__PRIVATE_fromQueryPath(e.parent);const n=e.structuredQuery,r=n.from?n.from.length:0;let i=null;if(r&gt;0){__PRIVATE_hardAssert(1===r,65062);const e2=n.from[0];e2.allDescendants?i=e2.collectionId:t=t.child(e2.collectionId)}let s=[];n.where&amp;&amp;(s=function __PRIVATE_fromFilters(e2){const t2=__PRIVATE_fromFilter(e2);return t2 instanceof CompositeFilter&amp;&amp;__PRIVATE_compositeFilterIsFlatConjunction(t2)?t2.getFilters():[t2]}(n.where));let o=[];n.orderBy&amp;&amp;(o=function __PRIVATE_fromOrder(e2){return e2.map(e3=&gt;function __PRIVATE_fromPropertyOrder(e4){return new OrderBy(__PRIVATE_fromFieldPathReference(e4.field),function __PRIVATE_fromDirection(e5){switch(e5){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(e4.direction))}(e3))}(n.orderBy));let _=null;n.limit&amp;&amp;(_=function __PRIVATE_fromInt32Proto(e2){let t2;return t2="object"==typeof e2?e2.value:e2,__PRIVATE_isNullOrUndefined(t2)?null:t2}(n.limit));let a=null;n.startAt&amp;&amp;(a=function __PRIVATE_fromStartAtCursor(e2){const t2=!!e2.before,n2=e2.values||[];return new Bound(n2,t2)}(n.startAt));let u=null;return n.endAt&amp;&amp;(u=function __PRIVATE_fromEndAtCursor(e2){const t2=!e2.before,n2=e2.values||[];return new Bound(n2,t2)}(n.endAt)),__PRIVATE_newQuery(t,i,o,s,_,"F",a,u)}function __PRIVATE_fromFilter(e){return void 0!==e.unaryFilter?function __PRIVATE_fromUnaryFilter(e2){switch(e2.unaryFilter.op){case"IS_NAN":const t=__PRIVATE_fromFieldPathReference(e2.unaryFilter.field);return FieldFilter.create(t,"==",{doubleValue:NaN});case"IS_NULL":const n=__PRIVATE_fromFieldPathReference(e2.unaryFilter.field);return FieldFilter.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const r=__PRIVATE_fromFieldPathReference(e2.unaryFilter.field);return FieldFilter.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const i=__PRIVATE_fromFieldPathReference(e2.unaryFilter.field);return FieldFilter.create(i,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return fail(61313);default:return fail(60726)}}(e):void 0!==e.fieldFilter?function __PRIVATE_fromFieldFilter(e2){return FieldFilter.create(__PRIVATE_fromFieldPathReference(e2.fieldFilter.field),function __PRIVATE_fromOperatorName(e3){switch(e3){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return"&gt;";case"GREATER_THAN_OR_EQUAL":return"&gt;=";case"LESS_THAN":return"&lt;";case"LESS_THAN_OR_EQUAL":return"&lt;=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return fail(58110);default:return fail(50506)}}(e2.fieldFilter.op),e2.fieldFilter.value)}(e):void 0!==e.compositeFilter?function __PRIVATE_fromCompositeFilter(e2){return CompositeFilter.create(e2.compositeFilter.filters.map(e3=&gt;__PRIVATE_fromFilter(e3)),function __PRIVATE_fromCompositeOperatorName(e3){switch(e3){case"AND":return"and";case"OR":return"or";default:return fail(1026)}}(e2.compositeFilter.op))}(e):fail(30097,{filter:e})}function __PRIVATE_toDirection(e){return wt[e]}function __PRIVATE_toOperatorName(e){return St[e]}function __PRIVATE_toCompositeOperatorName(e){return bt[e]}function __PRIVATE_toFieldPathReference(e){return{fieldPath:e.canonicalString()}}function __PRIVATE_fromFieldPathReference(e){return FieldPath$1.fromServerFormat(e.fieldPath)}function __PRIVATE_toFilter(e){return e instanceof FieldFilter?function __PRIVATE_toUnaryOrFieldFilter(e2){if("=="===e2.op){if(__PRIVATE_isNanValue(e2.value))return{unaryFilter:{field:__PRIVATE_toFieldPathReference(e2.field),op:"IS_NAN"}};if(__PRIVATE_isNullValue(e2.value))return{unaryFilter:{field:__PRIVATE_toFieldPathReference(e2.field),op:"IS_NULL"}}}else if("!="===e2.op){if(__PRIVATE_isNanValue(e2.value))return{unaryFilter:{field:__PRIVATE_toFieldPathReference(e2.field),op:"IS_NOT_NAN"}};if(__PRIVATE_isNullValue(e2.value))return{unaryFilter:{field:__PRIVATE_toFieldPathReference(e2.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:__PRIVATE_toFieldPathReference(e2.field),op:__PRIVATE_toOperatorName(e2.op),value:e2.value}}}(e):e instanceof CompositeFilter?function __PRIVATE_toCompositeFilter(e2){const t=e2.getFilters().map(e3=&gt;__PRIVATE_toFilter(e3));return 1===t.length?t[0]:{compositeFilter:{op:__PRIVATE_toCompositeOperatorName(e2.op),filters:t}}}(e):fail(54877,{filter:e})}function __PRIVATE_toDocumentMask(e){const t=[];return e.fields.forEach(e2=&gt;t.push(e2.canonicalString())),{fieldPaths:t}}function __PRIVATE_isValidResourceName(e){return e.length&gt;=4&amp;&amp;"projects"===e.get(0)&amp;&amp;"databases"===e.get(2)}class TargetData{constructor(e,t,n,r,i=SnapshotVersion.min(),s=SnapshotVersion.min(),o=ByteString.EMPTY_BYTE_STRING,_=null){this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=s,this.resumeToken=o,this.expectedCount=_}withSequenceNumber(e){return new TargetData(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new TargetData(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new TargetData(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new TargetData(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class __PRIVATE_LocalSerializer{constructor(e){this.gt=e}}function __PRIVATE_fromDbRemoteDocument(e,t){let n;if(t.document)n=function __PRIVATE_fromDocument(e,t,n){const r=fromName(e,t.name),i=__PRIVATE_fromVersion(t.updateTime),s=t.createTime?__PRIVATE_fromVersion(t.createTime):SnapshotVersion.min(),o=new ObjectValue({mapValue:{fields:t.fields}}),_=MutableDocument.newFoundDocument(r,i,s,o);return n&amp;&amp;_.setHasCommittedMutations(),n?_.setHasCommittedMutations():_}(e.gt,t.document,!!t.hasCommittedMutations);else if(t.noDocument){const e2=DocumentKey.fromSegments(t.noDocument.path),r=__PRIVATE_fromDbTimestamp(t.noDocument.readTime);n=MutableDocument.newNoDocument(e2,r),t.hasCommittedMutations&amp;&amp;n.setHasCommittedMutations()}else{if(!t.unknownDocument)return fail(56709);{const e2=DocumentKey.fromSegments(t.unknownDocument.path),r=__PRIVATE_fromDbTimestamp(t.unknownDocument.version);n=MutableDocument.newUnknownDocument(e2,r)}}return t.readTime&amp;&amp;n.setReadTime(function __PRIVATE_fromDbTimestampKey(e2){const t2=new Timestamp(e2[0],e2[1]);return SnapshotVersion.fromTimestamp(t2)}(t.readTime)),n}function __PRIVATE_toDbRemoteDocument(e,t){const n=t.key,r={prefixPath:n.getCollectionPath().popLast().toArray(),collectionGroup:n.collectionGroup,documentId:n.path.lastSegment(),readTime:__PRIVATE_toDbTimestampKey(t.readTime),hasCommittedMutations:t.hasCommittedMutations};if(t.isFoundDocument())r.document=function __PRIVATE_toDocument(e2,t2){return{name:__PRIVATE_toName(e2,t2.key),fields:t2.data.value.mapValue.fields,updateTime:toTimestamp(e2,t2.version.toTimestamp()),createTime:toTimestamp(e2,t2.createTime.toTimestamp())}}(e.gt,t);else if(t.isNoDocument())r.noDocument={path:n.path.toArray(),readTime:__PRIVATE_toDbTimestamp(t.version)};else{if(!t.isUnknownDocument())return fail(57904,{document:t});r.unknownDocument={path:n.path.toArray(),version:__PRIVATE_toDbTimestamp(t.version)}}return r}function __PRIVATE_toDbTimestampKey(e){const t=e.toTimestamp();return[t.seconds,t.nanoseconds]}function __PRIVATE_toDbTimestamp(e){const t=e.toTimestamp();return{seconds:t.seconds,nanoseconds:t.nanoseconds}}function __PRIVATE_fromDbTimestamp(e){const t=new Timestamp(e.seconds,e.nanoseconds);return SnapshotVersion.fromTimestamp(t)}function __PRIVATE_fromDbMutationBatch(e,t){const n=(t.baseMutations||[]).map(t2=&gt;__PRIVATE_fromMutation(e.gt,t2));for(let e2=0;e2&lt;t.mutations.length-1;++e2){const n2=t.mutations[e2];if(e2+1&lt;t.mutations.length&amp;&amp;void 0!==t.mutations[e2+1].transform){const r2=t.mutations[e2+1];n2.updateTransforms=r2.transform.fieldTransforms,t.mutations.splice(e2+1,1),++e2}}const r=t.mutations.map(t2=&gt;__PRIVATE_fromMutation(e.gt,t2)),i=Timestamp.fromMillis(t.localWriteTimeMs);return new MutationBatch(t.batchId,i,n,r)}function __PRIVATE_fromDbTarget(e){const t=__PRIVATE_fromDbTimestamp(e.readTime),n=void 0!==e.lastLimboFreeSnapshotVersion?__PRIVATE_fromDbTimestamp(e.lastLimboFreeSnapshotVersion):SnapshotVersion.min();let r;return r=function __PRIVATE_isDocumentQuery(e2){return void 0!==e2.documents}(e.query)?function __PRIVATE_fromDocumentsTarget(e2){const t2=e2.documents.length;return __PRIVATE_hardAssert(1===t2,1966,{count:t2}),__PRIVATE_queryToTarget(__PRIVATE_newQueryForPath(__PRIVATE_fromQueryPath(e2.documents[0])))}(e.query):function __PRIVATE_fromQueryTarget(e2){return __PRIVATE_queryToTarget(__PRIVATE_convertQueryTargetToQuery(e2))}(e.query),new TargetData(r,e.targetId,"TargetPurposeListen",e.lastListenSequenceNumber,t,n,ByteString.fromBase64String(e.resumeToken))}function __PRIVATE_toDbTarget(e,t){const n=__PRIVATE_toDbTimestamp(t.snapshotVersion),r=__PRIVATE_toDbTimestamp(t.lastLimboFreeSnapshotVersion);let i;i=__PRIVATE_targetIsDocumentTarget(t.target)?__PRIVATE_toDocumentsTarget(e.gt,t.target):__PRIVATE_toQueryTarget(e.gt,t.target).Vt;const s=t.resumeToken.toBase64();return{targetId:t.targetId,canonicalId:__PRIVATE_canonifyTarget(t.target),readTime:n,resumeToken:s,lastListenSequenceNumber:t.sequenceNumber,lastLimboFreeSnapshotVersion:r,query:i}}function __PRIVATE_fromBundledQuery(e){const t=__PRIVATE_convertQueryTargetToQuery({parent:e.parent,structuredQuery:e.structuredQuery});return"LAST"===e.limitType?__PRIVATE_queryWithLimit(t,t.limit,"L"):t}function __PRIVATE_fromDbDocumentOverlay(e,t){return new Overlay(t.largestBatchId,__PRIVATE_fromMutation(e.gt,t.overlayMutation))}function __PRIVATE_toDbDocumentOverlayKey(e,t){const n=t.path.lastSegment();return[e,__PRIVATE_encodeResourcePath(t.path.popLast()),n]}function __PRIVATE_toDbIndexState(e,t,n,r){return{indexId:e,uid:t,sequenceNumber:n,readTime:__PRIVATE_toDbTimestamp(r.readTime),documentKey:__PRIVATE_encodeResourcePath(r.documentKey.path),largestBatchId:r.largestBatchId}}class __PRIVATE_IndexedDbBundleCache{getBundleMetadata(e,t){return __PRIVATE_bundlesStore(e).get(t).next(e2=&gt;{if(e2)return function __PRIVATE_fromDbBundle(e3){return{id:e3.bundleId,createTime:__PRIVATE_fromDbTimestamp(e3.createTime),version:e3.version}}(e2)})}saveBundleMetadata(e,t){return __PRIVATE_bundlesStore(e).put(function __PRIVATE_toDbBundle(e2){return{bundleId:e2.id,createTime:__PRIVATE_toDbTimestamp(__PRIVATE_fromVersion(e2.createTime)),version:e2.version}}(t))}getNamedQuery(e,t){return __PRIVATE_namedQueriesStore(e).get(t).next(e2=&gt;{if(e2)return function __PRIVATE_fromDbNamedQuery(e3){return{name:e3.name,query:__PRIVATE_fromBundledQuery(e3.bundledQuery),readTime:__PRIVATE_fromDbTimestamp(e3.readTime)}}(e2)})}saveNamedQuery(e,t){return __PRIVATE_namedQueriesStore(e).put(function __PRIVATE_toDbNamedQuery(e2){return{name:e2.name,readTime:__PRIVATE_toDbTimestamp(__PRIVATE_fromVersion(e2.readTime)),bundledQuery:e2.bundledQuery}}(t))}}function __PRIVATE_bundlesStore(e){return __PRIVATE_getStore(e,we)}function __PRIVATE_namedQueriesStore(e){return __PRIVATE_getStore(e,be)}class __PRIVATE_IndexedDbDocumentOverlayCache{constructor(e,t){this.serializer=e,this.userId=t}static yt(e,t){const n=t.uid||"";return new __PRIVATE_IndexedDbDocumentOverlayCache(e,n)}getOverlay(e,t){return __PRIVATE_documentOverlayStore(e).get(__PRIVATE_toDbDocumentOverlayKey(this.userId,t)).next(e2=&gt;e2?__PRIVATE_fromDbDocumentOverlay(this.serializer,e2):null)}getOverlays(e,t){const n=__PRIVATE_newOverlayMap();return PersistencePromise.forEach(t,t2=&gt;this.getOverlay(e,t2).next(e2=&gt;{null!==e2&amp;&amp;n.set(t2,e2)})).next(()=&gt;n)}saveOverlays(e,t,n){const r=[];return n.forEach((n2,i)=&gt;{const s=new Overlay(t,i);r.push(this.wt(e,s))}),PersistencePromise.waitFor(r)}removeOverlaysForBatchId(e,t,n){const r=new Set;t.forEach(e2=&gt;r.add(__PRIVATE_encodeResourcePath(e2.getCollectionPath())));const i=[];return r.forEach(t2=&gt;{const r2=IDBKeyRange.bound([this.userId,t2,n],[this.userId,t2,n+1],!1,!0);i.push(__PRIVATE_documentOverlayStore(e).Y(Ke,r2))}),PersistencePromise.waitFor(i)}getOverlaysForCollection(e,t,n){const r=__PRIVATE_newOverlayMap(),i=__PRIVATE_encodeResourcePath(t),s=IDBKeyRange.bound([this.userId,i,n],[this.userId,i,Number.POSITIVE_INFINITY],!0);return __PRIVATE_documentOverlayStore(e).j(Ke,s).next(e2=&gt;{for(const t2 of e2){const e3=__PRIVATE_fromDbDocumentOverlay(this.serializer,t2);r.set(e3.getKey(),e3)}return r})}getOverlaysForCollectionGroup(e,t,n,r){const i=__PRIVATE_newOverlayMap();let s;const o=IDBKeyRange.bound([this.userId,t,n],[this.userId,t,Number.POSITIVE_INFINITY],!0);return __PRIVATE_documentOverlayStore(e).X({index:Ge,range:o},(e2,t2,n2)=&gt;{const o2=__PRIVATE_fromDbDocumentOverlay(this.serializer,t2);i.size()&lt;r||o2.largestBatchId===s?(i.set(o2.getKey(),o2),s=o2.largestBatchId):n2.done()}).next(()=&gt;i)}wt(e,t){return __PRIVATE_documentOverlayStore(e).put(function __PRIVATE_toDbDocumentOverlay(e2,t2,n){const[r,i,s]=__PRIVATE_toDbDocumentOverlayKey(t2,n.mutation.key);return{userId:t2,collectionPath:i,documentId:s,collectionGroup:n.mutation.key.getCollectionGroup(),largestBatchId:n.largestBatchId,overlayMutation:toMutation(e2.gt,n.mutation)}}(this.serializer,this.userId,t))}}function __PRIVATE_documentOverlayStore(e){return __PRIVATE_getStore(e,$e)}class __PRIVATE_IndexedDbGlobalsCache{St(e){return __PRIVATE_getStore(e,je)}getSessionToken(e){return this.St(e).get("sessionToken").next(e2=&gt;{const t=null==e2?void 0:e2.value;return t?ByteString.fromUint8Array(t):ByteString.EMPTY_BYTE_STRING})}setSessionToken(e,t){return this.St(e).put({name:"sessionToken",value:t.toUint8Array()})}}class __PRIVATE_FirestoreIndexValueWriter{constructor(){}bt(e,t){this.Dt(e,t),t.vt()}Dt(e,t){if("nullValue"in e)this.Ct(t,5);else if("booleanValue"in e)this.Ct(t,10),t.Ft(e.booleanValue?1:0);else if("integerValue"in e)this.Ct(t,15),t.Ft(__PRIVATE_normalizeNumber(e.integerValue));else if("doubleValue"in e){const n=__PRIVATE_normalizeNumber(e.doubleValue);isNaN(n)?this.Ct(t,13):(this.Ct(t,15),__PRIVATE_isNegativeZero(n)?t.Ft(0):t.Ft(n))}else if("timestampValue"in e){let n=e.timestampValue;this.Ct(t,20),"string"==typeof n&amp;&amp;(n=__PRIVATE_normalizeTimestamp(n)),t.Mt(`${n.seconds||""}`),t.Ft(n.nanos||0)}else if("stringValue"in e)this.xt(e.stringValue,t),this.Ot(t);else if("bytesValue"in e)this.Ct(t,30),t.Nt(__PRIVATE_normalizeByteString(e.bytesValue)),this.Ot(t);else if("referenceValue"in e)this.Bt(e.referenceValue,t);else if("geoPointValue"in e){const n=e.geoPointValue;this.Ct(t,45),t.Ft(n.latitude||0),t.Ft(n.longitude||0)}else"mapValue"in e?__PRIVATE_isMaxValue(e)?this.Ct(t,Number.MAX_SAFE_INTEGER):__PRIVATE_isVectorValue(e)?this.Lt(e.mapValue,t):(this.kt(e.mapValue,t),this.Ot(t)):"arrayValue"in e?(this.qt(e.arrayValue,t),this.Ot(t)):fail(19022,{Qt:e})}xt(e,t){this.Ct(t,25),this.$t(e,t)}$t(e,t){t.Mt(e)}kt(e,t){const n=e.fields||{};this.Ct(t,55);for(const e2 of Object.keys(n))this.xt(e2,t),this.Dt(n[e2],t)}Lt(e,t){var n,r;const i=e.fields||{};this.Ct(t,53);const s=Tt,o=(null===(r=null===(n=i[s].arrayValue)||void 0===n?void 0:n.values)||void 0===r?void 0:r.length)||0;this.Ct(t,15),t.Ft(__PRIVATE_normalizeNumber(o)),this.xt(s,t),this.Dt(i[s],t)}qt(e,t){const n=e.values||[];this.Ct(t,50);for(const e2 of n)this.Dt(e2,t)}Bt(e,t){this.Ct(t,37),DocumentKey.fromName(e).path.forEach(e2=&gt;{this.Ct(t,60),this.$t(e2,t)})}Ct(e,t){e.Ft(t)}Ot(e){e.Ft(2)}}__PRIVATE_FirestoreIndexValueWriter.Ut=new __PRIVATE_FirestoreIndexValueWriter;function __PRIVATE_numberOfLeadingZerosInByte(e){if(0===e)return 8;let t=0;return e&gt;&gt;4||(t+=4,e&lt;&lt;=4),e&gt;&gt;6||(t+=2,e&lt;&lt;=2),e&gt;&gt;7||(t+=1),t}function __PRIVATE_unsignedNumLength(e){const t=64-function __PRIVATE_numberOfLeadingZeros(e2){let t2=0;for(let n=0;n&lt;8;++n){const r=__PRIVATE_numberOfLeadingZerosInByte(255&amp;e2[n]);if(t2+=r,8!==r)break}return t2}(e);return Math.ceil(t/8)}class __PRIVATE_OrderedCodeWriter{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Kt(e){const t=e[Symbol.iterator]();let n=t.next();for(;!n.done;)this.Wt(n.value),n=t.next();this.Gt()}zt(e){const t=e[Symbol.iterator]();let n=t.next();for(;!n.done;)this.jt(n.value),n=t.next();this.Jt()}Ht(e){for(const t of e){const e2=t.charCodeAt(0);if(e2&lt;128)this.Wt(e2);else if(e2&lt;2048)this.Wt(960|e2&gt;&gt;&gt;6),this.Wt(128|63&amp;e2);else if(t&lt;"\ud800"||"\udbff"&lt;t)this.Wt(480|e2&gt;&gt;&gt;12),this.Wt(128|63&amp;e2&gt;&gt;&gt;6),this.Wt(128|63&amp;e2);else{const e3=t.codePointAt(0);this.Wt(240|e3&gt;&gt;&gt;18),this.Wt(128|63&amp;e3&gt;&gt;&gt;12),this.Wt(128|63&amp;e3&gt;&gt;&gt;6),this.Wt(128|63&amp;e3)}}this.Gt()}Yt(e){for(const t of e){const e2=t.charCodeAt(0);if(e2&lt;128)this.jt(e2);else if(e2&lt;2048)this.jt(960|e2&gt;&gt;&gt;6),this.jt(128|63&amp;e2);else if(t&lt;"\ud800"||"\udbff"&lt;t)this.jt(480|e2&gt;&gt;&gt;12),this.jt(128|63&amp;e2&gt;&gt;&gt;6),this.jt(128|63&amp;e2);else{const e3=t.codePointAt(0);this.jt(240|e3&gt;&gt;&gt;18),this.jt(128|63&amp;e3&gt;&gt;&gt;12),this.jt(128|63&amp;e3&gt;&gt;&gt;6),this.jt(128|63&amp;e3)}}this.Jt()}Zt(e){const t=this.Xt(e),n=__PRIVATE_unsignedNumLength(t);this.en(1+n),this.buffer[this.position++]=255&amp;n;for(let e2=t.length-n;e2&lt;t.length;++e2)this.buffer[this.position++]=255&amp;t[e2]}tn(e){const t=this.Xt(e),n=__PRIVATE_unsignedNumLength(t);this.en(1+n),this.buffer[this.position++]=~(255&amp;n);for(let e2=t.length-n;e2&lt;t.length;++e2)this.buffer[this.position++]=~(255&amp;t[e2])}nn(){this.rn(255),this.rn(255)}sn(){this._n(255),this._n(255)}reset(){this.position=0}seed(e){this.en(e.length),this.buffer.set(e,this.position),this.position+=e.length}an(){return this.buffer.slice(0,this.position)}Xt(e){const t=function __PRIVATE_doubleToLongBits(e2){const t2=new DataView(new ArrayBuffer(8));return t2.setFloat64(0,e2,!1),new Uint8Array(t2.buffer)}(e),n=!!(128&amp;t[0]);t[0]^=n?255:128;for(let e2=1;e2&lt;t.length;++e2)t[e2]^=n?255:0;return t}Wt(e){const t=255&amp;e;0===t?(this.rn(0),this.rn(255)):255===t?(this.rn(255),this.rn(0)):this.rn(t)}jt(e){const t=255&amp;e;0===t?(this._n(0),this._n(255)):255===t?(this._n(255),this._n(0)):this._n(e)}Gt(){this.rn(0),this.rn(1)}Jt(){this._n(0),this._n(1)}rn(e){this.en(1),this.buffer[this.position++]=e}_n(e){this.en(1),this.buffer[this.position++]=~e}en(e){const t=e+this.position;if(t&lt;=this.buffer.length)return;let n=2*this.buffer.length;n&lt;t&amp;&amp;(n=t);const r=new Uint8Array(n);r.set(this.buffer),this.buffer=r}}class __PRIVATE_AscendingIndexByteEncoder{constructor(e){this.un=e}Nt(e){this.un.Kt(e)}Mt(e){this.un.Ht(e)}Ft(e){this.un.Zt(e)}vt(){this.un.nn()}}class __PRIVATE_DescendingIndexByteEncoder{constructor(e){this.un=e}Nt(e){this.un.zt(e)}Mt(e){this.un.Yt(e)}Ft(e){this.un.tn(e)}vt(){this.un.sn()}}class __PRIVATE_IndexByteEncoder{constructor(){this.un=new __PRIVATE_OrderedCodeWriter,this.cn=new __PRIVATE_AscendingIndexByteEncoder(this.un),this.ln=new __PRIVATE_DescendingIndexByteEncoder(this.un)}seed(e){this.un.seed(e)}hn(e){return 0===e?this.cn:this.ln}an(){return this.un.an()}reset(){this.un.reset()}}class __PRIVATE_IndexEntry{constructor(e,t,n,r){this.Pn=e,this.Tn=t,this.In=n,this.dn=r}En(){const e=this.dn.length,t=0===e||255===this.dn[e-1]?e+1:e,n=new Uint8Array(t);return n.set(this.dn,0),t!==e?n.set([0],this.dn.length):++n[n.length-1],new __PRIVATE_IndexEntry(this.Pn,this.Tn,this.In,n)}An(e,t,n){return{indexId:this.Pn,uid:e,arrayValue:__PRIVATE_encodeKeySafeBytes(this.In),directionalValue:__PRIVATE_encodeKeySafeBytes(this.dn),orderedDocumentKey:__PRIVATE_encodeKeySafeBytes(t),documentKey:n.path.toArray()}}Rn(e,t,n){const r=this.An(e,t,n);return[r.indexId,r.uid,r.arrayValue,r.directionalValue,r.orderedDocumentKey,r.documentKey]}}function __PRIVATE_indexEntryComparator(e,t){let n=e.Pn-t.Pn;return 0!==n?n:(n=__PRIVATE_compareByteArrays(e.In,t.In),0!==n?n:(n=__PRIVATE_compareByteArrays(e.dn,t.dn),0!==n?n:DocumentKey.comparator(e.Tn,t.Tn)))}function __PRIVATE_compareByteArrays(e,t){for(let n=0;n&lt;e.length&amp;&amp;n&lt;t.length;++n){const r=e[n]-t[n];if(0!==r)return r}return e.length-t.length}function __PRIVATE_encodeKeySafeBytes(e){return isSafariOrWebkit()?function __PRIVATE_encodeUint8ArrayToSortableString(e2){let t="";for(let n=0;n&lt;e2.length;n++)t+=String.fromCharCode(e2[n]);return t}(e):e}function __PRIVATE_decodeKeySafeBytes(e){return"string"!=typeof e?e:function __PRIVATE_decodeSortableStringToUint8Array(e2){const t=new Uint8Array(e2.length);for(let n=0;n&lt;e2.length;n++)t[n]=e2.charCodeAt(n);return t}(e)}class __PRIVATE_TargetIndexMatcher{constructor(e){this.Vn=new SortedSet((e2,t)=&gt;FieldPath$1.comparator(e2.field,t.field)),this.collectionId=null!=e.collectionGroup?e.collectionGroup:e.path.lastSegment(),this.mn=e.orderBy,this.fn=[];for(const t of e.filters){const e2=t;e2.isInequality()?this.Vn=this.Vn.add(e2):this.fn.push(e2)}}get gn(){return this.Vn.size&gt;1}pn(e){if(__PRIVATE_hardAssert(e.collectionGroup===this.collectionId,49279),this.gn)return!1;const t=__PRIVATE_fieldIndexGetArraySegment(e);if(void 0!==t&amp;&amp;!this.yn(t))return!1;const n=__PRIVATE_fieldIndexGetDirectionalSegments(e);let r=new Set,i=0,s=0;for(;i&lt;n.length&amp;&amp;this.yn(n[i]);++i)r=r.add(n[i].fieldPath.canonicalString());if(i===n.length)return!0;if(this.Vn.size&gt;0){const e2=this.Vn.getIterator().getNext();if(!r.has(e2.field.canonicalString())){const t2=n[i];if(!this.wn(e2,t2)||!this.Sn(this.mn[s++],t2))return!1}++i}for(;i&lt;n.length;++i){const e2=n[i];if(s&gt;=this.mn.length||!this.Sn(this.mn[s++],e2))return!1}return!0}bn(){if(this.gn)return null;let e=new SortedSet(FieldPath$1.comparator);const t=[];for(const n of this.fn)if(!n.field.isKeyField())if("array-contains"===n.op||"array-contains-any"===n.op)t.push(new IndexSegment(n.field,2));else{if(e.has(n.field))continue;e=e.add(n.field),t.push(new IndexSegment(n.field,0))}for(const n of this.mn)n.field.isKeyField()||e.has(n.field)||(e=e.add(n.field),t.push(new IndexSegment(n.field,"asc"===n.dir?0:1)));return new FieldIndex(FieldIndex.UNKNOWN_ID,this.collectionId,t,IndexState.empty())}yn(e){for(const t of this.fn)if(this.wn(t,e))return!0;return!1}wn(e,t){if(void 0===e||!e.field.isEqual(t.fieldPath))return!1;const n="array-contains"===e.op||"array-contains-any"===e.op;return 2===t.kind===n}Sn(e,t){return!!e.field.isEqual(t.fieldPath)&amp;&amp;(0===t.kind&amp;&amp;"asc"===e.dir||1===t.kind&amp;&amp;"desc"===e.dir)}}function __PRIVATE_computeInExpansion(e){var t,n;if(__PRIVATE_hardAssert(e instanceof FieldFilter||e instanceof CompositeFilter,20012),e instanceof FieldFilter){if(e instanceof __PRIVATE_InFilter){const r2=(null===(n=null===(t=e.value.arrayValue)||void 0===t?void 0:t.values)||void 0===n?void 0:n.map(t2=&gt;FieldFilter.create(e.field,"==",t2)))||[];return CompositeFilter.create(r2,"or")}return e}const r=e.filters.map(e2=&gt;__PRIVATE_computeInExpansion(e2));return CompositeFilter.create(r,e.op)}function __PRIVATE_getDnfTerms(e){if(0===e.getFilters().length)return[];const t=__PRIVATE_computeDistributedNormalForm(__PRIVATE_computeInExpansion(e));return __PRIVATE_hardAssert(__PRIVATE_isDisjunctiveNormalForm(t),7391),__PRIVATE_isSingleFieldFilter(t)||__PRIVATE_isFlatConjunction(t)?[t]:t.getFilters()}function __PRIVATE_isSingleFieldFilter(e){return e instanceof FieldFilter}function __PRIVATE_isFlatConjunction(e){return e instanceof CompositeFilter&amp;&amp;__PRIVATE_compositeFilterIsFlatConjunction(e)}function __PRIVATE_isDisjunctiveNormalForm(e){return __PRIVATE_isSingleFieldFilter(e)||__PRIVATE_isFlatConjunction(e)||function __PRIVATE_isDisjunctionOfFieldFiltersAndFlatConjunctions(e2){if(e2 instanceof CompositeFilter&amp;&amp;__PRIVATE_compositeFilterIsDisjunction(e2)){for(const t of e2.getFilters())if(!__PRIVATE_isSingleFieldFilter(t)&amp;&amp;!__PRIVATE_isFlatConjunction(t))return!1;return!0}return!1}(e)}function __PRIVATE_computeDistributedNormalForm(e){if(__PRIVATE_hardAssert(e instanceof FieldFilter||e instanceof CompositeFilter,34018),e instanceof FieldFilter)return e;if(1===e.filters.length)return __PRIVATE_computeDistributedNormalForm(e.filters[0]);const t=e.filters.map(e2=&gt;__PRIVATE_computeDistributedNormalForm(e2));let n=CompositeFilter.create(t,e.op);return n=__PRIVATE_applyAssociation(n),__PRIVATE_isDisjunctiveNormalForm(n)?n:(__PRIVATE_hardAssert(n instanceof CompositeFilter,64498),__PRIVATE_hardAssert(__PRIVATE_compositeFilterIsConjunction(n),40251),__PRIVATE_hardAssert(n.filters.length&gt;1,57927),n.filters.reduce((e2,t2)=&gt;__PRIVATE_applyDistribution(e2,t2)))}function __PRIVATE_applyDistribution(e,t){let n;return __PRIVATE_hardAssert(e instanceof FieldFilter||e instanceof CompositeFilter,38388),__PRIVATE_hardAssert(t instanceof FieldFilter||t instanceof CompositeFilter,25473),n=e instanceof FieldFilter?t instanceof FieldFilter?function __PRIVATE_applyDistributionFieldFilters(e2,t2){return CompositeFilter.create([e2,t2],"and")}(e,t):__PRIVATE_applyDistributionFieldAndCompositeFilters(e,t):t instanceof FieldFilter?__PRIVATE_applyDistributionFieldAndCompositeFilters(t,e):function __PRIVATE_applyDistributionCompositeFilters(e2,t2){if(__PRIVATE_hardAssert(e2.filters.length&gt;0&amp;&amp;t2.filters.length&gt;0,48005),__PRIVATE_compositeFilterIsConjunction(e2)&amp;&amp;__PRIVATE_compositeFilterIsConjunction(t2))return __PRIVATE_compositeFilterWithAddedFilters(e2,t2.getFilters());const n2=__PRIVATE_compositeFilterIsDisjunction(e2)?e2:t2,r=__PRIVATE_compositeFilterIsDisjunction(e2)?t2:e2,i=n2.filters.map(e3=&gt;__PRIVATE_applyDistribution(e3,r));return CompositeFilter.create(i,"or")}(e,t),__PRIVATE_applyAssociation(n)}function __PRIVATE_applyDistributionFieldAndCompositeFilters(e,t){if(__PRIVATE_compositeFilterIsConjunction(t))return __PRIVATE_compositeFilterWithAddedFilters(t,e.getFilters());{const n=t.filters.map(t2=&gt;__PRIVATE_applyDistribution(e,t2));return CompositeFilter.create(n,"or")}}function __PRIVATE_applyAssociation(e){if(__PRIVATE_hardAssert(e instanceof FieldFilter||e instanceof CompositeFilter,11850),e instanceof FieldFilter)return e;const t=e.getFilters();if(1===t.length)return __PRIVATE_applyAssociation(t[0]);if(__PRIVATE_compositeFilterIsFlat(e))return e;const n=t.map(e2=&gt;__PRIVATE_applyAssociation(e2)),r=[];return n.forEach(t2=&gt;{t2 instanceof FieldFilter?r.push(t2):t2 instanceof CompositeFilter&amp;&amp;(t2.op===e.op?r.push(...t2.filters):r.push(t2))}),1===r.length?r[0]:CompositeFilter.create(r,e.op)}class __PRIVATE_MemoryIndexManager{constructor(){this.Dn=new __PRIVATE_MemoryCollectionParentIndex}addToCollectionParentIndex(e,t){return this.Dn.add(t),PersistencePromise.resolve()}getCollectionParents(e,t){return PersistencePromise.resolve(this.Dn.getEntries(t))}addFieldIndex(e,t){return PersistencePromise.resolve()}deleteFieldIndex(e,t){return PersistencePromise.resolve()}deleteAllFieldIndexes(e){return PersistencePromise.resolve()}createTargetIndexes(e,t){return PersistencePromise.resolve()}getDocumentsMatchingTarget(e,t){return PersistencePromise.resolve(null)}getIndexType(e,t){return PersistencePromise.resolve(0)}getFieldIndexes(e,t){return PersistencePromise.resolve([])}getNextCollectionGroupToUpdate(e){return PersistencePromise.resolve(null)}getMinOffset(e,t){return PersistencePromise.resolve(IndexOffset.min())}getMinOffsetFromCollectionGroup(e,t){return PersistencePromise.resolve(IndexOffset.min())}updateCollectionGroup(e,t,n){return PersistencePromise.resolve()}updateIndexEntries(e,t){return PersistencePromise.resolve()}}class __PRIVATE_MemoryCollectionParentIndex{constructor(){this.index={}}add(e){const t=e.lastSegment(),n=e.popLast(),r=this.index[t]||new SortedSet(ResourcePath.comparator),i=!r.has(n);return this.index[t]=r.add(n),i}has(e){const t=e.lastSegment(),n=e.popLast(),r=this.index[t];return r&amp;&amp;r.has(n)}getEntries(e){return(this.index[e]||new SortedSet(ResourcePath.comparator)).toArray()}}const vt="IndexedDbIndexManager",Ct=new Uint8Array(0);class __PRIVATE_IndexedDbIndexManager{constructor(e,t){this.databaseId=t,this.vn=new __PRIVATE_MemoryCollectionParentIndex,this.Cn=new ObjectMap(e2=&gt;__PRIVATE_canonifyTarget(e2),(e2,t2)=&gt;__PRIVATE_targetEquals(e2,t2)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.vn.has(t)){const n=t.lastSegment(),r=t.popLast();e.addOnCommittedListener(()=&gt;{this.vn.add(t)});const i={collectionId:n,parent:__PRIVATE_encodeResourcePath(r)};return __PRIVATE_collectionParentsStore(e).put(i)}return PersistencePromise.resolve()}getCollectionParents(e,t){const n=[],r=IDBKeyRange.bound([t,""],[__PRIVATE_immediateSuccessor(t),""],!1,!0);return __PRIVATE_collectionParentsStore(e).j(r).next(e2=&gt;{for(const r2 of e2){if(r2.collectionId!==t)break;n.push(__PRIVATE_decodeResourcePath(r2.parent))}return n})}addFieldIndex(e,t){const n=__PRIVATE_indexConfigurationStore(e),r=function __PRIVATE_toDbIndexConfiguration(e2){return{indexId:e2.indexId,collectionGroup:e2.collectionGroup,fields:e2.fields.map(e3=&gt;[e3.fieldPath.canonicalString(),e3.kind])}}(t);delete r.indexId;const i=n.add(r);if(t.indexState){const n2=__PRIVATE_indexStateStore(e);return i.next(e2=&gt;{n2.put(__PRIVATE_toDbIndexState(e2,this.uid,t.indexState.sequenceNumber,t.indexState.offset))})}return i.next()}deleteFieldIndex(e,t){const n=__PRIVATE_indexConfigurationStore(e),r=__PRIVATE_indexStateStore(e),i=__PRIVATE_indexEntriesStore(e);return n.delete(t.indexId).next(()=&gt;r.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=&gt;i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}deleteAllFieldIndexes(e){const t=__PRIVATE_indexConfigurationStore(e),n=__PRIVATE_indexEntriesStore(e),r=__PRIVATE_indexStateStore(e);return t.Y().next(()=&gt;n.Y()).next(()=&gt;r.Y())}createTargetIndexes(e,t){return PersistencePromise.forEach(this.Fn(t),t2=&gt;this.getIndexType(e,t2).next(n=&gt;{if(0===n||1===n){const n2=new __PRIVATE_TargetIndexMatcher(t2).bn();if(null!=n2)return this.addFieldIndex(e,n2)}}))}getDocumentsMatchingTarget(e,t){const n=__PRIVATE_indexEntriesStore(e);let r=!0;const i=new Map;return PersistencePromise.forEach(this.Fn(t),t2=&gt;this.Mn(e,t2).next(e2=&gt;{r&amp;&amp;(r=!!e2),i.set(t2,e2)})).next(()=&gt;{if(r){let e2=__PRIVATE_documentKeySet();const r2=[];return PersistencePromise.forEach(i,(i2,s)=&gt;{__PRIVATE_logDebug(vt,`Using index ${function __PRIVATE_fieldIndexToString(e3){return`id=${e3.indexId}|cg=${e3.collectionGroup}|f=${e3.fields.map(e4=&gt;`${e4.fieldPath}:${e4.kind}`).join(",")}`}(i2)} to execute ${__PRIVATE_canonifyTarget(t)}`);const o=function __PRIVATE_targetGetArrayValues(e3,t2){const n2=__PRIVATE_fieldIndexGetArraySegment(t2);if(void 0===n2)return null;for(const t3 of __PRIVATE_targetGetFieldFiltersForPath(e3,n2.fieldPath))switch(t3.op){case"array-contains-any":return t3.value.arrayValue.values||[];case"array-contains":return[t3.value]}return null}(s,i2),_=function __PRIVATE_targetGetNotInValues(e3,t2){const n2=new Map;for(const r3 of __PRIVATE_fieldIndexGetDirectionalSegments(t2))for(const t3 of __PRIVATE_targetGetFieldFiltersForPath(e3,r3.fieldPath))switch(t3.op){case"==":case"in":n2.set(r3.fieldPath.canonicalString(),t3.value);break;case"not-in":case"!=":return n2.set(r3.fieldPath.canonicalString(),t3.value),Array.from(n2.values())}return null}(s,i2),a=function __PRIVATE_targetGetLowerBound(e3,t2){const n2=[];let r3=!0;for(const i3 of __PRIVATE_fieldIndexGetDirectionalSegments(t2)){const t3=0===i3.kind?__PRIVATE_targetGetAscendingBound(e3,i3.fieldPath,e3.startAt):__PRIVATE_targetGetDescendingBound(e3,i3.fieldPath,e3.startAt);n2.push(t3.value),r3&amp;&amp;(r3=t3.inclusive)}return new Bound(n2,r3)}(s,i2),u=function __PRIVATE_targetGetUpperBound(e3,t2){const n2=[];let r3=!0;for(const i3 of __PRIVATE_fieldIndexGetDirectionalSegments(t2)){const t3=0===i3.kind?__PRIVATE_targetGetDescendingBound(e3,i3.fieldPath,e3.endAt):__PRIVATE_targetGetAscendingBound(e3,i3.fieldPath,e3.endAt);n2.push(t3.value),r3&amp;&amp;(r3=t3.inclusive)}return new Bound(n2,r3)}(s,i2),c=this.xn(i2,s,a),l=this.xn(i2,s,u),h=this.On(i2,s,_),P=this.Nn(i2.indexId,o,c,a.inclusive,l,u.inclusive,h);return PersistencePromise.forEach(P,i3=&gt;n.H(i3,t.limit).next(t2=&gt;{t2.forEach(t3=&gt;{const n2=DocumentKey.fromSegments(t3.documentKey);e2.has(n2)||(e2=e2.add(n2),r2.push(n2))})}))}).next(()=&gt;r2)}return PersistencePromise.resolve(null)})}Fn(e){let t=this.Cn.get(e);return t||(t=0===e.filters.length?[e]:__PRIVATE_getDnfTerms(CompositeFilter.create(e.filters,"and")).map(t2=&gt;__PRIVATE_newTarget(e.path,e.collectionGroup,e.orderBy,t2.getFilters(),e.limit,e.startAt,e.endAt)),this.Cn.set(e,t),t)}Nn(e,t,n,r,i,s,o){const _=(null!=t?t.length:1)*Math.max(n.length,i.length),a=_/(null!=t?t.length:1),u=[];for(let c=0;c&lt;_;++c){const _2=t?this.Bn(t[c/a]):Ct,l=this.Ln(e,_2,n[c%a],r),h=this.kn(e,_2,i[c%a],s),P=o.map(t2=&gt;this.Ln(e,_2,t2,!0));u.push(...this.createRange(l,h,P))}return u}Ln(e,t,n,r){const i=new __PRIVATE_IndexEntry(e,DocumentKey.empty(),t,n);return r?i:i.En()}kn(e,t,n,r){const i=new __PRIVATE_IndexEntry(e,DocumentKey.empty(),t,n);return r?i.En():i}Mn(e,t){const n=new __PRIVATE_TargetIndexMatcher(t),r=null!=t.collectionGroup?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,r).next(e2=&gt;{let t2=null;for(const r2 of e2)n.pn(r2)&amp;&amp;(!t2||r2.fields.length&gt;t2.fields.length)&amp;&amp;(t2=r2);return t2})}getIndexType(e,t){let n=2;const r=this.Fn(t);return PersistencePromise.forEach(r,t2=&gt;this.Mn(e,t2).next(e2=&gt;{e2?0!==n&amp;&amp;e2.fields.length&lt;function __PRIVATE_targetGetSegmentCount(e3){let t3=new SortedSet(FieldPath$1.comparator),n2=!1;for(const r2 of e3.filters)for(const e4 of r2.getFlattenedFilters())e4.field.isKeyField()||("array-contains"===e4.op||"array-contains-any"===e4.op?n2=!0:t3=t3.add(e4.field));for(const n3 of e3.orderBy)n3.field.isKeyField()||(t3=t3.add(n3.field));return t3.size+(n2?1:0)}(t2)&amp;&amp;(n=1):n=0})).next(()=&gt;function __PRIVATE_targetHasLimit(e2){return null!==e2.limit}(t)&amp;&amp;r.length&gt;1&amp;&amp;2===n?1:n)}qn(e,t){const n=new __PRIVATE_IndexByteEncoder;for(const r of __PRIVATE_fieldIndexGetDirectionalSegments(e)){const e2=t.data.field(r.fieldPath);if(null==e2)return null;const i=n.hn(r.kind);__PRIVATE_FirestoreIndexValueWriter.Ut.bt(e2,i)}return n.an()}Bn(e){const t=new __PRIVATE_IndexByteEncoder;return __PRIVATE_FirestoreIndexValueWriter.Ut.bt(e,t.hn(0)),t.an()}Qn(e,t){const n=new __PRIVATE_IndexByteEncoder;return __PRIVATE_FirestoreIndexValueWriter.Ut.bt(__PRIVATE_refValue(this.databaseId,t),n.hn(function __PRIVATE_fieldIndexGetKeyOrder(e2){const t2=__PRIVATE_fieldIndexGetDirectionalSegments(e2);return 0===t2.length?0:t2[t2.length-1].kind}(e))),n.an()}On(e,t,n){if(null===n)return[];let r=[];r.push(new __PRIVATE_IndexByteEncoder);let i=0;for(const s of __PRIVATE_fieldIndexGetDirectionalSegments(e)){const e2=n[i++];for(const n2 of r)if(this.$n(t,s.fieldPath)&amp;&amp;isArray(e2))r=this.Un(r,s,e2);else{const t2=n2.hn(s.kind);__PRIVATE_FirestoreIndexValueWriter.Ut.bt(e2,t2)}}return this.Kn(r)}xn(e,t,n){return this.On(e,t,n.position)}Kn(e){const t=[];for(let n=0;n&lt;e.length;++n)t[n]=e[n].an();return t}Un(e,t,n){const r=[...e],i=[];for(const e2 of n.arrayValue.values||[])for(const n2 of r){const r2=new __PRIVATE_IndexByteEncoder;r2.seed(n2.an()),__PRIVATE_FirestoreIndexValueWriter.Ut.bt(e2,r2.hn(t.kind)),i.push(r2)}return i}$n(e,t){return!!e.filters.find(e2=&gt;e2 instanceof FieldFilter&amp;&amp;e2.field.isEqual(t)&amp;&amp;("in"===e2.op||"not-in"===e2.op))}getFieldIndexes(e,t){const n=__PRIVATE_indexConfigurationStore(e),r=__PRIVATE_indexStateStore(e);return(t?n.j(Fe,IDBKeyRange.bound(t,t)):n.j()).next(e2=&gt;{const t2=[];return PersistencePromise.forEach(e2,e3=&gt;r.get([e3.indexId,this.uid]).next(n2=&gt;{t2.push(function __PRIVATE_fromDbIndexConfiguration(e4,t3){const n3=t3?new IndexState(t3.sequenceNumber,new IndexOffset(__PRIVATE_fromDbTimestamp(t3.readTime),new DocumentKey(__PRIVATE_decodeResourcePath(t3.documentKey)),t3.largestBatchId)):IndexState.empty(),r2=e4.fields.map(([e5,t4])=&gt;new IndexSegment(FieldPath$1.fromServerFormat(e5),t4));return new FieldIndex(e4.indexId,e4.collectionGroup,r2,n3)}(e3,n2))})).next(()=&gt;t2)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(e2=&gt;0===e2.length?null:(e2.sort((e3,t)=&gt;{const n=e3.indexState.sequenceNumber-t.indexState.sequenceNumber;return 0!==n?n:__PRIVATE_primitiveComparator(e3.collectionGroup,t.collectionGroup)}),e2[0].collectionGroup))}updateCollectionGroup(e,t,n){const r=__PRIVATE_indexConfigurationStore(e),i=__PRIVATE_indexStateStore(e);return this.Wn(e).next(e2=&gt;r.j(Fe,IDBKeyRange.bound(t,t)).next(t2=&gt;PersistencePromise.forEach(t2,t3=&gt;i.put(__PRIVATE_toDbIndexState(t3.indexId,this.uid,e2,n)))))}updateIndexEntries(e,t){const n=new Map;return PersistencePromise.forEach(t,(t2,r)=&gt;{const i=n.get(t2.collectionGroup);return(i?PersistencePromise.resolve(i):this.getFieldIndexes(e,t2.collectionGroup)).next(i2=&gt;(n.set(t2.collectionGroup,i2),PersistencePromise.forEach(i2,n2=&gt;this.Gn(e,t2,n2).next(t3=&gt;{const i3=this.zn(r,n2);return t3.isEqual(i3)?PersistencePromise.resolve():this.jn(e,r,n2,t3,i3)}))))})}Jn(e,t,n,r){return __PRIVATE_indexEntriesStore(e).put(r.An(this.uid,this.Qn(n,t.key),t.key))}Hn(e,t,n,r){return __PRIVATE_indexEntriesStore(e).delete(r.Rn(this.uid,this.Qn(n,t.key),t.key))}Gn(e,t,n){const r=__PRIVATE_indexEntriesStore(e);let i=new SortedSet(__PRIVATE_indexEntryComparator);return r.X({index:qe,range:IDBKeyRange.only([n.indexId,this.uid,__PRIVATE_encodeKeySafeBytes(this.Qn(n,t))])},(e2,r2)=&gt;{i=i.add(new __PRIVATE_IndexEntry(n.indexId,t,__PRIVATE_decodeKeySafeBytes(r2.arrayValue),__PRIVATE_decodeKeySafeBytes(r2.directionalValue)))}).next(()=&gt;i)}zn(e,t){let n=new SortedSet(__PRIVATE_indexEntryComparator);const r=this.qn(t,e);if(null==r)return n;const i=__PRIVATE_fieldIndexGetArraySegment(t);if(null!=i){const s=e.data.field(i.fieldPath);if(isArray(s))for(const i2 of s.arrayValue.values||[])n=n.add(new __PRIVATE_IndexEntry(t.indexId,e.key,this.Bn(i2),r))}else n=n.add(new __PRIVATE_IndexEntry(t.indexId,e.key,Ct,r));return n}jn(e,t,n,r,i){__PRIVATE_logDebug(vt,"Updating index entries for document '%s'",t.key);const s=[];return function __PRIVATE_diffSortedSets(e2,t2,n2,r2,i2){const s2=e2.getIterator(),o=t2.getIterator();let _=__PRIVATE_advanceIterator(s2),a=__PRIVATE_advanceIterator(o);for(;_||a;){let e3=!1,t3=!1;if(_&amp;&amp;a){const r3=n2(_,a);r3&lt;0?t3=!0:r3&gt;0&amp;&amp;(e3=!0)}else null!=_?t3=!0:e3=!0;e3?(r2(a),a=__PRIVATE_advanceIterator(o)):t3?(i2(_),_=__PRIVATE_advanceIterator(s2)):(_=__PRIVATE_advanceIterator(s2),a=__PRIVATE_advanceIterator(o))}}(r,i,__PRIVATE_indexEntryComparator,r2=&gt;{s.push(this.Jn(e,t,n,r2))},r2=&gt;{s.push(this.Hn(e,t,n,r2))}),PersistencePromise.waitFor(s)}Wn(e){let t=1;return __PRIVATE_indexStateStore(e).X({index:Ne,reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(e2,n,r)=&gt;{r.done(),t=n.sequenceNumber+1}).next(()=&gt;t)}createRange(e,t,n){n=n.sort((e2,t2)=&gt;__PRIVATE_indexEntryComparator(e2,t2)).filter((e2,t2,n2)=&gt;!t2||0!==__PRIVATE_indexEntryComparator(e2,n2[t2-1]));const r=[];r.push(e);for(const i2 of n){const n2=__PRIVATE_indexEntryComparator(i2,e),s=__PRIVATE_indexEntryComparator(i2,t);if(0===n2)r[0]=e.En();else if(n2&gt;0&amp;&amp;s&lt;0)r.push(i2),r.push(i2.En());else if(s&gt;0)break}r.push(t);const i=[];for(let e2=0;e2&lt;r.length;e2+=2){if(this.Yn(r[e2],r[e2+1]))return[];const t2=r[e2].Rn(this.uid,Ct,DocumentKey.empty()),n2=r[e2+1].Rn(this.uid,Ct,DocumentKey.empty());i.push(IDBKeyRange.bound(t2,n2))}return i}Yn(e,t){return __PRIVATE_indexEntryComparator(e,t)&gt;0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(__PRIVATE_getMinOffsetFromFieldIndexes)}getMinOffset(e,t){return PersistencePromise.mapArray(this.Fn(t),t2=&gt;this.Mn(e,t2).next(e2=&gt;e2||fail(44426))).next(__PRIVATE_getMinOffsetFromFieldIndexes)}}function __PRIVATE_collectionParentsStore(e){return __PRIVATE_getStore(e,fe)}function __PRIVATE_indexEntriesStore(e){return __PRIVATE_getStore(e,Le)}function __PRIVATE_indexConfigurationStore(e){return __PRIVATE_getStore(e,ve)}function __PRIVATE_indexStateStore(e){return __PRIVATE_getStore(e,xe)}function __PRIVATE_getMinOffsetFromFieldIndexes(e){__PRIVATE_hardAssert(0!==e.length,28825);let t=e[0].indexState.offset,n=t.largestBatchId;for(let r=1;r&lt;e.length;r++){const i=e[r].indexState.offset;__PRIVATE_indexOffsetComparator(i,t)&lt;0&amp;&amp;(t=i),n&lt;i.largestBatchId&amp;&amp;(n=i.largestBatchId)}return new IndexOffset(t.readTime,t.documentKey,n)}const Ft={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class LruParams{static withCacheSize(e){return new LruParams(e,LruParams.DEFAULT_COLLECTION_PERCENTILE,LruParams.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}}function removeMutationBatch(e,t,n){const r=e.store(X),i=e.store(ie),s=[],o=IDBKeyRange.only(n.batchId);let _=0;const a=r.X({range:o},(e2,t2,n2)=&gt;(_++,n2.delete()));s.push(a.next(()=&gt;{__PRIVATE_hardAssert(1===_,47070,{batchId:n.batchId})}));const u=[];for(const e2 of n.mutations){const r2=__PRIVATE_newDbDocumentMutationKey(t,e2.key.path,n.batchId);s.push(i.delete(r2)),u.push(e2.key)}return PersistencePromise.waitFor(s).next(()=&gt;u)}function __PRIVATE_dbDocumentSize(e){if(!e)return 0;let t;if(e.document)t=e.document;else if(e.unknownDocument)t=e.unknownDocument;else{if(!e.noDocument)throw fail(14731);t=e.noDocument}return JSON.stringify(t).length}LruParams.DEFAULT_COLLECTION_PERCENTILE=10,LruParams.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,LruParams.DEFAULT=new LruParams(41943040,LruParams.DEFAULT_COLLECTION_PERCENTILE,LruParams.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),LruParams.DISABLED=new LruParams(-1,0,0);class __PRIVATE_IndexedDbMutationQueue{constructor(e,t,n,r){this.userId=e,this.serializer=t,this.indexManager=n,this.referenceDelegate=r,this.Zn={}}static yt(e,t,n,r){__PRIVATE_hardAssert(""!==e.uid,64387);const i=e.isAuthenticated()?e.uid:"";return new __PRIVATE_IndexedDbMutationQueue(i,t,n,r)}checkEmpty(e){let t=!0;const n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return __PRIVATE_mutationsStore(e).X({index:te,range:n},(e2,n2,r)=&gt;{t=!1,r.done()}).next(()=&gt;t)}addMutationBatch(e,t,n,r){const i=__PRIVATE_documentMutationsStore(e),s=__PRIVATE_mutationsStore(e);return s.add({}).next(o=&gt;{__PRIVATE_hardAssert("number"==typeof o,49019);const _=new MutationBatch(o,t,n,r),a=function __PRIVATE_toDbMutationBatch(e2,t2,n2){const r2=n2.baseMutations.map(t3=&gt;toMutation(e2.gt,t3)),i2=n2.mutations.map(t3=&gt;toMutation(e2.gt,t3));return{userId:t2,batchId:n2.batchId,localWriteTimeMs:n2.localWriteTime.toMillis(),baseMutations:r2,mutations:i2}}(this.serializer,this.userId,_),u=[];let c=new SortedSet((e2,t2)=&gt;__PRIVATE_primitiveComparator(e2.canonicalString(),t2.canonicalString()));for(const e2 of r){const t2=__PRIVATE_newDbDocumentMutationKey(this.userId,e2.key.path,o);c=c.add(e2.key.path.popLast()),u.push(s.put(a)),u.push(i.put(t2,re))}return c.forEach(t2=&gt;{u.push(this.indexManager.addToCollectionParentIndex(e,t2))}),e.addOnCommittedListener(()=&gt;{this.Zn[o]=_.keys()}),PersistencePromise.waitFor(u).next(()=&gt;_)})}lookupMutationBatch(e,t){return __PRIVATE_mutationsStore(e).get(t).next(e2=&gt;e2?(__PRIVATE_hardAssert(e2.userId===this.userId,48,"Unexpected user for mutation batch",{userId:e2.userId,batchId:t}),__PRIVATE_fromDbMutationBatch(this.serializer,e2)):null)}Xn(e,t){return this.Zn[t]?PersistencePromise.resolve(this.Zn[t]):this.lookupMutationBatch(e,t).next(e2=&gt;{if(e2){const n=e2.keys();return this.Zn[t]=n,n}return null})}getNextMutationBatchAfterBatchId(e,t){const n=t+1,r=IDBKeyRange.lowerBound([this.userId,n]);let i=null;return __PRIVATE_mutationsStore(e).X({index:te,range:r},(e2,t2,r2)=&gt;{t2.userId===this.userId&amp;&amp;(__PRIVATE_hardAssert(t2.batchId&gt;=n,47524,{er:n}),i=__PRIVATE_fromDbMutationBatch(this.serializer,t2)),r2.done()}).next(()=&gt;i)}getHighestUnacknowledgedBatchId(e){const t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let n=G;return __PRIVATE_mutationsStore(e).X({index:te,range:t,reverse:!0},(e2,t2,r)=&gt;{n=t2.batchId,r.done()}).next(()=&gt;n)}getAllMutationBatches(e){const t=IDBKeyRange.bound([this.userId,G],[this.userId,Number.POSITIVE_INFINITY]);return __PRIVATE_mutationsStore(e).j(te,t).next(e2=&gt;e2.map(e3=&gt;__PRIVATE_fromDbMutationBatch(this.serializer,e3)))}getAllMutationBatchesAffectingDocumentKey(e,t){const n=__PRIVATE_newDbDocumentMutationPrefixForPath(this.userId,t.path),r=IDBKeyRange.lowerBound(n),i=[];return __PRIVATE_documentMutationsStore(e).X({range:r},(n2,r2,s)=&gt;{const[o,_,a]=n2,u=__PRIVATE_decodeResourcePath(_);if(o===this.userId&amp;&amp;t.path.isEqual(u))return __PRIVATE_mutationsStore(e).get(a).next(e2=&gt;{if(!e2)throw fail(61480,{tr:n2,batchId:a});__PRIVATE_hardAssert(e2.userId===this.userId,10503,"Unexpected user for mutation batch",{userId:e2.userId,batchId:a}),i.push(__PRIVATE_fromDbMutationBatch(this.serializer,e2))});s.done()}).next(()=&gt;i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new SortedSet(__PRIVATE_primitiveComparator);const r=[];return t.forEach(t2=&gt;{const i=__PRIVATE_newDbDocumentMutationPrefixForPath(this.userId,t2.path),s=IDBKeyRange.lowerBound(i),o=__PRIVATE_documentMutationsStore(e).X({range:s},(e2,r2,i2)=&gt;{const[s2,o2,_]=e2,a=__PRIVATE_decodeResourcePath(o2);s2===this.userId&amp;&amp;t2.path.isEqual(a)?n=n.add(_):i2.done()});r.push(o)}),PersistencePromise.waitFor(r).next(()=&gt;this.nr(e,n))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,r=n.length+1,i=__PRIVATE_newDbDocumentMutationPrefixForPath(this.userId,n),s=IDBKeyRange.lowerBound(i);let o=new SortedSet(__PRIVATE_primitiveComparator);return __PRIVATE_documentMutationsStore(e).X({range:s},(e2,t2,i2)=&gt;{const[s2,_,a]=e2,u=__PRIVATE_decodeResourcePath(_);s2===this.userId&amp;&amp;n.isPrefixOf(u)?u.length===r&amp;&amp;(o=o.add(a)):i2.done()}).next(()=&gt;this.nr(e,o))}nr(e,t){const n=[],r=[];return t.forEach(t2=&gt;{r.push(__PRIVATE_mutationsStore(e).get(t2).next(e2=&gt;{if(null===e2)throw fail(35274,{batchId:t2});__PRIVATE_hardAssert(e2.userId===this.userId,9748,"Unexpected user for mutation batch",{userId:e2.userId,batchId:t2}),n.push(__PRIVATE_fromDbMutationBatch(this.serializer,e2))}))}),PersistencePromise.waitFor(r).next(()=&gt;n)}removeMutationBatch(e,t){return removeMutationBatch(e.ce,this.userId,t).next(n=&gt;(e.addOnCommittedListener(()=&gt;{this.rr(t.batchId)}),PersistencePromise.forEach(n,t2=&gt;this.referenceDelegate.markPotentiallyOrphaned(e,t2))))}rr(e){delete this.Zn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=&gt;{if(!t)return PersistencePromise.resolve();const n=IDBKeyRange.lowerBound(function __PRIVATE_newDbDocumentMutationPrefixForUser(e2){return[e2]}(this.userId)),r=[];return __PRIVATE_documentMutationsStore(e).X({range:n},(e2,t2,n2)=&gt;{if(e2[0]===this.userId){const t3=__PRIVATE_decodeResourcePath(e2[1]);r.push(t3)}else n2.done()}).next(()=&gt;{__PRIVATE_hardAssert(0===r.length,56720,{ir:r.map(e2=&gt;e2.canonicalString())})})})}containsKey(e,t){return __PRIVATE_mutationQueueContainsKey(e,this.userId,t)}sr(e){return __PRIVATE_mutationQueuesStore(e).get(this.userId).next(e2=&gt;e2||{userId:this.userId,lastAcknowledgedBatchId:G,lastStreamToken:""})}}function __PRIVATE_mutationQueueContainsKey(e,t,n){const r=__PRIVATE_newDbDocumentMutationPrefixForPath(t,n.path),i=r[1],s=IDBKeyRange.lowerBound(r);let o=!1;return __PRIVATE_documentMutationsStore(e).X({range:s,Z:!0},(e2,n2,r2)=&gt;{const[s2,_,a]=e2;s2===t&amp;&amp;_===i&amp;&amp;(o=!0),r2.done()}).next(()=&gt;o)}function __PRIVATE_mutationsStore(e){return __PRIVATE_getStore(e,X)}function __PRIVATE_documentMutationsStore(e){return __PRIVATE_getStore(e,ie)}function __PRIVATE_mutationQueuesStore(e){return __PRIVATE_getStore(e,Y)}class __PRIVATE_TargetIdGenerator{constructor(e){this._r=e}next(){return this._r+=2,this._r}static ar(){return new __PRIVATE_TargetIdGenerator(0)}static ur(){return new __PRIVATE_TargetIdGenerator(-1)}}class __PRIVATE_IndexedDbTargetCache{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.cr(e).next(t=&gt;{const n=new __PRIVATE_TargetIdGenerator(t.highestTargetId);return t.highestTargetId=n.next(),this.lr(e,t).next(()=&gt;t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.cr(e).next(e2=&gt;SnapshotVersion.fromTimestamp(new Timestamp(e2.lastRemoteSnapshotVersion.seconds,e2.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.cr(e).next(e2=&gt;e2.highestListenSequenceNumber)}setTargetsMetadata(e,t,n){return this.cr(e).next(r=&gt;(r.highestListenSequenceNumber=t,n&amp;&amp;(r.lastRemoteSnapshotVersion=n.toTimestamp()),t&gt;r.highestListenSequenceNumber&amp;&amp;(r.highestListenSequenceNumber=t),this.lr(e,r)))}addTargetData(e,t){return this.hr(e,t).next(()=&gt;this.cr(e).next(n=&gt;(n.targetCount+=1,this.Pr(t,n),this.lr(e,n))))}updateTargetData(e,t){return this.hr(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=&gt;__PRIVATE_targetsStore(e).delete(t.targetId)).next(()=&gt;this.cr(e)).next(t2=&gt;(__PRIVATE_hardAssert(t2.targetCount&gt;0,8065),t2.targetCount-=1,this.lr(e,t2)))}removeTargets(e,t,n){let r=0;const i=[];return __PRIVATE_targetsStore(e).X((s,o)=&gt;{const _=__PRIVATE_fromDbTarget(o);_.sequenceNumber&lt;=t&amp;&amp;null===n.get(_.targetId)&amp;&amp;(r++,i.push(this.removeTargetData(e,_)))}).next(()=&gt;PersistencePromise.waitFor(i)).next(()=&gt;r)}forEachTarget(e,t){return __PRIVATE_targetsStore(e).X((e2,n)=&gt;{const r=__PRIVATE_fromDbTarget(n);t(r)})}cr(e){return __PRIVATE_globalTargetStore(e).get(Ve).next(e2=&gt;(__PRIVATE_hardAssert(null!==e2,2888),e2))}lr(e,t){return __PRIVATE_globalTargetStore(e).put(Ve,t)}hr(e,t){return __PRIVATE_targetsStore(e).put(__PRIVATE_toDbTarget(this.serializer,t))}Pr(e,t){let n=!1;return e.targetId&gt;t.highestTargetId&amp;&amp;(t.highestTargetId=e.targetId,n=!0),e.sequenceNumber&gt;t.highestListenSequenceNumber&amp;&amp;(t.highestListenSequenceNumber=e.sequenceNumber,n=!0),n}getTargetCount(e){return this.cr(e).next(e2=&gt;e2.targetCount)}getTargetData(e,t){const n=__PRIVATE_canonifyTarget(t),r=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]);let i=null;return __PRIVATE_targetsStore(e).X({range:r,index:Te},(e2,n2,r2)=&gt;{const s=__PRIVATE_fromDbTarget(n2);__PRIVATE_targetEquals(t,s.target)&amp;&amp;(i=s,r2.done())}).next(()=&gt;i)}addMatchingKeys(e,t,n){const r=[],i=__PRIVATE_documentTargetStore(e);return t.forEach(t2=&gt;{const s=__PRIVATE_encodeResourcePath(t2.path);r.push(i.put({targetId:n,path:s})),r.push(this.referenceDelegate.addReference(e,n,t2))}),PersistencePromise.waitFor(r)}removeMatchingKeys(e,t,n){const r=__PRIVATE_documentTargetStore(e);return PersistencePromise.forEach(t,t2=&gt;{const i=__PRIVATE_encodeResourcePath(t2.path);return PersistencePromise.waitFor([r.delete([n,i]),this.referenceDelegate.removeReference(e,n,t2)])})}removeMatchingKeysForTargetId(e,t){const n=__PRIVATE_documentTargetStore(e),r=IDBKeyRange.bound([t],[t+1],!1,!0);return n.delete(r)}getMatchingKeysForTargetId(e,t){const n=IDBKeyRange.bound([t],[t+1],!1,!0),r=__PRIVATE_documentTargetStore(e);let i=__PRIVATE_documentKeySet();return r.X({range:n,Z:!0},(e2,t2,n2)=&gt;{const r2=__PRIVATE_decodeResourcePath(e2[1]),s=new DocumentKey(r2);i=i.add(s)}).next(()=&gt;i)}containsKey(e,t){const n=__PRIVATE_encodeResourcePath(t.path),r=IDBKeyRange.bound([n],[__PRIVATE_immediateSuccessor(n)],!1,!0);let i=0;return __PRIVATE_documentTargetStore(e).X({index:Ae,Z:!0,range:r},([e2,t2],n2,r2)=&gt;{0!==e2&amp;&amp;(i++,r2.done())}).next(()=&gt;i&gt;0)}Et(e,t){return __PRIVATE_targetsStore(e).get(t).next(e2=&gt;e2?__PRIVATE_fromDbTarget(e2):null)}}function __PRIVATE_targetsStore(e){return __PRIVATE_getStore(e,Pe)}function __PRIVATE_globalTargetStore(e){return __PRIVATE_getStore(e,me)}function __PRIVATE_documentTargetStore(e){return __PRIVATE_getStore(e,de)}const xt="LruGarbageCollector";function __PRIVATE_bufferEntryComparator([e,t],[n,r]){const i=__PRIVATE_primitiveComparator(e,n);return 0===i?__PRIVATE_primitiveComparator(t,r):i}class __PRIVATE_RollingSequenceNumberBuffer{constructor(e){this.Tr=e,this.buffer=new SortedSet(__PRIVATE_bufferEntryComparator),this.Ir=0}dr(){return++this.Ir}Er(e){const t=[e,this.dr()];if(this.buffer.size&lt;this.Tr)this.buffer=this.buffer.add(t);else{const e2=this.buffer.last();__PRIVATE_bufferEntryComparator(t,e2)&lt;0&amp;&amp;(this.buffer=this.buffer.delete(e2).add(t))}}get maxValue(){return this.buffer.last()[0]}}class __PRIVATE_LruScheduler{constructor(e,t,n){this.garbageCollector=e,this.asyncQueue=t,this.localStore=n,this.Ar=null}start(){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&amp;&amp;this.Rr(6e4)}stop(){this.Ar&amp;&amp;(this.Ar.cancel(),this.Ar=null)}get started(){return null!==this.Ar}Rr(e){__PRIVATE_logDebug(xt,`Garbage collection scheduled in ${e}ms`),this.Ar=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=&gt;{this.Ar=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(e2){__PRIVATE_isIndexedDbTransactionError(e2)?__PRIVATE_logDebug(xt,"Ignoring IndexedDB error during garbage collection: ",e2):await __PRIVATE_ignoreIfPrimaryLeaseLoss(e2)}await this.Rr(3e5)})}}class __PRIVATE_LruGarbageCollectorImpl{constructor(e,t){this.Vr=e,this.params=t}calculateTargetCount(e,t){return this.Vr.mr(e).next(e2=&gt;Math.floor(t/100*e2))}nthSequenceNumber(e,t){if(0===t)return PersistencePromise.resolve(__PRIVATE_ListenSequence.ue);const n=new __PRIVATE_RollingSequenceNumberBuffer(t);return this.Vr.forEachTarget(e,e2=&gt;n.Er(e2.sequenceNumber)).next(()=&gt;this.Vr.gr(e,e2=&gt;n.Er(e2))).next(()=&gt;n.maxValue)}removeTargets(e,t,n){return this.Vr.removeTargets(e,t,n)}removeOrphanedDocuments(e,t){return this.Vr.removeOrphanedDocuments(e,t)}collect(e,t){return-1===this.params.cacheSizeCollectionThreshold?(__PRIVATE_logDebug("LruGarbageCollector","Garbage collection skipped; disabled"),PersistencePromise.resolve(Ft)):this.getCacheSize(e).next(n=&gt;n&lt;this.params.cacheSizeCollectionThreshold?(__PRIVATE_logDebug("LruGarbageCollector",`Garbage collection skipped; Cache size ${n} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),Ft):this.pr(e,t))}getCacheSize(e){return this.Vr.getCacheSize(e)}pr(e,t){let n,r,i,s,o,_,u;const c=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(t2=&gt;(t2&gt;this.params.maximumSequenceNumbersToCollect?(__PRIVATE_logDebug("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${t2}`),r=this.params.maximumSequenceNumbersToCollect):r=t2,s=Date.now(),this.nthSequenceNumber(e,r))).next(r2=&gt;(n=r2,o=Date.now(),this.removeTargets(e,n,t))).next(t2=&gt;(i=t2,_=Date.now(),this.removeOrphanedDocuments(e,n))).next(e2=&gt;(u=Date.now(),__PRIVATE_getLogLevel()&lt;=LogLevel.DEBUG&amp;&amp;__PRIVATE_logDebug("LruGarbageCollector",`LRU Garbage Collection\n\tCounted targets in ${s-c}ms\n\tDetermined least recently used ${r} in `+(o-s)+`ms\n\tRemoved ${i} targets in `+(_-o)+`ms\n\tRemoved ${e2} documents in `+(u-_)+`ms\nTotal Duration: ${u-c}ms`),PersistencePromise.resolve({didRun:!0,sequenceNumbersCollected:r,targetsRemoved:i,documentsRemoved:e2})))}}function __PRIVATE_newLruGarbageCollector(e,t){return new __PRIVATE_LruGarbageCollectorImpl(e,t)}class __PRIVATE_IndexedDbLruDelegateImpl{constructor(e,t){this.db=e,this.garbageCollector=__PRIVATE_newLruGarbageCollector(this,t)}mr(e){const t=this.yr(e);return this.db.getTargetCache().getTargetCount(e).next(e2=&gt;t.next(t2=&gt;e2+t2))}yr(e){let t=0;return this.gr(e,e2=&gt;{t++}).next(()=&gt;t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}gr(e,t){return this.wr(e,(e2,n)=&gt;t(n))}addReference(e,t,n){return __PRIVATE_writeSentinelKey(e,n)}removeReference(e,t,n){return __PRIVATE_writeSentinelKey(e,n)}removeTargets(e,t,n){return this.db.getTargetCache().removeTargets(e,t,n)}markPotentiallyOrphaned(e,t){return __PRIVATE_writeSentinelKey(e,t)}Sr(e,t){return function __PRIVATE_mutationQueuesContainKey(e2,t2){let n=!1;return __PRIVATE_mutationQueuesStore(e2).ee(r=&gt;__PRIVATE_mutationQueueContainsKey(e2,r,t2).next(e3=&gt;(e3&amp;&amp;(n=!0),PersistencePromise.resolve(!e3)))).next(()=&gt;n)}(e,t)}removeOrphanedDocuments(e,t){const n=this.db.getRemoteDocumentCache().newChangeBuffer(),r=[];let i=0;return this.wr(e,(s,o)=&gt;{if(o&lt;=t){const t2=this.Sr(e,s).next(t3=&gt;{if(!t3)return i++,n.getEntry(e,s).next(()=&gt;(n.removeEntry(s,SnapshotVersion.min()),__PRIVATE_documentTargetStore(e).delete(function __PRIVATE_sentinelKey$1(e2){return[0,__PRIVATE_encodeResourcePath(e2.path)]}(s))))});r.push(t2)}}).next(()=&gt;PersistencePromise.waitFor(r)).next(()=&gt;n.apply(e)).next(()=&gt;i)}removeTarget(e,t){const n=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,n)}updateLimboDocument(e,t){return __PRIVATE_writeSentinelKey(e,t)}wr(e,t){const n=__PRIVATE_documentTargetStore(e);let r,i=__PRIVATE_ListenSequence.ue;return n.X({index:Ae},([e2,n2],{path:s,sequenceNumber:o})=&gt;{0===e2?(i!==__PRIVATE_ListenSequence.ue&amp;&amp;t(new DocumentKey(__PRIVATE_decodeResourcePath(r)),i),i=o,r=s):i=__PRIVATE_ListenSequence.ue}).next(()=&gt;{i!==__PRIVATE_ListenSequence.ue&amp;&amp;t(new DocumentKey(__PRIVATE_decodeResourcePath(r)),i)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function __PRIVATE_writeSentinelKey(e,t){return __PRIVATE_documentTargetStore(e).put(function __PRIVATE_sentinelRow(e2,t2){return{targetId:0,path:__PRIVATE_encodeResourcePath(e2.path),sequenceNumber:t2}}(t,e.currentSequenceNumber))}class RemoteDocumentChangeBuffer{constructor(){this.changes=new ObjectMap(e=&gt;e.toString(),(e,t)=&gt;e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,MutableDocument.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const n=this.changes.get(t);return void 0!==n?PersistencePromise.resolve(n):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class __PRIVATE_IndexedDbRemoteDocumentCacheImpl{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,n){return __PRIVATE_remoteDocumentsStore(e).put(n)}removeEntry(e,t,n){return __PRIVATE_remoteDocumentsStore(e).delete(function __PRIVATE_dbReadTimeKey(e2,t2){const n2=e2.path.toArray();return[n2.slice(0,n2.length-2),n2[n2.length-2],__PRIVATE_toDbTimestampKey(t2),n2[n2.length-1]]}(t,n))}updateMetadata(e,t){return this.getMetadata(e).next(n=&gt;(n.byteSize+=t,this.br(e,n)))}getEntry(e,t){let n=MutableDocument.newInvalidDocument(t);return __PRIVATE_remoteDocumentsStore(e).X({index:_e,range:IDBKeyRange.only(__PRIVATE_dbKey(t))},(e2,r)=&gt;{n=this.Dr(t,r)}).next(()=&gt;n)}vr(e,t){let n={size:0,document:MutableDocument.newInvalidDocument(t)};return __PRIVATE_remoteDocumentsStore(e).X({index:_e,range:IDBKeyRange.only(__PRIVATE_dbKey(t))},(e2,r)=&gt;{n={document:this.Dr(t,r),size:__PRIVATE_dbDocumentSize(r)}}).next(()=&gt;n)}getEntries(e,t){let n=__PRIVATE_mutableDocumentMap();return this.Cr(e,t,(e2,t2)=&gt;{const r=this.Dr(e2,t2);n=n.insert(e2,r)}).next(()=&gt;n)}Fr(e,t){let n=__PRIVATE_mutableDocumentMap(),r=new SortedMap(DocumentKey.comparator);return this.Cr(e,t,(e2,t2)=&gt;{const i=this.Dr(e2,t2);n=n.insert(e2,i),r=r.insert(e2,__PRIVATE_dbDocumentSize(t2))}).next(()=&gt;({documents:n,Mr:r}))}Cr(e,t,n){if(t.isEmpty())return PersistencePromise.resolve();let r=new SortedSet(__PRIVATE_dbKeyComparator);t.forEach(e2=&gt;r=r.add(e2));const i=IDBKeyRange.bound(__PRIVATE_dbKey(r.first()),__PRIVATE_dbKey(r.last())),s=r.getIterator();let o=s.getNext();return __PRIVATE_remoteDocumentsStore(e).X({index:_e,range:i},(e2,t2,r2)=&gt;{const i2=DocumentKey.fromSegments([...t2.prefixPath,t2.collectionGroup,t2.documentId]);for(;o&amp;&amp;__PRIVATE_dbKeyComparator(o,i2)&lt;0;)n(o,null),o=s.getNext();o&amp;&amp;o.isEqual(i2)&amp;&amp;(n(o,t2),o=s.hasNext()?s.getNext():null),o?r2.G(__PRIVATE_dbKey(o)):r2.done()}).next(()=&gt;{for(;o;)n(o,null),o=s.hasNext()?s.getNext():null})}getDocumentsMatchingQuery(e,t,n,r,i){const s=t.path,o=[s.popLast().toArray(),s.lastSegment(),__PRIVATE_toDbTimestampKey(n.readTime),n.documentKey.path.isEmpty()?"":n.documentKey.path.lastSegment()],_=[s.popLast().toArray(),s.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return __PRIVATE_remoteDocumentsStore(e).j(IDBKeyRange.bound(o,_,!0)).next(e2=&gt;{null==i||i.incrementDocumentReadCount(e2.length);let n2=__PRIVATE_mutableDocumentMap();for(const i2 of e2){const e3=this.Dr(DocumentKey.fromSegments(i2.prefixPath.concat(i2.collectionGroup,i2.documentId)),i2);e3.isFoundDocument()&amp;&amp;(__PRIVATE_queryMatches(t,e3)||r.has(e3.key))&amp;&amp;(n2=n2.insert(e3.key,e3))}return n2})}getAllFromCollectionGroup(e,t,n,r){let i=__PRIVATE_mutableDocumentMap();const s=__PRIVATE_dbCollectionGroupKey(t,n),o=__PRIVATE_dbCollectionGroupKey(t,IndexOffset.max());return __PRIVATE_remoteDocumentsStore(e).X({index:ue,range:IDBKeyRange.bound(s,o,!0)},(e2,t2,n2)=&gt;{const s2=this.Dr(DocumentKey.fromSegments(t2.prefixPath.concat(t2.collectionGroup,t2.documentId)),t2);i=i.insert(s2.key,s2),i.size===r&amp;&amp;n2.done()}).next(()=&gt;i)}newChangeBuffer(e){return new __PRIVATE_IndexedDbRemoteDocumentChangeBuffer(this,!!e&amp;&amp;e.trackRemovals)}getSize(e){return this.getMetadata(e).next(e2=&gt;e2.byteSize)}getMetadata(e){return __PRIVATE_documentGlobalStore(e).get(he).next(e2=&gt;(__PRIVATE_hardAssert(!!e2,20021),e2))}br(e,t){return __PRIVATE_documentGlobalStore(e).put(he,t)}Dr(e,t){if(t){const e2=__PRIVATE_fromDbRemoteDocument(this.serializer,t);if(!e2.isNoDocument()||!e2.version.isEqual(SnapshotVersion.min()))return e2}return MutableDocument.newInvalidDocument(e)}}function __PRIVATE_newIndexedDbRemoteDocumentCache(e){return new __PRIVATE_IndexedDbRemoteDocumentCacheImpl(e)}class __PRIVATE_IndexedDbRemoteDocumentChangeBuffer extends RemoteDocumentChangeBuffer{constructor(e,t){super(),this.Or=e,this.trackRemovals=t,this.Nr=new ObjectMap(e2=&gt;e2.toString(),(e2,t2)=&gt;e2.isEqual(t2))}applyChanges(e){const t=[];let n=0,r=new SortedSet((e2,t2)=&gt;__PRIVATE_primitiveComparator(e2.canonicalString(),t2.canonicalString()));return this.changes.forEach((i,s)=&gt;{const o=this.Nr.get(i);if(t.push(this.Or.removeEntry(e,i,o.readTime)),s.isValidDocument()){const _=__PRIVATE_toDbRemoteDocument(this.Or.serializer,s);r=r.add(i.path.popLast());const a=__PRIVATE_dbDocumentSize(_);n+=a-o.size,t.push(this.Or.addEntry(e,i,_))}else if(n-=o.size,this.trackRemovals){const n2=__PRIVATE_toDbRemoteDocument(this.Or.serializer,s.convertToNoDocument(SnapshotVersion.min()));t.push(this.Or.addEntry(e,i,n2))}}),r.forEach(n2=&gt;{t.push(this.Or.indexManager.addToCollectionParentIndex(e,n2))}),t.push(this.Or.updateMetadata(e,n)),PersistencePromise.waitFor(t)}getFromCache(e,t){return this.Or.vr(e,t).next(e2=&gt;(this.Nr.set(t,{size:e2.size,readTime:e2.document.readTime}),e2.document))}getAllFromCache(e,t){return this.Or.Fr(e,t).next(({documents:e2,Mr:t2})=&gt;(t2.forEach((t3,n)=&gt;{this.Nr.set(t3,{size:n,readTime:e2.get(t3).readTime})}),e2))}}function __PRIVATE_documentGlobalStore(e){return __PRIVATE_getStore(e,le)}function __PRIVATE_remoteDocumentsStore(e){return __PRIVATE_getStore(e,se)}function __PRIVATE_dbKey(e){const t=e.path.toArray();return[t.slice(0,t.length-2),t[t.length-2],t[t.length-1]]}function __PRIVATE_dbCollectionGroupKey(e,t){const n=t.documentKey.path.toArray();return[e,__PRIVATE_toDbTimestampKey(t.readTime),n.slice(0,n.length-2),n.length&gt;0?n[n.length-1]:""]}function __PRIVATE_dbKeyComparator(e,t){const n=e.path.toArray(),r=t.path.toArray();let i=0;for(let e2=0;e2&lt;n.length-2&amp;&amp;e2&lt;r.length-2;++e2)if(i=__PRIVATE_primitiveComparator(n[e2],r[e2]),i)return i;return i=__PRIVATE_primitiveComparator(n.length,r.length),i||(i=__PRIVATE_primitiveComparator(n[n.length-2],r[r.length-2]),i||__PRIVATE_primitiveComparator(n[n.length-1],r[r.length-1]))}class OverlayedDocument{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class LocalDocumentsView{constructor(e,t,n,r){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=n,this.indexManager=r}getDocument(e,t){let n=null;return this.documentOverlayCache.getOverlay(e,t).next(r=&gt;(n=r,this.remoteDocumentCache.getEntry(e,t))).next(e2=&gt;(null!==n&amp;&amp;__PRIVATE_mutationApplyToLocalView(n.mutation,e2,FieldMask.empty(),Timestamp.now()),e2))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(t2=&gt;this.getLocalViewOfDocuments(e,t2,__PRIVATE_documentKeySet()).next(()=&gt;t2))}getLocalViewOfDocuments(e,t,n=__PRIVATE_documentKeySet()){const r=__PRIVATE_newOverlayMap();return this.populateOverlays(e,r,t).next(()=&gt;this.computeViews(e,t,r,n).next(e2=&gt;{let t2=documentMap();return e2.forEach((e3,n2)=&gt;{t2=t2.insert(e3,n2.overlayedDocument)}),t2}))}getOverlayedDocuments(e,t){const n=__PRIVATE_newOverlayMap();return this.populateOverlays(e,n,t).next(()=&gt;this.computeViews(e,t,n,__PRIVATE_documentKeySet()))}populateOverlays(e,t,n){const r=[];return n.forEach(e2=&gt;{t.has(e2)||r.push(e2)}),this.documentOverlayCache.getOverlays(e,r).next(e2=&gt;{e2.forEach((e3,n2)=&gt;{t.set(e3,n2)})})}computeViews(e,t,n,r){let i=__PRIVATE_mutableDocumentMap();const s=__PRIVATE_newDocumentKeyMap(),o=function __PRIVATE_newOverlayedDocumentMap(){return __PRIVATE_newDocumentKeyMap()}();return t.forEach((e2,t2)=&gt;{const o2=n.get(t2.key);r.has(t2.key)&amp;&amp;(void 0===o2||o2.mutation instanceof __PRIVATE_PatchMutation)?i=i.insert(t2.key,t2):void 0!==o2?(s.set(t2.key,o2.mutation.getFieldMask()),__PRIVATE_mutationApplyToLocalView(o2.mutation,t2,o2.mutation.getFieldMask(),Timestamp.now())):s.set(t2.key,FieldMask.empty())}),this.recalculateAndSaveOverlays(e,i).next(e2=&gt;(e2.forEach((e3,t2)=&gt;s.set(e3,t2)),t.forEach((e3,t2)=&gt;{var n2;return o.set(e3,new OverlayedDocument(t2,null!==(n2=s.get(e3))&amp;&amp;void 0!==n2?n2:null))}),o))}recalculateAndSaveOverlays(e,t){const n=__PRIVATE_newDocumentKeyMap();let r=new SortedMap((e2,t2)=&gt;e2-t2),i=__PRIVATE_documentKeySet();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(e2=&gt;{for(const i2 of e2)i2.keys().forEach(e3=&gt;{const s=t.get(e3);if(null===s)return;let o=n.get(e3)||FieldMask.empty();o=i2.applyToLocalView(s,o),n.set(e3,o);const _=(r.get(i2.batchId)||__PRIVATE_documentKeySet()).add(e3);r=r.insert(i2.batchId,_)})}).next(()=&gt;{const s=[],o=r.getReverseIterator();for(;o.hasNext();){const r2=o.getNext(),_=r2.key,a=r2.value,u=__PRIVATE_newMutationMap();a.forEach(e2=&gt;{if(!i.has(e2)){const r3=__PRIVATE_calculateOverlayMutation(t.get(e2),n.get(e2));null!==r3&amp;&amp;u.set(e2,r3),i=i.add(e2)}}),s.push(this.documentOverlayCache.saveOverlays(e,_,u))}return PersistencePromise.waitFor(s)}).next(()=&gt;n)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(t2=&gt;this.recalculateAndSaveOverlays(e,t2))}getDocumentsMatchingQuery(e,t,n,r){return function __PRIVATE_isDocumentQuery$1(e2){return DocumentKey.isDocumentKey(e2.path)&amp;&amp;null===e2.collectionGroup&amp;&amp;0===e2.filters.length}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):__PRIVATE_isCollectionGroupQuery(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,n,r):this.getDocumentsMatchingCollectionQuery(e,t,n,r)}getNextDocuments(e,t,n,r){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,n,r).next(i=&gt;{const s=r-i.size&gt;0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,n.largestBatchId,r-i.size):PersistencePromise.resolve(__PRIVATE_newOverlayMap());let o=Q,_=i;return s.next(t2=&gt;PersistencePromise.forEach(t2,(t3,n2)=&gt;(o&lt;n2.largestBatchId&amp;&amp;(o=n2.largestBatchId),i.get(t3)?PersistencePromise.resolve():this.remoteDocumentCache.getEntry(e,t3).next(e2=&gt;{_=_.insert(t3,e2)}))).next(()=&gt;this.populateOverlays(e,t2,i)).next(()=&gt;this.computeViews(e,_,t2,__PRIVATE_documentKeySet())).next(e2=&gt;({batchId:o,changes:__PRIVATE_convertOverlayedDocumentMapToDocumentMap(e2)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new DocumentKey(t)).next(e2=&gt;{let t2=documentMap();return e2.isFoundDocument()&amp;&amp;(t2=t2.insert(e2.key,e2)),t2})}getDocumentsMatchingCollectionGroupQuery(e,t,n,r){const i=t.collectionGroup;let s=documentMap();return this.indexManager.getCollectionParents(e,i).next(o=&gt;PersistencePromise.forEach(o,o2=&gt;{const _=function __PRIVATE_asCollectionQueryAtPath(e2,t2){return new __PRIVATE_QueryImpl(t2,null,e2.explicitOrderBy.slice(),e2.filters.slice(),e2.limit,e2.limitType,e2.startAt,e2.endAt)}(t,o2.child(i));return this.getDocumentsMatchingCollectionQuery(e,_,n,r).next(e2=&gt;{e2.forEach((e3,t2)=&gt;{s=s.insert(e3,t2)})})}).next(()=&gt;s))}getDocumentsMatchingCollectionQuery(e,t,n,r){let i;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,n.largestBatchId).next(s=&gt;(i=s,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,n,i,r))).next(e2=&gt;{i.forEach((t2,n3)=&gt;{const r2=n3.getKey();null===e2.get(r2)&amp;&amp;(e2=e2.insert(r2,MutableDocument.newInvalidDocument(r2)))});let n2=documentMap();return e2.forEach((e3,r2)=&gt;{const s=i.get(e3);void 0!==s&amp;&amp;__PRIVATE_mutationApplyToLocalView(s.mutation,r2,FieldMask.empty(),Timestamp.now()),__PRIVATE_queryMatches(t,r2)&amp;&amp;(n2=n2.insert(e3,r2))}),n2})}}class __PRIVATE_MemoryBundleCache{constructor(e){this.serializer=e,this.Br=new Map,this.Lr=new Map}getBundleMetadata(e,t){return PersistencePromise.resolve(this.Br.get(t))}saveBundleMetadata(e,t){return this.Br.set(t.id,function __PRIVATE_fromBundleMetadata(e2){return{id:e2.id,version:e2.version,createTime:__PRIVATE_fromVersion(e2.createTime)}}(t)),PersistencePromise.resolve()}getNamedQuery(e,t){return PersistencePromise.resolve(this.Lr.get(t))}saveNamedQuery(e,t){return this.Lr.set(t.name,function __PRIVATE_fromProtoNamedQuery(e2){return{name:e2.name,query:__PRIVATE_fromBundledQuery(e2.bundledQuery),readTime:__PRIVATE_fromVersion(e2.readTime)}}(t)),PersistencePromise.resolve()}}class __PRIVATE_MemoryDocumentOverlayCache{constructor(){this.overlays=new SortedMap(DocumentKey.comparator),this.kr=new Map}getOverlay(e,t){return PersistencePromise.resolve(this.overlays.get(t))}getOverlays(e,t){const n=__PRIVATE_newOverlayMap();return PersistencePromise.forEach(t,t2=&gt;this.getOverlay(e,t2).next(e2=&gt;{null!==e2&amp;&amp;n.set(t2,e2)})).next(()=&gt;n)}saveOverlays(e,t,n){return n.forEach((n2,r)=&gt;{this.wt(e,t,r)}),PersistencePromise.resolve()}removeOverlaysForBatchId(e,t,n){const r=this.kr.get(n);return void 0!==r&amp;&amp;(r.forEach(e2=&gt;this.overlays=this.overlays.remove(e2)),this.kr.delete(n)),PersistencePromise.resolve()}getOverlaysForCollection(e,t,n){const r=__PRIVATE_newOverlayMap(),i=t.length+1,s=new DocumentKey(t.child("")),o=this.overlays.getIteratorFrom(s);for(;o.hasNext();){const e2=o.getNext().value,s2=e2.getKey();if(!t.isPrefixOf(s2.path))break;s2.path.length===i&amp;&amp;e2.largestBatchId&gt;n&amp;&amp;r.set(e2.getKey(),e2)}return PersistencePromise.resolve(r)}getOverlaysForCollectionGroup(e,t,n,r){let i=new SortedMap((e2,t2)=&gt;e2-t2);const s=this.overlays.getIterator();for(;s.hasNext();){const e2=s.getNext().value;if(e2.getKey().getCollectionGroup()===t&amp;&amp;e2.largestBatchId&gt;n){let t2=i.get(e2.largestBatchId);null===t2&amp;&amp;(t2=__PRIVATE_newOverlayMap(),i=i.insert(e2.largestBatchId,t2)),t2.set(e2.getKey(),e2)}}const o=__PRIVATE_newOverlayMap(),_=i.getIterator();for(;_.hasNext()&amp;&amp;(_.getNext().value.forEach((e2,t2)=&gt;o.set(e2,t2)),!(o.size()&gt;=r)););return PersistencePromise.resolve(o)}wt(e,t,n){const r=this.overlays.get(n.key);if(null!==r){const e2=this.kr.get(r.largestBatchId).delete(n.key);this.kr.set(r.largestBatchId,e2)}this.overlays=this.overlays.insert(n.key,new Overlay(t,n));let i=this.kr.get(t);void 0===i&amp;&amp;(i=__PRIVATE_documentKeySet(),this.kr.set(t,i)),this.kr.set(t,i.add(n.key))}}class __PRIVATE_MemoryGlobalsCache{constructor(){this.sessionToken=ByteString.EMPTY_BYTE_STRING}getSessionToken(e){return PersistencePromise.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,PersistencePromise.resolve()}}class __PRIVATE_ReferenceSet{constructor(){this.qr=new SortedSet(__PRIVATE_DocReference.Qr),this.$r=new SortedSet(__PRIVATE_DocReference.Ur)}isEmpty(){return this.qr.isEmpty()}addReference(e,t){const n=new __PRIVATE_DocReference(e,t);this.qr=this.qr.add(n),this.$r=this.$r.add(n)}Kr(e,t){e.forEach(e2=&gt;this.addReference(e2,t))}removeReference(e,t){this.Wr(new __PRIVATE_DocReference(e,t))}Gr(e,t){e.forEach(e2=&gt;this.removeReference(e2,t))}zr(e){const t=new DocumentKey(new ResourcePath([])),n=new __PRIVATE_DocReference(t,e),r=new __PRIVATE_DocReference(t,e+1),i=[];return this.$r.forEachInRange([n,r],e2=&gt;{this.Wr(e2),i.push(e2.key)}),i}jr(){this.qr.forEach(e=&gt;this.Wr(e))}Wr(e){this.qr=this.qr.delete(e),this.$r=this.$r.delete(e)}Jr(e){const t=new DocumentKey(new ResourcePath([])),n=new __PRIVATE_DocReference(t,e),r=new __PRIVATE_DocReference(t,e+1);let i=__PRIVATE_documentKeySet();return this.$r.forEachInRange([n,r],e2=&gt;{i=i.add(e2.key)}),i}containsKey(e){const t=new __PRIVATE_DocReference(e,0),n=this.qr.firstAfterOrEqual(t);return null!==n&amp;&amp;e.isEqual(n.key)}}class __PRIVATE_DocReference{constructor(e,t){this.key=e,this.Hr=t}static Qr(e,t){return DocumentKey.comparator(e.key,t.key)||__PRIVATE_primitiveComparator(e.Hr,t.Hr)}static Ur(e,t){return __PRIVATE_primitiveComparator(e.Hr,t.Hr)||DocumentKey.comparator(e.key,t.key)}}class __PRIVATE_MemoryMutationQueue{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.er=1,this.Yr=new SortedSet(__PRIVATE_DocReference.Qr)}checkEmpty(e){return PersistencePromise.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,n,r){const i=this.er;this.er++,this.mutationQueue.length&gt;0&amp;&amp;this.mutationQueue[this.mutationQueue.length-1];const s=new MutationBatch(i,t,n,r);this.mutationQueue.push(s);for(const t2 of r)this.Yr=this.Yr.add(new __PRIVATE_DocReference(t2.key,i)),this.indexManager.addToCollectionParentIndex(e,t2.key.path.popLast());return PersistencePromise.resolve(s)}lookupMutationBatch(e,t){return PersistencePromise.resolve(this.Zr(t))}getNextMutationBatchAfterBatchId(e,t){const n=t+1,r=this.Xr(n),i=r&lt;0?0:r;return PersistencePromise.resolve(this.mutationQueue.length&gt;i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return PersistencePromise.resolve(0===this.mutationQueue.length?G:this.er-1)}getAllMutationBatches(e){return PersistencePromise.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const n=new __PRIVATE_DocReference(t,0),r=new __PRIVATE_DocReference(t,Number.POSITIVE_INFINITY),i=[];return this.Yr.forEachInRange([n,r],e2=&gt;{const t2=this.Zr(e2.Hr);i.push(t2)}),PersistencePromise.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new SortedSet(__PRIVATE_primitiveComparator);return t.forEach(e2=&gt;{const t2=new __PRIVATE_DocReference(e2,0),r=new __PRIVATE_DocReference(e2,Number.POSITIVE_INFINITY);this.Yr.forEachInRange([t2,r],e3=&gt;{n=n.add(e3.Hr)})}),PersistencePromise.resolve(this.ei(n))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,r=n.length+1;let i=n;DocumentKey.isDocumentKey(i)||(i=i.child(""));const s=new __PRIVATE_DocReference(new DocumentKey(i),0);let o=new SortedSet(__PRIVATE_primitiveComparator);return this.Yr.forEachWhile(e2=&gt;{const t2=e2.key.path;return!!n.isPrefixOf(t2)&amp;&amp;(t2.length===r&amp;&amp;(o=o.add(e2.Hr)),!0)},s),PersistencePromise.resolve(this.ei(o))}ei(e){const t=[];return e.forEach(e2=&gt;{const n=this.Zr(e2);null!==n&amp;&amp;t.push(n)}),t}removeMutationBatch(e,t){__PRIVATE_hardAssert(0===this.ti(t.batchId,"removed"),55003),this.mutationQueue.shift();let n=this.Yr;return PersistencePromise.forEach(t.mutations,r=&gt;{const i=new __PRIVATE_DocReference(r.key,t.batchId);return n=n.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,r.key)}).next(()=&gt;{this.Yr=n})}rr(e){}containsKey(e,t){const n=new __PRIVATE_DocReference(t,0),r=this.Yr.firstAfterOrEqual(n);return PersistencePromise.resolve(t.isEqual(r&amp;&amp;r.key))}performConsistencyCheck(e){return this.mutationQueue.length,PersistencePromise.resolve()}ti(e,t){return this.Xr(e)}Xr(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}Zr(e){const t=this.Xr(e);return t&lt;0||t&gt;=this.mutationQueue.length?null:this.mutationQueue[t]}}class __PRIVATE_MemoryRemoteDocumentCacheImpl{constructor(e){this.ni=e,this.docs=function __PRIVATE_documentEntryMap(){return new SortedMap(DocumentKey.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const n=t.key,r=this.docs.get(n),i=r?r.size:0,s=this.ni(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:s}),this.size+=s-i,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&amp;&amp;(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const n=this.docs.get(t);return PersistencePromise.resolve(n?n.document.mutableCopy():MutableDocument.newInvalidDocument(t))}getEntries(e,t){let n=__PRIVATE_mutableDocumentMap();return t.forEach(e2=&gt;{const t2=this.docs.get(e2);n=n.insert(e2,t2?t2.document.mutableCopy():MutableDocument.newInvalidDocument(e2))}),PersistencePromise.resolve(n)}getDocumentsMatchingQuery(e,t,n,r){let i=__PRIVATE_mutableDocumentMap();const s=t.path,o=new DocumentKey(s.child("__id-9223372036854775808__")),_=this.docs.getIteratorFrom(o);for(;_.hasNext();){const{key:e2,value:{document:o2}}=_.getNext();if(!s.isPrefixOf(e2.path))break;e2.path.length&gt;s.length+1||__PRIVATE_indexOffsetComparator(__PRIVATE_newIndexOffsetFromDocument(o2),n)&lt;=0||(r.has(o2.key)||__PRIVATE_queryMatches(t,o2))&amp;&amp;(i=i.insert(o2.key,o2.mutableCopy()))}return PersistencePromise.resolve(i)}getAllFromCollectionGroup(e,t,n,r){fail(9500)}ri(e,t){return PersistencePromise.forEach(this.docs,e2=&gt;t(e2))}newChangeBuffer(e){return new __PRIVATE_MemoryRemoteDocumentChangeBuffer(this)}getSize(e){return PersistencePromise.resolve(this.size)}}class __PRIVATE_MemoryRemoteDocumentChangeBuffer extends RemoteDocumentChangeBuffer{constructor(e){super(),this.Or=e}applyChanges(e){const t=[];return this.changes.forEach((n,r)=&gt;{r.isValidDocument()?t.push(this.Or.addEntry(e,r)):this.Or.removeEntry(n)}),PersistencePromise.waitFor(t)}getFromCache(e,t){return this.Or.getEntry(e,t)}getAllFromCache(e,t){return this.Or.getEntries(e,t)}}class __PRIVATE_MemoryTargetCache{constructor(e){this.persistence=e,this.ii=new ObjectMap(e2=&gt;__PRIVATE_canonifyTarget(e2),__PRIVATE_targetEquals),this.lastRemoteSnapshotVersion=SnapshotVersion.min(),this.highestTargetId=0,this.si=0,this.oi=new __PRIVATE_ReferenceSet,this.targetCount=0,this._i=__PRIVATE_TargetIdGenerator.ar()}forEachTarget(e,t){return this.ii.forEach((e2,n)=&gt;t(n)),PersistencePromise.resolve()}getLastRemoteSnapshotVersion(e){return PersistencePromise.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return PersistencePromise.resolve(this.si)}allocateTargetId(e){return this.highestTargetId=this._i.next(),PersistencePromise.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&amp;&amp;(this.lastRemoteSnapshotVersion=n),t&gt;this.si&amp;&amp;(this.si=t),PersistencePromise.resolve()}hr(e){this.ii.set(e.target,e);const t=e.targetId;t&gt;this.highestTargetId&amp;&amp;(this._i=new __PRIVATE_TargetIdGenerator(t),this.highestTargetId=t),e.sequenceNumber&gt;this.si&amp;&amp;(this.si=e.sequenceNumber)}addTargetData(e,t){return this.hr(t),this.targetCount+=1,PersistencePromise.resolve()}updateTargetData(e,t){return this.hr(t),PersistencePromise.resolve()}removeTargetData(e,t){return this.ii.delete(t.target),this.oi.zr(t.targetId),this.targetCount-=1,PersistencePromise.resolve()}removeTargets(e,t,n){let r=0;const i=[];return this.ii.forEach((s,o)=&gt;{o.sequenceNumber&lt;=t&amp;&amp;null===n.get(o.targetId)&amp;&amp;(this.ii.delete(s),i.push(this.removeMatchingKeysForTargetId(e,o.targetId)),r++)}),PersistencePromise.waitFor(i).next(()=&gt;r)}getTargetCount(e){return PersistencePromise.resolve(this.targetCount)}getTargetData(e,t){const n=this.ii.get(t)||null;return PersistencePromise.resolve(n)}addMatchingKeys(e,t,n){return this.oi.Kr(t,n),PersistencePromise.resolve()}removeMatchingKeys(e,t,n){this.oi.Gr(t,n);const r=this.persistence.referenceDelegate,i=[];return r&amp;&amp;t.forEach(t2=&gt;{i.push(r.markPotentiallyOrphaned(e,t2))}),PersistencePromise.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this.oi.zr(t),PersistencePromise.resolve()}getMatchingKeysForTargetId(e,t){const n=this.oi.Jr(t);return PersistencePromise.resolve(n)}containsKey(e,t){return PersistencePromise.resolve(this.oi.containsKey(t))}}class __PRIVATE_MemoryPersistence{constructor(e,t){this.ai={},this.overlays={},this.ui=new __PRIVATE_ListenSequence(0),this.ci=!1,this.ci=!0,this.li=new __PRIVATE_MemoryGlobalsCache,this.referenceDelegate=e(this),this.hi=new __PRIVATE_MemoryTargetCache(this),this.indexManager=new __PRIVATE_MemoryIndexManager,this.remoteDocumentCache=function __PRIVATE_newMemoryRemoteDocumentCache(e2){return new __PRIVATE_MemoryRemoteDocumentCacheImpl(e2)}(e2=&gt;this.referenceDelegate.Pi(e2)),this.serializer=new __PRIVATE_LocalSerializer(t),this.Ti=new __PRIVATE_MemoryBundleCache(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.ci=!1,Promise.resolve()}get started(){return this.ci}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new __PRIVATE_MemoryDocumentOverlayCache,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let n=this.ai[e.toKey()];return n||(n=new __PRIVATE_MemoryMutationQueue(t,this.referenceDelegate),this.ai[e.toKey()]=n),n}getGlobalsCache(){return this.li}getTargetCache(){return this.hi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ti}runTransaction(e,t,n){__PRIVATE_logDebug("MemoryPersistence","Starting transaction:",e);const r=new __PRIVATE_MemoryTransaction(this.ui.next());return this.referenceDelegate.Ii(),n(r).next(e2=&gt;this.referenceDelegate.di(r).next(()=&gt;e2)).toPromise().then(e2=&gt;(r.raiseOnCommittedEvent(),e2))}Ei(e,t){return PersistencePromise.or(Object.values(this.ai).map(n=&gt;()=&gt;n.containsKey(e,t)))}}class __PRIVATE_MemoryTransaction extends PersistenceTransaction{constructor(e){super(),this.currentSequenceNumber=e}}class __PRIVATE_MemoryEagerDelegate{constructor(e){this.persistence=e,this.Ai=new __PRIVATE_ReferenceSet,this.Ri=null}static Vi(e){return new __PRIVATE_MemoryEagerDelegate(e)}get mi(){if(this.Ri)return this.Ri;throw fail(60996)}addReference(e,t,n){return this.Ai.addReference(n,t),this.mi.delete(n.toString()),PersistencePromise.resolve()}removeReference(e,t,n){return this.Ai.removeReference(n,t),this.mi.add(n.toString()),PersistencePromise.resolve()}markPotentiallyOrphaned(e,t){return this.mi.add(t.toString()),PersistencePromise.resolve()}removeTarget(e,t){this.Ai.zr(t.targetId).forEach(e2=&gt;this.mi.add(e2.toString()));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next(e2=&gt;{e2.forEach(e3=&gt;this.mi.add(e3.toString()))}).next(()=&gt;n.removeTargetData(e,t))}Ii(){this.Ri=new Set}di(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return PersistencePromise.forEach(this.mi,n=&gt;{const r=DocumentKey.fromPath(n);return this.fi(e,r).next(e2=&gt;{e2||t.removeEntry(r,SnapshotVersion.min())})}).next(()=&gt;(this.Ri=null,t.apply(e)))}updateLimboDocument(e,t){return this.fi(e,t).next(e2=&gt;{e2?this.mi.delete(t.toString()):this.mi.add(t.toString())})}Pi(e){return 0}fi(e,t){return PersistencePromise.or([()=&gt;PersistencePromise.resolve(this.Ai.containsKey(t)),()=&gt;this.persistence.getTargetCache().containsKey(e,t),()=&gt;this.persistence.Ei(e,t)])}}class __PRIVATE_MemoryLruDelegate{constructor(e,t){this.persistence=e,this.gi=new ObjectMap(e2=&gt;__PRIVATE_encodeResourcePath(e2.path),(e2,t2)=&gt;e2.isEqual(t2)),this.garbageCollector=__PRIVATE_newLruGarbageCollector(this,t)}static Vi(e,t){return new __PRIVATE_MemoryLruDelegate(e,t)}Ii(){}di(e){return PersistencePromise.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}mr(e){const t=this.yr(e);return this.persistence.getTargetCache().getTargetCount(e).next(e2=&gt;t.next(t2=&gt;e2+t2))}yr(e){let t=0;return this.gr(e,e2=&gt;{t++}).next(()=&gt;t)}gr(e,t){return PersistencePromise.forEach(this.gi,(n,r)=&gt;this.Sr(e,n,r).next(e2=&gt;e2?PersistencePromise.resolve():t(r)))}removeTargets(e,t,n){return this.persistence.getTargetCache().removeTargets(e,t,n)}removeOrphanedDocuments(e,t){let n=0;const r=this.persistence.getRemoteDocumentCache(),i=r.newChangeBuffer();return r.ri(e,r2=&gt;this.Sr(e,r2,t).next(e2=&gt;{e2||(n++,i.removeEntry(r2,SnapshotVersion.min()))})).next(()=&gt;i.apply(e)).next(()=&gt;n)}markPotentiallyOrphaned(e,t){return this.gi.set(t,e.currentSequenceNumber),PersistencePromise.resolve()}removeTarget(e,t){const n=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,n)}addReference(e,t,n){return this.gi.set(n,e.currentSequenceNumber),PersistencePromise.resolve()}removeReference(e,t,n){return this.gi.set(n,e.currentSequenceNumber),PersistencePromise.resolve()}updateLimboDocument(e,t){return this.gi.set(t,e.currentSequenceNumber),PersistencePromise.resolve()}Pi(e){let t=e.key.toString().length;return e.isFoundDocument()&amp;&amp;(t+=__PRIVATE_estimateByteSize(e.data.value)),t}Sr(e,t,n){return PersistencePromise.or([()=&gt;this.persistence.Ei(e,t),()=&gt;this.persistence.getTargetCache().containsKey(e,t),()=&gt;{const e2=this.gi.get(t);return PersistencePromise.resolve(void 0!==e2&amp;&amp;e2&gt;n)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}class __PRIVATE_SchemaConverter{constructor(e){this.serializer=e}q(e,t,n,r){const i=new __PRIVATE_SimpleDbTransaction("createOrUpgrade",t);n&lt;1&amp;&amp;r&gt;=1&amp;&amp;(function __PRIVATE_createPrimaryClientStore(e2){e2.createObjectStore(J)}(e),function __PRIVATE_createMutationQueue(e2){e2.createObjectStore(Y,{keyPath:"userId"});e2.createObjectStore(X,{keyPath:ee,autoIncrement:!0}).createIndex(te,ne,{unique:!0}),e2.createObjectStore(ie)}(e),__PRIVATE_createQueryCache(e),function __PRIVATE_createLegacyRemoteDocumentCache(e2){e2.createObjectStore(j)}(e));let s=PersistencePromise.resolve();return n&lt;3&amp;&amp;r&gt;=3&amp;&amp;(0!==n&amp;&amp;(function __PRIVATE_dropQueryCache(e2){e2.deleteObjectStore(de),e2.deleteObjectStore(Pe),e2.deleteObjectStore(me)}(e),__PRIVATE_createQueryCache(e)),s=s.next(()=&gt;function __PRIVATE_writeEmptyTargetGlobalEntry(e2){const t2=e2.store(me),n2={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:SnapshotVersion.min().toTimestamp(),targetCount:0};return t2.put(Ve,n2)}(i))),n&lt;4&amp;&amp;r&gt;=4&amp;&amp;(0!==n&amp;&amp;(s=s.next(()=&gt;function __PRIVATE_upgradeMutationBatchSchemaAndMigrateData(e2,t2){return t2.store(X).j().next(n3=&gt;{e2.deleteObjectStore(X),e2.createObjectStore(X,{keyPath:ee,autoIncrement:!0}).createIndex(te,ne,{unique:!0});const r2=t2.store(X),i2=n3.map(e3=&gt;r2.put(e3));return PersistencePromise.waitFor(i2)})}(e,i))),s=s.next(()=&gt;{!function __PRIVATE_createClientMetadataStore(e2){e2.createObjectStore(pe,{keyPath:"clientId"})}(e)})),n&lt;5&amp;&amp;r&gt;=5&amp;&amp;(s=s.next(()=&gt;this.pi(i))),n&lt;6&amp;&amp;r&gt;=6&amp;&amp;(s=s.next(()=&gt;(function __PRIVATE_createDocumentGlobalStore(e2){e2.createObjectStore(le)}(e),this.yi(i)))),n&lt;7&amp;&amp;r&gt;=7&amp;&amp;(s=s.next(()=&gt;this.wi(i))),n&lt;8&amp;&amp;r&gt;=8&amp;&amp;(s=s.next(()=&gt;this.Si(e,i))),n&lt;9&amp;&amp;r&gt;=9&amp;&amp;(s=s.next(()=&gt;{!function __PRIVATE_dropRemoteDocumentChangesStore(e2){e2.objectStoreNames.contains("remoteDocumentChanges")&amp;&amp;e2.deleteObjectStore("remoteDocumentChanges")}(e)})),n&lt;10&amp;&amp;r&gt;=10&amp;&amp;(s=s.next(()=&gt;this.bi(i))),n&lt;11&amp;&amp;r&gt;=11&amp;&amp;(s=s.next(()=&gt;{!function __PRIVATE_createBundlesStore(e2){e2.createObjectStore(we,{keyPath:"bundleId"})}(e),function __PRIVATE_createNamedQueriesStore(e2){e2.createObjectStore(be,{keyPath:"name"})}(e)})),n&lt;12&amp;&amp;r&gt;=12&amp;&amp;(s=s.next(()=&gt;{!function __PRIVATE_createDocumentOverlayStore(e2){const t2=e2.createObjectStore($e,{keyPath:Ue});t2.createIndex(Ke,We,{unique:!1}),t2.createIndex(Ge,ze,{unique:!1})}(e)})),n&lt;13&amp;&amp;r&gt;=13&amp;&amp;(s=s.next(()=&gt;function __PRIVATE_createRemoteDocumentCache(e2){const t2=e2.createObjectStore(se,{keyPath:oe});t2.createIndex(_e,ae),t2.createIndex(ue,ce)}(e)).next(()=&gt;this.Di(e,i)).next(()=&gt;e.deleteObjectStore(j))),n&lt;14&amp;&amp;r&gt;=14&amp;&amp;(s=s.next(()=&gt;this.Ci(e,i))),n&lt;15&amp;&amp;r&gt;=15&amp;&amp;(s=s.next(()=&gt;function __PRIVATE_createFieldIndex(e2){e2.createObjectStore(ve,{keyPath:"indexId",autoIncrement:!0}).createIndex(Fe,"collectionGroup",{unique:!1});e2.createObjectStore(xe,{keyPath:Oe}).createIndex(Ne,Be,{unique:!1});e2.createObjectStore(Le,{keyPath:ke}).createIndex(qe,Qe,{unique:!1})}(e))),n&lt;16&amp;&amp;r&gt;=16&amp;&amp;(s=s.next(()=&gt;{t.objectStore(xe).clear()}).next(()=&gt;{t.objectStore(Le).clear()})),n&lt;17&amp;&amp;r&gt;=17&amp;&amp;(s=s.next(()=&gt;{!function __PRIVATE_createGlobalsStore(e2){e2.createObjectStore(je,{keyPath:"name"})}(e)})),n&lt;18&amp;&amp;r&gt;=18&amp;&amp;isSafariOrWebkit()&amp;&amp;(s=s.next(()=&gt;{t.objectStore(xe).clear()}).next(()=&gt;{t.objectStore(Le).clear()})),s}yi(e){let t=0;return e.store(j).X((e2,n)=&gt;{t+=__PRIVATE_dbDocumentSize(n)}).next(()=&gt;{const n={byteSize:t};return e.store(le).put(he,n)})}pi(e){const t=e.store(Y),n=e.store(X);return t.j().next(t2=&gt;PersistencePromise.forEach(t2,t3=&gt;{const r=IDBKeyRange.bound([t3.userId,G],[t3.userId,t3.lastAcknowledgedBatchId]);return n.j(te,r).next(n2=&gt;PersistencePromise.forEach(n2,n3=&gt;{__PRIVATE_hardAssert(n3.userId===t3.userId,18650,"Cannot process batch from unexpected user",{batchId:n3.batchId});const r2=__PRIVATE_fromDbMutationBatch(this.serializer,n3);return removeMutationBatch(e,t3.userId,r2).next(()=&gt;{})}))}))}wi(e){const t=e.store(de),n=e.store(j);return e.store(me).get(Ve).next(e2=&gt;{const r=[];return n.X((n2,i)=&gt;{const s=new ResourcePath(n2),o=function __PRIVATE_sentinelKey(e3){return[0,__PRIVATE_encodeResourcePath(e3)]}(s);r.push(t.get(o).next(n3=&gt;{return n3?PersistencePromise.resolve():(n4=s,t.put({targetId:0,path:__PRIVATE_encodeResourcePath(n4),sequenceNumber:e2.highestListenSequenceNumber}));var n4}))}).next(()=&gt;PersistencePromise.waitFor(r))})}Si(e,t){e.createObjectStore(fe,{keyPath:ge});const n=t.store(fe),r=new __PRIVATE_MemoryCollectionParentIndex,addEntry=e2=&gt;{if(r.add(e2)){const t2=e2.lastSegment(),r2=e2.popLast();return n.put({collectionId:t2,parent:__PRIVATE_encodeResourcePath(r2)})}};return t.store(j).X({Z:!0},(e2,t2)=&gt;{const n2=new ResourcePath(e2);return addEntry(n2.popLast())}).next(()=&gt;t.store(ie).X({Z:!0},([e2,t2,n2],r2)=&gt;{const i=__PRIVATE_decodeResourcePath(t2);return addEntry(i.popLast())}))}bi(e){const t=e.store(Pe);return t.X((e2,n)=&gt;{const r=__PRIVATE_fromDbTarget(n),i=__PRIVATE_toDbTarget(this.serializer,r);return t.put(i)})}Di(e,t){const n=t.store(j),r=[];return n.X((e2,n2)=&gt;{const i=t.store(se),s=function __PRIVATE_extractKey(e3){return e3.document?new DocumentKey(ResourcePath.fromString(e3.document.name).popFirst(5)):e3.noDocument?DocumentKey.fromSegments(e3.noDocument.path):e3.unknownDocument?DocumentKey.fromSegments(e3.unknownDocument.path):fail(36783)}(n2).path.toArray(),o={prefixPath:s.slice(0,s.length-2),collectionGroup:s[s.length-2],documentId:s[s.length-1],readTime:n2.readTime||[0,0],unknownDocument:n2.unknownDocument,noDocument:n2.noDocument,document:n2.document,hasCommittedMutations:!!n2.hasCommittedMutations};r.push(i.put(o))}).next(()=&gt;PersistencePromise.waitFor(r))}Ci(e,t){const n=t.store(X),r=__PRIVATE_newIndexedDbRemoteDocumentCache(this.serializer),i=new __PRIVATE_MemoryPersistence(__PRIVATE_MemoryEagerDelegate.Vi,this.serializer.gt);return n.j().next(e2=&gt;{const n2=new Map;return e2.forEach(e3=&gt;{var t2;let r2=null!==(t2=n2.get(e3.userId))&amp;&amp;void 0!==t2?t2:__PRIVATE_documentKeySet();__PRIVATE_fromDbMutationBatch(this.serializer,e3).keys().forEach(e4=&gt;r2=r2.add(e4)),n2.set(e3.userId,r2)}),PersistencePromise.forEach(n2,(e3,n3)=&gt;{const s=new User(n3),o=__PRIVATE_IndexedDbDocumentOverlayCache.yt(this.serializer,s),_=i.getIndexManager(s),a=__PRIVATE_IndexedDbMutationQueue.yt(s,this.serializer,_,i.referenceDelegate);return new LocalDocumentsView(r,a,o,_).recalculateAndSaveOverlaysForDocumentKeys(new __PRIVATE_IndexedDbTransaction(t,__PRIVATE_ListenSequence.ue),e3).next()})})}}function __PRIVATE_createQueryCache(e){e.createObjectStore(de,{keyPath:Ee}).createIndex(Ae,Re,{unique:!0}),e.createObjectStore(Pe,{keyPath:"targetId"}).createIndex(Te,Ie,{unique:!0}),e.createObjectStore(me)}const Nt="IndexedDbPersistence",Bt=18e5,kt="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class __PRIVATE_IndexedDbPersistence{constructor(e,t,n,r,i,s,o,_,a,u,c=18){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=n,this.Fi=i,this.window=s,this.document=o,this.Mi=a,this.xi=u,this.Oi=c,this.ui=null,this.ci=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Ni=null,this.inForeground=!1,this.Bi=null,this.Li=null,this.ki=Number.NEGATIVE_INFINITY,this.qi=e2=&gt;Promise.resolve(),!__PRIVATE_IndexedDbPersistence.C())throw new FirestoreError(N.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new __PRIVATE_IndexedDbLruDelegateImpl(this,r),this.Qi=t+"main",this.serializer=new __PRIVATE_LocalSerializer(_),this.$i=new __PRIVATE_SimpleDb(this.Qi,this.Oi,new __PRIVATE_SchemaConverter(this.serializer)),this.li=new __PRIVATE_IndexedDbGlobalsCache,this.hi=new __PRIVATE_IndexedDbTargetCache(this.referenceDelegate,this.serializer),this.remoteDocumentCache=__PRIVATE_newIndexedDbRemoteDocumentCache(this.serializer),this.Ti=new __PRIVATE_IndexedDbBundleCache,this.window&amp;&amp;this.window.localStorage?this.Ui=this.window.localStorage:(this.Ui=null,!1===u&amp;&amp;__PRIVATE_logError(Nt,"LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.Ki().then(()=&gt;{if(!this.isPrimary&amp;&amp;!this.allowTabSynchronization)throw new FirestoreError(N.FAILED_PRECONDITION,kt);return this.Wi(),this.Gi(),this.zi(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=&gt;this.hi.getHighestSequenceNumber(e))}).then(e=&gt;{this.ui=new __PRIVATE_ListenSequence(e,this.Mi)}).then(()=&gt;{this.ci=!0}).catch(e=&gt;(this.$i&amp;&amp;this.$i.close(),Promise.reject(e)))}ji(e){return this.qi=async t=&gt;{if(this.started)return e(t)},e(this.isPrimary)}setDatabaseDeletedListener(e){this.$i.setDatabaseDeletedListener(e)}setNetworkEnabled(e){this.networkEnabled!==e&amp;&amp;(this.networkEnabled=e,this.Fi.enqueueAndForget(async()=&gt;{this.started&amp;&amp;await this.Ki()}))}Ki(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=&gt;__PRIVATE_clientMetadataStore(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=&gt;{if(this.isPrimary)return this.Ji(e).next(e2=&gt;{e2||(this.isPrimary=!1,this.Fi.enqueueRetryable(()=&gt;this.qi(!1)))})}).next(()=&gt;this.Hi(e)).next(t=&gt;this.isPrimary&amp;&amp;!t?this.Yi(e).next(()=&gt;!1):!!t&amp;&amp;this.Zi(e).next(()=&gt;!0))).catch(e=&gt;{if(__PRIVATE_isIndexedDbTransactionError(e))return __PRIVATE_logDebug(Nt,"Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return __PRIVATE_logDebug(Nt,"Releasing owner lease after error during lease refresh",e),!1}).then(e=&gt;{this.isPrimary!==e&amp;&amp;this.Fi.enqueueRetryable(()=&gt;this.qi(e)),this.isPrimary=e})}Ji(e){return __PRIVATE_primaryClientStore(e).get(H).next(e2=&gt;PersistencePromise.resolve(this.Xi(e2)))}es(e){return __PRIVATE_clientMetadataStore(e).delete(this.clientId)}async ts(){if(this.isPrimary&amp;&amp;!this.ns(this.ki,Bt)){this.ki=Date.now();const e=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",e2=&gt;{const t=__PRIVATE_getStore(e2,pe);return t.j().next(e3=&gt;{const n=this.rs(e3,Bt),r=e3.filter(e4=&gt;-1===n.indexOf(e4));return PersistencePromise.forEach(r,e4=&gt;t.delete(e4.clientId)).next(()=&gt;r)})}).catch(()=&gt;[]);if(this.Ui)for(const t of e)this.Ui.removeItem(this.ss(t.clientId))}}zi(){this.Li=this.Fi.enqueueAfterDelay("client_metadata_refresh",4e3,()=&gt;this.Ki().then(()=&gt;this.ts()).then(()=&gt;this.zi()))}Xi(e){return!!e&amp;&amp;e.ownerId===this.clientId}Hi(e){return this.xi?PersistencePromise.resolve(!0):__PRIVATE_primaryClientStore(e).get(H).next(t=&gt;{if(null!==t&amp;&amp;this.ns(t.leaseTimestampMs,5e3)&amp;&amp;!this._s(t.ownerId)){if(this.Xi(t)&amp;&amp;this.networkEnabled)return!0;if(!this.Xi(t)){if(!t.allowTabSynchronization)throw new FirestoreError(N.FAILED_PRECONDITION,kt);return!1}}return!(!this.networkEnabled||!this.inForeground)||__PRIVATE_clientMetadataStore(e).j().next(e2=&gt;void 0===this.rs(e2,5e3).find(e3=&gt;{if(this.clientId!==e3.clientId){const t2=!this.networkEnabled&amp;&amp;e3.networkEnabled,n=!this.inForeground&amp;&amp;e3.inForeground,r=this.networkEnabled===e3.networkEnabled;if(t2||n&amp;&amp;r)return!0}return!1}))}).next(e2=&gt;(this.isPrimary!==e2&amp;&amp;__PRIVATE_logDebug(Nt,`Client ${e2?"is":"is not"} eligible for a primary lease.`),e2))}async shutdown(){this.ci=!1,this.us(),this.Li&amp;&amp;(this.Li.cancel(),this.Li=null),this.cs(),this.ls(),await this.$i.runTransaction("shutdown","readwrite",[J,pe],e=&gt;{const t=new __PRIVATE_IndexedDbTransaction(e,__PRIVATE_ListenSequence.ue);return this.Yi(t).next(()=&gt;this.es(t))}),this.$i.close(),this.hs()}rs(e,t){return e.filter(e2=&gt;this.ns(e2.updateTimeMs,t)&amp;&amp;!this._s(e2.clientId))}Ps(){return this.runTransaction("getActiveClients","readonly",e=&gt;__PRIVATE_clientMetadataStore(e).j().next(e2=&gt;this.rs(e2,Bt).map(e3=&gt;e3.clientId)))}get started(){return this.ci}getGlobalsCache(){return this.li}getMutationQueue(e,t){return __PRIVATE_IndexedDbMutationQueue.yt(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.hi}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new __PRIVATE_IndexedDbIndexManager(e,this.serializer.gt.databaseId)}getDocumentOverlayCache(e){return __PRIVATE_IndexedDbDocumentOverlayCache.yt(this.serializer,e)}getBundleCache(){return this.Ti}runTransaction(e,t,n){__PRIVATE_logDebug(Nt,"Starting transaction:",e);const r="readonly"===t?"readonly":"readwrite",i=function __PRIVATE_getObjectStores(e2){return 18===e2?rt:17===e2?nt:16===e2?tt:15===e2?et:14===e2?Xe:13===e2?Ze:12===e2?Ye:11===e2?He:void fail(60245)}(this.Oi);let s;return this.$i.runTransaction(e,r,i,r2=&gt;(s=new __PRIVATE_IndexedDbTransaction(r2,this.ui?this.ui.next():__PRIVATE_ListenSequence.ue),"readwrite-primary"===t?this.Ji(s).next(e2=&gt;!!e2||this.Hi(s)).next(t2=&gt;{if(!t2)throw __PRIVATE_logError(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.Fi.enqueueRetryable(()=&gt;this.qi(!1)),new FirestoreError(N.FAILED_PRECONDITION,$);return n(s)}).next(e2=&gt;this.Zi(s).next(()=&gt;e2)):this.Ts(s).next(()=&gt;n(s)))).then(e2=&gt;(s.raiseOnCommittedEvent(),e2))}Ts(e){return __PRIVATE_primaryClientStore(e).get(H).next(e2=&gt;{if(null!==e2&amp;&amp;this.ns(e2.leaseTimestampMs,5e3)&amp;&amp;!this._s(e2.ownerId)&amp;&amp;!this.Xi(e2)&amp;&amp;!(this.xi||this.allowTabSynchronization&amp;&amp;e2.allowTabSynchronization))throw new FirestoreError(N.FAILED_PRECONDITION,kt)})}Zi(e){const t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return __PRIVATE_primaryClientStore(e).put(H,t)}static C(){return __PRIVATE_SimpleDb.C()}Yi(e){const t=__PRIVATE_primaryClientStore(e);return t.get(H).next(e2=&gt;this.Xi(e2)?(__PRIVATE_logDebug(Nt,"Releasing primary lease."),t.delete(H)):PersistencePromise.resolve())}ns(e,t){const n=Date.now();return!(e&lt;n-t||e&gt;n&amp;&amp;(__PRIVATE_logError(`Detected an update time that is in the future: ${e} &gt; ${n}`),1))}Wi(){null!==this.document&amp;&amp;"function"==typeof this.document.addEventListener&amp;&amp;(this.Bi=()=&gt;{this.Fi.enqueueAndForget(()=&gt;(this.inForeground="visible"===this.document.visibilityState,this.Ki()))},this.document.addEventListener("visibilitychange",this.Bi),this.inForeground="visible"===this.document.visibilityState)}cs(){this.Bi&amp;&amp;(this.document.removeEventListener("visibilitychange",this.Bi),this.Bi=null)}Gi(){var e;"function"==typeof(null===(e=this.window)||void 0===e?void 0:e.addEventListener)&amp;&amp;(this.Ni=()=&gt;{this.us();const e2=/(?:Version|Mobile)\/1[456]/;isSafari()&amp;&amp;(navigator.appVersion.match(e2)||navigator.userAgent.match(e2))&amp;&amp;this.Fi.enterRestrictedMode(!0),this.Fi.enqueueAndForget(()=&gt;this.shutdown())},this.window.addEventListener("pagehide",this.Ni))}ls(){this.Ni&amp;&amp;(this.window.removeEventListener("pagehide",this.Ni),this.Ni=null)}_s(e){var t;try{const n=null!==(null===(t=this.Ui)||void 0===t?void 0:t.getItem(this.ss(e)));return __PRIVATE_logDebug(Nt,`Client '${e}' ${n?"is":"is not"} zombied in LocalStorage`),n}catch(e2){return __PRIVATE_logError(Nt,"Failed to get zombied client id.",e2),!1}}us(){if(this.Ui)try{this.Ui.setItem(this.ss(this.clientId),String(Date.now()))}catch(e){__PRIVATE_logError("Failed to set zombie client id.",e)}}hs(){if(this.Ui)try{this.Ui.removeItem(this.ss(this.clientId))}catch(e){}}ss(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function __PRIVATE_primaryClientStore(e){return __PRIVATE_getStore(e,J)}function __PRIVATE_clientMetadataStore(e){return __PRIVATE_getStore(e,pe)}function __PRIVATE_indexedDbStoragePrefix(e,t){let n=e.projectId;return e.isDefaultDatabase||(n+="."+e.database),"firestore/"+t+"/"+n+"/"}class __PRIVATE_LocalViewChanges{constructor(e,t,n,r){this.targetId=e,this.fromCache=t,this.Is=n,this.ds=r}static Es(e,t){let n=__PRIVATE_documentKeySet(),r=__PRIVATE_documentKeySet();for(const e2 of t.docChanges)switch(e2.type){case 0:n=n.add(e2.doc.key);break;case 1:r=r.add(e2.doc.key)}return new __PRIVATE_LocalViewChanges(e,t.fromCache,n,r)}}class QueryContext{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}class __PRIVATE_QueryEngine{constructor(){this.As=!1,this.Rs=!1,this.Vs=100,this.fs=function __PRIVATE_getDefaultRelativeIndexReadCostPerDocument(){return isSafari()?8:__PRIVATE_getAndroidVersion(getUA())&gt;0?6:4}()}initialize(e,t){this.gs=e,this.indexManager=t,this.As=!0}getDocumentsMatchingQuery(e,t,n,r){const i={result:null};return this.ps(e,t).next(e2=&gt;{i.result=e2}).next(()=&gt;{if(!i.result)return this.ys(e,t,r,n).next(e2=&gt;{i.result=e2})}).next(()=&gt;{if(i.result)return;const n2=new QueryContext;return this.ws(e,t,n2).next(r2=&gt;{if(i.result=r2,this.Rs)return this.Ss(e,t,n2,r2.size)})}).next(()=&gt;i.result)}Ss(e,t,n,r){return n.documentReadCount&lt;this.Vs?(__PRIVATE_getLogLevel()&lt;=LogLevel.DEBUG&amp;&amp;__PRIVATE_logDebug("QueryEngine","SDK will not create cache indexes for query:",__PRIVATE_stringifyQuery(t),"since it only creates cache indexes for collection contains","more than or equal to",this.Vs,"documents"),PersistencePromise.resolve()):(__PRIVATE_getLogLevel()&lt;=LogLevel.DEBUG&amp;&amp;__PRIVATE_logDebug("QueryEngine","Query:",__PRIVATE_stringifyQuery(t),"scans",n.documentReadCount,"local documents and returns",r,"documents as results."),n.documentReadCount&gt;this.fs*r?(__PRIVATE_getLogLevel()&lt;=LogLevel.DEBUG&amp;&amp;__PRIVATE_logDebug("QueryEngine","The SDK decides to create cache indexes for query:",__PRIVATE_stringifyQuery(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,__PRIVATE_queryToTarget(t))):PersistencePromise.resolve())}ps(e,t){if(__PRIVATE_queryMatchesAllDocuments(t))return PersistencePromise.resolve(null);let n=__PRIVATE_queryToTarget(t);return this.indexManager.getIndexType(e,n).next(r=&gt;0===r?null:(null!==t.limit&amp;&amp;1===r&amp;&amp;(t=__PRIVATE_queryWithLimit(t,null,"F"),n=__PRIVATE_queryToTarget(t)),this.indexManager.getDocumentsMatchingTarget(e,n).next(r2=&gt;{const i=__PRIVATE_documentKeySet(...r2);return this.gs.getDocuments(e,i).next(r3=&gt;this.indexManager.getMinOffset(e,n).next(n2=&gt;{const s=this.bs(t,r3);return this.Ds(t,s,i,n2.readTime)?this.ps(e,__PRIVATE_queryWithLimit(t,null,"F")):this.vs(e,s,t,n2)}))})))}ys(e,t,n,r){return __PRIVATE_queryMatchesAllDocuments(t)||r.isEqual(SnapshotVersion.min())?PersistencePromise.resolve(null):this.gs.getDocuments(e,n).next(i=&gt;{const s=this.bs(t,i);return this.Ds(t,s,n,r)?PersistencePromise.resolve(null):(__PRIVATE_getLogLevel()&lt;=LogLevel.DEBUG&amp;&amp;__PRIVATE_logDebug("QueryEngine","Re-using previous result from %s to execute query: %s",r.toString(),__PRIVATE_stringifyQuery(t)),this.vs(e,s,t,__PRIVATE_newIndexOffsetSuccessorFromReadTime(r,Q)).next(e2=&gt;e2))})}bs(e,t){let n=new SortedSet(__PRIVATE_newQueryComparator(e));return t.forEach((t2,r)=&gt;{__PRIVATE_queryMatches(e,r)&amp;&amp;(n=n.add(r))}),n}Ds(e,t,n,r){if(null===e.limit)return!1;if(n.size!==t.size)return!0;const i="F"===e.limitType?t.last():t.first();return!!i&amp;&amp;(i.hasPendingWrites||i.version.compareTo(r)&gt;0)}ws(e,t,n){return __PRIVATE_getLogLevel()&lt;=LogLevel.DEBUG&amp;&amp;__PRIVATE_logDebug("QueryEngine","Using full collection scan to execute query:",__PRIVATE_stringifyQuery(t)),this.gs.getDocumentsMatchingQuery(e,t,IndexOffset.min(),n)}vs(e,t,n,r){return this.gs.getDocumentsMatchingQuery(e,n,r).next(e2=&gt;(t.forEach(t2=&gt;{e2=e2.insert(t2.key,t2)}),e2))}}const Qt="LocalStore";class __PRIVATE_LocalStoreImpl{constructor(e,t,n,r){this.persistence=e,this.Cs=t,this.serializer=r,this.Fs=new SortedMap(__PRIVATE_primitiveComparator),this.Ms=new ObjectMap(e2=&gt;__PRIVATE_canonifyTarget(e2),__PRIVATE_targetEquals),this.xs=new Map,this.Os=e.getRemoteDocumentCache(),this.hi=e.getTargetCache(),this.Ti=e.getBundleCache(),this.Ns(n)}Ns(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new LocalDocumentsView(this.Os,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Os.setIndexManager(this.indexManager),this.Cs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=&gt;e.collect(t,this.Fs))}}function __PRIVATE_newLocalStore(e,t,n,r){return new __PRIVATE_LocalStoreImpl(e,t,n,r)}async function __PRIVATE_localStoreHandleUserChange(e,t){const n=__PRIVATE_debugCast(e);return await n.persistence.runTransaction("Handle user change","readonly",e2=&gt;{let r;return n.mutationQueue.getAllMutationBatches(e2).next(i=&gt;(r=i,n.Ns(t),n.mutationQueue.getAllMutationBatches(e2))).next(t2=&gt;{const i=[],s=[];let o=__PRIVATE_documentKeySet();for(const e3 of r){i.push(e3.batchId);for(const t3 of e3.mutations)o=o.add(t3.key)}for(const e3 of t2){s.push(e3.batchId);for(const t3 of e3.mutations)o=o.add(t3.key)}return n.localDocuments.getDocuments(e2,o).next(e3=&gt;({Bs:e3,removedBatchIds:i,addedBatchIds:s}))})})}function __PRIVATE_localStoreGetLastRemoteSnapshotVersion(e){const t=__PRIVATE_debugCast(e);return t.persistence.runTransaction("Get last remote snapshot version","readonly",e2=&gt;t.hi.getLastRemoteSnapshotVersion(e2))}function __PRIVATE_localStoreApplyRemoteEventToLocalCache(e,t){const n=__PRIVATE_debugCast(e),r=t.snapshotVersion;let i=n.Fs;return n.persistence.runTransaction("Apply remote event","readwrite-primary",e2=&gt;{const s=n.Os.newChangeBuffer({trackRemovals:!0});i=n.Fs;const o=[];t.targetChanges.forEach((s2,_2)=&gt;{const a2=i.get(_2);if(!a2)return;o.push(n.hi.removeMatchingKeys(e2,s2.removedDocuments,_2).next(()=&gt;n.hi.addMatchingKeys(e2,s2.addedDocuments,_2)));let u=a2.withSequenceNumber(e2.currentSequenceNumber);null!==t.targetMismatches.get(_2)?u=u.withResumeToken(ByteString.EMPTY_BYTE_STRING,SnapshotVersion.min()).withLastLimboFreeSnapshotVersion(SnapshotVersion.min()):s2.resumeToken.approximateByteSize()&gt;0&amp;&amp;(u=u.withResumeToken(s2.resumeToken,r)),i=i.insert(_2,u),function __PRIVATE_shouldPersistTargetData(e3,t2,n2){if(0===e3.resumeToken.approximateByteSize())return!0;if(t2.snapshotVersion.toMicroseconds()-e3.snapshotVersion.toMicroseconds()&gt;=3e8)return!0;return n2.addedDocuments.size+n2.modifiedDocuments.size+n2.removedDocuments.size&gt;0}(a2,u,s2)&amp;&amp;o.push(n.hi.updateTargetData(e2,u))});let _=__PRIVATE_mutableDocumentMap(),a=__PRIVATE_documentKeySet();if(t.documentUpdates.forEach(r2=&gt;{t.resolvedLimboDocuments.has(r2)&amp;&amp;o.push(n.persistence.referenceDelegate.updateLimboDocument(e2,r2))}),o.push(function __PRIVATE_populateDocumentChangeBuffer(e,t,n){let r=__PRIVATE_documentKeySet(),i=__PRIVATE_documentKeySet();return n.forEach(e2=&gt;r=r.add(e2)),t.getEntries(e,r).next(e2=&gt;{let r2=__PRIVATE_mutableDocumentMap();return n.forEach((n2,s)=&gt;{const o=e2.get(n2);s.isFoundDocument()!==o.isFoundDocument()&amp;&amp;(i=i.add(n2)),s.isNoDocument()&amp;&amp;s.version.isEqual(SnapshotVersion.min())?(t.removeEntry(n2,s.readTime),r2=r2.insert(n2,s)):!o.isValidDocument()||s.version.compareTo(o.version)&gt;0||0===s.version.compareTo(o.version)&amp;&amp;o.hasPendingWrites?(t.addEntry(s),r2=r2.insert(n2,s)):__PRIVATE_logDebug(Qt,"Ignoring outdated watch update for ",n2,". Current version:",o.version," Watch version:",s.version)}),{Ls:r2,ks:i}})}(e2,s,t.documentUpdates).next(e3=&gt;{_=e3.Ls,a=e3.ks})),!r.isEqual(SnapshotVersion.min())){const t2=n.hi.getLastRemoteSnapshotVersion(e2).next(t3=&gt;n.hi.setTargetsMetadata(e2,e2.currentSequenceNumber,r));o.push(t2)}return PersistencePromise.waitFor(o).next(()=&gt;s.apply(e2)).next(()=&gt;n.localDocuments.getLocalViewOfDocuments(e2,_,a)).next(()=&gt;_)}).then(e2=&gt;(n.Fs=i,e2))}function __PRIVATE_localStoreGetNextMutationBatch(e,t){const n=__PRIVATE_debugCast(e);return n.persistence.runTransaction("Get next mutation batch","readonly",e2=&gt;(void 0===t&amp;&amp;(t=G),n.mutationQueue.getNextMutationBatchAfterBatchId(e2,t)))}function __PRIVATE_localStoreAllocateTarget(e,t){const n=__PRIVATE_debugCast(e);return n.persistence.runTransaction("Allocate target","readwrite",e2=&gt;{let r;return n.hi.getTargetData(e2,t).next(i=&gt;i?(r=i,PersistencePromise.resolve(r)):n.hi.allocateTargetId(e2).next(i2=&gt;(r=new TargetData(t,i2,"TargetPurposeListen",e2.currentSequenceNumber),n.hi.addTargetData(e2,r).next(()=&gt;r))))}).then(e2=&gt;{const r=n.Fs.get(e2.targetId);return(null===r||e2.snapshotVersion.compareTo(r.snapshotVersion)&gt;0)&amp;&amp;(n.Fs=n.Fs.insert(e2.targetId,e2),n.Ms.set(t,e2.targetId)),e2})}async function __PRIVATE_localStoreReleaseTarget(e,t,n){const r=__PRIVATE_debugCast(e),i=r.Fs.get(t),s=n?"readwrite":"readwrite-primary";try{n||await r.persistence.runTransaction("Release target",s,e2=&gt;r.persistence.referenceDelegate.removeTarget(e2,i))}catch(e2){if(!__PRIVATE_isIndexedDbTransactionError(e2))throw e2;__PRIVATE_logDebug(Qt,`Failed to update sequence numbers for target ${t}: ${e2}`)}r.Fs=r.Fs.remove(t),r.Ms.delete(i.target)}function __PRIVATE_localStoreExecuteQuery(e,t,n){const r=__PRIVATE_debugCast(e);let i=SnapshotVersion.min(),s=__PRIVATE_documentKeySet();return r.persistence.runTransaction("Execute query","readwrite",e2=&gt;function __PRIVATE_localStoreGetTargetData(e3,t2,n2){const r2=__PRIVATE_debugCast(e3),i2=r2.Ms.get(n2);return void 0!==i2?PersistencePromise.resolve(r2.Fs.get(i2)):r2.hi.getTargetData(t2,n2)}(r,e2,__PRIVATE_queryToTarget(t)).next(t2=&gt;{if(t2)return i=t2.lastLimboFreeSnapshotVersion,r.hi.getMatchingKeysForTargetId(e2,t2.targetId).next(e3=&gt;{s=e3})}).next(()=&gt;r.Cs.getDocumentsMatchingQuery(e2,t,n?i:SnapshotVersion.min(),n?s:__PRIVATE_documentKeySet())).next(e3=&gt;(__PRIVATE_setMaxReadTime(r,__PRIVATE_queryCollectionGroup(t),e3),{documents:e3,qs:s})))}function __PRIVATE_localStoreGetCachedTarget(e,t){const n=__PRIVATE_debugCast(e),r=__PRIVATE_debugCast(n.hi),i=n.Fs.get(t);return i?Promise.resolve(i.target):n.persistence.runTransaction("Get target data","readonly",e2=&gt;r.Et(e2,t).next(e3=&gt;e3?e3.target:null))}function __PRIVATE_localStoreGetNewDocumentChanges(e,t){const n=__PRIVATE_debugCast(e),r=n.xs.get(t)||SnapshotVersion.min();return n.persistence.runTransaction("Get new document changes","readonly",e2=&gt;n.Os.getAllFromCollectionGroup(e2,t,__PRIVATE_newIndexOffsetSuccessorFromReadTime(r,Q),Number.MAX_SAFE_INTEGER)).then(e2=&gt;(__PRIVATE_setMaxReadTime(n,t,e2),e2))}function __PRIVATE_setMaxReadTime(e,t,n){let r=e.xs.get(t)||SnapshotVersion.min();n.forEach((e2,t2)=&gt;{t2.readTime.compareTo(r)&gt;0&amp;&amp;(r=t2.readTime)}),e.xs.set(t,r)}const Ut="firestore_clients";function createWebStorageClientStateKey(e,t){return`${Ut}_${e}_${t}`}const Kt="firestore_mutations";function createWebStorageMutationBatchKey(e,t,n){let r=`${Kt}_${e}_${n}`;return t.isAuthenticated()&amp;&amp;(r+=`_${t.uid}`),r}const Wt="firestore_targets";function createWebStorageQueryTargetMetadataKey(e,t){return`${Wt}_${e}_${t}`}const Gt="SharedClientState";class __PRIVATE_MutationMetadata{constructor(e,t,n,r){this.user=e,this.batchId=t,this.state=n,this.error=r}static Ks(e,t,n){const r=JSON.parse(n);let i,s="object"==typeof r&amp;&amp;-1!==["pending","acknowledged","rejected"].indexOf(r.state)&amp;&amp;(void 0===r.error||"object"==typeof r.error);return s&amp;&amp;r.error&amp;&amp;(s="string"==typeof r.error.message&amp;&amp;"string"==typeof r.error.code,s&amp;&amp;(i=new FirestoreError(r.error.code,r.error.message))),s?new __PRIVATE_MutationMetadata(e,t,r.state,i):(__PRIVATE_logError(Gt,`Failed to parse mutation state for ID '${t}': ${n}`),null)}Ws(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&amp;&amp;(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class __PRIVATE_QueryTargetMetadata{constructor(e,t,n){this.targetId=e,this.state=t,this.error=n}static Ks(e,t){const n=JSON.parse(t);let r,i="object"==typeof n&amp;&amp;-1!==["not-current","current","rejected"].indexOf(n.state)&amp;&amp;(void 0===n.error||"object"==typeof n.error);return i&amp;&amp;n.error&amp;&amp;(i="string"==typeof n.error.message&amp;&amp;"string"==typeof n.error.code,i&amp;&amp;(r=new FirestoreError(n.error.code,n.error.message))),i?new __PRIVATE_QueryTargetMetadata(e,n.state,r):(__PRIVATE_logError(Gt,`Failed to parse target state for ID '${e}': ${t}`),null)}Ws(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&amp;&amp;(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class __PRIVATE_RemoteClientState{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static Ks(e,t){const n=JSON.parse(t);let r="object"==typeof n&amp;&amp;n.activeTargetIds instanceof Array,i=__PRIVATE_targetIdSet();for(let e2=0;r&amp;&amp;e2&lt;n.activeTargetIds.length;++e2)r=isSafeInteger(n.activeTargetIds[e2]),i=i.add(n.activeTargetIds[e2]);return r?new __PRIVATE_RemoteClientState(e,i):(__PRIVATE_logError(Gt,`Failed to parse client data for instance '${e}': ${t}`),null)}}class __PRIVATE_SharedOnlineState{constructor(e,t){this.clientId=e,this.onlineState=t}static Ks(e){const t=JSON.parse(e);return"object"==typeof t&amp;&amp;-1!==["Unknown","Online","Offline"].indexOf(t.onlineState)&amp;&amp;"string"==typeof t.clientId?new __PRIVATE_SharedOnlineState(t.clientId,t.onlineState):(__PRIVATE_logError(Gt,`Failed to parse online state: ${e}`),null)}}class __PRIVATE_LocalClientState{constructor(){this.activeTargetIds=__PRIVATE_targetIdSet()}Gs(e){this.activeTargetIds=this.activeTargetIds.add(e)}zs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Ws(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class __PRIVATE_WebStorageSharedClientState{constructor(e,t,n,r,i){this.window=e,this.Fi=t,this.persistenceKey=n,this.js=r,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.Js=this.Hs.bind(this),this.Ys=new SortedMap(__PRIVATE_primitiveComparator),this.started=!1,this.Zs=[];const s=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&amp;");this.storage=this.window.localStorage,this.currentUser=i,this.Xs=createWebStorageClientStateKey(this.persistenceKey,this.js),this.eo=function createWebStorageSequenceNumberKey(e2){return`firestore_sequence_number_${e2}`}(this.persistenceKey),this.Ys=this.Ys.insert(this.js,new __PRIVATE_LocalClientState),this.no=new RegExp(`^${Ut}_${s}_([^_]*)$`),this.ro=new RegExp(`^${Kt}_${s}_(\\d+)(?:_(.*))?$`),this.io=new RegExp(`^${Wt}_${s}_(\\d+)$`),this.so=function createWebStorageOnlineStateKey(e2){return`firestore_online_state_${e2}`}(this.persistenceKey),this.oo=function createBundleLoadedKey(e2){return`firestore_bundle_loaded_v2_${e2}`}(this.persistenceKey),this.window.addEventListener("storage",this.Js)}static C(e){return!(!e||!e.localStorage)}async start(){const e=await this.syncEngine.Ps();for(const t2 of e){if(t2===this.js)continue;const e2=this.getItem(createWebStorageClientStateKey(this.persistenceKey,t2));if(e2){const n=__PRIVATE_RemoteClientState.Ks(t2,e2);n&amp;&amp;(this.Ys=this.Ys.insert(n.clientId,n))}}this._o();const t=this.storage.getItem(this.so);if(t){const e2=this.ao(t);e2&amp;&amp;this.uo(e2)}for(const e2 of this.Zs)this.Hs(e2);this.Zs=[],this.window.addEventListener("pagehide",()=&gt;this.shutdown()),this.started=!0}writeSequenceNumber(e){this.setItem(this.eo,JSON.stringify(e))}getAllActiveQueryTargets(){return this.co(this.Ys)}isActiveQueryTarget(e){let t=!1;return this.Ys.forEach((n,r)=&gt;{r.activeTargetIds.has(e)&amp;&amp;(t=!0)}),t}addPendingMutation(e){this.lo(e,"pending")}updateMutationState(e,t,n){this.lo(e,t,n),this.ho(e)}addLocalQueryTarget(e,t=!0){let n="not-current";if(this.isActiveQueryTarget(e)){const t2=this.storage.getItem(createWebStorageQueryTargetMetadataKey(this.persistenceKey,e));if(t2){const r=__PRIVATE_QueryTargetMetadata.Ks(e,t2);r&amp;&amp;(n=r.state)}}return t&amp;&amp;this.Po.Gs(e),this._o(),n}removeLocalQueryTarget(e){this.Po.zs(e),this._o()}isLocalQueryTarget(e){return this.Po.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(createWebStorageQueryTargetMetadataKey(this.persistenceKey,e))}updateQueryState(e,t,n){this.To(e,t,n)}handleUserChange(e,t,n){t.forEach(e2=&gt;{this.ho(e2)}),this.currentUser=e,n.forEach(e2=&gt;{this.addPendingMutation(e2)})}setOnlineState(e){this.Io(e)}notifyBundleLoaded(e){this.Eo(e)}shutdown(){this.started&amp;&amp;(this.window.removeEventListener("storage",this.Js),this.removeItem(this.Xs),this.started=!1)}getItem(e){const t=this.storage.getItem(e);return __PRIVATE_logDebug(Gt,"READ",e,t),t}setItem(e,t){__PRIVATE_logDebug(Gt,"SET",e,t),this.storage.setItem(e,t)}removeItem(e){__PRIVATE_logDebug(Gt,"REMOVE",e),this.storage.removeItem(e)}Hs(e){const t=e;if(t.storageArea===this.storage){if(__PRIVATE_logDebug(Gt,"EVENT",t.key,t.newValue),t.key===this.Xs)return void __PRIVATE_logError("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.Fi.enqueueRetryable(async()=&gt;{if(this.started){if(null!==t.key)if(this.no.test(t.key)){if(null==t.newValue){const e2=this.Ao(t.key);return this.Ro(e2,null)}{const e2=this.Vo(t.key,t.newValue);if(e2)return this.Ro(e2.clientId,e2)}}else if(this.ro.test(t.key)){if(null!==t.newValue){const e2=this.mo(t.key,t.newValue);if(e2)return this.fo(e2)}}else if(this.io.test(t.key)){if(null!==t.newValue){const e2=this.po(t.key,t.newValue);if(e2)return this.yo(e2)}}else if(t.key===this.so){if(null!==t.newValue){const e2=this.ao(t.newValue);if(e2)return this.uo(e2)}}else if(t.key===this.eo){const e2=function __PRIVATE_fromWebStorageSequenceNumber(e3){let t2=__PRIVATE_ListenSequence.ue;if(null!=e3)try{const n=JSON.parse(e3);__PRIVATE_hardAssert("number"==typeof n,30636,{wo:e3}),t2=n}catch(e4){__PRIVATE_logError(Gt,"Failed to read sequence number from WebStorage",e4)}return t2}(t.newValue);e2!==__PRIVATE_ListenSequence.ue&amp;&amp;this.sequenceNumberHandler(e2)}else if(t.key===this.oo){const e2=this.So(t.newValue);await Promise.all(e2.map(e3=&gt;this.syncEngine.bo(e3)))}}else this.Zs.push(t)})}}get Po(){return this.Ys.get(this.js)}_o(){this.setItem(this.Xs,this.Po.Ws())}lo(e,t,n){const r=new __PRIVATE_MutationMetadata(this.currentUser,e,t,n),i=createWebStorageMutationBatchKey(this.persistenceKey,this.currentUser,e);this.setItem(i,r.Ws())}ho(e){const t=createWebStorageMutationBatchKey(this.persistenceKey,this.currentUser,e);this.removeItem(t)}Io(e){const t={clientId:this.js,onlineState:e};this.storage.setItem(this.so,JSON.stringify(t))}To(e,t,n){const r=createWebStorageQueryTargetMetadataKey(this.persistenceKey,e),i=new __PRIVATE_QueryTargetMetadata(e,t,n);this.setItem(r,i.Ws())}Eo(e){const t=JSON.stringify(Array.from(e));this.setItem(this.oo,t)}Ao(e){const t=this.no.exec(e);return t?t[1]:null}Vo(e,t){const n=this.Ao(e);return __PRIVATE_RemoteClientState.Ks(n,t)}mo(e,t){const n=this.ro.exec(e),r=Number(n[1]),i=void 0!==n[2]?n[2]:null;return __PRIVATE_MutationMetadata.Ks(new User(i),r,t)}po(e,t){const n=this.io.exec(e),r=Number(n[1]);return __PRIVATE_QueryTargetMetadata.Ks(r,t)}ao(e){return __PRIVATE_SharedOnlineState.Ks(e)}So(e){return JSON.parse(e)}async fo(e){if(e.user.uid===this.currentUser.uid)return this.syncEngine.Do(e.batchId,e.state,e.error);__PRIVATE_logDebug(Gt,`Ignoring mutation for non-active user ${e.user.uid}`)}yo(e){return this.syncEngine.vo(e.targetId,e.state,e.error)}Ro(e,t){const n=t?this.Ys.insert(e,t):this.Ys.remove(e),r=this.co(this.Ys),i=this.co(n),s=[],o=[];return i.forEach(e2=&gt;{r.has(e2)||s.push(e2)}),r.forEach(e2=&gt;{i.has(e2)||o.push(e2)}),this.syncEngine.Co(s,o).then(()=&gt;{this.Ys=n})}uo(e){this.Ys.get(e.clientId)&amp;&amp;this.onlineStateHandler(e.onlineState)}co(e){let t=__PRIVATE_targetIdSet();return e.forEach((e2,n)=&gt;{t=t.unionWith(n.activeTargetIds)}),t}}class __PRIVATE_MemorySharedClientState{constructor(){this.Fo=new __PRIVATE_LocalClientState,this.Mo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e,t=!0){return t&amp;&amp;this.Fo.Gs(e),this.Mo[e]||"not-current"}updateQueryState(e,t,n){this.Mo[e]=t}removeLocalQueryTarget(e){this.Fo.zs(e)}isLocalQueryTarget(e){return this.Fo.activeTargetIds.has(e)}clearQueryState(e){delete this.Mo[e]}getAllActiveQueryTargets(){return this.Fo.activeTargetIds}isActiveQueryTarget(e){return this.Fo.activeTargetIds.has(e)}start(){return this.Fo=new __PRIVATE_LocalClientState,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class __PRIVATE_NoopConnectivityMonitor{xo(e){}shutdown(){}}const zt="ConnectivityMonitor";class __PRIVATE_BrowserConnectivityMonitor{constructor(){this.Oo=()=&gt;this.No(),this.Bo=()=&gt;this.Lo(),this.ko=[],this.qo()}xo(e){this.ko.push(e)}shutdown(){window.removeEventListener("online",this.Oo),window.removeEventListener("offline",this.Bo)}qo(){window.addEventListener("online",this.Oo),window.addEventListener("offline",this.Bo)}No(){__PRIVATE_logDebug(zt,"Network connectivity changed: AVAILABLE");for(const e of this.ko)e(0)}Lo(){__PRIVATE_logDebug(zt,"Network connectivity changed: UNAVAILABLE");for(const e of this.ko)e(1)}static C(){return"undefined"!=typeof window&amp;&amp;void 0!==window.addEventListener&amp;&amp;void 0!==window.removeEventListener}}let jt=null;function __PRIVATE_generateUniqueDebugId(){return null===jt?jt=function __PRIVATE_generateInitialUniqueDebugId(){return 268435456+Math.round(2147483648*Math.random())}():jt++,"0x"+jt.toString(16)}const Jt="RestConnection",Ht={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class __PRIVATE_RestConnection{get Qo(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",n=encodeURIComponent(this.databaseId.projectId),r=encodeURIComponent(this.databaseId.database);this.$o=t+"://"+e.host,this.Uo=`projects/${n}/databases/${r}`,this.Ko=this.databaseId.database===ut?`project_id=${n}`:`project_id=${n}&amp;database_id=${r}`}Wo(e,t,n,r,i){const s=__PRIVATE_generateUniqueDebugId(),o=this.Go(e,t.toUriEncodedString());__PRIVATE_logDebug(Jt,`Sending RPC '${e}' ${s}:`,o,n);const _={"google-cloud-resource-prefix":this.Uo,"x-goog-request-params":this.Ko};this.zo(_,r,i);const{host:a}=new URL(o),u=isCloudWorkstation(a);return this.jo(e,o,_,n,u).then(t2=&gt;(__PRIVATE_logDebug(Jt,`Received RPC '${e}' ${s}: `,t2),t2),t2=&gt;{throw __PRIVATE_logWarn(Jt,`RPC '${e}' ${s} failed with error: `,t2,"url: ",o,"request:",n),t2})}Jo(e,t,n,r,i,s){return this.Wo(e,t,n,r,i)}zo(e,t,n){e["X-Goog-Api-Client"]=function __PRIVATE_getGoogApiClientValue(){return"gl-js/ fire/"+x}(),e["Content-Type"]="text/plain",this.databaseInfo.appId&amp;&amp;(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&amp;&amp;t.headers.forEach((t2,n2)=&gt;e[n2]=t2),n&amp;&amp;n.headers.forEach((t2,n2)=&gt;e[n2]=t2)}Go(e,t){const n=Ht[e];return`${this.$o}/v1/${t}:${n}`}terminate(){}}class __PRIVATE_StreamBridge{constructor(e){this.Ho=e.Ho,this.Yo=e.Yo}Zo(e){this.Xo=e}e_(e){this.t_=e}n_(e){this.r_=e}onMessage(e){this.i_=e}close(){this.Yo()}send(e){this.Ho(e)}s_(){this.Xo()}o_(){this.t_()}__(e){this.r_(e)}a_(e){this.i_(e)}}const Yt="WebChannelConnection";class __PRIVATE_WebChannelConnection extends __PRIVATE_RestConnection{constructor(e){super(e),this.u_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}jo(e,t,n,r,i){const s=__PRIVATE_generateUniqueDebugId();return new Promise((i2,o)=&gt;{const _=new XhrIo;_.setWithCredentials(!0),_.listenOnce(EventType.COMPLETE,()=&gt;{try{switch(_.getLastErrorCode()){case ErrorCode$1.NO_ERROR:const t2=_.getResponseJson();__PRIVATE_logDebug(Yt,`XHR for RPC '${e}' ${s} received:`,JSON.stringify(t2)),i2(t2);break;case ErrorCode$1.TIMEOUT:__PRIVATE_logDebug(Yt,`RPC '${e}' ${s} timed out`),o(new FirestoreError(N.DEADLINE_EXCEEDED,"Request time out"));break;case ErrorCode$1.HTTP_ERROR:const n2=_.getStatus();if(__PRIVATE_logDebug(Yt,`RPC '${e}' ${s} failed with status:`,n2,"response text:",_.getResponseText()),n2&gt;0){let e2=_.getResponseJson();Array.isArray(e2)&amp;&amp;(e2=e2[0]);const t3=null==e2?void 0:e2.error;if(t3&amp;&amp;t3.status&amp;&amp;t3.message){const e3=function __PRIVATE_mapCodeFromHttpResponseErrorStatus(e4){const t4=e4.toLowerCase().replace(/_/g,"-");return Object.values(N).indexOf(t4)&gt;=0?t4:N.UNKNOWN}(t3.status);o(new FirestoreError(e3,t3.message))}else o(new FirestoreError(N.UNKNOWN,"Server responded with status "+_.getStatus()))}else o(new FirestoreError(N.UNAVAILABLE,"Connection failed."));break;default:fail(9055,{c_:e,streamId:s,l_:_.getLastErrorCode(),h_:_.getLastError()})}}finally{__PRIVATE_logDebug(Yt,`RPC '${e}' ${s} completed.`)}});const a=JSON.stringify(r);__PRIVATE_logDebug(Yt,`RPC '${e}' ${s} sending request:`,r),_.send(t,"POST",a,n,15)})}P_(e,t,n){const r=__PRIVATE_generateUniqueDebugId(),i=[this.$o,"/","google.firestore.v1.Firestore","/",e,"/channel"],s=createWebChannelTransport(),o=getStatEventTarget(),_={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},a=this.longPollingOptions.timeoutSeconds;void 0!==a&amp;&amp;(_.longPollingTimeout=Math.round(1e3*a)),this.useFetchStreams&amp;&amp;(_.useFetchStreams=!0),this.zo(_.initMessageHeaders,t,n),_.encodeInitMessageHeaders=!0;const u=i.join("");__PRIVATE_logDebug(Yt,`Creating RPC '${e}' stream ${r}: ${u}`,_);const c=s.createWebChannel(u,_);this.T_(c);let l=!1,h=!1;const P=new __PRIVATE_StreamBridge({Ho:t2=&gt;{h?__PRIVATE_logDebug(Yt,`Not sending because RPC '${e}' stream ${r} is closed:`,t2):(l||(__PRIVATE_logDebug(Yt,`Opening RPC '${e}' stream ${r} transport.`),c.open(),l=!0),__PRIVATE_logDebug(Yt,`RPC '${e}' stream ${r} sending:`,t2),c.send(t2))},Yo:()=&gt;c.close()}),__PRIVATE_unguardedEventListen=(e2,t2,n2)=&gt;{e2.listen(t2,e3=&gt;{try{n2(e3)}catch(e4){setTimeout(()=&gt;{throw e4},0)}})};return __PRIVATE_unguardedEventListen(c,WebChannel.EventType.OPEN,()=&gt;{h||(__PRIVATE_logDebug(Yt,`RPC '${e}' stream ${r} transport opened.`),P.s_())}),__PRIVATE_unguardedEventListen(c,WebChannel.EventType.CLOSE,()=&gt;{h||(h=!0,__PRIVATE_logDebug(Yt,`RPC '${e}' stream ${r} transport closed`),P.__(),this.I_(c))}),__PRIVATE_unguardedEventListen(c,WebChannel.EventType.ERROR,t2=&gt;{h||(h=!0,__PRIVATE_logWarn(Yt,`RPC '${e}' stream ${r} transport errored. Name:`,t2.name,"Message:",t2.message),P.__(new FirestoreError(N.UNAVAILABLE,"The operation could not be completed")))}),__PRIVATE_unguardedEventListen(c,WebChannel.EventType.MESSAGE,t2=&gt;{var n2;if(!h){const i2=t2.data[0];__PRIVATE_hardAssert(!!i2,16349);const s2=i2,o2=(null==s2?void 0:s2.error)||(null===(n2=s2[0])||void 0===n2?void 0:n2.error);if(o2){__PRIVATE_logDebug(Yt,`RPC '${e}' stream ${r} received error:`,o2);const t3=o2.status;let n3=function __PRIVATE_mapCodeFromRpcStatus(e2){const t4=ft[e2];if(void 0!==t4)return __PRIVATE_mapCodeFromRpcCode(t4)}(t3),i3=o2.message;void 0===n3&amp;&amp;(n3=N.INTERNAL,i3="Unknown error status: "+t3+" with message "+o2.message),h=!0,P.__(new FirestoreError(n3,i3)),c.close()}else __PRIVATE_logDebug(Yt,`RPC '${e}' stream ${r} received:`,i2),P.a_(i2)}}),__PRIVATE_unguardedEventListen(o,Event.STAT_EVENT,t2=&gt;{t2.stat===Stat.PROXY?__PRIVATE_logDebug(Yt,`RPC '${e}' stream ${r} detected buffering proxy`):t2.stat===Stat.NOPROXY&amp;&amp;__PRIVATE_logDebug(Yt,`RPC '${e}' stream ${r} detected no buffering proxy`)}),setTimeout(()=&gt;{P.o_()},0),P}terminate(){this.u_.forEach(e=&gt;e.close()),this.u_=[]}T_(e){this.u_.push(e)}I_(e){this.u_=this.u_.filter(t=&gt;t===e)}}function __PRIVATE_getWindow(){return"undefined"!=typeof window?window:null}function getDocument(){return"undefined"!=typeof document?document:null}function __PRIVATE_newSerializer(e){return new JsonProtoSerializer(e,!0)}class __PRIVATE_ExponentialBackoff{constructor(e,t,n=1e3,r=1.5,i=6e4){this.Fi=e,this.timerId=t,this.d_=n,this.E_=r,this.A_=i,this.R_=0,this.V_=null,this.m_=Date.now(),this.reset()}reset(){this.R_=0}f_(){this.R_=this.A_}g_(e){this.cancel();const t=Math.floor(this.R_+this.p_()),n=Math.max(0,Date.now()-this.m_),r=Math.max(0,t-n);r&gt;0&amp;&amp;__PRIVATE_logDebug("ExponentialBackoff",`Backing off for ${r} ms (base delay: ${this.R_} ms, delay with jitter: ${t} ms, last attempt: ${n} ms ago)`),this.V_=this.Fi.enqueueAfterDelay(this.timerId,r,()=&gt;(this.m_=Date.now(),e())),this.R_*=this.E_,this.R_&lt;this.d_&amp;&amp;(this.R_=this.d_),this.R_&gt;this.A_&amp;&amp;(this.R_=this.A_)}y_(){null!==this.V_&amp;&amp;(this.V_.skipDelay(),this.V_=null)}cancel(){null!==this.V_&amp;&amp;(this.V_.cancel(),this.V_=null)}p_(){return(Math.random()-.5)*this.R_}}const Zt="PersistentStream";class __PRIVATE_PersistentStream{constructor(e,t,n,r,i,s,o,_){this.Fi=e,this.w_=n,this.S_=r,this.connection=i,this.authCredentialsProvider=s,this.appCheckCredentialsProvider=o,this.listener=_,this.state=0,this.b_=0,this.D_=null,this.v_=null,this.stream=null,this.C_=0,this.F_=new __PRIVATE_ExponentialBackoff(e,t)}M_(){return 1===this.state||5===this.state||this.x_()}x_(){return 2===this.state||3===this.state}start(){this.C_=0,4!==this.state?this.auth():this.O_()}async stop(){this.M_()&amp;&amp;await this.close(0)}N_(){this.state=0,this.F_.reset()}B_(){this.x_()&amp;&amp;null===this.D_&amp;&amp;(this.D_=this.Fi.enqueueAfterDelay(this.w_,6e4,()=&gt;this.L_()))}k_(e){this.q_(),this.stream.send(e)}async L_(){if(this.x_())return this.close(0)}q_(){this.D_&amp;&amp;(this.D_.cancel(),this.D_=null)}Q_(){this.v_&amp;&amp;(this.v_.cancel(),this.v_=null)}async close(e,t){this.q_(),this.Q_(),this.F_.cancel(),this.b_++,4!==e?this.F_.reset():t&amp;&amp;t.code===N.RESOURCE_EXHAUSTED?(__PRIVATE_logError(t.toString()),__PRIVATE_logError("Using maximum backoff delay to prevent overloading the backend."),this.F_.f_()):t&amp;&amp;t.code===N.UNAUTHENTICATED&amp;&amp;3!==this.state&amp;&amp;(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&amp;&amp;(this.U_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.n_(t)}U_(){}auth(){this.state=1;const e=this.K_(this.b_),t=this.b_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([e2,n])=&gt;{this.b_===t&amp;&amp;this.W_(e2,n)},t2=&gt;{e(()=&gt;{const e2=new FirestoreError(N.UNKNOWN,"Fetching auth token failed: "+t2.message);return this.G_(e2)})})}W_(e,t){const n=this.K_(this.b_);this.stream=this.z_(e,t),this.stream.Zo(()=&gt;{n(()=&gt;this.listener.Zo())}),this.stream.e_(()=&gt;{n(()=&gt;(this.state=2,this.v_=this.Fi.enqueueAfterDelay(this.S_,1e4,()=&gt;(this.x_()&amp;&amp;(this.state=3),Promise.resolve())),this.listener.e_()))}),this.stream.n_(e2=&gt;{n(()=&gt;this.G_(e2))}),this.stream.onMessage(e2=&gt;{n(()=&gt;1==++this.C_?this.j_(e2):this.onNext(e2))})}O_(){this.state=5,this.F_.g_(async()=&gt;{this.state=0,this.start()})}G_(e){return __PRIVATE_logDebug(Zt,`close with error: ${e}`),this.stream=null,this.close(4,e)}K_(e){return t=&gt;{this.Fi.enqueueAndForget(()=&gt;this.b_===e?t():(__PRIVATE_logDebug(Zt,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class __PRIVATE_PersistentListenStream extends __PRIVATE_PersistentStream{constructor(e,t,n,r,i,s){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,n,r,s),this.serializer=i}z_(e,t){return this.connection.P_("Listen",e,t)}j_(e){return this.onNext(e)}onNext(e){this.F_.reset();const t=function __PRIVATE_fromWatchChange(e,t){let n;if("targetChange"in t){t.targetChange;const r=function __PRIVATE_fromWatchTargetChangeState(e2){return"NO_CHANGE"===e2?0:"ADD"===e2?1:"REMOVE"===e2?2:"CURRENT"===e2?3:"RESET"===e2?4:fail(39313,{state:e2})}(t.targetChange.targetChangeType||"NO_CHANGE"),i=t.targetChange.targetIds||[],s=function __PRIVATE_fromBytes(e2,t2){return e2.useProto3Json?(__PRIVATE_hardAssert(void 0===t2||"string"==typeof t2,58123),ByteString.fromBase64String(t2||"")):(__PRIVATE_hardAssert(void 0===t2||t2 instanceof Buffer||t2 instanceof Uint8Array,16193),ByteString.fromUint8Array(t2||new Uint8Array))}(e,t.targetChange.resumeToken),o=t.targetChange.cause,_=o&amp;&amp;function __PRIVATE_fromRpcStatus(e2){const t2=void 0===e2.code?N.UNKNOWN:__PRIVATE_mapCodeFromRpcCode(e2.code);return new FirestoreError(t2,e2.message||"")}(o);n=new __PRIVATE_WatchTargetChange(r,i,s,_||null)}else if("documentChange"in t){t.documentChange;const r=t.documentChange;r.document,r.document.name,r.document.updateTime;const i=fromName(e,r.document.name),s=__PRIVATE_fromVersion(r.document.updateTime),o=r.document.createTime?__PRIVATE_fromVersion(r.document.createTime):SnapshotVersion.min(),_=new ObjectValue({mapValue:{fields:r.document.fields}}),a=MutableDocument.newFoundDocument(i,s,o,_),u=r.targetIds||[],c=r.removedTargetIds||[];n=new __PRIVATE_DocumentWatchChange(u,c,a.key,a)}else if("documentDelete"in t){t.documentDelete;const r=t.documentDelete;r.document;const i=fromName(e,r.document),s=r.readTime?__PRIVATE_fromVersion(r.readTime):SnapshotVersion.min(),o=MutableDocument.newNoDocument(i,s),_=r.removedTargetIds||[];n=new __PRIVATE_DocumentWatchChange([],_,o.key,o)}else if("documentRemove"in t){t.documentRemove;const r=t.documentRemove;r.document;const i=fromName(e,r.document),s=r.removedTargetIds||[];n=new __PRIVATE_DocumentWatchChange([],s,i,null)}else{if(!("filter"in t))return fail(11601,{At:t});{t.filter;const e2=t.filter;e2.targetId;const{count:r=0,unchangedNames:i}=e2,s=new ExistenceFilter(r,i),o=e2.targetId;n=new __PRIVATE_ExistenceFilterChange(o,s)}}return n}(this.serializer,e),n=function __PRIVATE_versionFromListenResponse(e2){if(!("targetChange"in e2))return SnapshotVersion.min();const t2=e2.targetChange;return t2.targetIds&amp;&amp;t2.targetIds.length?SnapshotVersion.min():t2.readTime?__PRIVATE_fromVersion(t2.readTime):SnapshotVersion.min()}(e);return this.listener.J_(t,n)}H_(e){const t={};t.database=__PRIVATE_getEncodedDatabaseId(this.serializer),t.addTarget=function __PRIVATE_toTarget(e2,t2){let n2;const r=t2.target;if(n2=__PRIVATE_targetIsDocumentTarget(r)?{documents:__PRIVATE_toDocumentsTarget(e2,r)}:{query:__PRIVATE_toQueryTarget(e2,r).Vt},n2.targetId=t2.targetId,t2.resumeToken.approximateByteSize()&gt;0){n2.resumeToken=__PRIVATE_toBytes(e2,t2.resumeToken);const r2=__PRIVATE_toInt32Proto(e2,t2.expectedCount);null!==r2&amp;&amp;(n2.expectedCount=r2)}else if(t2.snapshotVersion.compareTo(SnapshotVersion.min())&gt;0){n2.readTime=toTimestamp(e2,t2.snapshotVersion.toTimestamp());const r2=__PRIVATE_toInt32Proto(e2,t2.expectedCount);null!==r2&amp;&amp;(n2.expectedCount=r2)}return n2}(this.serializer,e);const n=function __PRIVATE_toListenRequestLabels(e,t){const n=function __PRIVATE_toLabel(e2){switch(e2){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return fail(28987,{purpose:e2})}}(t.purpose);return null==n?null:{"goog-listen-tags":n}}(this.serializer,e);n&amp;&amp;(t.labels=n),this.k_(t)}Y_(e){const t={};t.database=__PRIVATE_getEncodedDatabaseId(this.serializer),t.removeTarget=e,this.k_(t)}}class __PRIVATE_PersistentWriteStream extends __PRIVATE_PersistentStream{constructor(e,t,n,r,i,s){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,n,r,s),this.serializer=i}get Z_(){return this.C_&gt;0}start(){this.lastStreamToken=void 0,super.start()}U_(){this.Z_&amp;&amp;this.X_([])}z_(e,t){return this.connection.P_("Write",e,t)}j_(e){return __PRIVATE_hardAssert(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,__PRIVATE_hardAssert(!e.writeResults||0===e.writeResults.length,55816),this.listener.ea()}onNext(e){__PRIVATE_hardAssert(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.F_.reset();const t=function __PRIVATE_fromWriteResults(e,t){return e&amp;&amp;e.length&gt;0?(__PRIVATE_hardAssert(void 0!==t,14353),e.map(e2=&gt;function __PRIVATE_fromWriteResult(e3,t2){let n=e3.updateTime?__PRIVATE_fromVersion(e3.updateTime):__PRIVATE_fromVersion(t2);return n.isEqual(SnapshotVersion.min())&amp;&amp;(n=__PRIVATE_fromVersion(t2)),new MutationResult(n,e3.transformResults||[])}(e2,t))):[]}(e.writeResults,e.commitTime),n=__PRIVATE_fromVersion(e.commitTime);return this.listener.ta(n,t)}na(){const e={};e.database=__PRIVATE_getEncodedDatabaseId(this.serializer),this.k_(e)}X_(e){const t={streamToken:this.lastStreamToken,writes:e.map(e2=&gt;toMutation(this.serializer,e2))};this.k_(t)}}class Datastore{}class __PRIVATE_DatastoreImpl extends Datastore{constructor(e,t,n,r){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=n,this.serializer=r,this.ra=!1}ia(){if(this.ra)throw new FirestoreError(N.FAILED_PRECONDITION,"The client has already been terminated.")}Wo(e,t,n,r){return this.ia(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,s])=&gt;this.connection.Wo(e,__PRIVATE_toResourcePath(t,n),r,i,s)).catch(e2=&gt;{throw"FirebaseError"===e2.name?(e2.code===N.UNAUTHENTICATED&amp;&amp;(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e2):new FirestoreError(N.UNKNOWN,e2.toString())})}Jo(e,t,n,r,i){return this.ia(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,o])=&gt;this.connection.Jo(e,__PRIVATE_toResourcePath(t,n),r,s,o,i)).catch(e2=&gt;{throw"FirebaseError"===e2.name?(e2.code===N.UNAUTHENTICATED&amp;&amp;(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e2):new FirestoreError(N.UNKNOWN,e2.toString())})}terminate(){this.ra=!0,this.connection.terminate()}}class __PRIVATE_OnlineStateTracker{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.sa=0,this.oa=null,this._a=!0}aa(){0===this.sa&amp;&amp;(this.ua("Unknown"),this.oa=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=&gt;(this.oa=null,this.ca("Backend didn't respond within 10 seconds."),this.ua("Offline"),Promise.resolve())))}la(e){"Online"===this.state?this.ua("Unknown"):(this.sa++,this.sa&gt;=1&amp;&amp;(this.ha(),this.ca(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ua("Offline")))}set(e){this.ha(),this.sa=0,"Online"===e&amp;&amp;(this._a=!1),this.ua(e)}ua(e){e!==this.state&amp;&amp;(this.state=e,this.onlineStateHandler(e))}ca(e){const t=`Could not reach Cloud Firestore backend. ${e}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this._a?(__PRIVATE_logError(t),this._a=!1):__PRIVATE_logDebug("OnlineStateTracker",t)}ha(){null!==this.oa&amp;&amp;(this.oa.cancel(),this.oa=null)}}const Xt="RemoteStore";class __PRIVATE_RemoteStoreImpl{constructor(e,t,n,r,i){this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.Pa=[],this.Ta=new Map,this.Ia=new Set,this.da=[],this.Ea=i,this.Ea.xo(e2=&gt;{n.enqueueAndForget(async()=&gt;{__PRIVATE_canUseNetwork(this)&amp;&amp;(__PRIVATE_logDebug(Xt,"Restarting streams for network reachability change."),await async function __PRIVATE_restartNetwork(e3){const t2=__PRIVATE_debugCast(e3);t2.Ia.add(4),await __PRIVATE_disableNetworkInternal(t2),t2.Aa.set("Unknown"),t2.Ia.delete(4),await __PRIVATE_enableNetworkInternal(t2)}(this))})}),this.Aa=new __PRIVATE_OnlineStateTracker(n,r)}}async function __PRIVATE_enableNetworkInternal(e){if(__PRIVATE_canUseNetwork(e))for(const t of e.da)await t(!0)}async function __PRIVATE_disableNetworkInternal(e){for(const t of e.da)await t(!1)}function __PRIVATE_remoteStoreListen(e,t){const n=__PRIVATE_debugCast(e);n.Ta.has(t.targetId)||(n.Ta.set(t.targetId,t),__PRIVATE_shouldStartWatchStream(n)?__PRIVATE_startWatchStream(n):__PRIVATE_ensureWatchStream(n).x_()&amp;&amp;__PRIVATE_sendWatchRequest(n,t))}function __PRIVATE_remoteStoreUnlisten(e,t){const n=__PRIVATE_debugCast(e),r=__PRIVATE_ensureWatchStream(n);n.Ta.delete(t),r.x_()&amp;&amp;__PRIVATE_sendUnwatchRequest(n,t),0===n.Ta.size&amp;&amp;(r.x_()?r.B_():__PRIVATE_canUseNetwork(n)&amp;&amp;n.Aa.set("Unknown"))}function __PRIVATE_sendWatchRequest(e,t){if(e.Ra.$e(t.targetId),t.resumeToken.approximateByteSize()&gt;0||t.snapshotVersion.compareTo(SnapshotVersion.min())&gt;0){const n=e.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(n)}__PRIVATE_ensureWatchStream(e).H_(t)}function __PRIVATE_sendUnwatchRequest(e,t){e.Ra.$e(t),__PRIVATE_ensureWatchStream(e).Y_(t)}function __PRIVATE_startWatchStream(e){e.Ra=new __PRIVATE_WatchChangeAggregator({getRemoteKeysForTarget:t=&gt;e.remoteSyncer.getRemoteKeysForTarget(t),Et:t=&gt;e.Ta.get(t)||null,lt:()=&gt;e.datastore.serializer.databaseId}),__PRIVATE_ensureWatchStream(e).start(),e.Aa.aa()}function __PRIVATE_shouldStartWatchStream(e){return __PRIVATE_canUseNetwork(e)&amp;&amp;!__PRIVATE_ensureWatchStream(e).M_()&amp;&amp;e.Ta.size&gt;0}function __PRIVATE_canUseNetwork(e){return 0===__PRIVATE_debugCast(e).Ia.size}function __PRIVATE_cleanUpWatchStreamState(e){e.Ra=void 0}async function __PRIVATE_onWatchStreamConnected(e){e.Aa.set("Online")}async function __PRIVATE_onWatchStreamOpen(e){e.Ta.forEach((t,n)=&gt;{__PRIVATE_sendWatchRequest(e,t)})}async function __PRIVATE_onWatchStreamClose(e,t){__PRIVATE_cleanUpWatchStreamState(e),__PRIVATE_shouldStartWatchStream(e)?(e.Aa.la(t),__PRIVATE_startWatchStream(e)):e.Aa.set("Unknown")}async function __PRIVATE_onWatchStreamChange(e,t,n){if(e.Aa.set("Online"),t instanceof __PRIVATE_WatchTargetChange&amp;&amp;2===t.state&amp;&amp;t.cause)try{await async function __PRIVATE_handleTargetError(e2,t2){const n2=t2.cause;for(const r of t2.targetIds)e2.Ta.has(r)&amp;&amp;(await e2.remoteSyncer.rejectListen(r,n2),e2.Ta.delete(r),e2.Ra.removeTarget(r))}(e,t)}catch(n2){__PRIVATE_logDebug(Xt,"Failed to remove targets %s: %s ",t.targetIds.join(","),n2),await __PRIVATE_disableNetworkUntilRecovery(e,n2)}else if(t instanceof __PRIVATE_DocumentWatchChange?e.Ra.Ye(t):t instanceof __PRIVATE_ExistenceFilterChange?e.Ra.it(t):e.Ra.et(t),!n.isEqual(SnapshotVersion.min()))try{const t2=await __PRIVATE_localStoreGetLastRemoteSnapshotVersion(e.localStore);n.compareTo(t2)&gt;=0&amp;&amp;await function __PRIVATE_raiseWatchSnapshot(e2,t3){const n2=e2.Ra.Pt(t3);return n2.targetChanges.forEach((n3,r)=&gt;{if(n3.resumeToken.approximateByteSize()&gt;0){const i=e2.Ta.get(r);i&amp;&amp;e2.Ta.set(r,i.withResumeToken(n3.resumeToken,t3))}}),n2.targetMismatches.forEach((t4,n3)=&gt;{const r=e2.Ta.get(t4);if(!r)return;e2.Ta.set(t4,r.withResumeToken(ByteString.EMPTY_BYTE_STRING,r.snapshotVersion)),__PRIVATE_sendUnwatchRequest(e2,t4);const i=new TargetData(r.target,t4,n3,r.sequenceNumber);__PRIVATE_sendWatchRequest(e2,i)}),e2.remoteSyncer.applyRemoteEvent(n2)}(e,n)}catch(t2){__PRIVATE_logDebug(Xt,"Failed to raise snapshot:",t2),await __PRIVATE_disableNetworkUntilRecovery(e,t2)}}async function __PRIVATE_disableNetworkUntilRecovery(e,t,n){if(!__PRIVATE_isIndexedDbTransactionError(t))throw t;e.Ia.add(1),await __PRIVATE_disableNetworkInternal(e),e.Aa.set("Offline"),n||(n=()=&gt;__PRIVATE_localStoreGetLastRemoteSnapshotVersion(e.localStore)),e.asyncQueue.enqueueRetryable(async()=&gt;{__PRIVATE_logDebug(Xt,"Retrying IndexedDB access"),await n(),e.Ia.delete(1),await __PRIVATE_enableNetworkInternal(e)})}function __PRIVATE_executeWithRecovery(e,t){return t().catch(n=&gt;__PRIVATE_disableNetworkUntilRecovery(e,n,t))}async function __PRIVATE_fillWritePipeline(e){const t=__PRIVATE_debugCast(e),n=__PRIVATE_ensureWriteStream(t);let r=t.Pa.length&gt;0?t.Pa[t.Pa.length-1].batchId:G;for(;__PRIVATE_canAddToWritePipeline(t);)try{const e2=await __PRIVATE_localStoreGetNextMutationBatch(t.localStore,r);if(null===e2){0===t.Pa.length&amp;&amp;n.B_();break}r=e2.batchId,__PRIVATE_addToWritePipeline(t,e2)}catch(e2){await __PRIVATE_disableNetworkUntilRecovery(t,e2)}__PRIVATE_shouldStartWriteStream(t)&amp;&amp;__PRIVATE_startWriteStream(t)}function __PRIVATE_canAddToWritePipeline(e){return __PRIVATE_canUseNetwork(e)&amp;&amp;e.Pa.length&lt;10}function __PRIVATE_addToWritePipeline(e,t){e.Pa.push(t);const n=__PRIVATE_ensureWriteStream(e);n.x_()&amp;&amp;n.Z_&amp;&amp;n.X_(t.mutations)}function __PRIVATE_shouldStartWriteStream(e){return __PRIVATE_canUseNetwork(e)&amp;&amp;!__PRIVATE_ensureWriteStream(e).M_()&amp;&amp;e.Pa.length&gt;0}function __PRIVATE_startWriteStream(e){__PRIVATE_ensureWriteStream(e).start()}async function __PRIVATE_onWriteStreamOpen(e){__PRIVATE_ensureWriteStream(e).na()}async function __PRIVATE_onWriteHandshakeComplete(e){const t=__PRIVATE_ensureWriteStream(e);for(const n of e.Pa)t.X_(n.mutations)}async function __PRIVATE_onMutationResult(e,t,n){const r=e.Pa.shift(),i=MutationBatchResult.from(r,t,n);await __PRIVATE_executeWithRecovery(e,()=&gt;e.remoteSyncer.applySuccessfulWrite(i)),await __PRIVATE_fillWritePipeline(e)}async function __PRIVATE_onWriteStreamClose(e,t){t&amp;&amp;__PRIVATE_ensureWriteStream(e).Z_&amp;&amp;await async function __PRIVATE_handleWriteError(e2,t2){if(function __PRIVATE_isPermanentWriteError(e3){return function __PRIVATE_isPermanentError(e){switch(e){case N.OK:return fail(64938);case N.CANCELLED:case N.UNKNOWN:case N.DEADLINE_EXCEEDED:case N.RESOURCE_EXHAUSTED:case N.INTERNAL:case N.UNAVAILABLE:case N.UNAUTHENTICATED:return!1;case N.INVALID_ARGUMENT:case N.NOT_FOUND:case N.ALREADY_EXISTS:case N.PERMISSION_DENIED:case N.FAILED_PRECONDITION:case N.ABORTED:case N.OUT_OF_RANGE:case N.UNIMPLEMENTED:case N.DATA_LOSS:return!0;default:return fail(15467,{code:e})}}(e3)&amp;&amp;e3!==N.ABORTED}(t2.code)){const n=e2.Pa.shift();__PRIVATE_ensureWriteStream(e2).N_(),await __PRIVATE_executeWithRecovery(e2,()=&gt;e2.remoteSyncer.rejectFailedWrite(n.batchId,t2)),await __PRIVATE_fillWritePipeline(e2)}}(e,t),__PRIVATE_shouldStartWriteStream(e)&amp;&amp;__PRIVATE_startWriteStream(e)}async function __PRIVATE_remoteStoreHandleCredentialChange(e,t){const n=__PRIVATE_debugCast(e);n.asyncQueue.verifyOperationInProgress(),__PRIVATE_logDebug(Xt,"RemoteStore received new credentials");const r=__PRIVATE_canUseNetwork(n);n.Ia.add(3),await __PRIVATE_disableNetworkInternal(n),r&amp;&amp;n.Aa.set("Unknown"),await n.remoteSyncer.handleCredentialChange(t),n.Ia.delete(3),await __PRIVATE_enableNetworkInternal(n)}async function __PRIVATE_remoteStoreApplyPrimaryState(e,t){const n=__PRIVATE_debugCast(e);t?(n.Ia.delete(2),await __PRIVATE_enableNetworkInternal(n)):t||(n.Ia.add(2),await __PRIVATE_disableNetworkInternal(n),n.Aa.set("Unknown"))}function __PRIVATE_ensureWatchStream(e){return e.Va||(e.Va=function __PRIVATE_newPersistentWatchStream(e2,t,n){const r=__PRIVATE_debugCast(e2);return r.ia(),new __PRIVATE_PersistentListenStream(t,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,n)}(e.datastore,e.asyncQueue,{Zo:__PRIVATE_onWatchStreamConnected.bind(null,e),e_:__PRIVATE_onWatchStreamOpen.bind(null,e),n_:__PRIVATE_onWatchStreamClose.bind(null,e),J_:__PRIVATE_onWatchStreamChange.bind(null,e)}),e.da.push(async t=&gt;{t?(e.Va.N_(),__PRIVATE_shouldStartWatchStream(e)?__PRIVATE_startWatchStream(e):e.Aa.set("Unknown")):(await e.Va.stop(),__PRIVATE_cleanUpWatchStreamState(e))})),e.Va}function __PRIVATE_ensureWriteStream(e){return e.ma||(e.ma=function __PRIVATE_newPersistentWriteStream(e2,t,n){const r=__PRIVATE_debugCast(e2);return r.ia(),new __PRIVATE_PersistentWriteStream(t,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,n)}(e.datastore,e.asyncQueue,{Zo:()=&gt;Promise.resolve(),e_:__PRIVATE_onWriteStreamOpen.bind(null,e),n_:__PRIVATE_onWriteStreamClose.bind(null,e),ea:__PRIVATE_onWriteHandshakeComplete.bind(null,e),ta:__PRIVATE_onMutationResult.bind(null,e)}),e.da.push(async t=&gt;{t?(e.ma.N_(),await __PRIVATE_fillWritePipeline(e)):(await e.ma.stop(),e.Pa.length&gt;0&amp;&amp;(__PRIVATE_logDebug(Xt,`Stopping write stream with ${e.Pa.length} pending writes`),e.Pa=[]))})),e.ma}class DelayedOperation{constructor(e,t,n,r,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=r,this.removalCallback=i,this.deferred=new __PRIVATE_Deferred,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(e2=&gt;{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,n,r,i){const s=Date.now()+n,o=new DelayedOperation(e,t,s,r,i);return o.start(n),o}start(e){this.timerHandle=setTimeout(()=&gt;this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&amp;&amp;(this.clearTimeout(),this.deferred.reject(new FirestoreError(N.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=&gt;null!==this.timerHandle?(this.clearTimeout(),this.op().then(e=&gt;this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&amp;&amp;(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function __PRIVATE_wrapInUserErrorIfRecoverable(e,t){if(__PRIVATE_logError("AsyncQueue",`${t}: ${e}`),__PRIVATE_isIndexedDbTransactionError(e))return new FirestoreError(N.UNAVAILABLE,`${t}: ${e}`);throw e}class DocumentSet{static emptySet(e){return new DocumentSet(e.comparator)}constructor(e){this.comparator=e?(t,n)=&gt;e(t,n)||DocumentKey.comparator(t.key,n.key):(e2,t)=&gt;DocumentKey.comparator(e2.key,t.key),this.keyedMap=documentMap(),this.sortedSet=new SortedMap(this.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,n)=&gt;(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof DocumentSet))return!1;if(this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;t.hasNext();){const e2=t.getNext().key,r=n.getNext().key;if(!e2.isEqual(r))return!1}return!0}toString(){const e=[];return this.forEach(t=&gt;{e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){const n=new DocumentSet;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n}}class __PRIVATE_DocumentChangeSet{constructor(){this.fa=new SortedMap(DocumentKey.comparator)}track(e){const t=e.doc.key,n=this.fa.get(t);n?0!==e.type&amp;&amp;3===n.type?this.fa=this.fa.insert(t,e):3===e.type&amp;&amp;1!==n.type?this.fa=this.fa.insert(t,{type:n.type,doc:e.doc}):2===e.type&amp;&amp;2===n.type?this.fa=this.fa.insert(t,{type:2,doc:e.doc}):2===e.type&amp;&amp;0===n.type?this.fa=this.fa.insert(t,{type:0,doc:e.doc}):1===e.type&amp;&amp;0===n.type?this.fa=this.fa.remove(t):1===e.type&amp;&amp;2===n.type?this.fa=this.fa.insert(t,{type:1,doc:n.doc}):0===e.type&amp;&amp;1===n.type?this.fa=this.fa.insert(t,{type:2,doc:e.doc}):fail(63341,{At:e,ga:n}):this.fa=this.fa.insert(t,e)}pa(){const e=[];return this.fa.inorderTraversal((t,n)=&gt;{e.push(n)}),e}}class ViewSnapshot{constructor(e,t,n,r,i,s,o,_,a){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=i,this.fromCache=s,this.syncStateChanged=o,this.excludesMetadataChanges=_,this.hasCachedResults=a}static fromInitialDocuments(e,t,n,r,i){const s=[];return t.forEach(e2=&gt;{s.push({type:0,doc:e2})}),new ViewSnapshot(e,t,DocumentSet.emptySet(t),s,n,r,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&amp;&amp;this.hasCachedResults===e.hasCachedResults&amp;&amp;this.syncStateChanged===e.syncStateChanged&amp;&amp;this.mutatedKeys.isEqual(e.mutatedKeys)&amp;&amp;__PRIVATE_queryEquals(this.query,e.query)&amp;&amp;this.docs.isEqual(e.docs)&amp;&amp;this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(let e2=0;e2&lt;t.length;e2++)if(t[e2].type!==n[e2].type||!t[e2].doc.isEqual(n[e2].doc))return!1;return!0}}class __PRIVATE_QueryListenersInfo{constructor(){this.ya=void 0,this.wa=[]}Sa(){return this.wa.some(e=&gt;e.ba())}}class __PRIVATE_EventManagerImpl{constructor(){this.queries=__PRIVATE_newQueriesObjectMap(),this.onlineState="Unknown",this.Da=new Set}terminate(){!function __PRIVATE_errorAllTargets(e,t){const n=__PRIVATE_debugCast(e),r=n.queries;n.queries=__PRIVATE_newQueriesObjectMap(),r.forEach((e2,n2)=&gt;{for(const e3 of n2.wa)e3.onError(t)})}(this,new FirestoreError(N.ABORTED,"Firestore shutting down"))}}function __PRIVATE_newQueriesObjectMap(){return new ObjectMap(e=&gt;__PRIVATE_canonifyQuery(e),__PRIVATE_queryEquals)}async function __PRIVATE_eventManagerListen(e,t){const n=__PRIVATE_debugCast(e);let r=3;const i=t.query;let s=n.queries.get(i);s?!s.Sa()&amp;&amp;t.ba()&amp;&amp;(r=2):(s=new __PRIVATE_QueryListenersInfo,r=t.ba()?0:1);try{switch(r){case 0:s.ya=await n.onListen(i,!0);break;case 1:s.ya=await n.onListen(i,!1);break;case 2:await n.onFirstRemoteStoreListen(i)}}catch(e2){const n2=__PRIVATE_wrapInUserErrorIfRecoverable(e2,`Initialization of query '${__PRIVATE_stringifyQuery(t.query)}' failed`);return void t.onError(n2)}n.queries.set(i,s),s.wa.push(t),t.va(n.onlineState),s.ya&amp;&amp;t.Ca(s.ya)&amp;&amp;__PRIVATE_raiseSnapshotsInSyncEvent(n)}async function __PRIVATE_eventManagerUnlisten(e,t){const n=__PRIVATE_debugCast(e),r=t.query;let i=3;const s=n.queries.get(r);if(s){const e2=s.wa.indexOf(t);e2&gt;=0&amp;&amp;(s.wa.splice(e2,1),0===s.wa.length?i=t.ba()?0:1:!s.Sa()&amp;&amp;t.ba()&amp;&amp;(i=2))}switch(i){case 0:return n.queries.delete(r),n.onUnlisten(r,!0);case 1:return n.queries.delete(r),n.onUnlisten(r,!1);case 2:return n.onLastRemoteStoreUnlisten(r);default:return}}function __PRIVATE_eventManagerOnWatchChange(e,t){const n=__PRIVATE_debugCast(e);let r=!1;for(const e2 of t){const t2=e2.query,i=n.queries.get(t2);if(i){for(const t3 of i.wa)t3.Ca(e2)&amp;&amp;(r=!0);i.ya=e2}}r&amp;&amp;__PRIVATE_raiseSnapshotsInSyncEvent(n)}function __PRIVATE_eventManagerOnWatchError(e,t,n){const r=__PRIVATE_debugCast(e),i=r.queries.get(t);if(i)for(const e2 of i.wa)e2.onError(n);r.queries.delete(t)}function __PRIVATE_raiseSnapshotsInSyncEvent(e){e.Da.forEach(e2=&gt;{e2.next()})}var en,tn;(tn=en||(en={})).Fa="default",tn.Cache="cache";class __PRIVATE_QueryListener{constructor(e,t,n){this.query=e,this.Ma=t,this.xa=!1,this.Oa=null,this.onlineState="Unknown",this.options=n||{}}Ca(e){if(!this.options.includeMetadataChanges){const t2=[];for(const n of e.docChanges)3!==n.type&amp;&amp;t2.push(n);e=new ViewSnapshot(e.query,e.docs,e.oldDocs,t2,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.xa?this.Na(e)&amp;&amp;(this.Ma.next(e),t=!0):this.Ba(e,this.onlineState)&amp;&amp;(this.La(e),t=!0),this.Oa=e,t}onError(e){this.Ma.error(e)}va(e){this.onlineState=e;let t=!1;return this.Oa&amp;&amp;!this.xa&amp;&amp;this.Ba(this.Oa,e)&amp;&amp;(this.La(this.Oa),t=!0),t}Ba(e,t){if(!e.fromCache)return!0;if(!this.ba())return!0;const n="Offline"!==t;return(!this.options.ka||!n)&amp;&amp;(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}Na(e){if(e.docChanges.length&gt;0)return!0;const t=this.Oa&amp;&amp;this.Oa.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&amp;&amp;!t)&amp;&amp;!0===this.options.includeMetadataChanges}La(e){e=ViewSnapshot.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.xa=!0,this.Ma.next(e)}ba(){return this.options.source!==en.Cache}}class __PRIVATE_AddedLimboDocument{constructor(e){this.key=e}}class __PRIVATE_RemovedLimboDocument{constructor(e){this.key=e}}class __PRIVATE_View{constructor(e,t){this.query=e,this.Ha=t,this.Ya=null,this.hasCachedResults=!1,this.current=!1,this.Za=__PRIVATE_documentKeySet(),this.mutatedKeys=__PRIVATE_documentKeySet(),this.Xa=__PRIVATE_newQueryComparator(e),this.eu=new DocumentSet(this.Xa)}get tu(){return this.Ha}nu(e,t){const n=t?t.ru:new __PRIVATE_DocumentChangeSet,r=t?t.eu:this.eu;let i=t?t.mutatedKeys:this.mutatedKeys,s=r,o=!1;const _="F"===this.query.limitType&amp;&amp;r.size===this.query.limit?r.last():null,a="L"===this.query.limitType&amp;&amp;r.size===this.query.limit?r.first():null;if(e.inorderTraversal((e2,t2)=&gt;{const u=r.get(e2),c=__PRIVATE_queryMatches(this.query,t2)?t2:null,l=!!u&amp;&amp;this.mutatedKeys.has(u.key),h=!!c&amp;&amp;(c.hasLocalMutations||this.mutatedKeys.has(c.key)&amp;&amp;c.hasCommittedMutations);let P=!1;u&amp;&amp;c?u.data.isEqual(c.data)?l!==h&amp;&amp;(n.track({type:3,doc:c}),P=!0):this.iu(u,c)||(n.track({type:2,doc:c}),P=!0,(_&amp;&amp;this.Xa(c,_)&gt;0||a&amp;&amp;this.Xa(c,a)&lt;0)&amp;&amp;(o=!0)):!u&amp;&amp;c?(n.track({type:0,doc:c}),P=!0):u&amp;&amp;!c&amp;&amp;(n.track({type:1,doc:u}),P=!0,(_||a)&amp;&amp;(o=!0)),P&amp;&amp;(c?(s=s.add(c),i=h?i.add(e2):i.delete(e2)):(s=s.delete(e2),i=i.delete(e2)))}),null!==this.query.limit)for(;s.size&gt;this.query.limit;){const e2="F"===this.query.limitType?s.last():s.first();s=s.delete(e2.key),i=i.delete(e2.key),n.track({type:1,doc:e2})}return{eu:s,ru:n,Ds:o,mutatedKeys:i}}iu(e,t){return e.hasLocalMutations&amp;&amp;t.hasCommittedMutations&amp;&amp;!t.hasLocalMutations}applyChanges(e,t,n,r){const i=this.eu;this.eu=e.eu,this.mutatedKeys=e.mutatedKeys;const s=e.ru.pa();s.sort((e2,t2)=&gt;function __PRIVATE_compareChangeType(e3,t3){const order=e4=&gt;{switch(e4){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return fail(20277,{At:e4})}};return order(e3)-order(t3)}(e2.type,t2.type)||this.Xa(e2.doc,t2.doc)),this.su(n),r=null!=r&amp;&amp;r;const o=t&amp;&amp;!r?this.ou():[],_=0===this.Za.size&amp;&amp;this.current&amp;&amp;!r?1:0,a=_!==this.Ya;return this.Ya=_,0!==s.length||a?{snapshot:new ViewSnapshot(this.query,e.eu,i,s,e.mutatedKeys,0===_,a,!1,!!n&amp;&amp;n.resumeToken.approximateByteSize()&gt;0),_u:o}:{_u:o}}va(e){return this.current&amp;&amp;"Offline"===e?(this.current=!1,this.applyChanges({eu:this.eu,ru:new __PRIVATE_DocumentChangeSet,mutatedKeys:this.mutatedKeys,Ds:!1},!1)):{_u:[]}}au(e){return!this.Ha.has(e)&amp;&amp;!!this.eu.has(e)&amp;&amp;!this.eu.get(e).hasLocalMutations}su(e){e&amp;&amp;(e.addedDocuments.forEach(e2=&gt;this.Ha=this.Ha.add(e2)),e.modifiedDocuments.forEach(e2=&gt;{}),e.removedDocuments.forEach(e2=&gt;this.Ha=this.Ha.delete(e2)),this.current=e.current)}ou(){if(!this.current)return[];const e=this.Za;this.Za=__PRIVATE_documentKeySet(),this.eu.forEach(e2=&gt;{this.au(e2.key)&amp;&amp;(this.Za=this.Za.add(e2.key))});const t=[];return e.forEach(e2=&gt;{this.Za.has(e2)||t.push(new __PRIVATE_RemovedLimboDocument(e2))}),this.Za.forEach(n=&gt;{e.has(n)||t.push(new __PRIVATE_AddedLimboDocument(n))}),t}uu(e){this.Ha=e.qs,this.Za=__PRIVATE_documentKeySet();const t=this.nu(e.documents);return this.applyChanges(t,!0)}cu(){return ViewSnapshot.fromInitialDocuments(this.query,this.eu,this.mutatedKeys,0===this.Ya,this.hasCachedResults)}}const nn="SyncEngine";class __PRIVATE_QueryView{constructor(e,t,n){this.query=e,this.targetId=t,this.view=n}}class LimboResolution{constructor(e){this.key=e,this.lu=!1}}class __PRIVATE_SyncEngineImpl{constructor(e,t,n,r,i,s){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=r,this.currentUser=i,this.maxConcurrentLimboResolutions=s,this.hu={},this.Pu=new ObjectMap(e2=&gt;__PRIVATE_canonifyQuery(e2),__PRIVATE_queryEquals),this.Tu=new Map,this.Iu=new Set,this.du=new SortedMap(DocumentKey.comparator),this.Eu=new Map,this.Au=new __PRIVATE_ReferenceSet,this.Ru={},this.Vu=new Map,this.mu=__PRIVATE_TargetIdGenerator.ur(),this.onlineState="Unknown",this.fu=void 0}get isPrimaryClient(){return!0===this.fu}}async function __PRIVATE_syncEngineListen(e,t,n=!0){const r=__PRIVATE_ensureWatchCallbacks(e);let i;const s=r.Pu.get(t);return s?(r.sharedClientState.addLocalQueryTarget(s.targetId),i=s.view.cu()):i=await __PRIVATE_allocateTargetAndMaybeListen(r,t,n,!0),i}async function __PRIVATE_triggerRemoteStoreListen(e,t){const n=__PRIVATE_ensureWatchCallbacks(e);await __PRIVATE_allocateTargetAndMaybeListen(n,t,!0,!1)}async function __PRIVATE_allocateTargetAndMaybeListen(e,t,n,r){const i=await __PRIVATE_localStoreAllocateTarget(e.localStore,__PRIVATE_queryToTarget(t)),s=i.targetId,o=e.sharedClientState.addLocalQueryTarget(s,n);let _;return r&amp;&amp;(_=await __PRIVATE_initializeViewAndComputeSnapshot(e,t,s,"current"===o,i.resumeToken)),e.isPrimaryClient&amp;&amp;n&amp;&amp;__PRIVATE_remoteStoreListen(e.remoteStore,i),_}async function __PRIVATE_initializeViewAndComputeSnapshot(e,t,n,r,i){e.gu=(t2,n2,r2)=&gt;async function __PRIVATE_applyDocChanges(e2,t3,n3,r3){let i2=t3.view.nu(n3);i2.Ds&amp;&amp;(i2=await __PRIVATE_localStoreExecuteQuery(e2.localStore,t3.query,!1).then(({documents:e3})=&gt;t3.view.nu(e3,i2)));const s2=r3&amp;&amp;r3.targetChanges.get(t3.targetId),o2=r3&amp;&amp;null!=r3.targetMismatches.get(t3.targetId),_2=t3.view.applyChanges(i2,e2.isPrimaryClient,s2,o2);return __PRIVATE_updateTrackedLimbos(e2,t3.targetId,_2._u),_2.snapshot}(e,t2,n2,r2);const s=await __PRIVATE_localStoreExecuteQuery(e.localStore,t,!0),o=new __PRIVATE_View(t,s.qs),_=o.nu(s.documents),a=TargetChange.createSynthesizedTargetChangeForCurrentChange(n,r&amp;&amp;"Offline"!==e.onlineState,i),u=o.applyChanges(_,e.isPrimaryClient,a);__PRIVATE_updateTrackedLimbos(e,n,u._u);const c=new __PRIVATE_QueryView(t,n,o);return e.Pu.set(t,c),e.Tu.has(n)?e.Tu.get(n).push(t):e.Tu.set(n,[t]),u.snapshot}async function __PRIVATE_syncEngineUnlisten(e,t,n){const r=__PRIVATE_debugCast(e),i=r.Pu.get(t),s=r.Tu.get(i.targetId);if(s.length&gt;1)return r.Tu.set(i.targetId,s.filter(e2=&gt;!__PRIVATE_queryEquals(e2,t))),void r.Pu.delete(t);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(i.targetId),r.sharedClientState.isActiveQueryTarget(i.targetId)||await __PRIVATE_localStoreReleaseTarget(r.localStore,i.targetId,!1).then(()=&gt;{r.sharedClientState.clearQueryState(i.targetId),n&amp;&amp;__PRIVATE_remoteStoreUnlisten(r.remoteStore,i.targetId),__PRIVATE_removeAndCleanupTarget(r,i.targetId)}).catch(__PRIVATE_ignoreIfPrimaryLeaseLoss)):(__PRIVATE_removeAndCleanupTarget(r,i.targetId),await __PRIVATE_localStoreReleaseTarget(r.localStore,i.targetId,!0))}async function __PRIVATE_triggerRemoteStoreUnlisten(e,t){const n=__PRIVATE_debugCast(e),r=n.Pu.get(t),i=n.Tu.get(r.targetId);n.isPrimaryClient&amp;&amp;1===i.length&amp;&amp;(n.sharedClientState.removeLocalQueryTarget(r.targetId),__PRIVATE_remoteStoreUnlisten(n.remoteStore,r.targetId))}async function __PRIVATE_syncEngineApplyRemoteEvent(e,t){const n=__PRIVATE_debugCast(e);try{const e2=await __PRIVATE_localStoreApplyRemoteEventToLocalCache(n.localStore,t);t.targetChanges.forEach((e3,t2)=&gt;{const r=n.Eu.get(t2);r&amp;&amp;(__PRIVATE_hardAssert(e3.addedDocuments.size+e3.modifiedDocuments.size+e3.removedDocuments.size&lt;=1,22616),e3.addedDocuments.size&gt;0?r.lu=!0:e3.modifiedDocuments.size&gt;0?__PRIVATE_hardAssert(r.lu,14607):e3.removedDocuments.size&gt;0&amp;&amp;(__PRIVATE_hardAssert(r.lu,42227),r.lu=!1))}),await __PRIVATE_syncEngineEmitNewSnapsAndNotifyLocalStore(n,e2,t)}catch(e2){await __PRIVATE_ignoreIfPrimaryLeaseLoss(e2)}}function __PRIVATE_syncEngineApplyOnlineStateChange(e,t,n){const r=__PRIVATE_debugCast(e);if(r.isPrimaryClient&amp;&amp;0===n||!r.isPrimaryClient&amp;&amp;1===n){const e2=[];r.Pu.forEach((n2,r2)=&gt;{const i=r2.view.va(t);i.snapshot&amp;&amp;e2.push(i.snapshot)}),function __PRIVATE_eventManagerOnOnlineStateChange(e3,t2){const n2=__PRIVATE_debugCast(e3);n2.onlineState=t2;let r2=!1;n2.queries.forEach((e4,n3)=&gt;{for(const e5 of n3.wa)e5.va(t2)&amp;&amp;(r2=!0)}),r2&amp;&amp;__PRIVATE_raiseSnapshotsInSyncEvent(n2)}(r.eventManager,t),e2.length&amp;&amp;r.hu.J_(e2),r.onlineState=t,r.isPrimaryClient&amp;&amp;r.sharedClientState.setOnlineState(t)}}async function __PRIVATE_syncEngineRejectListen(e,t,n){const r=__PRIVATE_debugCast(e);r.sharedClientState.updateQueryState(t,"rejected",n);const i=r.Eu.get(t),s=i&amp;&amp;i.key;if(s){let e2=new SortedMap(DocumentKey.comparator);e2=e2.insert(s,MutableDocument.newNoDocument(s,SnapshotVersion.min()));const n2=__PRIVATE_documentKeySet().add(s),i2=new RemoteEvent(SnapshotVersion.min(),new Map,new SortedMap(__PRIVATE_primitiveComparator),e2,n2);await __PRIVATE_syncEngineApplyRemoteEvent(r,i2),r.du=r.du.remove(s),r.Eu.delete(t),__PRIVATE_pumpEnqueuedLimboResolutions(r)}else await __PRIVATE_localStoreReleaseTarget(r.localStore,t,!1).then(()=&gt;__PRIVATE_removeAndCleanupTarget(r,t,n)).catch(__PRIVATE_ignoreIfPrimaryLeaseLoss)}async function __PRIVATE_syncEngineApplySuccessfulWrite(e,t){const n=__PRIVATE_debugCast(e),r=t.batch.batchId;try{const e2=await function __PRIVATE_localStoreAcknowledgeBatch(e,t){const n=__PRIVATE_debugCast(e);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",e2=&gt;{const r=t.batch.keys(),i=n.Os.newChangeBuffer({trackRemovals:!0});return function __PRIVATE_applyWriteToRemoteDocuments(e3,t2,n2,r2){const i2=n2.batch,s=i2.keys();let o=PersistencePromise.resolve();return s.forEach(e4=&gt;{o=o.next(()=&gt;r2.getEntry(t2,e4)).next(t3=&gt;{const s2=n2.docVersions.get(e4);__PRIVATE_hardAssert(null!==s2,48541),t3.version.compareTo(s2)&lt;0&amp;&amp;(i2.applyToRemoteDocument(t3,n2),t3.isValidDocument()&amp;&amp;(t3.setReadTime(n2.commitVersion),r2.addEntry(t3)))})}),o.next(()=&gt;e3.mutationQueue.removeMutationBatch(t2,i2))}(n,e2,t,i).next(()=&gt;i.apply(e2)).next(()=&gt;n.mutationQueue.performConsistencyCheck(e2)).next(()=&gt;n.documentOverlayCache.removeOverlaysForBatchId(e2,r,t.batch.batchId)).next(()=&gt;n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e2,function __PRIVATE_getKeysWithTransformResults(e3){let t2=__PRIVATE_documentKeySet();for(let n2=0;n2&lt;e3.mutationResults.length;++n2)e3.mutationResults[n2].transformResults.length&gt;0&amp;&amp;(t2=t2.add(e3.batch.mutations[n2].key));return t2}(t))).next(()=&gt;n.localDocuments.getDocuments(e2,r))})}(n.localStore,t);__PRIVATE_processUserCallback(n,r,null),__PRIVATE_triggerPendingWritesCallbacks(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),await __PRIVATE_syncEngineEmitNewSnapsAndNotifyLocalStore(n,e2)}catch(e2){await __PRIVATE_ignoreIfPrimaryLeaseLoss(e2)}}async function __PRIVATE_syncEngineRejectFailedWrite(e,t,n){const r=__PRIVATE_debugCast(e);try{const e2=await function __PRIVATE_localStoreRejectBatch(e3,t2){const n2=__PRIVATE_debugCast(e3);return n2.persistence.runTransaction("Reject batch","readwrite-primary",e4=&gt;{let r2;return n2.mutationQueue.lookupMutationBatch(e4,t2).next(t3=&gt;(__PRIVATE_hardAssert(null!==t3,37113),r2=t3.keys(),n2.mutationQueue.removeMutationBatch(e4,t3))).next(()=&gt;n2.mutationQueue.performConsistencyCheck(e4)).next(()=&gt;n2.documentOverlayCache.removeOverlaysForBatchId(e4,r2,t2)).next(()=&gt;n2.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e4,r2)).next(()=&gt;n2.localDocuments.getDocuments(e4,r2))})}(r.localStore,t);__PRIVATE_processUserCallback(r,t,n),__PRIVATE_triggerPendingWritesCallbacks(r,t),r.sharedClientState.updateMutationState(t,"rejected",n),await __PRIVATE_syncEngineEmitNewSnapsAndNotifyLocalStore(r,e2)}catch(n2){await __PRIVATE_ignoreIfPrimaryLeaseLoss(n2)}}function __PRIVATE_triggerPendingWritesCallbacks(e,t){(e.Vu.get(t)||[]).forEach(e2=&gt;{e2.resolve()}),e.Vu.delete(t)}function __PRIVATE_processUserCallback(e,t,n){const r=__PRIVATE_debugCast(e);let i=r.Ru[r.currentUser.toKey()];if(i){const e2=i.get(t);e2&amp;&amp;(n?e2.reject(n):e2.resolve(),i=i.remove(t)),r.Ru[r.currentUser.toKey()]=i}}function __PRIVATE_removeAndCleanupTarget(e,t,n=null){e.sharedClientState.removeLocalQueryTarget(t);for(const r of e.Tu.get(t))e.Pu.delete(r),n&amp;&amp;e.hu.pu(r,n);e.Tu.delete(t),e.isPrimaryClient&amp;&amp;e.Au.zr(t).forEach(t2=&gt;{e.Au.containsKey(t2)||__PRIVATE_removeLimboTarget(e,t2)})}function __PRIVATE_removeLimboTarget(e,t){e.Iu.delete(t.path.canonicalString());const n=e.du.get(t);null!==n&amp;&amp;(__PRIVATE_remoteStoreUnlisten(e.remoteStore,n),e.du=e.du.remove(t),e.Eu.delete(n),__PRIVATE_pumpEnqueuedLimboResolutions(e))}function __PRIVATE_updateTrackedLimbos(e,t,n){for(const r of n)r instanceof __PRIVATE_AddedLimboDocument?(e.Au.addReference(r.key,t),__PRIVATE_trackLimboChange(e,r)):r instanceof __PRIVATE_RemovedLimboDocument?(__PRIVATE_logDebug(nn,"Document no longer in limbo: "+r.key),e.Au.removeReference(r.key,t),e.Au.containsKey(r.key)||__PRIVATE_removeLimboTarget(e,r.key)):fail(19791,{yu:r})}function __PRIVATE_trackLimboChange(e,t){const n=t.key,r=n.path.canonicalString();e.du.get(n)||e.Iu.has(r)||(__PRIVATE_logDebug(nn,"New document in limbo: "+n),e.Iu.add(r),__PRIVATE_pumpEnqueuedLimboResolutions(e))}function __PRIVATE_pumpEnqueuedLimboResolutions(e){for(;e.Iu.size&gt;0&amp;&amp;e.du.size&lt;e.maxConcurrentLimboResolutions;){const t=e.Iu.values().next().value;e.Iu.delete(t);const n=new DocumentKey(ResourcePath.fromString(t)),r=e.mu.next();e.Eu.set(r,new LimboResolution(n)),e.du=e.du.insert(n,r),__PRIVATE_remoteStoreListen(e.remoteStore,new TargetData(__PRIVATE_queryToTarget(__PRIVATE_newQueryForPath(n.path)),r,"TargetPurposeLimboResolution",__PRIVATE_ListenSequence.ue))}}async function __PRIVATE_syncEngineEmitNewSnapsAndNotifyLocalStore(e,t,n){const r=__PRIVATE_debugCast(e),i=[],s=[],o=[];r.Pu.isEmpty()||(r.Pu.forEach((e2,_)=&gt;{o.push(r.gu(_,t,n).then(e3=&gt;{var t2;if((e3||n)&amp;&amp;r.isPrimaryClient){const i2=e3?!e3.fromCache:null===(t2=null==n?void 0:n.targetChanges.get(_.targetId))||void 0===t2?void 0:t2.current;r.sharedClientState.updateQueryState(_.targetId,i2?"current":"not-current")}if(e3){i.push(e3);const t3=__PRIVATE_LocalViewChanges.Es(_.targetId,e3);s.push(t3)}}))}),await Promise.all(o),r.hu.J_(i),await async function __PRIVATE_localStoreNotifyLocalViewChanges(e2,t2){const n2=__PRIVATE_debugCast(e2);try{await n2.persistence.runTransaction("notifyLocalViewChanges","readwrite",e3=&gt;PersistencePromise.forEach(t2,t3=&gt;PersistencePromise.forEach(t3.Is,r2=&gt;n2.persistence.referenceDelegate.addReference(e3,t3.targetId,r2)).next(()=&gt;PersistencePromise.forEach(t3.ds,r2=&gt;n2.persistence.referenceDelegate.removeReference(e3,t3.targetId,r2)))))}catch(e3){if(!__PRIVATE_isIndexedDbTransactionError(e3))throw e3;__PRIVATE_logDebug(Qt,"Failed to update sequence numbers: "+e3)}for(const e3 of t2){const t3=e3.targetId;if(!e3.fromCache){const e4=n2.Fs.get(t3),r2=e4.snapshotVersion,i2=e4.withLastLimboFreeSnapshotVersion(r2);n2.Fs=n2.Fs.insert(t3,i2)}}}(r.localStore,s))}async function __PRIVATE_syncEngineHandleCredentialChange(e,t){const n=__PRIVATE_debugCast(e);if(!n.currentUser.isEqual(t)){__PRIVATE_logDebug(nn,"User change. New user:",t.toKey());const e2=await __PRIVATE_localStoreHandleUserChange(n.localStore,t);n.currentUser=t,function __PRIVATE_rejectOutstandingPendingWritesCallbacks(e3,t2){e3.Vu.forEach(e4=&gt;{e4.forEach(e5=&gt;{e5.reject(new FirestoreError(N.CANCELLED,t2))})}),e3.Vu.clear()}(n,"'waitForPendingWrites' promise is rejected due to a user change."),n.sharedClientState.handleUserChange(t,e2.removedBatchIds,e2.addedBatchIds),await __PRIVATE_syncEngineEmitNewSnapsAndNotifyLocalStore(n,e2.Bs)}}function __PRIVATE_syncEngineGetRemoteKeysForTarget(e,t){const n=__PRIVATE_debugCast(e),r=n.Eu.get(t);if(r&amp;&amp;r.lu)return __PRIVATE_documentKeySet().add(r.key);{let e2=__PRIVATE_documentKeySet();const r2=n.Tu.get(t);if(!r2)return e2;for(const t2 of r2){const r3=n.Pu.get(t2);e2=e2.unionWith(r3.view.tu)}return e2}}async function __PRIVATE_synchronizeViewAndComputeSnapshot(e,t){const n=__PRIVATE_debugCast(e),r=await __PRIVATE_localStoreExecuteQuery(n.localStore,t.query,!0),i=t.view.uu(r);return n.isPrimaryClient&amp;&amp;__PRIVATE_updateTrackedLimbos(n,t.targetId,i._u),i}async function __PRIVATE_syncEngineSynchronizeWithChangedDocuments(e,t){const n=__PRIVATE_debugCast(e);return __PRIVATE_localStoreGetNewDocumentChanges(n.localStore,t).then(e2=&gt;__PRIVATE_syncEngineEmitNewSnapsAndNotifyLocalStore(n,e2))}async function __PRIVATE_syncEngineApplyBatchState(e,t,n,r){const i=__PRIVATE_debugCast(e),s=await function __PRIVATE_localStoreLookupMutationDocuments(e2,t2){const n2=__PRIVATE_debugCast(e2),r2=__PRIVATE_debugCast(n2.mutationQueue);return n2.persistence.runTransaction("Lookup mutation documents","readonly",e3=&gt;r2.Xn(e3,t2).next(t3=&gt;t3?n2.localDocuments.getDocuments(e3,t3):PersistencePromise.resolve(null)))}(i.localStore,t);null!==s?("pending"===n?await __PRIVATE_fillWritePipeline(i.remoteStore):"acknowledged"===n||"rejected"===n?(__PRIVATE_processUserCallback(i,t,r||null),__PRIVATE_triggerPendingWritesCallbacks(i,t),function __PRIVATE_localStoreRemoveCachedMutationBatchMetadata(e2,t2){__PRIVATE_debugCast(__PRIVATE_debugCast(e2).mutationQueue).rr(t2)}(i.localStore,t)):fail(6720,"Unknown batchState",{wu:n}),await __PRIVATE_syncEngineEmitNewSnapsAndNotifyLocalStore(i,s)):__PRIVATE_logDebug(nn,"Cannot apply mutation batch with id: "+t)}async function __PRIVATE_synchronizeQueryViewsAndRaiseSnapshots(e,t,n){const r=__PRIVATE_debugCast(e),i=[],s=[];for(const e2 of t){let t2;const n2=r.Tu.get(e2);if(n2&amp;&amp;0!==n2.length){t2=await __PRIVATE_localStoreAllocateTarget(r.localStore,__PRIVATE_queryToTarget(n2[0]));for(const e3 of n2){const t3=r.Pu.get(e3),n3=await __PRIVATE_synchronizeViewAndComputeSnapshot(r,t3);n3.snapshot&amp;&amp;s.push(n3.snapshot)}}else{const n3=await __PRIVATE_localStoreGetCachedTarget(r.localStore,e2);t2=await __PRIVATE_localStoreAllocateTarget(r.localStore,n3),await __PRIVATE_initializeViewAndComputeSnapshot(r,__PRIVATE_synthesizeTargetToQuery(n3),e2,!1,t2.resumeToken)}i.push(t2)}return r.hu.J_(s),i}function __PRIVATE_synthesizeTargetToQuery(e){return __PRIVATE_newQuery(e.path,e.collectionGroup,e.orderBy,e.filters,e.limit,"F",e.startAt,e.endAt)}function __PRIVATE_syncEngineGetActiveClients(e){return function __PRIVATE_localStoreGetActiveClients(e2){return __PRIVATE_debugCast(__PRIVATE_debugCast(e2).persistence).Ps()}(__PRIVATE_debugCast(e).localStore)}async function __PRIVATE_syncEngineApplyTargetState(e,t,n,r){const i=__PRIVATE_debugCast(e);if(i.fu)return void __PRIVATE_logDebug(nn,"Ignoring unexpected query state notification.");const s=i.Tu.get(t);if(s&amp;&amp;s.length&gt;0)switch(n){case"current":case"not-current":{const e2=await __PRIVATE_localStoreGetNewDocumentChanges(i.localStore,__PRIVATE_queryCollectionGroup(s[0])),r2=RemoteEvent.createSynthesizedRemoteEventForCurrentChange(t,"current"===n,ByteString.EMPTY_BYTE_STRING);await __PRIVATE_syncEngineEmitNewSnapsAndNotifyLocalStore(i,e2,r2);break}case"rejected":await __PRIVATE_localStoreReleaseTarget(i.localStore,t,!0),__PRIVATE_removeAndCleanupTarget(i,t,r);break;default:fail(64155,n)}}async function __PRIVATE_syncEngineApplyActiveTargetsChange(e,t,n){const r=__PRIVATE_ensureWatchCallbacks(e);if(r.fu){for(const e2 of t){if(r.Tu.has(e2)&amp;&amp;r.sharedClientState.isActiveQueryTarget(e2)){__PRIVATE_logDebug(nn,"Adding an already active target "+e2);continue}const t2=await __PRIVATE_localStoreGetCachedTarget(r.localStore,e2),n2=await __PRIVATE_localStoreAllocateTarget(r.localStore,t2);await __PRIVATE_initializeViewAndComputeSnapshot(r,__PRIVATE_synthesizeTargetToQuery(t2),n2.targetId,!1,n2.resumeToken),__PRIVATE_remoteStoreListen(r.remoteStore,n2)}for(const e2 of n)r.Tu.has(e2)&amp;&amp;await __PRIVATE_localStoreReleaseTarget(r.localStore,e2,!1).then(()=&gt;{__PRIVATE_remoteStoreUnlisten(r.remoteStore,e2),__PRIVATE_removeAndCleanupTarget(r,e2)}).catch(__PRIVATE_ignoreIfPrimaryLeaseLoss)}}function __PRIVATE_ensureWatchCallbacks(e){const t=__PRIVATE_debugCast(e);return t.remoteStore.remoteSyncer.applyRemoteEvent=__PRIVATE_syncEngineApplyRemoteEvent.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=__PRIVATE_syncEngineGetRemoteKeysForTarget.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=__PRIVATE_syncEngineRejectListen.bind(null,t),t.hu.J_=__PRIVATE_eventManagerOnWatchChange.bind(null,t.eventManager),t.hu.pu=__PRIVATE_eventManagerOnWatchError.bind(null,t.eventManager),t}function __PRIVATE_syncEngineEnsureWriteCallbacks(e){const t=__PRIVATE_debugCast(e);return t.remoteStore.remoteSyncer.applySuccessfulWrite=__PRIVATE_syncEngineApplySuccessfulWrite.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=__PRIVATE_syncEngineRejectFailedWrite.bind(null,t),t}class __PRIVATE_MemoryOfflineComponentProvider{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=__PRIVATE_newSerializer(e.databaseInfo.databaseId),this.sharedClientState=this.bu(e),this.persistence=this.Du(e),await this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Cu(e,this.localStore),this.indexBackfillerScheduler=this.Fu(e,this.localStore)}Cu(e,t){return null}Fu(e,t){return null}vu(e){return __PRIVATE_newLocalStore(this.persistence,new __PRIVATE_QueryEngine,e.initialUser,this.serializer)}Du(e){return new __PRIVATE_MemoryPersistence(__PRIVATE_MemoryEagerDelegate.Vi,this.serializer)}bu(e){return new __PRIVATE_MemorySharedClientState}async terminate(){var e,t;null===(e=this.gcScheduler)||void 0===e||e.stop(),null===(t=this.indexBackfillerScheduler)||void 0===t||t.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}__PRIVATE_MemoryOfflineComponentProvider.provider={build:()=&gt;new __PRIVATE_MemoryOfflineComponentProvider};class __PRIVATE_LruGcMemoryOfflineComponentProvider extends __PRIVATE_MemoryOfflineComponentProvider{constructor(e){super(),this.cacheSizeBytes=e}Cu(e,t){__PRIVATE_hardAssert(this.persistence.referenceDelegate instanceof __PRIVATE_MemoryLruDelegate,46915);const n=this.persistence.referenceDelegate.garbageCollector;return new __PRIVATE_LruScheduler(n,e.asyncQueue,t)}Du(e){const t=void 0!==this.cacheSizeBytes?LruParams.withCacheSize(this.cacheSizeBytes):LruParams.DEFAULT;return new __PRIVATE_MemoryPersistence(e2=&gt;__PRIVATE_MemoryLruDelegate.Vi(e2,t),this.serializer)}}class __PRIVATE_IndexedDbOfflineComponentProvider extends __PRIVATE_MemoryOfflineComponentProvider{constructor(e,t,n){super(),this.Mu=e,this.cacheSizeBytes=t,this.forceOwnership=n,this.kind="persistent",this.synchronizeTabs=!1}async initialize(e){await super.initialize(e),await this.Mu.initialize(this,e),await __PRIVATE_syncEngineEnsureWriteCallbacks(this.Mu.syncEngine),await __PRIVATE_fillWritePipeline(this.Mu.remoteStore),await this.persistence.ji(()=&gt;(this.gcScheduler&amp;&amp;!this.gcScheduler.started&amp;&amp;this.gcScheduler.start(),this.indexBackfillerScheduler&amp;&amp;!this.indexBackfillerScheduler.started&amp;&amp;this.indexBackfillerScheduler.start(),Promise.resolve()))}vu(e){return __PRIVATE_newLocalStore(this.persistence,new __PRIVATE_QueryEngine,e.initialUser,this.serializer)}Cu(e,t){const n=this.persistence.referenceDelegate.garbageCollector;return new __PRIVATE_LruScheduler(n,e.asyncQueue,t)}Fu(e,t){const n=new __PRIVATE_IndexBackfiller(t,this.persistence);return new __PRIVATE_IndexBackfillerScheduler(e.asyncQueue,n)}Du(e){const t=__PRIVATE_indexedDbStoragePrefix(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),n=void 0!==this.cacheSizeBytes?LruParams.withCacheSize(this.cacheSizeBytes):LruParams.DEFAULT;return new __PRIVATE_IndexedDbPersistence(this.synchronizeTabs,t,e.clientId,n,e.asyncQueue,__PRIVATE_getWindow(),getDocument(),this.serializer,this.sharedClientState,!!this.forceOwnership)}bu(e){return new __PRIVATE_MemorySharedClientState}}class __PRIVATE_MultiTabOfflineComponentProvider extends __PRIVATE_IndexedDbOfflineComponentProvider{constructor(e,t){super(e,t,!1),this.Mu=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}async initialize(e){await super.initialize(e);const t=this.Mu.syncEngine;this.sharedClientState instanceof __PRIVATE_WebStorageSharedClientState&amp;&amp;(this.sharedClientState.syncEngine={Do:__PRIVATE_syncEngineApplyBatchState.bind(null,t),vo:__PRIVATE_syncEngineApplyTargetState.bind(null,t),Co:__PRIVATE_syncEngineApplyActiveTargetsChange.bind(null,t),Ps:__PRIVATE_syncEngineGetActiveClients.bind(null,t),bo:__PRIVATE_syncEngineSynchronizeWithChangedDocuments.bind(null,t)},await this.sharedClientState.start()),await this.persistence.ji(async e2=&gt;{await async function __PRIVATE_syncEngineApplyPrimaryState(e,t){const n=__PRIVATE_debugCast(e);if(__PRIVATE_ensureWatchCallbacks(n),__PRIVATE_syncEngineEnsureWriteCallbacks(n),!0===t&amp;&amp;!0!==n.fu){const e2=n.sharedClientState.getAllActiveQueryTargets(),t2=await __PRIVATE_synchronizeQueryViewsAndRaiseSnapshots(n,e2.toArray());n.fu=!0,await __PRIVATE_remoteStoreApplyPrimaryState(n.remoteStore,!0);for(const e3 of t2)__PRIVATE_remoteStoreListen(n.remoteStore,e3)}else if(!1===t&amp;&amp;!1!==n.fu){const e2=[];let t2=Promise.resolve();n.Tu.forEach((r,i)=&gt;{n.sharedClientState.isLocalQueryTarget(i)?e2.push(i):t2=t2.then(()=&gt;(__PRIVATE_removeAndCleanupTarget(n,i),__PRIVATE_localStoreReleaseTarget(n.localStore,i,!0))),__PRIVATE_remoteStoreUnlisten(n.remoteStore,i)}),await t2,await __PRIVATE_synchronizeQueryViewsAndRaiseSnapshots(n,e2),function __PRIVATE_resetLimboDocuments(e3){const t3=__PRIVATE_debugCast(e3);t3.Eu.forEach((e4,n2)=&gt;{__PRIVATE_remoteStoreUnlisten(t3.remoteStore,n2)}),t3.Au.jr(),t3.Eu=new Map,t3.du=new SortedMap(DocumentKey.comparator)}(n),n.fu=!1,await __PRIVATE_remoteStoreApplyPrimaryState(n.remoteStore,!1)}}(this.Mu.syncEngine,e2),this.gcScheduler&amp;&amp;(e2&amp;&amp;!this.gcScheduler.started?this.gcScheduler.start():e2||this.gcScheduler.stop()),this.indexBackfillerScheduler&amp;&amp;(e2&amp;&amp;!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():e2||this.indexBackfillerScheduler.stop())})}bu(e){const t=__PRIVATE_getWindow();if(!__PRIVATE_WebStorageSharedClientState.C(t))throw new FirestoreError(N.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");const n=__PRIVATE_indexedDbStoragePrefix(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new __PRIVATE_WebStorageSharedClientState(t,e.asyncQueue,n,e.clientId,e.initialUser)}}class OnlineComponentProvider{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=e2=&gt;__PRIVATE_syncEngineApplyOnlineStateChange(this.syncEngine,e2,1),this.remoteStore.remoteSyncer.handleCredentialChange=__PRIVATE_syncEngineHandleCredentialChange.bind(null,this.syncEngine),await __PRIVATE_remoteStoreApplyPrimaryState(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return function __PRIVATE_newEventManager(){return new __PRIVATE_EventManagerImpl}()}createDatastore(e){const t=__PRIVATE_newSerializer(e.databaseInfo.databaseId),n=function __PRIVATE_newConnection(e2){return new __PRIVATE_WebChannelConnection(e2)}(e.databaseInfo);return function __PRIVATE_newDatastore(e2,t2,n2,r){return new __PRIVATE_DatastoreImpl(e2,t2,n2,r)}(e.authCredentials,e.appCheckCredentials,n,t)}createRemoteStore(e){return function __PRIVATE_newRemoteStore(e2,t,n,r,i){return new __PRIVATE_RemoteStoreImpl(e2,t,n,r,i)}(this.localStore,this.datastore,e.asyncQueue,e2=&gt;__PRIVATE_syncEngineApplyOnlineStateChange(this.syncEngine,e2,0),function __PRIVATE_newConnectivityMonitor(){return __PRIVATE_BrowserConnectivityMonitor.C()?new __PRIVATE_BrowserConnectivityMonitor:new __PRIVATE_NoopConnectivityMonitor}())}createSyncEngine(e,t){return function __PRIVATE_newSyncEngine(e2,t2,n,r,i,s,o){const _=new __PRIVATE_SyncEngineImpl(e2,t2,n,r,i,s);return o&amp;&amp;(_.fu=!0),_}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){var e,t;await async function __PRIVATE_remoteStoreShutdown(e2){const t2=__PRIVATE_debugCast(e2);__PRIVATE_logDebug(Xt,"RemoteStore shutting down."),t2.Ia.add(5),await __PRIVATE_disableNetworkInternal(t2),t2.Ea.shutdown(),t2.Aa.set("Unknown")}(this.remoteStore),null===(e=this.datastore)||void 0===e||e.terminate(),null===(t=this.eventManager)||void 0===t||t.terminate()}}OnlineComponentProvider.provider={build:()=&gt;new OnlineComponentProvider};class __PRIVATE_AsyncObserver{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&amp;&amp;this.xu(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.xu(this.observer.error,e):__PRIVATE_logError("Uncaught Error in snapshot listener:",e.toString()))}Ou(){this.muted=!0}xu(e,t){setTimeout(()=&gt;{this.muted||e(t)},0)}}const rn="FirestoreClient";class FirestoreClient{constructor(e,t,n,r,i){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this.databaseInfo=r,this.user=User.UNAUTHENTICATED,this.clientId=__PRIVATE_AutoId.newId(),this.authCredentialListener=()=&gt;Promise.resolve(),this.appCheckCredentialListener=()=&gt;Promise.resolve(),this._uninitializedComponentsProvider=i,this.authCredentials.start(n,async e2=&gt;{__PRIVATE_logDebug(rn,"Received user=",e2.uid),await this.authCredentialListener(e2),this.user=e2}),this.appCheckCredentials.start(n,e2=&gt;(__PRIVATE_logDebug(rn,"Received new app check token=",e2),this.appCheckCredentialListener(e2,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new __PRIVATE_Deferred;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=&gt;{try{this._onlineComponents&amp;&amp;await this._onlineComponents.terminate(),this._offlineComponents&amp;&amp;await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const n=__PRIVATE_wrapInUserErrorIfRecoverable(t,"Failed to shutdown persistence");e.reject(n)}}),e.promise}}async function __PRIVATE_setOfflineComponentProvider(e,t){e.asyncQueue.verifyOperationInProgress(),__PRIVATE_logDebug(rn,"Initializing OfflineComponentProvider");const n=e.configuration;await t.initialize(n);let r=n.initialUser;e.setCredentialChangeListener(async e2=&gt;{r.isEqual(e2)||(await __PRIVATE_localStoreHandleUserChange(t.localStore,e2),r=e2)}),t.persistence.setDatabaseDeletedListener(()=&gt;{__PRIVATE_logWarn("Terminating Firestore due to IndexedDb database deletion"),e.terminate().then(()=&gt;{__PRIVATE_logDebug("Terminating Firestore due to IndexedDb database deletion completed successfully")}).catch(e2=&gt;{__PRIVATE_logWarn("Terminating Firestore due to IndexedDb database deletion failed",e2)})}),e._offlineComponents=t}async function __PRIVATE_setOnlineComponentProvider(e,t){e.asyncQueue.verifyOperationInProgress();const n=await async function __PRIVATE_ensureOfflineComponents(e){if(!e._offlineComponents)if(e._uninitializedComponentsProvider){__PRIVATE_logDebug(rn,"Using user provided OfflineComponentProvider");try{await __PRIVATE_setOfflineComponentProvider(e,e._uninitializedComponentsProvider._offline)}catch(t){const n=t;if(!function __PRIVATE_canFallbackFromIndexedDbError(e2){return"FirebaseError"===e2.name?e2.code===N.FAILED_PRECONDITION||e2.code===N.UNIMPLEMENTED:!("undefined"!=typeof DOMException&amp;&amp;e2 instanceof DOMException)||22===e2.code||20===e2.code||11===e2.code}(n))throw n;__PRIVATE_logWarn("Error using user provided cache. Falling back to memory cache: "+n),await __PRIVATE_setOfflineComponentProvider(e,new __PRIVATE_MemoryOfflineComponentProvider)}}else __PRIVATE_logDebug(rn,"Using default OfflineComponentProvider"),await __PRIVATE_setOfflineComponentProvider(e,new __PRIVATE_LruGcMemoryOfflineComponentProvider(void 0));return e._offlineComponents}(e);__PRIVATE_logDebug(rn,"Initializing OnlineComponentProvider"),await t.initialize(n,e.configuration),e.setCredentialChangeListener(e2=&gt;__PRIVATE_remoteStoreHandleCredentialChange(t.remoteStore,e2)),e.setAppCheckTokenChangeListener((e2,n2)=&gt;__PRIVATE_remoteStoreHandleCredentialChange(t.remoteStore,n2)),e._onlineComponents=t}async function __PRIVATE_ensureOnlineComponents(e){return e._onlineComponents||(e._uninitializedComponentsProvider?(__PRIVATE_logDebug(rn,"Using user provided OnlineComponentProvider"),await __PRIVATE_setOnlineComponentProvider(e,e._uninitializedComponentsProvider._online)):(__PRIVATE_logDebug(rn,"Using default OnlineComponentProvider"),await __PRIVATE_setOnlineComponentProvider(e,new OnlineComponentProvider))),e._onlineComponents}async function __PRIVATE_getEventManager(e){const t=await __PRIVATE_ensureOnlineComponents(e),n=t.eventManager;return n.onListen=__PRIVATE_syncEngineListen.bind(null,t.syncEngine),n.onUnlisten=__PRIVATE_syncEngineUnlisten.bind(null,t.syncEngine),n.onFirstRemoteStoreListen=__PRIVATE_triggerRemoteStoreListen.bind(null,t.syncEngine),n.onLastRemoteStoreUnlisten=__PRIVATE_triggerRemoteStoreUnlisten.bind(null,t.syncEngine),n}function __PRIVATE_cloneLongPollingOptions(e){const t={};return void 0!==e.timeoutSeconds&amp;&amp;(t.timeoutSeconds=e.timeoutSeconds),t}const sn=new Map,on="firestore.googleapis.com";class FirestoreSettingsImpl{constructor(e){var t,n;if(void 0===e.host){if(void 0!==e.ssl)throw new FirestoreError(N.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=on,this.ssl=true}else this.host=e.host,this.ssl=null===(t=e.ssl)||void 0===t||t;if(this.isUsingEmulator=void 0!==e.emulatorOptions,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,void 0===e.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==e.cacheSizeBytes&amp;&amp;e.cacheSizeBytes&lt;1048576)throw new FirestoreError(N.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}__PRIVATE_validateIsNotUsedTogether("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:void 0===e.experimentalAutoDetectLongPolling?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=__PRIVATE_cloneLongPollingOptions(null!==(n=e.experimentalLongPollingOptions)&amp;&amp;void 0!==n?n:{}),function __PRIVATE_validateLongPollingOptions(e2){if(void 0!==e2.timeoutSeconds){if(isNaN(e2.timeoutSeconds))throw new FirestoreError(N.INVALID_ARGUMENT,`invalid long polling timeout: ${e2.timeoutSeconds} (must not be NaN)`);if(e2.timeoutSeconds&lt;5)throw new FirestoreError(N.INVALID_ARGUMENT,`invalid long polling timeout: ${e2.timeoutSeconds} (minimum allowed value is 5)`);if(e2.timeoutSeconds&gt;30)throw new FirestoreError(N.INVALID_ARGUMENT,`invalid long polling timeout: ${e2.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&amp;&amp;this.ssl===e.ssl&amp;&amp;this.credentials===e.credentials&amp;&amp;this.cacheSizeBytes===e.cacheSizeBytes&amp;&amp;this.experimentalForceLongPolling===e.experimentalForceLongPolling&amp;&amp;this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&amp;&amp;function __PRIVATE_longPollingOptionsEqual(e2,t){return e2.timeoutSeconds===t.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&amp;&amp;this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&amp;&amp;this.useFetchStreams===e.useFetchStreams}}class Firestore$1{constructor(e,t,n,r){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=n,this._app=r,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new FirestoreSettingsImpl({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new FirestoreError(N.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return"notTerminated"!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new FirestoreError(N.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new FirestoreSettingsImpl(e),this._emulatorOptions=e.emulatorOptions||{},void 0!==e.credentials&amp;&amp;(this._authCredentials=function __PRIVATE_makeAuthCredentialsProvider(e2){if(!e2)return new __PRIVATE_EmptyAuthCredentialsProvider;switch(e2.type){case"firstParty":return new __PRIVATE_FirstPartyAuthCredentialsProvider(e2.sessionIndex||"0",e2.iamToken||null,e2.authTokenFactory||null);case"provider":return e2.client;default:throw new FirestoreError(N.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return"notTerminated"===this._terminateTask&amp;&amp;(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){"notTerminated"===this._terminateTask?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function __PRIVATE_removeComponents(e){const t=sn.get(e);t&amp;&amp;(__PRIVATE_logDebug("ComponentProvider","Removing Datastore"),sn.delete(e),t.terminate())}(this),Promise.resolve()}}function connectFirestoreEmulator(e,t,n,r={}){var i;e=__PRIVATE_cast(e,Firestore$1);const s=isCloudWorkstation(t),o=e._getSettings(),_=Object.assign(Object.assign({},o),{emulatorOptions:e._getEmulatorOptions()}),a=`${t}:${n}`;s&amp;&amp;(pingServer(`https://${a}`),updateEmulatorBanner("Firestore",!0)),o.host!==on&amp;&amp;o.host!==a&amp;&amp;__PRIVATE_logWarn("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const u=Object.assign(Object.assign({},o),{host:a,ssl:s,emulatorOptions:r});if(!deepEqual(u,_)&amp;&amp;(e._setSettings(u),r.mockUserToken)){let t2,n2;if("string"==typeof r.mockUserToken)t2=r.mockUserToken,n2=User.MOCK_USER;else{t2=createMockUserToken(r.mockUserToken,null===(i=e._app)||void 0===i?void 0:i.options.projectId);const s2=r.mockUserToken.sub||r.mockUserToken.user_id;if(!s2)throw new FirestoreError(N.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");n2=new User(s2)}e._authCredentials=new __PRIVATE_EmulatorAuthCredentialsProvider(new __PRIVATE_OAuthToken(t2,n2))}}class Query{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new Query(this.firestore,e,this._query)}}class DocumentReference{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new CollectionReference(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new DocumentReference(this.firestore,e,this._key)}toJSON(){return{type:DocumentReference._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,t,n){if(__PRIVATE_validateJSON(t,DocumentReference._jsonSchema))return new DocumentReference(e,n||null,new DocumentKey(ResourcePath.fromString(t.referencePath)))}}DocumentReference._jsonSchemaVersion="firestore/documentReference/1.0",DocumentReference._jsonSchema={type:property("string",DocumentReference._jsonSchemaVersion),referencePath:property("string")};class CollectionReference extends Query{constructor(e,t,n){super(e,t,__PRIVATE_newQueryForPath(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new DocumentReference(this.firestore,null,new DocumentKey(e))}withConverter(e){return new CollectionReference(this.firestore,e,this._path)}}function collection(e,t,...n){if(e=getModularInstance(e),__PRIVATE_validateNonEmptyArgument("collection","path",t),e instanceof Firestore$1){const r=ResourcePath.fromString(t,...n);return __PRIVATE_validateCollectionPath(r),new CollectionReference(e,null,r)}{if(!(e instanceof DocumentReference||e instanceof CollectionReference))throw new FirestoreError(N.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=e._path.child(ResourcePath.fromString(t,...n));return __PRIVATE_validateCollectionPath(r),new CollectionReference(e.firestore,null,r)}}function doc(e,t,...n){if(e=getModularInstance(e),1===arguments.length&amp;&amp;(t=__PRIVATE_AutoId.newId()),__PRIVATE_validateNonEmptyArgument("doc","path",t),e instanceof Firestore$1){const r=ResourcePath.fromString(t,...n);return __PRIVATE_validateDocumentPath(r),new DocumentReference(e,null,new DocumentKey(r))}{if(!(e instanceof DocumentReference||e instanceof CollectionReference))throw new FirestoreError(N.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=e._path.child(ResourcePath.fromString(t,...n));return __PRIVATE_validateDocumentPath(r),new DocumentReference(e.firestore,e instanceof CollectionReference?e.converter:null,new DocumentKey(r))}}const an="AsyncQueue";class __PRIVATE_AsyncQueueImpl{constructor(e=Promise.resolve()){this.Zu=[],this.Xu=!1,this.ec=[],this.tc=null,this.nc=!1,this.rc=!1,this.sc=[],this.F_=new __PRIVATE_ExponentialBackoff(this,"async_queue_retry"),this.oc=()=&gt;{const e2=getDocument();e2&amp;&amp;__PRIVATE_logDebug(an,"Visibility state changed to "+e2.visibilityState),this.F_.y_()},this._c=e;const t=getDocument();t&amp;&amp;"function"==typeof t.addEventListener&amp;&amp;t.addEventListener("visibilitychange",this.oc)}get isShuttingDown(){return this.Xu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.ac(),this.uc(e)}enterRestrictedMode(e){if(!this.Xu){this.Xu=!0,this.rc=e||!1;const t=getDocument();t&amp;&amp;"function"==typeof t.removeEventListener&amp;&amp;t.removeEventListener("visibilitychange",this.oc)}}enqueue(e){if(this.ac(),this.Xu)return new Promise(()=&gt;{});const t=new __PRIVATE_Deferred;return this.uc(()=&gt;this.Xu&amp;&amp;this.rc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=&gt;t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=&gt;(this.Zu.push(e),this.cc()))}async cc(){if(0!==this.Zu.length){try{await this.Zu[0](),this.Zu.shift(),this.F_.reset()}catch(e){if(!__PRIVATE_isIndexedDbTransactionError(e))throw e;__PRIVATE_logDebug(an,"Operation failed with retryable error: "+e)}this.Zu.length&gt;0&amp;&amp;this.F_.g_(()=&gt;this.cc())}}uc(e){const t=this._c.then(()=&gt;(this.nc=!0,e().catch(e2=&gt;{throw this.tc=e2,this.nc=!1,__PRIVATE_logError("INTERNAL UNHANDLED ERROR: ",__PRIVATE_getMessageOrStack(e2)),e2}).then(e2=&gt;(this.nc=!1,e2))));return this._c=t,t}enqueueAfterDelay(e,t,n){this.ac(),this.sc.indexOf(e)&gt;-1&amp;&amp;(t=0);const r=DelayedOperation.createAndSchedule(this,e,t,n,e2=&gt;this.lc(e2));return this.ec.push(r),r}ac(){this.tc&amp;&amp;fail(47125,{hc:__PRIVATE_getMessageOrStack(this.tc)})}verifyOperationInProgress(){}async Pc(){let e;do{e=this._c,await e}while(e!==this._c)}Tc(e){for(const t of this.ec)if(t.timerId===e)return!0;return!1}Ic(e){return this.Pc().then(()=&gt;{this.ec.sort((e2,t)=&gt;e2.targetTimeMs-t.targetTimeMs);for(const t of this.ec)if(t.skipDelay(),"all"!==e&amp;&amp;t.timerId===e)break;return this.Pc()})}dc(e){this.sc.push(e)}lc(e){const t=this.ec.indexOf(e);this.ec.splice(t,1)}}function __PRIVATE_getMessageOrStack(e){let t=e.message||"";return e.stack&amp;&amp;(t=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),t}function __PRIVATE_isPartialObserver(e){return function __PRIVATE_implementsAnyMethods(e2,t){if("object"!=typeof e2||null===e2)return!1;const n=e2;for(const e3 of t)if(e3 in n&amp;&amp;"function"==typeof n[e3])return!0;return!1}(e,["next","error","complete"])}class Firestore extends Firestore$1{constructor(e,t,n,r){super(e,t,n,r),this.type="firestore",this._queue=new __PRIVATE_AsyncQueueImpl,this._persistenceKey=(null==r?void 0:r.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new __PRIVATE_AsyncQueueImpl(e),this._firestoreClient=void 0,await e}}}function initializeFirestore(e,t,n){n||(n=ut);const r=_getProvider(e,"firestore");if(r.isInitialized(n)){const e2=r.getImmediate({identifier:n});if(deepEqual(r.getOptions(n),t))return e2;throw new FirestoreError(N.FAILED_PRECONDITION,"initializeFirestore() has already been called with different options. To avoid this error, call initializeFirestore() with the same options as when it was originally called, or call getFirestore() to return the already initialized instance.")}if(void 0!==t.cacheSizeBytes&amp;&amp;void 0!==t.localCache)throw new FirestoreError(N.INVALID_ARGUMENT,"cache and cacheSizeBytes cannot be specified at the same time as cacheSizeBytes willbe deprecated. Instead, specify the cache size in the cache object");if(void 0!==t.cacheSizeBytes&amp;&amp;-1!==t.cacheSizeBytes&amp;&amp;t.cacheSizeBytes&lt;1048576)throw new FirestoreError(N.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");return t.host&amp;&amp;isCloudWorkstation(t.host)&amp;&amp;pingServer(t.host),r.initialize({options:t,instanceIdentifier:n})}function getFirestore(e,n){const r=getApp(),i=ut,s=_getProvider(r,"firestore").getImmediate({identifier:i});if(!s._initialized){const e2=getDefaultEmulatorHostnameAndPort("firestore");e2&amp;&amp;connectFirestoreEmulator(s,...e2)}return s}function ensureFirestoreConfigured(e){if(e._terminated)throw new FirestoreError(N.FAILED_PRECONDITION,"The client has already been terminated.");return e._firestoreClient||function __PRIVATE_configureFirestore(e){var t,n,r;const i=e._freezeSettings(),s=function __PRIVATE_makeDatabaseInfo(e2,t2,n2,r2){return new DatabaseInfo(e2,t2,n2,r2.host,r2.ssl,r2.experimentalForceLongPolling,r2.experimentalAutoDetectLongPolling,__PRIVATE_cloneLongPollingOptions(r2.experimentalLongPollingOptions),r2.useFetchStreams,r2.isUsingEmulator)}(e._databaseId,(null===(t=e._app)||void 0===t?void 0:t.options.appId)||"",e._persistenceKey,i);e._componentsProvider||(null===(n=i.localCache)||void 0===n?void 0:n._offlineComponentProvider)&amp;&amp;(null===(r=i.localCache)||void 0===r?void 0:r._onlineComponentProvider)&amp;&amp;(e._componentsProvider={_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider}),e._firestoreClient=new FirestoreClient(e._authCredentials,e._appCheckCredentials,e._queue,s,e._componentsProvider&amp;&amp;function __PRIVATE_buildComponentProvider(e2){const t2=null==e2?void 0:e2._online.build();return{_offline:null==e2?void 0:e2._offline.build(t2),_online:t2}}(e._componentsProvider))}(e),e._firestoreClient}function clearIndexedDbPersistence(e){if(e._initialized&amp;&amp;!e._terminated)throw new FirestoreError(N.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");const t=new __PRIVATE_Deferred;return e._queue.enqueueAndForgetEvenWhileRestricted(async()=&gt;{try{await async function __PRIVATE_indexedDbClearPersistence(e2){if(!__PRIVATE_SimpleDb.C())return Promise.resolve();const t2=e2+"main";await __PRIVATE_SimpleDb.delete(t2)}(__PRIVATE_indexedDbStoragePrefix(e._databaseId,e._persistenceKey)),t.resolve()}catch(e2){t.reject(e2)}}),t.promise}function terminate(e){return function _removeServiceInstance(app,name2,instanceIdentifier="[DEFAULT]"){_getProvider(app,name2).clearInstance(instanceIdentifier)}(e.app,"firestore",e._databaseId.database),e._delete()}class Bytes{constructor(e){this._byteString=e}static fromBase64String(e){try{return new Bytes(ByteString.fromBase64String(e))}catch(e2){throw new FirestoreError(N.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e2)}}static fromUint8Array(e){return new Bytes(ByteString.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:Bytes._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(__PRIVATE_validateJSON(e,Bytes._jsonSchema))return Bytes.fromBase64String(e.bytes)}}Bytes._jsonSchemaVersion="firestore/bytes/1.0",Bytes._jsonSchema={type:property("string",Bytes._jsonSchemaVersion),bytes:property("string")};class FieldPath{constructor(...e){for(let t=0;t&lt;e.length;++t)if(0===e[t].length)throw new FirestoreError(N.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new FieldPath$1(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class FieldValue{constructor(e){this._methodName=e}}class GeoPoint{constructor(e,t){if(!isFinite(e)||e&lt;-90||e&gt;90)throw new FirestoreError(N.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t&lt;-180||t&gt;180)throw new FirestoreError(N.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&amp;&amp;this._long===e._long}_compareTo(e){return __PRIVATE_primitiveComparator(this._lat,e._lat)||__PRIVATE_primitiveComparator(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:GeoPoint._jsonSchemaVersion}}static fromJSON(e){if(__PRIVATE_validateJSON(e,GeoPoint._jsonSchema))return new GeoPoint(e.latitude,e.longitude)}}GeoPoint._jsonSchemaVersion="firestore/geoPoint/1.0",GeoPoint._jsonSchema={type:property("string",GeoPoint._jsonSchemaVersion),latitude:property("number"),longitude:property("number")};class VectorValue{constructor(e){this._values=(e||[]).map(e2=&gt;e2)}toArray(){return this._values.map(e=&gt;e)}isEqual(e){return function __PRIVATE_isPrimitiveArrayEqual(e2,t){if(e2.length!==t.length)return!1;for(let n=0;n&lt;e2.length;++n)if(e2[n]!==t[n])return!1;return!0}(this._values,e._values)}toJSON(){return{type:VectorValue._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(__PRIVATE_validateJSON(e,VectorValue._jsonSchema)){if(Array.isArray(e.vectorValues)&amp;&amp;e.vectorValues.every(e2=&gt;"number"==typeof e2))return new VectorValue(e.vectorValues);throw new FirestoreError(N.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}VectorValue._jsonSchemaVersion="firestore/vectorValue/1.0",VectorValue._jsonSchema={type:property("string",VectorValue._jsonSchemaVersion),vectorValues:property("object")};const cn=/^__.*__$/;class ParsedSetData{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return null!==this.fieldMask?new __PRIVATE_PatchMutation(e,this.data,this.fieldMask,t,this.fieldTransforms):new __PRIVATE_SetMutation(e,this.data,t,this.fieldTransforms)}}class ParsedUpdateData{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return new __PRIVATE_PatchMutation(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function __PRIVATE_isWrite(e){switch(e){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw fail(40011,{Ec:e})}}class __PRIVATE_ParseContextImpl{constructor(e,t,n,r,i,s){this.settings=e,this.databaseId=t,this.serializer=n,this.ignoreUndefinedProperties=r,void 0===i&amp;&amp;this.Ac(),this.fieldTransforms=i||[],this.fieldMask=s||[]}get path(){return this.settings.path}get Ec(){return this.settings.Ec}Rc(e){return new __PRIVATE_ParseContextImpl(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Vc(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.Rc({path:n,mc:!1});return r.fc(e),r}gc(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.Rc({path:n,mc:!1});return r.Ac(),r}yc(e){return this.Rc({path:void 0,mc:!0})}wc(e){return __PRIVATE_createError(e,this.settings.methodName,this.settings.Sc||!1,this.path,this.settings.bc)}contains(e){return void 0!==this.fieldMask.find(t=&gt;e.isPrefixOf(t))||void 0!==this.fieldTransforms.find(t=&gt;e.isPrefixOf(t.field))}Ac(){if(this.path)for(let e=0;e&lt;this.path.length;e++)this.fc(this.path.get(e))}fc(e){if(0===e.length)throw this.wc("Document fields must not be empty");if(__PRIVATE_isWrite(this.Ec)&amp;&amp;cn.test(e))throw this.wc('Document fields cannot begin and end with "__"')}}class __PRIVATE_UserDataReader{constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=n||__PRIVATE_newSerializer(e)}Dc(e,t,n,r=!1){return new __PRIVATE_ParseContextImpl({Ec:e,methodName:t,bc:n,path:FieldPath$1.emptyPath(),mc:!1,Sc:r},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function __PRIVATE_newUserDataReader(e){const t=e._freezeSettings(),n=__PRIVATE_newSerializer(e._databaseId);return new __PRIVATE_UserDataReader(e._databaseId,!!t.ignoreUndefinedProperties,n)}function __PRIVATE_parseSetData(e,t,n,r,i,s={}){const o=e.Dc(s.merge||s.mergeFields?2:0,t,n,i);__PRIVATE_validatePlainObject("Data must be an object, but it was:",o,r);const _=__PRIVATE_parseObject(r,o);let a,u;if(s.merge)a=new FieldMask(o.fieldMask),u=o.fieldTransforms;else if(s.mergeFields){const e2=[];for(const r2 of s.mergeFields){const i2=__PRIVATE_fieldPathFromArgument$1(t,r2,n);if(!o.contains(i2))throw new FirestoreError(N.INVALID_ARGUMENT,`Field '${i2}' is specified in your field mask but missing from your input data.`);__PRIVATE_fieldMaskContains(e2,i2)||e2.push(i2)}a=new FieldMask(e2),u=o.fieldTransforms.filter(e3=&gt;a.covers(e3.field))}else a=null,u=o.fieldTransforms;return new ParsedSetData(new ObjectValue(_),a,u)}class __PRIVATE_DeleteFieldValueImpl extends FieldValue{_toFieldTransform(e){if(2!==e.Ec)throw 1===e.Ec?e.wc(`${this._methodName}() can only appear at the top level of your update data`):e.wc(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof __PRIVATE_DeleteFieldValueImpl}}class __PRIVATE_ServerTimestampFieldValueImpl extends FieldValue{_toFieldTransform(e){return new FieldTransform(e.path,new __PRIVATE_ServerTimestampTransform)}isEqual(e){return e instanceof __PRIVATE_ServerTimestampFieldValueImpl}}function __PRIVATE_parseData(e,t){if(__PRIVATE_looksLikeJsonObject(e=getModularInstance(e)))return __PRIVATE_validatePlainObject("Unsupported field value:",t,e),__PRIVATE_parseObject(e,t);if(e instanceof FieldValue)return function __PRIVATE_parseSentinelFieldValue(e2,t2){if(!__PRIVATE_isWrite(t2.Ec))throw t2.wc(`${e2._methodName}() can only be used with update() and set()`);if(!t2.path)throw t2.wc(`${e2._methodName}() is not currently supported inside arrays`);const n=e2._toFieldTransform(t2);n&amp;&amp;t2.fieldTransforms.push(n)}(e,t),null;if(void 0===e&amp;&amp;t.ignoreUndefinedProperties)return null;if(t.path&amp;&amp;t.fieldMask.push(t.path),e instanceof Array){if(t.settings.mc&amp;&amp;4!==t.Ec)throw t.wc("Nested arrays are not supported");return function __PRIVATE_parseArray(e2,t2){const n=[];let r=0;for(const i of e2){let e3=__PRIVATE_parseData(i,t2.yc(r));null==e3&amp;&amp;(e3={nullValue:"NULL_VALUE"}),n.push(e3),r++}return{arrayValue:{values:n}}}(e,t)}return function __PRIVATE_parseScalarValue(e2,t2){if(null===(e2=getModularInstance(e2)))return{nullValue:"NULL_VALUE"};if("number"==typeof e2)return function toNumber(e,t){return isSafeInteger(t)?__PRIVATE_toInteger(t):__PRIVATE_toDouble(e,t)}(t2.serializer,e2);if("boolean"==typeof e2)return{booleanValue:e2};if("string"==typeof e2)return{stringValue:e2};if(e2 instanceof Date){const n=Timestamp.fromDate(e2);return{timestampValue:toTimestamp(t2.serializer,n)}}if(e2 instanceof Timestamp){const n=new Timestamp(e2.seconds,1e3*Math.floor(e2.nanoseconds/1e3));return{timestampValue:toTimestamp(t2.serializer,n)}}if(e2 instanceof GeoPoint)return{geoPointValue:{latitude:e2.latitude,longitude:e2.longitude}};if(e2 instanceof Bytes)return{bytesValue:__PRIVATE_toBytes(t2.serializer,e2._byteString)};if(e2 instanceof DocumentReference){const n=t2.databaseId,r=e2.firestore._databaseId;if(!r.isEqual(n))throw t2.wc(`Document reference is for database ${r.projectId}/${r.database} but should be for database ${n.projectId}/${n.database}`);return{referenceValue:__PRIVATE_toResourceName(e2.firestore._databaseId||t2.databaseId,e2._key.path)}}if(e2 instanceof VectorValue)return function __PRIVATE_parseVectorValue(e3,t3){return{mapValue:{fields:{[ct]:{stringValue:Pt},[Tt]:{arrayValue:{values:e3.toArray().map(e4=&gt;{if("number"!=typeof e4)throw t3.wc("VectorValues must only contain numeric values.");return __PRIVATE_toDouble(t3.serializer,e4)})}}}}}}(e2,t2);throw t2.wc(`Unsupported field value: ${__PRIVATE_valueDescription(e2)}`)}(e,t)}function __PRIVATE_parseObject(e,t){const n={};return isEmpty(e)?t.path&amp;&amp;t.path.length&gt;0&amp;&amp;t.fieldMask.push(t.path):forEach(e,(e2,r)=&gt;{const i=__PRIVATE_parseData(r,t.Vc(e2));null!=i&amp;&amp;(n[e2]=i)}),{mapValue:{fields:n}}}function __PRIVATE_looksLikeJsonObject(e){return!("object"!=typeof e||null===e||e instanceof Array||e instanceof Date||e instanceof Timestamp||e instanceof GeoPoint||e instanceof Bytes||e instanceof DocumentReference||e instanceof FieldValue||e instanceof VectorValue)}function __PRIVATE_validatePlainObject(e,t,n){if(!__PRIVATE_looksLikeJsonObject(n)||!__PRIVATE_isPlainObject(n)){const r=__PRIVATE_valueDescription(n);throw"an object"===r?t.wc(e+" a custom object"):t.wc(e+" "+r)}}function __PRIVATE_fieldPathFromArgument$1(e,t,n){if((t=getModularInstance(t))instanceof FieldPath)return t._internalPath;if("string"==typeof t)return __PRIVATE_fieldPathFromDotSeparatedString(e,t);throw __PRIVATE_createError("Field path arguments must be of type string or ",e,!1,void 0,n)}const ln=new RegExp("[~\\*/\\[\\]]");function __PRIVATE_fieldPathFromDotSeparatedString(e,t,n){if(t.search(ln)&gt;=0)throw __PRIVATE_createError(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,e,!1,void 0,n);try{return new FieldPath(...t.split("."))._internalPath}catch(r){throw __PRIVATE_createError(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,e,!1,void 0,n)}}function __PRIVATE_createError(e,t,n,r,i){const s=r&amp;&amp;!r.isEmpty(),o=void 0!==i;let _=`Function ${t}() called with invalid data`;n&amp;&amp;(_+=" (via `toFirestore()`)"),_+=". ";let a="";return(s||o)&amp;&amp;(a+=" (found",s&amp;&amp;(a+=` in field ${r}`),o&amp;&amp;(a+=` in document ${i}`),a+=")"),new FirestoreError(N.INVALID_ARGUMENT,_+e+a)}function __PRIVATE_fieldMaskContains(e,t){return e.some(e2=&gt;e2.isEqual(t))}class DocumentSnapshot$1{constructor(e,t,n,r,i){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=r,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new DocumentReference(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const e=new QueryDocumentSnapshot$1(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(__PRIVATE_fieldPathFromArgument("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class QueryDocumentSnapshot$1 extends DocumentSnapshot$1{data(){return super.data()}}function __PRIVATE_fieldPathFromArgument(e,t){return"string"==typeof t?__PRIVATE_fieldPathFromDotSeparatedString(e,t):t instanceof FieldPath?t._internalPath:t._delegate._internalPath}function __PRIVATE_validateHasExplicitOrderByForLimitToLast(e){if("L"===e.limitType&amp;&amp;0===e.explicitOrderBy.length)throw new FirestoreError(N.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class AppliableConstraint{}class QueryConstraint extends AppliableConstraint{}function query(e,t,...n){let r=[];t instanceof AppliableConstraint&amp;&amp;r.push(t),r=r.concat(n),function __PRIVATE_validateQueryConstraintArray(e2){const t2=e2.filter(e3=&gt;e3 instanceof QueryCompositeFilterConstraint).length,n2=e2.filter(e3=&gt;e3 instanceof QueryFieldFilterConstraint).length;if(t2&gt;1||t2&gt;0&amp;&amp;n2&gt;0)throw new FirestoreError(N.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(const t2 of r)e=t2._apply(e);return e}class QueryFieldFilterConstraint extends QueryConstraint{constructor(e,t,n){super(),this._field=e,this._op=t,this._value=n,this.type="where"}static _create(e,t,n){return new QueryFieldFilterConstraint(e,t,n)}_apply(e){const t=this._parse(e);return __PRIVATE_validateNewFieldFilter(e._query,t),new Query(e.firestore,e.converter,__PRIVATE_queryWithAddedFilter(e._query,t))}_parse(e){const t=__PRIVATE_newUserDataReader(e.firestore),n=function __PRIVATE_newQueryFilter(e2,t2,n2,r,i,s,o){let _;if(i.isKeyField()){if("array-contains"===s||"array-contains-any"===s)throw new FirestoreError(N.INVALID_ARGUMENT,`Invalid Query. You can't perform '${s}' queries on documentId().`);if("in"===s||"not-in"===s){__PRIVATE_validateDisjunctiveFilterElements(o,s);const t3=[];for(const n3 of o)t3.push(__PRIVATE_parseDocumentIdValue(r,e2,n3));_={arrayValue:{values:t3}}}else _=__PRIVATE_parseDocumentIdValue(r,e2,o)}else"in"!==s&amp;&amp;"not-in"!==s&amp;&amp;"array-contains-any"!==s||__PRIVATE_validateDisjunctiveFilterElements(o,s),_=function __PRIVATE_parseQueryValue(e,t,n,r=!1){return __PRIVATE_parseData(n,e.Dc(r?4:3,t))}(n2,t2,o,"in"===s||"not-in"===s);return FieldFilter.create(i,s,_)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value);return n}}function where(e,t,n){const r=t,i=__PRIVATE_fieldPathFromArgument("where",e);return QueryFieldFilterConstraint._create(i,r,n)}class QueryCompositeFilterConstraint extends AppliableConstraint{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new QueryCompositeFilterConstraint(e,t)}_parse(e){const t=this._queryConstraints.map(t2=&gt;t2._parse(e)).filter(e2=&gt;e2.getFilters().length&gt;0);return 1===t.length?t[0]:CompositeFilter.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return 0===t.getFilters().length?e:(function __PRIVATE_validateNewFilter(e2,t2){let n=e2;const r=t2.getFlattenedFilters();for(const e3 of r)__PRIVATE_validateNewFieldFilter(n,e3),n=__PRIVATE_queryWithAddedFilter(n,e3)}(e._query,t),new Query(e.firestore,e.converter,__PRIVATE_queryWithAddedFilter(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}class QueryOrderByConstraint extends QueryConstraint{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new QueryOrderByConstraint(e,t)}_apply(e){const t=function __PRIVATE_newQueryOrderBy(e2,t2,n){if(null!==e2.startAt)throw new FirestoreError(N.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==e2.endAt)throw new FirestoreError(N.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new OrderBy(t2,n)}(e._query,this._field,this._direction);return new Query(e.firestore,e.converter,function __PRIVATE_queryWithAddedOrderBy(e2,t2){const n=e2.explicitOrderBy.concat([t2]);return new __PRIVATE_QueryImpl(e2.path,e2.collectionGroup,n,e2.filters.slice(),e2.limit,e2.limitType,e2.startAt,e2.endAt)}(e._query,t))}}function orderBy(e,t="asc"){const n=t,r=__PRIVATE_fieldPathFromArgument("orderBy",e);return QueryOrderByConstraint._create(r,n)}function __PRIVATE_parseDocumentIdValue(e,t,n){if("string"==typeof(n=getModularInstance(n))){if(""===n)throw new FirestoreError(N.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!__PRIVATE_isCollectionGroupQuery(t)&amp;&amp;-1!==n.indexOf("/"))throw new FirestoreError(N.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);const r=t.path.child(ResourcePath.fromString(n));if(!DocumentKey.isDocumentKey(r))throw new FirestoreError(N.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return __PRIVATE_refValue(e,new DocumentKey(r))}if(n instanceof DocumentReference)return __PRIVATE_refValue(e,n._key);throw new FirestoreError(N.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${__PRIVATE_valueDescription(n)}.`)}function __PRIVATE_validateDisjunctiveFilterElements(e,t){if(!Array.isArray(e)||0===e.length)throw new FirestoreError(N.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${t.toString()}' filters.`)}function __PRIVATE_validateNewFieldFilter(e,t){const n=function __PRIVATE_findOpInsideFilters(e2,t2){for(const n2 of e2)for(const e3 of n2.getFlattenedFilters())if(t2.indexOf(e3.op)&gt;=0)return e3.op;return null}(e.filters,function __PRIVATE_conflictingOps(e2){switch(e2){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(t.op));if(null!==n)throw n===t.op?new FirestoreError(N.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${t.op.toString()}' filter.`):new FirestoreError(N.INVALID_ARGUMENT,`Invalid query. You cannot use '${t.op.toString()}' filters with '${n.toString()}' filters.`)}class AbstractUserDataWriter{convertValue(e,t="none"){switch(__PRIVATE_typeOrder(e)){case 0:return null;case 1:return e.booleanValue;case 2:return __PRIVATE_normalizeNumber(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(__PRIVATE_normalizeByteString(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw fail(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const n={};return forEach(e,(e2,r)=&gt;{n[e2]=this.convertValue(r,t)}),n}convertVectorValue(e){var t,n,r;const i=null===(r=null===(n=null===(t=e.fields)||void 0===t?void 0:t[Tt].arrayValue)||void 0===n?void 0:n.values)||void 0===r?void 0:r.map(e2=&gt;__PRIVATE_normalizeNumber(e2.doubleValue));return new VectorValue(i)}convertGeoPoint(e){return new GeoPoint(__PRIVATE_normalizeNumber(e.latitude),__PRIVATE_normalizeNumber(e.longitude))}convertArray(e,t){return(e.values||[]).map(e2=&gt;this.convertValue(e2,t))}convertServerTimestamp(e,t){switch(t){case"previous":const n=__PRIVATE_getPreviousValue(e);return null==n?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(__PRIVATE_getLocalWriteTime(e));default:return null}}convertTimestamp(e){const t=__PRIVATE_normalizeTimestamp(e);return new Timestamp(t.seconds,t.nanos)}convertDocumentKey(e,t){const n=ResourcePath.fromString(e);__PRIVATE_hardAssert(__PRIVATE_isValidResourceName(n),9688,{name:e});const r=new DatabaseId(n.get(1),n.get(3)),i=new DocumentKey(n.popFirst(5));return r.isEqual(t)||__PRIVATE_logError(`Document ${i} contains a document reference within a different database (${r.projectId}/${r.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}function __PRIVATE_applyFirestoreDataConverter(e,t,n){let r;return r=e?n&amp;&amp;(n.merge||n.mergeFields)?e.toFirestore(t,n):e.toFirestore(t):t,r}class SnapshotMetadata{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&amp;&amp;this.fromCache===e.fromCache}}class DocumentSnapshot extends DocumentSnapshot$1{constructor(e,t,n,r,i,s){super(e,t,n,r,s),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new QueryDocumentSnapshot(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const n=this._document.data.field(__PRIVATE_fieldPathFromArgument("DocumentSnapshot.get",e));if(null!==n)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new FirestoreError(N.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e=this._document,t={};return t.type=DocumentSnapshot._jsonSchemaVersion,t.bundle="",t.bundleSource="DocumentSnapshot",t.bundleName=this._key.toString(),e&amp;&amp;e.isValidDocument()&amp;&amp;e.isFoundDocument()?(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),t.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),t):t}}DocumentSnapshot._jsonSchemaVersion="firestore/documentSnapshot/1.0",DocumentSnapshot._jsonSchema={type:property("string",DocumentSnapshot._jsonSchemaVersion),bundleSource:property("string","DocumentSnapshot"),bundleName:property("string"),bundle:property("string")};class QueryDocumentSnapshot extends DocumentSnapshot{data(e={}){return super.data(e)}}class QuerySnapshot{constructor(e,t,n,r){this._firestore=e,this._userDataWriter=t,this._snapshot=r,this.metadata=new SnapshotMetadata(r.hasPendingWrites,r.fromCache),this.query=n}get docs(){const e=[];return this.forEach(t=&gt;e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach(n=&gt;{e.call(t,new QueryDocumentSnapshot(this._firestore,this._userDataWriter,n.key,n,new SnapshotMetadata(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&amp;&amp;this._snapshot.excludesMetadataChanges)throw new FirestoreError(N.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&amp;&amp;this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function __PRIVATE_changesFromSnapshot(e2,t2){if(e2._snapshot.oldDocs.isEmpty()){let t3=0;return e2._snapshot.docChanges.map(n=&gt;{const r=new QueryDocumentSnapshot(e2._firestore,e2._userDataWriter,n.doc.key,n.doc,new SnapshotMetadata(e2._snapshot.mutatedKeys.has(n.doc.key),e2._snapshot.fromCache),e2.query.converter);return n.doc,{type:"added",doc:r,oldIndex:-1,newIndex:t3++}})}{let n=e2._snapshot.oldDocs;return e2._snapshot.docChanges.filter(e3=&gt;t2||3!==e3.type).map(t3=&gt;{const r=new QueryDocumentSnapshot(e2._firestore,e2._userDataWriter,t3.doc.key,t3.doc,new SnapshotMetadata(e2._snapshot.mutatedKeys.has(t3.doc.key),e2._snapshot.fromCache),e2.query.converter);let i=-1,s=-1;return 0!==t3.type&amp;&amp;(i=n.indexOf(t3.doc.key),n=n.delete(t3.doc.key)),1!==t3.type&amp;&amp;(n=n.add(t3.doc),s=n.indexOf(t3.doc.key)),{type:__PRIVATE_resultChangeType(t3.type),doc:r,oldIndex:i,newIndex:s}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new FirestoreError(N.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e={};e.type=QuerySnapshot._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=__PRIVATE_AutoId.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const t=[],n=[],r=[];return this.docs.forEach(e2=&gt;{null!==e2._document&amp;&amp;(t.push(e2._document),n.push(this._userDataWriter.convertObjectMap(e2._document.data.value.mapValue.fields,"previous")),r.push(e2.ref.path))}),e.bundle=(this._firestore,this.query._query,e.bundleName,"NOT SUPPORTED"),e}}function __PRIVATE_resultChangeType(e){switch(e){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return fail(61501,{type:e})}}function getDoc(e){e=__PRIVATE_cast(e,DocumentReference);const t=__PRIVATE_cast(e.firestore,Firestore);return function __PRIVATE_firestoreClientGetDocumentViaSnapshotListener(e,t,n={}){const r=new __PRIVATE_Deferred;return e.asyncQueue.enqueueAndForget(async()=&gt;function __PRIVATE_readDocumentViaSnapshotListener(e2,t2,n2,r2,i){const s=new __PRIVATE_AsyncObserver({next:_=&gt;{s.Ou(),t2.enqueueAndForget(()=&gt;__PRIVATE_eventManagerUnlisten(e2,o));const a=_.docs.has(n2);!a&amp;&amp;_.fromCache?i.reject(new FirestoreError(N.UNAVAILABLE,"Failed to get document because the client is offline.")):a&amp;&amp;_.fromCache&amp;&amp;r2&amp;&amp;"server"===r2.source?i.reject(new FirestoreError(N.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):i.resolve(_)},error:e3=&gt;i.reject(e3)}),o=new __PRIVATE_QueryListener(__PRIVATE_newQueryForPath(n2.path),s,{includeMetadataChanges:!0,ka:!0});return __PRIVATE_eventManagerListen(e2,o)}(await __PRIVATE_getEventManager(e),e.asyncQueue,t,n,r)),r.promise}(ensureFirestoreConfigured(t),e._key).then(n=&gt;__PRIVATE_convertToDocSnapshot(t,e,n))}QuerySnapshot._jsonSchemaVersion="firestore/querySnapshot/1.0",QuerySnapshot._jsonSchema={type:property("string",QuerySnapshot._jsonSchemaVersion),bundleSource:property("string","QuerySnapshot"),bundleName:property("string"),bundle:property("string")};class __PRIVATE_ExpUserDataWriter extends AbstractUserDataWriter{constructor(e){super(),this.firestore=e}convertBytes(e){return new Bytes(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new DocumentReference(this.firestore,null,t)}}function getDocs(e){e=__PRIVATE_cast(e,Query);const t=__PRIVATE_cast(e.firestore,Firestore),n=ensureFirestoreConfigured(t),r=new __PRIVATE_ExpUserDataWriter(t);return __PRIVATE_validateHasExplicitOrderByForLimitToLast(e._query),function __PRIVATE_firestoreClientGetDocumentsViaSnapshotListener(e,t,n={}){const r=new __PRIVATE_Deferred;return e.asyncQueue.enqueueAndForget(async()=&gt;function __PRIVATE_executeQueryViaSnapshotListener(e2,t2,n2,r2,i){const s=new __PRIVATE_AsyncObserver({next:n3=&gt;{s.Ou(),t2.enqueueAndForget(()=&gt;__PRIVATE_eventManagerUnlisten(e2,o)),n3.fromCache&amp;&amp;"server"===r2.source?i.reject(new FirestoreError(N.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(n3)},error:e3=&gt;i.reject(e3)}),o=new __PRIVATE_QueryListener(n2,s,{includeMetadataChanges:!0,ka:!0});return __PRIVATE_eventManagerListen(e2,o)}(await __PRIVATE_getEventManager(e),e.asyncQueue,t,n,r)),r.promise}(n,e._query).then(n2=&gt;new QuerySnapshot(t,r,e,n2))}function setDoc(e,t,n){e=__PRIVATE_cast(e,DocumentReference);const r=__PRIVATE_cast(e.firestore,Firestore),i=__PRIVATE_applyFirestoreDataConverter(e.converter,t,n);return executeWrite(r,[__PRIVATE_parseSetData(__PRIVATE_newUserDataReader(r),"setDoc",e._key,i,null!==e.converter,n).toMutation(e._key,Precondition.none())])}function updateDoc(e,t,n,...r){e=__PRIVATE_cast(e,DocumentReference);const i=__PRIVATE_cast(e.firestore,Firestore),s=__PRIVATE_newUserDataReader(i);let o;return o="string"==typeof(t=getModularInstance(t))||t instanceof FieldPath?function __PRIVATE_parseUpdateVarargs(e,t,n,r,i,s){const o=e.Dc(1,t,n),_=[__PRIVATE_fieldPathFromArgument$1(t,r,n)],a=[i];if(s.length%2!=0)throw new FirestoreError(N.INVALID_ARGUMENT,`Function ${t}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let e2=0;e2&lt;s.length;e2+=2)_.push(__PRIVATE_fieldPathFromArgument$1(t,s[e2])),a.push(s[e2+1]);const u=[],c=ObjectValue.empty();for(let e2=_.length-1;e2&gt;=0;--e2)if(!__PRIVATE_fieldMaskContains(u,_[e2])){const t2=_[e2];let n2=a[e2];n2=getModularInstance(n2);const r2=o.gc(t2);if(n2 instanceof __PRIVATE_DeleteFieldValueImpl)u.push(t2);else{const e3=__PRIVATE_parseData(n2,r2);null!=e3&amp;&amp;(u.push(t2),c.set(t2,e3))}}const l=new FieldMask(u);return new ParsedUpdateData(c,l,o.fieldTransforms)}(s,"updateDoc",e._key,t,n,r):function __PRIVATE_parseUpdateData(e,t,n,r){const i=e.Dc(1,t,n);__PRIVATE_validatePlainObject("Data must be an object, but it was:",i,r);const s=[],o=ObjectValue.empty();forEach(r,(e2,r2)=&gt;{const _2=__PRIVATE_fieldPathFromDotSeparatedString(t,e2,n);r2=getModularInstance(r2);const a=i.gc(_2);if(r2 instanceof __PRIVATE_DeleteFieldValueImpl)s.push(_2);else{const e3=__PRIVATE_parseData(r2,a);null!=e3&amp;&amp;(s.push(_2),o.set(_2,e3))}});const _=new FieldMask(s);return new ParsedUpdateData(o,_,i.fieldTransforms)}(s,"updateDoc",e._key,t),executeWrite(i,[o.toMutation(e._key,Precondition.exists(!0))])}function deleteDoc(e){return executeWrite(__PRIVATE_cast(e.firestore,Firestore),[new __PRIVATE_DeleteMutation(e._key,Precondition.none())])}function addDoc(e,t){const n=__PRIVATE_cast(e.firestore,Firestore),r=doc(e),i=__PRIVATE_applyFirestoreDataConverter(e.converter,t);return executeWrite(n,[__PRIVATE_parseSetData(__PRIVATE_newUserDataReader(e.firestore),"addDoc",r._key,i,null!==e.converter,{}).toMutation(r._key,Precondition.exists(!1))]).then(()=&gt;r)}function onSnapshot(e,...t){var n,r,i;e=getModularInstance(e);let s={includeMetadataChanges:!1,source:"default"},o=0;"object"!=typeof t[o]||__PRIVATE_isPartialObserver(t[o])||(s=t[o++]);const _={includeMetadataChanges:s.includeMetadataChanges,source:s.source};if(__PRIVATE_isPartialObserver(t[o])){const e2=t[o];t[o]=null===(n=e2.next)||void 0===n?void 0:n.bind(e2),t[o+1]=null===(r=e2.error)||void 0===r?void 0:r.bind(e2),t[o+2]=null===(i=e2.complete)||void 0===i?void 0:i.bind(e2)}let a,u,c;if(e instanceof DocumentReference)u=__PRIVATE_cast(e.firestore,Firestore),c=__PRIVATE_newQueryForPath(e._key.path),a={next:n2=&gt;{t[o]&amp;&amp;t[o](__PRIVATE_convertToDocSnapshot(u,e,n2))},error:t[o+1],complete:t[o+2]};else{const n2=__PRIVATE_cast(e,Query);u=__PRIVATE_cast(n2.firestore,Firestore),c=n2._query;const r2=new __PRIVATE_ExpUserDataWriter(u);a={next:e2=&gt;{t[o]&amp;&amp;t[o](new QuerySnapshot(u,r2,n2,e2))},error:t[o+1],complete:t[o+2]},__PRIVATE_validateHasExplicitOrderByForLimitToLast(e._query)}return function __PRIVATE_firestoreClientListen(e2,t2,n2,r2){const i2=new __PRIVATE_AsyncObserver(r2),s2=new __PRIVATE_QueryListener(t2,i2,n2);return e2.asyncQueue.enqueueAndForget(async()=&gt;__PRIVATE_eventManagerListen(await __PRIVATE_getEventManager(e2),s2)),()=&gt;{i2.Ou(),e2.asyncQueue.enqueueAndForget(async()=&gt;__PRIVATE_eventManagerUnlisten(await __PRIVATE_getEventManager(e2),s2))}}(ensureFirestoreConfigured(u),c,_,a)}function executeWrite(e,t){return function __PRIVATE_firestoreClientWrite(e2,t2){const n=new __PRIVATE_Deferred;return e2.asyncQueue.enqueueAndForget(async()=&gt;async function __PRIVATE_syncEngineWrite(e,t,n){const r=__PRIVATE_syncEngineEnsureWriteCallbacks(e);try{const e2=await function __PRIVATE_localStoreWriteLocally(e3,t2){const n2=__PRIVATE_debugCast(e3),r2=Timestamp.now(),i=t2.reduce((e4,t3)=&gt;e4.add(t3.key),__PRIVATE_documentKeySet());let s,o;return n2.persistence.runTransaction("Locally write mutations","readwrite",e4=&gt;{let _=__PRIVATE_mutableDocumentMap(),a=__PRIVATE_documentKeySet();return n2.Os.getEntries(e4,i).next(e5=&gt;{_=e5,_.forEach((e6,t3)=&gt;{t3.isValidDocument()||(a=a.add(e6))})}).next(()=&gt;n2.localDocuments.getOverlayedDocuments(e4,_)).next(i2=&gt;{s=i2;const o2=[];for(const e5 of t2){const t3=__PRIVATE_mutationExtractBaseValue(e5,s.get(e5.key).overlayedDocument);null!=t3&amp;&amp;o2.push(new __PRIVATE_PatchMutation(e5.key,t3,__PRIVATE_extractFieldMask(t3.value.mapValue),Precondition.exists(!0)))}return n2.mutationQueue.addMutationBatch(e4,r2,o2,t2)}).next(t3=&gt;{o=t3;const r3=t3.applyToLocalDocumentSet(s,a);return n2.documentOverlayCache.saveOverlays(e4,t3.batchId,r3)})}).then(()=&gt;({batchId:o.batchId,changes:__PRIVATE_convertOverlayedDocumentMapToDocumentMap(s)}))}(r.localStore,t);r.sharedClientState.addPendingMutation(e2.batchId),function __PRIVATE_addMutationCallback(e3,t2,n2){let r2=e3.Ru[e3.currentUser.toKey()];r2||(r2=new SortedMap(__PRIVATE_primitiveComparator)),r2=r2.insert(t2,n2),e3.Ru[e3.currentUser.toKey()]=r2}(r,e2.batchId,n),await __PRIVATE_syncEngineEmitNewSnapsAndNotifyLocalStore(r,e2.changes),await __PRIVATE_fillWritePipeline(r.remoteStore)}catch(e2){const t2=__PRIVATE_wrapInUserErrorIfRecoverable(e2,"Failed to persist write");n.reject(t2)}}(await function __PRIVATE_getSyncEngine(e){return __PRIVATE_ensureOnlineComponents(e).then(e2=&gt;e2.syncEngine)}(e2),t2,n)),n.promise}(ensureFirestoreConfigured(e),t)}function __PRIVATE_convertToDocSnapshot(e,t,n){const r=n.docs.get(t._key),i=new __PRIVATE_ExpUserDataWriter(e);return new DocumentSnapshot(e,i,t._key,r,new SnapshotMetadata(n.hasPendingWrites,n.fromCache),t.converter)}class __PRIVATE_PersistentLocalCacheImpl{constructor(e){let t;this.kind="persistent",(null==e?void 0:e.tabManager)?(e.tabManager._initialize(e),t=e.tabManager):(t=persistentSingleTabManager(),t._initialize(e)),this._onlineComponentProvider=t._onlineComponentProvider,this._offlineComponentProvider=t._offlineComponentProvider}toJSON(){return{kind:this.kind}}}function persistentLocalCache(e){return new __PRIVATE_PersistentLocalCacheImpl(e)}class __PRIVATE_SingleTabManagerImpl{constructor(e){this.forceOwnership=e,this.kind="persistentSingleTab"}toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=OnlineComponentProvider.provider,this._offlineComponentProvider={build:t=&gt;new __PRIVATE_IndexedDbOfflineComponentProvider(t,null==e?void 0:e.cacheSizeBytes,this.forceOwnership)}}}class __PRIVATE_MultiTabManagerImpl{constructor(){this.kind="PersistentMultipleTab"}toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=OnlineComponentProvider.provider,this._offlineComponentProvider={build:t=&gt;new __PRIVATE_MultiTabOfflineComponentProvider(t,null==e?void 0:e.cacheSizeBytes)}}}function persistentSingleTabManager(e){return new __PRIVATE_SingleTabManagerImpl(void 0)}function persistentMultipleTabManager(){return new __PRIVATE_MultiTabManagerImpl}function deleteField(){return new __PRIVATE_DeleteFieldValueImpl("deleteField")}function serverTimestamp(){return new __PRIVATE_ServerTimestampFieldValueImpl("serverTimestamp")}!function __PRIVATE_registerFirestore(e,t=!0){!function __PRIVATE_setSDKVersion(e2){x=e2}("11.10.0"),_registerComponent(new Component("firestore",(e2,{instanceIdentifier:n,options:r})=&gt;{const i=e2.getProvider("app").getImmediate(),s=new Firestore(new __PRIVATE_FirebaseAuthCredentialsProvider(e2.getProvider("auth-internal")),new __PRIVATE_FirebaseAppCheckTokenProvider(i,e2.getProvider("app-check-internal")),function __PRIVATE_databaseIdFromApp(e3,t2){if(!Object.prototype.hasOwnProperty.apply(e3.options,["projectId"]))throw new FirestoreError(N.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new DatabaseId(e3.options.projectId,t2)}(i,n),i);return r=Object.assign({useFetchStreams:t},r),s._setSettings(r),s},"PUBLIC").setMultipleInstances(!0)),registerVersion(F,M,e),registerVersion(F,M,"esm2017")}();const index_esm=Object.freeze(Object.defineProperty({__proto__:null,AbstractUserDataWriter:AbstractUserDataWriter,Bytes:Bytes,CollectionReference:CollectionReference,DocumentReference:DocumentReference,DocumentSnapshot:DocumentSnapshot,FieldPath:FieldPath,FieldValue:FieldValue,Firestore:Firestore,FirestoreError:FirestoreError,GeoPoint:GeoPoint,Query:Query,QueryCompositeFilterConstraint:QueryCompositeFilterConstraint,QueryConstraint:QueryConstraint,QueryDocumentSnapshot:QueryDocumentSnapshot,QueryFieldFilterConstraint:QueryFieldFilterConstraint,QueryOrderByConstraint:QueryOrderByConstraint,QuerySnapshot:QuerySnapshot,SnapshotMetadata:SnapshotMetadata,Timestamp:Timestamp,VectorValue:VectorValue,_AutoId:__PRIVATE_AutoId,_ByteString:ByteString,_DatabaseId:DatabaseId,_DocumentKey:DocumentKey,_EmptyAuthCredentialsProvider:__PRIVATE_EmptyAuthCredentialsProvider,_FieldPath:FieldPath$1,_cast:__PRIVATE_cast,_logWarn:__PRIVATE_logWarn,_validateIsNotUsedTogether:__PRIVATE_validateIsNotUsedTogether,addDoc:addDoc,clearIndexedDbPersistence:clearIndexedDbPersistence,collection:collection,connectFirestoreEmulator:connectFirestoreEmulator,deleteDoc:deleteDoc,deleteField:deleteField,doc:doc,ensureFirestoreConfigured:ensureFirestoreConfigured,executeWrite:executeWrite,getDoc:getDoc,getDocs:getDocs,getFirestore:getFirestore,initializeFirestore:initializeFirestore,onSnapshot:onSnapshot,orderBy:orderBy,persistentLocalCache:persistentLocalCache,persistentMultipleTabManager:persistentMultipleTabManager,persistentSingleTabManager:persistentSingleTabManager,query:query,serverTimestamp:serverTimestamp,setDoc:setDoc,terminate:terminate,updateDoc:updateDoc,where:where},Symbol.toStringTag,{value:"Module"}));function _prodErrorMap(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}registerVersion("firebase","11.10.0","app");const prodErrorMap=_prodErrorMap,_DEFAULT_AUTH_ERROR_FACTORY=new ErrorFactory("auth","Firebase",{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}),logClient=new Logger("@firebase/auth");function _logError(msg,...args){logClient.logLevel&lt;=LogLevel.ERROR&amp;&amp;logClient.error(`Auth (11.10.0): ${msg}`,...args)}function _fail(authOrCode,...rest){throw createErrorInternal(authOrCode,...rest)}function _createError(authOrCode,...rest){return createErrorInternal(authOrCode,...rest)}function _errorWithCustomMessage(auth,code,message){const errorMap=Object.assign(Object.assign({},prodErrorMap()),{[code]:message});return new ErrorFactory("auth","Firebase",errorMap).create(code,{appName:auth.name})}function _serverAppCurrentUserOperationNotSupportedError(auth){return _errorWithCustomMessage(auth,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function _assertInstanceOf(auth,object,instance){if(!(object instanceof instance))throw instance.name!==object.constructor.name&amp;&amp;_fail(auth,"argument-error"),_errorWithCustomMessage(auth,"argument-error",`Type of ${object.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function createErrorInternal(authOrCode,...rest){if("string"!=typeof authOrCode){const code=rest[0],fullParams=[...rest.slice(1)];return fullParams[0]&amp;&amp;(fullParams[0].appName=authOrCode.name),authOrCode._errorFactory.create(code,...fullParams)}return _DEFAULT_AUTH_ERROR_FACTORY.create(authOrCode,...rest)}function _assert(assertion,authOrCode,...rest){if(!assertion)throw createErrorInternal(authOrCode,...rest)}function debugFail(failure){const message="INTERNAL ASSERTION FAILED: "+failure;throw _logError(message),new Error(message)}function debugAssert(assertion,message){assertion||debugFail(message)}function _getCurrentUrl(){var _a;return"undefined"!=typeof self&amp;&amp;(null===(_a=self.location)||void 0===_a?void 0:_a.href)||""}function _getCurrentScheme(){var _a;return"undefined"!=typeof self&amp;&amp;(null===(_a=self.location)||void 0===_a?void 0:_a.protocol)||null}function _isOnline(){return!("undefined"!=typeof navigator&amp;&amp;navigator&amp;&amp;"onLine"in navigator&amp;&amp;"boolean"==typeof navigator.onLine&amp;&amp;(function _isHttpOrHttps(){return"http:"===_getCurrentScheme()||"https:"===_getCurrentScheme()}()||isBrowserExtension()||"connection"in navigator))||navigator.onLine}class Delay{constructor(shortDelay,longDelay){this.shortDelay=shortDelay,this.longDelay=longDelay,debugAssert(longDelay&gt;shortDelay,"Short delay should be less than long delay!"),this.isMobile=function isMobileCordova(){return"undefined"!=typeof window&amp;&amp;!!(window.cordova||window.phonegap||window.PhoneGap)&amp;&amp;/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(getUA())}()||function isReactNative(){return"object"==typeof navigator&amp;&amp;"ReactNative"===navigator.product}()}get(){return _isOnline()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}function _emulatorUrl(config,path){debugAssert(config.emulator,"Emulator should always be set here");const{url:url}=config.emulator;return path?`${url}${path.startsWith("/")?path.slice(1):path}`:url}class FetchProvider{static initialize(fetchImpl,headersImpl,responseImpl){this.fetchImpl=fetchImpl,headersImpl&amp;&amp;(this.headersImpl=headersImpl),responseImpl&amp;&amp;(this.responseImpl=responseImpl)}static fetch(){return this.fetchImpl?this.fetchImpl:"undefined"!=typeof self&amp;&amp;"fetch"in self?self.fetch:"undefined"!=typeof globalThis&amp;&amp;globalThis.fetch?globalThis.fetch:"undefined"!=typeof fetch?fetch:void debugFail("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){return this.headersImpl?this.headersImpl:"undefined"!=typeof self&amp;&amp;"Headers"in self?self.Headers:"undefined"!=typeof globalThis&amp;&amp;globalThis.Headers?globalThis.Headers:"undefined"!=typeof Headers?Headers:void debugFail("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){return this.responseImpl?this.responseImpl:"undefined"!=typeof self&amp;&amp;"Response"in self?self.Response:"undefined"!=typeof globalThis&amp;&amp;globalThis.Response?globalThis.Response:"undefined"!=typeof Response?Response:void debugFail("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const SERVER_ERROR_MAP={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"},CookieAuthProxiedEndpoints=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],DEFAULT_API_TIMEOUT_MS=new Delay(3e4,6e4);function _addTidIfNecessary(auth,request){return auth.tenantId&amp;&amp;!request.tenantId?Object.assign(Object.assign({},request),{tenantId:auth.tenantId}):request}async function _performApiRequest(auth,method,path,request,customErrorMap={}){return _performFetchWithErrorHandling(auth,customErrorMap,async()=&gt;{let body={},params={};request&amp;&amp;("GET"===method?params=request:body={body:JSON.stringify(request)});const query2=querystring(Object.assign({key:auth.config.apiKey},params)).slice(1),headers=await auth._getAdditionalHeaders();headers["Content-Type"]="application/json",auth.languageCode&amp;&amp;(headers["X-Firebase-Locale"]=auth.languageCode);const fetchArgs=Object.assign({method:method,headers:headers},body);return function isCloudflareWorker(){return"undefined"!=typeof navigator&amp;&amp;"Cloudflare-Workers"===navigator.userAgent}()||(fetchArgs.referrerPolicy="no-referrer"),auth.emulatorConfig&amp;&amp;isCloudWorkstation(auth.emulatorConfig.host)&amp;&amp;(fetchArgs.credentials="include"),FetchProvider.fetch()(await _getFinalTarget(auth,auth.config.apiHost,path,query2),fetchArgs)})}async function _performFetchWithErrorHandling(auth,customErrorMap,fetchFn){auth._canInitEmulator=!1;const errorMap=Object.assign(Object.assign({},SERVER_ERROR_MAP),customErrorMap);try{const networkTimeout=new NetworkTimeout(auth),response=await Promise.race([fetchFn(),networkTimeout.promise]);networkTimeout.clearNetworkTimeout();const json=await response.json();if("needConfirmation"in json)throw _makeTaggedError(auth,"account-exists-with-different-credential",json);if(response.ok&amp;&amp;!("errorMessage"in json))return json;{const errorMessage=response.ok?json.errorMessage:json.error.message,[serverErrorCode,serverErrorMessage]=errorMessage.split(" : ");if("FEDERATED_USER_ID_ALREADY_LINKED"===serverErrorCode)throw _makeTaggedError(auth,"credential-already-in-use",json);if("EMAIL_EXISTS"===serverErrorCode)throw _makeTaggedError(auth,"email-already-in-use",json);if("USER_DISABLED"===serverErrorCode)throw _makeTaggedError(auth,"user-disabled",json);const authError=errorMap[serverErrorCode]||serverErrorCode.toLowerCase().replace(/[_\s]+/g,"-");if(serverErrorMessage)throw _errorWithCustomMessage(auth,authError,serverErrorMessage);_fail(auth,authError)}}catch(e){if(e instanceof FirebaseError)throw e;_fail(auth,"network-request-failed",{message:String(e)})}}async function _performSignInRequest(auth,method,path,request,customErrorMap={}){const serverResponse=await _performApiRequest(auth,method,path,request,customErrorMap);return"mfaPendingCredential"in serverResponse&amp;&amp;_fail(auth,"multi-factor-auth-required",{_serverResponse:serverResponse}),serverResponse}async function _getFinalTarget(auth,host,path,query2){const base=`${host}${path}?${query2}`,authInternal=auth,finalTarget=authInternal.config.emulator?_emulatorUrl(auth.config,base):`${auth.config.apiScheme}://${base}`;if(CookieAuthProxiedEndpoints.includes(path)&amp;&amp;(await authInternal._persistenceManagerAvailable,"COOKIE"===authInternal._getPersistenceType())){return authInternal._getPersistence()._getFinalTarget(finalTarget).toString()}return finalTarget}function _parseEnforcementState(enforcementStateStr){switch(enforcementStateStr){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class NetworkTimeout{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(auth){this.auth=auth,this.timer=null,this.promise=new Promise((_,reject)=&gt;{this.timer=setTimeout(()=&gt;reject(_createError(this.auth,"network-request-failed")),DEFAULT_API_TIMEOUT_MS.get())})}}function _makeTaggedError(auth,code,response){const errorParams={appName:auth.name};response.email&amp;&amp;(errorParams.email=response.email),response.phoneNumber&amp;&amp;(errorParams.phoneNumber=response.phoneNumber);const error=_createError(auth,code,errorParams);return error.customData._tokenResponse=response,error}function isEnterprise(grecaptcha){return void 0!==grecaptcha&amp;&amp;void 0!==grecaptcha.enterprise}class RecaptchaConfig{constructor(response){if(this.siteKey="",this.recaptchaEnforcementState=[],void 0===response.recaptchaKey)throw new Error("recaptchaKey undefined");this.siteKey=response.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=response.recaptchaEnforcementState}getProviderEnforcementState(providerStr){if(!this.recaptchaEnforcementState||0===this.recaptchaEnforcementState.length)return null;for(const recaptchaEnforcementState of this.recaptchaEnforcementState)if(recaptchaEnforcementState.provider&amp;&amp;recaptchaEnforcementState.provider===providerStr)return _parseEnforcementState(recaptchaEnforcementState.enforcementState);return null}isProviderEnabled(providerStr){return"ENFORCE"===this.getProviderEnforcementState(providerStr)||"AUDIT"===this.getProviderEnforcementState(providerStr)}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function getAccountInfo(auth,request){return _performApiRequest(auth,"POST","/v1/accounts:lookup",request)}function utcTimestampToDateString(utcTimestamp){if(utcTimestamp)try{const date=new Date(Number(utcTimestamp));if(!isNaN(date.getTime()))return date.toUTCString()}catch(e){}}function secondsStringToMilliseconds(seconds){return 1e3*Number(seconds)}function _parseToken(token){const[algorithm,payload,signature]=token.split(".");if(void 0===algorithm||void 0===payload||void 0===signature)return _logError("JWT malformed, contained fewer than 3 sections"),null;try{const decoded=base64Decode(payload);return decoded?JSON.parse(decoded):(_logError("Failed to decode base64 JWT payload"),null)}catch(e){return _logError("Caught error parsing JWT payload as JSON",null==e?void 0:e.toString()),null}}function _tokenExpiresIn(token){const parsedToken=_parseToken(token);return _assert(parsedToken,"internal-error"),_assert(void 0!==parsedToken.exp,"internal-error"),_assert(void 0!==parsedToken.iat,"internal-error"),Number(parsedToken.exp)-Number(parsedToken.iat)}async function _logoutIfInvalidated(user,promise,bypassAuthState=!1){if(bypassAuthState)return promise;try{return await promise}catch(e){throw e instanceof FirebaseError&amp;&amp;function isUserInvalidated({code:code}){return"auth/user-disabled"===code||"auth/user-token-expired"===code}(e)&amp;&amp;user.auth.currentUser===user&amp;&amp;await user.auth.signOut(),e}}class ProactiveRefresh{constructor(user){this.user=user,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&amp;&amp;(this.isRunning=!1,null!==this.timerId&amp;&amp;clearTimeout(this.timerId))}getInterval(wasError){var _a;if(wasError){const interval=this.errorBackoff;return this.errorBackoff=Math.min(2*this.errorBackoff,96e4),interval}{this.errorBackoff=3e4;const interval=(null!==(_a=this.user.stsTokenManager.expirationTime)&amp;&amp;void 0!==_a?_a:0)-Date.now()-3e5;return Math.max(0,interval)}}schedule(wasError=!1){if(!this.isRunning)return;const interval=this.getInterval(wasError);this.timerId=setTimeout(async()=&gt;{await this.iteration()},interval)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){return void("auth/network-request-failed"===(null==e?void 0:e.code)&amp;&amp;this.schedule(!0))}this.schedule()}}class UserMetadata{constructor(createdAt,lastLoginAt){this.createdAt=createdAt,this.lastLoginAt=lastLoginAt,this._initializeTime()}_initializeTime(){this.lastSignInTime=utcTimestampToDateString(this.lastLoginAt),this.creationTime=utcTimestampToDateString(this.createdAt)}_copy(metadata){this.createdAt=metadata.createdAt,this.lastLoginAt=metadata.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function _reloadWithoutSaving(user){var _a;const auth=user.auth,idToken=await user.getIdToken(),response=await _logoutIfInvalidated(user,getAccountInfo(auth,{idToken:idToken}));_assert(null==response?void 0:response.users.length,auth,"internal-error");const coreAccount=response.users[0];user._notifyReloadListener(coreAccount);const newProviderData=(null===(_a=coreAccount.providerUserInfo)||void 0===_a?void 0:_a.length)?extractProviderData(coreAccount.providerUserInfo):[],providerData=function mergeProviderData(original,newData){return[...original.filter(o=&gt;!newData.some(n=&gt;n.providerId===o.providerId)),...newData]}(user.providerData,newProviderData),oldIsAnonymous=user.isAnonymous,newIsAnonymous=!(user.email&amp;&amp;coreAccount.passwordHash||(null==providerData?void 0:providerData.length)),isAnonymous=!!oldIsAnonymous&amp;&amp;newIsAnonymous,updates={uid:coreAccount.localId,displayName:coreAccount.displayName||null,photoURL:coreAccount.photoUrl||null,email:coreAccount.email||null,emailVerified:coreAccount.emailVerified||!1,phoneNumber:coreAccount.phoneNumber||null,tenantId:coreAccount.tenantId||null,providerData:providerData,metadata:new UserMetadata(coreAccount.createdAt,coreAccount.lastLoginAt),isAnonymous:isAnonymous};Object.assign(user,updates)}function extractProviderData(providers){return providers.map(_a=&gt;{var{providerId:providerId}=_a,provider=__rest(_a,["providerId"]);return{providerId:providerId,uid:provider.rawId||"",displayName:provider.displayName||null,email:provider.email||null,phoneNumber:provider.phoneNumber||null,photoURL:provider.photoUrl||null}})}class StsTokenManager{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()&gt;this.expirationTime-3e4}updateFromServerResponse(response){_assert(response.idToken,"internal-error"),_assert(void 0!==response.idToken,"internal-error"),_assert(void 0!==response.refreshToken,"internal-error");const expiresIn="expiresIn"in response&amp;&amp;void 0!==response.expiresIn?Number(response.expiresIn):_tokenExpiresIn(response.idToken);this.updateTokensAndExpiration(response.idToken,response.refreshToken,expiresIn)}updateFromIdToken(idToken){_assert(0!==idToken.length,"internal-error");const expiresIn=_tokenExpiresIn(idToken);this.updateTokensAndExpiration(idToken,null,expiresIn)}async getToken(auth,forceRefresh=!1){return forceRefresh||!this.accessToken||this.isExpired?(_assert(this.refreshToken,auth,"user-token-expired"),this.refreshToken?(await this.refresh(auth,this.refreshToken),this.accessToken):null):this.accessToken}clearRefreshToken(){this.refreshToken=null}async refresh(auth,oldToken){const{accessToken:accessToken,refreshToken:refreshToken,expiresIn:expiresIn}=await async function requestStsToken(auth,refreshToken){const response=await _performFetchWithErrorHandling(auth,{},async()=&gt;{const body=querystring({grant_type:"refresh_token",refresh_token:refreshToken}).slice(1),{tokenApiHost:tokenApiHost,apiKey:apiKey}=auth.config,url=await _getFinalTarget(auth,tokenApiHost,"/v1/token",`key=${apiKey}`),headers=await auth._getAdditionalHeaders();headers["Content-Type"]="application/x-www-form-urlencoded";const options={method:"POST",headers:headers,body:body};return auth.emulatorConfig&amp;&amp;isCloudWorkstation(auth.emulatorConfig.host)&amp;&amp;(options.credentials="include"),FetchProvider.fetch()(url,options)});return{accessToken:response.access_token,expiresIn:response.expires_in,refreshToken:response.refresh_token}}(auth,oldToken);this.updateTokensAndExpiration(accessToken,refreshToken,Number(expiresIn))}updateTokensAndExpiration(accessToken,refreshToken,expiresInSec){this.refreshToken=refreshToken||null,this.accessToken=accessToken||null,this.expirationTime=Date.now()+1e3*expiresInSec}static fromJSON(appName,object){const{refreshToken:refreshToken,accessToken:accessToken,expirationTime:expirationTime}=object,manager=new StsTokenManager;return refreshToken&amp;&amp;(_assert("string"==typeof refreshToken,"internal-error",{appName:appName}),manager.refreshToken=refreshToken),accessToken&amp;&amp;(_assert("string"==typeof accessToken,"internal-error",{appName:appName}),manager.accessToken=accessToken),expirationTime&amp;&amp;(_assert("number"==typeof expirationTime,"internal-error",{appName:appName}),manager.expirationTime=expirationTime),manager}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(stsTokenManager){this.accessToken=stsTokenManager.accessToken,this.refreshToken=stsTokenManager.refreshToken,this.expirationTime=stsTokenManager.expirationTime}_clone(){return Object.assign(new StsTokenManager,this.toJSON())}_performRefresh(){return debugFail("not implemented")}}function assertStringOrUndefined(assertion,appName){_assert("string"==typeof assertion||void 0===assertion,"internal-error",{appName:appName})}class UserImpl{constructor(_a){var{uid:uid,auth:auth,stsTokenManager:stsTokenManager}=_a,opt=__rest(_a,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new ProactiveRefresh(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=uid,this.auth=auth,this.stsTokenManager=stsTokenManager,this.accessToken=stsTokenManager.accessToken,this.displayName=opt.displayName||null,this.email=opt.email||null,this.emailVerified=opt.emailVerified||!1,this.phoneNumber=opt.phoneNumber||null,this.photoURL=opt.photoURL||null,this.isAnonymous=opt.isAnonymous||!1,this.tenantId=opt.tenantId||null,this.providerData=opt.providerData?[...opt.providerData]:[],this.metadata=new UserMetadata(opt.createdAt||void 0,opt.lastLoginAt||void 0)}async getIdToken(forceRefresh){const accessToken=await _logoutIfInvalidated(this,this.stsTokenManager.getToken(this.auth,forceRefresh));return _assert(accessToken,this.auth,"internal-error"),this.accessToken!==accessToken&amp;&amp;(this.accessToken=accessToken,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),accessToken}getIdTokenResult(forceRefresh){return async function getIdTokenResult(user,forceRefresh=!1){const userInternal=getModularInstance(user),token=await userInternal.getIdToken(forceRefresh),claims=_parseToken(token);_assert(claims&amp;&amp;claims.exp&amp;&amp;claims.auth_time&amp;&amp;claims.iat,userInternal.auth,"internal-error");const firebase="object"==typeof claims.firebase?claims.firebase:void 0,signInProvider=null==firebase?void 0:firebase.sign_in_provider;return{claims:claims,token:token,authTime:utcTimestampToDateString(secondsStringToMilliseconds(claims.auth_time)),issuedAtTime:utcTimestampToDateString(secondsStringToMilliseconds(claims.iat)),expirationTime:utcTimestampToDateString(secondsStringToMilliseconds(claims.exp)),signInProvider:signInProvider||null,signInSecondFactor:(null==firebase?void 0:firebase.sign_in_second_factor)||null}}(this,forceRefresh)}reload(){return async function reload(user){const userInternal=getModularInstance(user);await _reloadWithoutSaving(userInternal),await userInternal.auth._persistUserIfCurrent(userInternal),userInternal.auth._notifyListenersIfCurrent(userInternal)}(this)}_assign(user){this!==user&amp;&amp;(_assert(this.uid===user.uid,this.auth,"internal-error"),this.displayName=user.displayName,this.photoURL=user.photoURL,this.email=user.email,this.emailVerified=user.emailVerified,this.phoneNumber=user.phoneNumber,this.isAnonymous=user.isAnonymous,this.tenantId=user.tenantId,this.providerData=user.providerData.map(userInfo=&gt;Object.assign({},userInfo)),this.metadata._copy(user.metadata),this.stsTokenManager._assign(user.stsTokenManager))}_clone(auth){const newUser=new UserImpl(Object.assign(Object.assign({},this),{auth:auth,stsTokenManager:this.stsTokenManager._clone()}));return newUser.metadata._copy(this.metadata),newUser}_onReload(callback){_assert(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=callback,this.reloadUserInfo&amp;&amp;(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(userInfo){this.reloadListener?this.reloadListener(userInfo):this.reloadUserInfo=userInfo}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(response,reload2=!1){let tokensRefreshed=!1;response.idToken&amp;&amp;response.idToken!==this.stsTokenManager.accessToken&amp;&amp;(this.stsTokenManager.updateFromServerResponse(response),tokensRefreshed=!0),reload2&amp;&amp;await _reloadWithoutSaving(this),await this.auth._persistUserIfCurrent(this),tokensRefreshed&amp;&amp;this.auth._notifyListenersIfCurrent(this)}async delete(){if(_isFirebaseServerApp(this.auth.app))return Promise.reject(_serverAppCurrentUserOperationNotSupportedError(this.auth));const idToken=await this.getIdToken();return await _logoutIfInvalidated(this,async function deleteAccount(auth,request){return _performApiRequest(auth,"POST","/v1/accounts:delete",request)}(this.auth,{idToken:idToken})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(userInfo=&gt;Object.assign({},userInfo)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(auth,object){var _a,_b,_c,_d,_e2,_f,_g,_h;const displayName=null!==(_a=object.displayName)&amp;&amp;void 0!==_a?_a:void 0,email=null!==(_b=object.email)&amp;&amp;void 0!==_b?_b:void 0,phoneNumber=null!==(_c=object.phoneNumber)&amp;&amp;void 0!==_c?_c:void 0,photoURL=null!==(_d=object.photoURL)&amp;&amp;void 0!==_d?_d:void 0,tenantId=null!==(_e2=object.tenantId)&amp;&amp;void 0!==_e2?_e2:void 0,_redirectEventId=null!==(_f=object._redirectEventId)&amp;&amp;void 0!==_f?_f:void 0,createdAt=null!==(_g=object.createdAt)&amp;&amp;void 0!==_g?_g:void 0,lastLoginAt=null!==(_h=object.lastLoginAt)&amp;&amp;void 0!==_h?_h:void 0,{uid:uid,emailVerified:emailVerified,isAnonymous:isAnonymous,providerData:providerData,stsTokenManager:plainObjectTokenManager}=object;_assert(uid&amp;&amp;plainObjectTokenManager,auth,"internal-error");const stsTokenManager=StsTokenManager.fromJSON(this.name,plainObjectTokenManager);_assert("string"==typeof uid,auth,"internal-error"),assertStringOrUndefined(displayName,auth.name),assertStringOrUndefined(email,auth.name),_assert("boolean"==typeof emailVerified,auth,"internal-error"),_assert("boolean"==typeof isAnonymous,auth,"internal-error"),assertStringOrUndefined(phoneNumber,auth.name),assertStringOrUndefined(photoURL,auth.name),assertStringOrUndefined(tenantId,auth.name),assertStringOrUndefined(_redirectEventId,auth.name),assertStringOrUndefined(createdAt,auth.name),assertStringOrUndefined(lastLoginAt,auth.name);const user=new UserImpl({uid:uid,auth:auth,email:email,emailVerified:emailVerified,displayName:displayName,isAnonymous:isAnonymous,photoURL:photoURL,phoneNumber:phoneNumber,tenantId:tenantId,stsTokenManager:stsTokenManager,createdAt:createdAt,lastLoginAt:lastLoginAt});return providerData&amp;&amp;Array.isArray(providerData)&amp;&amp;(user.providerData=providerData.map(userInfo=&gt;Object.assign({},userInfo))),_redirectEventId&amp;&amp;(user._redirectEventId=_redirectEventId),user}static async _fromIdTokenResponse(auth,idTokenResponse,isAnonymous=!1){const stsTokenManager=new StsTokenManager;stsTokenManager.updateFromServerResponse(idTokenResponse);const user=new UserImpl({uid:idTokenResponse.localId,auth:auth,stsTokenManager:stsTokenManager,isAnonymous:isAnonymous});return await _reloadWithoutSaving(user),user}static async _fromGetAccountInfoResponse(auth,response,idToken){const coreAccount=response.users[0];_assert(void 0!==coreAccount.localId,"internal-error");const providerData=void 0!==coreAccount.providerUserInfo?extractProviderData(coreAccount.providerUserInfo):[],isAnonymous=!(coreAccount.email&amp;&amp;coreAccount.passwordHash||(null==providerData?void 0:providerData.length)),stsTokenManager=new StsTokenManager;stsTokenManager.updateFromIdToken(idToken);const user=new UserImpl({uid:coreAccount.localId,auth:auth,stsTokenManager:stsTokenManager,isAnonymous:isAnonymous}),updates={uid:coreAccount.localId,displayName:coreAccount.displayName||null,photoURL:coreAccount.photoUrl||null,email:coreAccount.email||null,emailVerified:coreAccount.emailVerified||!1,phoneNumber:coreAccount.phoneNumber||null,tenantId:coreAccount.tenantId||null,providerData:providerData,metadata:new UserMetadata(coreAccount.createdAt,coreAccount.lastLoginAt),isAnonymous:!(coreAccount.email&amp;&amp;coreAccount.passwordHash||(null==providerData?void 0:providerData.length))};return Object.assign(user,updates),user}}const instanceCache=new Map;function _getInstance(cls){debugAssert(cls instanceof Function,"Expected a class definition");let instance=instanceCache.get(cls);return instance?(debugAssert(instance instanceof cls,"Instance stored in cache mismatched with class"),instance):(instance=new cls,instanceCache.set(cls,instance),instance)}class InMemoryPersistence{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(key,value){this.storage[key]=value}async _get(key){const value=this.storage[key];return void 0===value?null:value}async _remove(key){delete this.storage[key]}_addListener(_key,_listener){}_removeListener(_key,_listener){}}InMemoryPersistence.type="NONE";const inMemoryPersistence=InMemoryPersistence;function _persistenceKeyName(key,apiKey,appName){return`firebase:${key}:${apiKey}:${appName}`}class PersistenceUserManager{constructor(persistence,auth,userKey){this.persistence=persistence,this.auth=auth,this.userKey=userKey;const{config:config,name:name2}=this.auth;this.fullUserKey=_persistenceKeyName(this.userKey,config.apiKey,name2),this.fullPersistenceKey=_persistenceKeyName("persistence",config.apiKey,name2),this.boundEventHandler=auth._onStorageEvent.bind(auth),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(user){return this.persistence._set(this.fullUserKey,user.toJSON())}async getCurrentUser(){const blob=await this.persistence._get(this.fullUserKey);if(!blob)return null;if("string"==typeof blob){const response=await getAccountInfo(this.auth,{idToken:blob}).catch(()=&gt;{});return response?UserImpl._fromGetAccountInfoResponse(this.auth,response,blob):null}return UserImpl._fromJSON(this.auth,blob)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(newPersistence){if(this.persistence===newPersistence)return;const currentUser=await this.getCurrentUser();return await this.removeCurrentUser(),this.persistence=newPersistence,currentUser?this.setCurrentUser(currentUser):void 0}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(auth,persistenceHierarchy,userKey="authUser"){if(!persistenceHierarchy.length)return new PersistenceUserManager(_getInstance(inMemoryPersistence),auth,userKey);const availablePersistences=(await Promise.all(persistenceHierarchy.map(async persistence=&gt;{if(await persistence._isAvailable())return persistence}))).filter(persistence=&gt;persistence);let selectedPersistence=availablePersistences[0]||_getInstance(inMemoryPersistence);const key=_persistenceKeyName(userKey,auth.config.apiKey,auth.name);let userToMigrate=null;for(const persistence of persistenceHierarchy)try{const blob=await persistence._get(key);if(blob){let user;if("string"==typeof blob){const response=await getAccountInfo(auth,{idToken:blob}).catch(()=&gt;{});if(!response)break;user=await UserImpl._fromGetAccountInfoResponse(auth,response,blob)}else user=UserImpl._fromJSON(auth,blob);persistence!==selectedPersistence&amp;&amp;(userToMigrate=user),selectedPersistence=persistence;break}}catch(_a){}const migrationHierarchy=availablePersistences.filter(p=&gt;p._shouldAllowMigration);return selectedPersistence._shouldAllowMigration&amp;&amp;migrationHierarchy.length?(selectedPersistence=migrationHierarchy[0],userToMigrate&amp;&amp;await selectedPersistence._set(key,userToMigrate.toJSON()),await Promise.all(persistenceHierarchy.map(async persistence=&gt;{if(persistence!==selectedPersistence)try{await persistence._remove(key)}catch(_a){}})),new PersistenceUserManager(selectedPersistence,auth,userKey)):new PersistenceUserManager(selectedPersistence,auth,userKey)}}function _getBrowserName(userAgent){const ua=userAgent.toLowerCase();if(ua.includes("opera/")||ua.includes("opr/")||ua.includes("opios/"))return"Opera";if(_isIEMobile(ua))return"IEMobile";if(ua.includes("msie")||ua.includes("trident/"))return"IE";if(ua.includes("edge/"))return"Edge";if(_isFirefox(ua))return"Firefox";if(ua.includes("silk/"))return"Silk";if(_isBlackBerry(ua))return"Blackberry";if(_isWebOS(ua))return"Webos";if(_isSafari(ua))return"Safari";if((ua.includes("chrome/")||_isChromeIOS(ua))&amp;&amp;!ua.includes("edge/"))return"Chrome";if(_isAndroid(ua))return"Android";{const re2=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,matches=userAgent.match(re2);if(2===(null==matches?void 0:matches.length))return matches[1]}return"Other"}function _isFirefox(ua=getUA()){return/firefox\//i.test(ua)}function _isSafari(userAgent=getUA()){const ua=userAgent.toLowerCase();return ua.includes("safari/")&amp;&amp;!ua.includes("chrome/")&amp;&amp;!ua.includes("crios/")&amp;&amp;!ua.includes("android")}function _isChromeIOS(ua=getUA()){return/crios\//i.test(ua)}function _isIEMobile(ua=getUA()){return/iemobile/i.test(ua)}function _isAndroid(ua=getUA()){return/android/i.test(ua)}function _isBlackBerry(ua=getUA()){return/blackberry/i.test(ua)}function _isWebOS(ua=getUA()){return/webos/i.test(ua)}function _isIOS(ua=getUA()){return/iphone|ipad|ipod/i.test(ua)||/macintosh/i.test(ua)&amp;&amp;/mobile/i.test(ua)}function _isIE10(){return function isIE(){const ua=getUA();return ua.indexOf("MSIE ")&gt;=0||ua.indexOf("Trident/")&gt;=0}()&amp;&amp;10===document.documentMode}function _isMobileBrowser(ua=getUA()){return _isIOS(ua)||_isAndroid(ua)||_isWebOS(ua)||_isBlackBerry(ua)||/windows phone/i.test(ua)||_isIEMobile(ua)}function _getClientVersion(clientPlatform,frameworks=[]){let reportedPlatform;switch(clientPlatform){case"Browser":reportedPlatform=_getBrowserName(getUA());break;case"Worker":reportedPlatform=`${_getBrowserName(getUA())}-${clientPlatform}`;break;default:reportedPlatform=clientPlatform}return`${reportedPlatform}/JsCore/11.10.0/${frameworks.length?frameworks.join(","):"FirebaseCore-web"}`}class AuthMiddlewareQueue{constructor(auth){this.auth=auth,this.queue=[]}pushCallback(callback,onAbort){const wrappedCallback=user=&gt;new Promise((resolve,reject)=&gt;{try{resolve(callback(user))}catch(e){reject(e)}});wrappedCallback.onAbort=onAbort,this.queue.push(wrappedCallback);const index=this.queue.length-1;return()=&gt;{this.queue[index]=()=&gt;Promise.resolve()}}async runMiddleware(nextUser){if(this.auth.currentUser===nextUser)return;const onAbortStack=[];try{for(const beforeStateCallback of this.queue)await beforeStateCallback(nextUser),beforeStateCallback.onAbort&amp;&amp;onAbortStack.push(beforeStateCallback.onAbort)}catch(e){onAbortStack.reverse();for(const onAbort of onAbortStack)try{onAbort()}catch(_){}throw this.auth._errorFactory.create("login-blocked",{originalMessage:null==e?void 0:e.message})}}}class PasswordPolicyImpl{constructor(response){var _a,_b,_c,_d;const responseOptions=response.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=null!==(_a=responseOptions.minPasswordLength)&amp;&amp;void 0!==_a?_a:6,responseOptions.maxPasswordLength&amp;&amp;(this.customStrengthOptions.maxPasswordLength=responseOptions.maxPasswordLength),void 0!==responseOptions.containsLowercaseCharacter&amp;&amp;(this.customStrengthOptions.containsLowercaseLetter=responseOptions.containsLowercaseCharacter),void 0!==responseOptions.containsUppercaseCharacter&amp;&amp;(this.customStrengthOptions.containsUppercaseLetter=responseOptions.containsUppercaseCharacter),void 0!==responseOptions.containsNumericCharacter&amp;&amp;(this.customStrengthOptions.containsNumericCharacter=responseOptions.containsNumericCharacter),void 0!==responseOptions.containsNonAlphanumericCharacter&amp;&amp;(this.customStrengthOptions.containsNonAlphanumericCharacter=responseOptions.containsNonAlphanumericCharacter),this.enforcementState=response.enforcementState,"ENFORCEMENT_STATE_UNSPECIFIED"===this.enforcementState&amp;&amp;(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=null!==(_c=null===(_b=response.allowedNonAlphanumericCharacters)||void 0===_b?void 0:_b.join(""))&amp;&amp;void 0!==_c?_c:"",this.forceUpgradeOnSignin=null!==(_d=response.forceUpgradeOnSignin)&amp;&amp;void 0!==_d&amp;&amp;_d,this.schemaVersion=response.schemaVersion}validatePassword(password){var _a,_b,_c,_d,_e2,_f;const status={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(password,status),this.validatePasswordCharacterOptions(password,status),status.isValid&amp;&amp;(status.isValid=null===(_a=status.meetsMinPasswordLength)||void 0===_a||_a),status.isValid&amp;&amp;(status.isValid=null===(_b=status.meetsMaxPasswordLength)||void 0===_b||_b),status.isValid&amp;&amp;(status.isValid=null===(_c=status.containsLowercaseLetter)||void 0===_c||_c),status.isValid&amp;&amp;(status.isValid=null===(_d=status.containsUppercaseLetter)||void 0===_d||_d),status.isValid&amp;&amp;(status.isValid=null===(_e2=status.containsNumericCharacter)||void 0===_e2||_e2),status.isValid&amp;&amp;(status.isValid=null===(_f=status.containsNonAlphanumericCharacter)||void 0===_f||_f),status}validatePasswordLengthOptions(password,status){const minPasswordLength=this.customStrengthOptions.minPasswordLength,maxPasswordLength=this.customStrengthOptions.maxPasswordLength;minPasswordLength&amp;&amp;(status.meetsMinPasswordLength=password.length&gt;=minPasswordLength),maxPasswordLength&amp;&amp;(status.meetsMaxPasswordLength=password.length&lt;=maxPasswordLength)}validatePasswordCharacterOptions(password,status){let passwordChar;this.updatePasswordCharacterOptionsStatuses(status,!1,!1,!1,!1);for(let i=0;i&lt;password.length;i++)passwordChar=password.charAt(i),this.updatePasswordCharacterOptionsStatuses(status,passwordChar&gt;="a"&amp;&amp;passwordChar&lt;="z",passwordChar&gt;="A"&amp;&amp;passwordChar&lt;="Z",passwordChar&gt;="0"&amp;&amp;passwordChar&lt;="9",this.allowedNonAlphanumericCharacters.includes(passwordChar))}updatePasswordCharacterOptionsStatuses(status,containsLowercaseCharacter,containsUppercaseCharacter,containsNumericCharacter,containsNonAlphanumericCharacter){this.customStrengthOptions.containsLowercaseLetter&amp;&amp;(status.containsLowercaseLetter||(status.containsLowercaseLetter=containsLowercaseCharacter)),this.customStrengthOptions.containsUppercaseLetter&amp;&amp;(status.containsUppercaseLetter||(status.containsUppercaseLetter=containsUppercaseCharacter)),this.customStrengthOptions.containsNumericCharacter&amp;&amp;(status.containsNumericCharacter||(status.containsNumericCharacter=containsNumericCharacter)),this.customStrengthOptions.containsNonAlphanumericCharacter&amp;&amp;(status.containsNonAlphanumericCharacter||(status.containsNonAlphanumericCharacter=containsNonAlphanumericCharacter))}}class AuthImpl{constructor(app,heartbeatServiceProvider,appCheckServiceProvider,config){this.app=app,this.heartbeatServiceProvider=heartbeatServiceProvider,this.appCheckServiceProvider=appCheckServiceProvider,this.config=config,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new Subscription(this),this.idTokenSubscription=new Subscription(this),this.beforeStateQueue=new AuthMiddlewareQueue(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=_DEFAULT_AUTH_ERROR_FACTORY,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=app.name,this.clientVersion=config.sdkClientVersion,this._persistenceManagerAvailable=new Promise(resolve=&gt;this._resolvePersistenceManagerAvailable=resolve)}_initializeWithPersistence(persistenceHierarchy,popupRedirectResolver){return popupRedirectResolver&amp;&amp;(this._popupRedirectResolver=_getInstance(popupRedirectResolver)),this._initializationPromise=this.queue(async()=&gt;{var _a,_b,_c;if(!this._deleted&amp;&amp;(this.persistenceManager=await PersistenceUserManager.create(this,persistenceHierarchy),null===(_a=this._resolvePersistenceManagerAvailable)||void 0===_a||_a.call(this),!this._deleted)){if(null===(_b=this._popupRedirectResolver)||void 0===_b?void 0:_b._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch(e){}await this.initializeCurrentUser(popupRedirectResolver),this.lastNotifiedUid=(null===(_c=this.currentUser)||void 0===_c?void 0:_c.uid)||null,this._deleted||(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const user=await this.assertedPersistence.getCurrentUser();return this.currentUser||user?this.currentUser&amp;&amp;user&amp;&amp;this.currentUser.uid===user.uid?(this._currentUser._assign(user),void(await this.currentUser.getIdToken())):void(await this._updateCurrentUser(user,!0)):void 0}async initializeCurrentUserFromIdToken(idToken){try{const response=await getAccountInfo(this,{idToken:idToken}),user=await UserImpl._fromGetAccountInfoResponse(this,response,idToken);await this.directlySetCurrentUser(user)}catch(err){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",err),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(popupRedirectResolver){var _a;if(_isFirebaseServerApp(this.app)){const idToken=this.app.settings.authIdToken;return idToken?new Promise(resolve=&gt;{setTimeout(()=&gt;this.initializeCurrentUserFromIdToken(idToken).then(resolve,resolve))}):this.directlySetCurrentUser(null)}const previouslyStoredUser=await this.assertedPersistence.getCurrentUser();let futureCurrentUser=previouslyStoredUser,needsTocheckMiddleware=!1;if(popupRedirectResolver&amp;&amp;this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const redirectUserEventId=null===(_a=this.redirectUser)||void 0===_a?void 0:_a._redirectEventId,storedUserEventId=null==futureCurrentUser?void 0:futureCurrentUser._redirectEventId,result=await this.tryRedirectSignIn(popupRedirectResolver);redirectUserEventId&amp;&amp;redirectUserEventId!==storedUserEventId||!(null==result?void 0:result.user)||(futureCurrentUser=result.user,needsTocheckMiddleware=!0)}if(!futureCurrentUser)return this.directlySetCurrentUser(null);if(!futureCurrentUser._redirectEventId){if(needsTocheckMiddleware)try{await this.beforeStateQueue.runMiddleware(futureCurrentUser)}catch(e){futureCurrentUser=previouslyStoredUser,this._popupRedirectResolver._overrideRedirectResult(this,()=&gt;Promise.reject(e))}return futureCurrentUser?this.reloadAndSetCurrentUserOrClear(futureCurrentUser):this.directlySetCurrentUser(null)}return _assert(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&amp;&amp;this.redirectUser._redirectEventId===futureCurrentUser._redirectEventId?this.directlySetCurrentUser(futureCurrentUser):this.reloadAndSetCurrentUserOrClear(futureCurrentUser)}async tryRedirectSignIn(redirectResolver){let result=null;try{result=await this._popupRedirectResolver._completeRedirectFn(this,redirectResolver,!0)}catch(e){await this._setRedirectUser(null)}return result}async reloadAndSetCurrentUserOrClear(user){try{await _reloadWithoutSaving(user)}catch(e){if("auth/network-request-failed"!==(null==e?void 0:e.code))return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(user)}useDeviceLanguage(){this.languageCode=function _getUserLanguage(){if("undefined"==typeof navigator)return null;const navigatorLanguage=navigator;return navigatorLanguage.languages&amp;&amp;navigatorLanguage.languages[0]||navigatorLanguage.language||null}()}async _delete(){this._deleted=!0}async updateCurrentUser(userExtern){if(_isFirebaseServerApp(this.app))return Promise.reject(_serverAppCurrentUserOperationNotSupportedError(this));const user=userExtern?getModularInstance(userExtern):null;return user&amp;&amp;_assert(user.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(user&amp;&amp;user._clone(this))}async _updateCurrentUser(user,skipBeforeStateCallbacks=!1){if(!this._deleted)return user&amp;&amp;_assert(this.tenantId===user.tenantId,this,"tenant-id-mismatch"),skipBeforeStateCallbacks||await this.beforeStateQueue.runMiddleware(user),this.queue(async()=&gt;{await this.directlySetCurrentUser(user),this.notifyAuthListeners()})}async signOut(){return _isFirebaseServerApp(this.app)?Promise.reject(_serverAppCurrentUserOperationNotSupportedError(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&amp;&amp;await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(persistence){return _isFirebaseServerApp(this.app)?Promise.reject(_serverAppCurrentUserOperationNotSupportedError(this)):this.queue(async()=&gt;{await this.assertedPersistence.setPersistence(_getInstance(persistence))})}_getRecaptchaConfig(){return null==this.tenantId?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(password){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const passwordPolicy=this._getPasswordPolicyInternal();return passwordPolicy.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):passwordPolicy.validatePassword(password)}_getPasswordPolicyInternal(){return null===this.tenantId?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const response=await async function _getPasswordPolicy(auth,request={}){return _performApiRequest(auth,"GET","/v2/passwordPolicy",_addTidIfNecessary(auth,request))}(this),passwordPolicy=new PasswordPolicyImpl(response);null===this.tenantId?this._projectPasswordPolicy=passwordPolicy:this._tenantPasswordPolicies[this.tenantId]=passwordPolicy}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(errorMap){this._errorFactory=new ErrorFactory("auth","Firebase",errorMap())}onAuthStateChanged(nextOrObserver,error,completed){return this.registerStateListener(this.authStateSubscription,nextOrObserver,error,completed)}beforeAuthStateChanged(callback,onAbort){return this.beforeStateQueue.pushCallback(callback,onAbort)}onIdTokenChanged(nextOrObserver,error,completed){return this.registerStateListener(this.idTokenSubscription,nextOrObserver,error,completed)}authStateReady(){return new Promise((resolve,reject)=&gt;{if(this.currentUser)resolve();else{const unsubscribe=this.onAuthStateChanged(()=&gt;{unsubscribe(),resolve()},reject)}})}async revokeAccessToken(token){if(this.currentUser){const request={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:token,idToken:await this.currentUser.getIdToken()};null!=this.tenantId&amp;&amp;(request.tenantId=this.tenantId),await async function revokeToken(auth,request){return _performApiRequest(auth,"POST","/v2/accounts:revokeToken",_addTidIfNecessary(auth,request))}(this,request)}}toJSON(){var _a;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:null===(_a=this._currentUser)||void 0===_a?void 0:_a.toJSON()}}async _setRedirectUser(user,popupRedirectResolver){const redirectManager=await this.getOrInitRedirectPersistenceManager(popupRedirectResolver);return null===user?redirectManager.removeCurrentUser():redirectManager.setCurrentUser(user)}async getOrInitRedirectPersistenceManager(popupRedirectResolver){if(!this.redirectPersistenceManager){const resolver=popupRedirectResolver&amp;&amp;_getInstance(popupRedirectResolver)||this._popupRedirectResolver;_assert(resolver,this,"argument-error"),this.redirectPersistenceManager=await PersistenceUserManager.create(this,[_getInstance(resolver._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(id){var _a,_b;return this._isInitialized&amp;&amp;await this.queue(async()=&gt;{}),(null===(_a=this._currentUser)||void 0===_a?void 0:_a._redirectEventId)===id?this._currentUser:(null===(_b=this.redirectUser)||void 0===_b?void 0:_b._redirectEventId)===id?this.redirectUser:null}async _persistUserIfCurrent(user){if(user===this.currentUser)return this.queue(async()=&gt;this.directlySetCurrentUser(user))}_notifyListenersIfCurrent(user){user===this.currentUser&amp;&amp;this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&amp;&amp;this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&amp;&amp;this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var _a,_b;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const currentUid=null!==(_b=null===(_a=this.currentUser)||void 0===_a?void 0:_a.uid)&amp;&amp;void 0!==_b?_b:null;this.lastNotifiedUid!==currentUid&amp;&amp;(this.lastNotifiedUid=currentUid,this.authStateSubscription.next(this.currentUser))}registerStateListener(subscription,nextOrObserver,error,completed){if(this._deleted)return()=&gt;{};const cb="function"==typeof nextOrObserver?nextOrObserver:nextOrObserver.next.bind(nextOrObserver);let isUnsubscribed=!1;const promise=this._isInitialized?Promise.resolve():this._initializationPromise;if(_assert(promise,this,"internal-error"),promise.then(()=&gt;{isUnsubscribed||cb(this.currentUser)}),"function"==typeof nextOrObserver){const unsubscribe=subscription.addObserver(nextOrObserver,error,completed);return()=&gt;{isUnsubscribed=!0,unsubscribe()}}{const unsubscribe=subscription.addObserver(nextOrObserver);return()=&gt;{isUnsubscribed=!0,unsubscribe()}}}async directlySetCurrentUser(user){this.currentUser&amp;&amp;this.currentUser!==user&amp;&amp;this._currentUser._stopProactiveRefresh(),user&amp;&amp;this.isProactiveRefreshEnabled&amp;&amp;user._startProactiveRefresh(),this.currentUser=user,user?await this.assertedPersistence.setCurrentUser(user):await this.assertedPersistence.removeCurrentUser()}queue(action){return this.operations=this.operations.then(action,action),this.operations}get assertedPersistence(){return _assert(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(framework){framework&amp;&amp;!this.frameworks.includes(framework)&amp;&amp;(this.frameworks.push(framework),this.frameworks.sort(),this.clientVersion=_getClientVersion(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var _a;const headers={"X-Client-Version":this.clientVersion};this.app.options.appId&amp;&amp;(headers["X-Firebase-gmpid"]=this.app.options.appId);const heartbeatsHeader=await(null===(_a=this.heartbeatServiceProvider.getImmediate({optional:!0}))||void 0===_a?void 0:_a.getHeartbeatsHeader());heartbeatsHeader&amp;&amp;(headers["X-Firebase-Client"]=heartbeatsHeader);const appCheckToken=await this._getAppCheckToken();return appCheckToken&amp;&amp;(headers["X-Firebase-AppCheck"]=appCheckToken),headers}async _getAppCheckToken(){var _a;if(_isFirebaseServerApp(this.app)&amp;&amp;this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const appCheckTokenResult=await(null===(_a=this.appCheckServiceProvider.getImmediate({optional:!0}))||void 0===_a?void 0:_a.getToken());return(null==appCheckTokenResult?void 0:appCheckTokenResult.error)&amp;&amp;function _logWarn(msg,...args){logClient.logLevel&lt;=LogLevel.WARN&amp;&amp;logClient.warn(`Auth (11.10.0): ${msg}`,...args)}(`Error while retrieving App Check token: ${appCheckTokenResult.error}`),null==appCheckTokenResult?void 0:appCheckTokenResult.token}}function _castAuth(auth){return getModularInstance(auth)}class Subscription{constructor(auth){this.auth=auth,this.observer=null,this.addObserver=function createSubscribe(executor,onNoObservers){const proxy=new ObserverProxy(executor,onNoObservers);return proxy.subscribe.bind(proxy)}(observer=&gt;this.observer=observer)}get next(){return _assert(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}let externalJSProvider={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function _loadJS(url){return externalJSProvider.loadJS(url)}class MockGreCAPTCHATopLevel{constructor(){this.enterprise=new MockGreCAPTCHA}ready(callback){callback()}execute(_siteKey,_options){return Promise.resolve("token")}render(_container,_parameters){return""}}class MockGreCAPTCHA{ready(callback){callback()}execute(_siteKey,_options){return Promise.resolve("token")}render(_container,_parameters){return""}}class RecaptchaEnterpriseVerifier{constructor(authExtern){this.type="recaptcha-enterprise",this.auth=_castAuth(authExtern)}async verify(action="verify",forceRefresh=!1){async function retrieveSiteKey(auth){if(!forceRefresh){if(null==auth.tenantId&amp;&amp;null!=auth._agentRecaptchaConfig)return auth._agentRecaptchaConfig.siteKey;if(null!=auth.tenantId&amp;&amp;void 0!==auth._tenantRecaptchaConfigs[auth.tenantId])return auth._tenantRecaptchaConfigs[auth.tenantId].siteKey}return new Promise(async(resolve,reject)=&gt;{(async function getRecaptchaConfig(auth,request){return _performApiRequest(auth,"GET","/v2/recaptchaConfig",_addTidIfNecessary(auth,request))})(auth,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(response=&gt;{if(void 0!==response.recaptchaKey){const config=new RecaptchaConfig(response);return null==auth.tenantId?auth._agentRecaptchaConfig=config:auth._tenantRecaptchaConfigs[auth.tenantId]=config,resolve(config.siteKey)}reject(new Error("recaptcha Enterprise site key undefined"))}).catch(error=&gt;{reject(error)})})}function retrieveRecaptchaToken(siteKey,resolve,reject){const grecaptcha=window.grecaptcha;isEnterprise(grecaptcha)?grecaptcha.enterprise.ready(()=&gt;{grecaptcha.enterprise.execute(siteKey,{action:action}).then(token=&gt;{resolve(token)}).catch(()=&gt;{resolve("NO_RECAPTCHA")})}):reject(Error("No reCAPTCHA enterprise script loaded."))}if(this.auth.settings.appVerificationDisabledForTesting){return(new MockGreCAPTCHATopLevel).execute("siteKey",{action:"verify"})}return new Promise((resolve,reject)=&gt;{retrieveSiteKey(this.auth).then(siteKey=&gt;{if(!forceRefresh&amp;&amp;isEnterprise(window.grecaptcha))retrieveRecaptchaToken(siteKey,resolve,reject);else{if("undefined"==typeof window)return void reject(new Error("RecaptchaVerifier is only supported in browser"));let url=function _recaptchaEnterpriseScriptUrl(){return externalJSProvider.recaptchaEnterpriseScript}();0!==url.length&amp;&amp;(url+=siteKey),_loadJS(url).then(()=&gt;{retrieveRecaptchaToken(siteKey,resolve,reject)}).catch(error=&gt;{reject(error)})}}).catch(error=&gt;{reject(error)})})}}async function injectRecaptchaFields(auth,request,action,isCaptchaResp=!1,isFakeToken=!1){const verifier=new RecaptchaEnterpriseVerifier(auth);let captchaResponse;if(isFakeToken)captchaResponse="NO_RECAPTCHA";else try{captchaResponse=await verifier.verify(action)}catch(error){captchaResponse=await verifier.verify(action,!0)}const newRequest=Object.assign({},request);if("mfaSmsEnrollment"===action||"mfaSmsSignIn"===action){if("phoneEnrollmentInfo"in newRequest){const phoneNumber=newRequest.phoneEnrollmentInfo.phoneNumber,recaptchaToken=newRequest.phoneEnrollmentInfo.recaptchaToken;Object.assign(newRequest,{phoneEnrollmentInfo:{phoneNumber:phoneNumber,recaptchaToken:recaptchaToken,captchaResponse:captchaResponse,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in newRequest){const recaptchaToken=newRequest.phoneSignInInfo.recaptchaToken;Object.assign(newRequest,{phoneSignInInfo:{recaptchaToken:recaptchaToken,captchaResponse:captchaResponse,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return newRequest}return isCaptchaResp?Object.assign(newRequest,{captchaResp:captchaResponse}):Object.assign(newRequest,{captchaResponse:captchaResponse}),Object.assign(newRequest,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(newRequest,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),newRequest}async function handleRecaptchaFlow(authInstance,request,actionName,actionMethod,recaptchaAuthProvider){var _a;if(null===(_a=authInstance._getRecaptchaConfig())||void 0===_a?void 0:_a.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const requestWithRecaptcha=await injectRecaptchaFields(authInstance,request,actionName,"getOobCode"===actionName);return actionMethod(authInstance,requestWithRecaptcha)}return actionMethod(authInstance,request).catch(async error=&gt;{if("auth/missing-recaptcha-token"===error.code){console.log(`${actionName} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const requestWithRecaptcha=await injectRecaptchaFields(authInstance,request,actionName,"getOobCode"===actionName);return actionMethod(authInstance,requestWithRecaptcha)}return Promise.reject(error)})}function connectAuthEmulator(auth,url,options){const authInternal=_castAuth(auth);_assert(/^https?:\/\//.test(url),authInternal,"invalid-emulator-scheme");const protocol=extractProtocol(url),{host:host,port:port}=function extractHostAndPort(url){const protocol=extractProtocol(url),authority=/(\/\/)?([^?#/]+)/.exec(url.substr(protocol.length));if(!authority)return{host:"",port:null};const hostAndPort=authority[2].split("@").pop()||"",bracketedIPv6=/^(\[[^\]]+\])(:|$)/.exec(hostAndPort);if(bracketedIPv6){const host=bracketedIPv6[1];return{host:host,port:parsePort(hostAndPort.substr(host.length+1))}}{const[host,port]=hostAndPort.split(":");return{host:host,port:parsePort(port)}}}(url),portStr=null===port?"":`:${port}`,emulator={url:`${protocol}//${host}${portStr}/`},emulatorConfig=Object.freeze({host:host,port:port,protocol:protocol.replace(":",""),options:Object.freeze({disableWarnings:!1})});if(!authInternal._canInitEmulator)return _assert(authInternal.config.emulator&amp;&amp;authInternal.emulatorConfig,authInternal,"emulator-config-failed"),void _assert(deepEqual(emulator,authInternal.config.emulator)&amp;&amp;deepEqual(emulatorConfig,authInternal.emulatorConfig),authInternal,"emulator-config-failed");authInternal.config.emulator=emulator,authInternal.emulatorConfig=emulatorConfig,authInternal.settings.appVerificationDisabledForTesting=!0,isCloudWorkstation(host)?(pingServer(`${protocol}//${host}${portStr}`),updateEmulatorBanner("Auth",!0)):function emitEmulatorWarning(){function attachBanner(){const el=document.createElement("p"),sty=el.style;el.innerText="Running in emulator mode. Do not use with production credentials.",sty.position="fixed",sty.width="100%",sty.backgroundColor="#ffffff",sty.border=".1em solid #000000",sty.color="#b50000",sty.bottom="0px",sty.left="0px",sty.margin="0px",sty.zIndex="10000",sty.textAlign="center",el.classList.add("firebase-emulator-warning"),document.body.appendChild(el)}"undefined"!=typeof console&amp;&amp;"function"==typeof console.info&amp;&amp;console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials.");"undefined"!=typeof window&amp;&amp;"undefined"!=typeof document&amp;&amp;("loading"===document.readyState?window.addEventListener("DOMContentLoaded",attachBanner):attachBanner())}()}function extractProtocol(url){const protocolEnd=url.indexOf(":");return protocolEnd&lt;0?"":url.substr(0,protocolEnd+1)}function parsePort(portStr){if(!portStr)return null;const port=Number(portStr);return isNaN(port)?null:port}class AuthCredential{constructor(providerId,signInMethod){this.providerId=providerId,this.signInMethod=signInMethod}toJSON(){return debugFail("not implemented")}_getIdTokenResponse(_auth){return debugFail("not implemented")}_linkToIdToken(_auth,_idToken){return debugFail("not implemented")}_getReauthenticationResolver(_auth){return debugFail("not implemented")}}async function linkEmailPassword(auth,request){return _performApiRequest(auth,"POST","/v1/accounts:signUp",request)}async function signInWithPassword(auth,request){return _performSignInRequest(auth,"POST","/v1/accounts:signInWithPassword",_addTidIfNecessary(auth,request))}async function sendPasswordResetEmail$1(auth,request){return async function sendOobCode(auth,request){return _performApiRequest(auth,"POST","/v1/accounts:sendOobCode",_addTidIfNecessary(auth,request))}(auth,request)}class EmailAuthCredential extends AuthCredential{constructor(_email,_password,signInMethod,_tenantId=null){super("password",signInMethod),this._email=_email,this._password=_password,this._tenantId=_tenantId}static _fromEmailAndPassword(email,password){return new EmailAuthCredential(email,password,"password")}static _fromEmailAndCode(email,oobCode,tenantId=null){return new EmailAuthCredential(email,oobCode,"emailLink",tenantId)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(json){const obj="string"==typeof json?JSON.parse(json):json;if((null==obj?void 0:obj.email)&amp;&amp;(null==obj?void 0:obj.password)){if("password"===obj.signInMethod)return this._fromEmailAndPassword(obj.email,obj.password);if("emailLink"===obj.signInMethod)return this._fromEmailAndCode(obj.email,obj.password,obj.tenantId)}return null}async _getIdTokenResponse(auth){switch(this.signInMethod){case"password":return handleRecaptchaFlow(auth,{returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"},"signInWithPassword",signInWithPassword);case"emailLink":return async function signInWithEmailLink$1(auth,request){return _performSignInRequest(auth,"POST","/v1/accounts:signInWithEmailLink",_addTidIfNecessary(auth,request))}(auth,{email:this._email,oobCode:this._password});default:_fail(auth,"internal-error")}}async _linkToIdToken(auth,idToken){switch(this.signInMethod){case"password":return handleRecaptchaFlow(auth,{idToken:idToken,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",linkEmailPassword);case"emailLink":return async function signInWithEmailLinkForLinking(auth,request){return _performSignInRequest(auth,"POST","/v1/accounts:signInWithEmailLink",_addTidIfNecessary(auth,request))}(auth,{idToken:idToken,email:this._email,oobCode:this._password});default:_fail(auth,"internal-error")}}_getReauthenticationResolver(auth){return this._getIdTokenResponse(auth)}}async function signInWithIdp(auth,request){return _performSignInRequest(auth,"POST","/v1/accounts:signInWithIdp",_addTidIfNecessary(auth,request))}class OAuthCredential extends AuthCredential{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(params){const cred=new OAuthCredential(params.providerId,params.signInMethod);return params.idToken||params.accessToken?(params.idToken&amp;&amp;(cred.idToken=params.idToken),params.accessToken&amp;&amp;(cred.accessToken=params.accessToken),params.nonce&amp;&amp;!params.pendingToken&amp;&amp;(cred.nonce=params.nonce),params.pendingToken&amp;&amp;(cred.pendingToken=params.pendingToken)):params.oauthToken&amp;&amp;params.oauthTokenSecret?(cred.accessToken=params.oauthToken,cred.secret=params.oauthTokenSecret):_fail("argument-error"),cred}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(json){const obj="string"==typeof json?JSON.parse(json):json,{providerId:providerId,signInMethod:signInMethod}=obj,rest=__rest(obj,["providerId","signInMethod"]);if(!providerId||!signInMethod)return null;const cred=new OAuthCredential(providerId,signInMethod);return cred.idToken=rest.idToken||void 0,cred.accessToken=rest.accessToken||void 0,cred.secret=rest.secret,cred.nonce=rest.nonce,cred.pendingToken=rest.pendingToken||null,cred}_getIdTokenResponse(auth){return signInWithIdp(auth,this.buildRequest())}_linkToIdToken(auth,idToken){const request=this.buildRequest();return request.idToken=idToken,signInWithIdp(auth,request)}_getReauthenticationResolver(auth){const request=this.buildRequest();return request.autoCreate=!1,signInWithIdp(auth,request)}buildRequest(){const request={requestUri:"http://localhost",returnSecureToken:!0};if(this.pendingToken)request.pendingToken=this.pendingToken;else{const postBody={};this.idToken&amp;&amp;(postBody.id_token=this.idToken),this.accessToken&amp;&amp;(postBody.access_token=this.accessToken),this.secret&amp;&amp;(postBody.oauth_token_secret=this.secret),postBody.providerId=this.providerId,this.nonce&amp;&amp;!this.pendingToken&amp;&amp;(postBody.nonce=this.nonce),request.postBody=querystring(postBody)}return request}}class ActionCodeURL{constructor(actionLink){var _a,_b,_c,_d,_e2,_f;const searchParams=querystringDecode(extractQuerystring(actionLink)),apiKey=null!==(_a=searchParams.apiKey)&amp;&amp;void 0!==_a?_a:null,code=null!==(_b=searchParams.oobCode)&amp;&amp;void 0!==_b?_b:null,operation=function parseMode(mode){switch(mode){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}(null!==(_c=searchParams.mode)&amp;&amp;void 0!==_c?_c:null);_assert(apiKey&amp;&amp;code&amp;&amp;operation,"argument-error"),this.apiKey=apiKey,this.operation=operation,this.code=code,this.continueUrl=null!==(_d=searchParams.continueUrl)&amp;&amp;void 0!==_d?_d:null,this.languageCode=null!==(_e2=searchParams.lang)&amp;&amp;void 0!==_e2?_e2:null,this.tenantId=null!==(_f=searchParams.tenantId)&amp;&amp;void 0!==_f?_f:null}static parseLink(link){const actionLink=function parseDeepLink(url){const link=querystringDecode(extractQuerystring(url)).link,doubleDeepLink=link?querystringDecode(extractQuerystring(link)).deep_link_id:null,iOSDeepLink=querystringDecode(extractQuerystring(url)).deep_link_id;return(iOSDeepLink?querystringDecode(extractQuerystring(iOSDeepLink)).link:null)||iOSDeepLink||doubleDeepLink||link||url}(link);try{return new ActionCodeURL(actionLink)}catch(_a){return null}}}class EmailAuthProvider{constructor(){this.providerId=EmailAuthProvider.PROVIDER_ID}static credential(email,password){return EmailAuthCredential._fromEmailAndPassword(email,password)}static credentialWithLink(email,emailLink){const actionCodeUrl=ActionCodeURL.parseLink(emailLink);return _assert(actionCodeUrl,"argument-error"),EmailAuthCredential._fromEmailAndCode(email,actionCodeUrl.code,actionCodeUrl.tenantId)}}EmailAuthProvider.PROVIDER_ID="password",EmailAuthProvider.EMAIL_PASSWORD_SIGN_IN_METHOD="password",EmailAuthProvider.EMAIL_LINK_SIGN_IN_METHOD="emailLink";class FederatedAuthProvider{constructor(providerId){this.providerId=providerId,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(languageCode){this.defaultLanguageCode=languageCode}setCustomParameters(customOAuthParameters){return this.customParameters=customOAuthParameters,this}getCustomParameters(){return this.customParameters}}class BaseOAuthProvider extends FederatedAuthProvider{constructor(){super(...arguments),this.scopes=[]}addScope(scope){return this.scopes.includes(scope)||this.scopes.push(scope),this}getScopes(){return[...this.scopes]}}class OAuthProvider extends BaseOAuthProvider{static credentialFromJSON(json){const obj="string"==typeof json?JSON.parse(json):json;return _assert("providerId"in obj&amp;&amp;"signInMethod"in obj,"argument-error"),OAuthCredential._fromParams(obj)}credential(params){return this._credential(Object.assign(Object.assign({},params),{nonce:params.rawNonce}))}_credential(params){return _assert(params.idToken||params.accessToken,"argument-error"),OAuthCredential._fromParams(Object.assign(Object.assign({},params),{providerId:this.providerId,signInMethod:this.providerId}))}static credentialFromResult(userCredential){return OAuthProvider.oauthCredentialFromTaggedObject(userCredential)}static credentialFromError(error){return OAuthProvider.oauthCredentialFromTaggedObject(error.customData||{})}static oauthCredentialFromTaggedObject({_tokenResponse:tokenResponse}){if(!tokenResponse)return null;const{oauthIdToken:oauthIdToken,oauthAccessToken:oauthAccessToken,oauthTokenSecret:oauthTokenSecret,pendingToken:pendingToken,nonce:nonce,providerId:providerId}=tokenResponse;if(!(oauthAccessToken||oauthTokenSecret||oauthIdToken||pendingToken))return null;if(!providerId)return null;try{return new OAuthProvider(providerId)._credential({idToken:oauthIdToken,accessToken:oauthAccessToken,nonce:nonce,pendingToken:pendingToken})}catch(e){return null}}}class FacebookAuthProvider extends BaseOAuthProvider{constructor(){super("facebook.com")}static credential(accessToken){return OAuthCredential._fromParams({providerId:FacebookAuthProvider.PROVIDER_ID,signInMethod:FacebookAuthProvider.FACEBOOK_SIGN_IN_METHOD,accessToken:accessToken})}static credentialFromResult(userCredential){return FacebookAuthProvider.credentialFromTaggedObject(userCredential)}static credentialFromError(error){return FacebookAuthProvider.credentialFromTaggedObject(error.customData||{})}static credentialFromTaggedObject({_tokenResponse:tokenResponse}){if(!tokenResponse||!("oauthAccessToken"in tokenResponse))return null;if(!tokenResponse.oauthAccessToken)return null;try{return FacebookAuthProvider.credential(tokenResponse.oauthAccessToken)}catch(_a){return null}}}FacebookAuthProvider.FACEBOOK_SIGN_IN_METHOD="facebook.com",FacebookAuthProvider.PROVIDER_ID="facebook.com";class GoogleAuthProvider extends BaseOAuthProvider{constructor(){super("google.com"),this.addScope("profile")}static credential(idToken,accessToken){return OAuthCredential._fromParams({providerId:GoogleAuthProvider.PROVIDER_ID,signInMethod:GoogleAuthProvider.GOOGLE_SIGN_IN_METHOD,idToken:idToken,accessToken:accessToken})}static credentialFromResult(userCredential){return GoogleAuthProvider.credentialFromTaggedObject(userCredential)}static credentialFromError(error){return GoogleAuthProvider.credentialFromTaggedObject(error.customData||{})}static credentialFromTaggedObject({_tokenResponse:tokenResponse}){if(!tokenResponse)return null;const{oauthIdToken:oauthIdToken,oauthAccessToken:oauthAccessToken}=tokenResponse;if(!oauthIdToken&amp;&amp;!oauthAccessToken)return null;try{return GoogleAuthProvider.credential(oauthIdToken,oauthAccessToken)}catch(_a){return null}}}GoogleAuthProvider.GOOGLE_SIGN_IN_METHOD="google.com",GoogleAuthProvider.PROVIDER_ID="google.com";class GithubAuthProvider extends BaseOAuthProvider{constructor(){super("github.com")}static credential(accessToken){return OAuthCredential._fromParams({providerId:GithubAuthProvider.PROVIDER_ID,signInMethod:GithubAuthProvider.GITHUB_SIGN_IN_METHOD,accessToken:accessToken})}static credentialFromResult(userCredential){return GithubAuthProvider.credentialFromTaggedObject(userCredential)}static credentialFromError(error){return GithubAuthProvider.credentialFromTaggedObject(error.customData||{})}static credentialFromTaggedObject({_tokenResponse:tokenResponse}){if(!tokenResponse||!("oauthAccessToken"in tokenResponse))return null;if(!tokenResponse.oauthAccessToken)return null;try{return GithubAuthProvider.credential(tokenResponse.oauthAccessToken)}catch(_a){return null}}}GithubAuthProvider.GITHUB_SIGN_IN_METHOD="github.com",GithubAuthProvider.PROVIDER_ID="github.com";class TwitterAuthProvider extends BaseOAuthProvider{constructor(){super("twitter.com")}static credential(token,secret){return OAuthCredential._fromParams({providerId:TwitterAuthProvider.PROVIDER_ID,signInMethod:TwitterAuthProvider.TWITTER_SIGN_IN_METHOD,oauthToken:token,oauthTokenSecret:secret})}static credentialFromResult(userCredential){return TwitterAuthProvider.credentialFromTaggedObject(userCredential)}static credentialFromError(error){return TwitterAuthProvider.credentialFromTaggedObject(error.customData||{})}static credentialFromTaggedObject({_tokenResponse:tokenResponse}){if(!tokenResponse)return null;const{oauthAccessToken:oauthAccessToken,oauthTokenSecret:oauthTokenSecret}=tokenResponse;if(!oauthAccessToken||!oauthTokenSecret)return null;try{return TwitterAuthProvider.credential(oauthAccessToken,oauthTokenSecret)}catch(_a){return null}}}TwitterAuthProvider.TWITTER_SIGN_IN_METHOD="twitter.com",TwitterAuthProvider.PROVIDER_ID="twitter.com";class UserCredentialImpl{constructor(params){this.user=params.user,this.providerId=params.providerId,this._tokenResponse=params._tokenResponse,this.operationType=params.operationType}static async _fromIdTokenResponse(auth,operationType,idTokenResponse,isAnonymous=!1){const user=await UserImpl._fromIdTokenResponse(auth,idTokenResponse,isAnonymous),providerId=providerIdForResponse(idTokenResponse);return new UserCredentialImpl({user:user,providerId:providerId,_tokenResponse:idTokenResponse,operationType:operationType})}static async _forOperation(user,operationType,response){await user._updateTokensIfNecessary(response,!0);const providerId=providerIdForResponse(response);return new UserCredentialImpl({user:user,providerId:providerId,_tokenResponse:response,operationType:operationType})}}function providerIdForResponse(response){return response.providerId?response.providerId:"phoneNumber"in response?"phone":null}class MultiFactorError extends FirebaseError{constructor(auth,error,operationType,user){var _a;super(error.code,error.message),this.operationType=operationType,this.user=user,Object.setPrototypeOf(this,MultiFactorError.prototype),this.customData={appName:auth.name,tenantId:null!==(_a=auth.tenantId)&amp;&amp;void 0!==_a?_a:void 0,_serverResponse:error.customData._serverResponse,operationType:operationType}}static _fromErrorAndOperation(auth,error,operationType,user){return new MultiFactorError(auth,error,operationType,user)}}function _processCredentialSavingMfaContextIfNecessary(auth,operationType,credential,user){return("reauthenticate"===operationType?credential._getReauthenticationResolver(auth):credential._getIdTokenResponse(auth)).catch(error=&gt;{if("auth/multi-factor-auth-required"===error.code)throw MultiFactorError._fromErrorAndOperation(auth,error,operationType,user);throw error})}async function _signInWithCredential(auth,credential,bypassAuthState=!1){if(_isFirebaseServerApp(auth.app))return Promise.reject(_serverAppCurrentUserOperationNotSupportedError(auth));const response=await _processCredentialSavingMfaContextIfNecessary(auth,"signIn",credential),userCredential=await UserCredentialImpl._fromIdTokenResponse(auth,"signIn",response);return bypassAuthState||await auth._updateCurrentUser(userCredential.user),userCredential}async function sendPasswordResetEmail(auth,email,actionCodeSettings){const authInternal=_castAuth(auth),request={requestType:"PASSWORD_RESET",email:email,clientType:"CLIENT_TYPE_WEB"};await handleRecaptchaFlow(authInternal,request,"getOobCode",sendPasswordResetEmail$1)}function signInWithEmailAndPassword(auth,email,password){return _isFirebaseServerApp(auth.app)?Promise.reject(_serverAppCurrentUserOperationNotSupportedError(auth)):async function signInWithCredential(auth,credential){return _signInWithCredential(_castAuth(auth),credential)}(getModularInstance(auth),EmailAuthProvider.credential(email,password)).catch(async error=&gt;{throw"auth/password-does-not-meet-requirements"===error.code&amp;&amp;async function recachePasswordPolicy(auth){const authInternal=_castAuth(auth);authInternal._getPasswordPolicyInternal()&amp;&amp;await authInternal._updatePasswordPolicy()}(auth),error})}function onAuthStateChanged(auth,nextOrObserver,error,completed){return getModularInstance(auth).onAuthStateChanged(nextOrObserver,error,completed)}function signOut(auth){return getModularInstance(auth).signOut()}class BrowserPersistenceClass{constructor(storageRetriever,type){this.storageRetriever=storageRetriever,this.type=type}_isAvailable(){try{return this.storage?(this.storage.setItem("__sak","1"),this.storage.removeItem("__sak"),Promise.resolve(!0)):Promise.resolve(!1)}catch(_a){return Promise.resolve(!1)}}_set(key,value){return this.storage.setItem(key,JSON.stringify(value)),Promise.resolve()}_get(key){const json=this.storage.getItem(key);return Promise.resolve(json?JSON.parse(json):null)}_remove(key){return this.storage.removeItem(key),Promise.resolve()}get storage(){return this.storageRetriever()}}class BrowserLocalPersistence extends BrowserPersistenceClass{constructor(){super(()=&gt;window.localStorage,"LOCAL"),this.boundEventHandler=(event,poll)=&gt;this.onStorageEvent(event,poll),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=_isMobileBrowser(),this._shouldAllowMigration=!0}forAllChangedKeys(cb){for(const key of Object.keys(this.listeners)){const newValue=this.storage.getItem(key),oldValue=this.localCache[key];newValue!==oldValue&amp;&amp;cb(key,oldValue,newValue)}}onStorageEvent(event,poll=!1){if(!event.key)return void this.forAllChangedKeys((key2,_oldValue,newValue)=&gt;{this.notifyListeners(key2,newValue)});const key=event.key;poll?this.detachListener():this.stopPolling();const triggerListeners=()=&gt;{const storedValue2=this.storage.getItem(key);(poll||this.localCache[key]!==storedValue2)&amp;&amp;this.notifyListeners(key,storedValue2)},storedValue=this.storage.getItem(key);_isIE10()&amp;&amp;storedValue!==event.newValue&amp;&amp;event.newValue!==event.oldValue?setTimeout(triggerListeners,10):triggerListeners()}notifyListeners(key,value){this.localCache[key]=value;const listeners=this.listeners[key];if(listeners)for(const listener of Array.from(listeners))listener(value?JSON.parse(value):value)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=&gt;{this.forAllChangedKeys((key,oldValue,newValue)=&gt;{this.onStorageEvent(new StorageEvent("storage",{key:key,oldValue:oldValue,newValue:newValue}),!0)})},1e3)}stopPolling(){this.pollTimer&amp;&amp;(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(key,listener){0===Object.keys(this.listeners).length&amp;&amp;(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[key]||(this.listeners[key]=new Set,this.localCache[key]=this.storage.getItem(key)),this.listeners[key].add(listener)}_removeListener(key,listener){this.listeners[key]&amp;&amp;(this.listeners[key].delete(listener),0===this.listeners[key].size&amp;&amp;delete this.listeners[key]),0===Object.keys(this.listeners).length&amp;&amp;(this.detachListener(),this.stopPolling())}async _set(key,value){await super._set(key,value),this.localCache[key]=JSON.stringify(value)}async _get(key){const value=await super._get(key);return this.localCache[key]=JSON.stringify(value),value}async _remove(key){await super._remove(key),delete this.localCache[key]}}BrowserLocalPersistence.type="LOCAL";const browserLocalPersistence=BrowserLocalPersistence;class BrowserSessionPersistence extends BrowserPersistenceClass{constructor(){super(()=&gt;window.sessionStorage,"SESSION")}_addListener(_key,_listener){}_removeListener(_key,_listener){}}BrowserSessionPersistence.type="SESSION";const browserSessionPersistence=BrowserSessionPersistence;class Receiver{constructor(eventTarget){this.eventTarget=eventTarget,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(eventTarget){const existingInstance=this.receivers.find(receiver=&gt;receiver.isListeningto(eventTarget));if(existingInstance)return existingInstance;const newInstance=new Receiver(eventTarget);return this.receivers.push(newInstance),newInstance}isListeningto(eventTarget){return this.eventTarget===eventTarget}async handleEvent(event){const messageEvent=event,{eventId:eventId,eventType:eventType,data:data}=messageEvent.data,handlers=this.handlersMap[eventType];if(!(null==handlers?void 0:handlers.size))return;messageEvent.ports[0].postMessage({status:"ack",eventId:eventId,eventType:eventType});const promises=Array.from(handlers).map(async handler=&gt;handler(messageEvent.origin,data)),response=await function _allSettled(promises){return Promise.all(promises.map(async promise=&gt;{try{return{fulfilled:!0,value:await promise}}catch(reason){return{fulfilled:!1,reason:reason}}}))}(promises);messageEvent.ports[0].postMessage({status:"done",eventId:eventId,eventType:eventType,response:response})}_subscribe(eventType,eventHandler){0===Object.keys(this.handlersMap).length&amp;&amp;this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[eventType]||(this.handlersMap[eventType]=new Set),this.handlersMap[eventType].add(eventHandler)}_unsubscribe(eventType,eventHandler){this.handlersMap[eventType]&amp;&amp;eventHandler&amp;&amp;this.handlersMap[eventType].delete(eventHandler),eventHandler&amp;&amp;0!==this.handlersMap[eventType].size||delete this.handlersMap[eventType],0===Object.keys(this.handlersMap).length&amp;&amp;this.eventTarget.removeEventListener("message",this.boundEventHandler)}}function _generateEventId(prefix="",digits=10){let random="";for(let i=0;i&lt;digits;i++)random+=Math.floor(10*Math.random());return prefix+random}Receiver.receivers=[];class Sender{constructor(target){this.target=target,this.handlers=new Set}removeMessageHandler(handler){handler.messageChannel&amp;&amp;(handler.messageChannel.port1.removeEventListener("message",handler.onMessage),handler.messageChannel.port1.close()),this.handlers.delete(handler)}async _send(eventType,data,timeout=50){const messageChannel="undefined"!=typeof MessageChannel?new MessageChannel:null;if(!messageChannel)throw new Error("connection_unavailable");let completionTimer,handler;return new Promise((resolve,reject)=&gt;{const eventId=_generateEventId("",20);messageChannel.port1.start();const ackTimer=setTimeout(()=&gt;{reject(new Error("unsupported_event"))},timeout);handler={messageChannel:messageChannel,onMessage(event){const messageEvent=event;if(messageEvent.data.eventId===eventId)switch(messageEvent.data.status){case"ack":clearTimeout(ackTimer),completionTimer=setTimeout(()=&gt;{reject(new Error("timeout"))},3e3);break;case"done":clearTimeout(completionTimer),resolve(messageEvent.data.response);break;default:clearTimeout(ackTimer),clearTimeout(completionTimer),reject(new Error("invalid_response"))}}},this.handlers.add(handler),messageChannel.port1.addEventListener("message",handler.onMessage),this.target.postMessage({eventType:eventType,eventId:eventId,data:data},[messageChannel.port2])}).finally(()=&gt;{handler&amp;&amp;this.removeMessageHandler(handler)})}}function _window(){return window}function _isWorker(){return void 0!==_window().WorkerGlobalScope&amp;&amp;"function"==typeof _window().importScripts}const DB_DATA_KEYPATH="fbase_key";class DBPromise{constructor(request){this.request=request}toPromise(){return new Promise((resolve,reject)=&gt;{this.request.addEventListener("success",()=&gt;{resolve(this.request.result)}),this.request.addEventListener("error",()=&gt;{reject(this.request.error)})})}}function getObjectStore(db,isReadWrite){return db.transaction(["firebaseLocalStorage"],isReadWrite?"readwrite":"readonly").objectStore("firebaseLocalStorage")}function _openDatabase(){const request=indexedDB.open("firebaseLocalStorageDb",1);return new Promise((resolve,reject)=&gt;{request.addEventListener("error",()=&gt;{reject(request.error)}),request.addEventListener("upgradeneeded",()=&gt;{const db=request.result;try{db.createObjectStore("firebaseLocalStorage",{keyPath:"fbase_key"})}catch(e){reject(e)}}),request.addEventListener("success",async()=&gt;{const db=request.result;db.objectStoreNames.contains("firebaseLocalStorage")?resolve(db):(db.close(),await function _deleteDatabase(){const request=indexedDB.deleteDatabase("firebaseLocalStorageDb");return new DBPromise(request).toPromise()}(),resolve(await _openDatabase()))})})}async function _putObject(db,key,value){const request=getObjectStore(db,!0).put({[DB_DATA_KEYPATH]:key,value:value});return new DBPromise(request).toPromise()}function _deleteObject(db,key){const request=getObjectStore(db,!0).delete(key);return new DBPromise(request).toPromise()}class IndexedDBLocalPersistence{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=&gt;{},()=&gt;{})}async _openDb(){return this.db||(this.db=await _openDatabase()),this.db}async _withRetries(op){let numAttempts=0;for(;;)try{const db=await this._openDb();return await op(db)}catch(e){if(numAttempts++&gt;3)throw e;this.db&amp;&amp;(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return _isWorker()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=Receiver._getInstance(function _getWorkerGlobalScope(){return _isWorker()?self:null}()),this.receiver._subscribe("keyChanged",async(_origin,data)=&gt;({keyProcessed:(await this._poll()).includes(data.key)})),this.receiver._subscribe("ping",async(_origin,_data)=&gt;["keyChanged"])}async initializeSender(){var _a,_b;if(this.activeServiceWorker=await async function _getActiveServiceWorker(){if(!(null===navigator||void 0===navigator?void 0:navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch(_a){return null}}(),!this.activeServiceWorker)return;this.sender=new Sender(this.activeServiceWorker);const results=await this.sender._send("ping",{},800);results&amp;&amp;(null===(_a=results[0])||void 0===_a?void 0:_a.fulfilled)&amp;&amp;(null===(_b=results[0])||void 0===_b?void 0:_b.value.includes("keyChanged"))&amp;&amp;(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(key){if(this.sender&amp;&amp;this.activeServiceWorker&amp;&amp;function _getServiceWorkerController(){var _a;return(null===(_a=null===navigator||void 0===navigator?void 0:navigator.serviceWorker)||void 0===_a?void 0:_a.controller)||null}()===this.activeServiceWorker)try{await this.sender._send("keyChanged",{key:key},this.serviceWorkerReceiverAvailable?800:50)}catch(_a){}}async _isAvailable(){try{if(!indexedDB)return!1;const db=await _openDatabase();return await _putObject(db,"__sak","1"),await _deleteObject(db,"__sak"),!0}catch(_a){}return!1}async _withPendingWrite(write2){this.pendingWrites++;try{await write2()}finally{this.pendingWrites--}}async _set(key,value){return this._withPendingWrite(async()=&gt;(await this._withRetries(db=&gt;_putObject(db,key,value)),this.localCache[key]=value,this.notifyServiceWorker(key)))}async _get(key){const obj=await this._withRetries(db=&gt;async function getObject(db,key){const request=getObjectStore(db,!1).get(key),data=await new DBPromise(request).toPromise();return void 0===data?null:data.value}(db,key));return this.localCache[key]=obj,obj}async _remove(key){return this._withPendingWrite(async()=&gt;(await this._withRetries(db=&gt;_deleteObject(db,key)),delete this.localCache[key],this.notifyServiceWorker(key)))}async _poll(){const result=await this._withRetries(db=&gt;{const getAllRequest=getObjectStore(db,!1).getAll();return new DBPromise(getAllRequest).toPromise()});if(!result)return[];if(0!==this.pendingWrites)return[];const keys=[],keysInResult=new Set;if(0!==result.length)for(const{fbase_key:key,value:value}of result)keysInResult.add(key),JSON.stringify(this.localCache[key])!==JSON.stringify(value)&amp;&amp;(this.notifyListeners(key,value),keys.push(key));for(const localKey of Object.keys(this.localCache))this.localCache[localKey]&amp;&amp;!keysInResult.has(localKey)&amp;&amp;(this.notifyListeners(localKey,null),keys.push(localKey));return keys}notifyListeners(key,newValue){this.localCache[key]=newValue;const listeners=this.listeners[key];if(listeners)for(const listener of Array.from(listeners))listener(newValue)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=&gt;this._poll(),800)}stopPolling(){this.pollTimer&amp;&amp;(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(key,listener){0===Object.keys(this.listeners).length&amp;&amp;this.startPolling(),this.listeners[key]||(this.listeners[key]=new Set,this._get(key)),this.listeners[key].add(listener)}_removeListener(key,listener){this.listeners[key]&amp;&amp;(this.listeners[key].delete(listener),0===this.listeners[key].size&amp;&amp;delete this.listeners[key]),0===Object.keys(this.listeners).length&amp;&amp;this.stopPolling()}}IndexedDBLocalPersistence.type="LOCAL";const indexedDBLocalPersistence=IndexedDBLocalPersistence;function _withDefaultResolver(auth,resolverOverride){return resolverOverride?_getInstance(resolverOverride):(_assert(auth._popupRedirectResolver,auth,"argument-error"),auth._popupRedirectResolver)}new Delay(3e4,6e4);class IdpCredential extends AuthCredential{constructor(params){super("custom","custom"),this.params=params}_getIdTokenResponse(auth){return signInWithIdp(auth,this._buildIdpRequest())}_linkToIdToken(auth,idToken){return signInWithIdp(auth,this._buildIdpRequest(idToken))}_getReauthenticationResolver(auth){return signInWithIdp(auth,this._buildIdpRequest())}_buildIdpRequest(idToken){const request={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return idToken&amp;&amp;(request.idToken=idToken),request}}function _signIn(params){return _signInWithCredential(params.auth,new IdpCredential(params),params.bypassAuthState)}function _reauth(params){const{auth:auth,user:user}=params;return _assert(user,auth,"internal-error"),async function _reauthenticate(user,credential,bypassAuthState=!1){const{auth:auth}=user;if(_isFirebaseServerApp(auth.app))return Promise.reject(_serverAppCurrentUserOperationNotSupportedError(auth));try{const response=await _logoutIfInvalidated(user,_processCredentialSavingMfaContextIfNecessary(auth,"reauthenticate",credential,user),bypassAuthState);_assert(response.idToken,auth,"internal-error");const parsed=_parseToken(response.idToken);_assert(parsed,auth,"internal-error");const{sub:localId}=parsed;return _assert(user.uid===localId,auth,"user-mismatch"),UserCredentialImpl._forOperation(user,"reauthenticate",response)}catch(e){throw"auth/user-not-found"===(null==e?void 0:e.code)&amp;&amp;_fail(auth,"user-mismatch"),e}}(user,new IdpCredential(params),params.bypassAuthState)}async function _link(params){const{auth:auth,user:user}=params;return _assert(user,auth,"internal-error"),async function _link$1(user,credential,bypassAuthState=!1){const response=await _logoutIfInvalidated(user,credential._linkToIdToken(user.auth,await user.getIdToken()),bypassAuthState);return UserCredentialImpl._forOperation(user,"link",response)}(user,new IdpCredential(params),params.bypassAuthState)}class AbstractPopupRedirectOperation{constructor(auth,filter,resolver,user,bypassAuthState=!1){this.auth=auth,this.resolver=resolver,this.user=user,this.bypassAuthState=bypassAuthState,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(filter)?filter:[filter]}execute(){return new Promise(async(resolve,reject)=&gt;{this.pendingPromise={resolve:resolve,reject:reject};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(e){this.reject(e)}})}async onAuthEvent(event){const{urlResponse:urlResponse,sessionId:sessionId,postBody:postBody,tenantId:tenantId,error:error,type:type}=event;if(error)return void this.reject(error);const params={auth:this.auth,requestUri:urlResponse,sessionId:sessionId,tenantId:tenantId||void 0,postBody:postBody||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(type)(params))}catch(e){this.reject(e)}}onError(error){this.reject(error)}getIdpTask(type){switch(type){case"signInViaPopup":case"signInViaRedirect":return _signIn;case"linkViaPopup":case"linkViaRedirect":return _link;case"reauthViaPopup":case"reauthViaRedirect":return _reauth;default:_fail(this.auth,"internal-error")}}resolve(cred){debugAssert(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(cred),this.unregisterAndCleanUp()}reject(error){debugAssert(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(error),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&amp;&amp;this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const _POLL_WINDOW_CLOSE_TIMEOUT=new Delay(2e3,1e4);async function signInWithPopup(auth,provider,resolver){if(_isFirebaseServerApp(auth.app))return Promise.reject(_createError(auth,"operation-not-supported-in-this-environment"));const authInternal=_castAuth(auth);_assertInstanceOf(auth,provider,FederatedAuthProvider);const resolverInternal=_withDefaultResolver(authInternal,resolver);return new PopupOperation(authInternal,"signInViaPopup",provider,resolverInternal).executeNotNull()}class PopupOperation extends AbstractPopupRedirectOperation{constructor(auth,filter,provider,resolver,user){super(auth,filter,resolver,user),this.provider=provider,this.authWindow=null,this.pollId=null,PopupOperation.currentPopupAction&amp;&amp;PopupOperation.currentPopupAction.cancel(),PopupOperation.currentPopupAction=this}async executeNotNull(){const result=await this.execute();return _assert(result,this.auth,"internal-error"),result}async onExecution(){debugAssert(1===this.filter.length,"Popup operations only handle one event");const eventId=_generateEventId();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],eventId),this.authWindow.associatedEvent=eventId,this.resolver._originValidation(this.auth).catch(e=&gt;{this.reject(e)}),this.resolver._isIframeWebStorageSupported(this.auth,isSupported2=&gt;{isSupported2||this.reject(_createError(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var _a;return(null===(_a=this.authWindow)||void 0===_a?void 0:_a.associatedEvent)||null}cancel(){this.reject(_createError(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&amp;&amp;this.authWindow.close(),this.pollId&amp;&amp;window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,PopupOperation.currentPopupAction=null}pollUserCancellation(){const poll=()=&gt;{var _a,_b;(null===(_b=null===(_a=this.authWindow)||void 0===_a?void 0:_a.window)||void 0===_b?void 0:_b.closed)?this.pollId=window.setTimeout(()=&gt;{this.pollId=null,this.reject(_createError(this.auth,"popup-closed-by-user"))},8e3):this.pollId=window.setTimeout(poll,_POLL_WINDOW_CLOSE_TIMEOUT.get())};poll()}}PopupOperation.currentPopupAction=null;const redirectOutcomeMap=new Map;class RedirectAction extends AbstractPopupRedirectOperation{constructor(auth,resolver,bypassAuthState=!1){super(auth,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],resolver,void 0,bypassAuthState),this.eventId=null}async execute(){let readyOutcome=redirectOutcomeMap.get(this.auth._key());if(!readyOutcome){try{const result=await async function _getAndClearPendingRedirectStatus(resolver,auth){const key=pendingRedirectKey(auth),persistence=resolverPersistence(resolver);if(!(await persistence._isAvailable()))return!1;const hasPendingRedirect="true"===await persistence._get(key);return await persistence._remove(key),hasPendingRedirect}(this.resolver,this.auth)?await super.execute():null;readyOutcome=()=&gt;Promise.resolve(result)}catch(e){readyOutcome=()=&gt;Promise.reject(e)}redirectOutcomeMap.set(this.auth._key(),readyOutcome)}return this.bypassAuthState||redirectOutcomeMap.set(this.auth._key(),()=&gt;Promise.resolve(null)),readyOutcome()}async onAuthEvent(event){if("signInViaRedirect"===event.type)return super.onAuthEvent(event);if("unknown"!==event.type){if(event.eventId){const user=await this.auth._redirectUserForId(event.eventId);if(user)return this.user=user,super.onAuthEvent(event);this.resolve(null)}}else this.resolve(null)}async onExecution(){}cleanUp(){}}function _overrideRedirectResult(auth,result){redirectOutcomeMap.set(auth._key(),result)}function resolverPersistence(resolver){return _getInstance(resolver._redirectPersistence)}function pendingRedirectKey(auth){return _persistenceKeyName("pendingRedirect",auth.config.apiKey,auth.name)}function signInWithRedirect(auth,provider,resolver){return async function _signInWithRedirect(auth,provider,resolver){if(_isFirebaseServerApp(auth.app))return Promise.reject(_serverAppCurrentUserOperationNotSupportedError(auth));const authInternal=_castAuth(auth);_assertInstanceOf(auth,provider,FederatedAuthProvider),await authInternal._initializationPromise;const resolverInternal=_withDefaultResolver(authInternal,resolver);return await async function _setPendingRedirectStatus(resolver,auth){return resolverPersistence(resolver)._set(pendingRedirectKey(auth),"true")}(resolverInternal,authInternal),resolverInternal._openRedirect(authInternal,provider,"signInViaRedirect")}(auth,provider,resolver)}async function getRedirectResult(auth,resolver){return await _castAuth(auth)._initializationPromise,_getRedirectResult(auth,resolver,!1)}async function _getRedirectResult(auth,resolverExtern,bypassAuthState=!1){if(_isFirebaseServerApp(auth.app))return Promise.reject(_serverAppCurrentUserOperationNotSupportedError(auth));const authInternal=_castAuth(auth),resolver=_withDefaultResolver(authInternal,resolverExtern),action=new RedirectAction(authInternal,resolver,bypassAuthState),result=await action.execute();return result&amp;&amp;!bypassAuthState&amp;&amp;(delete result.user._redirectEventId,await authInternal._persistUserIfCurrent(result.user),await authInternal._setRedirectUser(null,resolverExtern)),result}class AuthEventManager{constructor(auth){this.auth=auth,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(authEventConsumer){this.consumers.add(authEventConsumer),this.queuedRedirectEvent&amp;&amp;this.isEventForConsumer(this.queuedRedirectEvent,authEventConsumer)&amp;&amp;(this.sendToConsumer(this.queuedRedirectEvent,authEventConsumer),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(authEventConsumer){this.consumers.delete(authEventConsumer)}onEvent(event){if(this.hasEventBeenHandled(event))return!1;let handled=!1;return this.consumers.forEach(consumer=&gt;{this.isEventForConsumer(event,consumer)&amp;&amp;(handled=!0,this.sendToConsumer(event,consumer),this.saveEventToCache(event))}),this.hasHandledPotentialRedirect||!function isRedirectEvent(event){switch(event.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return isNullRedirectEvent(event);default:return!1}}(event)||(this.hasHandledPotentialRedirect=!0,handled||(this.queuedRedirectEvent=event,handled=!0)),handled}sendToConsumer(event,consumer){var _a;if(event.error&amp;&amp;!isNullRedirectEvent(event)){const code=(null===(_a=event.error.code)||void 0===_a?void 0:_a.split("auth/")[1])||"internal-error";consumer.onError(_createError(this.auth,code))}else consumer.onAuthEvent(event)}isEventForConsumer(event,consumer){const eventIdMatches=null===consumer.eventId||!!event.eventId&amp;&amp;event.eventId===consumer.eventId;return consumer.filter.includes(event.type)&amp;&amp;eventIdMatches}hasEventBeenHandled(event){return Date.now()-this.lastProcessedEventTime&gt;=6e5&amp;&amp;this.cachedEventUids.clear(),this.cachedEventUids.has(eventUid(event))}saveEventToCache(event){this.cachedEventUids.add(eventUid(event)),this.lastProcessedEventTime=Date.now()}}function eventUid(e){return[e.type,e.eventId,e.sessionId,e.tenantId].filter(v=&gt;v).join("-")}function isNullRedirectEvent({type:type,error:error}){return"unknown"===type&amp;&amp;"auth/no-auth-event"===(null==error?void 0:error.code)}const IP_ADDRESS_REGEX=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,HTTP_REGEX=/^https?/;async function _validateOrigin(auth){if(auth.config.emulator)return;const{authorizedDomains:authorizedDomains}=await async function _getProjectConfig(auth,request={}){return _performApiRequest(auth,"GET","/v1/projects",request)}(auth);for(const domain of authorizedDomains)try{if(matchDomain(domain))return}catch(_a){}_fail(auth,"unauthorized-domain")}function matchDomain(expected){const currentUrl=_getCurrentUrl(),{protocol:protocol,hostname:hostname}=new URL(currentUrl);if(expected.startsWith("chrome-extension://")){const ceUrl=new URL(expected);return""===ceUrl.hostname&amp;&amp;""===hostname?"chrome-extension:"===protocol&amp;&amp;expected.replace("chrome-extension://","")===currentUrl.replace("chrome-extension://",""):"chrome-extension:"===protocol&amp;&amp;ceUrl.hostname===hostname}if(!HTTP_REGEX.test(protocol))return!1;if(IP_ADDRESS_REGEX.test(expected))return hostname===expected;const escapedDomainPattern=expected.replace(/\./g,"\\.");return new RegExp("^(.+\\."+escapedDomainPattern+"|"+escapedDomainPattern+")$","i").test(hostname)}const NETWORK_TIMEOUT=new Delay(3e4,6e4);function resetUnloadedGapiModules(){const beacon=_window().___jsl;if(null==beacon?void 0:beacon.H)for(const hint of Object.keys(beacon.H))if(beacon.H[hint].r=beacon.H[hint].r||[],beacon.H[hint].L=beacon.H[hint].L||[],beacon.H[hint].r=[...beacon.H[hint].L],beacon.CP)for(let i=0;i&lt;beacon.CP.length;i++)beacon.CP[i]=null}function loadGapi(auth){return new Promise((resolve,reject)=&gt;{var _a,_b,_c;function loadGapiIframe(){resetUnloadedGapiModules(),gapi.load("gapi.iframes",{callback:()=&gt;{resolve(gapi.iframes.getContext())},ontimeout:()=&gt;{resetUnloadedGapiModules(),reject(_createError(auth,"network-request-failed"))},timeout:NETWORK_TIMEOUT.get()})}if(null===(_b=null===(_a=_window().gapi)||void 0===_a?void 0:_a.iframes)||void 0===_b?void 0:_b.Iframe)resolve(gapi.iframes.getContext());else{if(!(null===(_c=_window().gapi)||void 0===_c?void 0:_c.load)){const cbName=function _generateCallbackName(prefix){return`__${prefix}${Math.floor(1e6*Math.random())}`}("iframefcb");return _window()[cbName]=()=&gt;{gapi.load?loadGapiIframe():reject(_createError(auth,"network-request-failed"))},_loadJS(`${function _gapiScriptUrl(){return externalJSProvider.gapiScript}()}?onload=${cbName}`).catch(e=&gt;reject(e))}loadGapiIframe()}}).catch(error=&gt;{throw cachedGApiLoader=null,error})}let cachedGApiLoader=null;const PING_TIMEOUT=new Delay(5e3,15e3),IFRAME_ATTRIBUTES={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},EID_FROM_APIHOST=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function getIframeUrl(auth){const config=auth.config;_assert(config.authDomain,auth,"auth-domain-config-required");const url=config.emulator?_emulatorUrl(config,"emulator/auth/iframe"):`https://${auth.config.authDomain}/__/auth/iframe`,params={apiKey:config.apiKey,appName:auth.name,v:"11.10.0"},eid=EID_FROM_APIHOST.get(auth.config.apiHost);eid&amp;&amp;(params.eid=eid);const frameworks=auth._getFrameworks();return frameworks.length&amp;&amp;(params.fw=frameworks.join(",")),`${url}?${querystring(params).slice(1)}`}async function _openIframe(auth){const context=await function _loadGapi(auth){return cachedGApiLoader=cachedGApiLoader||loadGapi(auth),cachedGApiLoader}(auth),gapi2=_window().gapi;return _assert(gapi2,auth,"internal-error"),context.open({where:document.body,url:getIframeUrl(auth),messageHandlersFilter:gapi2.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:IFRAME_ATTRIBUTES,dontclear:!0},iframe=&gt;new Promise(async(resolve,reject)=&gt;{await iframe.restyle({setHideOnLeave:!1});const networkError=_createError(auth,"network-request-failed"),networkErrorTimer=_window().setTimeout(()=&gt;{reject(networkError)},PING_TIMEOUT.get());function clearTimerAndResolve(){_window().clearTimeout(networkErrorTimer),resolve(iframe)}iframe.ping(clearTimerAndResolve).then(clearTimerAndResolve,()=&gt;{reject(networkError)})}))}const BASE_POPUP_OPTIONS={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"};class AuthPopup{constructor(window2){this.window=window2,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch(e){}}}function _open(auth,url,name2,width=500,height=600){const top=Math.max((window.screen.availHeight-height)/2,0).toString(),left=Math.max((window.screen.availWidth-width)/2,0).toString();let target="";const options=Object.assign(Object.assign({},BASE_POPUP_OPTIONS),{width:width.toString(),height:height.toString(),top:top,left:left}),ua=getUA().toLowerCase();name2&amp;&amp;(target=_isChromeIOS(ua)?"_blank":name2),_isFirefox(ua)&amp;&amp;(url=url||"http://localhost",options.scrollbars="yes");const optionsString=Object.entries(options).reduce((accum,[key,value])=&gt;`${accum}${key}=${value},`,"");if(function _isIOSStandalone(ua=getUA()){var _a;return _isIOS(ua)&amp;&amp;!!(null===(_a=window.navigator)||void 0===_a?void 0:_a.standalone)}(ua)&amp;&amp;"_self"!==target)return function openAsNewWindowIOS(url,target){const el=document.createElement("a");el.href=url,el.target=target;const click=document.createEvent("MouseEvent");click.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),el.dispatchEvent(click)}(url||"",target),new AuthPopup(null);const newWin=window.open(url||"",target,optionsString);_assert(newWin,auth,"popup-blocked");try{newWin.focus()}catch(e){}return new AuthPopup(newWin)}const FIREBASE_APP_CHECK_FRAGMENT_ID=encodeURIComponent("fac");async function _getRedirectUrl(auth,provider,authType,redirectUrl,eventId,additionalParams){_assert(auth.config.authDomain,auth,"auth-domain-config-required"),_assert(auth.config.apiKey,auth,"invalid-api-key");const params={apiKey:auth.config.apiKey,appName:auth.name,authType:authType,redirectUrl:redirectUrl,v:"11.10.0",eventId:eventId};if(provider instanceof FederatedAuthProvider){provider.setDefaultLanguage(auth.languageCode),params.providerId=provider.providerId||"",function isEmpty$1(obj){for(const key in obj)if(Object.prototype.hasOwnProperty.call(obj,key))return!1;return!0}(provider.getCustomParameters())||(params.customParameters=JSON.stringify(provider.getCustomParameters()));for(const[key,value]of Object.entries({}))params[key]=value}if(provider instanceof BaseOAuthProvider){const scopes=provider.getScopes().filter(scope=&gt;""!==scope);scopes.length&gt;0&amp;&amp;(params.scopes=scopes.join(","))}auth.tenantId&amp;&amp;(params.tid=auth.tenantId);const paramsDict=params;for(const key of Object.keys(paramsDict))void 0===paramsDict[key]&amp;&amp;delete paramsDict[key];const appCheckToken=await auth._getAppCheckToken(),appCheckTokenFragment=appCheckToken?`#${FIREBASE_APP_CHECK_FRAGMENT_ID}=${encodeURIComponent(appCheckToken)}`:"";return`${function getHandlerBase({config:config}){if(!config.emulator)return`https://${config.authDomain}/__/auth/handler`;return _emulatorUrl(config,"emulator/auth/handler")}(auth)}?${querystring(paramsDict).slice(1)}${appCheckTokenFragment}`}const browserPopupRedirectResolver=class BrowserPopupRedirectResolver{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=browserSessionPersistence,this._completeRedirectFn=_getRedirectResult,this._overrideRedirectResult=_overrideRedirectResult}async _openPopup(auth,provider,authType,eventId){var _a;debugAssert(null===(_a=this.eventManagers[auth._key()])||void 0===_a?void 0:_a.manager,"_initialize() not called before _openPopup()");return _open(auth,await _getRedirectUrl(auth,provider,authType,_getCurrentUrl(),eventId),_generateEventId())}async _openRedirect(auth,provider,authType,eventId){await this._originValidation(auth);return function _setWindowLocation(url){_window().location.href=url}(await _getRedirectUrl(auth,provider,authType,_getCurrentUrl(),eventId)),new Promise(()=&gt;{})}_initialize(auth){const key=auth._key();if(this.eventManagers[key]){const{manager:manager,promise:promise2}=this.eventManagers[key];return manager?Promise.resolve(manager):(debugAssert(promise2,"If manager is not set, promise should be"),promise2)}const promise=this.initAndGetManager(auth);return this.eventManagers[key]={promise:promise},promise.catch(()=&gt;{delete this.eventManagers[key]}),promise}async initAndGetManager(auth){const iframe=await _openIframe(auth),manager=new AuthEventManager(auth);return iframe.register("authEvent",iframeEvent=&gt;{_assert(null==iframeEvent?void 0:iframeEvent.authEvent,auth,"invalid-auth-event");return{status:manager.onEvent(iframeEvent.authEvent)?"ACK":"ERROR"}},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[auth._key()]={manager:manager},this.iframes[auth._key()]=iframe,manager}_isIframeWebStorageSupported(auth,cb){this.iframes[auth._key()].send("webStorageSupport",{type:"webStorageSupport"},result=&gt;{var _a;const isSupported2=null===(_a=null==result?void 0:result[0])||void 0===_a?void 0:_a.webStorageSupport;void 0!==isSupported2&amp;&amp;cb(!!isSupported2),_fail(auth,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(auth){const key=auth._key();return this.originValidationPromises[key]||(this.originValidationPromises[key]=_validateOrigin(auth)),this.originValidationPromises[key]}get _shouldInitProactively(){return _isMobileBrowser()||_isSafari()||_isIOS()}};class AuthInterop{constructor(auth){this.auth=auth,this.internalListeners=new Map}getUid(){var _a;return this.assertAuthConfigured(),(null===(_a=this.auth.currentUser)||void 0===_a?void 0:_a.uid)||null}async getToken(forceRefresh){if(this.assertAuthConfigured(),await this.auth._initializationPromise,!this.auth.currentUser)return null;return{accessToken:await this.auth.currentUser.getIdToken(forceRefresh)}}addAuthTokenListener(listener){if(this.assertAuthConfigured(),this.internalListeners.has(listener))return;const unsubscribe=this.auth.onIdTokenChanged(user=&gt;{listener((null==user?void 0:user.stsTokenManager.accessToken)||null)});this.internalListeners.set(listener,unsubscribe),this.updateProactiveRefresh()}removeAuthTokenListener(listener){this.assertAuthConfigured();const unsubscribe=this.internalListeners.get(listener);unsubscribe&amp;&amp;(this.internalListeners.delete(listener),unsubscribe(),this.updateProactiveRefresh())}assertAuthConfigured(){_assert(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size&gt;0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}const authIdTokenMaxAge=getExperimentalSetting("authIdTokenMaxAge")||300;let lastPostedIdToken=null;function getAuth(app=getApp()){const provider=_getProvider(app,"auth");if(provider.isInitialized())return provider.getImmediate();const auth=function initializeAuth(app,deps){const provider=_getProvider(app,"auth");if(provider.isInitialized()){const auth2=provider.getImmediate();if(deepEqual(provider.getOptions(),null!=deps?deps:{}))return auth2;_fail(auth2,"already-initialized")}return provider.initialize({options:deps})}(app,{popupRedirectResolver:browserPopupRedirectResolver,persistence:[indexedDBLocalPersistence,browserLocalPersistence,browserSessionPersistence]}),authTokenSyncPath=getExperimentalSetting("authTokenSyncURL");if(authTokenSyncPath&amp;&amp;"boolean"==typeof isSecureContext&amp;&amp;isSecureContext){const authTokenSyncUrl=new URL(authTokenSyncPath,location.origin);if(location.origin===authTokenSyncUrl.origin){const mintCookie=(url=authTokenSyncUrl.toString(),async user=&gt;{const idTokenResult=user&amp;&amp;await user.getIdTokenResult(),idTokenAge=idTokenResult&amp;&amp;((new Date).getTime()-Date.parse(idTokenResult.issuedAtTime))/1e3;if(idTokenAge&amp;&amp;idTokenAge&gt;authIdTokenMaxAge)return;const idToken=null==idTokenResult?void 0:idTokenResult.token;lastPostedIdToken!==idToken&amp;&amp;(lastPostedIdToken=idToken,await fetch(url,{method:idToken?"POST":"DELETE",headers:idToken?{Authorization:`Bearer ${idToken}`}:{}}))});!function beforeAuthStateChanged(auth,callback,onAbort){return getModularInstance(auth).beforeAuthStateChanged(callback,onAbort)}(auth,mintCookie,()=&gt;mintCookie(auth.currentUser)),function onIdTokenChanged(auth,nextOrObserver,error,completed){return getModularInstance(auth).onIdTokenChanged(nextOrObserver,error,completed)}(auth,user=&gt;mintCookie(user))}}var url;const authEmulatorHost=getDefaultEmulatorHost("auth");return authEmulatorHost&amp;&amp;connectAuthEmulator(auth,`http://${authEmulatorHost}`),auth}!function _setExternalJSProvider(p){externalJSProvider=p}({loadJS:url=&gt;new Promise((resolve,reject)=&gt;{const el=document.createElement("script");el.setAttribute("src",url),el.onload=resolve,el.onerror=e=&gt;{const error=_createError("internal-error");error.customData=e,reject(error)},el.type="text/javascript",el.charset="UTF-8",function getScriptParentElement(){var _a,_b;return null!==(_b=null===(_a=document.getElementsByTagName("head"))||void 0===_a?void 0:_a[0])&amp;&amp;void 0!==_b?_b:document}().appendChild(el)}),gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="}),function registerAuth(clientPlatform){_registerComponent(new Component("auth",(container,{options:deps})=&gt;{const app=container.getProvider("app").getImmediate(),heartbeatServiceProvider=container.getProvider("heartbeat"),appCheckServiceProvider=container.getProvider("app-check-internal"),{apiKey:apiKey,authDomain:authDomain}=app.options;_assert(apiKey&amp;&amp;!apiKey.includes(":"),"invalid-api-key",{appName:app.name});const config={apiKey:apiKey,authDomain:authDomain,clientPlatform:clientPlatform,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:_getClientVersion(clientPlatform)},authInstance=new AuthImpl(app,heartbeatServiceProvider,appCheckServiceProvider,config);return function _initializeAuthInstance(auth,deps){const persistence=(null==deps?void 0:deps.persistence)||[],hierarchy=(Array.isArray(persistence)?persistence:[persistence]).map(_getInstance);(null==deps?void 0:deps.errorMap)&amp;&amp;auth._updateErrorMap(deps.errorMap),auth._initializeWithPersistence(hierarchy,null==deps?void 0:deps.popupRedirectResolver)}(authInstance,deps),authInstance},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((container,_instanceIdentifier,_instance)=&gt;{container.getProvider("auth-internal").initialize()})),_registerComponent(new Component("auth-internal",container=&gt;{const auth=_castAuth(container.getProvider("auth").getImmediate());return new AuthInterop(auth)},"PRIVATE").setInstantiationMode("EXPLICIT")),registerVersion("@firebase/auth","1.10.8",function getVersionForPlatform(clientPlatform){switch(clientPlatform){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}(clientPlatform)),registerVersion("@firebase/auth","1.10.8","esm2017")}("Browser");class StorageError extends FirebaseError{constructor(code,message,status_=0){super(prependCode(code),`Firebase Storage: ${message} (${prependCode(code)})`),this.status_=status_,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,StorageError.prototype)}get status(){return this.status_}set status(status){this.status_=status}_codeEquals(code){return prependCode(code)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(serverResponse){this.customData.serverResponse=serverResponse,this.customData.serverResponse?this.message=`${this._baseMessage}\n${this.customData.serverResponse}`:this.message=this._baseMessage}}var StorageErrorCode,StorageErrorCode2,ErrorCode,ErrorCode2;function prependCode(code){return"storage/"+code}function invalidArgument(message){return new StorageError(StorageErrorCode.INVALID_ARGUMENT,message)}function appDeleted(){return new StorageError(StorageErrorCode.APP_DELETED,"The Firebase app was deleted.")}(StorageErrorCode2=StorageErrorCode||(StorageErrorCode={})).UNKNOWN="unknown",StorageErrorCode2.OBJECT_NOT_FOUND="object-not-found",StorageErrorCode2.BUCKET_NOT_FOUND="bucket-not-found",StorageErrorCode2.PROJECT_NOT_FOUND="project-not-found",StorageErrorCode2.QUOTA_EXCEEDED="quota-exceeded",StorageErrorCode2.UNAUTHENTICATED="unauthenticated",StorageErrorCode2.UNAUTHORIZED="unauthorized",StorageErrorCode2.UNAUTHORIZED_APP="unauthorized-app",StorageErrorCode2.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",StorageErrorCode2.INVALID_CHECKSUM="invalid-checksum",StorageErrorCode2.CANCELED="canceled",StorageErrorCode2.INVALID_EVENT_NAME="invalid-event-name",StorageErrorCode2.INVALID_URL="invalid-url",StorageErrorCode2.INVALID_DEFAULT_BUCKET="invalid-default-bucket",StorageErrorCode2.NO_DEFAULT_BUCKET="no-default-bucket",StorageErrorCode2.CANNOT_SLICE_BLOB="cannot-slice-blob",StorageErrorCode2.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",StorageErrorCode2.NO_DOWNLOAD_URL="no-download-url",StorageErrorCode2.INVALID_ARGUMENT="invalid-argument",StorageErrorCode2.INVALID_ARGUMENT_COUNT="invalid-argument-count",StorageErrorCode2.APP_DELETED="app-deleted",StorageErrorCode2.INVALID_ROOT_OPERATION="invalid-root-operation",StorageErrorCode2.INVALID_FORMAT="invalid-format",StorageErrorCode2.INTERNAL_ERROR="internal-error",StorageErrorCode2.UNSUPPORTED_ENVIRONMENT="unsupported-environment";class Location{constructor(bucket,path){this.bucket=bucket,this.path_=path}get path(){return this.path_}get isRoot(){return 0===this.path.length}fullServerUrl(){const encode2=encodeURIComponent;return"/b/"+encode2(this.bucket)+"/o/"+encode2(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(bucketString,host){let bucketLocation;try{bucketLocation=Location.makeFromUrl(bucketString,host)}catch(e){return new Location(bucketString,"")}if(""===bucketLocation.path)return bucketLocation;throw function invalidDefaultBucket(bucket){return new StorageError(StorageErrorCode.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+bucket+"'.")}(bucketString)}static makeFromUrl(url,host){let location2=null;const gsRegex=new RegExp("^gs://([A-Za-z0-9.\\-_]+)(/(.*))?$","i");function httpModify(loc){loc.path_=decodeURIComponent(loc.path)}const firebaseStorageHost=host.replace(/[.]/g,"\\."),groups=[{regex:gsRegex,indices:{bucket:1,path:3},postModify:function gsModify(loc){"/"===loc.path.charAt(loc.path.length-1)&amp;&amp;(loc.path_=loc.path_.slice(0,-1))}},{regex:new RegExp(`^https?://${firebaseStorageHost}/v[A-Za-z0-9_]+/b/([A-Za-z0-9.\\-_]+)/o(/([^?#]*).*)?$`,"i"),indices:{bucket:1,path:3},postModify:httpModify},{regex:new RegExp(`^https?://${"firebasestorage.googleapis.com"===host?"(?:storage.googleapis.com|storage.cloud.google.com)":host}/([A-Za-z0-9.\\-_]+)/([^?#]*)`,"i"),indices:{bucket:1,path:2},postModify:httpModify}];for(let i=0;i&lt;groups.length;i++){const group=groups[i],captures=group.regex.exec(url);if(captures){const bucketValue=captures[group.indices.bucket];let pathValue=captures[group.indices.path];pathValue||(pathValue=""),location2=new Location(bucketValue,pathValue),group.postModify(location2);break}}if(null==location2)throw function invalidUrl(url){return new StorageError(StorageErrorCode.INVALID_URL,"Invalid URL '"+url+"'.")}(url);return location2}}class FailRequest{constructor(error){this.promise_=Promise.reject(error)}getPromise(){return this.promise_}cancel(_appDelete=!1){}}function validateNumber(argument,minValue,maxValue,value){if(value&lt;minValue)throw invalidArgument(`Invalid value for '${argument}'. Expected ${minValue} or greater.`);if(value&gt;maxValue)throw invalidArgument(`Invalid value for '${argument}'. Expected ${maxValue} or less.`)}(ErrorCode2=ErrorCode||(ErrorCode={}))[ErrorCode2.NO_ERROR=0]="NO_ERROR",ErrorCode2[ErrorCode2.NETWORK_ERROR=1]="NETWORK_ERROR",ErrorCode2[ErrorCode2.ABORT=2]="ABORT";class NetworkRequest{constructor(url_,method_,headers_,body_,successCodes_,additionalRetryCodes_,callback_,errorCallback_,timeout_,progressCallback_,connectionFactory_,retry=!0,isUsingEmulator=!1){this.url_=url_,this.method_=method_,this.headers_=headers_,this.body_=body_,this.successCodes_=successCodes_,this.additionalRetryCodes_=additionalRetryCodes_,this.callback_=callback_,this.errorCallback_=errorCallback_,this.timeout_=timeout_,this.progressCallback_=progressCallback_,this.connectionFactory_=connectionFactory_,this.retry=retry,this.isUsingEmulator=isUsingEmulator,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((resolve,reject)=&gt;{this.resolve_=resolve,this.reject_=reject,this.start_()})}start_(){const doTheRequest=(backoffCallback,canceled2)=&gt;{if(canceled2)return void backoffCallback(!1,new RequestEndStatus(!1,null,!0));const connection=this.connectionFactory_();this.pendingConnection_=connection;const progressListener=progressEvent=&gt;{const loaded=progressEvent.loaded,total=progressEvent.lengthComputable?progressEvent.total:-1;null!==this.progressCallback_&amp;&amp;this.progressCallback_(loaded,total)};null!==this.progressCallback_&amp;&amp;connection.addUploadProgressListener(progressListener),connection.send(this.url_,this.method_,this.isUsingEmulator,this.body_,this.headers_).then(()=&gt;{null!==this.progressCallback_&amp;&amp;connection.removeUploadProgressListener(progressListener),this.pendingConnection_=null;const hitServer=connection.getErrorCode()===ErrorCode.NO_ERROR,status=connection.getStatus();if(!hitServer||function isRetryStatusCode(status,additionalRetryCodes){const isFiveHundredCode=status&gt;=500&amp;&amp;status&lt;600,isExtraRetryCode=-1!==[408,429].indexOf(status),isAdditionalRetryCode=-1!==additionalRetryCodes.indexOf(status);return isFiveHundredCode||isExtraRetryCode||isAdditionalRetryCode}(status,this.additionalRetryCodes_)&amp;&amp;this.retry){const wasCanceled=connection.getErrorCode()===ErrorCode.ABORT;return void backoffCallback(!1,new RequestEndStatus(!1,null,wasCanceled))}const successCode=-1!==this.successCodes_.indexOf(status);backoffCallback(!0,new RequestEndStatus(successCode,connection))})},backoffDone=(requestWentThrough,status)=&gt;{const resolve=this.resolve_,reject=this.reject_,connection=status.connection;if(status.wasSuccessCode)try{const result=this.callback_(connection,connection.getResponse());!function isJustDef(p){return void 0!==p}(result)?resolve():resolve(result)}catch(e){reject(e)}else if(null!==connection){const err=function unknown(){return new StorageError(StorageErrorCode.UNKNOWN,"An unknown error occurred, please check the error payload for server response.")}();err.serverResponse=connection.getErrorText(),this.errorCallback_?reject(this.errorCallback_(connection,err)):reject(err)}else if(status.canceled){reject(this.appDelete_?appDeleted():function canceled(){return new StorageError(StorageErrorCode.CANCELED,"User canceled the upload/download.")}())}else{reject(function retryLimitExceeded(){return new StorageError(StorageErrorCode.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again.")}())}};this.canceled_?backoffDone(0,new RequestEndStatus(!1,null,!0)):this.backoffId_=function start(doRequest,backoffCompleteCb,timeout){let waitSeconds=1,retryTimeoutId=null,globalTimeoutId=null,hitTimeout=!1,cancelState=0;function canceled2(){return 2===cancelState}let triggeredCallback=!1;function triggerCallback(...args){triggeredCallback||(triggeredCallback=!0,backoffCompleteCb.apply(null,args))}function callWithDelay(millis){retryTimeoutId=setTimeout(()=&gt;{retryTimeoutId=null,doRequest(responseHandler,canceled2())},millis)}function clearGlobalTimeout(){globalTimeoutId&amp;&amp;clearTimeout(globalTimeoutId)}function responseHandler(success,...args){if(triggeredCallback)return void clearGlobalTimeout();if(success)return clearGlobalTimeout(),void triggerCallback.call(null,success,...args);if(canceled2()||hitTimeout)return clearGlobalTimeout(),void triggerCallback.call(null,success,...args);let waitMillis;waitSeconds&lt;64&amp;&amp;(waitSeconds*=2),1===cancelState?(cancelState=2,waitMillis=0):waitMillis=1e3*(waitSeconds+Math.random()),callWithDelay(waitMillis)}let stopped=!1;function stop2(wasTimeout){stopped||(stopped=!0,clearGlobalTimeout(),triggeredCallback||(null!==retryTimeoutId?(wasTimeout||(cancelState=2),clearTimeout(retryTimeoutId),callWithDelay(0)):wasTimeout||(cancelState=1)))}return callWithDelay(0),globalTimeoutId=setTimeout(()=&gt;{hitTimeout=!0,stop2(!0)},timeout),stop2}(doTheRequest,backoffDone,this.timeout_)}getPromise(){return this.promise_}cancel(appDelete){this.canceled_=!0,this.appDelete_=appDelete||!1,null!==this.backoffId_&amp;&amp;function stop(id){id(!1)}(this.backoffId_),null!==this.pendingConnection_&amp;&amp;this.pendingConnection_.abort()}}class RequestEndStatus{constructor(wasSuccessCode,connection,canceled2){this.wasSuccessCode=wasSuccessCode,this.connection=connection,this.canceled=!!canceled2}}function makeRequest(requestInfo,appId,authToken,appCheckToken,requestFactory,firebaseVersion,retry=!0,isUsingEmulator=!1){const queryPart=function makeQueryString(params){const encode2=encodeURIComponent;let queryPart="?";for(const key in params)params.hasOwnProperty(key)&amp;&amp;(queryPart=queryPart+(encode2(key)+"=")+encode2(params[key])+"&amp;");return queryPart=queryPart.slice(0,-1),queryPart}(requestInfo.urlParams),url=requestInfo.url+queryPart,headers=Object.assign({},requestInfo.headers);return function addGmpidHeader_(headers,appId){appId&amp;&amp;(headers["X-Firebase-GMPID"]=appId)}(headers,appId),function addAuthHeader_(headers,authToken){null!==authToken&amp;&amp;authToken.length&gt;0&amp;&amp;(headers.Authorization="Firebase "+authToken)}(headers,authToken),function addVersionHeader_(headers,firebaseVersion){headers["X-Firebase-Storage-Version"]="webjs/"+(null!=firebaseVersion?firebaseVersion:"AppManager")}(headers,firebaseVersion),function addAppCheckHeader_(headers,appCheckToken){null!==appCheckToken&amp;&amp;(headers["X-Firebase-AppCheck"]=appCheckToken)}(headers,appCheckToken),new NetworkRequest(url,requestInfo.method,headers,requestInfo.body,requestInfo.successCodes,requestInfo.additionalRetryCodes,requestInfo.handler,requestInfo.errorHandler,requestInfo.timeout,requestInfo.progressCallback,requestFactory,retry,isUsingEmulator)}class Reference{constructor(_service,location2){this._service=_service,this._location=location2 instanceof Location?location2:Location.makeFromUrl(location2,_service.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(service,location2){return new Reference(service,location2)}get root(){const location2=new Location(this._location.bucket,"");return this._newRef(this._service,location2)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return function lastComponent(path){const index=path.lastIndexOf("/",path.length-2);return-1===index?path:path.slice(index+1)}(this._location.path)}get storage(){return this._service}get parent(){const newPath=function parent(path){if(0===path.length)return null;const index=path.lastIndexOf("/");return-1===index?"":path.slice(0,index)}(this._location.path);if(null===newPath)return null;const location2=new Location(this._location.bucket,newPath);return new Reference(this._service,location2)}_throwIfRoot(name2){if(""===this._location.path)throw function invalidRootOperation(name2){return new StorageError(StorageErrorCode.INVALID_ROOT_OPERATION,"The operation '"+name2+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}(name2)}}function extractBucket(host,config){const bucketString=null==config?void 0:config.storageBucket;return null==bucketString?null:Location.makeFromBucketSpec(bucketString,host)}class FirebaseStorageImpl{constructor(app,_authProvider,_appCheckProvider,_url,_firebaseVersion,_isUsingEmulator=!1){this.app=app,this._authProvider=_authProvider,this._appCheckProvider=_appCheckProvider,this._url=_url,this._firebaseVersion=_firebaseVersion,this._isUsingEmulator=_isUsingEmulator,this._bucket=null,this._host="firebasestorage.googleapis.com",this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=12e4,this._maxUploadRetryTime=6e5,this._requests=new Set,this._bucket=null!=_url?Location.makeFromBucketSpec(_url,this._host):extractBucket(this._host,this.app.options)}get host(){return this._host}set host(host){this._host=host,null!=this._url?this._bucket=Location.makeFromBucketSpec(this._url,host):this._bucket=extractBucket(host,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(time){validateNumber("time",0,Number.POSITIVE_INFINITY,time),this._maxUploadRetryTime=time}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(time){validateNumber("time",0,Number.POSITIVE_INFINITY,time),this._maxOperationRetryTime=time}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;const auth=this._authProvider.getImmediate({optional:!0});if(auth){const tokenData=await auth.getToken();if(null!==tokenData)return tokenData.accessToken}return null}async _getAppCheckToken(){if(_isFirebaseServerApp(this.app)&amp;&amp;this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const appCheck=this._appCheckProvider.getImmediate({optional:!0});if(appCheck){return(await appCheck.getToken()).token}return null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(request=&gt;request.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(loc){return new Reference(this,loc)}_makeRequest(requestInfo,requestFactory,authToken,appCheckToken,retry=!0){if(this._deleted)return new FailRequest(appDeleted());{const request=makeRequest(requestInfo,this._appId,authToken,appCheckToken,requestFactory,this._firebaseVersion,retry,this._isUsingEmulator);return this._requests.add(request),request.getPromise().then(()=&gt;this._requests.delete(request),()=&gt;this._requests.delete(request)),request}}async makeRequestWithTokens(requestInfo,requestFactory){const[authToken,appCheckToken]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(requestInfo,requestFactory,authToken,appCheckToken).getPromise()}}function getStorage(app=getApp(),bucketUrl){const storageInstance=_getProvider(app=getModularInstance(app),"storage").getImmediate({identifier:bucketUrl}),emulator=getDefaultEmulatorHostnameAndPort("storage");return emulator&amp;&amp;function connectStorageEmulator(storage,host,port,options={}){!function connectStorageEmulator$1(storage,host,port,options={}){storage.host=`${host}:${port}`;const useSsl=isCloudWorkstation(host);useSsl&amp;&amp;(pingServer(`https://${storage.host}/b`),updateEmulatorBanner("Storage",!0)),storage._isUsingEmulator=!0,storage._protocol=useSsl?"https":"http";const{mockUserToken:mockUserToken}=options;mockUserToken&amp;&amp;(storage._overrideAuthToken="string"==typeof mockUserToken?mockUserToken:createMockUserToken(mockUserToken,storage.app.options.projectId))}(storage,host,port,options)}(storageInstance,...emulator),storageInstance}function factory$2(container,{instanceIdentifier:url}){const app=container.getProvider("app").getImmediate(),authProvider=container.getProvider("auth-internal"),appCheckProvider=container.getProvider("app-check-internal");return new FirebaseStorageImpl(app,authProvider,appCheckProvider,url,"11.10.0")}!function registerStorage(){_registerComponent(new Component("storage",factory$2,"PUBLIC").setMultipleInstances(!0)),registerVersion("@firebase/storage","0.13.14",""),registerVersion("@firebase/storage","0.13.14","esm2017")}();function mapValues(o,f){const result={};for(const key in o)o.hasOwnProperty(key)&amp;&amp;(result[key]=f(o[key]));return result}function encode$1(data){if(null==data)return null;if(data instanceof Number&amp;&amp;(data=data.valueOf()),"number"==typeof data&amp;&amp;isFinite(data))return data;if(!0===data||!1===data)return data;if("[object String]"===Object.prototype.toString.call(data))return data;if(data instanceof Date)return data.toISOString();if(Array.isArray(data))return data.map(x2=&gt;encode$1(x2));if("function"==typeof data||"object"==typeof data)return mapValues(data,x2=&gt;encode$1(x2));throw new Error("Data cannot be encoded in JSON: "+data)}function decode(json){if(null==json)return json;if(json["@type"])switch(json["@type"]){case"type.googleapis.com/google.protobuf.Int64Value":case"type.googleapis.com/google.protobuf.UInt64Value":{const value=Number(json.value);if(isNaN(value))throw new Error("Data cannot be decoded from JSON: "+json);return value}default:throw new Error("Data cannot be decoded from JSON: "+json)}return Array.isArray(json)?json.map(x2=&gt;decode(x2)):"function"==typeof json||"object"==typeof json?mapValues(json,x2=&gt;decode(x2)):json}const errorCodeMap={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class FunctionsError extends FirebaseError{constructor(code,message,details){super(`functions/${code}`,message||""),this.details=details,Object.setPrototypeOf(this,FunctionsError.prototype)}}function _errorForResponse(status,bodyJSON){let details,code=function codeForHTTPStatus(status){if(status&gt;=200&amp;&amp;status&lt;300)return"ok";switch(status){case 0:case 500:return"internal";case 400:return"invalid-argument";case 401:return"unauthenticated";case 403:return"permission-denied";case 404:return"not-found";case 409:return"aborted";case 429:return"resource-exhausted";case 499:return"cancelled";case 501:return"unimplemented";case 503:return"unavailable";case 504:return"deadline-exceeded"}return"unknown"}(status),description=code;try{const errorJSON=bodyJSON&amp;&amp;bodyJSON.error;if(errorJSON){const status2=errorJSON.status;if("string"==typeof status2){if(!errorCodeMap[status2])return new FunctionsError("internal","internal");code=errorCodeMap[status2],description=status2}const message=errorJSON.message;"string"==typeof message&amp;&amp;(description=message),details=errorJSON.details,void 0!==details&amp;&amp;(details=decode(details))}}catch(e){}return"ok"===code?null:new FunctionsError(code,description,details)}class ContextProvider{constructor(app,authProvider,messagingProvider,appCheckProvider){this.app=app,this.auth=null,this.messaging=null,this.appCheck=null,this.serverAppAppCheckToken=null,_isFirebaseServerApp(app)&amp;&amp;app.settings.appCheckToken&amp;&amp;(this.serverAppAppCheckToken=app.settings.appCheckToken),this.auth=authProvider.getImmediate({optional:!0}),this.messaging=messagingProvider.getImmediate({optional:!0}),this.auth||authProvider.get().then(auth=&gt;this.auth=auth,()=&gt;{}),this.messaging||messagingProvider.get().then(messaging=&gt;this.messaging=messaging,()=&gt;{}),this.appCheck||null==appCheckProvider||appCheckProvider.get().then(appCheck=&gt;this.appCheck=appCheck,()=&gt;{})}async getAuthToken(){if(this.auth)try{const token=await this.auth.getToken();return null==token?void 0:token.accessToken}catch(e){return}}async getMessagingToken(){if(this.messaging&amp;&amp;"Notification"in self&amp;&amp;"granted"===Notification.permission)try{return await this.messaging.getToken()}catch(e){return}}async getAppCheckToken(limitedUseAppCheckTokens){if(this.serverAppAppCheckToken)return this.serverAppAppCheckToken;if(this.appCheck){const result=limitedUseAppCheckTokens?await this.appCheck.getLimitedUseToken():await this.appCheck.getToken();return result.error?null:result.token}return null}async getContext(limitedUseAppCheckTokens){return{authToken:await this.getAuthToken(),messagingToken:await this.getMessagingToken(),appCheckToken:await this.getAppCheckToken(limitedUseAppCheckTokens)}}}const responseLineRE=/^data: (.*?)(?:\n|$)/;class FunctionsService{constructor(app,authProvider,messagingProvider,appCheckProvider,regionOrCustomDomain="us-central1",fetchImpl=(...args)=&gt;fetch(...args)){this.app=app,this.fetchImpl=fetchImpl,this.emulatorOrigin=null,this.contextProvider=new ContextProvider(app,authProvider,messagingProvider,appCheckProvider),this.cancelAllRequests=new Promise(resolve=&gt;{this.deleteService=()=&gt;Promise.resolve(resolve())});try{const url=new URL(regionOrCustomDomain);this.customDomain=url.origin+("/"===url.pathname?"":url.pathname),this.region="us-central1"}catch(e){this.customDomain=null,this.region=regionOrCustomDomain}}_delete(){return this.deleteService()}_url(name2){const projectId=this.app.options.projectId;if(null!==this.emulatorOrigin){return`${this.emulatorOrigin}/${projectId}/${this.region}/${name2}`}return null!==this.customDomain?`${this.customDomain}/${name2}`:`https://${this.region}-${projectId}.cloudfunctions.net/${name2}`}}function httpsCallable$1(functionsInstance,name2,options){const callable=data=&gt;function call(functionsInstance,name2,data,options){const url=functionsInstance._url(name2);return async function callAtURL(functionsInstance,url,data,options){data=encode$1(data);const body={data:data},headers=await makeAuthHeaders(functionsInstance,options),timeout=options.timeout||7e4,failAfterHandle=function failAfter(millis){let timer=null;return{promise:new Promise((_,reject)=&gt;{timer=setTimeout(()=&gt;{reject(new FunctionsError("deadline-exceeded","deadline-exceeded"))},millis)}),cancel:()=&gt;{timer&amp;&amp;clearTimeout(timer)}}}(timeout),response=await Promise.race([postJSON(url,body,headers,functionsInstance.fetchImpl),failAfterHandle.promise,functionsInstance.cancelAllRequests]);if(failAfterHandle.cancel(),!response)throw new FunctionsError("cancelled","Firebase Functions instance was deleted.");const error=_errorForResponse(response.status,response.json);if(error)throw error;if(!response.json)throw new FunctionsError("internal","Response is not valid JSON object.");let responseData=response.json.data;void 0===responseData&amp;&amp;(responseData=response.json.result);if(void 0===responseData)throw new FunctionsError("internal","Response is missing data field.");return{data:decode(responseData)}}(functionsInstance,url,data,options)}(functionsInstance,name2,data,{});return callable.stream=(data,options2)=&gt;function stream(functionsInstance,name2,data,options){const url=functionsInstance._url(name2);return async function streamAtURL(functionsInstance,url,data,options){var _a;data=encode$1(data);const body={data:data},headers=await makeAuthHeaders(functionsInstance,options);let response,resultResolver,resultRejecter;headers["Content-Type"]="application/json",headers.Accept="text/event-stream";try{response=await functionsInstance.fetchImpl(url,{method:"POST",body:JSON.stringify(body),headers:headers,signal:null==options?void 0:options.signal})}catch(e){if(e instanceof Error&amp;&amp;"AbortError"===e.name){const error2=new FunctionsError("cancelled","Request was cancelled.");return{data:Promise.reject(error2),stream:{[Symbol.asyncIterator]:()=&gt;({next:()=&gt;Promise.reject(error2)})}}}const error=_errorForResponse(0,null);return{data:Promise.reject(error),stream:{[Symbol.asyncIterator]:()=&gt;({next:()=&gt;Promise.reject(error)})}}}const resultPromise=new Promise((resolve,reject)=&gt;{resultResolver=resolve,resultRejecter=reject});null===(_a=null==options?void 0:options.signal)||void 0===_a||_a.addEventListener("abort",()=&gt;{const error=new FunctionsError("cancelled","Request was cancelled.");resultRejecter(error)});const rstream=function createResponseStream(reader,resultResolver,resultRejecter,signal){const processLine=(line,controller)=&gt;{const match=line.match(responseLineRE);if(!match)return;const data=match[1];try{const jsonData=JSON.parse(data);if("result"in jsonData)return void resultResolver(decode(jsonData.result));if("message"in jsonData)return void controller.enqueue(decode(jsonData.message));if("error"in jsonData){const error=_errorForResponse(0,jsonData);return controller.error(error),void resultRejecter(error)}}catch(error){if(error instanceof FunctionsError)return controller.error(error),void resultRejecter(error)}},decoder=new TextDecoder;return new ReadableStream({start(controller){let currentText="";return pump();async function pump(){if(null==signal?void 0:signal.aborted){const error=new FunctionsError("cancelled","Request was cancelled");return controller.error(error),resultRejecter(error),Promise.resolve()}try{const{value:value,done:done}=await reader.read();if(done)return currentText.trim()&amp;&amp;processLine(currentText.trim(),controller),void controller.close();if(null==signal?void 0:signal.aborted){const error=new FunctionsError("cancelled","Request was cancelled");return controller.error(error),resultRejecter(error),void(await reader.cancel())}currentText+=decoder.decode(value,{stream:!0});const lines=currentText.split("\n");currentText=lines.pop()||"";for(const line of lines)line.trim()&amp;&amp;processLine(line.trim(),controller);return pump()}catch(error){const functionsError=error instanceof FunctionsError?error:_errorForResponse(0,null);controller.error(functionsError),resultRejecter(functionsError)}}},cancel:()=&gt;reader.cancel()})}(response.body.getReader(),resultResolver,resultRejecter,null==options?void 0:options.signal);return{stream:{[Symbol.asyncIterator](){const rreader=rstream.getReader();return{async next(){const{value:value,done:done}=await rreader.read();return{value:value,done:done}},return:async()=&gt;(await rreader.cancel(),{done:!0,value:void 0})}}},data:resultPromise}}(functionsInstance,url,data,options||{})}(functionsInstance,name2,data,options2),callable}async function postJSON(url,body,headers,fetchImpl){let response;headers["Content-Type"]="application/json";try{response=await fetchImpl(url,{method:"POST",body:JSON.stringify(body),headers:headers})}catch(e){return{status:0,json:null}}let json=null;try{json=await response.json()}catch(e){}return{status:response.status,json:json}}async function makeAuthHeaders(functionsInstance,options){const headers={},context=await functionsInstance.contextProvider.getContext(options.limitedUseAppCheckTokens);return context.authToken&amp;&amp;(headers.Authorization="Bearer "+context.authToken),context.messagingToken&amp;&amp;(headers["Firebase-Instance-ID-Token"]=context.messagingToken),null!==context.appCheckToken&amp;&amp;(headers["X-Firebase-AppCheck"]=context.appCheckToken),headers}const name$4="@firebase/functions";function getFunctions(app=getApp(),regionOrCustomDomain="us-central1"){const functionsInstance=_getProvider(getModularInstance(app),"functions").getImmediate({identifier:regionOrCustomDomain}),emulator=getDefaultEmulatorHostnameAndPort("functions");return emulator&amp;&amp;function connectFunctionsEmulator(functionsInstance,host,port){!function connectFunctionsEmulator$1(functionsInstance,host,port){const useSsl=isCloudWorkstation(host);functionsInstance.emulatorOrigin=`http${useSsl?"s":""}://${host}:${port}`,useSsl&amp;&amp;(pingServer(functionsInstance.emulatorOrigin),updateEmulatorBanner("Functions",!0))}(getModularInstance(functionsInstance),host,port)}(functionsInstance,...emulator),functionsInstance}function httpsCallable(functionsInstance,name2,options){return httpsCallable$1(getModularInstance(functionsInstance),name2)}!function registerFunctions(variant){_registerComponent(new Component("functions",(container,{instanceIdentifier:regionOrCustomDomain})=&gt;{const app=container.getProvider("app").getImmediate(),authProvider=container.getProvider("auth-internal"),messagingProvider=container.getProvider("messaging-internal"),appCheckProvider=container.getProvider("app-check-internal");return new FunctionsService(app,authProvider,messagingProvider,appCheckProvider,regionOrCustomDomain)},"PUBLIC").setMultipleInstances(!0)),registerVersion(name$4,"0.12.9",variant),registerVersion(name$4,"0.12.9","esm2017")}();const name$3="@firebase/installations",ERROR_FACTORY$3=new ErrorFactory("installations","Installations",{"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"not-registered":"Firebase Installation is not registered.","installation-not-found":"Firebase Installation not found.","request-failed":'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',"app-offline":"Could not process request. Application offline.","delete-pending-registration":"Can't delete installation while there is a pending registration request."});function isServerError(error){return error instanceof FirebaseError&amp;&amp;error.code.includes("request-failed")}function getInstallationsEndpoint({projectId:projectId}){return`https://firebaseinstallations.googleapis.com/v1/projects/${projectId}/installations`}function extractAuthTokenInfoFromResponse(response){return{token:response.token,requestStatus:2,expiresIn:(responseExpiresIn=response.expiresIn,Number(responseExpiresIn.replace("s","000"))),creationTime:Date.now()};var responseExpiresIn}async function getErrorFromResponse(requestName,response){const errorData=(await response.json()).error;return ERROR_FACTORY$3.create("request-failed",{requestName:requestName,serverCode:errorData.code,serverMessage:errorData.message,serverStatus:errorData.status})}function getHeaders$2({apiKey:apiKey}){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":apiKey})}function getHeadersWithAuth(appConfig,{refreshToken:refreshToken}){const headers=getHeaders$2(appConfig);return headers.append("Authorization",function getAuthorizationHeader(refreshToken){return`FIS_v2 ${refreshToken}`}(refreshToken)),headers}async function retryIfServerError(fn){const result=await fn();return result.status&gt;=500&amp;&amp;result.status&lt;600?fn():result}function sleep$1(ms){return new Promise(resolve=&gt;{setTimeout(resolve,ms)})}const VALID_FID_PATTERN=/^[cdef][\w-]{21}$/;function generateFid(){try{const fidByteArray=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(fidByteArray),fidByteArray[0]=112+fidByteArray[0]%16;const fid=function encode(fidByteArray){const b64String=function bufferToBase64UrlSafe(array){return btoa(String.fromCharCode(...array)).replace(/\+/g,"-").replace(/\//g,"_")}(fidByteArray);return b64String.substr(0,22)}(fidByteArray);return VALID_FID_PATTERN.test(fid)?fid:""}catch(_a){return""}}function getKey$1(appConfig){return`${appConfig.appName}!${appConfig.appId}`}const fidChangeCallbacks=new Map;function fidChanged(appConfig,fid){const key=getKey$1(appConfig);callFidChangeCallbacks(key,fid),function broadcastFidChange(key,fid){const channel=function getBroadcastChannel(){!broadcastChannel&amp;&amp;"BroadcastChannel"in self&amp;&amp;(broadcastChannel=new BroadcastChannel("[Firebase] FID Change"),broadcastChannel.onmessage=e=&gt;{callFidChangeCallbacks(e.data.key,e.data.fid)});return broadcastChannel}();channel&amp;&amp;channel.postMessage({key:key,fid:fid});!function closeBroadcastChannel(){0===fidChangeCallbacks.size&amp;&amp;broadcastChannel&amp;&amp;(broadcastChannel.close(),broadcastChannel=null)}()}(key,fid)}function callFidChangeCallbacks(key,fid){const callbacks=fidChangeCallbacks.get(key);if(callbacks)for(const callback of callbacks)callback(fid)}let broadcastChannel=null;const OBJECT_STORE_NAME$1="firebase-installations-store";let dbPromise$2=null;function getDbPromise$1(){return dbPromise$2||(dbPromise$2=openDB("firebase-installations-database",1,{upgrade:(db,oldVersion)=&gt;{if(0===oldVersion)db.createObjectStore(OBJECT_STORE_NAME$1)}})),dbPromise$2}async function set(appConfig,value){const key=getKey$1(appConfig),tx=(await getDbPromise$1()).transaction(OBJECT_STORE_NAME$1,"readwrite"),objectStore=tx.objectStore(OBJECT_STORE_NAME$1),oldValue=await objectStore.get(key);return await objectStore.put(value,key),await tx.done,oldValue&amp;&amp;oldValue.fid===value.fid||fidChanged(appConfig,value.fid),value}async function remove(appConfig){const key=getKey$1(appConfig),tx=(await getDbPromise$1()).transaction(OBJECT_STORE_NAME$1,"readwrite");await tx.objectStore(OBJECT_STORE_NAME$1).delete(key),await tx.done}async function update(appConfig,updateFn){const key=getKey$1(appConfig),tx=(await getDbPromise$1()).transaction(OBJECT_STORE_NAME$1,"readwrite"),store=tx.objectStore(OBJECT_STORE_NAME$1),oldValue=await store.get(key),newValue=updateFn(oldValue);return void 0===newValue?await store.delete(key):await store.put(newValue,key),await tx.done,!newValue||oldValue&amp;&amp;oldValue.fid===newValue.fid||fidChanged(appConfig,newValue.fid),newValue}async function getInstallationEntry(installations){let registrationPromise;const installationEntry=await update(installations.appConfig,oldEntry=&gt;{const installationEntry2=function updateOrCreateInstallationEntry(oldEntry){const entry=oldEntry||{fid:generateFid(),registrationStatus:0};return clearTimedOutRequest(entry)}(oldEntry),entryWithPromise=function triggerRegistrationIfNecessary(installations,installationEntry){if(0===installationEntry.registrationStatus){if(!navigator.onLine){return{installationEntry:installationEntry,registrationPromise:Promise.reject(ERROR_FACTORY$3.create("app-offline"))}}const inProgressEntry={fid:installationEntry.fid,registrationStatus:1,registrationTime:Date.now()},registrationPromise=async function registerInstallation(installations,installationEntry){try{const registeredInstallationEntry=await async function createInstallationRequest({appConfig:appConfig,heartbeatServiceProvider:heartbeatServiceProvider},{fid:fid}){const endpoint=getInstallationsEndpoint(appConfig),headers=getHeaders$2(appConfig),heartbeatService=heartbeatServiceProvider.getImmediate({optional:!0});if(heartbeatService){const heartbeatsHeader=await heartbeatService.getHeartbeatsHeader();heartbeatsHeader&amp;&amp;headers.append("x-firebase-client",heartbeatsHeader)}const body={fid:fid,authVersion:"FIS_v2",appId:appConfig.appId,sdkVersion:"w:0.6.18"},request={method:"POST",headers:headers,body:JSON.stringify(body)},response=await retryIfServerError(()=&gt;fetch(endpoint,request));if(response.ok){const responseValue=await response.json();return{fid:responseValue.fid||fid,registrationStatus:2,refreshToken:responseValue.refreshToken,authToken:extractAuthTokenInfoFromResponse(responseValue.authToken)}}throw await getErrorFromResponse("Create Installation",response)}(installations,installationEntry);return set(installations.appConfig,registeredInstallationEntry)}catch(e){throw isServerError(e)&amp;&amp;409===e.customData.serverCode?await remove(installations.appConfig):await set(installations.appConfig,{fid:installationEntry.fid,registrationStatus:0}),e}}(installations,inProgressEntry);return{installationEntry:inProgressEntry,registrationPromise:registrationPromise}}return 1===installationEntry.registrationStatus?{installationEntry:installationEntry,registrationPromise:waitUntilFidRegistration(installations)}:{installationEntry:installationEntry}}(installations,installationEntry2);return registrationPromise=entryWithPromise.registrationPromise,entryWithPromise.installationEntry});return""===installationEntry.fid?{installationEntry:await registrationPromise}:{installationEntry:installationEntry,registrationPromise:registrationPromise}}async function waitUntilFidRegistration(installations){let entry=await updateInstallationRequest(installations.appConfig);for(;1===entry.registrationStatus;)await sleep$1(100),entry=await updateInstallationRequest(installations.appConfig);if(0===entry.registrationStatus){const{installationEntry:installationEntry,registrationPromise:registrationPromise}=await getInstallationEntry(installations);return registrationPromise||installationEntry}return entry}function updateInstallationRequest(appConfig){return update(appConfig,oldEntry=&gt;{if(!oldEntry)throw ERROR_FACTORY$3.create("installation-not-found");return clearTimedOutRequest(oldEntry)})}function clearTimedOutRequest(entry){return function hasInstallationRequestTimedOut(installationEntry){return 1===installationEntry.registrationStatus&amp;&amp;installationEntry.registrationTime+1e4&lt;Date.now()}(entry)?{fid:entry.fid,registrationStatus:0}:entry}async function generateAuthTokenRequest({appConfig:appConfig,heartbeatServiceProvider:heartbeatServiceProvider},installationEntry){const endpoint=function getGenerateAuthTokenEndpoint(appConfig,{fid:fid}){return`${getInstallationsEndpoint(appConfig)}/${fid}/authTokens:generate`}(appConfig,installationEntry),headers=getHeadersWithAuth(appConfig,installationEntry),heartbeatService=heartbeatServiceProvider.getImmediate({optional:!0});if(heartbeatService){const heartbeatsHeader=await heartbeatService.getHeartbeatsHeader();heartbeatsHeader&amp;&amp;headers.append("x-firebase-client",heartbeatsHeader)}const body={installation:{sdkVersion:"w:0.6.18",appId:appConfig.appId}},request={method:"POST",headers:headers,body:JSON.stringify(body)},response=await retryIfServerError(()=&gt;fetch(endpoint,request));if(response.ok){return extractAuthTokenInfoFromResponse(await response.json())}throw await getErrorFromResponse("Generate Auth Token",response)}async function refreshAuthToken(installations,forceRefresh=!1){let tokenPromise;const entry=await update(installations.appConfig,oldEntry=&gt;{if(!isEntryRegistered(oldEntry))throw ERROR_FACTORY$3.create("not-registered");const oldAuthToken=oldEntry.authToken;if(!forceRefresh&amp;&amp;function isAuthTokenValid(authToken){return 2===authToken.requestStatus&amp;&amp;!function isAuthTokenExpired(authToken){const now=Date.now();return now&lt;authToken.creationTime||authToken.creationTime+authToken.expiresIn&lt;now+36e5}(authToken)}(oldAuthToken))return oldEntry;if(1===oldAuthToken.requestStatus)return tokenPromise=async function waitUntilAuthTokenRequest(installations,forceRefresh){let entry=await updateAuthTokenRequest(installations.appConfig);for(;1===entry.authToken.requestStatus;)await sleep$1(100),entry=await updateAuthTokenRequest(installations.appConfig);const authToken=entry.authToken;return 0===authToken.requestStatus?refreshAuthToken(installations,forceRefresh):authToken}(installations,forceRefresh),oldEntry;{if(!navigator.onLine)throw ERROR_FACTORY$3.create("app-offline");const inProgressEntry=function makeAuthTokenRequestInProgressEntry(oldEntry){const inProgressAuthToken={requestStatus:1,requestTime:Date.now()};return Object.assign(Object.assign({},oldEntry),{authToken:inProgressAuthToken})}(oldEntry);return tokenPromise=async function fetchAuthTokenFromServer(installations,installationEntry){try{const authToken=await generateAuthTokenRequest(installations,installationEntry),updatedInstallationEntry=Object.assign(Object.assign({},installationEntry),{authToken:authToken});return await set(installations.appConfig,updatedInstallationEntry),authToken}catch(e){if(!isServerError(e)||401!==e.customData.serverCode&amp;&amp;404!==e.customData.serverCode){const updatedInstallationEntry=Object.assign(Object.assign({},installationEntry),{authToken:{requestStatus:0}});await set(installations.appConfig,updatedInstallationEntry)}else await remove(installations.appConfig);throw e}}(installations,inProgressEntry),inProgressEntry}});return tokenPromise?await tokenPromise:entry.authToken}function updateAuthTokenRequest(appConfig){return update(appConfig,oldEntry=&gt;{if(!isEntryRegistered(oldEntry))throw ERROR_FACTORY$3.create("not-registered");return function hasAuthTokenRequestTimedOut(authToken){return 1===authToken.requestStatus&amp;&amp;authToken.requestTime+1e4&lt;Date.now()}(oldEntry.authToken)?Object.assign(Object.assign({},oldEntry),{authToken:{requestStatus:0}}):oldEntry})}function isEntryRegistered(installationEntry){return void 0!==installationEntry&amp;&amp;2===installationEntry.registrationStatus}async function getToken(installations,forceRefresh=!1){const installationsImpl=installations;await async function completeInstallationRegistration(installations){const{registrationPromise:registrationPromise}=await getInstallationEntry(installations);registrationPromise&amp;&amp;await registrationPromise}(installationsImpl);return(await refreshAuthToken(installationsImpl,forceRefresh)).token}function getMissingValueError$1(valueName){return ERROR_FACTORY$3.create("missing-app-config-values",{valueName:valueName})}const publicFactory=container=&gt;{const app=container.getProvider("app").getImmediate(),appConfig=function extractAppConfig$1(app){if(!app||!app.options)throw getMissingValueError$1("App Configuration");if(!app.name)throw getMissingValueError$1("App Name");const configKeys=["projectId","apiKey","appId"];for(const keyName of configKeys)if(!app.options[keyName])throw getMissingValueError$1(keyName);return{appName:app.name,projectId:app.options.projectId,apiKey:app.options.apiKey,appId:app.options.appId}}(app);return{app:app,appConfig:appConfig,heartbeatServiceProvider:_getProvider(app,"heartbeat"),_delete:()=&gt;Promise.resolve()}},internalFactory$1=container=&gt;{const installations=_getProvider(container.getProvider("app").getImmediate(),"installations").getImmediate();return{getId:()=&gt;async function getId(installations){const installationsImpl=installations,{installationEntry:installationEntry,registrationPromise:registrationPromise}=await getInstallationEntry(installationsImpl);return registrationPromise?registrationPromise.catch(console.error):refreshAuthToken(installationsImpl).catch(console.error),installationEntry.fid}(installations),getToken:forceRefresh=&gt;getToken(installations,forceRefresh)}};!function registerInstallations(){_registerComponent(new Component("installations",publicFactory,"PUBLIC")),_registerComponent(new Component("installations-internal",internalFactory$1,"PRIVATE"))}(),registerVersion(name$3,"0.6.18"),registerVersion(name$3,"0.6.18","esm2017");const GTAG_URL="https://www.googletagmanager.com/gtag/js",logger$1=new Logger("@firebase/analytics"),ERROR_FACTORY$2=new ErrorFactory("analytics","Analytics",{"already-exists":"A Firebase Analytics instance with the appId {$id}  already exists. Only one Firebase Analytics instance can be created for each appId.","already-initialized":"initializeAnalytics() cannot be called again with different options than those it was initially called with. It can be called again with the same options to return the existing instance, or getAnalytics() can be used to get a reference to the already-initialized instance.","already-initialized-settings":"Firebase Analytics has already been initialized.settings() must be called before initializing any Analytics instanceor it will have no effect.","interop-component-reg-failed":"Firebase Analytics Interop Component failed to instantiate: {$reason}","invalid-analytics-context":"Firebase Analytics is not supported in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","indexeddb-unavailable":"IndexedDB unavailable or restricted in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","fetch-throttle":"The config fetch request timed out while in an exponential backoff state. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.","config-fetch-failed":"Dynamic config fetch failed: [{$httpStatus}] {$responseMessage}","no-api-key":'The "apiKey" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid API key.',"no-app-id":'The "appId" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid app ID.',"no-client-id":'The "client_id" field is empty.',"invalid-gtag-resource":"Trusted Types detected an invalid gtag resource: {$gtagURL}."});function createGtagTrustedTypesScriptURL(url){if(!url.startsWith(GTAG_URL)){const err=ERROR_FACTORY$2.create("invalid-gtag-resource",{gtagURL:url});return logger$1.warn(err.message),""}return url}function promiseAllSettled(promises){return Promise.all(promises.map(promise=&gt;promise.catch(e=&gt;e)))}function insertScriptTag(dataLayerName2,measurementId){const trustedTypesPolicy=function createTrustedTypesPolicy(policyName,policyOptions){let trustedTypesPolicy;return window.trustedTypes&amp;&amp;(trustedTypesPolicy=window.trustedTypes.createPolicy(policyName,policyOptions)),trustedTypesPolicy}("firebase-js-sdk-policy",{createScriptURL:createGtagTrustedTypesScriptURL}),script=document.createElement("script"),gtagScriptURL=`${GTAG_URL}?l=${dataLayerName2}&amp;id=${measurementId}`;script.src=trustedTypesPolicy?null==trustedTypesPolicy?void 0:trustedTypesPolicy.createScriptURL(gtagScriptURL):gtagScriptURL,script.async=!0,document.head.appendChild(script)}function wrapGtag(gtagCore,initializationPromisesMap2,dynamicConfigPromisesList2,measurementIdToAppId2){return async function gtagWrapper(command,...args){try{if("event"===command){const[measurementId,gtagParams]=args;await async function gtagOnEvent(gtagCore,initializationPromisesMap2,dynamicConfigPromisesList2,measurementId,gtagParams){try{let initializationPromisesToWaitFor=[];if(gtagParams&amp;&amp;gtagParams.send_to){let gaSendToList=gtagParams.send_to;Array.isArray(gaSendToList)||(gaSendToList=[gaSendToList]);const dynamicConfigResults=await promiseAllSettled(dynamicConfigPromisesList2);for(const sendToId of gaSendToList){const foundConfig=dynamicConfigResults.find(config=&gt;config.measurementId===sendToId),initializationPromise=foundConfig&amp;&amp;initializationPromisesMap2[foundConfig.appId];if(!initializationPromise){initializationPromisesToWaitFor=[];break}initializationPromisesToWaitFor.push(initializationPromise)}}0===initializationPromisesToWaitFor.length&amp;&amp;(initializationPromisesToWaitFor=Object.values(initializationPromisesMap2)),await Promise.all(initializationPromisesToWaitFor),gtagCore("event",measurementId,gtagParams||{})}catch(e){logger$1.error(e)}}(gtagCore,initializationPromisesMap2,dynamicConfigPromisesList2,measurementId,gtagParams)}else if("config"===command){const[measurementId,gtagParams]=args;await async function gtagOnConfig(gtagCore,initializationPromisesMap2,dynamicConfigPromisesList2,measurementIdToAppId2,measurementId,gtagParams){const correspondingAppId=measurementIdToAppId2[measurementId];try{if(correspondingAppId)await initializationPromisesMap2[correspondingAppId];else{const foundConfig=(await promiseAllSettled(dynamicConfigPromisesList2)).find(config=&gt;config.measurementId===measurementId);foundConfig&amp;&amp;await initializationPromisesMap2[foundConfig.appId]}}catch(e){logger$1.error(e)}gtagCore("config",measurementId,gtagParams)}(gtagCore,initializationPromisesMap2,dynamicConfigPromisesList2,measurementIdToAppId2,measurementId,gtagParams)}else if("consent"===command){const[consentAction,gtagParams]=args;gtagCore("consent",consentAction,gtagParams)}else if("get"===command){const[measurementId,fieldName,callback]=args;gtagCore("get",measurementId,fieldName,callback)}else if("set"===command){const[customParams]=args;gtagCore("set",customParams)}else gtagCore(command,...args)}catch(e){logger$1.error(e)}}}const defaultRetryData=new class RetryData{constructor(throttleMetadata={},intervalMillis=1e3){this.throttleMetadata=throttleMetadata,this.intervalMillis=intervalMillis}getThrottleMetadata(appId){return this.throttleMetadata[appId]}setThrottleMetadata(appId,metadata){this.throttleMetadata[appId]=metadata}deleteThrottleMetadata(appId){delete this.throttleMetadata[appId]}};function getHeaders$1(apiKey){return new Headers({Accept:"application/json","x-goog-api-key":apiKey})}async function fetchDynamicConfigWithRetry(app,retryData=defaultRetryData,timeoutMillis){const{appId:appId,apiKey:apiKey,measurementId:measurementId}=app.options;if(!appId)throw ERROR_FACTORY$2.create("no-app-id");if(!apiKey){if(measurementId)return{measurementId:measurementId,appId:appId};throw ERROR_FACTORY$2.create("no-api-key")}const throttleMetadata=retryData.getThrottleMetadata(appId)||{backoffCount:0,throttleEndTimeMillis:Date.now()},signal=new AnalyticsAbortSignal;return setTimeout(async()=&gt;{signal.abort()},6e4),attemptFetchDynamicConfigWithRetry({appId:appId,apiKey:apiKey,measurementId:measurementId},throttleMetadata,signal,retryData)}async function attemptFetchDynamicConfigWithRetry(appFields,{throttleEndTimeMillis:throttleEndTimeMillis,backoffCount:backoffCount},signal,retryData=defaultRetryData){var _a;const{appId:appId,measurementId:measurementId}=appFields;try{await function setAbortableTimeout(signal,throttleEndTimeMillis){return new Promise((resolve,reject)=&gt;{const backoffMillis=Math.max(throttleEndTimeMillis-Date.now(),0),timeout=setTimeout(resolve,backoffMillis);signal.addEventListener(()=&gt;{clearTimeout(timeout),reject(ERROR_FACTORY$2.create("fetch-throttle",{throttleEndTimeMillis:throttleEndTimeMillis}))})})}(signal,throttleEndTimeMillis)}catch(e){if(measurementId)return logger$1.warn(`Timed out fetching this Firebase app's measurement ID from the server. Falling back to the measurement ID ${measurementId} provided in the "measurementId" field in the local Firebase config. [${null==e?void 0:e.message}]`),{appId:appId,measurementId:measurementId};throw e}try{const response=await async function fetchDynamicConfig(appFields){var _a;const{appId:appId,apiKey:apiKey}=appFields,request={method:"GET",headers:getHeaders$1(apiKey)},appUrl="https://firebase.googleapis.com/v1alpha/projects/-/apps/{app-id}/webConfig".replace("{app-id}",appId),response=await fetch(appUrl,request);if(200!==response.status&amp;&amp;304!==response.status){let errorMessage="";try{const jsonResponse=await response.json();(null===(_a=jsonResponse.error)||void 0===_a?void 0:_a.message)&amp;&amp;(errorMessage=jsonResponse.error.message)}catch(_ignored){}throw ERROR_FACTORY$2.create("config-fetch-failed",{httpStatus:response.status,responseMessage:errorMessage})}return response.json()}(appFields);return retryData.deleteThrottleMetadata(appId),response}catch(e){const error=e;if(!function isRetriableError(e){if(!(e instanceof FirebaseError&amp;&amp;e.customData))return!1;const httpStatus=Number(e.customData.httpStatus);return 429===httpStatus||500===httpStatus||503===httpStatus||504===httpStatus}(error)){if(retryData.deleteThrottleMetadata(appId),measurementId)return logger$1.warn(`Failed to fetch this Firebase app's measurement ID from the server. Falling back to the measurement ID ${measurementId} provided in the "measurementId" field in the local Firebase config. [${null==error?void 0:error.message}]`),{appId:appId,measurementId:measurementId};throw e}const backoffMillis=503===Number(null===(_a=null==error?void 0:error.customData)||void 0===_a?void 0:_a.httpStatus)?calculateBackoffMillis(backoffCount,retryData.intervalMillis,30):calculateBackoffMillis(backoffCount,retryData.intervalMillis),throttleMetadata={throttleEndTimeMillis:Date.now()+backoffMillis,backoffCount:backoffCount+1};return retryData.setThrottleMetadata(appId,throttleMetadata),logger$1.debug(`Calling attemptFetch again in ${backoffMillis} millis`),attemptFetchDynamicConfigWithRetry(appFields,throttleMetadata,signal,retryData)}}class AnalyticsAbortSignal{constructor(){this.listeners=[]}addEventListener(listener){this.listeners.push(listener)}abort(){this.listeners.forEach(listener=&gt;listener())}}async function _initializeAnalytics(app,dynamicConfigPromisesList2,measurementIdToAppId2,installations,gtagCore,dataLayerName2,options){var _a;const dynamicConfigPromise=fetchDynamicConfigWithRetry(app);dynamicConfigPromise.then(config=&gt;{measurementIdToAppId2[config.measurementId]=config.appId,app.options.measurementId&amp;&amp;config.measurementId!==app.options.measurementId&amp;&amp;logger$1.warn(`The measurement ID in the local Firebase config (${app.options.measurementId}) does not match the measurement ID fetched from the server (${config.measurementId}). To ensure analytics events are always sent to the correct Analytics property, update the measurement ID field in the local config or remove it from the local config.`)}).catch(e=&gt;logger$1.error(e)),dynamicConfigPromisesList2.push(dynamicConfigPromise);const fidPromise=async function validateIndexedDB(){if(!isIndexedDBAvailable())return logger$1.warn(ERROR_FACTORY$2.create("indexeddb-unavailable",{errorInfo:"IndexedDB is not available in this environment."}).message),!1;try{await validateIndexedDBOpenable()}catch(e){return logger$1.warn(ERROR_FACTORY$2.create("indexeddb-unavailable",{errorInfo:null==e?void 0:e.toString()}).message),!1}return!0}().then(envIsValid=&gt;envIsValid?installations.getId():void 0),[dynamicConfig,fid]=await Promise.all([dynamicConfigPromise,fidPromise]);(function findGtagScriptOnPage(dataLayerName2){const scriptTags=window.document.getElementsByTagName("script");for(const tag of Object.values(scriptTags))if(tag.src&amp;&amp;tag.src.includes(GTAG_URL)&amp;&amp;tag.src.includes(dataLayerName2))return tag;return null})(dataLayerName2)||insertScriptTag(dataLayerName2,dynamicConfig.measurementId),gtagCore("js",new Date);const configProperties=null!==(_a=null==options?void 0:options.config)&amp;&amp;void 0!==_a?_a:{};return configProperties.origin="firebase",configProperties.update=!0,null!=fid&amp;&amp;(configProperties.firebase_id=fid),gtagCore("config",dynamicConfig.measurementId,configProperties),dynamicConfig.measurementId}class AnalyticsService{constructor(app){this.app=app}_delete(){return delete initializationPromisesMap[this.app.options.appId],Promise.resolve()}}let initializationPromisesMap={},dynamicConfigPromisesList=[];const measurementIdToAppId={};let gtagCoreFunction,wrappedGtagFunction,globalInitDone=!1;function factory$1(app,installations,options){!function warnOnBrowserContextMismatch(){const mismatchedEnvMessages=[];if(isBrowserExtension()&amp;&amp;mismatchedEnvMessages.push("This is a browser extension environment."),areCookiesEnabled()||mismatchedEnvMessages.push("Cookies are not available."),mismatchedEnvMessages.length&gt;0){const details=mismatchedEnvMessages.map((message,index)=&gt;`(${index+1}) ${message}`).join(" "),err=ERROR_FACTORY$2.create("invalid-analytics-context",{errorInfo:details});logger$1.warn(err.message)}}();const appId=app.options.appId;if(!appId)throw ERROR_FACTORY$2.create("no-app-id");if(!app.options.apiKey){if(!app.options.measurementId)throw ERROR_FACTORY$2.create("no-api-key");logger$1.warn(`The "apiKey" field is empty in the local Firebase config. This is needed to fetch the latest measurement ID for this Firebase app. Falling back to the measurement ID ${app.options.measurementId} provided in the "measurementId" field in the local Firebase config.`)}if(null!=initializationPromisesMap[appId])throw ERROR_FACTORY$2.create("already-exists",{id:appId});if(!globalInitDone){!function getOrCreateDataLayer(dataLayerName2){let dataLayer=[];return Array.isArray(window[dataLayerName2])?dataLayer=window[dataLayerName2]:window[dataLayerName2]=dataLayer,dataLayer}("dataLayer");const{wrappedGtag:wrappedGtag,gtagCore:gtagCore}=function wrapOrCreateGtag(initializationPromisesMap2,dynamicConfigPromisesList2,measurementIdToAppId2,dataLayerName2,gtagFunctionName){let gtagCore=function(..._args){window[dataLayerName2].push(arguments)};return window[gtagFunctionName]&amp;&amp;"function"==typeof window[gtagFunctionName]&amp;&amp;(gtagCore=window[gtagFunctionName]),window[gtagFunctionName]=wrapGtag(gtagCore,initializationPromisesMap2,dynamicConfigPromisesList2,measurementIdToAppId2),{gtagCore:gtagCore,wrappedGtag:window[gtagFunctionName]}}(initializationPromisesMap,dynamicConfigPromisesList,measurementIdToAppId,"dataLayer","gtag");wrappedGtagFunction=wrappedGtag,gtagCoreFunction=gtagCore,globalInitDone=!0}initializationPromisesMap[appId]=_initializeAnalytics(app,dynamicConfigPromisesList,measurementIdToAppId,installations,gtagCoreFunction,"dataLayer",options);return new AnalyticsService(app)}function getAnalytics(app=getApp()){const analyticsProvider=_getProvider(app=getModularInstance(app),"analytics");return analyticsProvider.isInitialized()?analyticsProvider.getImmediate():function initializeAnalytics(app,options={}){const analyticsProvider=_getProvider(app,"analytics");if(analyticsProvider.isInitialized()){const existingInstance=analyticsProvider.getImmediate();if(deepEqual(options,analyticsProvider.getOptions()))return existingInstance;throw ERROR_FACTORY$2.create("already-initialized")}const analyticsInstance=analyticsProvider.initialize({options:options});return analyticsInstance}(app)}async function isSupported(){if(isBrowserExtension())return!1;if(!areCookiesEnabled())return!1;if(!isIndexedDBAvailable())return!1;try{return await validateIndexedDBOpenable()}catch(error){return!1}}function logEvent(analyticsInstance,eventName,eventParams,options){analyticsInstance=getModularInstance(analyticsInstance),async function logEvent$1(gtagFunction,initializationPromise,eventName,eventParams,options){if(options&amp;&amp;options.global)gtagFunction("event",eventName,eventParams);else{const measurementId=await initializationPromise;gtagFunction("event",eventName,Object.assign(Object.assign({},eventParams),{send_to:measurementId}))}}(wrappedGtagFunction,initializationPromisesMap[analyticsInstance.app.options.appId],eventName,eventParams,options).catch(e=&gt;logger$1.error(e))}const name$2="@firebase/analytics";!function registerAnalytics(){_registerComponent(new Component("analytics",(container,{options:analyticsOptions})=&gt;factory$1(container.getProvider("app").getImmediate(),container.getProvider("installations-internal").getImmediate(),analyticsOptions),"PUBLIC")),_registerComponent(new Component("analytics-internal",function internalFactory2(container){try{const analytics=container.getProvider("analytics").getImmediate();return{logEvent:(eventName,eventParams,options)=&gt;logEvent(analytics,eventName,eventParams,options)}}catch(e){throw ERROR_FACTORY$2.create("interop-component-reg-failed",{reason:e})}},"PRIVATE")),registerVersion(name$2,"0.10.17"),registerVersion(name$2,"0.10.17","esm2017")}();const APP_CHECK_STATES=new Map,DEFAULT_STATE={activated:!1,tokenObservers:[]};function getStateReference(app){return APP_CHECK_STATES.get(app)||Object.assign({},DEFAULT_STATE)}const TOKEN_REFRESH_TIME_RETRIAL_MIN_WAIT=3e4,TOKEN_REFRESH_TIME_RETRIAL_MAX_WAIT=96e4;class Refresher{constructor(operation,retryPolicy,getWaitDuration,lowerBound,upperBound){if(this.operation=operation,this.retryPolicy=retryPolicy,this.getWaitDuration=getWaitDuration,this.lowerBound=lowerBound,this.upperBound=upperBound,this.pending=null,this.nextErrorWaitInterval=lowerBound,lowerBound&gt;upperBound)throw new Error("Proactive refresh lower bound greater than upper bound!")}start(){this.nextErrorWaitInterval=this.lowerBound,this.process(!0).catch(()=&gt;{})}stop(){this.pending&amp;&amp;(this.pending.reject("cancelled"),this.pending=null)}isRunning(){return!!this.pending}async process(hasSucceeded){this.stop();try{this.pending=new Deferred,this.pending.promise.catch(_e2=&gt;{}),await function sleep(ms){return new Promise(resolve=&gt;{setTimeout(resolve,ms)})}(this.getNextRun(hasSucceeded)),this.pending.resolve(),await this.pending.promise,this.pending=new Deferred,this.pending.promise.catch(_e2=&gt;{}),await this.operation(),this.pending.resolve(),await this.pending.promise,this.process(!0).catch(()=&gt;{})}catch(error){this.retryPolicy(error)?this.process(!1).catch(()=&gt;{}):this.stop()}}getNextRun(hasSucceeded){if(hasSucceeded)return this.nextErrorWaitInterval=this.lowerBound,this.getWaitDuration();{const currentErrorWaitInterval=this.nextErrorWaitInterval;return this.nextErrorWaitInterval*=2,this.nextErrorWaitInterval&gt;this.upperBound&amp;&amp;(this.nextErrorWaitInterval=this.upperBound),currentErrorWaitInterval}}}const ERROR_FACTORY$1=new ErrorFactory("appCheck","AppCheck",{"already-initialized":"You have already called initializeAppCheck() for FirebaseApp {$appName} with different options. To avoid this error, call initializeAppCheck() with the same options as when it was originally called. This will return the already initialized instance.","use-before-activation":"App Check is being used before initializeAppCheck() is called for FirebaseApp {$appName}. Call initializeAppCheck() before instantiating other Firebase services.","fetch-network-error":"Fetch failed to connect to a network. Check Internet connection. Original error: {$originalErrorMessage}.","fetch-parse-error":"Fetch client could not parse response. Original error: {$originalErrorMessage}.","fetch-status-error":"Fetch server returned an HTTP error status. HTTP status: {$httpStatus}.","storage-open":"Error thrown when opening storage. Original error: {$originalErrorMessage}.","storage-get":"Error thrown when reading from storage. Original error: {$originalErrorMessage}.","storage-set":"Error thrown when writing to storage. Original error: {$originalErrorMessage}.","recaptcha-error":"ReCAPTCHA error.","initial-throttle":"{$httpStatus} error. Attempts allowed again after {$time}",throttled:"Requests throttled due to previous {$httpStatus} error. Attempts allowed again after {$time}"});function ensureActivated(app){if(!getStateReference(app).activated)throw ERROR_FACTORY$1.create("use-before-activation",{appName:app.name})}const STORE_NAME="firebase-app-check-store";let dbPromise$1=null;function writeTokenToIndexedDB(app,token){return async function write(key,value){const transaction=(await function getDBPromise(){return dbPromise$1||(dbPromise$1=new Promise((resolve,reject)=&gt;{try{const request=indexedDB.open("firebase-app-check-database",1);request.onsuccess=event=&gt;{resolve(event.target.result)},request.onerror=event=&gt;{var _a;reject(ERROR_FACTORY$1.create("storage-open",{originalErrorMessage:null===(_a=event.target.error)||void 0===_a?void 0:_a.message}))},request.onupgradeneeded=event=&gt;{const db=event.target.result;0===event.oldVersion&amp;&amp;db.createObjectStore(STORE_NAME,{keyPath:"compositeKey"})}}catch(e){reject(ERROR_FACTORY$1.create("storage-open",{originalErrorMessage:null==e?void 0:e.message}))}}),dbPromise$1)}()).transaction(STORE_NAME,"readwrite"),request=transaction.objectStore(STORE_NAME).put({compositeKey:key,value:value});return new Promise((resolve,reject)=&gt;{request.onsuccess=_event=&gt;{resolve()},transaction.onerror=event=&gt;{var _a;reject(ERROR_FACTORY$1.create("storage-set",{originalErrorMessage:null===(_a=event.target.error)||void 0===_a?void 0:_a.message}))}})}(function computeKey(app){return`${app.options.appId}-${app.name}`}(app),token)}const logger=new Logger("@firebase/app-check");function writeTokenToStorage(app,token){return isIndexedDBAvailable()?writeTokenToIndexedDB(app,token).catch(e=&gt;{logger.warn(`Failed to write token to IndexedDB. Error: ${e}`)}):Promise.resolve()}const defaultTokenErrorData={error:"UNKNOWN_ERROR"};async function getToken$2(appCheck,forceRefresh=!1,shouldLogErrors=!1){const app=appCheck.app;ensureActivated(app);const state=getStateReference(app);let error,token=state.token;if(token&amp;&amp;!isValid(token)&amp;&amp;(state.token=void 0,token=void 0),!token){const cachedToken=await state.cachedTokenPromise;cachedToken&amp;&amp;(isValid(cachedToken)?token=cachedToken:await writeTokenToStorage(app,void 0))}if(!forceRefresh&amp;&amp;token&amp;&amp;isValid(token))return{token:token.token};let interopTokenResult,shouldCallListeners=!1;try{state.exchangeTokenPromise||(state.exchangeTokenPromise=state.provider.getToken().finally(()=&gt;{state.exchangeTokenPromise=void 0}),shouldCallListeners=!0),token=await getStateReference(app).exchangeTokenPromise}catch(e){"appCheck/throttled"===e.code||"appCheck/initial-throttle"===e.code?logger.warn(e.message):shouldLogErrors&amp;&amp;logger.error(e),error=e}return token?error?interopTokenResult=isValid(token)?{token:token.token,internalError:error}:makeDummyTokenResult(error):(interopTokenResult={token:token.token},state.token=token,await writeTokenToStorage(app,token)):interopTokenResult=makeDummyTokenResult(error),shouldCallListeners&amp;&amp;function notifyTokenListeners(app,token){const observers=getStateReference(app).tokenObservers;for(const observer of observers)try{"EXTERNAL"===observer.type&amp;&amp;null!=token.error?observer.error(token.error):observer.next(token)}catch(e){}}(app,interopTokenResult),interopTokenResult}function removeTokenListener(app,listener){const state=getStateReference(app),newObservers=state.tokenObservers.filter(tokenObserver=&gt;tokenObserver.next!==listener);0===newObservers.length&amp;&amp;state.tokenRefresher&amp;&amp;state.tokenRefresher.isRunning()&amp;&amp;state.tokenRefresher.stop(),state.tokenObservers=newObservers}function initTokenRefresher(appCheck){const{app:app}=appCheck,state=getStateReference(app);let refresher=state.tokenRefresher;refresher||(refresher=function createTokenRefresher(appCheck){const{app:app}=appCheck;return new Refresher(async()=&gt;{let result;if(result=getStateReference(app).token?await getToken$2(appCheck,!0):await getToken$2(appCheck),result.error)throw result.error;if(result.internalError)throw result.internalError},()=&gt;!0,()=&gt;{const state=getStateReference(app);if(state.token){let nextRefreshTimeMillis=state.token.issuedAtTimeMillis+.5*(state.token.expireTimeMillis-state.token.issuedAtTimeMillis)+3e5;const latestAllowableRefresh=state.token.expireTimeMillis-3e5;return nextRefreshTimeMillis=Math.min(nextRefreshTimeMillis,latestAllowableRefresh),Math.max(0,nextRefreshTimeMillis-Date.now())}return 0},TOKEN_REFRESH_TIME_RETRIAL_MIN_WAIT,TOKEN_REFRESH_TIME_RETRIAL_MAX_WAIT)}(appCheck),state.tokenRefresher=refresher),!refresher.isRunning()&amp;&amp;state.isTokenAutoRefreshEnabled&amp;&amp;refresher.start()}function isValid(token){return token.expireTimeMillis-Date.now()&gt;0}function makeDummyTokenResult(error){return{token:(tokenErrorData=defaultTokenErrorData,base64.encodeString(JSON.stringify(tokenErrorData),!1)),error:error};var tokenErrorData}class AppCheckService{constructor(app,heartbeatServiceProvider){this.app=app,this.heartbeatServiceProvider=heartbeatServiceProvider}_delete(){const{tokenObservers:tokenObservers}=getStateReference(this.app);for(const tokenObserver of tokenObservers)removeTokenListener(this.app,tokenObserver.next);return Promise.resolve()}}function internalFactory(appCheck){return{getToken:forceRefresh=&gt;getToken$2(appCheck,forceRefresh),getLimitedUseToken:()=&gt;async function getLimitedUseToken$1(appCheck){const app=appCheck.app;ensureActivated(app);const{provider:provider}=getStateReference(app);{const{token:token}=await provider.getToken();return{token:token}}}(appCheck),addTokenListener:listener=&gt;function addTokenListener(appCheck,type,listener,onError){const{app:app}=appCheck,state=getStateReference(app),tokenObserver={next:listener,error:onError,type:type};if(state.tokenObservers=[...state.tokenObservers,tokenObserver],state.token&amp;&amp;isValid(state.token)){const validToken=state.token;Promise.resolve().then(()=&gt;{listener({token:validToken.token}),initTokenRefresher(appCheck)}).catch(()=&gt;{})}state.cachedTokenPromise.then(()=&gt;initTokenRefresher(appCheck))}(appCheck,"INTERNAL",listener),removeTokenListener:listener=&gt;removeTokenListener(appCheck.app,listener)}}!function registerAppCheck(){_registerComponent(new Component("app-check",container=&gt;function factory(app,heartbeatServiceProvider){return new AppCheckService(app,heartbeatServiceProvider)}(container.getProvider("app").getImmediate(),container.getProvider("heartbeat")),"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((container,_identifier,_appcheckService)=&gt;{container.getProvider("app-check-internal").initialize()})),_registerComponent(new Component("app-check-internal",container=&gt;internalFactory(container.getProvider("app-check").getImmediate()),"PUBLIC").setInstantiationMode("EXPLICIT")),registerVersion("@firebase/app-check","0.10.1")}();const DEFAULT_VAPID_KEY="BDOU99-h67HcA6JeFXHbSNMu7e2yNNu3RzoMj8TM4W88jITfq7ZmPvIM1Iv-4_l2LxQcYwhqby2xGpWwzjfAnG4";var MessageType$1,MessageType2,MessageType;function arrayToBase64(array){const uint8Array=new Uint8Array(array);return btoa(String.fromCharCode(...uint8Array)).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function base64ToArray(base64String){const base642=(base64String+"=".repeat((4-base64String.length%4)%4)).replace(/\-/g,"+").replace(/_/g,"/"),rawData=atob(base642),outputArray=new Uint8Array(rawData.length);for(let i=0;i&lt;rawData.length;++i)outputArray[i]=rawData.charCodeAt(i);return outputArray}(MessageType2=MessageType$1||(MessageType$1={}))[MessageType2.DATA_MESSAGE=1]="DATA_MESSAGE",MessageType2[MessageType2.DISPLAY_NOTIFICATION=3]="DISPLAY_NOTIFICATION",function(MessageType2){MessageType2.PUSH_RECEIVED="push-received",MessageType2.NOTIFICATION_CLICKED="notification-clicked"}(MessageType||(MessageType={}));let dbPromise=null;function getDbPromise(){return dbPromise||(dbPromise=openDB("firebase-messaging-database",1,{upgrade:(upgradeDb,oldVersion)=&gt;{if(0===oldVersion)upgradeDb.createObjectStore("firebase-messaging-store")}})),dbPromise}async function dbGet(firebaseDependencies){const key=getKey(firebaseDependencies),db=await getDbPromise(),tokenDetails=await db.transaction("firebase-messaging-store").objectStore("firebase-messaging-store").get(key);if(tokenDetails)return tokenDetails;{const oldTokenDetails=await async function migrateOldDatabase(senderId){if("databases"in indexedDB&amp;&amp;!(await indexedDB.databases()).map(db2=&gt;db2.name).includes("fcm_token_details_db"))return null;let tokenDetails=null;return(await openDB("fcm_token_details_db",5,{upgrade:async(db2,oldVersion,newVersion,upgradeTransaction)=&gt;{var _a;if(oldVersion&lt;2)return;if(!db2.objectStoreNames.contains("fcm_token_object_Store"))return;const objectStore=upgradeTransaction.objectStore("fcm_token_object_Store"),value=await objectStore.index("fcmSenderId").get(senderId);if(await objectStore.clear(),value)if(2===oldVersion){const oldDetails=value;if(!oldDetails.auth||!oldDetails.p256dh||!oldDetails.endpoint)return;tokenDetails={token:oldDetails.fcmToken,createTime:null!==(_a=oldDetails.createTime)&amp;&amp;void 0!==_a?_a:Date.now(),subscriptionOptions:{auth:oldDetails.auth,p256dh:oldDetails.p256dh,endpoint:oldDetails.endpoint,swScope:oldDetails.swScope,vapidKey:"string"==typeof oldDetails.vapidKey?oldDetails.vapidKey:arrayToBase64(oldDetails.vapidKey)}}}else if(3===oldVersion){const oldDetails=value;tokenDetails={token:oldDetails.fcmToken,createTime:oldDetails.createTime,subscriptionOptions:{auth:arrayToBase64(oldDetails.auth),p256dh:arrayToBase64(oldDetails.p256dh),endpoint:oldDetails.endpoint,swScope:oldDetails.swScope,vapidKey:arrayToBase64(oldDetails.vapidKey)}}}else if(4===oldVersion){const oldDetails=value;tokenDetails={token:oldDetails.fcmToken,createTime:oldDetails.createTime,subscriptionOptions:{auth:arrayToBase64(oldDetails.auth),p256dh:arrayToBase64(oldDetails.p256dh),endpoint:oldDetails.endpoint,swScope:oldDetails.swScope,vapidKey:arrayToBase64(oldDetails.vapidKey)}}}}})).close(),await deleteDB("fcm_token_details_db"),await deleteDB("fcm_vapid_details_db"),await deleteDB("undefined"),function checkTokenDetails(tokenDetails){if(!tokenDetails||!tokenDetails.subscriptionOptions)return!1;const{subscriptionOptions:subscriptionOptions}=tokenDetails;return"number"==typeof tokenDetails.createTime&amp;&amp;tokenDetails.createTime&gt;0&amp;&amp;"string"==typeof tokenDetails.token&amp;&amp;tokenDetails.token.length&gt;0&amp;&amp;"string"==typeof subscriptionOptions.auth&amp;&amp;subscriptionOptions.auth.length&gt;0&amp;&amp;"string"==typeof subscriptionOptions.p256dh&amp;&amp;subscriptionOptions.p256dh.length&gt;0&amp;&amp;"string"==typeof subscriptionOptions.endpoint&amp;&amp;subscriptionOptions.endpoint.length&gt;0&amp;&amp;"string"==typeof subscriptionOptions.swScope&amp;&amp;subscriptionOptions.swScope.length&gt;0&amp;&amp;"string"==typeof subscriptionOptions.vapidKey&amp;&amp;subscriptionOptions.vapidKey.length&gt;0}(tokenDetails)?tokenDetails:null}(firebaseDependencies.appConfig.senderId);if(oldTokenDetails)return await dbSet(firebaseDependencies,oldTokenDetails),oldTokenDetails}}async function dbSet(firebaseDependencies,tokenDetails){const key=getKey(firebaseDependencies),tx=(await getDbPromise()).transaction("firebase-messaging-store","readwrite");return await tx.objectStore("firebase-messaging-store").put(tokenDetails,key),await tx.done,tokenDetails}function getKey({appConfig:appConfig}){return appConfig.appId}const ERROR_FACTORY=new ErrorFactory("messaging","Messaging",{"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"only-available-in-window":"This method is available in a Window context.","only-available-in-sw":"This method is available in a service worker context.","permission-default":"The notification permission was not granted and dismissed instead.","permission-blocked":"The notification permission was not granted and blocked instead.","unsupported-browser":"This browser doesn't support the API's required to use the Firebase SDK.","indexed-db-unsupported":"This browser doesn't support indexedDb.open() (ex. Safari iFrame, Firefox Private Browsing, etc)","failed-service-worker-registration":"We are unable to register the default service worker. {$browserErrorMessage}","token-subscribe-failed":"A problem occurred while subscribing the user to FCM: {$errorInfo}","token-subscribe-no-token":"FCM returned no token when subscribing the user to push.","token-unsubscribe-failed":"A problem occurred while unsubscribing the user from FCM: {$errorInfo}","token-update-failed":"A problem occurred while updating the user from FCM: {$errorInfo}","token-update-no-token":"FCM returned no token when updating the user to push.","use-sw-after-get-token":"The useServiceWorker() method may only be called once and must be called before calling getToken() to ensure your service worker is used.","invalid-sw-registration":"The input to useServiceWorker() must be a ServiceWorkerRegistration.","invalid-bg-handler":"The input to setBackgroundMessageHandler() must be a function.","invalid-vapid-key":"The public VAPID key must be a string.","use-vapid-key-after-get-token":"The usePublicVapidKey() method may only be called once and must be called before calling getToken() to ensure your VAPID key is used."});function getEndpoint({projectId:projectId}){return`https://fcmregistrations.googleapis.com/v1/projects/${projectId}/registrations`}async function getHeaders({appConfig:appConfig,installations:installations}){const authToken=await installations.getToken();return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":appConfig.apiKey,"x-goog-firebase-installations-auth":`FIS ${authToken}`})}function getBody({p256dh:p256dh,auth:auth,endpoint:endpoint,vapidKey:vapidKey}){const body={web:{endpoint:endpoint,auth:auth,p256dh:p256dh}};return vapidKey!==DEFAULT_VAPID_KEY&amp;&amp;(body.web.applicationPubKey=vapidKey),body}async function getTokenInternal(messaging){const pushSubscription=await async function getPushSubscription(swRegistration,vapidKey){const subscription=await swRegistration.pushManager.getSubscription();if(subscription)return subscription;return swRegistration.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:base64ToArray(vapidKey)})}(messaging.swRegistration,messaging.vapidKey),subscriptionOptions={vapidKey:messaging.vapidKey,swScope:messaging.swRegistration.scope,endpoint:pushSubscription.endpoint,auth:arrayToBase64(pushSubscription.getKey("auth")),p256dh:arrayToBase64(pushSubscription.getKey("p256dh"))},tokenDetails=await dbGet(messaging.firebaseDependencies);if(tokenDetails){if(function isTokenValid(dbOptions,currentOptions){const isVapidKeyEqual=currentOptions.vapidKey===dbOptions.vapidKey,isEndpointEqual=currentOptions.endpoint===dbOptions.endpoint,isAuthEqual=currentOptions.auth===dbOptions.auth,isP256dhEqual=currentOptions.p256dh===dbOptions.p256dh;return isVapidKeyEqual&amp;&amp;isEndpointEqual&amp;&amp;isAuthEqual&amp;&amp;isP256dhEqual}(tokenDetails.subscriptionOptions,subscriptionOptions))return Date.now()&gt;=tokenDetails.createTime+6048e5?async function updateToken(messaging,tokenDetails){try{const updatedToken=await async function requestUpdateToken(firebaseDependencies,tokenDetails){const headers=await getHeaders(firebaseDependencies),body=getBody(tokenDetails.subscriptionOptions),updateOptions={method:"PATCH",headers:headers,body:JSON.stringify(body)};let responseData;try{const response=await fetch(`${getEndpoint(firebaseDependencies.appConfig)}/${tokenDetails.token}`,updateOptions);responseData=await response.json()}catch(err){throw ERROR_FACTORY.create("token-update-failed",{errorInfo:null==err?void 0:err.toString()})}if(responseData.error){const message=responseData.error.message;throw ERROR_FACTORY.create("token-update-failed",{errorInfo:message})}if(!responseData.token)throw ERROR_FACTORY.create("token-update-no-token");return responseData.token}(messaging.firebaseDependencies,tokenDetails),updatedTokenDetails=Object.assign(Object.assign({},tokenDetails),{token:updatedToken,createTime:Date.now()});return await dbSet(messaging.firebaseDependencies,updatedTokenDetails),updatedToken}catch(e){throw e}}(messaging,{token:tokenDetails.token,createTime:Date.now(),subscriptionOptions:subscriptionOptions}):tokenDetails.token;try{await async function requestDeleteToken(firebaseDependencies,token){const unsubscribeOptions={method:"DELETE",headers:await getHeaders(firebaseDependencies)};try{const response=await fetch(`${getEndpoint(firebaseDependencies.appConfig)}/${token}`,unsubscribeOptions),responseData=await response.json();if(responseData.error){const message=responseData.error.message;throw ERROR_FACTORY.create("token-unsubscribe-failed",{errorInfo:message})}}catch(err){throw ERROR_FACTORY.create("token-unsubscribe-failed",{errorInfo:null==err?void 0:err.toString()})}}(messaging.firebaseDependencies,tokenDetails.token)}catch(e){console.warn(e)}return getNewToken(messaging.firebaseDependencies,subscriptionOptions)}return getNewToken(messaging.firebaseDependencies,subscriptionOptions)}async function getNewToken(firebaseDependencies,subscriptionOptions){const token=await async function requestGetToken(firebaseDependencies,subscriptionOptions){const headers=await getHeaders(firebaseDependencies),body=getBody(subscriptionOptions),subscribeOptions={method:"POST",headers:headers,body:JSON.stringify(body)};let responseData;try{const response=await fetch(getEndpoint(firebaseDependencies.appConfig),subscribeOptions);responseData=await response.json()}catch(err){throw ERROR_FACTORY.create("token-subscribe-failed",{errorInfo:null==err?void 0:err.toString()})}if(responseData.error){const message=responseData.error.message;throw ERROR_FACTORY.create("token-subscribe-failed",{errorInfo:message})}if(!responseData.token)throw ERROR_FACTORY.create("token-subscribe-no-token");return responseData.token}(firebaseDependencies,subscriptionOptions),tokenDetails={token:token,createTime:Date.now(),subscriptionOptions:subscriptionOptions};return await dbSet(firebaseDependencies,tokenDetails),tokenDetails.token}function externalizePayload(internalPayload){const payload={from:internalPayload.from,collapseKey:internalPayload.collapse_key,messageId:internalPayload.fcmMessageId};return function propagateNotificationPayload(payload,messagePayloadInternal){if(!messagePayloadInternal.notification)return;payload.notification={};const title=messagePayloadInternal.notification.title;title&amp;&amp;(payload.notification.title=title);const body=messagePayloadInternal.notification.body;body&amp;&amp;(payload.notification.body=body);const image=messagePayloadInternal.notification.image;image&amp;&amp;(payload.notification.image=image);const icon=messagePayloadInternal.notification.icon;icon&amp;&amp;(payload.notification.icon=icon)}(payload,internalPayload),function propagateDataPayload(payload,messagePayloadInternal){if(!messagePayloadInternal.data)return;payload.data=messagePayloadInternal.data}(payload,internalPayload),function propagateFcmOptions(payload,messagePayloadInternal){var _a,_b,_c,_d,_e2;if(!messagePayloadInternal.fcmOptions&amp;&amp;!(null===(_a=messagePayloadInternal.notification)||void 0===_a?void 0:_a.click_action))return;payload.fcmOptions={};const link=null!==(_c=null===(_b=messagePayloadInternal.fcmOptions)||void 0===_b?void 0:_b.link)&amp;&amp;void 0!==_c?_c:null===(_d=messagePayloadInternal.notification)||void 0===_d?void 0:_d.click_action;link&amp;&amp;(payload.fcmOptions.link=link);const analyticsLabel=null===(_e2=messagePayloadInternal.fcmOptions)||void 0===_e2?void 0:_e2.analytics_label;analyticsLabel&amp;&amp;(payload.fcmOptions.analyticsLabel=analyticsLabel)}(payload,internalPayload),payload}function getMissingValueError(valueName){return ERROR_FACTORY.create("missing-app-config-values",{valueName:valueName})}class MessagingService{constructor(app,installations,analyticsProvider){this.deliveryMetricsExportedToBigQueryEnabled=!1,this.onBackgroundMessageHandler=null,this.onMessageHandler=null,this.logEvents=[],this.isLogServiceStarted=!1;const appConfig=function extractAppConfig(app){if(!app||!app.options)throw getMissingValueError("App Configuration Object");if(!app.name)throw getMissingValueError("App Name");const configKeys=["projectId","apiKey","appId","messagingSenderId"],{options:options}=app;for(const keyName of configKeys)if(!options[keyName])throw getMissingValueError(keyName);return{appName:app.name,projectId:options.projectId,apiKey:options.apiKey,appId:options.appId,senderId:options.messagingSenderId}}(app);this.firebaseDependencies={app:app,appConfig:appConfig,installations:installations,analyticsProvider:analyticsProvider}}_delete(){return Promise.resolve()}}async function registerDefaultSw(messaging){try{messaging.swRegistration=await navigator.serviceWorker.register("/firebase-messaging-sw.js",{scope:"/firebase-cloud-messaging-push-scope"}),messaging.swRegistration.update().catch(()=&gt;{}),await async function waitForRegistrationActive(registration){return new Promise((resolve,reject)=&gt;{const rejectTimeout=setTimeout(()=&gt;reject(new Error("Service worker not registered after 10000 ms")),1e4),incomingSw=registration.installing||registration.waiting;registration.active?(clearTimeout(rejectTimeout),resolve()):incomingSw?incomingSw.onstatechange=ev=&gt;{var _a;"activated"===(null===(_a=ev.target)||void 0===_a?void 0:_a.state)&amp;&amp;(incomingSw.onstatechange=null,clearTimeout(rejectTimeout),resolve())}:(clearTimeout(rejectTimeout),reject(new Error("No incoming service worker found.")))})}(messaging.swRegistration)}catch(e){throw ERROR_FACTORY.create("failed-service-worker-registration",{browserErrorMessage:null==e?void 0:e.message})}}async function getToken$1(messaging,options){if(!navigator)throw ERROR_FACTORY.create("only-available-in-window");if("default"===Notification.permission&amp;&amp;await Notification.requestPermission(),"granted"!==Notification.permission)throw ERROR_FACTORY.create("permission-blocked");return await async function updateVapidKey(messaging,vapidKey){vapidKey?messaging.vapidKey=vapidKey:messaging.vapidKey||(messaging.vapidKey=DEFAULT_VAPID_KEY)}(messaging,null==options?void 0:options.vapidKey),await async function updateSwReg(messaging,swRegistration){if(swRegistration||messaging.swRegistration||await registerDefaultSw(messaging),swRegistration||!messaging.swRegistration){if(!(swRegistration instanceof ServiceWorkerRegistration))throw ERROR_FACTORY.create("invalid-sw-registration");messaging.swRegistration=swRegistration}}(messaging,null==options?void 0:options.serviceWorkerRegistration),getTokenInternal(messaging)}async function logToScion(messaging,messageType,data){const eventType=function getEventType(messageType){switch(messageType){case MessageType.NOTIFICATION_CLICKED:return"notification_open";case MessageType.PUSH_RECEIVED:return"notification_foreground";default:throw new Error}}(messageType);(await messaging.firebaseDependencies.analyticsProvider.get()).logEvent(eventType,{message_id:data["google.c.a.c_id"],message_name:data["google.c.a.c_l"],message_time:data["google.c.a.ts"],message_device_time:Math.floor(Date.now()/1e3)})}const name="@firebase/messaging",WindowMessagingFactory=container=&gt;{const messaging=new MessagingService(container.getProvider("app").getImmediate(),container.getProvider("installations-internal").getImmediate(),container.getProvider("analytics-internal"));return navigator.serviceWorker.addEventListener("message",e=&gt;async function messageEventListener(messaging,event){const internalPayload=event.data;if(!internalPayload.isFirebaseMessaging)return;messaging.onMessageHandler&amp;&amp;internalPayload.messageType===MessageType.PUSH_RECEIVED&amp;&amp;("function"==typeof messaging.onMessageHandler?messaging.onMessageHandler(externalizePayload(internalPayload)):messaging.onMessageHandler.next(externalizePayload(internalPayload)));const dataPayload=internalPayload.data;(function isConsoleMessage(data){return"object"==typeof data&amp;&amp;!!data&amp;&amp;"google.c.a.c_id"in data})(dataPayload)&amp;&amp;"1"===dataPayload["google.c.a.e"]&amp;&amp;await logToScion(messaging,internalPayload.messageType,dataPayload)}(messaging,e)),messaging},WindowMessagingInternalFactory=container=&gt;{const messaging=container.getProvider("messaging").getImmediate();return{getToken:options=&gt;getToken$1(messaging,options)}};async function isWindowSupported(){try{await validateIndexedDBOpenable()}catch(e){return!1}return"undefined"!=typeof window&amp;&amp;isIndexedDBAvailable()&amp;&amp;areCookiesEnabled()&amp;&amp;"serviceWorker"in navigator&amp;&amp;"PushManager"in window&amp;&amp;"Notification"in window&amp;&amp;"fetch"in window&amp;&amp;ServiceWorkerRegistration.prototype.hasOwnProperty("showNotification")&amp;&amp;PushSubscription.prototype.hasOwnProperty("getKey")}function getMessagingInWindow(app=getApp()){return isWindowSupported().then(isSupported2=&gt;{if(!isSupported2)throw ERROR_FACTORY.create("unsupported-browser")},_=&gt;{throw ERROR_FACTORY.create("indexed-db-unsupported")}),_getProvider(getModularInstance(app),"messaging").getImmediate()}!function registerMessagingInWindow(){_registerComponent(new Component("messaging",WindowMessagingFactory,"PUBLIC")),_registerComponent(new Component("messaging-internal",WindowMessagingInternalFactory,"PRIVATE")),registerVersion(name,"0.12.22"),registerVersion(name,"0.12.22","esm2017")}();export{where as A,orderBy as B,addDoc as C,deleteDoc as D,getFirestore as E,terminate as F,GoogleAuthProvider as G,clearIndexedDbPersistence as H,deleteField as I,onSnapshot as J,onAuthStateChanged as K,index_esm as L,OAuthProvider as O,initializeFirestore as a,getStorage as b,getFunctions as c,isSupported as d,getAnalytics as e,isWindowSupported as f,getAuth as g,getMessagingInWindow as h,initializeApp as i,persistentMultipleTabManager as j,httpsCallable as k,doc as l,getDoc as m,getRedirectResult as n,serverTimestamp as o,persistentLocalCache as p,signInWithRedirect as q,signInWithPopup as r,setDoc as s,signOut as t,updateDoc as u,sendPasswordResetEmail as v,signInWithEmailAndPassword as w,collection as x,getDocs as y,query as z};</span></span></span>
&nbsp;</pre></td></tr></table></pre>

                <div class='push'></div><!-- for sticky footer -->
            </div><!-- /wrapper -->
            <div class='footer quiet pad2 space-top1 center small'>
                Code coverage generated by
                <a href="https://istanbul.js.org/" target="_blank" rel="noopener noreferrer">istanbul</a>
                at 2025-10-16T12:41:31.984Z
            </div>
        <script src="../../../../prettify.js"></script>
        <script>
            window.onload = function () {
                prettyPrint();
            };
        </script>
        <script src="../../../../sorter.js"></script>
        <script src="../../../../block-navigation.js"></script>
    </body>
</html>
    