
<!doctype html>
<html lang="en">

<head>
    <title>Code coverage report for Building Vitals/Building-Vitals/build/js/utils-CrQ8UdBz.js</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="../../../../prettify.css" />
    <link rel="stylesheet" href="../../../../base.css" />
    <link rel="shortcut icon" type="image/x-icon" href="../../../../favicon.png" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style type='text/css'>
        .coverage-summary .sorter {
            background-image: url(../../../../sort-arrow-sprite.png);
        }
    </style>
</head>
    
<body>
<div class='wrapper'>
    <div class='pad1'>
        <h1><a href="../../../../index.html">All files</a> / <a href="index.html">Building Vitals/Building-Vitals/build/js</a> utils-CrQ8UdBz.js</h1>
        <div class='clearfix'>
            
            <div class='fl pad1y space-right2'>
                <span class="strong">0% </span>
                <span class="quiet">Statements</span>
                <span class='fraction'>0/2</span>
            </div>
        
            
            <div class='fl pad1y space-right2'>
                <span class="strong">0% </span>
                <span class="quiet">Branches</span>
                <span class='fraction'>0/1</span>
            </div>
        
            
            <div class='fl pad1y space-right2'>
                <span class="strong">0% </span>
                <span class="quiet">Functions</span>
                <span class='fraction'>0/1</span>
            </div>
        
            
            <div class='fl pad1y space-right2'>
                <span class="strong">0% </span>
                <span class="quiet">Lines</span>
                <span class='fraction'>0/2</span>
            </div>
        
            
        </div>
        <p class="quiet">
            Press <em>n</em> or <em>j</em> to go to the next uncovered block, <em>b</em>, <em>p</em> or <em>k</em> for the previous block.
        </p>
        <template id="filterTemplate">
            <div class="quiet">
                Filter:
                <input type="search" id="fileSearch">
            </div>
        </template>
    </div>
    <div class='status-line low'></div>
    <pre><table class="coverage">
<tr><td class="line-count quiet"><a name='L1'></a><a href='#L1'>1</a>
<a name='L2'></a><a href='#L2'>2</a>
<a name='L3'></a><a href='#L3'>3</a></td><td class="line-coverage quiet"><span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js"><span class="cstat-no" title="statement not covered" ><span class="fstat-no" title="function not covered" ><span class="branch-0 cbranch-no" title="branch not covered" >const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["js/components-DaeLY-_K.js","js/vendor-CFMRQ_Yt.js","js/data-vendor-DBrFxduC.js","js/echarts-vendor-xTKhTmAz.js","assets/vendor-BOltB2Hq.css","js/app-core-rH6lZf1X.js","js/services-B0KkmCks.js","js/firebase-vendor-DFJ8_Xw5.js","js/date-vendor-BU9txqBG.js","assets/components-DgQfaczj.css"])))=&gt;i.map(i=&gt;d[i]);</span></span></span>
<span class="cstat-no" title="statement not covered" >var __defProp=Object.defineProperty,__publicField=(obj,key,value)=&gt;((obj,key,value)=&gt;key in obj?__defProp(obj,key,{enumerable:!0,configurable:!0,writable:!0,value:value}):obj[key]=value)(obj,"symbol"!=typeof key?key+"":key,value);import{ac as echarts,ap as init,aq as connect,ar as disconnect}from"./echarts-vendor-xTKhTmAz.js";import{_ as __vitePreload,x as db,c as auth,E as store,T as setAceToken,U as tokenLoadComplete,V as getApiService,R as getTokenService,W as tokenManager,O as createLogger,X as getFirebaseAuth,Y as getToken$1,Z as axiosInstance,s as sesColorPalette,S as aceIotApiClient}from"./app-core-rH6lZf1X.js";import{x as collection,y as getDocs,u as updateDoc,l as doc,m as getDoc,s as setDoc,o as serverTimestamp,E as getFirestore,F as terminate,H as clearIndexedDbPersistence,I as deleteField,J as onSnapshot,K as onAuthStateChanged,w as signInWithEmailAndPassword,g as getAuth,c as getFunctions,k as httpsCallable}from"./firebase-vendor-DFJ8_Xw5.js";import{a as secureStorage}from"./services-B0KkmCks.js";import{n as reactExports,O as React,E as Box,ah as CircularProgress,A as Alert,v as alpha,ed as reactDomExports}from"./vendor-CFMRQ_Yt.js";import{a as axios}from"./data-vendor-DBrFxduC.js";import{f as format}from"./date-vendor-BU9txqBG.js";if("undefined"!=typeof window){const globalAny=window;globalAny.__extends||(globalAny.extendStatics=function(d,b){return globalAny.extendStatics(d,b)},globalAny.__extends=function(d,b){if("function"!=typeof b&amp;&amp;null!==b)throw new TypeError("Class extends value "+String(b)+" is not a constructor or null");function __(){this.constructor=d}globalAny.extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}),globalAny.extendStatics$1||(globalAny.extendStatics$1=globalAny.extendStatics),globalAny.__assign||(globalAny.__assign=Object.assign||function(t){for(var s,i=1,n=arguments.length;i&lt;n;i++){s=arguments[i];for(const p in s)Object.prototype.hasOwnProperty.call(s,p)&amp;&amp;(t[p]=s[p])}return t})}"undefined"!=typeof window&amp;&amp;(window.echarts=echarts,globalThis.echarts=echarts);const ECHARTS_GL_CDN_URLS=["https://cdn.jsdelivr.net/npm/echarts-gl@2.0.9/dist/echarts-gl.min.js","https://unpkg.com/echarts-gl@2.0.9/dist/echarts-gl.min.js","https://cdnjs.cloudflare.com/ajax/libs/echarts-gl/2.0.9/echarts-gl.min.js"];let echartsGlLoaded=!1,echartsGlLoadPromise=null,echartsGlError=null,Vector3$1=class Vector32{constructor(x=0,y=0,z=0){__publicField(this,"x"),__publicField(this,"y"),__publicField(this,"z"),this.x=x,this.y=y,this.z=z}set(x,y,z){return this.x=x,this.y=y,this.z=z,this}clone(){return new Vector32(this.x,this.y,this.z)}copy(v){return this.x=v.x,this.y=v.y,this.z=v.z,this}add(v){return this.x+=v.x,this.y+=v.y,this.z+=v.z,this}sub(v){return this.x-=v.x,this.y-=v.y,this.z-=v.z,this}multiplyScalar(scalar){return this.x*=scalar,this.y*=scalar,this.z*=scalar,this}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}normalize(){const len=this.length();return len&gt;0&amp;&amp;this.multiplyScalar(1/len),this}dot(v){return this.x*v.x+this.y*v.y+this.z*v.z}cross(v){const x=this.y*v.z-this.z*v.y,y=this.z*v.x-this.x*v.z,z=this.x*v.y-this.y*v.x;return this.x=x,this.y=y,this.z=z,this}};function setupGlobalEnvironment(){if("undefined"==typeof window)return;const globalScope=window;globalScope.echarts||(globalScope.echarts=echarts),globalScope.Vector3||(globalScope.Vector3=Vector3$1),"undefined"!=typeof globalThis&amp;&amp;(globalThis.echarts=echarts,globalThis.Vector3=Vector3$1),globalScope.Matrix4||(globalScope.Matrix4=class Matrix4{constructor(){__publicField(this,"elements"),this.elements=new Float32Array(16),this.identity()}identity(){return this.elements.fill(0),this.elements[0]=this.elements[5]=this.elements[10]=this.elements[15]=1,this}}),globalScope.Quaternion||(globalScope.Quaternion=class Quaternion{constructor(x=0,y=0,z=0,w=1){__publicField(this,"x",0),__publicField(this,"y",0),__publicField(this,"z",0),__publicField(this,"w",1),this.x=x,this.y=y,this.z=z,this.w=w}})}function loadScriptFromCdn(url,timeout=1e4){return new Promise((resolve,reject)=&gt;{const existingScript=document.querySelector(`script[src="${url}"]`);if(existingScript){if("true"===existingScript.dataset.loaded)return void resolve();if("true"===existingScript.dataset.error)return void reject(new Error(`Script previously failed to load: ${url}`))}const script=document.createElement("script");let timeoutId;script.src=url,script.async=!0,script.crossOrigin="anonymous";const cleanup=()=&gt;{clearTimeout(timeoutId),script.removeEventListener("load",onLoad),script.removeEventListener("error",onError)},onLoad=()=&gt;{cleanup(),script.dataset.loaded="true",resolve()},onError=()=&gt;{cleanup(),script.dataset.error="true",reject(new Error(`Failed to load script: ${url}`))};script.addEventListener("load",onLoad),script.addEventListener("error",onError),timeoutId=setTimeout(()=&gt;{cleanup(),script.dataset.error="true",reject(new Error(`Timeout loading script: ${url}`))},timeout),document.head.appendChild(script)})}async function loadEchartsGl(){if(echartsGlLoadPromise)return echartsGlLoadPromise;if(echartsGlLoaded)return Promise.resolve();if(echartsGlError)throw echartsGlError;return echartsGlLoadPromise=(async()=&gt;{var _a;try{if("undefined"==typeof window)throw new Error("ECharts GL can only be loaded in browser environment");setupGlobalEnvironment();try{await __vitePreload(()=&gt;import("./components-DaeLY-_K.js").then(n=&gt;n.q),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9])),console.log("[ECharts GL] Loaded from npm module")}catch(npmError){console.log("[ECharts GL] NPM module not available, loading from CDN"),await async function loadEchartsGlFromCdn(){const errors=[];for(const url of ECHARTS_GL_CDN_URLS)try{return console.log(`[ECharts GL] Attempting to load from: ${url}`),await loadScriptFromCdn(url),void console.log(`[ECharts GL] Successfully loaded from: ${url}`)}catch(error){console.warn(`[ECharts GL] Failed to load from ${url}:`,error),errors.push(error)}throw new Error(`Failed to load echarts-gl from any CDN. Errors: ${errors.map(e=&gt;e.message).join(", ")}`)}()}if(!(null==(_a=window.echarts)?void 0:_a.registerMap))throw new Error("ECharts GL failed to initialize properly");echartsGlLoaded=!0,echartsGlError=null,console.log("[ECharts GL] Successfully initialized")}catch(error){throw echartsGlError=error,console.error("[ECharts GL] Failed to load:",error),error}})(),echartsGlLoadPromise}"undefined"!=typeof window&amp;&amp;(setupGlobalEnvironment(),setTimeout(()=&gt;{loadEchartsGl().catch(error=&gt;{console.warn("[ECharts GL] Auto-initialization failed, will retry on demand:",error)})},500)),Vector3;const enhancedErrorHandler=(error,errorInfo)=&gt;{var _a,_b;const errorData=((error,errorInfo)=&gt;{const errorData={message:error.message,stack:error.stack,name:error.name,timestamp:(new Date).toISOString(),errorInfo:errorInfo,componentStack:null==errorInfo?void 0:errorInfo.componentStack,url:window.location.href,userAgent:navigator.userAgent};try{const existingErrors=JSON.parse(sessionStorage.getItem("dashboard_errors")||"[]");existingErrors.push(errorData),existingErrors.length&gt;5&amp;&amp;existingErrors.shift(),sessionStorage.setItem("dashboard_errors",JSON.stringify(existingErrors))}catch(e){}return console.group("🚨 Dashboard Error Details"),console.error("Message:",error.message),console.error("Stack:",error.stack),console.error("Component Stack:",null==errorInfo?void 0:errorInfo.componentStack),console.error("Full Error Object:",error),console.error("Error Info:",errorInfo),console.groupEnd(),errorData})(error,errorInfo);return error.message.includes("Cannot read properties of undefined"),error.message.includes("Cannot read properties of null"),null==(_a=error.stack)||_a.includes("ChartRendererV2"),null==(_b=error.stack)||_b.includes("SimpleGridDashboard"),errorData},validateMonitor=monitor=&gt;{const errors=[];monitor.id||errors.push("Missing monitor ID"),monitor.name||errors.push("Missing monitor name"),monitor.chartType&amp;&amp;"string"==typeof monitor.chartType||errors.push(`Invalid chartType: ${monitor.chartType} (type: ${typeof monitor.chartType})`),monitor.selectedPoints&amp;&amp;Array.isArray(monitor.selectedPoints)||errors.push("Missing or invalid selectedPoints array");return monitor.chartType&amp;&amp;!["TimeSeries","bar","heatmap","gauge","scatter","AreaChart","StackedArea","Psychrometric","PerfectEconomizer","DeviceDeviationHeatmap","Radar","BoxPlot","Candlestick","ParallelCoordinates","CalendarHeatmap","CalendarYearHeatmap","TimelineChart","Sankey","Treemap"].includes(monitor.chartType)&amp;&amp;errors.push(`Unknown chartType: ${monitor.chartType}`),{valid:0===errors.length,errors:errors}},cleanupInvalidMonitors=async userId=&gt;{const results={cleaned:0,errors:[]};try{const dashboardsRef=collection(db,"users",userId,"dashboards"),dashboardsSnapshot=await getDocs(dashboardsRef);for(const dashboardDoc of dashboardsSnapshot.docs){const monitors=dashboardDoc.data().monitors||[];let hasChanges=!1;const validMonitors=monitors.filter(monitor=&gt;{const validation=validateMonitor(monitor);return!!validation.valid||(results.errors.push({id:monitor.id,name:monitor.name||"Unknown",errors:validation.errors}),hasChanges=!0,results.cleaned++,!1)});hasChanges&amp;&amp;await updateDoc(doc(db,"users",userId,"dashboards",dashboardDoc.id),{monitors:validMonitors,updatedAt:new Date})}return results}catch(error){throw console.error("Error cleaning up monitors:",error),error}},fixInvalidChartTypes=async userId=&gt;{let fixed=0;try{const dashboardsRef=collection(db,"users",userId,"dashboards"),dashboardsSnapshot=await getDocs(dashboardsRef);for(const dashboardDoc of dashboardsSnapshot.docs){const monitors=dashboardDoc.data().monitors||[];let hasChanges=!1;const fixedMonitors=monitors.map(monitor=&gt;(monitor.chartType&amp;&amp;"string"==typeof monitor.chartType||(monitor.chartType="TimeSeries",hasChanges=!0,fixed++),"timeseries"===monitor.chartType&amp;&amp;(monitor.chartType="TimeSeries",hasChanges=!0,fixed++),monitor));hasChanges&amp;&amp;await updateDoc(doc(db,"users",userId,"dashboards",dashboardDoc.id),{monitors:fixedMonitors,updatedAt:new Date})}return fixed}catch(error){throw console.error("Error fixing chart types:",error),error}};function formatLocalTimeForAPI(date){return date.toISOString()}function getBrowserTimezone(){return Intl.DateTimeFormat().resolvedOptions().timeZone}function handleFirestorePersistenceError(error){if(!error)return!1;const errorMessage=error.message||error.toString(),errorCode=error.code,isPersistenceError=["Failed to obtain exclusive access","IndexedDB","QuotaExceededError","The database connection is closing","Internal error in Firestore","Another tab has exclusive access","unavailable","aborted"].some(msg=&gt;errorMessage.toLowerCase().includes(msg.toLowerCase()))||"unavailable"===errorCode;return isPersistenceError&amp;&amp;console.warn("⚠️ Firestore persistence issue detected. This might be due to:\n- Multiple tabs open\n- Browser storage full\n- IndexedDB corruption\n\nTry closing other tabs or run: clearFirestorePersistence()"),isPersistenceError}async function retryFirestoreOperation(operation,maxRetries=3,initialDelay=1e3){let lastError;for(let i=0;i&lt;maxRetries;i++)try{return await operation()}catch(error){if(lastError=error,handleFirestorePersistenceError(error),"permission-denied"===error.code)throw error;const delay=initialDelay*Math.pow(2,i);await new Promise(resolve=&gt;setTimeout(resolve,delay))}throw lastError}"undefined"!=typeof window&amp;&amp;(window.monitorCleanup={validateMonitor:validateMonitor,cleanupInvalidMonitors:cleanupInvalidMonitors,fixInvalidChartTypes:fixInvalidChartTypes,cleanupMyMonitors:async()=&gt;{var _a,_b;const user=null==(_b=null==(_a=window.firebase)?void 0:_a.auth())?void 0:_b.currentUser;if(!user)return void console.error("No authenticated user");console.log("Cleaning up monitors for user:",user.uid);const result=await cleanupInvalidMonitors(user.uid);return console.log("Cleanup results:",result),result.cleaned&gt;0&amp;&amp;(console.log("Fixed monitors. Refreshing page..."),window.location.reload()),result},fixMyChartTypes:async()=&gt;{var _a,_b;const user=null==(_b=null==(_a=window.firebase)?void 0:_a.auth())?void 0:_b.currentUser;if(!user)return void console.error("No authenticated user");console.log("Fixing chart types for user:",user.uid);const fixed=await fixInvalidChartTypes(user.uid);return console.log(`Fixed ${fixed} monitors`),fixed&gt;0&amp;&amp;(console.log("Fixed chart types. Refreshing page..."),window.location.reload()),fixed}},console.log("🧹 Monitor cleanup utilities loaded. Available commands:"),console.log("monitorCleanup.cleanupMyMonitors() - Remove invalid monitors"),console.log("monitorCleanup.fixMyChartTypes() - Fix invalid chart types"),console.log("monitorCleanup.validateMonitor(monitor) - Validate a monitor object")),"undefined"!=typeof window&amp;&amp;(window.debugFirestore=async function debugFirestoreConnection(){var _a;const results={firebaseInitialized:!1,authInitialized:!1,firestoreInitialized:!1,currentUser:null,userDocExists:!1,canReadFirestore:!1,canWriteFirestore:!1,errors:[]};try{if(results.firebaseInitialized=!!auth&amp;&amp;!!db,results.authInitialized=!!auth,results.firestoreInitialized=!!db,null==(_a=auth)?void 0:_a.currentUser){results.currentUser={uid:auth.currentUser.uid,email:auth.currentUser.email};try{const userDoc=await getDoc(doc(db,"users",auth.currentUser.uid));results.userDocExists=userDoc.exists(),results.canReadFirestore=!0,userDoc.exists()&amp;&amp;(results.userDocData=userDoc.data())}catch(error){results.canReadFirestore=!1,results.errors.push({operation:"read",error:error.message,code:error.code})}try{const testDocRef=doc(db,"test",`debug_${Date.now()}`);await setDoc(testDocRef,{timestamp:serverTimestamp(),test:!0}),results.canWriteFirestore=!0}catch(error){results.canWriteFirestore=!1,results.errors.push({operation:"write",error:error.message,code:error.code})}}else results.errors.push("No authenticated user")}catch(error){results.errors.push({operation:"general",error:error.message})}return console.log("🔍 Firestore Debug Results:",results),results},window.fixUserDocument=async function fixUserDocument(){var _a;if(!(null==(_a=auth)?void 0:_a.currentUser))return console.error("No authenticated user"),!1;const userId=auth.currentUser.uid,email=auth.currentUser.email;try{console.log("🔧 Attempting to create/fix user document for:",userId);const userDocRef=doc(db,"users",userId);await setDoc(userDocRef,{uid:userId,email:email||"",role:"user",createdAt:serverTimestamp(),updatedAt:serverTimestamp(),isActive:!0,aceJwt:null,aceJwtUpdatedAt:null},{merge:!0}),console.log("✅ User document created/updated successfully");const verifyDoc=await getDoc(userDocRef);return console.log("📄 Document exists after creation:",verifyDoc.exists()),!0}catch(error){return console.error("❌ Failed to create/fix user document:",error),!1}},console.log("🔍 Firestore debug tools available:"),console.log("- Run debugFirestore() to check Firestore connection"),console.log("- Run fixUserDocument() to create/fix user document")),"undefined"!=typeof window&amp;&amp;(window.clearFirestorePersistence=async function clearFirestorePersistence(){try{const db2=getFirestore();await terminate(db2),await clearIndexedDbPersistence(db2),window.location.reload()}catch(error){throw error}},window.checkIndexedDBHealth=async function checkIndexedDBHealth(){try{if(!("indexedDB"in window))return{available:!1,working:!1,error:"IndexedDB not available"};const testDbName="_firestore_test_"+Date.now(),request=indexedDB.open(testDbName,1);return new Promise(resolve=&gt;{request.onsuccess=()=&gt;{request.result.close(),indexedDB.deleteDatabase(testDbName),resolve({available:!0,working:!0})},request.onerror=()=&gt;{var _a;resolve({available:!0,working:!1,error:(null==(_a=request.error)?void 0:_a.message)||"Unknown error"})},request.onblocked=()=&gt;{resolve({available:!0,working:!1,error:"IndexedDB blocked"})}})}catch(error){return{available:!0,working:!1,error:error.message||"Unknown error"}}},console.log("🔧 Firestore persistence tools available:"),console.log("- clearFirestorePersistence() - Clear IndexedDB and restart"),console.log("- checkIndexedDBHealth() - Check if IndexedDB is working"));const logger$2_info=(message,...args)=&gt;console.log(`[IndexedDBFix] ${message}`,...args),logger$2_warn=(message,...args)=&gt;console.warn(`[IndexedDBFix] ${message}`,...args),logger$2_error=(message,...args)=&gt;console.error(`[IndexedDBFix] ${message}`,...args);async function checkIndexedDBVersionConflict(){var _a,_b;try{const databases=await(null==(_a=indexedDB.databases)?void 0:_a.call(indexedDB))||[];for(const db2 of databases)if(null==(_b=db2.name)?void 0:_b.includes("firestore"))try{const openRequest=indexedDB.open(db2.name,db2.version);await new Promise((resolve,reject)=&gt;{openRequest.onsuccess=()=&gt;{openRequest.result.close(),resolve(!0)},openRequest.onerror=()=&gt;{reject(openRequest.error)},openRequest.onupgradeneeded=()=&gt;{openRequest.result.close(),reject(new Error("Database upgrade needed"))}})}catch(error){return!0}return!1}catch(error){return!1}}async function deleteFirestoreIndexedDB(){var _a,_b;try{const databases=await(null==(_a=indexedDB.databases)?void 0:_a.call(indexedDB))||[],deletePromises=[];for(const db2 of databases)(null==(_b=db2.name)?void 0:_b.includes("firestore"))&amp;&amp;deletePromises.push(new Promise((resolve,reject)=&gt;{const deleteReq=indexedDB.deleteDatabase(db2.name);deleteReq.onsuccess=()=&gt;{resolve()},deleteReq.onerror=()=&gt;{reject(deleteReq.error)}}));const commonNames=["firebaseLocalStorageDb","firestore/[DEFAULT]/building-vitals/main","firestore/[DEFAULT]/building-vitals/(default)"];for(const name of commonNames)deletePromises.push(new Promise(resolve=&gt;{const deleteReq=indexedDB.deleteDatabase(name);deleteReq.onsuccess=()=&gt;{resolve()},deleteReq.onerror=()=&gt;{resolve()}}));await Promise.all(deletePromises)}catch(error){throw error}}async function resetFirestorePersistence(){try{logger$2_info("Starting Firestore persistence reset...");try{const db2=getFirestore();await terminate(db2),logger$2_info("Firestore instance terminated")}catch(termError){logger$2_warn("Could not terminate Firestore:",termError)}try{const db2=getFirestore();await clearIndexedDbPersistence(db2),logger$2_info("Cleared IndexedDB persistence via Firestore API")}catch(clearError){logger$2_warn("Could not clear via Firestore API:",clearError)}await deleteFirestoreIndexedDB(),logger$2_info("Deleted Firestore IndexedDB databases");const keysToRemove=[];for(let i=0;i&lt;localStorage.length;i++){const key=localStorage.key(i);key&amp;&amp;(key.includes("firebase")||key.includes("firestore")||key.includes("indexeddb"))&amp;&amp;keysToRemove.push(key)}keysToRemove.forEach(key=&gt;{localStorage.removeItem(key)}),logger$2_info(`Cleared ${keysToRemove.length} localStorage items`);const sessionKeysToRemove=[];for(let i=0;i&lt;sessionStorage.length;i++){const key=sessionStorage.key(i);key&amp;&amp;(key.includes("firebase")||key.includes("firestore"))&amp;&amp;sessionKeysToRemove.push(key)}if(sessionKeysToRemove.forEach(key=&gt;{sessionStorage.removeItem(key)}),"caches"in window)try{const cacheNames=await caches.keys();await Promise.all(cacheNames.filter(name=&gt;name.includes("firebase")||name.includes("firestore")).map(name=&gt;caches.delete(name))),logger$2_info("Cleared service worker caches")}catch(cacheError){logger$2_warn("Could not clear caches:",cacheError)}localStorage.removeItem("indexeddb-fix-attempt"),logger$2_info("Persistence reset complete, reloading page..."),window.location.reload()}catch(error){throw logger$2_error("Failed to reset persistence:",error),error}}async function autoFixIndexedDB(){var _a,_b;try{logger$2_info("Starting autoFixIndexedDB...");let hasIssue=!1;await checkIndexedDBVersionConflict()&amp;&amp;(logger$2_info("IndexedDB version conflict detected"),hasIssue=!0);try{const testDbName="_indexeddb_test_"+Date.now(),testRequest=indexedDB.open(testDbName,1);await new Promise((resolve,reject)=&gt;{testRequest.onsuccess=()=&gt;{testRequest.result.close(),indexedDB.deleteDatabase(testDbName),resolve(!0)},testRequest.onerror=()=&gt;{logger$2_error("Failed to open test database:",testRequest.error),reject(testRequest.error)},testRequest.onblocked=()=&gt;{logger$2_error("Test database blocked"),reject(new Error("Database blocked"))},setTimeout(()=&gt;reject(new Error("Database open timeout")),5e3)})}catch(testError){logger$2_error("IndexedDB test failed:",testError),hasIssue=!0}try{const databases=await(null==(_a=indexedDB.databases)?void 0:_a.call(indexedDB))||[];for(const db2 of databases)if(null==(_b=db2.name)?void 0:_b.includes("firestore"))try{const openReq=indexedDB.open(db2.name,db2.version);await new Promise((resolve,reject)=&gt;{openReq.onsuccess=()=&gt;{openReq.result.close(),resolve(!0)},openReq.onerror=()=&gt;{var _a2,_b2,_c,_d;((null==(_b2=null==(_a2=openReq.error)?void 0:_a2.message)?void 0:_b2.includes("abort"))||(null==(_d=null==(_c=openReq.error)?void 0:_c.message)?void 0:_d.includes("version")))&amp;&amp;(logger$2_error("Firestore database corrupted:",db2.name,openReq.error),hasIssue=!0),reject(openReq.error)},setTimeout(()=&gt;reject(new Error("Timeout")),2e3)})}catch(err){logger$2_warn("Could not open Firestore database:",db2.name),hasIssue=!0}}catch(err){logger$2_warn("Could not check Firestore databases:",err)}return hasIssue?(logger$2_info("IndexedDB issues detected, performing reset..."),await resetFirestorePersistence(),!0):(logger$2_info("No IndexedDB issues detected"),!1)}catch(error){logger$2_error("autoFixIndexedDB error:",error);try{return await resetFirestorePersistence(),!0}catch(resetError){return logger$2_error("Failed to reset persistence:",resetError),!1}}}async function forceFixIndexedDB(){var _a;try{logger$2_info("Starting forced IndexedDB fix...");try{const databases=await(null==(_a=indexedDB.databases)?void 0:_a.call(indexedDB))||[],deletePromises=databases.map(db2=&gt;db2.name?new Promise(resolve=&gt;{const deleteReq=indexedDB.deleteDatabase(db2.name);deleteReq.onsuccess=()=&gt;resolve(),deleteReq.onerror=()=&gt;resolve(),deleteReq.onblocked=()=&gt;resolve()}):Promise.resolve());await Promise.all(deletePromises),logger$2_info(`Deleted ${databases.length} databases`)}catch(err){logger$2_warn("Could not enumerate databases, trying known names...");const knownDbs=["firebaseLocalStorageDb","firestore/[DEFAULT]/building-vitals/main","firestore/[DEFAULT]/building-vitals/(default)","firebaseLocalStorage","firestore"];for(const dbName of knownDbs)try{await new Promise(resolve=&gt;{const req=indexedDB.deleteDatabase(dbName);req.onsuccess=()=&gt;resolve(),req.onerror=()=&gt;resolve(),req.onblocked=()=&gt;resolve(),setTimeout(resolve,1e3)})}catch(e){}}if(localStorage.clear(),sessionStorage.clear(),"caches"in window)try{const names=await caches.keys();await Promise.all(names.map(name=&gt;caches.delete(name)))}catch(e){}return logger$2_info("Force fix complete, reloading..."),window.location.reload(),!0}catch(error){return logger$2_error("Force fix failed:",error),!1}}"undefined"!=typeof window&amp;&amp;(window.checkIndexedDBVersionConflict=checkIndexedDBVersionConflict,window.deleteFirestoreIndexedDB=deleteFirestoreIndexedDB,window.resetFirestorePersistence=resetFirestorePersistence,window.autoFixIndexedDB=autoFixIndexedDB,window.forceFixIndexedDB=forceFixIndexedDB),console.log("%c🔧 IndexedDB Fix Utilities Available","color: #4CAF50; font-weight: bold"),console.log('%cIf you see "refusing to open IndexedDB database" errors:',"color: #FFC107"),console.log("%c1. Run: autoFixIndexedDB()","color: #2196F3"),console.log("%c2. Or manually: resetFirestorePersistence()","color: #2196F3"),console.log("%c3. For persistent issues: forceFixIndexedDB()","color: #FF5722"),console.log("%c4. The page will reload automatically after fixing","color: #9E9E9E");const fixIndexedDB=Object.freeze(Object.defineProperty({__proto__:null,autoFixIndexedDB:autoFixIndexedDB,checkIndexedDBVersionConflict:checkIndexedDBVersionConflict,deleteFirestoreIndexedDB:deleteFirestoreIndexedDB,forceFixIndexedDB:forceFixIndexedDB,resetFirestorePersistence:resetFirestorePersistence},Symbol.toStringTag,{value:"Module"}));const tokenDebugUtils=new class TokenDebugUtils{async clearAllTokenData(){try{const user=auth.currentUser;if(!user)return{success:!1,message:"No authenticated user"};const userDocRef=doc(db,"users",user.uid);await updateDoc(userDocRef,{aceJwtEncrypted:deleteField(),aceJwtCached:deleteField(),aceJwtUpdatedAt:deleteField(),aceJwtHash:deleteField(),aceJwtIsEncrypted:deleteField(),aceJwtExpiresAt:deleteField(),aceJwtStorageLocation:deleteField(),aceJwt:deleteField()});return["ace_token_encrypted","ace_token","ace_token_exp","ace_token_v2","aceiot_token"].forEach(key=&gt;{localStorage.removeItem(key),sessionStorage.removeItem(key)}),{success:!0,message:"All token data cleared successfully. Please reload the page and re-enter your token."}}catch(error){return console.error("Failed to clear token data:",error),{success:!1,message:"Failed to clear token data",details:error}}}async checkTokenStatus(){try{const user=auth.currentUser;if(!user)return{success:!1,message:"No authenticated user"};const userDocRef=doc(db,"users",user.uid),userData=(await getDoc(userDocRef)).data(),localTokens={ace_token_encrypted:localStorage.getItem("ace_token_encrypted"),ace_token:localStorage.getItem("ace_token"),ace_token_exp:localStorage.getItem("ace_token_exp")};let backendStatus="Not tested";try{const response=await fetch("https://ace-iot-proxy.jstahr.workers.dev/api/health");backendStatus=response.ok?"Connected to Cloudflare Worker":`Worker returned ${response.status}`}catch(error){backendStatus=`Failed: ${error.message}`}return{success:!0,message:"Token status check complete",details:{userId:user.uid,firestore:{hasEncryptedToken:!!(null==userData?void 0:userData.aceJwtEncrypted),isEncrypted:null==userData?void 0:userData.aceJwtIsEncrypted,storageLocation:null==userData?void 0:userData.aceJwtStorageLocation,updatedAt:null==userData?void 0:userData.aceJwtUpdatedAt,expiresAt:null==userData?void 0:userData.aceJwtExpiresAt},localStorage:localTokens,backendConnectivity:backendStatus}}}catch(error){return console.error("Failed to check token status:",error),{success:!1,message:"Failed to check token status",details:error}}}async forceTokenReEncryption(token){try{const user=auth.currentUser;if(!user)return{success:!1,message:"No authenticated user"};const{tokenService:tokenService}=await __vitePreload(async()=&gt;{const{tokenService:tokenService2}=await import("./app-core-rH6lZf1X.js").then(n=&gt;n.ae);return{tokenService:tokenService2}},__vite__mapDeps([5,1,2,3,4,6,7,8,0,9]));await this.clearAllTokenData();return await tokenService.saveToken(user.uid,token,!0)?{success:!0,message:"Token re-encrypted and saved successfully"}:{success:!1,message:"Failed to save token"}}catch(error){return console.error("Failed to re-encrypt token:",error),{success:!1,message:"Failed to re-encrypt token",details:error}}}};"undefined"!=typeof window&amp;&amp;(window.tokenDebug={clear:()=&gt;tokenDebugUtils.clearAllTokenData(),status:()=&gt;tokenDebugUtils.checkTokenStatus(),reEncrypt:token=&gt;tokenDebugUtils.forceTokenReEncryption(token),help:()=&gt;{console.log("\nToken Debug Utilities:\n======================\ntokenDebug.clear()     - Clear all token data and force re-entry\ntokenDebug.status()    - Check current token status\ntokenDebug.reEncrypt(token) - Force token re-encryption\n\nExample:\n  await tokenDebug.clear()\n  // Then reload the page and re-enter your token\n      ")}},console.log("🔧 Token debug utilities loaded. Type tokenDebug.help() for usage."));const tokenFixUtils=new class TokenFixUtils{async completeReset(){try{const user=auth.currentUser;if(!user)return{success:!1,message:"No authenticated user"};console.log("[TokenFix] Starting complete reset for user:",user.uid);const userDocRef=doc(db,"users",user.uid);await updateDoc(userDocRef,{aceJwtEncrypted:deleteField(),aceJwtCached:deleteField(),aceJwtUpdatedAt:deleteField(),aceJwtHash:deleteField(),aceJwtIsEncrypted:deleteField(),aceJwtExpiresAt:deleteField(),aceJwtStorageLocation:deleteField(),aceJwt:deleteField()}),console.log("[TokenFix] Cleared token from Firestore");["ace_token_encrypted","ace_token","ace_token_exp","ace_token_v2","aceiot_token","ace_jwt_secure"].forEach(key=&gt;{localStorage.removeItem(key),sessionStorage.removeItem(key)}),console.log("[TokenFix] Cleared token from localStorage");for(let i=0;i&lt;sessionStorage.length;i++){const key=sessionStorage.key(i);key&amp;&amp;key.includes("ace")&amp;&amp;sessionStorage.removeItem(key)}try{const dbs=await indexedDB.databases();for(const db2 of dbs)db2.name&amp;&amp;(db2.name.includes("firebase")||db2.name.includes("ace"))&amp;&amp;(await indexedDB.deleteDatabase(db2.name),console.log(`[TokenFix] Deleted IndexedDB: ${db2.name}`))}catch(e){console.warn("[TokenFix] Could not clear IndexedDB:",e)}store.dispatch(setAceToken({token:null})),store.dispatch(tokenLoadComplete()),console.log("[TokenFix] Cleared Redux state");try{const{clearApiCache:clearApiCache}=await __vitePreload(async()=&gt;{const{clearApiCache:clearApiCache2}=await import("./app-core-rH6lZf1X.js").then(n=&gt;n.ad);return{clearApiCache:clearApiCache2}},__vite__mapDeps([5,1,2,3,4,6,7,8,0,9]));clearApiCache&amp;&amp;clearApiCache()}catch(e){console.warn("[TokenFix] Could not clear API cache:",e)}return{success:!0,message:"Complete reset successful. Please reload the page."}}catch(error){return console.error("[TokenFix] Reset failed:",error),{success:!1,message:"Failed to reset token",details:error}}}async forceSaveToken(token){try{const user=auth.currentUser;if(!user)return{success:!1,message:"No authenticated user"};console.log("[TokenFix] Force saving token for user:",user.uid),await this.completeReset(),await new Promise(resolve=&gt;setTimeout(resolve,100));const{tokenService:tokenService}=await __vitePreload(async()=&gt;{const{tokenService:tokenService2}=await import("./app-core-rH6lZf1X.js").then(n=&gt;n.ae);return{tokenService:tokenService2}},__vite__mapDeps([5,1,2,3,4,6,7,8,0,9]));return await tokenService.saveToken(user.uid,token,!0)?(console.log("[TokenFix] Token saved successfully"),store.dispatch(setAceToken({token:token})),{success:!0,message:"Token saved successfully"}):{success:!1,message:"Failed to save token"}}catch(error){return console.error("[TokenFix] Force save failed:",error),{success:!1,message:"Failed to save token",details:error}}}async directSave(token){try{const user=auth.currentUser;if(!user)return{success:!1,message:"No authenticated user"};console.log("[TokenFix] Direct save for user:",user.uid);if(3!==token.trim().split(".").length)return{success:!1,message:"Invalid token format. Must be xxx.yyy.zzz"};const{encryptionService:encryptionService}=await __vitePreload(async()=&gt;{const{encryptionService:encryptionService2}=await import("./services-B0KkmCks.js").then(n=&gt;n.C);return{encryptionService:encryptionService2}},__vite__mapDeps([6,5,1,2,3,4,7,8,0,9])),encryptedToken=await encryptionService.encrypt(token.trim(),user.uid),tokenHash=await encryptionService.hashToken(token.trim());console.log("[TokenFix] Token encrypted, saving to Firestore...");const userDocRef=doc(db,"users",user.uid);await updateDoc(userDocRef,{aceJwtEncrypted:encryptedToken,aceJwtHash:tokenHash,aceJwtIsEncrypted:!0,aceJwtUpdatedAt:(new Date).toISOString(),aceJwtStorageLocation:"encrypted",aceJwt:null}),console.log("[TokenFix] Saved to Firestore, updating Redux..."),store.dispatch(setAceToken({token:token.trim()})),store.dispatch(tokenLoadComplete());try{const{secureStorage:secureStorage2}=await __vitePreload(async()=&gt;{const{secureStorage:secureStorage3}=await import("./services-B0KkmCks.js").then(n=&gt;n.D);return{secureStorage:secureStorage3}},__vite__mapDeps([6,5,1,2,3,4,7,8,0,9]));await secureStorage2.setAceToken(token.trim(),!0)}catch(e){console.warn("[TokenFix] Could not save to secure storage:",e)}return{success:!0,message:"Token saved directly to Firestore. Please reload the page."}}catch(error){return console.error("[TokenFix] Direct save failed:",error),{success:!1,message:"Failed to save token directly",details:error}}}async checkTokenState(){try{const user=auth.currentUser;if(!user)return{success:!1,message:"No authenticated user"};const userDocRef=doc(db,"users",user.uid),userData=(await getDoc(userDocRef)).data(),localTokens={};["ace_token_encrypted","ace_token","ace_token_exp","ace_jwt_secure"].forEach(key=&gt;{const value=localStorage.getItem(key);value&amp;&amp;(localTokens[key]=value.substring(0,20)+"...")});const reduxToken=store.getState().auth.aceToken;return{success:!0,message:"Token state check complete",details:{firestore:{hasEncryptedToken:!!(null==userData?void 0:userData.aceJwtEncrypted),isEncrypted:null==userData?void 0:userData.aceJwtIsEncrypted,storageLocation:null==userData?void 0:userData.aceJwtStorageLocation,updatedAt:null==userData?void 0:userData.aceJwtUpdatedAt},localStorage:localTokens,redux:{hasToken:!!reduxToken,tokenLength:null==reduxToken?void 0:reduxToken.length}}}}catch(error){return console.error("[TokenFix] State check failed:",error),{success:!1,message:"Failed to check token state",details:error}}}};"undefined"!=typeof window&amp;&amp;(window.tokenFix={reset:()=&gt;tokenFixUtils.completeReset(),save:token=&gt;tokenFixUtils.forceSaveToken(token),directSave:token=&gt;tokenFixUtils.directSave(token),check:()=&gt;tokenFixUtils.checkTokenState(),help:()=&gt;{console.log("\nToken Fix Utilities:\n====================\ntokenFix.reset()            - Complete reset of all token data\ntokenFix.save(token)        - Force save a new token with proper encryption\ntokenFix.directSave(token)  - Emergency direct save to Firestore (bypasses all checks)\ntokenFix.check()            - Check token state across all storage locations\n\nEmergency Fix Steps:\n1. Run: await tokenFix.reset()\n2. Reload the page (Ctrl+R or Cmd+R)\n3. Go to Settings → API Configuration\n4. Enter your ACE IoT token\n5. Save the token\n\nIf that doesn't work:\n1. Run: await tokenFix.check() to see current state\n2. Run: await tokenFix.directSave('your-token-here')\n3. Hard refresh: Ctrl+Shift+R (Windows) or Cmd+Shift+R (Mac)\n\nDirect Save Example:\nawait tokenFix.directSave('eyJhbGc...')\n      ")}},console.log("🔧 Token fix utilities loaded. Type tokenFix.help() for emergency fixes."));const tokenSaveDebugger=new class TokenSaveDebugger{constructor(){__publicField(this,"unsubscribe",null)}startMonitoring(){const user=auth.currentUser;if(!user)return void console.error("[TokenDebugger] No authenticated user");console.log("[TokenDebugger] Starting Firestore monitoring for user:",user.uid);const userDocRef=doc(db,"users",user.uid);this.unsubscribe=onSnapshot(userDocRef,snapshot=&gt;{var _a;if(snapshot.exists()){const data=snapshot.data();console.log("[TokenDebugger] Firestore document updated:",{hasEncryptedToken:!!data.aceJwtEncrypted,isEncrypted:data.aceJwtIsEncrypted,updatedAt:data.aceJwtUpdatedAt,storageLocation:data.aceJwtStorageLocation,encryptedTokenLength:null==(_a=data.aceJwtEncrypted)?void 0:_a.length,allFields:Object.keys(data).filter(key=&gt;key.includes("ace")||key.includes("jwt"))})}else console.error("[TokenDebugger] User document does not exist!")},error=&gt;{console.error("[TokenDebugger] Firestore listener error:",error)})}stopMonitoring(){this.unsubscribe&amp;&amp;(this.unsubscribe(),this.unsubscribe=null,console.log("[TokenDebugger] Stopped monitoring"))}async checkFirestore(){const user=auth.currentUser;if(user)try{const userDocRef=doc(db,"users",user.uid),snapshot=await getDoc(userDocRef);if(snapshot.exists()){const data=snapshot.data();console.log("[TokenDebugger] Current Firestore state:",{userId:user.uid,hasDocument:!0,hasEncryptedToken:!!data.aceJwtEncrypted,isEncrypted:data.aceJwtIsEncrypted,updatedAt:data.aceJwtUpdatedAt,storageLocation:data.aceJwtStorageLocation,tokenFields:Object.keys(data).filter(key=&gt;key.includes("ace")||key.includes("jwt"))}),data.aceJwtEncrypted&amp;&amp;console.log("[TokenDebugger] Encrypted token preview:",data.aceJwtEncrypted.substring(0,50)+"...")}else console.error("[TokenDebugger] User document does not exist in Firestore!")}catch(error){console.error("[TokenDebugger] Error checking Firestore:",error)}else console.error("[TokenDebugger] No authenticated user")}async traceSave(token){console.log("[TokenDebugger] === STARTING TOKEN SAVE TRACE ==="),console.log("[TokenDebugger] Token format check:",{length:token.length,parts:token.split(".").length,startsWithEy:token.startsWith("ey")}),this.startMonitoring(),console.log("[TokenDebugger] Checking initial Firestore state..."),await this.checkFirestore();try{const{tokenService:tokenService}=await __vitePreload(async()=&gt;{const{tokenService:tokenService2}=await import("./app-core-rH6lZf1X.js").then(n=&gt;n.ae);return{tokenService:tokenService2}},__vite__mapDeps([5,1,2,3,4,6,7,8,0,9])),user=auth.currentUser;if(!user)return void console.error("[TokenDebugger] No authenticated user");console.log("[TokenDebugger] Calling tokenService.saveToken...");const result=await tokenService.saveToken(user.uid,token,!0);console.log("[TokenDebugger] Save result:",result),console.log("[TokenDebugger] Checking final Firestore state..."),await this.checkFirestore(),setTimeout(()=&gt;{console.log("[TokenDebugger] Final check after 2 seconds..."),this.checkFirestore()},2e3)}catch(error){console.error("[TokenDebugger] Save failed:",error)}console.log("[TokenDebugger] === TOKEN SAVE TRACE COMPLETE ===")}};"undefined"!=typeof window&amp;&amp;(window.tokenDebug={...window.tokenDebug,startMonitoring:()=&gt;tokenSaveDebugger.startMonitoring(),stopMonitoring:()=&gt;tokenSaveDebugger.stopMonitoring(),checkFirestore:()=&gt;tokenSaveDebugger.checkFirestore(),traceSave:token=&gt;tokenSaveDebugger.traceSave(token)},console.log("🔍 Token save debugger loaded. Available commands:"),console.log("tokenDebug.startMonitoring() - Monitor Firestore changes"),console.log("tokenDebug.checkFirestore() - Check current Firestore state"),console.log("tokenDebug.traceSave(token) - Trace a full save operation")),window.clearCorruptedToken=async function clearCorruptedToken(){try{const user=auth.currentUser;if(!user)return console.error("No authenticated user"),{success:!1,message:"Please log in first"};console.log("Clearing corrupted token for user:",user.uid);const userRef=doc(db,"users",user.uid),userDoc=await getDoc(userRef);if(userDoc.exists()){const data=userDoc.data();console.log("Current Firestore state:",{hasEncryptedToken:!!data.aceJwtEncrypted,isEncrypted:data.aceJwtIsEncrypted,hasPlainToken:!!data.aceJwt}),await updateDoc(userRef,{aceJwt:null,aceJwtEncrypted:null,aceJwtHash:null,aceJwtIsEncrypted:!1,aceJwtUpdatedAt:(new Date).toISOString(),aceJwtExpiresAt:null,aceJwtStorageLocation:null}),console.log("✅ Cleared token from Firestore")}return secureStorage.clearAceToken(),console.log("✅ Cleared token from secure storage"),store.dispatch(setAceToken({token:null})),console.log("✅ Cleared token from Redux"),localStorage.removeItem("aceToken"),localStorage.removeItem("encryptedAceToken"),console.log("✅ Cleared token from localStorage"),sessionStorage.removeItem("aceToken"),sessionStorage.removeItem("encryptedAceToken"),console.log("✅ Cleared token from sessionStorage"),console.log("✅ Successfully cleared all corrupted token data"),console.log("You can now add a new token in Settings"),{success:!0,message:"Corrupted token cleared. Please refresh the page and add a new token in Settings."}}catch(error){return console.error("Failed to clear corrupted token:",error),{success:!1,message:error instanceof Error?error.message:"Unknown error occurred"}}},console.log("Corrupted token cleaner loaded. Run clearCorruptedToken() to remove corrupted tokens."),window.clearTokenForMigration=async function clearTokenForMigration(){var _a;try{const user=auth.currentUser;if(!user)return console.error("No authenticated user"),{success:!1,message:"Please log in first"};console.log("Clearing token data for migration to simplified storage...");const userRef=doc(db,"users",user.uid);(await getDoc(userRef)).exists()&amp;&amp;(await updateDoc(userRef,{aceJwt:null,aceJwtEncrypted:null,aceJwtHash:null,aceJwtIsEncrypted:!1,aceJwtUpdatedAt:(new Date).toISOString(),aceJwtExpiresAt:null,aceJwtStorageLocation:null}),console.log("✅ Cleared all token fields from Firestore")),secureStorage.clearAceToken(),console.log("✅ Cleared token from secure storage"),store.dispatch(setAceToken({token:null})),console.log("✅ Cleared token from Redux"),localStorage.removeItem("aceToken"),localStorage.removeItem("encryptedAceToken"),sessionStorage.removeItem("aceToken"),sessionStorage.removeItem("encryptedAceToken");try{const databases=await indexedDB.databases();for(const db2 of databases)(null==(_a=db2.name)?void 0:_a.includes("token"))&amp;&amp;indexedDB.deleteDatabase(db2.name)}catch(e){}return console.log("✅ Cleared token from all browser storage"),console.log("\n✅ Token migration preparation complete!"),console.log("Please refresh the page and add your token again."),console.log("The new system will store it without encryption for better reliability."),{success:!0,message:"Token cleared successfully. Please refresh and add your token again."}}catch(error){return console.error("Failed to clear token:",error),{success:!1,message:error instanceof Error?error.message:"Unknown error occurred"}}},console.log("Token migration utility loaded. Run clearTokenForMigration() to prepare for the new token system."),window.clearInvalidToken=async function clearInvalidToken(){if(auth.currentUser)try{const userRef=doc(db,"users",auth.currentUser.uid);await updateDoc(userRef,{aceJwt:null}),localStorage.removeItem("aceIotApiToken"),sessionStorage.removeItem("aceIotApiToken"),console.log("✓ Invalid token cleared. Please refresh the page."),console.log("Then go to Settings to configure a valid ACE API token."),setTimeout(()=&gt;{window.location.reload()},2e3)}catch(error){console.error("Failed to clear token:",error)}else console.error("No user logged in")},console.log("🔧 Token cleanup utility loaded"),console.log("Run clearInvalidToken() to remove invalid tokens and refresh");var CircuitState=(CircuitState2=&gt;(CircuitState2.CLOSED="CLOSED",CircuitState2.OPEN="OPEN",CircuitState2.HALF_OPEN="HALF_OPEN",CircuitState2))(CircuitState||{});class CircuitBreaker{constructor(options={}){__publicField(this,"state","CLOSED"),__publicField(this,"failureCount",0),__publicField(this,"successCount",0),__publicField(this,"lastFailureTime",null),__publicField(this,"halfOpenTestInProgress",!1),__publicField(this,"options"),this.options={failureThreshold:5,resetTimeout:6e4,successThreshold:3,monitoringPeriod:3e5,...options}}async execute(fn){if("OPEN"===this.state){if(!this.shouldAttemptReset())throw new Error("Circuit breaker is OPEN - service unavailable");this.state="HALF_OPEN",this.halfOpenTestInProgress=!0}try{const result=await fn();return this.onSuccess(),result}catch(error){throw this.onFailure(),error}}shouldAttemptReset(){return null!==this.lastFailureTime&amp;&amp;Date.now()-this.lastFailureTime&gt;=this.options.resetTimeout}onSuccess(){this.failureCount=0,"HALF_OPEN"===this.state&amp;&amp;(this.successCount++,this.successCount&gt;=this.options.successThreshold&amp;&amp;(this.state="CLOSED",this.successCount=0,this.halfOpenTestInProgress=!1))}onFailure(){this.failureCount++,this.lastFailureTime=Date.now(),"HALF_OPEN"===this.state?(this.state="OPEN",this.successCount=0,this.halfOpenTestInProgress=!1):"CLOSED"===this.state&amp;&amp;this.failureCount&gt;=this.options.failureThreshold&amp;&amp;(this.state="OPEN")}getState(){return this.state}reset(){this.state="CLOSED",this.failureCount=0,this.successCount=0,this.lastFailureTime=null,this.halfOpenTestInProgress=!1}getStats(){return{state:this.state,failureCount:this.failureCount,successCount:this.successCount,lastFailureTime:this.lastFailureTime,halfOpenTestInProgress:this.halfOpenTestInProgress}}}const apiCircuitBreaker=new CircuitBreaker({failureThreshold:5,resetTimeout:3e4,successThreshold:3});new CircuitBreaker({failureThreshold:3,resetTimeout:6e4,successThreshold:2}),new CircuitBreaker({failureThreshold:10,resetTimeout:2e4,successThreshold:5});let autoResetInterval=null;function stopAutoReset(){autoResetInterval&amp;&amp;(clearInterval(autoResetInterval),autoResetInterval=null)}function enableChartDebugMode(){"undefined"!=typeof window&amp;&amp;(window.chartDebugEnabled=!0,window.enableChartDebug=enableChartDebugMode,window.disableChartDebug=disableChartDebugMode)}function disableChartDebugMode(){"undefined"!=typeof window&amp;&amp;(window.chartDebugEnabled=!1)}!function startAutoReset(){autoResetInterval&amp;&amp;clearInterval(autoResetInterval),autoResetInterval=setInterval(()=&gt;{"OPEN"===apiCircuitBreaker.getState()&amp;&amp;apiCircuitBreaker.reset()},5e3)}(),"undefined"!=typeof window&amp;&amp;(window.resetCircuitBreaker=function resetCircuitBreaker$1(){return apiCircuitBreaker.reset(),!0},window.stopCircuitBreakerAutoReset=stopAutoReset,window.addEventListener("beforeunload",stopAutoReset)),"undefined"!=typeof window&amp;&amp;(window.clearBrowserCache=async function clearBrowserCache(){var _a;if("indexedDB"in window)try{const databases=await indexedDB.databases();for(const db2 of databases)(null==(_a=db2.name)?void 0:_a.includes("cache"))&amp;&amp;await indexedDB.deleteDatabase(db2.name)}catch(error){}try{const keysToRemove=[];for(let i=0;i&lt;localStorage.length;i++){const key=localStorage.key(i);key&amp;&amp;(key.includes("cache")||key.includes("sites")||key.includes("points"))&amp;&amp;keysToRemove.push(key)}keysToRemove.forEach(key=&gt;{localStorage.removeItem(key)})}catch(error){}try{sessionStorage.clear()}catch(error){}if("caches"in window)try{const cacheNames=await caches.keys();await Promise.all(cacheNames.map(cacheName=&gt;caches.delete(cacheName)))}catch(error){}}),"undefined"!=typeof window&amp;&amp;(window.checkFirebaseAuth=async function checkFirebaseAuth(){const currentUser=auth.currentUser;return onAuthStateChanged(auth,user=&gt;{}),currentUser},window.testLogin=async function testLogin(email,password){try{const userCredential=await signInWithEmailAndPassword(auth,email,password);return await userCredential.user.getIdToken(),userCredential.user}catch(error){throw error.code,error}});const cleanupStuckOverlays=()=&gt;{let removedCount=0;document.querySelectorAll("body &gt; div:not(#root)");document.querySelectorAll("body &gt; div:not(#root)").forEach(element=&gt;{const div=element,computedStyle=window.getComputedStyle(div),rect=div.getBoundingClientRect();computedStyle.backgroundColor.includes("rgba")||computedStyle.backgroundColor.includes("rgb")||computedStyle.opacity;const isFullViewportOverlay="fixed"===computedStyle.position&amp;&amp;("0px"===computedStyle.inset||"0px"===computedStyle.top&amp;&amp;"0px"===computedStyle.left&amp;&amp;"0px"===computedStyle.right&amp;&amp;"0px"===computedStyle.bottom)&amp;&amp;rect.width&gt;=window.innerWidth-10&amp;&amp;rect.height&gt;=window.innerHeight-10,isBackdrop=div.style.cssText.includes("inset: 0")&amp;&amp;!div.querySelector(".MuiIconButton-root")&amp;&amp;!div.querySelector(".MuiSpeedDial-root");(isFullViewportOverlay||isBackdrop)&amp;&amp;(div.remove(),removedCount++)});document.querySelectorAll(".MuiBackdrop-root").forEach(backdrop=&gt;{const parent=backdrop.parentElement,hasActiveModal=null==parent?void 0:parent.querySelector('[role="dialog"]:not([aria-hidden="true"])'),hasActiveDrawer=null==parent?void 0:parent.querySelector(".MuiDrawer-paper");hasActiveModal||hasActiveDrawer||backdrop.parentElement!==document.body||(backdrop.remove(),removedCount++)});document.querySelectorAll(".MuiModal-root").forEach(modal=&gt;{modal.parentElement!==document.body||modal.querySelector('[role="dialog"]:not([aria-hidden="true"])')||(modal.remove(),removedCount++)});document.querySelectorAll(".MuiBackdrop-invisible").forEach(backdrop=&gt;{backdrop.remove(),removedCount++});const root=document.getElementById("root");return root&amp;&amp;(root.style.pointerEvents="auto",root.style.position="relative",root.style.zIndex="1",root.style.isolation="isolate"),document.body.style.pointerEvents="auto",document.body.style.overflow="auto",removedCount&gt;0&amp;&amp;console.log(`[cleanupOverlays] Removed ${removedCount} stuck overlays`),removedCount};function enhancePointWithKvTags(point){var _a,_b,_c;if(point._enhanced)return point;const enhanced={...point},kvTag=function parseKvTags(kvTagsString){if(!kvTagsString||"[]"===kvTagsString)return null;try{if(Array.isArray(kvTagsString))return 0===kvTagsString.length?null:kvTagsString[0];if("object"==typeof kvTagsString&amp;&amp;null!==kvTagsString)return kvTagsString;if("string"==typeof kvTagsString){const kvArray=JSON.parse(kvTagsString);return Array.isArray(kvArray)&amp;&amp;0!==kvArray.length?kvArray[0]:null}return null}catch(error){return console.error("Failed to parse KV tags:",error,"Input type:",typeof kvTagsString),null}}(point["Kv Tags"]||point.kv_tags||point.kvTags||""),equipment=function extractEquipmentFromName(name){if(!name)return{};if(name.includes("/weather/"))return{type:"weather",pointName:name.split("/").pop()||""};const pathParts=name.split("/"),parts=pathParts[pathParts.length-1].split(".");if(parts.length&lt;2)return{};const pointsIndex=parts.indexOf("points");if(pointsIndex&gt;0&amp;&amp;pointsIndex&lt;parts.length-1){const equipmentPart=parts[pointsIndex-1],pointName=parts[pointsIndex+1],equipmentMatch=equipmentPart.match(/^([A-Za-z]+)(\d+)?(?:[-_](\d+))?/i);return equipmentMatch?{type:equipmentMatch[1].toLowerCase(),id:equipmentMatch[2]||equipmentMatch[3]||"",pointName:pointName}:{type:equipmentPart.toLowerCase(),pointName:pointName}}return{}}(point.Name||point.name||"");if(enhanced.display_name=function generateDisplayName$1(kvTag,pointName,equipment){if(null==kvTag?void 0:kvTag.dis){let displayName=kvTag.dis;if(displayName=displayName.replace(/([a-z])([A-Z])/g,"$1 $2"),displayName=displayName.replace(/^Da/i,"Discharge Air").replace(/^Ra/i,"Return Air").replace(/^Sa/i,"Supply Air").replace(/^Oa/i,"Outside Air").replace(/^Ma/i,"Mixed Air").replace(/Temp$/i,"Temperature").replace(/Setpt$/i,"Setpoint").replace(/Fpm$/i,"Velocity").replace(/Rh/i,"Reheat").replace(/Act/i,"Actual"),null==equipment?void 0:equipment.type){const equipName={rtu:"RTU",vav:"VAV",ahu:"AHU",mstp:"MSTP"}[equipment.type]||equipment.type.toUpperCase(),equipId=equipment.id||"";displayName.includes(equipName)||(displayName=`${equipName}${equipId?"-"+equipId:""} ${displayName}`)}return displayName}if("weather"===(null==equipment?void 0:equipment.type)){const weatherMetric=pointName||"";if(weatherMetric)return`Weather: ${weatherMetric.replace(/_/g," ").replace(/\b\w/g,l=&gt;l.toUpperCase())}`}return pointName?pointName.replace(/([a-z])([A-Z])/g,"$1 $2").replace(/_/g," ").replace(/-/g," "):"Unknown Point"}(kvTag,equipment.pointName||"",equipment),(null==kvTag?void 0:kvTag.unit)&amp;&amp;(enhanced.unit=kvTag.unit.replace("degree_Fahrenheit","°F").replace("degree_Celsius","°C").replace("percent","%").replace("percent_relative_humidity","%RH").replace("cubic_feet_per_minute","CFM").replace("foot / minute","ft/min").replace("ft/min","FPM")),null==kvTag?void 0:kvTag.curVal){const valMatch=kvTag.curVal.match(/^([\d.-]+)/);valMatch?enhanced.value=parseFloat(valMatch[1]):"True"!==kvTag.curVal&amp;&amp;"False"!==kvTag.curVal||(enhanced.value="True"===kvTag.curVal?1:0)}return equipment.type&amp;&amp;(enhanced.equipment=equipment.type,enhanced.equipmentType=equipment.type.toUpperCase()),(null==(_a=null==kvTag?void 0:kvTag.dis)?void 0:_a.toLowerCase().includes("setpt"))||(null==(_b=null==kvTag?void 0:kvTag.dis)?void 0:_b.toLowerCase().includes("setpoint"))?enhanced.pointFunction="sp":("Bool"===(null==kvTag?void 0:kvTag.kind)&amp;&amp;(null==(_c=null==kvTag?void 0:kvTag.dis)||_c.toLowerCase().includes("status")),enhanced.pointFunction="sensor"),enhanced.marker_tags=function generateMarkerTags$1(kvTag,equipment,pointName){var _a,_b,_c,_d,_e,_f,_g;const tags=new Set(["point"]);if(kvTag){"Number"===kvTag.kind&amp;&amp;tags.add("number"),"Bool"===kvTag.kind&amp;&amp;tags.add("bool"),"Str"===kvTag.kind&amp;&amp;tags.add("string"),((null==(_a=kvTag.unit)?void 0:_a.includes("°F"))||(null==(_b=kvTag.unit)?void 0:_b.includes("°C")))&amp;&amp;(tags.add("temp"),tags.add("sensor")),"%"===kvTag.unit&amp;&amp;((null==(_c=kvTag.dis)?void 0:_c.toLowerCase().includes("damper"))&amp;&amp;tags.add("damper"),(null==(_d=kvTag.dis)?void 0:_d.toLowerCase().includes("valve"))&amp;&amp;tags.add("valve"),(null==(_e=kvTag.dis)?void 0:_e.toLowerCase().includes("signal"))&amp;&amp;tags.add("signal"),tags.add("position")),"cfm"===kvTag.unit&amp;&amp;(tags.add("flow"),tags.add("air")),"gpm"===kvTag.unit&amp;&amp;(tags.add("flow"),tags.add("water")),"%RH"===kvTag.unit&amp;&amp;(tags.add("humidity"),tags.add("sensor")),(null==(_f=kvTag.unit)?void 0:_f.includes("ft/min"))&amp;&amp;(tags.add("velocity"),tags.add("air"));const disLower=(null==(_g=kvTag.dis)?void 0:_g.toLowerCase())||"";(disLower.includes("setpt")||disLower.includes("setpoint"))&amp;&amp;(tags.add("sp"),tags.add("writable")),disLower.includes("status")&amp;&amp;tags.add("status"),disLower.includes("mode")&amp;&amp;tags.add("mode"),disLower.includes("occ")&amp;&amp;tags.add("occupied"),disLower.includes("heat")&amp;&amp;tags.add("heat"),disLower.includes("cool")&amp;&amp;tags.add("cool"),disLower.includes("fan")&amp;&amp;tags.add("fan"),"overridden"===kvTag.axStatus&amp;&amp;tags.add("overridden")}(null==equipment?void 0:equipment.type)&amp;&amp;({rtu:["rtu","hvac","rooftop"],vav:["vav","hvac","terminal"],ahu:["ahu","hvac"],mstp:["mstp","network"]}[equipment.type]||[equipment.type]).forEach(t=&gt;tags.add(t));if(pointName){const nameLower=pointName.toLowerCase();(nameLower.includes("da")||nameLower.includes("discharge"))&amp;&amp;tags.add("discharge"),(nameLower.includes("ra")||nameLower.includes("return"))&amp;&amp;tags.add("return"),(nameLower.includes("sa")||nameLower.includes("supply"))&amp;&amp;tags.add("supply"),(nameLower.includes("oa")||nameLower.includes("outside"))&amp;&amp;tags.add("outside")}return Array.from(tags)}(kvTag,equipment,equipment.pointName||""),enhanced.status=(null==kvTag?void 0:kvTag.axStatus)||(null==kvTag?void 0:kvTag.curStatus)||"ok",(null==kvTag?void 0:kvTag.precision)&amp;&amp;(enhanced.precision=parseFloat(kvTag.precision)),enhanced.timezone=null==kvTag?void 0:kvTag.tz,enhanced.ai_insights=function generateAIInsights$1(kvTag,equipment){var _a,_b,_c,_d,_e,_f,_g,_h,_i;const insights={recommendations:[],patterns:{}};if(!kvTag)return insights;if(null==(_a=kvTag.unit)?void 0:_a.includes("°F")){const disLower=(null==(_b=kvTag.dis)?void 0:_b.toLowerCase())||"";(disLower.includes("room")||disLower.includes("zone"))&amp;&amp;(insights.recommendations.push("Monitor for ASHRAE 55 comfort compliance (68-76°F)"),insights.patterns.comfort_zone={min:68,max:76,unit:"°F"}),disLower.includes("supply")&amp;&amp;insights.recommendations.push("Typical supply air: 55-60°F cooling, 90-110°F heating"),disLower.includes("discharge")&amp;&amp;insights.recommendations.push("Monitor discharge air temperature for proper conditioning")}if("cfm"===kvTag.unit&amp;&amp;(insights.recommendations.push("Monitor airflow for ventilation requirements"),(null==(_c=kvTag.dis)?void 0:_c.toLowerCase().includes("setpt"))&amp;&amp;insights.recommendations.push("Verify setpoint meets minimum ventilation standards")),"%"===kvTag.unit&amp;&amp;((null==(_d=kvTag.dis)?void 0:_d.toLowerCase().includes("damper"))||(null==(_e=kvTag.dis)?void 0:_e.toLowerCase().includes("valve")))){const currentVal=parseFloat(kvTag.curVal||"0");currentVal&gt;90?insights.recommendations.push("Near full open - equipment may be undersized"):currentVal&lt;10&amp;&amp;insights.recommendations.push("Near closed - verify minimum position requirements"),insights.recommendations.push("Monitor for hunting or oscillation")}return"%RH"===kvTag.unit&amp;&amp;(insights.recommendations.push("ASHRAE 55 recommends 30-60% RH for comfort"),insights.patterns.comfort_zone={min:30,max:60,unit:"%RH"}),"vav"===(null==equipment?void 0:equipment.type)&amp;&amp;((null==(_f=kvTag.dis)?void 0:_f.toLowerCase().includes("damper"))&amp;&amp;insights.recommendations.push("Ensure minimum ventilation position is maintained"),(null==(_g=kvTag.dis)?void 0:_g.toLowerCase().includes("heat"))&amp;&amp;(null==(_h=kvTag.dis)?void 0:_h.toLowerCase().includes("valve"))&amp;&amp;insights.recommendations.push("Monitor reheat valve for energy efficiency")),"rtu"===(null==equipment?void 0:equipment.type)&amp;&amp;(null==(_i=kvTag.dis)?void 0:_i.toLowerCase().includes("fan"))&amp;&amp;insights.recommendations.push("Monitor fan status for proper operation"),insights}(kvTag,equipment),enhanced.quality_score=function calculateQualityScore$1(enhanced){var _a;let score=0;return enhanced.display_name&amp;&amp;enhanced.display_name!==enhanced.Name&amp;&amp;(score+=25),enhanced.unit&amp;&amp;(score+=20),(enhanced.equipment||enhanced.equipmentType)&amp;&amp;(score+=20),enhanced.marker_tags&amp;&amp;enhanced.marker_tags.length&gt;3&amp;&amp;(score+=20),(null==(_a=enhanced.ai_insights)?void 0:_a.recommendations)&amp;&amp;enhanced.ai_insights.recommendations.length&gt;0&amp;&amp;(score+=15),score}(enhanced),enhanced._enhanced=!0,enhanced._enhancedAt=(new Date).toISOString(),enhanced}function hasKvTags(point){const kvTags=point["Kv Tags"]||point.kv_tags||point.kvTags;return kvTags&amp;&amp;"[]"!==kvTags&amp;&amp;""!==kvTags}window.cleanupOverlays=cleanupStuckOverlays,"undefined"!=typeof document&amp;&amp;document.addEventListener("visibilitychange",()=&gt;{document.hidden||setTimeout(cleanupStuckOverlays,100)});const iconCache=new Map;reactExports.lazy(()=&gt;__vitePreload(()=&gt;import("./vendor-CFMRQ_Yt.js").then(n=&gt;n.eo),__vite__mapDeps([1,2,3,4]))),reactExports.lazy(()=&gt;__vitePreload(()=&gt;import("./vendor-CFMRQ_Yt.js").then(n=&gt;n.eB),__vite__mapDeps([1,2,3,4]))),reactExports.lazy(()=&gt;__vitePreload(()=&gt;import("./vendor-CFMRQ_Yt.js").then(n=&gt;n.ep),__vite__mapDeps([1,2,3,4]))),reactExports.lazy(()=&gt;__vitePreload(()=&gt;import("./vendor-CFMRQ_Yt.js").then(n=&gt;n.ew),__vite__mapDeps([1,2,3,4]))),reactExports.lazy(()=&gt;__vitePreload(()=&gt;import("./vendor-CFMRQ_Yt.js").then(n=&gt;n.eq),__vite__mapDeps([1,2,3,4]))),reactExports.lazy(()=&gt;__vitePreload(()=&gt;import("./vendor-CFMRQ_Yt.js").then(n=&gt;n.ez),__vite__mapDeps([1,2,3,4]))),reactExports.lazy(()=&gt;__vitePreload(()=&gt;import("./vendor-CFMRQ_Yt.js").then(n=&gt;n.eI),__vite__mapDeps([1,2,3,4]))),reactExports.lazy(()=&gt;__vitePreload(()=&gt;import("./vendor-CFMRQ_Yt.js").then(n=&gt;n.es),__vite__mapDeps([1,2,3,4]))),reactExports.lazy(()=&gt;__vitePreload(()=&gt;import("./vendor-CFMRQ_Yt.js").then(n=&gt;n.eA),__vite__mapDeps([1,2,3,4]))),reactExports.lazy(()=&gt;__vitePreload(()=&gt;import("./vendor-CFMRQ_Yt.js").then(n=&gt;n.eN),__vite__mapDeps([1,2,3,4]))),reactExports.lazy(()=&gt;__vitePreload(()=&gt;import("./vendor-CFMRQ_Yt.js").then(n=&gt;n.eH),__vite__mapDeps([1,2,3,4]))),reactExports.lazy(()=&gt;__vitePreload(()=&gt;import("./vendor-CFMRQ_Yt.js").then(n=&gt;n.eF),__vite__mapDeps([1,2,3,4]))),reactExports.lazy(()=&gt;__vitePreload(()=&gt;import("./vendor-CFMRQ_Yt.js").then(n=&gt;n.eu),__vite__mapDeps([1,2,3,4]))),reactExports.lazy(()=&gt;__vitePreload(()=&gt;import("./vendor-CFMRQ_Yt.js").then(n=&gt;n.ev),__vite__mapDeps([1,2,3,4])));const iconImportMap={ExpandMore:()=&gt;__vitePreload(()=&gt;import("./vendor-CFMRQ_Yt.js").then(n=&gt;n.eo),__vite__mapDeps([1,2,3,4])),ExpandLess:()=&gt;__vitePreload(()=&gt;import("./vendor-CFMRQ_Yt.js").then(n=&gt;n.eB),__vite__mapDeps([1,2,3,4])),Refresh:()=&gt;__vitePreload(()=&gt;import("./vendor-CFMRQ_Yt.js").then(n=&gt;n.ep),__vite__mapDeps([1,2,3,4])),Close:()=&gt;__vitePreload(()=&gt;import("./vendor-CFMRQ_Yt.js").then(n=&gt;n.ew),__vite__mapDeps([1,2,3,4])),Add:()=&gt;__vitePreload(()=&gt;import("./vendor-CFMRQ_Yt.js").then(n=&gt;n.eq),__vite__mapDeps([1,2,3,4])),Delete:()=&gt;__vitePreload(()=&gt;import("./vendor-CFMRQ_Yt.js").then(n=&gt;n.ez),__vite__mapDeps([1,2,3,4])),Settings:()=&gt;__vitePreload(()=&gt;import("./vendor-CFMRQ_Yt.js").then(n=&gt;n.eI),__vite__mapDeps([1,2,3,4])),CheckCircle:()=&gt;__vitePreload(()=&gt;import("./vendor-CFMRQ_Yt.js").then(n=&gt;n.es),__vite__mapDeps([1,2,3,4])),Error:()=&gt;__vitePreload(()=&gt;import("./vendor-CFMRQ_Yt.js").then(n=&gt;n.eA),__vite__mapDeps([1,2,3,4])),Warning:()=&gt;__vitePreload(()=&gt;import("./vendor-CFMRQ_Yt.js").then(n=&gt;n.eN),__vite__mapDeps([1,2,3,4])),Search:()=&gt;__vitePreload(()=&gt;import("./vendor-CFMRQ_Yt.js").then(n=&gt;n.eH),__vite__mapDeps([1,2,3,4])),Menu:()=&gt;__vitePreload(()=&gt;import("./vendor-CFMRQ_Yt.js").then(n=&gt;n.eF),__vite__mapDeps([1,2,3,4])),ChevronLeft:()=&gt;__vitePreload(()=&gt;import("./vendor-CFMRQ_Yt.js").then(n=&gt;n.eu),__vite__mapDeps([1,2,3,4])),ChevronRight:()=&gt;__vitePreload(()=&gt;import("./vendor-CFMRQ_Yt.js").then(n=&gt;n.ev),__vite__mapDeps([1,2,3,4])),Dashboard:()=&gt;__vitePreload(()=&gt;import("./vendor-CFMRQ_Yt.js").then(n=&gt;n.ex),__vite__mapDeps([1,2,3,4])),ShowChart:()=&gt;__vitePreload(()=&gt;import("./vendor-CFMRQ_Yt.js").then(n=&gt;n.eJ),__vite__mapDeps([1,2,3,4])),TrendingUp:()=&gt;__vitePreload(()=&gt;import("./vendor-CFMRQ_Yt.js").then(n=&gt;n.eM),__vite__mapDeps([1,2,3,4])),TrendingDown:()=&gt;__vitePreload(()=&gt;import("./vendor-CFMRQ_Yt.js").then(n=&gt;n.eL),__vite__mapDeps([1,2,3,4])),DateRange:()=&gt;__vitePreload(()=&gt;import("./vendor-CFMRQ_Yt.js").then(n=&gt;n.ey),__vite__mapDeps([1,2,3,4])),Timeline:()=&gt;__vitePreload(()=&gt;import("./vendor-CFMRQ_Yt.js").then(n=&gt;n.eK),__vite__mapDeps([1,2,3,4])),BarChart:()=&gt;__vitePreload(()=&gt;import("./vendor-CFMRQ_Yt.js").then(n=&gt;n.er),__vite__mapDeps([1,2,3,4])),PieChart:()=&gt;__vitePreload(()=&gt;import("./vendor-CFMRQ_Yt.js").then(n=&gt;n.eG),__vite__mapDeps([1,2,3,4])),ErrorOutline:()=&gt;__vitePreload(()=&gt;import("./vendor-CFMRQ_Yt.js").then(n=&gt;n.en),__vite__mapDeps([1,2,3,4])),WarningAmber:()=&gt;__vitePreload(()=&gt;import("./vendor-CFMRQ_Yt.js").then(n=&gt;n.eO),__vite__mapDeps([1,2,3,4])),CheckCircleOutline:()=&gt;__vitePreload(()=&gt;import("./vendor-CFMRQ_Yt.js").then(n=&gt;n.et),__vite__mapDeps([1,2,3,4])),Info:()=&gt;__vitePreload(()=&gt;import("./vendor-CFMRQ_Yt.js").then(n=&gt;n.eD),__vite__mapDeps([1,2,3,4])),InfoOutlined:()=&gt;__vitePreload(()=&gt;import("./vendor-CFMRQ_Yt.js").then(n=&gt;n.eE),__vite__mapDeps([1,2,3,4])),HourglassEmpty:()=&gt;__vitePreload(()=&gt;import("./vendor-CFMRQ_Yt.js").then(n=&gt;n.eC),__vite__mapDeps([1,2,3,4])),Wifi:()=&gt;__vitePreload(()=&gt;import("./vendor-CFMRQ_Yt.js").then(n=&gt;n.eP),__vite__mapDeps([1,2,3,4])),WifiOff:()=&gt;__vitePreload(()=&gt;import("./vendor-CFMRQ_Yt.js").then(n=&gt;n.eQ),__vite__mapDeps([1,2,3,4]))};async function preloadCriticalIcons(){await Promise.all(["Menu","Dashboard","Settings","Search","Refresh"].map(iconName=&gt;async function loadIcon(iconName){if(iconCache.has(iconName))return iconCache.get(iconName);try{const importFn=iconImportMap[iconName];if(importFn){const IconComponent2=(await importFn()).default;return iconCache.set(iconName,IconComponent2),IconComponent2}const module=await __vitePreload(()=&gt;import(`@mui/icons-material/${iconName}`),[]),IconComponent=module.default||module[iconName];return iconCache.set(iconName,IconComponent),IconComponent}catch(error){return()=&gt;null}}(iconName)))}async function cleanupUserTokenData(){try{const currentUser=auth.currentUser;if(!currentUser)return{success:!1,message:"No authenticated user"};const userDocRef=doc(db,"users",currentUser.uid);if(await updateDoc(userDocRef,{aceJwtEncrypted:deleteField(),aceJwtIsEncrypted:deleteField(),aceJwtUpdatedAt:deleteField(),aceJwt:deleteField(),aceToken:deleteField(),token:deleteField(),lastCleanup:serverTimestamp()}),localStorage.removeItem("aceToken"),localStorage.removeItem("encryptedToken"),localStorage.removeItem("aceJwt"),sessionStorage.clear(),"indexedDB"in window){const databases=await indexedDB.databases();for(const db2 of databases)db2.name&amp;&amp;(db2.name.includes("token")||db2.name.includes("ace"))&amp;&amp;indexedDB.deleteDatabase(db2.name)}const{default:store2}=await __vitePreload(async()=&gt;{const{default:store3}=await import("./app-core-rH6lZf1X.js").then(n=&gt;n.ab);return{default:store3}},__vite__mapDeps([5,1,2,3,4,6,7,8,0,9])),{setAceToken:setAceToken2}=await __vitePreload(async()=&gt;{const{setAceToken:setAceToken3}=await import("./app-core-rH6lZf1X.js").then(n=&gt;n.aa);return{setAceToken:setAceToken3}},__vite__mapDeps([5,1,2,3,4,6,7,8,0,9]));return store2.dispatch(setAceToken2({token:null,expiresAt:null})),{success:!0,message:"Successfully cleaned up all token data. Please enter your token again in Settings."}}catch(error){return{success:!1,message:error instanceof Error?error.message:"Cleanup failed"}}}"undefined"!=typeof window&amp;&amp;(window.debugTokenIssue=async function debugTokenIssue(){try{const currentUser=auth.currentUser;if(!currentUser)return;const userDoc=await getDoc(doc(db,"users",currentUser.uid));if(!userDoc.exists())return;const userData=userDoc.data();if(userData.aceJwtEncrypted&amp;&amp;userData.aceJwtIsEncrypted);else if(userData.aceJwt)try{const parts=userData.aceJwt.split(".");if(3===parts.length){const payload=JSON.parse(atob(parts[1]));new Date(1e3*payload.exp)}}catch(e){}store.getState();const apiService=getApiService(),tokenService=getTokenService(),storedToken=await tokenService.getToken(currentUser.uid);storedToken&amp;&amp;await tokenService.validateToken(currentUser.uid,storedToken);try{await apiService.fetchSites()}catch(error){}}catch(error){}}),setTimeout(()=&gt;{(async()=&gt;{if(auth.currentUser){store.getState().auth.aceToken}})()},5e3),"undefined"!=typeof window&amp;&amp;(window.debugTokenStorage=async function debugTokenStorage(){try{const currentUser=auth.currentUser;if(!currentUser)return;const userDoc=await getDoc(doc(db,"users",currentUser.uid));if(!userDoc.exists())return;const userData=userDoc.data();userData.aceJwt,userData.aceJwtEncrypted,userData.aceJwtIsEncrypted;try{secureStorage.setUserId(currentUser.uid),await secureStorage.getAceToken()}catch(error){}const tokenService=getTokenService();await tokenService.getToken(currentUser.uid),getApiService();try{await currentUser.getIdToken()}catch(error){}}catch(error){}},window.migrateTokenToEncrypted=async function migrateTokenToEncrypted(){try{const currentUser=auth.currentUser;if(!currentUser)return;const userDoc=await getDoc(doc(db,"users",currentUser.uid));if(!userDoc.exists())return;const userData=userDoc.data();if(!userData.aceJwt)return;if(userData.aceJwtEncrypted)return;const tokenService=getTokenService();await tokenService.saveToken(currentUser.uid,userData.aceJwt,!0)}catch(error){}}),"undefined"!=typeof window&amp;&amp;(window.debugApiErrors=async function debugApiErrors(){var _a,_b,_c;try{const currentUser=auth.currentUser;if(!currentUser)return;const apiService=getApiService();try{await apiService.fetchSites()}catch(error){if(error.response||error.request,null==(_a=error.message)||_a.includes("CORS"),401===(null==(_b=error.response)?void 0:_b.status)||403===(null==(_c=error.response)?void 0:_c.status)){const{default:store2}=await __vitePreload(async()=&gt;{const{default:store3}=await import("./app-core-rH6lZf1X.js").then(n=&gt;n.ab);return{default:store3}},__vite__mapDeps([5,1,2,3,4,6,7,8,0,9]));if(store2.getState(),currentUser)try{await currentUser.getIdToken()}catch(e){}}}}catch(error){}}),"undefined"!=typeof window&amp;&amp;(window.debugApiProxy=async function debugApiProxy(){try{const currentUser=getAuth().currentUser;if(!currentUser)return;const idToken=await currentUser.getIdToken(),proxyUrl="https://building-vitals-api-763711142996.us-central1.run.app/sites";try{const response=await fetch(proxyUrl,{method:"GET",headers:{Authorization:`Bearer ${idToken}`,"Content-Type":"application/json",Accept:"application/json"}}),responseText=await response.text();if(response.ok)try{JSON.parse(responseText)}catch(_e){}else try{JSON.parse(responseText)}catch(_e){}}catch(error){}const{default:store2}=await __vitePreload(async()=&gt;{const{default:store3}=await import("./app-core-rH6lZf1X.js").then(n=&gt;n.ab);return{default:store3}},__vite__mapDeps([5,1,2,3,4,6,7,8,0,9]));store2.getState()}catch(error){}}),"undefined"!=typeof window&amp;&amp;(window.cleanupUserTokenData=cleanupUserTokenData,window.forceCleanAndRestart=async function forceCleanAndRestart(){try{const cleanupResult=await cleanupUserTokenData();if(!cleanupResult.success)throw new Error(cleanupResult.message);if("caches"in window){const cacheNames=await caches.keys();await Promise.all(cacheNames.map(name=&gt;caches.delete(name)))}return localStorage.removeItem("circuitBreakerStates"),setTimeout(()=&gt;{window.location.reload()},1e3),{success:!0,message:"Cleanup complete. Page will reload..."}}catch(error){return{success:!1,message:error instanceof Error?error.message:"Force clean failed"}}});class FirestoreRecovery{static async ensureUserDocument(userId){try{const userDocRef=doc(db,"users",userId);let userDoc;try{userDoc=await getDoc(userDocRef)}catch(error){if("unavailable"!==(null==error?void 0:error.code))throw error;await new Promise(resolve=&gt;setTimeout(resolve,2e3)),userDoc=await getDoc(userDocRef)}if(userDoc.exists()){return userDoc.data().role||await setDoc(userDocRef,{role:"user"},{merge:!0}),!0}const user=auth.currentUser;return await setDoc(userDocRef,{uid:userId,email:(null==user?void 0:user.email)||"",role:"user",requiresPasswordChange:!1,aceJwt:null,darkMode:!0,createdAt:serverTimestamp(),updatedAt:serverTimestamp()},{merge:!0}),!0}catch(error){return"unavailable"===(null==error?void 0:error.code)&amp;&amp;this.retryCount&lt;this.maxRetries&amp;&amp;(this.retryCount++,await new Promise(resolve=&gt;setTimeout(resolve,3e3)),this.ensureUserDocument(userId))}}static async recoverAuth(){try{const user=auth.currentUser;if(!user)return;if(!(await this.ensureUserDocument(user.uid)))return;try{await tokenManager.loadTokenFromFirestore()}catch(error){}store.getState().auth.error&amp;&amp;store.dispatch({type:"auth/clearError"})}catch(error){}}static async testConnectivity(){try{const start=Date.now(),testRef=doc(db,"_test_","connectivity");await setDoc(testRef,{timestamp:serverTimestamp(),test:!0});return{connected:!0,latency:Date.now()-start}}catch(error){return{connected:!1,error:(null==error?void 0:error.code)||(null==error?void 0:error.message)||"Unknown error"}}}}__publicField(FirestoreRecovery,"retryCount",0),__publicField(FirestoreRecovery,"maxRetries",3),"undefined"!=typeof window&amp;&amp;(window.firestoreRecovery={ensureUserDocument:uid=&gt;{var _a;const userId=uid||(null==(_a=auth.currentUser)?void 0:_a.uid);if(userId)return FirestoreRecovery.ensureUserDocument(userId);console.error("No user ID provided")},recoverAuth:()=&gt;FirestoreRecovery.recoverAuth(),testConnectivity:()=&gt;FirestoreRecovery.testConnectivity()},console.log("🔧 Firestore recovery tools available:"),console.log("- firestoreRecovery.ensureUserDocument() - Ensure user doc exists"),console.log("- firestoreRecovery.recoverAuth() - Recover from auth issues"),console.log("- firestoreRecovery.testConnectivity() - Test Firestore connection"));const firestoreRecovery=Object.freeze(Object.defineProperty({__proto__:null,FirestoreRecovery:FirestoreRecovery},Symbol.toStringTag,{value:"Module"}));"undefined"!=typeof window&amp;&amp;(window.debugNoSitesIssue=async function debugNoSitesIssue(){var _a,_b,_c,_d;try{const apiService=getApiService(),auth2=null==(_b=null==(_a=window.firebase)?void 0:_a.auth)?void 0:_b.call(_a),storedAceToken=(null==auth2||auth2.currentUser,localStorage.getItem("aceJwt")),sessionAceToken=sessionStorage.getItem("aceJwt");try{await apiService.getSites()}catch(error){401===error.status||error.status}try{const axios2=(await __vitePreload(async()=&gt;{const{default:__vite_default__}=await import("./data-vendor-DBrFxduC.js").then(n=&gt;n.d);return{default:__vite_default__}},[])).default;await axios2.get("/api/sites/",{headers:{"X-ACE-Token":storedAceToken||sessionAceToken||""}})}catch(error){}null==(_d=null==(_c=window.__REDUX_DEVTOOLS_EXTENSION__)?void 0:_c.getState)||_d.call(_c)}catch(error){}}),setTimeout(()=&gt;{var _a,_b,_c,_d;const reduxState=null==(_b=null==(_a=window.__REDUX_DEVTOOLS_EXTENSION__)?void 0:_a.getState)?void 0:_b.call(_a);null==(_d=null==(_c=null==reduxState?void 0:reduxState.sites)?void 0:_c.sites)||_d.length},5e3),"undefined"!=typeof window&amp;&amp;(window.diagnoseIntegration=async function diagnoseIntegration(){var _a,_b,_c,_d,_e,_f,_g,_h,_i,_j,_k,_l;const results={firebase:{},firestore:{},functions:{},pythonBackend:{},aceApi:{}};try{const currentUser=getAuth().currentUser;if(currentUser){results.firebase.auth={status:"OK",uid:currentUser.uid,email:currentUser.email};try{const idToken=await currentUser.getIdToken();results.firebase.idToken={status:"OK",tokenLength:idToken.length,tokenPreview:`${idToken.substring(0,20)}...`}}catch(error){results.firebase.idToken={status:"ERROR",error:error.message}}}else results.firebase.auth={status:"ERROR",error:"No user logged in"};const db2=getFirestore();if(currentUser)try{const userDocRef=doc(db2,"users",currentUser.uid),userDoc=await getDoc(userDocRef);if(userDoc.exists()){const data=userDoc.data();results.firestore.userDoc={status:"OK",exists:!0,hasAceToken:!!data.aceJwt,aceTokenLength:data.aceJwt?data.aceJwt.length:0,role:data.role,darkMode:data.darkMode}}else{results.firestore.userDoc={status:"WARNING",exists:!1,message:"User document does not exist"};try{await setDoc(userDocRef,{role:"user",requiresPasswordChange:!1,darkMode:!0,createdAt:new Date},{merge:!0}),results.firestore.userDocCreation={status:"OK",message:"User document created"}}catch(error){results.firestore.userDocCreation={status:"ERROR",error:error.message}}}}catch(error){results.firestore.userDoc={status:"ERROR",error:error.message,code:error.code}}try{const functions=getFunctions(),testFunction=httpsCallable(functions,"listUsers"),response=await testFunction({limit:1});results.functions={status:"OK",callable:!0,response:response.data}}catch(error){results.functions={status:"ERROR",error:error.message,code:error.code}}try{const healthResponse=await axios.get("https://building-vitals-api-763711142996.us-central1.run.app/health");if(results.pythonBackend.health={status:"OK",data:healthResponse.data},currentUser)try{const idToken=await currentUser.getIdToken(),authTest=await axios.get("https://building-vitals-api-763711142996.us-central1.run.app/api/sites/",{headers:{Authorization:`Bearer ${idToken}`}});results.pythonBackend.authTest={status:"OK",siteCount:authTest.data.siteCount}}catch(error){results.pythonBackend.authTest={status:"ERROR",statusCode:null==(_a=error.response)?void 0:_a.status,error:(null==(_b=error.response)?void 0:_b.data)||error.message}}}catch(error){results.pythonBackend.health={status:"ERROR",error:error.message}}const aceToken=store.getState().auth.aceToken;if(aceToken){results.aceApi.tokenStorage={status:"OK",source:"Redux State",tokenLength:aceToken.length,tokenPreview:`${aceToken.substring(0,20)}...`};try{const aceTest=await axios.get("https://building-vitals-api-763711142996.us-central1.run.app/api/sites/",{headers:{"X-ACE-Token":aceToken,Authorization:currentUser?`Bearer ${await currentUser.getIdToken()}`:""}});results.aceApi.apiTest={status:"OK",siteCount:aceTest.data.siteCount,sites:(null==(_c=aceTest.data.sites)?void 0:_c.length)||0}}catch(error){results.aceApi.apiTest={status:"ERROR",statusCode:null==(_d=error.response)?void 0:_d.status,error:(null==(_e=error.response)?void 0:_e.data)||error.message}}}else currentUser&amp;&amp;(null==(_f=results.firestore.userDoc)?void 0:_f.hasAceToken)?results.aceApi.tokenStorage={status:"WARNING",error:"Token in Firestore but not in Redux - try refreshing the page"}:results.aceApi.tokenStorage={status:"ERROR",error:"No ACE token found - go to Settings to add your ACE IoT JWT token"}}catch(error){results.error=error.message}return null==(_g=results.firebase.auth)||_g.status,"ERROR"===(null==(_h=results.firestore.userDoc)?void 0:_h.status)||null==(_i=results.firestore.userDoc)||_i.exists,null==(_j=results.pythonBackend.health)||_j.status,"OK"!==(null==(_k=results.aceApi.tokenStorage)?void 0:_k.status)||null==(_l=results.aceApi.apiTest)||_l.status,results}),console.log("%c🔍 Integration Diagnostics Available","color: #4CAF50; font-weight: bold"),console.log("%cRun: diagnoseIntegration()","color: #2196F3"),console.log("%cThis will check Firebase, Firestore, Python backend, and ACE API integration","color: #9E9E9E");const resetCircuitBreaker=()=&gt;{try{apiCircuitBreaker.reset()}catch(_error){}},getCircuitBreakerState=()=&gt;apiCircuitBreaker.getState(),getCircuitBreakerStats=()=&gt;apiCircuitBreaker.getStats(),logger$1=createLogger("LazyLoad"),DefaultLoadingFallback=()=&gt;React.createElement(Box,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"200px",width:"100%"}},React.createElement(CircularProgress,{size:24})),DefaultErrorFallback=({error:error})=&gt;React.createElement(Box,{sx:{p:2}},React.createElement(Alert,{severity:"error"},`Failed to load component: ${(null==error?void 0:error.message)||"Unknown error"}`)),preloadComponent=async factory=&gt;{try{logger$1.debug("Preloading component"),await factory(),logger$1.debug("Component preloaded successfully")}catch(error){logger$1.warn("Component preload failed",{error:error.message})}},createLazyRoute=(factory,preloadTriggers=[])=&gt;{const LazyComponent=((factory,options={})=&gt;{const{loadingFallback:loadingFallback=DefaultLoadingFallback,errorFallback:errorFallback=DefaultErrorFallback,retryCount:retryCount=3,retryDelay:retryDelay=1e3}=options;let retries=0;const retryFactory=async()=&gt;{try{const module=await factory();return logger$1.debug("Component loaded successfully",{retries:retries}),module}catch(error){if(retries++,logger$1.warn("Component load failed",{error:error.message,retries:retries,retryCount:retryCount}),retries&lt;retryCount)return await new Promise(resolve=&gt;setTimeout(resolve,retryDelay*retries)),retryFactory();throw logger$1.error("Component load failed after all retries",{error:error.message,retries:retries}),error}};return reactExports.lazy(retryFactory)})(factory,{loadingFallback:()=&gt;React.createElement(Box,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh",width:"100%"}},React.createElement(CircularProgress,{size:32}))});return preloadTriggers.length&gt;0&amp;&amp;preloadTriggers.forEach(trigger=&gt;{"hover"===trigger?document.addEventListener("mouseover",e=&gt;{const target=e.target;("A"===target.tagName||target.closest("a"))&amp;&amp;preloadComponent(factory)},{once:!0}):"idle"===trigger&amp;&amp;("requestIdleCallback"in window?requestIdleCallback(()=&gt;preloadComponent(factory)):setTimeout(()=&gt;preloadComponent(factory),1e3))}),LazyComponent};new class LiveRegionAnnouncer{constructor(){__publicField(this,"liveRegion",null),this.createLiveRegion()}createLiveRegion(){"undefined"!=typeof document&amp;&amp;(this.liveRegion=document.createElement("div"),this.liveRegion.setAttribute("role","status"),this.liveRegion.setAttribute("aria-live","polite"),this.liveRegion.setAttribute("aria-atomic","true"),this.liveRegion.style.position="absolute",this.liveRegion.style.left="-10000px",this.liveRegion.style.width="1px",this.liveRegion.style.height="1px",this.liveRegion.style.overflow="hidden",document.body.appendChild(this.liveRegion))}announce(message,priority="polite"){this.liveRegion&amp;&amp;(this.liveRegion.setAttribute("aria-live",priority),this.liveRegion.textContent=message,setTimeout(()=&gt;{this.liveRegion&amp;&amp;(this.liveRegion.textContent="")},1e3))}destroy(){this.liveRegion&amp;&amp;this.liveRegion.parentNode&amp;&amp;(this.liveRegion.parentNode.removeChild(this.liveRegion),this.liveRegion=null)}};class ProductionLogger{constructor(config){__publicField(this,"config"),__publicField(this,"originalConsole",{log:console.log,info:console.info,warn:console.warn,error:console.error,debug:console.debug}),this.config={level:3,enableInProduction:!1,timestamp:!0,...config},this.config.enableInProduction||this.disableConsoleLogs()}disableConsoleLogs(){console.log=()=&gt;{},console.info=()=&gt;{},console.warn=()=&gt;{},console.debug=()=&gt;{},console.error=(...args)=&gt;{this.config.level&lt;=3&amp;&amp;this.originalConsole.error(...args)}}formatMessage(level,message,..._args){const parts=[];return this.config.timestamp&amp;&amp;parts.push(`[${(new Date).toISOString()}]`),this.config.prefix&amp;&amp;parts.push(`[${this.config.prefix}]`),parts.push(`[${level}]`),parts.push(message),parts.join(" ")}debug(message,...args){this.config.level&lt;=0&amp;&amp;this.originalConsole.debug(this.formatMessage("DEBUG",message),...args)}info(message,...args){this.config.level&lt;=1&amp;&amp;this.originalConsole.info(this.formatMessage("INFO",message),...args)}warn(message,...args){this.config.level&lt;=2&amp;&amp;this.originalConsole.warn(this.formatMessage("WARN",message),...args)}error(message,...args){this.config.level&lt;=3&amp;&amp;this.originalConsole.error(this.formatMessage("ERROR",message),...args)}createLogger(context){return new ProductionLogger({...this.config,prefix:context})}enableDebug(duration=6e4){const originalLevel=this.config.level;this.config.level=0,setTimeout(()=&gt;{this.config.level=originalLevel},duration)}}new ProductionLogger;{const noop=()=&gt;{};console.log=noop,console.info=noop,console.warn=noop,console.debug=noop,console.dir=noop,console.table=noop,console.time=noop,console.timeEnd=noop,console.trace=noop;const originalError=console.error;console.error=(...args)=&gt;{var _a;const message=(null==(_a=args[0])?void 0:_a.toString())||"";message.includes("React Hook")||message.includes("Warning:")||message.includes("DevTools")||originalError(...args)}}class ValidationError extends Error{constructor(message,details){super(message),__publicField(this,"code","VALIDATION_ERROR"),__publicField(this,"recoverable",!0),this.details=details,this.name="ValidationError"}}class ApiError extends Error{constructor(message,statusCode,code,details){super(message),__publicField(this,"recoverable",!0),this.statusCode=statusCode,this.code=code,this.details=details,this.name="ApiError",statusCode&amp;&amp;statusCode&gt;=500?this.recoverable=!0:401!==statusCode&amp;&amp;403!==statusCode||(this.recoverable=!1)}}class NetworkError extends Error{constructor(message="Network connection failed"){super(message),__publicField(this,"code","NETWORK_ERROR"),__publicField(this,"recoverable",!0),this.name="NetworkError"}}class DataError extends Error{constructor(message,details){super(message),__publicField(this,"code","DATA_ERROR"),__publicField(this,"recoverable",!1),this.details=details,this.name="DataError"}}function setupGlobalErrorHandlers$1(){window.addEventListener("unhandledrejection",event=&gt;{var _a;if(event.preventDefault(),null!==event.reason&amp;&amp;void 0!==event.reason){if(null==(_a=event.reason)?void 0:_a.message){if(["404","No data available","Request aborted","Network request aborted","The user aborted a request"].some(err=&gt;event.reason.message.includes(err)))return void console.debug("Suppressed known error:",event.reason.message)}console.error("Unhandled promise rejection:",event.reason),event.reason}}),window.addEventListener("error",event=&gt;(console.error("Global error:",event.error),event.error,!0))}function reportError(_error,_context){}function withErrorHandling(fn,options={}){return async(...args)=&gt;{const{fallback:fallback,onError:onError,retries:retries=0,retryDelay:retryDelay=1e3}=options;let lastError;for(let attempt=0;attempt&lt;=retries;attempt++)try{return await fn(...args)}catch(error){if(lastError=error,console.error(`Error in ${fn.name||"anonymous function"}:`,error),onError&amp;&amp;onError(lastError),attempt&lt;retries){console.log(`Retrying ${fn.name} (attempt ${attempt+1}/${retries})...`),await new Promise(resolve=&gt;setTimeout(resolve,retryDelay*(attempt+1)));continue}if(void 0!==fallback)return fallback;throw lastError}}}class AggregateError extends Error{constructor(message,errors){super(message),__publicField(this,"code","AGGREGATE_ERROR"),__publicField(this,"recoverable",!1),this.errors=errors,this.name="AggregateError"}}class CircuitBreakerError extends Error{constructor(message="Service temporarily unavailable",service,resetTime){super(message),__publicField(this,"code","CIRCUIT_BREAKER_OPEN"),__publicField(this,"recoverable",!1),this.service=service,this.resetTime=resetTime,this.name="CircuitBreakerError"}}function formatErrorForUser(error){if(error instanceof ValidationError)return error.message;if(error instanceof ApiError){if(401===error.statusCode)return"Please log in to continue";if(403===error.statusCode)return"You do not have permission to perform this action";if(404===error.statusCode)return"The requested resource was not found";if(error.statusCode&amp;&amp;error.statusCode&gt;=500)return"A server error occurred. Please try again later"}if(error instanceof NetworkError)return"Please check your internet connection and try again";if(error instanceof DataError)return"Invalid data format. Please contact support if this persists";if(error instanceof CircuitBreakerError)return"Service temporarily unavailable. Please try again "+(error.resetTime?"after "+error.resetTime.toLocaleTimeString():"later");if(error instanceof AggregateError)return`Multiple errors occurred: ${error.errors.map(e=&gt;formatErrorForUser(e)).join(", ")}`;const errorCode=function getErrorCode(error){var _a;return(null==error?void 0:error.code)?error.code:error instanceof ApiError&amp;&amp;error.statusCode?`HTTP_${error.statusCode}`:(null==(_a=null==error?void 0:error.response)?void 0:_a.status)?`HTTP_${error.response.status}`:void 0}(error);if(errorCode)switch(errorCode){case"ECONNABORTED":case"ETIMEDOUT":return"Request timed out. Please check your connection and try again";case"HTTP_429":return"Too many requests. Please wait a moment before trying again";case"HTTP_502":case"HTTP_503":case"HTTP_504":return"Service temporarily unavailable. Please try again later"}return"An unexpected error occurred. Please try again"}!function initializeECharts(){try{"undefined"!=typeof window&amp;&amp;(window.echarts=echarts,init||console.error("[EChartsInitSimple] ECharts init function not found!"))}catch(error){console.error("[EChartsInitSimple] Failed to initialize ECharts:",error)}}();class ApiDebugger{static async debugPoint(pointName){const info={pointName:pointName,exists:!1,collectEnabled:!1,hasTimeseries:!1};try{const parts=pointName.split("/");if(parts.length&lt;2)return info.error="Invalid point name format",info;const siteName=parts[1],api=getApiService(),points=await api.getPointsForSite(siteName),point=points.find(p=&gt;p.name===pointName);if(!point){info.error=`Point not found in site ${siteName}. Total points: ${points.length}`;const similar=points.filter(p=&gt;p.name.toLowerCase().includes(parts[parts.length-1].toLowerCase()));return similar.length&gt;0&amp;&amp;(info.details={similarPoints:similar.map(p=&gt;({name:p.name,id:p.id,collectEnabled:p.collect_enabled}))}),info}info.exists=!0,info.collectEnabled=point.collect_enabled||!1,info.details={id:point.id,name:point.name,type:point.point_type,unit:point.unit,markerTags:point.marker_tags,kvTags:point.kv_tags,collectInterval:point.collect_interval};try{const endTime=(new Date).toISOString(),startTime=new Date(Date.now()-36e5).toISOString(),data=await api.getTimeSeriesData(pointName,startTime,endTime);info.hasTimeseries=data.data.length&gt;0,info.details.latestValue=data.data[data.data.length-1]}catch(tsError){info.hasTimeseries=!1,info.details.timeseriesError=tsError.message}}catch(error){info.error=error.message||"Unknown error"}return info}static async debugPoints(pointNames){return await Promise.all(pointNames.map(name=&gt;this.debugPoint(name)))}static validatePointName(pointName){const parts=pointName.split("/");return parts.length&lt;3?{valid:!1,error:"Point name should have at least 3 parts separated by /"}:parts.some(part=&gt;!part)?{valid:!1,error:"Point name contains empty parts"}:pointName.includes("%2F")?{valid:!1,error:"Point name appears to be double-encoded"}:{valid:!0}}static async debugMonitor(monitorId,selectedPoints){const failingPoints=debugResults.filter(r=&gt;!r.hasTimeseries),recommendations=[],notFound=failingPoints.filter(p=&gt;!p.exists),disabled=failingPoints.filter(p=&gt;p.exists&amp;&amp;!p.collectEnabled),noData=failingPoints.filter(p=&gt;p.exists&amp;&amp;p.collectEnabled&amp;&amp;!p.hasTimeseries);notFound.length&gt;0&amp;&amp;recommendations.push(`${notFound.length} points not found. Check if point names are correct.`),disabled.length&gt;0&amp;&amp;recommendations.push(`${disabled.length} points have collection disabled. Enable collection for these points.`),noData.length&gt;0&amp;&amp;recommendations.push(`${noData.length} points exist but have no recent data. Check if devices are online.`);return{summary:`${failingPoints.length} of ${selectedPoints.length} points are failing`,failingPoints:failingPoints,recommendations:recommendations}}}const debugPointTypes=points=&gt;{!points||points.length,points[0],points.reduce((acc,point)=&gt;{const type=String(point.point_type||"unknown");return acc[type]=(acc[type]||0)+1,acc},{}),points.filter(p=&gt;{const id=String(p.id||""),name=String(p.name||"");return id.includes("/weather/")||name.includes("weather")}).length,points.filter(p=&gt;{const id=String(p.id||""),name=String(p.name||"");return id.includes("/n4/")||name.includes("haystack")}).length,points.find(p=&gt;{const id=String(p.id||""),name=String(p.name||"");return id.includes("/weather/")||name.includes("weather")}),points.find(p=&gt;{const id=String(p.id||""),name=String(p.name||"");return id.includes("/n4/")||name.includes("haystack")})};function initializeConsoleEnhancer(){"undefined"!=typeof window&amp;&amp;(window.BuildingVitals={version:"1.0.0",environment:"production",buildTime:(new Date).toISOString(),getState:()=&gt;store.getState(),dispatch:action=&gt;store.dispatch(action),apiMode:"PROXY",apiUrls:{direct:"https://manager.aceiot.cloud/api",proxy:"https://us-central1-building-vitals.cloudfunctions.net/apiProxy",active:"https://us-central1-building-vitals.cloudfunctions.net/apiProxy"},firebase:{projectId:"building-vitals",authDomain:"building-vitals.firebaseapp.com"},echarts:{available:()=&gt;!!window.echarts,version:()=&gt;{var _a;return(null==(_a=window.echarts)?void 0:_a.version)||"not loaded"}},debug:{enableLogging:()=&gt;{localStorage.setItem("debug_logging","true"),window.location.reload()},disableLogging:()=&gt;{localStorage.removeItem("debug_logging"),window.location.reload()},clearCaches:async()=&gt;{if(localStorage.clear(),sessionStorage.clear(),"indexedDB"in window){(await indexedDB.databases()).forEach(db2=&gt;{db2.name&amp;&amp;indexedDB.deleteDatabase(db2.name)})}},testApi:async()=&gt;{try{const api=getApiService();return await api.getSites()}catch(error){throw error}},checkAuth:()=&gt;store.getState().auth,listEventListeners:()=&gt;{const listeners=[],originalAddEventListener=EventTarget.prototype.addEventListener;return EventTarget.prototype.addEventListener=function(type,listener,options){return listeners.push({target:this,type:type,listener:listener?listener.toString().substring(0,100)+"...":"null",options:options}),originalAddEventListener.call(this,type,listener,options)},listeners},networkMonitor:{start:()=&gt;{const observer=new PerformanceObserver(list=&gt;{list.getEntries().forEach(entry=&gt;{entry.entryType})});observer.observe({entryTypes:["resource"]}),window.BuildingVitals.debug._networkObserver=observer},stop:()=&gt;{const observer=window.BuildingVitals.debug._networkObserver;observer&amp;&amp;observer.disconnect()}},showPointTypes:async()=&gt;{try{const api=getApiService(),sites=await api.getSites();if(sites.length&gt;0){const points=await api.getPoints(sites[0].id);debugPointTypes(points)}}catch(error){}},enableVerboseLogging:()=&gt;{localStorage.setItem("debug-verbose","true")},disableVerboseLogging:()=&gt;{localStorage.removeItem("debug-verbose")}},help:()=&gt;{console.log("BuildingVitals Debug Commands:"),console.log("- bv.chartData() - Get current chart data"),console.log("- bv.forceRefresh() - Force data refresh"),console.log("- bv.clearCache() - Clear all caches"),console.log("- bv.toggleDebug() - Toggle debug mode"),console.log("- bv.lastError() - Show last error"),console.log("- bv.apiHealth() - Check API health"),console.log("- bv.exportState() - Export app state"),console.log("- bv.importState(data) - Import app state"),console.log("- bv.debugStore() - Debug Redux store"),console.log("- bv.showCookies() - Show cookies"),console.log("- bv.enableVerboseLogging() - Enable verbose logs"),console.log("- bv.disableVerboseLogging() - Disable verbose logs")}},window.bv=window.BuildingVitals)}window.debugPoint=ApiDebugger.debugPoint,window.debugMonitor=ApiDebugger.debugMonitor,window.debugPointTypes=debugPointTypes,window.debugAuth=async function debugAuthStatus(){try{const auth2=getFirebaseAuth(),currentUser=null==auth2?void 0:auth2.currentUser;if(!currentUser)return void console.log("No current user");const idToken=await currentUser.getIdToken(),decodedToken=JSON.parse(atob(idToken.split(".")[1])),expDate=new Date(1e3*decodedToken.exp);console.log("Firebase token expires:",expDate);const aceToken=await getToken$1(currentUser.uid);if(aceToken)try{const aceTokenParts=aceToken.split(".");if(3===aceTokenParts.length){const acePayload=JSON.parse(atob(aceTokenParts[1])),aceExpDate=new Date(1e3*acePayload.exp);console.log("ACE token expires:",aceExpDate)}}catch(e){console.error("Error decoding ACE token:",e)}else console.log("No ACE token found");const db2=getFirestore(),userDoc=await getDoc(doc(db2,"users",currentUser.uid));if(userDoc.exists()){const userData=userDoc.data();console.log("User data:",userData)}else console.log("No user document found")}catch(error){console.error("Error in debugAuthStatus:",error)}},"undefined"!=typeof window&amp;&amp;(window.runDiagnostics=async function runDiagnostics(){var _a,_b,_c,_d,_e,_f,_g,_h;console.log("🔍 Running Building Vitals Diagnostics...\n");const results={auth:{status:"unknown",details:{}},aceToken:{status:"unknown",details:{}},pythonService:{status:"unknown",details:{}},testEndpoint:{status:"unknown",details:{}},recommendations:[]};console.log("1️⃣ Checking Authentication...");try{const auth2=getFirebaseAuth();(null==auth2?void 0:auth2.currentUser)?(results.auth.status="success",results.auth.details={uid:auth2.currentUser.uid,email:auth2.currentUser.email,emailVerified:auth2.currentUser.emailVerified},console.log("✅ User authenticated:",results.auth.details)):(results.auth.status="error",results.auth.details={error:"No authenticated user"},console.log("❌ No authenticated user"),results.recommendations.push("Please sign in to continue"))}catch(error){results.auth.status="error",results.auth.details={error:error.message},console.error("❌ Auth check failed:",error)}if("success"===results.auth.status){console.log("\n2️⃣ Checking ACE Token...");try{const auth2=getFirebaseAuth(),userDoc=await getDoc(doc(db,"users",auth2.currentUser.uid));if(userDoc.exists()){const userData=userDoc.data();userData.aceJwt||userData.aceJwtEncrypted?(results.aceToken.status="success",results.aceToken.details={hasPlainToken:!!userData.aceJwt,hasEncryptedToken:!!userData.aceJwtEncrypted,tokenLength:null==(_a=userData.aceJwt||userData.aceJwtEncrypted)?void 0:_a.length},console.log("✅ ACE token found:",results.aceToken.details)):(results.aceToken.status="error",results.aceToken.details={error:"No ACE token found"},console.log("❌ No ACE token in user profile"),results.recommendations.push("Add your ACE IoT token in Settings &gt; Integration"))}else results.aceToken.status="error",results.aceToken.details={error:"User profile not found"},console.log("❌ User profile document not found")}catch(error){results.aceToken.status="error",results.aceToken.details={error:error.message},console.error("❌ ACE token check failed:",error)}}console.log("\n3️⃣ Testing Python Service...");try{const response=await axiosInstance.get("/health");results.pythonService.status="success",results.pythonService.details=response.data,console.log("✅ Python Service is healthy:",response.data)}catch(error){results.pythonService.status="error",results.pythonService.details={error:error.message,status:null==(_b=error.response)?void 0:_b.status,data:null==(_c=error.response)?void 0:_c.data},console.error("❌ Python Service test failed:",error),results.recommendations.push("Check if Python service is running at: https://building-vitals-api-763711142996.us-central1.run.app")}if("success"===results.aceToken.status){console.log("\n4️⃣ Testing Sites Endpoint...");try{const response=await axiosInstance.get("/sites/");results.testEndpoint.status="success",results.testEndpoint.details={siteCount:(null==(_d=response.data)?void 0:_d.length)||0,firstSite:null==(_e=response.data)?void 0:_e[0]},console.log("✅ Sites endpoint working:",results.testEndpoint.details)}catch(error){results.testEndpoint.status="error",results.testEndpoint.details={error:error.message,status:null==(_f=error.response)?void 0:_f.status,data:null==(_g=error.response)?void 0:_g.data},console.error("❌ Sites endpoint test failed:",error),401===(null==(_h=error.response)?void 0:_h.status)&amp;&amp;results.recommendations.push("ACE token may be invalid or expired")}}return console.log("\n📊 Diagnostic Summary:"),console.log("==================="),console.log("Authentication: "+("success"===results.auth.status?"✅":"❌")),console.log("ACE Token: "+("success"===results.aceToken.status?"✅":"❌")),console.log("Python Service: "+("success"===results.pythonService.status?"✅":"❌")),console.log("API Access: "+("success"===results.testEndpoint.status?"✅":"❌")),results.recommendations.length&gt;0&amp;&amp;(console.log("\n💡 Recommendations:"),results.recommendations.forEach((rec,i)=&gt;{console.log(`${i+1}. ${rec}`)})),results},console.log('💡 Diagnostic tool loaded. Run "runDiagnostics()" in the console to check your setup.')),window.checkTokenStatus=async function checkTokenStatus(){console.log("=== ACE Token Status Check ===");try{const user=auth.currentUser;if(!user)return void console.error("❌ No authenticated user found");console.log("✅ Authenticated user:",user.uid);const{default:store2}=await __vitePreload(async()=&gt;{const{default:store3}=await import("./app-core-rH6lZf1X.js").then(n=&gt;n.ab);return{default:store3}},__vite__mapDeps([5,1,2,3,4,6,7,8,0,9])),reduxToken=store2.getState().auth.aceToken;console.log("📦 Redux state token:",reduxToken?`${reduxToken.substring(0,20)}...`:"null");const userDoc=await getDoc(doc(db,"users",user.uid));if(!userDoc.exists())return void console.error("❌ User document not found in Firestore");const userData=userDoc.data();console.log("📄 Firestore document fields:",Object.keys(userData)),userData.aceJwt&amp;&amp;console.log("✅ Plain text token found:",userData.aceJwt.substring(0,20)+"..."),userData.aceJwtEncrypted&amp;&amp;console.log("🔐 Encrypted token found"),userData.aceJwt||userData.aceJwtEncrypted||console.error("❌ No token found in Firestore"),console.log("\n📥 Attempting to load token via tokenService...");const loadedToken=await getToken(user.uid);if(loadedToken){console.log("✅ Token loaded successfully:",loadedToken.substring(0,20)+"...");const isValid=await validateToken(user.uid,loadedToken);console.log("🔍 Token validation:",isValid)}else console.error("❌ Failed to load token via tokenService");console.log("\n💾 Checking browser storage...");const localToken=localStorage.getItem("ace_jwt_token"),sessionToken=sessionStorage.getItem("ace_jwt_token");console.log("localStorage token:",localToken?"Found":"Not found"),console.log("sessionStorage token:",sessionToken?"Found":"Not found"),console.log("\n🔌 Checking axios instance...");try{const{default:axiosInstance2}=await __vitePreload(async()=&gt;{const{default:axiosInstance3}=await import("./app-core-rH6lZf1X.js").then(n=&gt;n.ah);return{default:axiosInstance3}},__vite__mapDeps([5,1,2,3,4,6,7,8,0,9])),requestInterceptor=axiosInstance2.interceptors.request.use(config=&gt;{throw console.log("Axios headers:",Object.keys(config.headers)),config.headers["X-ACE-Token"]?console.log("✅ Token is set in axios instance"):console.log("❌ Token NOT set in axios instance"),new Error("Just checking headers")});try{await axiosInstance2.get("/dummy")}catch(e){}axiosInstance2.interceptors.request.eject(requestInterceptor)}catch(error){console.log("⚠️  Could not check axios instance")}console.log("\n📋 Recommendations:"),reduxToken||loadedToken?reduxToken&amp;&amp;!loadedToken?console.log("⚠️  Token in Redux but not in storage. May need to re-save."):loadedToken&amp;&amp;!reduxToken?console.log("⚠️  Token in storage but not in Redux. Try refreshing the page."):reduxToken&amp;&amp;(console.log("✅ Token is loaded in Redux!"),console.log('⚠️  If still seeing "no sites", the token might be:'),console.log("   - Invalid or expired"),console.log("   - For the wrong ACE environment"),console.log("   - Missing required permissions"),console.log("\n🔧 Try running: fixTokenIssue()")):(console.log("⚠️  No token found. User needs to:"),console.log("   1. Go to Settings page"),console.log("   2. Enter their ACE IoT JWT token"),console.log('   3. Click "Save Token"'))}catch(error){console.error("❌ Error checking token status:",error)}},console.log("%c🔑 Token Status Check Available","color: #FF9800; font-weight: bold"),console.log("%cRun: checkTokenStatus()","color: #2196F3"),console.log("%cThis will check your ACE IoT token status and provide recommendations","color: #9E9E9E"),window.fixTokenIssue=async function fixTokenIssue(){console.log("=== Fixing ACE Token Issue ===");try{const user=auth.currentUser;if(!user)return void console.error("❌ You must be logged in first");console.log("✅ User authenticated:",user.uid);const userDoc=await getDoc(doc(db,"users",user.uid));if(!userDoc.exists())return console.error("❌ User document not found in Firestore"),console.log("Creating user document..."),await updateDoc(doc(db,"users",user.uid),{role:"user",darkMode:!0,createdAt:(new Date).toISOString()}),void console.log("✅ User document created");const userData=userDoc.data(),firestoreToken=userData.aceJwt||userData.aceJwtEncrypted;if(!firestoreToken)return console.error("❌ No ACE token found in Firestore"),console.log("\n📋 To fix this:"),console.log('1. Go to Settings page: window.location.href = "/settings"'),console.log("2. Enter your ACE IoT JWT token"),void console.log('3. Click "Save Token"');console.log("✅ Token found in Firestore"),console.log("\n🔄 Reloading token..."),store.dispatch(setAceToken(firestoreToken));const state=store.getState();state.auth.aceToken?(console.log("✅ Token successfully loaded to Redux!"),console.log("\n🎉 Token issue fixed! The app should now work properly."),console.log("If you still see errors, try refreshing the page.")):(console.error("❌ Failed to load token to Redux"),console.log("\n🔧 Manual fix:"),console.log("1. Clear your browser cache"),console.log("2. Log out and log back in"),console.log("3. If that doesn't work, go to Settings and re-save your token"))}catch(error){console.error("❌ Error fixing token issue:",error)}},window.goToSettings=function goToSettings(){window.location.href="/settings"},console.log("%c🔧 Token Fix Utilities Available","color: #4CAF50; font-weight: bold"),console.log("%cRun: fixTokenIssue() - to attempt automatic token fix","color: #2196F3"),console.log("%cRun: goToSettings() - to navigate to Settings page","color: #2196F3");const handledRejections=new WeakSet;function setupGlobalErrorHandlers(){window.addEventListener("unhandledrejection",event=&gt;{event.preventDefault();const{promise:promise,reason:reason}=event;if(!handledRejections.has(promise)&amp;&amp;(handledRejections.add(promise),null!=reason&amp;&amp;"null"!==reason&amp;&amp;("string"!=typeof reason||"null"!==reason.toLowerCase())&amp;&amp;(null==reason?void 0:reason.message))){if(["404","No data available","No raw data available","Data preparation failed","No chart options generated","Request aborted","Network request aborted","The user aborted a request"].some(err=&gt;reason.message.includes(err)))return}}),window.addEventListener("error",event=&gt;{var _a;(null==(_a=event.message)?void 0:_a.includes("ResizeObserver loop limit exceeded"))&amp;&amp;event.preventDefault()})}const getAuthErrorMessage=error=&gt;{const errorCode=(null==error?void 0:error.code)||"",errorMessage=(null==error?void 0:error.message)||"An error occurred";switch(errorCode){case"auth/user-not-found":return{message:"No account found with this email address.",suggestions:["Check if you typed your email correctly","You may need to create a new account"]};case"auth/wrong-password":return{message:"Incorrect password.",suggestions:["Check your password and try again","Passwords are case-sensitive"],showResetPassword:!0};case"auth/invalid-email":return{message:"Please enter a valid email address.",suggestions:["Email should be in format: user@example.com"]};case"auth/user-disabled":return{message:"This account has been disabled.",suggestions:["Contact your system administrator"],showContactSupport:!0};case"auth/too-many-requests":return{message:"Too many failed login attempts.",suggestions:["Please wait a few minutes before trying again","You can reset your password if you've forgotten it"],showResetPassword:!0};case"auth/network-request-failed":return{message:"Network connection error.",suggestions:["Check your internet connection","Try disabling VPN if you're using one","Check if your firewall is blocking the connection"]};case"auth/weak-password":return{message:"Password is too weak.",suggestions:["Use at least 6 characters","Include numbers and special characters for better security"]};case"auth/email-already-in-use":return{message:"An account with this email already exists.",suggestions:["Try signing in instead","Use a different email address"]};case"auth/invalid-action-code":return{message:"This password reset link has expired or is invalid.",suggestions:["Request a new password reset email"],showResetPassword:!0};case"auth/expired-action-code":return{message:"This password reset link has expired.",suggestions:["Password reset links expire after 1 hour","Request a new password reset email"],showResetPassword:!0};case"auth/requires-recent-login":return{message:"Please sign in again to complete this action.",suggestions:["For security, some actions require recent authentication"]};case"auth/invalid-credential":return{message:"Invalid login credentials.",suggestions:["Check your email and password","Make sure caps lock is off"]};default:return errorMessage.includes("PERMISSION_DENIED")?{message:"You don't have permission to access this resource.",suggestions:["Contact your administrator for access"],showContactSupport:!0}:errorMessage.includes("Failed to fetch")||errorMessage.includes("NetworkError")?{message:"Unable to connect to the server.",suggestions:["Check your internet connection","The server might be temporarily unavailable","Try again in a few moments"]}:{message:"An unexpected error occurred.",suggestions:["Please try again","If the problem persists, contact support"],showContactSupport:!0}}},applyResponsiveConfig=(option,width,height)=&gt;{const config=((width,height)=&gt;({width:width,height:height,isSmall:width&lt;400||height&lt;300,isMedium:width&lt;600||height&lt;400,isLarge:width&gt;=800&amp;&amp;height&gt;=500}))(width,height),fontSizes=(config=&gt;config.isSmall?{title:14,subtitle:11,label:10,legend:10,tooltip:11,axis:9}:config.isMedium?{title:16,subtitle:12,label:11,legend:11,tooltip:12,axis:10}:{title:18,subtitle:14,label:12,legend:12,tooltip:13,axis:11})(config),spacing=(config=&gt;config.isSmall?{gridLeft:45,gridRight:10,gridTop:30,gridBottom:60,legendPadding:5,toolboxTop:5,toolboxRight:5}:config.isMedium?{gridLeft:50,gridRight:15,gridTop:35,gridBottom:70,legendPadding:8,toolboxTop:8,toolboxRight:10}:{gridLeft:60,gridRight:20,gridTop:40,gridBottom:80,legendPadding:10,toolboxTop:10,toolboxRight:20})(config),symbolSize=(config=&gt;config.isSmall?3:config.isMedium?4:5)(config),lineWidth=(config=&gt;config.isSmall?1.5:config.isMedium?2:2.5)(config),responsiveOption=JSON.parse(JSON.stringify(option));responsiveOption.title&amp;&amp;(responsiveOption.title.textStyle={...responsiveOption.title.textStyle,fontSize:fontSizes.title},responsiveOption.title.subtextStyle&amp;&amp;(responsiveOption.title.subtextStyle.fontSize=fontSizes.subtitle)),responsiveOption.grid&amp;&amp;(responsiveOption.grid={...responsiveOption.grid,left:spacing.gridLeft,right:spacing.gridRight,top:spacing.gridTop,bottom:spacing.gridBottom}),responsiveOption.legend&amp;&amp;(responsiveOption.legend={...responsiveOption.legend,padding:spacing.legendPadding,textStyle:{...responsiveOption.legend.textStyle,fontSize:fontSizes.legend},itemWidth:config.isSmall?16:20,itemHeight:config.isSmall?10:12}),responsiveOption.tooltip&amp;&amp;(responsiveOption.tooltip={...responsiveOption.tooltip,textStyle:{...responsiveOption.tooltip.textStyle,fontSize:fontSizes.tooltip},padding:config.isSmall?[5,8]:[10,15]});const applyAxisResponsive=axis=&gt;axis?{...axis,axisLabel:{...axis.axisLabel,fontSize:fontSizes.axis,rotate:config.isSmall&amp;&amp;"category"===axis.type?45:0},nameTextStyle:{...axis.nameTextStyle,fontSize:fontSizes.label}}:axis;return responsiveOption.xAxis&amp;&amp;(Array.isArray(responsiveOption.xAxis)?responsiveOption.xAxis=responsiveOption.xAxis.map(applyAxisResponsive):responsiveOption.xAxis=applyAxisResponsive(responsiveOption.xAxis)),responsiveOption.yAxis&amp;&amp;(Array.isArray(responsiveOption.yAxis)?responsiveOption.yAxis=responsiveOption.yAxis.map(applyAxisResponsive):responsiveOption.yAxis=applyAxisResponsive(responsiveOption.yAxis)),responsiveOption.series&amp;&amp;Array.isArray(responsiveOption.series)&amp;&amp;(responsiveOption.series=responsiveOption.series.map(series=&gt;{const updatedSeries={...series};return"line"===series.type&amp;&amp;(updatedSeries.lineStyle={...series.lineStyle,width:lineWidth},updatedSeries.symbolSize=symbolSize),"bar"===series.type&amp;&amp;(config.isSmall?updatedSeries.barWidth="60%":config.isMedium&amp;&amp;(updatedSeries.barWidth="70%")),"scatter"===series.type&amp;&amp;(updatedSeries.symbolSize=2*symbolSize),updatedSeries})),responsiveOption.toolbox&amp;&amp;(responsiveOption.toolbox={...responsiveOption.toolbox,top:spacing.toolboxTop,right:spacing.toolboxRight,itemSize:config.isSmall?12:15,itemGap:config.isSmall?5:10}),responsiveOption.dataZoom&amp;&amp;Array.isArray(responsiveOption.dataZoom)&amp;&amp;(responsiveOption.dataZoom=responsiveOption.dataZoom.map(zoom=&gt;"slider"===zoom.type?{...zoom,height:config.isSmall?15:20,textStyle:{...zoom.textStyle,fontSize:fontSizes.axis}}:zoom)),responsiveOption},DEFAULT_THRESHOLDS={PROGRESSIVE:1e4,SAMPLING:5e3,LARGE_MODE:2e4,ANIMATION_DISABLE:5e4},applyLargeDataOptimizations=(option,config={})=&gt;{if(!option.series||!Array.isArray(option.series))return option;const noSamplingConfig={...config,enableLargeMode:!0},stats=(series=&gt;{let totalPoints=0,maxSeriesLength=0;series.forEach(s=&gt;{if(s.data&amp;&amp;Array.isArray(s.data)){const length=s.data.length;totalPoints+=length,maxSeriesLength=Math.max(maxSeriesLength,length)}});const recommendedOptimizations=[];return totalPoints&gt;DEFAULT_THRESHOLDS.PROGRESSIVE&amp;&amp;recommendedOptimizations.push("progressive"),maxSeriesLength&gt;DEFAULT_THRESHOLDS.SAMPLING&amp;&amp;recommendedOptimizations.push("sampling"),totalPoints&gt;DEFAULT_THRESHOLDS.LARGE_MODE&amp;&amp;recommendedOptimizations.push("largeMode"),totalPoints&gt;DEFAULT_THRESHOLDS.ANIMATION_DISABLE&amp;&amp;recommendedOptimizations.push("disableAnimation"),{totalPoints:totalPoints,seriesCount:series.length,maxSeriesLength:maxSeriesLength,recommendedOptimizations:recommendedOptimizations}})(option.series);let optimizedOption={...option};var dataZoom,dataSize;return stats.totalPoints&gt;DEFAULT_THRESHOLDS.PROGRESSIVE&amp;&amp;(optimizedOption=((option,config)=&gt;{const{progressiveThreshold:progressiveThreshold=DEFAULT_THRESHOLDS.PROGRESSIVE}=config;return{...option,progressive:progressiveThreshold,progressiveThreshold:progressiveThreshold,progressiveChunkMode:"sequential"}})(optimizedOption,noSamplingConfig)),stats.totalPoints&gt;DEFAULT_THRESHOLDS.LARGE_MODE&amp;&amp;(optimizedOption.series=((series,config)=&gt;{const{enableLargeMode:enableLargeMode=!0,largeModeThreshold:largeModeThreshold=DEFAULT_THRESHOLDS.LARGE_MODE}=config;return enableLargeMode?series.map(s=&gt;!s.data||s.data.length&lt;=largeModeThreshold?s:{...s,large:!0,largeThreshold:largeModeThreshold,emphasis:{...s.emphasis,disabled:!0},blur:{...s.blur,disabled:!0},select:{...s.select,disabled:!0}}):series})(optimizedOption.series||[],noSamplingConfig)),optimizedOption.series=(optimizedOption.series||[]).map(s=&gt;({...s,sampling:"none",large:s.data&amp;&amp;s.data.length&gt;5e3,largeThreshold:5e3,progressive:s.data&amp;&amp;s.data.length&gt;1e4?1e4:void 0,progressiveThreshold:s.data&amp;&amp;s.data.length&gt;1e5?1e5:void 0})),optimizedOption.dataZoom&amp;&amp;!1!==noSamplingConfig.enableDataZoomOptimization&amp;&amp;(optimizedOption.dataZoom=(dataZoom=optimizedOption.dataZoom,dataSize=stats.totalPoints,dataZoom?(Array.isArray(dataZoom)?[...dataZoom]:[dataZoom]).map(zoom=&gt;"inside"===zoom.type?{...zoom,throttle:Math.min(100,Math.max(50,dataSize/1e3)),realtime:dataSize&lt;DEFAULT_THRESHOLDS.ANIMATION_DISABLE}:"slider"===zoom.type?{...zoom,dataBackground:!(dataSize&gt;DEFAULT_THRESHOLDS.LARGE_MODE)&amp;&amp;zoom.dataBackground,throttle:Math.min(200,Math.max(100,dataSize/500)),realtime:dataSize&lt;DEFAULT_THRESHOLDS.LARGE_MODE}:zoom):dataZoom)),optimizedOption=((option,dataSize,config)=&gt;{const{enableAnimationOptimization:enableAnimationOptimization=!0}=config;return enableAnimationOptimization?dataSize&gt;DEFAULT_THRESHOLDS.ANIMATION_DISABLE?{...option,animation:!1,animationDuration:0,animationDurationUpdate:0}:dataSize&gt;DEFAULT_THRESHOLDS.LARGE_MODE?{...option,animationDuration:300,animationDurationUpdate:150,animationThreshold:dataSize}:option:option})(optimizedOption,stats.totalPoints,noSamplingConfig),optimizedOption};function createEnhancedTooltip(options){const{showUnit:showUnit=!0,dateFormat:dateFormat="MMM dd, yyyy h:mm a",valueFormatter:valueFormatter=value=&gt;"number"==typeof value?value.toLocaleString(void 0,{minimumFractionDigits:0,maximumFractionDigits:2}):String(value)}={};return{trigger:"axis",axisPointer:{type:"cross",animation:!0,label:{backgroundColor:"#6a7985",borderColor:"#6a7985",borderWidth:1,shadowBlur:0,shadowOffsetX:0,shadowOffsetY:0},lineStyle:{color:"#6a7985",width:1,type:"dashed"},crossStyle:{color:"#6a7985",width:1,type:"dashed"}},backgroundColor:"rgba(50, 50, 50, 0.95)",borderColor:"#444",borderWidth:1,padding:[10,15],textStyle:{color:"#fff",fontSize:13},formatter:params=&gt;{var _a,_b;if(!params||!Array.isArray(params)||0===params.length)return"";const timestamp=params[0].axisValue||params[0].data[0],date=new Date(timestamp);let tooltipContent=`&lt;div style="font-weight: 600; margin-bottom: 8px; font-size: 14px;"&gt;\n        ${format(date,dateFormat)}\n      &lt;/div&gt;`;tooltipContent+='&lt;div style="display: flex; flex-direction: column; gap: 4px;"&gt;',params.forEach(param=&gt;{const{seriesName:seriesName,value:value,color:color,data:data}=param,displayValue=Array.isArray(value)?value[1]:value,unit=(null==data?void 0:data.unit)||param.unit||"",actualValue=(null==data?void 0:data.value)?Array.isArray(data.value)?data.value[1]:data.value:displayValue;tooltipContent+=`\n          &lt;div style="display: flex; align-items: center; justify-content: space-between; min-width: 200px;"&gt;\n            &lt;div style="display: flex; align-items: center;"&gt;\n              ${`&lt;span style="\n          display: inline-block;\n          width: 12px;\n          height: 12px;\n          background-color: ${color};\n          border-radius: 2px;\n          margin-right: 8px;\n          vertical-align: middle;\n          box-shadow: 0 0 0 1px rgba(255,255,255,0.3);\n        "&gt;&lt;/span&gt;`}\n              &lt;span style="color: #ccc; font-size: 12px;"&gt;${seriesName||"Series"}&lt;/span&gt;\n            &lt;/div&gt;\n            &lt;div style="text-align: right; margin-left: 20px;"&gt;\n              &lt;span style="font-weight: 600; font-size: 14px; color: #fff;"&gt;\n                ${valueFormatter(actualValue)}\n              &lt;/span&gt;\n              ${showUnit&amp;&amp;unit?`&lt;span style="color: #999; font-size: 11px; margin-left: 4px;"&gt;${unit}&lt;/span&gt;`:""}\n            &lt;/div&gt;\n          &lt;/div&gt;\n        `}),tooltipContent+="&lt;/div&gt;";const firstParam=params[0];return((null==(_a=firstParam.data)?void 0:_a.metadata)||(null==(_b=firstParam.data)?void 0:_b.tags))&amp;&amp;(tooltipContent+='&lt;div style="margin-top: 8px; padding-top: 8px; border-top: 1px solid #444; font-size: 11px; color: #999;"&gt;',firstParam.data.tags&amp;&amp;(tooltipContent+=`&lt;div&gt;Tags: ${firstParam.data.tags.join(", ")}&lt;/div&gt;`),firstParam.data.metadata&amp;&amp;Object.entries(firstParam.data.metadata).forEach(([key,value])=&gt;{tooltipContent+=`&lt;div&gt;${key}: ${value}&lt;/div&gt;`}),tooltipContent+="&lt;/div&gt;"),tooltipContent}}}const professionalColorPalettes={vibrant:["#4571AF","#00BFA5","#00E5FF","#7C3AED","#EC4899","#F97316","#10B981","#6366F1"],temperature:["#0288D1","#03A9F4","#29B6F6","#FFB74D","#FF7043","#EF5350","#E91E63","#AD1457"],energy:["#00E676","#66BB6A","#43A047","#FFD600","#FFC107","#FF9800","#FF5722","#D84315"],monochrome:[sesColorPalette.primaryDark,sesColorPalette.primary,sesColorPalette.primaryLight,alpha(sesColorPalette.primary,.7),alpha(sesColorPalette.primary,.5),alpha(sesColorPalette.primary,.3)]},professionalChartTheme={backgroundColor:"transparent",textStyle:{color:sesColorPalette.textPrimary,fontFamily:'"Inter", "SF Pro Display", -apple-system, sans-serif',fontSize:12},title:{textStyle:{color:sesColorPalette.textPrimary,fontSize:16,fontWeight:600},subtextStyle:{color:sesColorPalette.textSecondary,fontSize:12},left:"center",top:10},grid:{left:"3%",right:"4%",bottom:"3%",top:"15%",containLabel:!0,borderWidth:0},categoryAxis:{axisLine:{show:!0,lineStyle:{color:alpha(sesColorPalette.primary,.2),width:1.5}},axisTick:{show:!1},axisLabel:{color:sesColorPalette.textSecondary,fontSize:11,margin:12},splitLine:{show:!0,lineStyle:{color:[alpha(sesColorPalette.primary,.08)],type:"dashed"}},splitArea:{show:!1}},valueAxis:{axisLine:{show:!1},axisTick:{show:!1},axisLabel:{color:sesColorPalette.textSecondary,fontSize:11,margin:12,formatter:value=&gt;Math.abs(value)&gt;=1e6?(value/1e6).toFixed(1)+"M":Math.abs(value)&gt;=1e3?(value/1e3).toFixed(1)+"K":value.toFixed(4)},splitLine:{show:!0,lineStyle:{color:[alpha(sesColorPalette.primary,.08)],type:"solid"}}},timeAxis:{axisLine:{show:!0,lineStyle:{color:alpha(sesColorPalette.primary,.2),width:1.5}},axisTick:{show:!1},axisLabel:{color:sesColorPalette.textSecondary,fontSize:11,margin:12},splitLine:{show:!1}},tooltip:{trigger:"axis",backgroundColor:alpha(sesColorPalette.backgroundPaper,.95),borderColor:alpha(sesColorPalette.primary,.2),borderWidth:1,borderRadius:8,padding:[12,16],textStyle:{color:sesColorPalette.textPrimary,fontSize:12},position:function(point,params,dom,rect,size){const x=point[0],y=point[1],tooltipWidth=size.contentSize[0],tooltipHeight=size.contentSize[1],viewWidth=size.viewSize[0],viewHeight=size.viewSize[1];let tooltipX=x+10;tooltipX+tooltipWidth&gt;viewWidth&amp;&amp;(tooltipX=x-tooltipWidth-10);let tooltipY=y+10;return tooltipY+tooltipHeight&gt;viewHeight&amp;&amp;(tooltipY=y-tooltipHeight-10),tooltipX=Math.max(5,Math.min(tooltipX,viewWidth-tooltipWidth-5)),tooltipY=Math.max(5,Math.min(tooltipY,viewHeight-tooltipHeight-5)),[tooltipX,tooltipY]},extraCssText:`\n      backdrop-filter: blur(20px);\n      -webkit-backdrop-filter: blur(20px);\n      box-shadow: 0 8px 32px ${alpha("#000000",.3)};\n      max-height: 400px;\n      overflow-y: auto;\n      min-width: 150px;\n      width: auto;\n    `,formatter:function(params){if(!params)return"";const items=Array.isArray(params)?params:[params];if(0===items.length)return"";let dateLabel="";const firstItem=items[0];if(firstItem)if(firstItem.axisValueLabel)dateLabel=firstItem.axisValueLabel;else if(firstItem.name)dateLabel=firstItem.name;else if(firstItem.axisValue){const timestamp=firstItem.axisValue;dateLabel="number"==typeof timestamp&amp;&amp;timestamp&gt;1e12?new Date(timestamp).toLocaleString():String(timestamp)}else if(firstItem.value&amp;&amp;Array.isArray(firstItem.value)&amp;&amp;firstItem.value[0]){const timestamp=firstItem.value[0];dateLabel="number"==typeof timestamp&amp;&amp;timestamp&gt;1e12?new Date(timestamp).toLocaleString():String(timestamp)}else dateLabel="Data Point";let content=`&lt;div style="font-weight: 600; margin-bottom: 8px;"&gt;${dateLabel}&lt;/div&gt;`;return items.forEach(item=&gt;{let value;value="series"===item.componentType&amp;&amp;"heatmap"===item.seriesType?Array.isArray(item.value)&amp;&amp;item.value.length&gt;=3?item.value[2]:item.value:Array.isArray(item.value)?item.value.length&gt;=2?item.value[1]:item.value[0]:item.value;const formattedValue="number"==typeof value?value.toFixed(4):value,color=item.color||"#888",seriesName=item.seriesName||"Value";content+=`\n          &lt;div style="display: flex; align-items: center; margin: 4px 0;"&gt;\n            &lt;span style="\n              display: inline-block;\n              width: 10px;\n              height: 10px;\n              border-radius: 50%;\n              background: ${color};\n              margin-right: 8px;\n              box-shadow: 0 0 4px ${color};\n            "&gt;&lt;/span&gt;\n            &lt;span style="flex: 1;"&gt;${seriesName}&lt;/span&gt;\n            &lt;span style="font-weight: 600; margin-left: 16px;"&gt;${formattedValue}&lt;/span&gt;\n          &lt;/div&gt;\n        `}),content}},legend:{top:"bottom",textStyle:{color:sesColorPalette.textSecondary,fontSize:12},icon:"roundRect",itemWidth:16,itemHeight:8,itemGap:16,borderRadius:4},line:{smooth:.3,lineStyle:{width:2.5,shadowBlur:4,shadowOffsetY:2},symbol:"circle",symbolSize:6,itemStyle:{borderWidth:2,borderColor:"#fff",shadowBlur:8},areaStyle:{opacity:.15,origin:"start"},emphasis:{scale:1.5,focus:"series",blurScope:"coordinateSystem",lineStyle:{width:3}}},bar:{barMaxWidth:40,borderRadius:[4,4,0,0],itemStyle:{borderRadius:[4,4,0,0],shadowBlur:4,shadowOffsetY:2,shadowColor:alpha("#000000",.1)},emphasis:{itemStyle:{shadowBlur:10,shadowOffsetY:4}}},scatter:{symbolSize:8,itemStyle:{borderWidth:2,borderColor:"#fff",shadowBlur:8},emphasis:{scale:1.5,itemStyle:{shadowBlur:12}}},toolbox:{feature:{dataZoom:{iconStyle:{borderColor:sesColorPalette.textSecondary},emphasis:{iconStyle:{borderColor:sesColorPalette.primary}}},restore:{iconStyle:{borderColor:sesColorPalette.textSecondary},emphasis:{iconStyle:{borderColor:sesColorPalette.primary}}},saveAsImage:{iconStyle:{borderColor:sesColorPalette.textSecondary},emphasis:{iconStyle:{borderColor:sesColorPalette.primary}}}}},dataZoom:[{type:"inside",start:0,end:100,filterMode:"filter"},{type:"slider",start:0,end:100,height:20,bottom:0,borderColor:alpha(sesColorPalette.primary,.2),fillerColor:alpha(sesColorPalette.primary,.3),handleStyle:{color:sesColorPalette.primary,borderColor:sesColorPalette.primary},textStyle:{color:sesColorPalette.textSecondary},emphasis:{handleStyle:{color:sesColorPalette.primaryLight,borderColor:sesColorPalette.primaryLight}}}],visualMap:{color:professionalColorPalettes.temperature,textStyle:{color:sesColorPalette.textSecondary}}},createGradientColor=(color1,color2,direction="vertical")=&gt;({type:"linear",x:0,y:0,x2:"horizontal"===direction?1:0,y2:"horizontal"===direction?0:1,colorStops:[{offset:0,color:color1},{offset:1,color:color2}]}),enhanceChartWithProfessionalTheme=(baseOption,chartType="line",colorPalette="vibrant")=&gt;{var _a,_b,_c,_d;let enhancedOption=((chartOption,colorPalette="vibrant")=&gt;{var _a,_b,_c,_d;const colors=professionalColorPalettes[colorPalette];return{...chartOption,color:colors,backgroundColor:professionalChartTheme.backgroundColor,textStyle:professionalChartTheme.textStyle,title:{...professionalChartTheme.title,...chartOption.title},tooltip:{...professionalChartTheme.tooltip,...chartOption.tooltip},legend:{...professionalChartTheme.legend,...chartOption.legend},grid:{...professionalChartTheme.grid,...chartOption.grid},xAxis:Array.isArray(chartOption.xAxis)?chartOption.xAxis.map(axis=&gt;({...professionalChartTheme["time"===axis.type?"timeAxis":"categoryAxis"],...axis})):{...professionalChartTheme["time"===(null==(_a=chartOption.xAxis)?void 0:_a.type)?"timeAxis":"categoryAxis"],...chartOption.xAxis},yAxis:Array.isArray(chartOption.yAxis)?chartOption.yAxis.map(axis=&gt;({...professionalChartTheme.valueAxis,...axis})):{...professionalChartTheme.valueAxis,...chartOption.yAxis},series:null==(_b=chartOption.series)?void 0:_b.map((serie,index)=&gt;{var _a2;const serieTheme=professionalChartTheme[serie.type]||{},color=colors[index%colors.length];return"line"===serie.type&amp;&amp;serie.areaStyle&amp;&amp;(serie.areaStyle={...serieTheme.areaStyle,...serie.areaStyle,color:createGradientColor(alpha(color,.3),alpha(color,.05))}),{...serieTheme,...serie,itemStyle:{...serieTheme.itemStyle,...serie.itemStyle,color:(null==(_a2=serie.itemStyle)?void 0:_a2.color)||color}}}),toolbox:chartOption.toolbox?{...professionalChartTheme.toolbox,...chartOption.toolbox}:void 0,dataZoom:chartOption.dataZoom||((null==(_c=chartOption.series)?void 0:_c.length)&gt;0&amp;&amp;(null==(_d=chartOption.series[0].data)?void 0:_d.length)&gt;100?professionalChartTheme.dataZoom:void 0)}})(baseOption,colorPalette);switch(chartType){case"line":case"area":enhancedOption={...enhancedOption,grid:{...professionalChartTheme.grid,...enhancedOption.grid},series:null==(_a=enhancedOption.series)?void 0:_a.map(serie=&gt;({...serie,smooth:!1!==serie.smooth&amp;&amp;.3,emphasis:{...professionalChartTheme.line.emphasis,...serie.emphasis}}))};break;case"bar":enhancedOption={...enhancedOption,series:null==(_b=enhancedOption.series)?void 0:_b.map(serie=&gt;({...serie,itemStyle:{...professionalChartTheme.bar.itemStyle,...serie.itemStyle},emphasis:{...professionalChartTheme.bar.emphasis,...serie.emphasis}}))};break;case"scatter":enhancedOption={...enhancedOption,series:null==(_c=enhancedOption.series)?void 0:_c.map(serie=&gt;({...serie,symbolSize:serie.symbolSize||professionalChartTheme.scatter.symbolSize,itemStyle:{...professionalChartTheme.scatter.itemStyle,...serie.itemStyle},emphasis:{...professionalChartTheme.scatter.emphasis,...serie.emphasis}}))};break;case"heatmap":enhancedOption={...enhancedOption,visualMap:enhancedOption.visualMap||{...professionalChartTheme.visualMap,min:0,max:100,calculable:!0,orient:"horizontal",left:"center",bottom:"15%"}};break;case"gauge":enhancedOption={...enhancedOption,series:null==(_d=enhancedOption.series)?void 0:_d.map(serie=&gt;{var _a2;return{...serie,detail:{fontSize:24,fontWeight:600,color:professionalColorPalettes.vibrant[0],...serie.detail},title:{fontSize:14,color:professionalChartTheme.textStyle.color,...serie.title},axisLine:{lineStyle:{width:20,color:[[.3,professionalColorPalettes.energy[0]],[.7,professionalColorPalettes.energy[3]],[1,professionalColorPalettes.energy[6]]],...null==(_a2=serie.axisLine)?void 0:_a2.lineStyle},...serie.axisLine},pointer:{width:6,length:"70%",...serie.pointer}}})}}return enhancedOption.toolbox&amp;&amp;(enhancedOption.toolbox={...professionalChartTheme.toolbox,...enhancedOption.toolbox,right:10,top:10}),enhancedOption.animation=!1!==enhancedOption.animation,enhancedOption.animationDuration=enhancedOption.animationDuration||1e3,enhancedOption.animationEasing=enhancedOption.animationEasing||"cubicOut",enhancedOption};function isSeriesArray(value){return Array.isArray(value)}const fixedCharts=new WeakSet;function fixChartInteractions(chartInstance){var _a;if(chartInstance&amp;&amp;!fixedCharts.has(chartInstance))try{fixedCharts.add(chartInstance);const dom=chartInstance.getDom();if(!dom)return;const originalDispatchAction=chartInstance.dispatchAction;chartInstance.dispatchAction=function(payload){if(payload&amp;&amp;"updateAxisPointer"===payload.type&amp;&amp;"mousemove"===payload.currTrigger){const containerSize=dom.getBoundingClientRect(),chartSize=chartInstance.getWidth();if(Math.abs(containerSize.width-chartSize)&lt;2)return}return originalDispatchAction.call(this,payload)};const option=chartInstance.getOption();option&amp;&amp;!(null==(_a=option.tooltip)?void 0:_a.confine)&amp;&amp;chartInstance.setOption({tooltip:{...option.tooltip,confine:!0,appendToBody:!1,transitionDuration:0}},{notMerge:!1}),dom.style.position="relative",dom.style.zIndex="1";const canvas=dom.querySelector("canvas");canvas&amp;&amp;(canvas.style.position="relative",canvas.style.zIndex="2",canvas.style.transform="none",canvas.style.transition="none")}catch(error){}}function createSafeEChartsOption(baseOption){try{const safeOption={animation:!1,responsive:!0,grid:{left:"3%",right:"4%",bottom:"3%",top:"10%",containLabel:!0,...baseOption.grid},tooltip:{trigger:"axis",axisPointer:{type:"cross",animation:!1},confine:!0,...baseOption.tooltip},...baseOption,xAxis:ensureSafeAxis(baseOption.xAxis,"x"),yAxis:ensureSafeAxis(baseOption.yAxis,"y"),series:ensureSafeSeries(baseOption.series)};return baseOption.dataZoom&amp;&amp;(safeOption.dataZoom=function ensureSafeDataZoom(dataZoom){return(Array.isArray(dataZoom)?dataZoom:[dataZoom]).map(zoom=&gt;({type:"slider",show:!0,start:0,end:100,...zoom,...void 0===(null==zoom?void 0:zoom.start)||isValidPercentage(zoom.start)?{}:{start:0},...void 0===(null==zoom?void 0:zoom.end)||isValidPercentage(zoom.end)?{}:{end:100}}))}(baseOption.dataZoom)),safeOption.series&amp;&amp;Array.isArray(safeOption.series)&amp;&amp;safeOption.series.length&gt;0&amp;&amp;(safeOption.legend={type:"scroll",bottom:0,...baseOption.legend}),safeOption}catch(error){return{title:{text:"Chart Error",subtext:"Unable to render chart",left:"center",top:"center"},grid:{left:"10%",right:"10%",bottom:"10%",top:"10%"}}}}function ensureSafeAxis(axis,type){return Array.isArray(axis)?axis.map(a=&gt;ensureSingleAxis(a,type)):ensureSingleAxis(axis,type)}function ensureSingleAxis(axis,type){return{...{type:"x"===type?"time":"value",axisLine:{show:!0},axisTick:{show:!0},axisLabel:{show:!0,hideOverlap:!0,formatter:void 0},splitLine:{show:"y"===type,lineStyle:{type:"dashed",opacity:.5}}},...axis,...void 0===(null==axis?void 0:axis.min)||isValidNumber(axis.min)?{}:{min:void 0},...void 0===(null==axis?void 0:axis.max)||isValidNumber(axis.max)?{}:{max:void 0}}}function ensureSafeSeries(series){return series?Array.isArray(series)?series.map(s=&gt;ensureSingleSeries(s)).filter(s=&gt;null!==s):[ensureSingleSeries(series)]:[]}function ensureSingleSeries(series){if(!series||"object"!=typeof series)return null;let safeData=[];Array.isArray(series.data)&amp;&amp;(safeData=series.data.filter(point=&gt;Array.isArray(point)?point.length&gt;=2&amp;&amp;isValidNumber(point[0])&amp;&amp;isValidNumber(point[1]):point&amp;&amp;"object"==typeof point));const safeSeries={type:"line",smooth:!0,symbol:"circle",symbolSize:4,large:!0,largeThreshold:2e3,...series,data:safeData,name:series.name?String(series.name):"Series"};return 0===safeData.length&amp;&amp;(safeSeries.label={show:!0,position:"center",formatter:"No data",...series.label}),safeSeries}function isValidNumber(value){return"number"==typeof value&amp;&amp;!isNaN(value)&amp;&amp;isFinite(value)}function isValidPercentage(value){return isValidNumber(value)&amp;&amp;value&gt;=0&amp;&amp;value&lt;=100}function handleEmptyChartData(chartType,option){var _a,_b;const series=option.series;return Array.isArray(series)&amp;&amp;series.some(s=&gt;Array.isArray(s.data)&amp;&amp;s.data.length&gt;0)?option:{...option,title:{text:Array.isArray(option.title)?(null==(_a=option.title[0])?void 0:_a.text)||"":(null==(_b=option.title)?void 0:_b.text)||"",subtext:"No data available for the selected time range",left:"center",top:"40%",textStyle:{fontSize:16,fontWeight:"normal",color:"#999"},subtextStyle:{fontSize:14,color:"#666"},...option.title},xAxis:{...option.xAxis,show:!1},yAxis:{...option.yAxis,show:!1},series:[]}}function addChartErrorBoundaries(option,onError){try{const tooltip=Array.isArray(option.tooltip)?option.tooltip[0]:option.tooltip;if((null==tooltip?void 0:tooltip.formatter)&amp;&amp;"function"==typeof tooltip.formatter){const originalFormatter=tooltip.formatter;tooltip.formatter=function(...args){try{return originalFormatter.apply(this,args)}catch(error){return null==onError||onError(error),"Error formatting tooltip"}}}return["xAxis","yAxis"].forEach(axisKey=&gt;{var _a;const axis=option[axisKey];if(axis&amp;&amp;!Array.isArray(axis)&amp;&amp;(null==(_a=axis.axisLabel)?void 0:_a.formatter)){const originalFormatter=axis.axisLabel.formatter;"function"==typeof originalFormatter&amp;&amp;(axis.axisLabel.formatter=function(...args){try{return originalFormatter.apply(this,args)}catch(error){return null==onError||onError(error),String(args[0])}})}}),option}catch(error){return option}}function optimizeChartPerformance(option,dataSize){const optimized={...option};return dataSize&gt;1e3&amp;&amp;(optimized.animation=!1,optimized.animationDuration=0,optimized.animationEasing=void 0),dataSize&gt;5e3&amp;&amp;(optimized.progressive=400,optimized.progressiveThreshold=3e3),Array.isArray(optimized.series)&amp;&amp;(optimized.series=optimized.series.map(series=&gt;({...series,large:dataSize&gt;2e3,largeThreshold:2e3,progressive:dataSize&gt;1e4?1e3:void 0,progressiveThreshold:3e3}))),optimized}const DEVIATION_COLOR_SCHEMES={standard:{within:"#4CAF50",slightlyBelow:"#81C784",below:"#2196F3",farBelow:"#1565C0",slightlyAbove:"#FFF176",above:"#FFB300",farAbove:"#F44336"},heatmap:{within:"#00FF00",slightlyBelow:"#00FFFF",below:"#0080FF",farBelow:"#0000FF",slightlyAbove:"#FFFF00",above:"#FF8000",farAbove:"#FF0000"},subtle:{within:"#E8F5E9",slightlyBelow:"#E1F5FE",below:"#BBDEFB",farBelow:"#90CAF9",slightlyAbove:"#FFF9C4",above:"#FFE082",farAbove:"#FFCDD2"},monochrome:{within:"#FFFFFF",slightlyBelow:"#E0E0E0",below:"#9E9E9E",farBelow:"#424242",slightlyAbove:"#F5F5F5",above:"#BDBDBD",farAbove:"#212121"}};function calculateDeviation(value,config){const deviation=value-config.setpoint,percentDeviation=deviation/config.setpoint*100,withinTolerance=Math.abs(deviation)&lt;=config.tolerance;let severity;const deviationRatio=Math.abs(deviation)/config.tolerance;severity=withinTolerance?"within":deviation&lt;0?deviationRatio&lt;=2?"slightly-below":deviationRatio&lt;=4?"below":"far-below":deviationRatio&lt;=2?"slightly-above":deviationRatio&lt;=4?"above":"far-above";const color=function getDeviationColor(severity,colorScheme){return colorScheme[{within:"within","slightly-below":"slightlyBelow",below:"below","far-below":"farBelow","slightly-above":"slightlyAbove",above:"above","far-above":"farAbove"}[severity]]}(severity,config.colorScheme||DEVIATION_COLOR_SCHEMES.standard);return{value:value,deviation:deviation,percentDeviation:percentDeviation,severity:severity,color:color,withinTolerance:withinTolerance}}function generateDeviationBands(setpoint,tolerance,timeRange){return[{name:"Upper Tolerance",type:"line",data:[[timeRange.start.getTime(),setpoint+tolerance],[timeRange.end.getTime(),setpoint+tolerance]],lineStyle:{color:"#FFB300",type:"dashed",width:2},symbol:"none"},{name:"Setpoint",type:"line",data:[[timeRange.start.getTime(),setpoint],[timeRange.end.getTime(),setpoint]],lineStyle:{color:"#4CAF50",type:"solid",width:3},symbol:"none"},{name:"Lower Tolerance",type:"line",data:[[timeRange.start.getTime(),setpoint-tolerance],[timeRange.end.getTime(),setpoint-tolerance]],lineStyle:{color:"#2196F3",type:"dashed",width:2},symbol:"none"}]}function generateDeviationZones(setpoint,tolerance,range){return[{name:"Critical High",yAxis:setpoint+2*tolerance,yAxisMax:range.max,itemStyle:{color:"rgba(244, 67, 54, 0.1)"}},{name:"Warning High",yAxis:setpoint+tolerance,yAxisMax:setpoint+2*tolerance,itemStyle:{color:"rgba(255, 179, 0, 0.1)"}},{name:"Normal Range",yAxis:setpoint-tolerance,yAxisMax:setpoint+tolerance,itemStyle:{color:"rgba(76, 175, 80, 0.1)"}},{name:"Warning Low",yAxis:setpoint-2*tolerance,yAxisMax:setpoint-tolerance,itemStyle:{color:"rgba(33, 150, 243, 0.1)"}},{name:"Critical Low",yAxis:range.min,yAxisMax:setpoint-2*tolerance,itemStyle:{color:"rgba(21, 101, 192, 0.1)"}}]}function getRangeComplianceColor(value,min,max,mode="gradient"){if("simple"===mode)return value&lt;min?"#2196F3":value&gt;max?"#F44336":"#4CAF50";const range=max-min;if(value&gt;=min&amp;&amp;value&lt;=max){const position=(value-min)/range;return`rgb(76, ${200+Math.round(55*(1-2*Math.abs(position-.5)))}, 80)`}if(value&lt;min){const deviation=min-value,intensity=Math.min(1,deviation/(.5*range)),blue=150+Math.round(105*intensity);return`rgb(0, ${Math.round(150*(1-intensity))}, ${blue})`}{const deviation=value-max,intensity=Math.min(1,deviation/(.5*range));return`rgb(${150+Math.round(105*intensity)}, ${Math.round(150*(1-intensity))}, 0)`}}function createRangeZones(min,max,chartMin,chartMax){return[{name:"Above Maximum",yAxis:max,yAxisEnd:chartMax,itemStyle:{color:"rgba(244, 67, 54, 0.15)",borderColor:"#F44336",borderWidth:1,borderType:"dashed"}},{name:"Operating Range",yAxis:min,yAxisEnd:max,itemStyle:{color:"rgba(76, 175, 80, 0.15)",borderColor:"#4CAF50",borderWidth:2,borderType:"solid"}},{name:"Below Minimum",yAxis:chartMin,yAxisEnd:min,itemStyle:{color:"rgba(33, 150, 243, 0.15)",borderColor:"#2196F3",borderWidth:1,borderType:"dashed"}}]}const _ChartResizeDebugger=class _ChartResizeDebugger{constructor(){__publicField(this,"debugLog",[]),__publicField(this,"isEnabled",!1),__publicField(this,"maxLogEntries",100),this.isEnabled&amp;&amp;this.setupGlobalListeners()}static getInstance(){return _ChartResizeDebugger.instance||(_ChartResizeDebugger.instance=new _ChartResizeDebugger),_ChartResizeDebugger.instance}setupGlobalListeners(){window.addEventListener("grid-resize",event=&gt;{this.logEvent("grid-resize",event.detail)}),window.addEventListener("resize",()=&gt;{this.logEvent("window-resize",{windowSize:{width:window.innerWidth,height:window.innerHeight}})})}logEvent(eventType,details,containerElement,chartElement,chartId){if(!this.isEnabled)return;const entry={timestamp:Date.now(),containerRect:(null==containerElement?void 0:containerElement.getBoundingClientRect())||null,chartRect:(null==chartElement?void 0:chartElement.getBoundingClientRect())||null,eventType:eventType,chartId:chartId,details:details};this.debugLog.push(entry),this.debugLog.length&gt;this.maxLogEntries&amp;&amp;(this.debugLog=this.debugLog.slice(-this.maxLogEntries)),console.log(`[ChartResize] ${eventType}:`,{chartId:chartId,container:entry.containerRect?{width:Math.round(entry.containerRect.width),height:Math.round(entry.containerRect.height)}:null,chart:entry.chartRect?{width:Math.round(entry.chartRect.width),height:Math.round(entry.chartRect.height)}:null,details:details})}getRecentEvents(count=10){return this.debugLog.slice(-count)}clearLog(){this.debugLog=[]}exportLog(){return JSON.stringify(this.debugLog,null,2)}measureChartHierarchy(chartElement,chartId){if(!this.isEnabled)return;const measurements={chartId:chartId,timestamp:Date.now(),hierarchy:[]};let element=chartElement,level=0;for(;element&amp;&amp;level&lt;10;){const rect=element.getBoundingClientRect(),computedStyle=window.getComputedStyle(element);measurements.hierarchy.push({level:level,tagName:element.tagName,className:element.className,id:element.id,rect:{width:Math.round(rect.width),height:Math.round(rect.height),x:Math.round(rect.x),y:Math.round(rect.y)},styles:{display:computedStyle.display,position:computedStyle.position,width:computedStyle.width,height:computedStyle.height,minWidth:computedStyle.minWidth,minHeight:computedStyle.minHeight,maxWidth:computedStyle.maxWidth,maxHeight:computedStyle.maxHeight,flex:computedStyle.flex,flexBasis:computedStyle.flexBasis,flexGrow:computedStyle.flexGrow,flexShrink:computedStyle.flexShrink}}),element=element.parentElement,level++}console.log(`[ChartResize] Hierarchy for ${chartId}:`,measurements),this.logEvent("hierarchy-measurement",measurements)}};__publicField(_ChartResizeDebugger,"instance");const chartResizeDebugger=_ChartResizeDebugger.getInstance(),downloadFile=(blob,filename)=&gt;{const url=URL.createObjectURL(blob),link=document.createElement("a");link.href=url,link.download=filename,document.body.appendChild(link),link.click(),document.body.removeChild(link),URL.revokeObjectURL(url)},formatDateForExport=(date,format2="iso")=&gt;{const d=new Date(date);switch(format2){case"local":return d.toLocaleString();case"timestamp":return d.getTime().toString();default:return d.toISOString()}},formatNumberForExport=(value,precision=2)=&gt;{if(null==value||""===value)return"";const num="string"==typeof value?parseFloat(value):value;return isNaN(num)?String(value):num.toFixed(precision)},exportChartAsImage=async(chartInstance,options={})=&gt;{const{filename:filename=`chart_${(new Date).toISOString().slice(0,19).replace(/[:.]/g,"-")}`,format:format2="png",quality:quality=1,backgroundColor:backgroundColor="#ffffff",pixelRatio:pixelRatio=2,width:width,height:height}=options;try{let dataURL;if("svg"===format2){dataURL=chartInstance.renderToSVGString();const blob=new Blob([dataURL],{type:"image/svg+xml"});downloadFile(blob,`${filename}.svg`)}else{const canvas=chartInstance.getDom().querySelector("canvas");if(!canvas)throw new Error("Chart canvas not found");const exportCanvas=document.createElement("canvas"),ctx=exportCanvas.getContext("2d");exportCanvas.width=width||canvas.width,exportCanvas.height=height||canvas.height,ctx.fillStyle=backgroundColor,ctx.fillRect(0,0,exportCanvas.width,exportCanvas.height),ctx.drawImage(canvas,0,0,exportCanvas.width,exportCanvas.height),dataURL=exportCanvas.toDataURL(`image/${format2}`,quality);const response=await fetch(dataURL),blob=await response.blob();downloadFile(blob,`${filename}.${format2}`)}console.log(`Chart exported successfully as ${filename}.${format2}`)}catch(error){throw console.error("Error exporting chart:",error),new Error(`Failed to export chart: ${error instanceof Error?error.message:"Unknown error"}`)}},exportTimeseriesAsCSV=(data,options={})=&gt;{const{filename:filename=`timeseries_${(new Date).toISOString().slice(0,19).replace(/[:.]/g,"-")}.csv`,includeHeaders:includeHeaders=!0,delimiter:delimiter=",",dateFormat:dateFormat="iso",precision:precision=2,includeUnits:includeUnits=!0,includeQuality:includeQuality=!1}=options;try{if(!data||0===data.length)throw new Error("No data to export");const lines=[];if(includeHeaders){const headers=["Timestamp","Value"];includeUnits&amp;&amp;data.some(d=&gt;d.unit)&amp;&amp;headers.push("Unit"),includeQuality&amp;&amp;data.some(d=&gt;d.quality)&amp;&amp;headers.push("Quality"),data.some(d=&gt;d.pointName)&amp;&amp;headers.push("Point Name"),lines.push(headers.join(delimiter))}data.forEach(point=&gt;{const row=[`"${formatDateForExport(point.timestamp,dateFormat)}"`,`"${formatNumberForExport(point.value,precision)}"`];includeUnits&amp;&amp;data.some(d=&gt;d.unit)&amp;&amp;row.push(`"${point.unit||""}"`),includeQuality&amp;&amp;data.some(d=&gt;d.quality)&amp;&amp;row.push(`"${point.quality||""}"`),data.some(d=&gt;d.pointName)&amp;&amp;row.push(`"${point.pointName||""}"`),lines.push(row.join(delimiter))});const csvContent=lines.join("\n"),blob=new Blob([csvContent],{type:"text/csv;charset=utf-8"});downloadFile(blob,filename),console.log(`Timeseries data exported successfully as ${filename}`)}catch(error){throw console.error("Error exporting timeseries as CSV:",error),new Error(`Failed to export CSV: ${error instanceof Error?error.message:"Unknown error"}`)}},exportTimeseriesAsJSON=(data,filename,formatted=!0)=&gt;{const exportFilename=filename||`timeseries_${(new Date).toISOString().slice(0,19).replace(/[:.]/g,"-")}.json`;try{if(!data||0===data.length)throw new Error("No data to export");const exportData={exportedAt:(new Date).toISOString(),dataPoints:data.length,data:data},jsonContent=formatted?JSON.stringify(exportData,null,2):JSON.stringify(exportData),blob=new Blob([jsonContent],{type:"application/json;charset=utf-8"});downloadFile(blob,exportFilename),console.log(`Timeseries data exported successfully as ${exportFilename}`)}catch(error){throw console.error("Error exporting timeseries as JSON:",error),new Error(`Failed to export JSON: ${error instanceof Error?error.message:"Unknown error"}`)}};const CHART_TYPE_MAP={TimeSeries:"timeseries",AreaChart:"area",StackedArea:"stackedArea",BarChart:"bar",LineChart:"line",Scatter:"scatter",BoxPlot:"boxPlot",Candlestick:"candlestick",Heatmap:"heatmap",DeviceDeviationHeatmap:"deviceDeviationHeatmap",CalendarYearHeatmap:"calendarHeatmap",CalendarHeatmap:"calendarHeatmap",Gauge:"gauge",Radar:"radar",TimelineChart:"timeline",Sankey:"sankey",Treemap:"treemap",ControlBand:"controlBand",SPC:"spc",PerfectEconomizer:"perfectEconomizer",Psychrometric:"psychrometric",VAVComprehensive:"vav",ParallelCoordinates:"parallel"};function extractEnhancedChartData(chartInstance,config){const option=chartInstance.getOption(),data=[];if(!option||!option.series)return data;const zoomState=function getZoomState(chartInstance){var _a,_b,_c,_d,_e,_f;const option=chartInstance.getOption();if(option.dataZoom&amp;&amp;Array.isArray(option.dataZoom))for(const zoom of option.dataZoom)if(void 0!==zoom.start||void 0!==zoom.startValue)return{startValue:zoom.startValue,endValue:zoom.endValue,startIndex:Math.floor((zoom.start||0)/100*((null==(_c=null==(_b=null==(_a=option.xAxis)?void 0:_a[0])?void 0:_b.data)?void 0:_c.length)||0)),endIndex:Math.ceil((zoom.end||100)/100*((null==(_f=null==(_e=null==(_d=option.xAxis)?void 0:_d[0])?void 0:_e.data)?void 0:_f.length)||0))};if(option.brush&amp;&amp;option.brush.areas&amp;&amp;option.brush.areas.length&gt;0){const area=option.brush.areas[0];if(area.coordRange)return{startValue:area.coordRange[0][0],endValue:area.coordRange[0][1]}}return{}}(chartInstance),series=Array.isArray(option.series)?option.series:[option.series],normalizedType=CHART_TYPE_MAP[config.chartType]||config.chartType;return series.forEach(s=&gt;{var _a,_b;if(!s.data)return;const filteredData=function filterDataByZoom(data,zoomState,xAxisData){return zoomState.startValue||zoomState.startIndex?void 0!==zoomState.startIndex&amp;&amp;void 0!==zoomState.endIndex?data.slice(zoomState.startIndex,zoomState.endIndex):void 0!==zoomState.startValue&amp;&amp;void 0!==zoomState.endValue?data.filter(item=&gt;{var _a;const xValue=Array.isArray(item)?item[0]:(null==(_a=item.value)?void 0:_a[0])||item.x;return xValue&gt;=zoomState.startValue&amp;&amp;xValue&lt;=zoomState.endValue}):data:data}(s.data,zoomState,null==(_b=null==(_a=option.xAxis)?void 0:_a[0])||_b.data);switch(normalizedType){case"timeseries":case"line":case"area":case"stackedArea":default:data.push(...extractTimeSeriesData(s,filteredData,option));break;case"bar":data.push(...function extractBarChartData(series,data,option,config){var _a,_b;const results=[],categories=(null==(_b=null==(_a=option.xAxis)?void 0:_a[0])?void 0:_b.data)||[];return data.forEach((value,index)=&gt;{var _a2,_b2;const actualValue="number"==typeof value?value:value.value;results.push({xCategory:categories[index]||`Category ${index}`,value:actualValue,pointName:series.name,unit:series.unit||(null==(_b2=null==(_a2=option.yAxis)?void 0:_a2[0])?void 0:_b2.name)})}),results}(s,filteredData,option));break;case"heatmap":case"deviceDeviationHeatmap":data.push(...function extractHeatmapData(series,data,option,config){var _a,_b,_c,_d,_e,_f,_g;const results=[],xAxis=(null==(_b=null==(_a=option.xAxis)?void 0:_a[0])?void 0:_b.data)||[],yAxis=(null==(_d=null==(_c=option.yAxis)?void 0:_c[0])?void 0:_d.data)||[],deviceConfigs=(null==(_e=config.customFields)?void 0:_e.deviceConfigs)||[],rawSeries=(null==(_f=config.customFields)?void 0:_f.rawSeries)||[],deviationMethod=(null==(_g=config.customFields)?void 0:_g.deviationMethod)||"auto",deviceStats=new Map;return rawSeries.forEach(s=&gt;{if(s.data&amp;&amp;s.data.length&gt;0){const values=s.data.map(p=&gt;p[1]),sorted=[...values].sort((a,b)=&gt;a-b),n=sorted.length,mean=values.reduce((sum,v)=&gt;sum+v,0)/n,median=n%2==0?(sorted[n/2-1]+sorted[n/2])/2:sorted[Math.floor(n/2)],q1=sorted[Math.floor(.25*n)],q3=sorted[Math.floor(.75*n)],iqr=q3-q1,variance=values.reduce((sum,v)=&gt;sum+Math.pow(v-mean,2),0)/n,stdDev=Math.sqrt(variance),min=sorted[0],max=sorted[n-1],range=max-min;deviceStats.set(s.name,{mean:mean,median:median,stdDev:stdDev,min:min,max:max,range:range,q1:q1,q3:q3,iqr:iqr})}}),data.forEach(item=&gt;{const[xIndex,yIndex,deviationValue]=Array.isArray(item)?item:item.value||[0,0,0],timestamp=xAxis[xIndex],deviceName=yAxis[yIndex],deviceConfig=deviceConfigs.find(c=&gt;c.deviceName===deviceName),stats=deviceStats.get(deviceName);let targetValue,actualValue=deviationValue,deviationFromTarget=deviationValue,deviationDescription="";if(deviceConfig&amp;&amp;void 0!==deviceConfig.targetValue){targetValue=deviceConfig.targetValue;actualValue=targetValue+deviationValue*(deviceConfig.tolerance||.1*targetValue),deviationFromTarget=actualValue-targetValue,deviationDescription=`${deviationFromTarget&gt;=0?"+":""}${deviationFromTarget.toFixed(4)} from target ${targetValue.toFixed(4)}`}else if(stats){let baseValue=stats.mean,scaleFactor=stats.stdDev,methodDesc="";switch(deviationMethod){case"median":baseValue=stats.median,scaleFactor=stats.iqr/1.35,methodDesc="MAD from median";break;case"minmax":baseValue=(stats.min+stats.max)/2,scaleFactor=stats.range/4,methodDesc="position in range";break;case"percentage":scaleFactor=.5*Math.abs(stats.mean),methodDesc="% from mean";break;case"iqr":baseValue=stats.median,scaleFactor=stats.iqr,methodDesc="IQRs from median";break;default:methodDesc="std devs from mean"}actualValue=baseValue+deviationValue*scaleFactor,targetValue=baseValue,deviationFromTarget=actualValue-baseValue,deviationDescription=`${deviationValue.toFixed(2)} ${methodDesc} (${baseValue.toFixed(4)})`}const status=Math.abs(deviationValue)&lt;.5?"NORMAL":Math.abs(deviationValue)&lt;1?"CAUTION":Math.abs(deviationValue)&lt;1.5?"WARNING":"CRITICAL";results.push({timestamp:timestamp?new Date(timestamp):void 0,value:actualValue,xCategory:timestamp,yCategory:deviceName,deviation:deviationValue,deviationPercentage:100*deviationValue,deviationFromTarget:deviationFromTarget,intensity:Math.abs(deviationValue),inRange:Math.abs(deviationValue)&lt;.5,pointName:deviceName,unit:null==deviceConfig?void 0:deviceConfig.unit,minValue:(null==deviceConfig?void 0:deviceConfig.minValue)||(null==stats?void 0:stats.mean)-2*((null==stats?void 0:stats.stdDev)||0),maxValue:(null==deviceConfig?void 0:deviceConfig.maxValue)||(null==stats?void 0:stats.mean)+2*((null==stats?void 0:stats.stdDev)||0),originalValue:targetValue,annotations:[deviationDescription,`Status: ${status}`,`Method: ${deviationMethod}`,`Raw Value: ${actualValue.toFixed(4)}`]})}),results}(0,filteredData,option,config));break;case"boxPlot":case"psychrometric":case"candlestick":case"radar":case"scatter":case"gauge":case"sankey":case"treemap":data.push();break;case"controlBand":case"spc":data.push(...function extractSPCData(series,data,option,config){const results=[],values=data.map(d=&gt;Array.isArray(d)?d[1]:d.value),stats=calculateStatistics(values),ucl=stats.mean+3*stats.stdDev,lcl=stats.mean-3*stats.stdDev,uwl=stats.mean+2*stats.stdDev,lwl=stats.mean-2*stats.stdDev;series.targetValue||stats.mean;const usl=series.upperSpecLimit||ucl,lsl=series.lowerSpecLimit||lcl,cp=(usl-lsl)/(6*stats.stdDev),cpk=Math.min((usl-stats.mean)/(3*stats.stdDev),(stats.mean-lsl)/(3*stats.stdDev));return data.forEach(item=&gt;{const value=Array.isArray(item)?item[1]:item.value,timestamp=Array.isArray(item)?new Date(item[0]):new Date(item.name||item.x);let violation="none";value&gt;ucl||value&lt;lcl?violation="control":(value&gt;uwl||value&lt;lwl)&amp;&amp;(violation="warning"),results.push({timestamp:timestamp,value:value,pointName:series.name,unit:series.unit,controlLimitUpper:ucl,controlLimitLower:lcl,warningLimitUpper:uwl,warningLimitLower:lwl,violation:violation,cp:cp,cpk:cpk,avgValue:stats.mean,deviation:value-stats.mean})}),results}(s,filteredData));break;case"perfectEconomizer":data.push(...function extractPerfectEconomizerData(series,data,option,config){const results=[];return data.forEach(item=&gt;{const[timestamp,oat,rat,mat]=Array.isArray(item)?item:[null,0,0,0],shouldEconomize=oat&lt;rat-2,potentialSavings=shouldEconomize?1.08*(rat-oat):0;results.push({timestamp:timestamp?new Date(timestamp):void 0,value:mat,temperature:oat,originalValue:rat,deviation:mat-(oat+rat)/2,efficiency:shouldEconomize?potentialSavings:0,inRange:shouldEconomize,pointName:series.name})}),results}(s,filteredData));break;case"vav":data.push(...function extractVAVData(series,data,option,config){const results=[];return data.forEach(item=&gt;{const[timestamp,damperPos,airflow,setpoint,actualTemp]=Array.isArray(item)?item:[null,0,0,0,0],efficiency=airflow&gt;0?damperPos/airflow*100:0;results.push({timestamp:timestamp?new Date(timestamp):void 0,value:actualTemp,damperPosition:damperPos,airflow:airflow,setpoint:setpoint,actualTemp:actualTemp,efficiency:efficiency,deviation:actualTemp-setpoint,inRange:Math.abs(actualTemp-setpoint)&lt;=2,pointName:series.name})}),results}(s,filteredData));break;case"timeline":data.push(...function extractTimelineData(series,data,option,config){const results=[];return data.forEach(item=&gt;{const[category,startTime,endTime,value]=Array.isArray(item)?item:[null,0,0,0],duration=endTime-startTime;results.push({timestamp:new Date(startTime),value:value||duration,xCategory:category,minValue:startTime,maxValue:endTime,pointName:series.name})}),results}(s,filteredData));break;case"calendarHeatmap":data.push(...function extractCalendarData(series,data,option,config){const results=[];return data.forEach(item=&gt;{const[date,value]=Array.isArray(item)?item:[item.date,item.value];results.push({timestamp:new Date(date),value:value,pointName:series.name,unit:series.unit})}),results}(s,filteredData));break;case"parallel":data.push(...function extractParallelData(series,data,option,config){const results=[],dimensions=option.parallelAxis||[];return data.forEach((item,index)=&gt;{const values=Array.isArray(item)?item:item.value;dimensions.forEach((dim,dimIndex)=&gt;{results.push({xCategory:`Item ${index}`,yCategory:dim.name,value:values[dimIndex],pointName:series.name})})}),results}(s,filteredData,option))}}),data}function extractTimeSeriesData(series,data,option,config){const results=[],stats=calculateStatistics(data.map(d=&gt;Array.isArray(d)?d[1]:d.value));return data.forEach(item=&gt;{var _a,_b;const value=Array.isArray(item)?item[1]:item.value,timestamp=Array.isArray(item)?new Date(item[0]):new Date(item.name||item.x);results.push({timestamp:timestamp,value:value,pointName:series.name,unit:series.unit||(null==(_b=null==(_a=option.yAxis)?void 0:_a[0])?void 0:_b.name),minValue:stats.min,maxValue:stats.max,avgValue:stats.mean,median:stats.median,deviation:value-stats.mean,deviationPercentage:(value-stats.mean)/stats.mean*100})}),results}function calculateStatistics(values){if(0===values.length)return{min:0,max:0,mean:0,median:0,stdDev:0,q1:0,q3:0};const sorted=[...values].sort((a,b)=&gt;a-b),mean=values.reduce((a,b)=&gt;a+b,0)/values.length,variance=values.reduce((acc,val)=&gt;acc+Math.pow(val-mean,2),0)/values.length,stdDev=Math.sqrt(variance),q1Index=Math.floor(.25*sorted.length),q3Index=Math.floor(.75*sorted.length),medianIndex=Math.floor(.5*sorted.length);return{min:sorted[0],max:sorted[sorted.length-1],mean:mean,median:sorted[medianIndex],stdDev:stdDev,q1:sorted[q1Index],q3:sorted[q3Index]}}function exportChartWithCalculations(chartInstance,chartType,filename){const config={chartType:chartType,precision:3,dateFormat:"yyyy-MM-dd h:mm:ss a"},data=extractEnhancedChartData(chartInstance,config);if(0===data.length)throw new Error("No data available in the current view. Please ensure data is visible in the chart.");!function exportEnhancedCSV(data,filename,config){if(0===data.length)throw new Error("No data to export");const headers=[],sampleRow=data[0];sampleRow.timestamp&amp;&amp;headers.push("Timestamp"),sampleRow.xCategory&amp;&amp;headers.push("Category"),sampleRow.yCategory&amp;&amp;headers.push("Y-Category"),sampleRow.pointName&amp;&amp;headers.push("Series"),headers.push("Value"),sampleRow.unit&amp;&amp;headers.push("Unit"),void 0!==sampleRow.deviation&amp;&amp;headers.push("Deviation"),void 0!==sampleRow.deviationPercentage&amp;&amp;headers.push("Deviation %"),void 0!==sampleRow.minValue&amp;&amp;headers.push("Min"),void 0!==sampleRow.maxValue&amp;&amp;headers.push("Max"),void 0!==sampleRow.avgValue&amp;&amp;headers.push("Average"),void 0!==sampleRow.median&amp;&amp;headers.push("Median"),void 0!==sampleRow.controlLimitUpper&amp;&amp;headers.push("UCL","LCL","UWL","LWL","Violation","Cp","Cpk"),void 0!==sampleRow.damperPosition&amp;&amp;headers.push("Damper %","Airflow","Setpoint","Actual Temp","Efficiency");const rows=[headers.join(",")];data.forEach(row=&gt;{var _a,_b,_c,_d,_e,_f;const values=[];row.timestamp&amp;&amp;values.push(format(row.timestamp,config.dateFormat||"yyyy-MM-dd HH:mm:ss")),row.xCategory&amp;&amp;values.push(row.xCategory),row.yCategory&amp;&amp;values.push(row.yCategory),row.pointName&amp;&amp;values.push(row.pointName),values.push(row.value.toFixed(config.precision||2)),row.unit&amp;&amp;values.push(row.unit),void 0!==row.deviation&amp;&amp;values.push(row.deviation.toFixed(config.precision||2)),void 0!==row.deviationPercentage&amp;&amp;values.push(row.deviationPercentage.toFixed(1)),void 0!==row.minValue&amp;&amp;values.push(row.minValue.toFixed(config.precision||2)),void 0!==row.maxValue&amp;&amp;values.push(row.maxValue.toFixed(config.precision||2)),void 0!==row.avgValue&amp;&amp;values.push(row.avgValue.toFixed(config.precision||2)),void 0!==row.median&amp;&amp;values.push(row.median.toFixed(config.precision||2)),void 0!==row.controlLimitUpper&amp;&amp;values.push(row.controlLimitUpper.toFixed(2),row.controlLimitLower.toFixed(2),row.warningLimitUpper.toFixed(2),row.warningLimitLower.toFixed(2),row.violation||"none",(null==(_a=row.cp)?void 0:_a.toFixed(3))||"",(null==(_b=row.cpk)?void 0:_b.toFixed(3))||""),void 0!==row.damperPosition&amp;&amp;values.push(row.damperPosition.toFixed(1),(null==(_c=row.airflow)?void 0:_c.toFixed(0))||"",(null==(_d=row.setpoint)?void 0:_d.toFixed(1))||"",(null==(_e=row.actualTemp)?void 0:_e.toFixed(1))||"",(null==(_f=row.efficiency)?void 0:_f.toFixed(1))||""),rows.push(values.map(v=&gt;`"${v}"`).join(","))});const csvContent=rows.join("\n"),blob=new Blob([csvContent],{type:"text/csv;charset=utf-8;"}),link=document.createElement("a");link.href=URL.createObjectURL(blob),link.download=filename,link.click(),URL.revokeObjectURL(link.href)}(data,filename||`${chartType}_export_${(new Date).getTime()}.csv`,config)}const Z_INDEX_CONFIG={CHART_EXPORT_TOOLBAR:15},DISTINCT_COLORS=["#00D9FF","#FF6B6B","#4ECDC4","#FFE66D","#A8E6CF","#FF8B94","#B4A7D6","#FFD93D","#6BCF7F","#C7CEEA","#FFDAB9","#98D8C8","#F7DC6F","#BB8FCE","#85C1E2","#F8B195","#C1E1DC","#FFB6C1","#DDA0DD","#98FB98"],HIGH_CONTRAST_COLORS=["#FF0000","#00FF00","#0000FF","#FFFF00","#FF00FF","#00FFFF","#FF8C00","#FF1493","#00CED1","#FFD700","#32CD32","#BA55D3","#FF4500","#1E90FF","#FF69B4","#00FA9A","#DC143C","#00BFFF","#FF6347","#7FFF00"],DARK_THEME_COLORS={primary:"#00D9FF",secondary:"#FF6B6B",success:"#4ECDC4",warning:"#FFE66D",error:"#FF6B6B",info:"#A8E6CF",background:"rgba(18, 18, 18, 0.9)",surface:"rgba(255, 255, 255, 0.05)",text:{primary:"#FFFFFF",secondary:"rgba(255, 255, 255, 0.7)",disabled:"rgba(255, 255, 255, 0.5)"},grid:"rgba(255, 255, 255, 0.1)",border:"rgba(255, 255, 255, 0.2)"},THRESHOLD_COLORS_warning="#FFB84D",HEATMAP_COLOR_SCALES={temperature:[{value:0,color:"#0000FF"},{value:.25,color:"#00FFFF"},{value:.5,color:"#00FF00"},{value:.75,color:"#FFFF00"},{value:1,color:"#FF0000"}],efficiency:[{value:0,color:"#D32F2F"},{value:.25,color:"#F57C00"},{value:.5,color:"#FBC02D"},{value:.75,color:"#689F38"},{value:1,color:"#388E3C"}],deviation:[{value:-1,color:"#1976D2"},{value:-.5,color:"#42A5F5"},{value:0,color:"#66BB6A"},{value:.5,color:"#FFA726"},{value:1,color:"#EF5350"}]};function getDistinctColor(index){return DISTINCT_COLORS[index%DISTINCT_COLORS.length]}function getDistinctColors(count){if(count&lt;=DISTINCT_COLORS.length)return DISTINCT_COLORS.slice(0,count);const colors=[];for(let i=0;i&lt;count;i++)colors.push(getDistinctColor(i));return colors}function generateColorScale(minValue,maxValue,colorStops){const range=maxValue-minValue;return colorStops.map(stop=&gt;({value:minValue+stop.value*range,color:stop.color}))}const getAdaptiveLineWidth=(seriesCount,userPreference)=&gt;seriesCount&lt;=2?2.5:seriesCount&lt;=4?2:seriesCount&lt;=6?1.5:seriesCount&lt;=10?1.2:1,getAdaptiveSymbolSize=(seriesCount,baseSize=6)=&gt;seriesCount&lt;=3?baseSize:seriesCount&lt;=6?.8*baseSize:seriesCount&lt;=10?.6*baseSize:0;function createThresholdLine(threshold){return{yAxis:threshold.value,label:{show:!0,position:"end",formatter:threshold.label,color:threshold.color||THRESHOLD_COLORS_warning,fontSize:12,padding:[4,8],backgroundColor:"rgba(0, 0, 0, 0.7)",borderRadius:4},lineStyle:{color:threshold.color||THRESHOLD_COLORS_warning,type:threshold.lineStyle||"dashed",width:2,shadowBlur:4,shadowColor:threshold.color||THRESHOLD_COLORS_warning}}}function createThresholdZones(zones){return zones.map(zone=&gt;[{yAxis:zone.min,itemStyle:{color:zone.color,opacity:zone.opacity||.1}},{yAxis:zone.max,itemStyle:{color:zone.color,opacity:zone.opacity||.1}}])}function createGaugeThresholds(min,max,zones){const range=max-min;return zones.map(zone=&gt;({start:(zone.min-min)/range*100,end:(zone.max-min)/range*100,color:zone.color}))}function formatPointWithTags(point,options){const{maxTags:maxTags=3,separator:separator=" • ",includeUnit:includeUnit=!0}=options||{};let display=point.name;if(point.markerTags&amp;&amp;point.markerTags.length&gt;0){const relevantTags=function getRelevantTags(tags){const priorityTags=["ahu","vav","chiller","boiler","pump","fan","temp","temperature","pressure","flow","humidity","co2","power","energy","zone","room","floor","building","alarm","status","enable","command","setpoint","sensor"],relevantTags=[];for(const tag of tags){const lowerTag=tag.toLowerCase();priorityTags.some(p=&gt;lowerTag.includes(p))&amp;&amp;relevantTags.push(tag)}for(const tag of tags)relevantTags.includes(tag)||relevantTags.push(tag);return relevantTags}(point.markerTags).slice(0,maxTags);relevantTags.length&gt;0&amp;&amp;(display+=` [${relevantTags.join(", ")}]`)}return includeUnit&amp;&amp;point.unit&amp;&amp;(display+=` (${point.unit})`),display}const SES_COLORS_primary="#4571AF",SES_COLORS_primaryDark="#19437F",SES_COLORS_secondary="#00BFA5",SES_COLORS_accent="#00E5FF",SES_COLORS_light="#6FA0D8",enhanceChart=(options,chartType)=&gt;{let enhanced={...options};if(enhanced.tooltip=((tooltip={})=&gt;({...tooltip,backgroundColor:"rgba(10, 14, 39, 0.95)",borderColor:"rgba(69, 113, 175, 0.3)",borderWidth:1,textStyle:{...tooltip.textStyle,color:"rgba(255, 255, 255, 0.9)",fontSize:13},extraCssText:"backdrop-filter: blur(10px); box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);"}))(enhanced.tooltip),enhanced.grid=((grid={})=&gt;({left:"3%",right:"4%",bottom:"3%",top:"10%",containLabel:!0,...grid}))(enhanced.grid),chartType&amp;&amp;"string"==typeof chartType)switch(chartType.toLowerCase()){case"line":enhanced=(options=&gt;({...options,series:Array.isArray(options.series)?options.series.map(series=&gt;{var _a,_b,_c,_d,_e,_f,_g,_h;return{...series,lineStyle:{...series.lineStyle,width:(null==(_a=series.lineStyle)?void 0:_a.width)||2,shadowColor:(null==(_b=series.itemStyle)?void 0:_b.color)||SES_COLORS_primary,shadowBlur:10,shadowOffsetY:2},itemStyle:{...series.itemStyle,shadowColor:(null==(_c=series.itemStyle)?void 0:_c.color)||SES_COLORS_primary,shadowBlur:20,borderColor:(null==(_d=series.itemStyle)?void 0:_d.color)||SES_COLORS_primary,borderWidth:2},emphasis:{...series.emphasis,scale:1.5,lineStyle:{...null==(_e=series.emphasis)?void 0:_e.lineStyle,width:((null==(_f=series.lineStyle)?void 0:_f.width)||2)+1,shadowBlur:20}},areaStyle:series.areaStyle?{...series.areaStyle,opacity:.3,color:{type:"linear",x:0,y:0,x2:0,y2:1,colorStops:[{offset:0,color:`${(null==(_g=series.itemStyle)?void 0:_g.color)||SES_COLORS_primary}88`},{offset:1,color:`${(null==(_h=series.itemStyle)?void 0:_h.color)||SES_COLORS_primary}11`}]}}:void 0}}):options.series}))(enhanced);break;case"bar":enhanced=(options=&gt;({...options,series:Array.isArray(options.series)?options.series.map(series=&gt;{var _a,_b,_c,_d;return{...series,itemStyle:{...series.itemStyle,borderRadius:[4,4,0,0],color:{type:"linear",x:0,y:0,x2:0,y2:1,colorStops:[{offset:0,color:(null==(_a=series.itemStyle)?void 0:_a.color)||SES_COLORS_primary},{offset:1,color:(null==(_b=series.itemStyle)?void 0:_b.color)||SES_COLORS_primaryDark}]},shadowColor:"rgba(0, 0, 0, 0.3)",shadowBlur:10,shadowOffsetY:5},emphasis:{...series.emphasis,itemStyle:{...null==(_c=series.emphasis)?void 0:_c.itemStyle,shadowColor:(null==(_d=series.itemStyle)?void 0:_d.color)||SES_COLORS_primary,shadowBlur:20,shadowOffsetY:0}}}}):options.series}))(enhanced);break;case"gauge":enhanced=(options=&gt;{const enhancedOptions={...options};return enhancedOptions.series&amp;&amp;Array.isArray(enhancedOptions.series)&amp;&amp;(enhancedOptions.series=enhancedOptions.series.map(series=&gt;{var _a,_b,_c,_d;return{...series,axisLine:{...series.axisLine,lineStyle:{...null==(_a=series.axisLine)?void 0:_a.lineStyle,color:[[.3,SES_COLORS_secondary],[.7,SES_COLORS_primary],[1,SES_COLORS_primaryDark]],shadowColor:"rgba(0, 0, 0, 0.5)",shadowBlur:15,shadowOffsetY:5}},pointer:{...series.pointer,itemStyle:{...null==(_b=series.pointer)?void 0:_b.itemStyle,color:SES_COLORS_accent,shadowColor:SES_COLORS_accent,shadowBlur:20,shadowOffsetY:0}},detail:{...series.detail,textStyle:{...null==(_c=series.detail)?void 0:_c.textStyle,color:"#fff",fontSize:20,fontWeight:"bold",textShadowColor:SES_COLORS_primary,textShadowBlur:10}},title:{...series.title,textStyle:{...null==(_d=series.title)?void 0:_d.textStyle,color:"rgba(255, 255, 255, 0.8)",fontSize:14}}}})),enhancedOptions})(enhanced);break;case"pie":case"donut":enhanced=(options=&gt;({...options,series:Array.isArray(options.series)?options.series.map(series=&gt;{var _a,_b;return{...series,itemStyle:{...series.itemStyle,borderRadius:5,borderColor:"rgba(255, 255, 255, 0.1)",borderWidth:2,shadowColor:"rgba(0, 0, 0, 0.3)",shadowBlur:15,shadowOffsetY:5},emphasis:{...series.emphasis,scale:!0,scaleSize:10,itemStyle:{...null==(_a=series.emphasis)?void 0:_a.itemStyle,shadowColor:SES_COLORS_primary,shadowBlur:25,shadowOffsetY:0}},label:{...series.label,textStyle:{...null==(_b=series.label)?void 0:_b.textStyle,color:"#fff",textShadowColor:"rgba(0, 0, 0, 0.5)",textShadowBlur:3,textShadowOffsetY:1}}}}):options.series}))(enhanced);break;case"heatmap":enhanced=(options=&gt;{const enhancedOptions={...options};return enhancedOptions.visualMap&amp;&amp;(enhancedOptions.visualMap={...enhancedOptions.visualMap,inRange:{color:["#0a1929",SES_COLORS_primaryDark,SES_COLORS_primary,SES_COLORS_light,SES_COLORS_secondary,SES_COLORS_accent]},textStyle:{color:"rgba(255, 255, 255, 0.8)"}}),enhancedOptions})(enhanced);break;case"scatter":enhanced=(options=&gt;({...options,series:Array.isArray(options.series)?options.series.map(series=&gt;{var _a,_b;return{...series,itemStyle:{...series.itemStyle,shadowColor:(null==(_a=series.itemStyle)?void 0:_a.color)||SES_COLORS_primary,shadowBlur:15,opacity:.8},emphasis:{...series.emphasis,scale:1.5,itemStyle:{...null==(_b=series.emphasis)?void 0:_b.itemStyle,shadowBlur:25,opacity:1}}}}):options.series}))(enhanced)}return enhanced.animation=!0,enhanced.animationDuration=1e3,enhanced.animationEasing="cubicOut",enhanced.animationDelay=idx=&gt;50*idx,enhanced},formatNumberForDisplay=(value,precision=2,unit)=&gt;null==value||isNaN(value)?"N/A":Math.abs(value)&gt;=1e6?`${(value/1e6).toFixed(precision)}M${unit?" "+unit:""}`:Math.abs(value)&gt;=1e3?`${(value/1e3).toFixed(precision)}K${unit?" "+unit:""}`:Math.abs(value)&lt;.01&amp;&amp;0!==value?`${value.toExponential(precision)}${unit?" "+unit:""}`:`${value.toFixed(precision)}${unit?" "+unit:""}`,formatDate=(date,includeTime=!0)=&gt;{const dateObj="string"==typeof date||"number"==typeof date?new Date(date):date;if(isNaN(dateObj.getTime()))return"Invalid Date";const options={year:"numeric",month:"short",day:"numeric"};return includeTime&amp;&amp;(options.hour="numeric",options.minute="2-digit",options.hour12=!0),dateObj.toLocaleString("en-US",options)},SPACING={sm:8,md:12,base:16},CHART_SPACING_TOOLBOX_HEIGHT=28,CHART_SPACING_TITLE_HEIGHT=26,CHART_SPACING_LEGEND_HEIGHT=24,CHART_SPACING_DATA_ZOOM_HEIGHT=20,CHART_SPACING_TOOLBOX_TO_TITLE_GAP=SPACING.md,CHART_SPACING_TITLE_TO_GRID_GAP=SPACING.md,TYPOGRAPHY={title:{fontSize:16,fontWeight:600},subtitle:{fontSize:14,fontWeight:400},body:{fontSize:11},caption:{fontSize:12},small:{fontSize:10}},ANIMATION_MODES={quality:{animation:!0,...{duration:800,easing:"cubicOut"},progressive:0,sampling:"none",large:!1},balanced:{animation:!1,...{duration:200,easing:"cubicOut"},progressive:1e3,sampling:"lttb",large:!1},performance:{animation:!1,...{duration:0,easing:"linear"},progressive:5e3,sampling:"average",large:!0}},CHART_DESIGN_TOKENS={title:{base:{left:"center",top:CHART_SPACING_TOOLBOX_HEIGHT+CHART_SPACING_TOOLBOX_TO_TITLE_GAP,padding:[SPACING.sm,0,SPACING.sm,0],textStyle:{fontSize:TYPOGRAPHY.title.fontSize,fontWeight:TYPOGRAPHY.title.fontWeight}},subtitle:{textStyle:{fontSize:TYPOGRAPHY.subtitle.fontSize,fontWeight:TYPOGRAPHY.subtitle.fontWeight}}},grid:{base:{left:60,right:60,top:70,bottom:80,containLabel:!0},noTitle:{left:60,right:60,top:50,bottom:80,containLabel:!0},withDataZoom:{bottom:80+CHART_SPACING_DATA_ZOOM_HEIGHT},withTopLegend:{top:110},compact:{left:40,right:40,top:60,bottom:60,containLabel:!0}},tooltip:{base:{trigger:"axis",confine:!0,borderWidth:1,padding:SPACING.sm,textStyle:{fontSize:TYPOGRAPHY.caption.fontSize},axisPointer:{type:"cross",animation:!1,lineStyle:{type:"dashed"}}},item:{trigger:"item"}},legend:{base:{show:!0,type:"scroll",orient:"horizontal",left:"center",bottom:SPACING.sm,textStyle:{fontSize:TYPOGRAPHY.body.fontSize},pageIconSize:12,pageTextStyle:{fontSize:TYPOGRAPHY.small.fontSize}},top:{top:SPACING.base,bottom:void 0},withDataZoom:{bottom:60}},axes:{xAxis:{axisLabel:{fontSize:TYPOGRAPHY.body.fontSize,rotate:45},axisLine:{show:!0,lineStyle:{width:1}},axisTick:{show:!0,length:4},splitLine:{show:!1},nameGap:30,nameLocation:"middle"},yAxis:{axisLabel:{fontSize:TYPOGRAPHY.body.fontSize},axisLine:{show:!0,lineStyle:{width:1}},axisTick:{show:!0,length:4},splitLine:{show:!0,lineStyle:{type:"dashed",opacity:.3}},nameGap:50,nameLocation:"middle",scale:!0}},dataZoom:{base:[{type:"inside",brushSelect:!0,throttle:100},{type:"slider",show:!0,height:CHART_SPACING_DATA_ZOOM_HEIGHT,bottom:40}]},toolbox:{base:{show:!0,orient:"horizontal",right:"2%",top:"2%",z:999,zlevel:100,itemSize:15,itemGap:10}},visualMap:{base:{type:"continuous",orient:"horizontal",left:"center",bottom:"5%",calculable:!0,textStyle:{fontSize:TYPOGRAPHY.small.fontSize}}},series:{line:{lineStyle:{width:2,shadowBlur:3},symbolSize:4,symbol:"circle",smooth:.3,connectNulls:!1,showSymbol:!0,emphasis:{focus:"series",blurScope:"coordinateSystem"}},bar:{barCategoryGap:"20%",barGap:"10%",emphasis:{focus:"series",itemStyle:{shadowBlur:10,shadowOffsetX:0}}},scatter:{symbolSize:8,emphasis:{focus:"series",itemStyle:{shadowBlur:10}},large:!1,largeThreshold:1e4},heatmap:{label:{show:!1,fontSize:TYPOGRAPHY.small.fontSize},emphasis:{itemStyle:{shadowBlur:10}},progressive:3e3,progressiveThreshold:1e4}},animation:ANIMATION_MODES,adaptive:{lineWidth:seriesCount=&gt;seriesCount&lt;=3?2:seriesCount&lt;=6?1.5:1,symbolSize:(pointCount,baseSize=5)=&gt;pointCount&lt;100?baseSize:pointCount&lt;1e3?Math.max(baseSize-1,3):pointCount&lt;5e3?2:0,showSymbol:pointCount=&gt;pointCount&lt;1e3,animationMode:totalPoints=&gt;totalPoints&gt;5e4?"performance":totalPoints&gt;2e4?"balanced":"quality"}},DEVIATION_COLORS={gradient:["#0d47a1","#1565c0","#1976d2","#1e88e5","#42a5f5","#64b5f6","#81c784","#ffb74d","#ffa726","#ff9800","#f57c00","#e65100","#d84315"]},HVAC_COLORS={operatingModes:{economizer:"#4caf50",preheat:"#ff9800",integrated:"#2196f3",mechanical:"#f44336",transitional:"#9e9e9e",optimal:"#00e676",inefficient:"#ff5252"}},COMFORT_COLORS={zones:{optimal:"#4caf50",acceptable:"#8bc34a",hot:"#ff5722",cold:"#2196f3",humid:"#9c27b0",dry:"#ffeb3b"}},STATISTICAL_COLORS={aggregations:{average:"#2196f3",median:"#00bcd4",p95:"#ff9800",p99:"#f44336",maximum:"#e91e63",minimum:"#9c27b0",stdDev:"#9e9e9e"}};function calculateGridTop(config){const{hasTitle:hasTitle=!1,hasToolbox:hasToolbox=!0,hasTopLegend:hasTopLegend=!1}=config;let top=SPACING.md;return hasToolbox&amp;&amp;(top+=CHART_SPACING_TOOLBOX_HEIGHT+CHART_SPACING_TOOLBOX_TO_TITLE_GAP),hasTitle&amp;&amp;(top+=CHART_SPACING_TITLE_HEIGHT+CHART_SPACING_TITLE_TO_GRID_GAP),hasTopLegend&amp;&amp;(top+=CHART_SPACING_LEGEND_HEIGHT+SPACING.base),top}function calculateGridBottom(config){const{hasDataZoom:hasDataZoom=!0,hasBottomLegend:hasBottomLegend=!0}=config;let bottom=SPACING.md;return hasDataZoom&amp;&amp;(bottom+=CHART_SPACING_DATA_ZOOM_HEIGHT+SPACING.base),hasBottomLegend&amp;&amp;(bottom+=CHART_SPACING_LEGEND_HEIGHT+SPACING.sm),bottom}function getTooltipBackground(isDarkMode){return isDarkMode?"rgba(0, 0, 0, 0.9)":"rgba(255, 255, 255, 0.95)"}function getTooltipBorder(isDarkMode){return isDarkMode?"rgba(255, 255, 255, 0.2)":"rgba(0, 0, 0, 0.2)"}function getHVACModeColor(mode){return HVAC_COLORS.operatingModes[mode]}function getComfortColor(zone){return COMFORT_COLORS.zones[zone]}function getStatColor(stat){return STATISTICAL_COLORS.aggregations[stat]}const buildChartTitle=(titleText,theme,options)=&gt;{if(titleText)return{...CHART_DESIGN_TOKENS.title.base,text:titleText,subtext:null==options?void 0:options.subtext,left:CHART_DESIGN_TOKENS.title.base.left,top:CHART_DESIGN_TOKENS.title.base.top,padding:CHART_DESIGN_TOKENS.title.base.padding,textStyle:{...CHART_DESIGN_TOKENS.title.base.textStyle,fontSize:CHART_DESIGN_TOKENS.title.base.textStyle.fontSize,fontWeight:CHART_DESIGN_TOKENS.title.base.textStyle.fontWeight,color:theme.palette.text.primary}}},buildTooltip=(theme,config)=&gt;{var _a,_b,_c;const isDarkMode="dark"===(null==(_a=null==theme?void 0:theme.palette)?void 0:_a.mode);return{...CHART_DESIGN_TOKENS.tooltip.base,trigger:CHART_DESIGN_TOKENS.tooltip.base.trigger,confine:!1!==(null==config?void 0:config.confine),backgroundColor:getTooltipBackground(isDarkMode),borderColor:getTooltipBorder(isDarkMode),borderWidth:CHART_DESIGN_TOKENS.tooltip.base.borderWidth,padding:CHART_DESIGN_TOKENS.tooltip.base.padding,textStyle:{...CHART_DESIGN_TOKENS.tooltip.base.textStyle,color:(null==(_c=null==(_b=null==theme?void 0:theme.palette)?void 0:_b.text)?void 0:_c.primary)||(isDarkMode?"#fff":"#000"),...null==config?void 0:config.textStyle},formatter:null==config?void 0:config.formatter,axisPointer:CHART_DESIGN_TOKENS.tooltip.base.axisPointer,position:null==config?void 0:config.position}},buildXAxis=(theme,config)=&gt;{var _a,_b;const defaultMin=null==config?void 0:config.min,defaultMax=null==config?void 0:config.max,axisColor=(null==(_b=null==(_a=null==theme?void 0:theme.palette)?void 0:_a.text)?void 0:_b.secondary)||"#666";return{type:"category",data:null==config?void 0:config.data,name:null==config?void 0:config.name,nameLocation:CHART_DESIGN_TOKENS.axes.xAxis.nameLocation,nameGap:CHART_DESIGN_TOKENS.axes.xAxis.nameGap,boundaryGap:null==config?void 0:config.boundaryGap,min:defaultMin,max:defaultMax,axisLabel:{...CHART_DESIGN_TOKENS.axes.xAxis.axisLabel,color:axisColor,...null==config?void 0:config.axisLabel},splitLine:CHART_DESIGN_TOKENS.axes.xAxis.splitLine,axisLine:{...CHART_DESIGN_TOKENS.axes.xAxis.axisLine,lineStyle:{...CHART_DESIGN_TOKENS.axes.xAxis.axisLine.lineStyle,color:axisColor}},axisTick:{...CHART_DESIGN_TOKENS.axes.xAxis.axisTick,lineStyle:{color:axisColor}}}},buildYAxis=(theme,config)=&gt;{var _a,_b,_c;const defaultMin=null==config?void 0:config.min,defaultMax=null==config?void 0:config.max,axisColor=(null==(_b=null==(_a=null==theme?void 0:theme.palette)?void 0:_a.text)?void 0:_b.secondary)||"#666",splitLineColor=(null==(_c=null==theme?void 0:theme.palette)?void 0:_c.divider)||"#333";return{type:"value",data:null==config?void 0:config.data,name:null==config?void 0:config.name,nameLocation:CHART_DESIGN_TOKENS.axes.yAxis.nameLocation,nameGap:CHART_DESIGN_TOKENS.axes.yAxis.nameGap,scale:CHART_DESIGN_TOKENS.axes.yAxis.scale,min:defaultMin,max:defaultMax,axisLabel:{...CHART_DESIGN_TOKENS.axes.yAxis.axisLabel,formatter:value=&gt;formatNumberForDisplay(value,2),color:axisColor,...null==config?void 0:config.axisLabel},splitLine:{...CHART_DESIGN_TOKENS.axes.yAxis.splitLine,lineStyle:{...CHART_DESIGN_TOKENS.axes.yAxis.splitLine.lineStyle,color:splitLineColor},...null==config?void 0:config.splitLine},axisLine:{...CHART_DESIGN_TOKENS.axes.yAxis.axisLine,lineStyle:{...CHART_DESIGN_TOKENS.axes.yAxis.axisLine.lineStyle,color:axisColor}},axisTick:{...CHART_DESIGN_TOKENS.axes.yAxis.axisTick,lineStyle:{color:axisColor}}}},buildLegend=(theme,config)=&gt;{var _a,_b;const textColor=(null==(_b=null==(_a=null==theme?void 0:theme.palette)?void 0:_a.text)?void 0:_b.secondary)||"#666";return{...CHART_DESIGN_TOKENS.legend.base,show:!1!==(null==config?void 0:config.show),data:null==config?void 0:config.data,orient:CHART_DESIGN_TOKENS.legend.base.orient,left:CHART_DESIGN_TOKENS.legend.base.left,top:null==config?void 0:config.top,right:null==config?void 0:config.right,bottom:CHART_DESIGN_TOKENS.legend.base.bottom,type:CHART_DESIGN_TOKENS.legend.base.type,selectedMode:!1!==(null==config?void 0:config.selectedMode),textStyle:{...CHART_DESIGN_TOKENS.legend.base.textStyle,color:textColor,...null==config?void 0:config.textStyle},pageIconSize:CHART_DESIGN_TOKENS.legend.base.pageIconSize,pageIconColor:textColor,pageTextStyle:{...CHART_DESIGN_TOKENS.legend.base.pageTextStyle,color:textColor}}},buildVisualMap=(theme,config)=&gt;{var _a,_b;const textColor=(null==(_b=null==(_a=null==theme?void 0:theme.palette)?void 0:_a.text)?void 0:_b.primary)||"#000";return{...CHART_DESIGN_TOKENS.visualMap.base,type:CHART_DESIGN_TOKENS.visualMap.base.type,min:0,max:100,calculable:!1!==(null==config?void 0:config.calculable),orient:CHART_DESIGN_TOKENS.visualMap.base.orient,left:CHART_DESIGN_TOKENS.visualMap.base.left,bottom:CHART_DESIGN_TOKENS.visualMap.base.bottom,inRange:{color:["#50a3ba","#eac736","#d94e5d"]},text:null==config?void 0:config.text,textStyle:{...CHART_DESIGN_TOKENS.visualMap.base.textStyle,color:textColor,...null==config?void 0:config.textStyle},formatter:null==config?void 0:config.formatter}},SeriesBuilders={line:config=&gt;({name:config.name,type:"line",data:config.data,smooth:void 0!==config.smooth?config.smooth:CHART_DESIGN_TOKENS.series.line.smooth,symbol:config.symbol||CHART_DESIGN_TOKENS.series.line.symbol,symbolSize:config.symbolSize||CHART_DESIGN_TOKENS.series.line.symbolSize,connectNulls:void 0!==config.connectNulls?config.connectNulls:CHART_DESIGN_TOKENS.series.line.connectNulls,showSymbol:config.data.length&lt;1e3&amp;&amp;CHART_DESIGN_TOKENS.series.line.showSymbol,stack:config.stack,lineStyle:{...CHART_DESIGN_TOKENS.series.line.lineStyle,...config.lineStyle},areaStyle:config.areaStyle,emphasis:config.emphasis||CHART_DESIGN_TOKENS.series.line.emphasis}),bar:config=&gt;({name:config.name,type:"bar",data:config.data,stack:config.stack,barWidth:config.barWidth,barGap:config.barGap||CHART_DESIGN_TOKENS.series.bar.barGap,barCategoryGap:config.barCategoryGap||CHART_DESIGN_TOKENS.series.bar.barCategoryGap,itemStyle:config.itemStyle,emphasis:config.emphasis||CHART_DESIGN_TOKENS.series.bar.emphasis,label:config.label}),scatter:config=&gt;({name:config.name,type:"scatter",data:config.data,symbolSize:config.symbolSize||CHART_DESIGN_TOKENS.series.scatter.symbolSize,itemStyle:config.itemStyle,emphasis:config.emphasis||CHART_DESIGN_TOKENS.series.scatter.emphasis,large:void 0!==config.large?config.large:CHART_DESIGN_TOKENS.series.scatter.large,largeThreshold:config.largeThreshold||CHART_DESIGN_TOKENS.series.scatter.largeThreshold}),heatmap:config=&gt;({name:config.name||"Heatmap",type:"heatmap",data:config.data,label:config.label||CHART_DESIGN_TOKENS.series.heatmap.label,itemStyle:config.itemStyle,emphasis:config.emphasis||CHART_DESIGN_TOKENS.series.heatmap.emphasis,progressive:config.progressive||CHART_DESIGN_TOKENS.series.heatmap.progressive,progressiveThreshold:config.progressiveThreshold||CHART_DESIGN_TOKENS.series.heatmap.progressiveThreshold})},combineOptions=(base,...overrides)=&gt;overrides.reduce((acc,override)=&gt;({...acc,...override,title:override.title?{...acc.title,...override.title}:acc.title,tooltip:override.tooltip?{...acc.tooltip,...override.tooltip}:acc.tooltip,legend:override.legend?{...acc.legend,...override.legend}:acc.legend,grid:override.grid?{...acc.grid,...override.grid}:acc.grid,xAxis:override.xAxis||acc.xAxis,yAxis:override.yAxis||acc.yAxis,series:override.series||acc.series}),base);function generateChartAriaLabel(title,seriesCount,dataPointCount,startDate,endDate,chartType="chart"){let label=`${title}. ${chartType} showing ${seriesCount} data series with ${dataPointCount} total data points`;return startDate&amp;&amp;endDate&amp;&amp;(label+=` from ${startDate.toLocaleDateString()} to ${endDate.toLocaleDateString()}`),label+=". Use arrow keys to navigate, Enter to show details, Escape to return to overview.",label}function generateDataPointAnnouncement(seriesName,xValue,yValue,unit){const formattedValue="number"==typeof yValue?yValue.toFixed(2):yValue;return`${seriesName}, ${"number"==typeof xValue?new Date(xValue).toLocaleString():xValue}, Value: ${formattedValue}${unit?` ${unit}`:""}`}function createKeyboardNavState(seriesCount,pointCounts){return{currentSeriesIndex:0,currentPointIndex:0,totalSeries:seriesCount,totalPoints:pointCounts}}function handleKeyboardNav(key,state,onNavigate){const newState={...state};switch(key){case"ArrowRight":newState.currentPointIndex&lt;(newState.totalPoints[newState.currentSeriesIndex]||0)-1?newState.currentPointIndex++:newState.currentPointIndex=0;break;case"ArrowLeft":newState.currentPointIndex&gt;0?newState.currentPointIndex--:newState.currentPointIndex=(newState.totalPoints[newState.currentSeriesIndex]||1)-1;break;case"ArrowUp":case"PageUp":newState.currentSeriesIndex&gt;0&amp;&amp;(newState.currentSeriesIndex--,newState.currentPointIndex=0);break;case"ArrowDown":case"PageDown":newState.currentSeriesIndex&lt;newState.totalSeries-1&amp;&amp;(newState.currentSeriesIndex++,newState.currentPointIndex=0);break;case"Home":newState.currentPointIndex=0;break;case"End":newState.currentPointIndex=(newState.totalPoints[newState.currentSeriesIndex]||1)-1}return onNavigate(newState.currentSeriesIndex,newState.currentPointIndex),newState}function createEChartsAriaConfig(title,seriesNames,enableDecal=!0){return{enabled:!0,label:{enabled:!0,description:`${title}. Displaying ${seriesNames.join(", ")}.`},decal:{show:enableDecal,decals:[{dashArrayX:[1,0],dashArrayY:[2,5],rotation:Math.PI/6},{dashArrayX:[5,5],dashArrayY:[5,5]},{dashArrayX:[1,0],dashArrayY:[4,3]}]}}}const chartFocusStyles={"&amp;:focus":{outline:"3px solid",outlineColor:"primary.main",outlineOffset:"2px"},"&amp;:focus-visible":{outline:"3px solid",outlineColor:"primary.main",outlineOffset:"2px"}},srOnlyStyles={position:"absolute",width:"1px",height:"1px",padding:0,margin:"-1px",overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",borderWidth:0};function transformToRadar(data,options={}){const{aggregation:aggregation="latest",indicators:indicators,showMarkerTags:showMarkerTags=!0}=options;let seriesData=[];if(data&amp;&amp;Array.isArray(data)&amp;&amp;data[0]&amp;&amp;"pointId"in data[0])seriesData=data.map(apiData=&gt;({name:apiData.pointName,data:apiData.data.map(d=&gt;[d.timestamp,d.value]),unit:void 0,markerTags:void 0}));else{if(!data||!Array.isArray(data))return{indicators:[],series:[]};seriesData=data.filter(series=&gt;series&amp;&amp;"string"==typeof series.name&amp;&amp;Array.isArray(series.data))}if(0===seriesData.length)return{indicators:[],series:[]};const radarIndicators=indicators||seriesData.map(series=&gt;{const values=series.data.map(([_,value])=&gt;value).filter(v=&gt;"number"==typeof v&amp;&amp;!isNaN(v));if(0===values.length)return{name:series.name,max:100,min:0,unit:series.unit};const minVal=Math.min(...values),maxVal=Math.max(...values),padding=.1*Math.abs(maxVal-minVal);return{name:series.name,max:maxVal+padding,min:Math.max(0,minVal-padding),unit:series.unit}}),calculateAggregatedValue=(data2,type)=&gt;{if(!data2||0===data2.length)return 0;const values=data2.map(([_,value])=&gt;value).filter(v=&gt;"number"==typeof v&amp;&amp;!isNaN(v));if(0===values.length)return 0;switch(type){case"latest":default:return values[values.length-1];case"average":return values.reduce((sum,val)=&gt;sum+val,0)/values.length;case"max":return Math.max(...values);case"min":return Math.min(...values)}},radarSeries=[];return"latest"!==aggregation&amp;&amp;aggregation?radarSeries.push({name:aggregation.charAt(0).toUpperCase()+aggregation.slice(1),value:seriesData.map(series=&gt;calculateAggregatedValue(series.data,aggregation)),markerTags:showMarkerTags?seriesData.flatMap(s=&gt;s.markerTags||[]):void 0}):radarSeries.push({name:"Current",value:seriesData.map(series=&gt;calculateAggregatedValue(series.data,"latest")),markerTags:showMarkerTags?seriesData.flatMap(s=&gt;s.markerTags||[]):void 0}),"latest"===aggregation&amp;&amp;radarSeries.push({name:"Average",value:seriesData.map(series=&gt;calculateAggregatedValue(series.data,"average"))},{name:"Peak",value:seriesData.map(series=&gt;calculateAggregatedValue(series.data,"max"))}),{indicators:radarIndicators,series:radarSeries}}function transformToTimeSeries(data,options){if(!data||!Array.isArray(data))return[];const{type:type="line",showMarkerTags:showMarkerTags=!0}=options||{};return data.map(series=&gt;{const result={name:showMarkerTags&amp;&amp;series.markerTags?formatPointWithTags({id:series.name,name:series.name,markerTags:series.markerTags},{maxTags:2,includeUnit:!1}):series.name,type:"line",data:series.data||[],unit:series.unit,color:series.color,markerTags:series.markerTags,pointMetadata:series.pointMetadata};return"area"!==type&amp;&amp;"stackedArea"!==type||(result.areaStyle={}),"stackedArea"===type&amp;&amp;(result.stack="Total"),result})}function transformToScatter(data){return data?data.data&amp;&amp;Array.isArray(data.data)?[{name:`${data.xAxisLabel||"X"} vs ${data.yAxisLabel||"Y"}`,type:"scatter",data:data.data}]:Array.isArray(data)?data.map(series=&gt;({name:series.name,type:"scatter",data:series.data||[],unit:series.unit,markerTags:series.markerTags})):[]:[]}function transformToGauge(data){return data?"number"==typeof data?{type:"gauge",data:[{value:data,name:"Value"}]}:"object"==typeof data&amp;&amp;"value"in data?{type:"gauge",data:[{value:data.value,name:data.name||"Value"}],unit:data.unit,markerTags:data.markerTags}:{type:"gauge",data:[{value:0,name:"Invalid Data"}]}:{type:"gauge",data:[{value:0,name:"No Data"}]}}function transformToEconomizer(data){if(!data||!Array.isArray(data))return[];const outdoorTemp=data.find(s=&gt;s.name.toLowerCase().includes("outdoor")&amp;&amp;s.name.toLowerCase().includes("temp")),returnTemp=data.find(s=&gt;s.name.toLowerCase().includes("return")&amp;&amp;s.name.toLowerCase().includes("temp"));if(!outdoorTemp||!returnTemp)return data;const economizerData=[],timestamps=new Set;return outdoorTemp.data.forEach(d=&gt;timestamps.add(d[0])),Array.from(timestamps).forEach(timestamp=&gt;{const outdoor=outdoorTemp.data.find(d=&gt;d[0]===timestamp),returnAir=returnTemp.data.find(d=&gt;d[0]===timestamp);outdoor&amp;&amp;returnAir&amp;&amp;economizerData.push({timestamp:timestamp,outdoorTemp:outdoor[1],returnTemp:returnAir[1]})}),economizerData}function getOptimizedChartOptions(baseOptions,optimization){const{dataSize:dataSize,seriesCount:seriesCount,enableProgressive:enableProgressive=!0}=optimization,totalPoints=dataSize*seriesCount,isLargeDataset=totalPoints&gt;5e4,isHugeDataset=totalPoints&gt;5e5,optimizedOptions={...baseOptions,animation:!1,...enableProgressive&amp;&amp;isLargeDataset?{progressive:Math.min(5e3,Math.floor(totalPoints/20)),progressiveThreshold:1e4,progressiveChunkMode:"sequential"}:{},tooltip:{...baseOptions.tooltip,trigger:"axis",transitionDuration:0,confine:!0,formatter:isHugeDataset?params=&gt;{if(Array.isArray(params)&amp;&amp;params.length&gt;10){const limited=params.slice(0,10),result=limited.map(p=&gt;{var _a;return`${p.seriesName}: ${(null==(_a=p.value[1])?void 0:_a.toFixed(2))||p.value}`}).join("&lt;br/&gt;");return params.length&gt;10?result+`&lt;br/&gt;... and ${params.length-10} more series`:result}return params}:void 0},grid:{...baseOptions.grid,containLabel:!0,left:50,right:50,top:30,bottom:30},xAxis:optimizeAxis(baseOptions.xAxis,isLargeDataset),yAxis:optimizeAxis(baseOptions.yAxis,isLargeDataset),dataZoom:[{type:"slider",show:!0,start:isLargeDataset?90:0,end:100,filterMode:"weakFilter",...Array.isArray(baseOptions.dataZoom)&amp;&amp;baseOptions.dataZoom[0]||{}},{type:"inside",start:isLargeDataset?90:0,end:100,filterMode:"weakFilter",zoomOnMouseWheel:!0,moveOnMouseMove:!0,...Array.isArray(baseOptions.dataZoom)&amp;&amp;baseOptions.dataZoom[1]||{}}]};return optimizedOptions.series&amp;&amp;(optimizedOptions.series=function optimizeSeries(series,optimization){if(!series)return[];const seriesArray=Array.isArray(series)?series:[series],{dataSize:dataSize,enableLargeMode:enableLargeMode=!0,enableDataSampling:enableDataSampling=!0}=optimization;return seriesArray.map(s=&gt;({...s,type:s.type||"line",..."line"===s.type&amp;&amp;dataSize&gt;5e3&amp;&amp;enableLargeMode?{large:!0,largeThreshold:5e3}:{},..."line"===s.type?{showSymbol:!1,smooth:!1,lineStyle:{...s.lineStyle,width:dataSize&gt;5e4?.5:1},emphasis:{disabled:dataSize&gt;1e5}}:{},..."bar"===s.type&amp;&amp;dataSize&gt;1e3?{barMaxWidth:20,large:!0,largeThreshold:1e3}:{},progressive:Math.min(1e3,Math.floor(dataSize/10)),progressiveThreshold:2e3}))}(baseOptions.series,optimization)),optimizedOptions}function optimizeAxis(axis,isLargeDataset){if(!axis)return axis;return(Array.isArray(axis)?axis:[axis]).map(a=&gt;{var _a,_b;return{...a,axisLabel:{...a.axisLabel,interval:isLargeDataset?"auto":0,rotate:isLargeDataset?45:0,formatter:"time"===a.type&amp;&amp;isLargeDataset?getOptimizedTimeFormatter():null==(_a=a.axisLabel)?void 0:_a.formatter},splitLine:{...a.splitLine,show:!isLargeDataset||!0===(null==(_b=a.splitLine)?void 0:_b.show),interval:isLargeDataset?"auto":0},minorTick:{show:!1},minorSplitLine:{show:!1}}})}function getOptimizedTimeFormatter(){let lastMonth=-1;return value=&gt;{const date=new Date(value),month=date.getMonth();return month!==lastMonth?(lastMonth=month,date.toLocaleDateString("en-US",{month:"short"})):""}}function getRecommendedSettings(totalPoints,seriesCount,timeRange){const pointsPerSeries=Math.floor(totalPoints/seriesCount),daysInRange=timeRange/864e5;return{enableProgressive:totalPoints&gt;5e4,enableLargeMode:pointsPerSeries&gt;5e3,enableDataSampling:pointsPerSeries&gt;1e4,recommendedInitialZoom:daysInRange&gt;180?[90,100]:daysInRange&gt;30?[70,100]:[0,100],maxSeriesInTooltip:seriesCount&gt;100?10:seriesCount&gt;50?20:seriesCount}}const GRADIENT_PRESETS={temperature:{type:"linear",colors:[{offset:0,color:"#0000FF"},{offset:.25,color:"#00FFFF"},{offset:.5,color:"#00FF00"},{offset:.75,color:"#FFFF00"},{offset:1,color:"#FF0000"}]},humidity:{type:"linear",colors:[{offset:0,color:"#F5DEB3"},{offset:.3,color:"#87CEEB"},{offset:.6,color:"#4682B4"},{offset:1,color:"#000080"}]},pressure:{type:"linear",colors:[{offset:0,color:"#9400D3"},{offset:.5,color:"#00FF00"},{offset:1,color:"#FF4500"}]},performance:{type:"linear",colors:[{offset:0,color:"#FF5252"},{offset:.3,color:"#FF6E40"},{offset:.5,color:"#FFD740"},{offset:.7,color:"#69F0AE"},{offset:1,color:"#00E5FF"}]},deviation:{type:"linear",colors:[{offset:0,color:"#00E5FF"},{offset:.2,color:"#69F0AE"},{offset:.5,color:"#FFD740"},{offset:.8,color:"#FF6E40"},{offset:1,color:"#FF5252"}]}},createThresholdMarkLines=(thresholds,unit)=&gt;({silent:!0,symbol:"none",lineStyle:{type:"dashed",width:2},label:{position:"end",formatter:params=&gt;{const threshold=thresholds.find(t=&gt;t.value===params.value);return threshold?`${threshold.name}: ${params.value}${unit||""}`:""}},data:thresholds.map(threshold=&gt;({yAxis:threshold.value,name:threshold.name,lineStyle:{color:threshold.color,type:"critical"===threshold.type?"solid":"dashed",width:"critical"===threshold.type?3:2},label:{show:!1!==threshold.showLabel,position:threshold.labelPosition||"end",color:threshold.color,fontWeight:"critical"===threshold.type?"bold":"normal"}}))}),applyVisualEnhancements=(option,config)=&gt;{const enhancedOption={...option},{thresholds:thresholds,gradient:gradient,visualMapping:visualMapping,colorZones:colorZones,unit:unit,theme:theme="dark"}=config;return visualMapping&amp;&amp;(enhancedOption.visualMap=((config,theme="dark")=&gt;{const baseConfig={show:!1,dimension:config.dimension||1,min:config.min||0,max:config.max||100,textStyle:{color:"dark"===theme?"rgba(255, 255, 255, 0.87)":"rgba(0, 0, 0, 0.87)"}};return"continuous"===config.type?{...baseConfig,type:"continuous",calculable:!0,inRange:config.inRange||{color:["#00E5FF","#00BFA5","#FFD740","#FF6E40","#FF5252"]},outOfRange:config.outOfRange||{color:"rgba(128, 128, 128, 0.3)"}}:{...baseConfig,type:"piecewise",pieces:config.pieces||[],outOfRange:config.outOfRange||{color:"rgba(128, 128, 128, 0.3)"}}})(visualMapping,theme)),enhancedOption.series&amp;&amp;Array.isArray(enhancedOption.series)&amp;&amp;(enhancedOption.series=enhancedOption.series.map((series,index)=&gt;{var _a,_b;let enhancedSeries={...series};if(gradient&amp;&amp;0===index&amp;&amp;(enhancedSeries=((series,gradientConfig)=&gt;{const gradient=(config=&gt;{const{type:type,colors:colors,direction:direction="vertical"}=config;if("linear"===type){let x=0,y=0,x2=0,y2=1;switch(direction){case"horizontal":x2=1,y2=0;break;case"diagonal":x2=1,y2=1}return{type:"linear",x:x,y:y,x2:x2,y2:y2,colorStops:colors,global:!1}}return{type:"radial",x:.5,y:.5,r:.5,colorStops:colors,global:!1}})(gradientConfig);return"line"===series.type?{...series,areaStyle:{...series.areaStyle,color:gradient,opacity:.8},lineStyle:{...series.lineStyle,color:gradient}}:"bar"===series.type?{...series,itemStyle:{...series.itemStyle,color:gradient}}:series})(enhancedSeries,gradient)),!thresholds||"line"!==series.type&amp;&amp;"bar"!==series.type||(enhancedSeries.markLine={...series.markLine,...createThresholdMarkLines(thresholds,unit)}),colorZones&amp;&amp;"line"===series.type){const yMin=(null==(_a=enhancedOption.yAxis)?void 0:_a.min)||0,yMax=(null==(_b=enhancedOption.yAxis)?void 0:_b.max)||100;enhancedSeries.markArea={silent:!0,data:(zones=colorZones,yAxisMin=yMin,yAxisMax=yMax,zones.map(zone=&gt;[{yAxis:Math.max(zone.start,yAxisMin),name:zone.name||"",itemStyle:{color:zone.color,opacity:.1}},{yAxis:Math.min(zone.end,yAxisMax)}]))}}var zones,yAxisMin,yAxisMax;return enhancedSeries})),enhancedOption},convertTemperatureData=(data,fromUnit="C",toUnit="F")=&gt;fromUnit===toUnit?data:data.map(([timestamp,value])=&gt;{var fahrenheit,celsius;return[timestamp,"C"===fromUnit&amp;&amp;"F"===toUnit?null==(celsius=value)||isNaN(celsius)?celsius:9*celsius/5+32:null==(fahrenheit=value)||isNaN(fahrenheit)?fahrenheit:5*(fahrenheit-32)/9]}),isWeatherTemperaturePoint=pointName=&gt;{if(!pointName.toLowerCase().includes("/weather/"))return!1;const lowerName=pointName.toLowerCase();return["/weather/temp","/weather/feels_like","/weather/dew_point","/weather/wet_bulb"].some(field=&gt;lowerName.endsWith(field))};function getPointDisplayLabel(point,options={}){const{displayMode:displayMode="smart",maxTags:maxTags=2,includeUnit:includeUnit=!0,separator:separator=" • ",context:context="legend"}=options,name=point.name||"Unknown",markerTags=point.marker_tags||[],unit=includeUnit&amp;&amp;point.unit?` (${point.unit})`:"";switch(displayMode){case"name":return`${name}${unit}`;case"tags":if(markerTags.length&gt;0){return`${getPrioritizedTags(markerTags,maxTags).join(separator)}${unit}`}return`${name}${unit}`;case"both":return markerTags.length&gt;0?formatPointWithTags({name:name,markerTags:markerTags},{maxTags:maxTags,includeUnit:!1})+unit:`${name}${unit}`;default:if(function shouldUseTags(name,tags){if(!tags||0===tags.length)return!1;const isCrypticName=/[._]/.test(name)||name===name.toUpperCase(),hasMeaningfulTags=tags.some(tag=&gt;function isDescriptiveTag(tag){const descriptivePatterns=["temp","temperature","pressure","flow","humidity","zone","room","floor","supply","return","exhaust","ahu","vav","rtu","chiller","boiler","pump","fan","sensor","setpoint","command","status","enable","heating","cooling","damper","valve"],tagLower=tag.toLowerCase();return descriptivePatterns.some(pattern=&gt;tagLower.includes(pattern))}(tag)&amp;&amp;tag.toLowerCase()!==name.toLowerCase());return isCrypticName&amp;&amp;hasMeaningfulTags}(name,markerTags)){return`${getPrioritizedTags(markerTags,maxTags).join(separator)}${unit}`}return`${name}${unit}`}}function getPrioritizedTags(tags,maxTags){const priorityOrder=[["ahu","vav","rtu","chiller","boiler","pump","fan"],["zone","room","floor","building"],["temp","temperature","pressure","flow","humidity","co2"],["supply","return","exhaust","outside"],["sensor","setpoint","command","status"]];return[...tags].sort((a,b)=&gt;getPriority(a.toLowerCase(),priorityOrder)-getPriority(b.toLowerCase(),priorityOrder)).slice(0,maxTags)}function getPriority(tag,priorityOrder){for(let i=0;i&lt;priorityOrder.length;i++)if(priorityOrder[i].some(pattern=&gt;tag.includes(pattern)))return i;return priorityOrder.length}class TokenSyncService{static async syncTokenStatus(){const user=auth.currentUser;if(!user)return{localToken:!1,firestoreToken:!1,synced:!1,message:"User not authenticated"};try{const tokenService=getTokenService(),localToken=await tokenService.getToken(user.uid),userData=(await getDoc(doc(db,"users",user.uid))).data(),hasFirestoreToken=!(!(null==userData?void 0:userData.aceJwtEncrypted)&amp;&amp;!(null==userData?void 0:userData.aceJwt)),synced=!!localToken===hasFirestoreToken;let message="Token status checked";return synced?message=localToken&amp;&amp;hasFirestoreToken?"Token properly synced":"No token configured":localToken&amp;&amp;!hasFirestoreToken?message="Token in local storage but not in Firestore":!localToken&amp;&amp;hasFirestoreToken&amp;&amp;(message="Token in Firestore but not in local storage"),{localToken:!!localToken,firestoreToken:hasFirestoreToken,synced:synced,message:message}}catch(error){return{localToken:!1,firestoreToken:!1,synced:!1,message:`Error: ${error instanceof Error?error.message:String(error)}`}}}static async forceSyncToFirestore(){const user=auth.currentUser;if(!user)throw new Error("User not authenticated");try{const tokenService=getTokenService(),localToken=await tokenService.getToken(user.uid);if(!localToken)throw new Error("No token found in local storage");const success=await tokenService.saveToken(user.uid,localToken,!0);return success&amp;&amp;store.dispatch(setAceToken({token:localToken})),success}catch(error){throw error}}static async ensureUserDocument(){const user=auth.currentUser;if(!user)throw new Error("User not authenticated");try{(await getDoc(doc(db,"users",user.uid))).exists()||await setDoc(doc(db,"users",user.uid),{email:user.email,displayName:user.displayName||null,role:"user",createdAt:(new Date).toISOString(),updatedAt:(new Date).toISOString()})}catch(error){throw error}}static async debugTokenStatus(){const user=auth.currentUser;if(!user)return void console.log("No authenticated user");const state=store.getState();console.log("Redux aceToken:",state.auth.aceToken?"Present":"Missing");const localStorageToken=localStorage.getItem("aceToken");console.log("LocalStorage aceToken:",localStorageToken?"Present":"Missing");const tokenService=getTokenService(),secureToken=await tokenService.getToken(user.uid);console.log("Secure storage token:",secureToken?"Present":"Missing");try{const userDoc=await getDoc(doc(db,"users",user.uid));if(userDoc.exists()){const data=userDoc.data();console.log("Firestore aceJwt:",data.aceJwt?"Present":"Missing"),console.log("Firestore aceJwtEncrypted:",data.aceJwtEncrypted?"Present":"Missing")}else console.log("User document does not exist in Firestore")}catch(error){console.error("Error checking Firestore:",error)}}}"undefined"!=typeof window&amp;&amp;(window.TokenSyncService=TokenSyncService);const API_ENDPOINTS={QUERY_WORKER_URL:"https://building-vitals-query.jstahr.workers.dev"},ChartStatistics={mean:values=&gt;values&amp;&amp;0!==values.length?values.reduce((sum,val)=&gt;sum+val,0)/values.length:0,median:values=&gt;{if(!values||0===values.length)return 0;const sorted=[...values].sort((a,b)=&gt;a-b),mid=Math.floor(sorted.length/2);return sorted.length%2?sorted[mid]:(sorted[mid-1]+sorted[mid])/2},quartiles:values=&gt;{if(!values||0===values.length)return{q1:0,q2:0,q3:0};const sorted=[...values].sort((a,b)=&gt;a-b),q1Index=Math.floor(.25*sorted.length),q2Index=Math.floor(.5*sorted.length),q3Index=Math.floor(.75*sorted.length);return{q1:sorted[q1Index],q2:sorted[q2Index],q3:sorted[q3Index]}},standardDeviation:values=&gt;{if(!values||0===values.length)return 0;const avg=ChartStatistics.mean(values),squareDiffs=values.map(value=&gt;Math.pow(value-avg,2)),avgSquareDiff=ChartStatistics.mean(squareDiffs);return Math.sqrt(avgSquareDiff)},range:values=&gt;values&amp;&amp;0!==values.length?{min:Math.min(...values),max:Math.max(...values)}:{min:0,max:0},percentile:(values,percentile)=&gt;{if(!values||0===values.length)return 0;const sorted=[...values].sort((a,b)=&gt;a-b),index=Math.ceil(percentile/100*sorted.length)-1;return sorted[Math.max(0,Math.min(index,sorted.length-1))]}},TimeAggregation={aggregateByInterval:(data,intervalMs,method="average")=&gt;{if(!data||0===data.length)return[];const buckets=new Map;data.forEach(([timestamp,value])=&gt;{const bucketTime=Math.floor(timestamp/intervalMs)*intervalMs;buckets.has(bucketTime)||buckets.set(bucketTime,[]),buckets.get(bucketTime).push(value)});const result=[];return buckets.forEach((values,timestamp)=&gt;{let aggregatedValue;switch(method){case"sum":aggregatedValue=values.reduce((sum,val)=&gt;sum+val,0);break;case"max":aggregatedValue=Math.max(...values);break;case"min":aggregatedValue=Math.min(...values);break;case"latest":aggregatedValue=values[values.length-1];break;default:aggregatedValue=ChartStatistics.mean(values)}result.push([timestamp,aggregatedValue])}),result.sort((a,b)=&gt;a[0]-b[0])},getIntervalMs:interval=&gt;({"5min":3e5,"15min":9e5,hourly:36e5,daily:864e5,weekly:6048e5,monthly:2592e6}[interval]),getTimeRange:series=&gt;{let minTime=1/0,maxTime=-1/0;return series.forEach(s=&gt;{if(s.data&amp;&amp;s.data.length&gt;0){const firstTime=s.data[0][0],lastTime=s.data[s.data.length-1][0];minTime=Math.min(minTime,firstTime),maxTime=Math.max(maxTime,lastTime)}}),isFinite(minTime)&amp;&amp;isFinite(maxTime)?{min:minTime,max:maxTime}:{min:0,max:0}}},DeviationCalculations={fromTarget:(value,target)=&gt;value-target,fromRange:(value,min,max)=&gt;value&gt;=min&amp;&amp;value&lt;=max?0:value&lt;min?value-min:value-max,percentageDeviation:(value,reference)=&gt;0===reference?0:(value-reference)/Math.abs(reference)*100,normalizeDeviation:(deviation,threshold)=&gt;0===threshold?0:Math.max(-1,Math.min(1,deviation/threshold)),getSeverity:normalizedDeviation=&gt;{const absDeviation=Math.abs(normalizedDeviation);return absDeviation&lt;.3?"normal":absDeviation&lt;.7?"warning":"critical"}},DataValidation={isValidNumber:value=&gt;"number"==typeof value&amp;&amp;!isNaN(value)&amp;&amp;isFinite(value),filterValidDataPoints:data=&gt;data.filter(([timestamp,value])=&gt;DataValidation.isValidNumber(timestamp)&amp;&amp;DataValidation.isValidNumber(value)),hasValidData:series=&gt;!!((null==series?void 0:series.data)&amp;&amp;Array.isArray(series.data)&amp;&amp;series.data.length&gt;0)};function getTimeAxisConfig(options){const{showAxisName:showAxisName=!1,axisName:axisName="Time",min:min,max:max,interval:interval}=options||{};return{type:"time",boundaryGap:!1,...showAxisName&amp;&amp;{name:axisName},...void 0!==min&amp;&amp;{min:min},...void 0!==max&amp;&amp;{max:max},...void 0!==interval&amp;&amp;{interval:interval},axisLabel:{formatter:value=&gt;new Date(value).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0}),rotate:45,align:"right",verticalAlign:"top",color:"#666",fontSize:11},axisLine:{lineStyle:{color:"#ccc"}},splitLine:{show:!0,lineStyle:{color:"#f0f0f0",type:"dashed"}}}}function calculateSaturationPressure(temperature){return 133.322*Math.pow(10,8.07131-1730.63/(233.426+temperature))}function calculateHumidityRatio(temperature,relativeHumidity,pressure=101325){const pv=relativeHumidity/100*calculateSaturationPressure(temperature);return.621945*pv/(pressure-pv)}function calculateEnthalpy(dryBulbTemp,humidityRatio){return 1.006*dryBulbTemp+humidityRatio*(2501+1.86*dryBulbTemp)}function calculateDewPoint(temperature,relativeHumidity){const alpha2=17.27*temperature/(237.7+temperature)+Math.log(relativeHumidity/100);return 237.7*alpha2/(17.27-alpha2)}function calculateWetBulbTemperature(dryBulbTemp,relativeHumidity,pressure=101325,tolerance=.01){let wetBulbGuess=dryBulbTemp-5,iterations=0;for(;iterations&lt;100;){const humidityRatioActual=calculateHumidityRatio(dryBulbTemp,relativeHumidity,pressure),humidityRatioGuess=calculateHumidityRatio(wetBulbGuess,100,pressure),error=calculateEnthalpy(dryBulbTemp,humidityRatioActual)-(4.186*wetBulbGuess+humidityRatioGuess*(2501+1.86*wetBulbGuess));if(Math.abs(error)&lt;tolerance)return wetBulbGuess;wetBulbGuess+=error/50,iterations++}return dryBulbTemp-(dryBulbTemp-calculateDewPoint(dryBulbTemp,relativeHumidity))/3}function calculatePsychrometricProperties(dryBulbTemp,relativeHumidity,pressure=101325){const saturationPressure=calculateSaturationPressure(dryBulbTemp),vaporPressure=relativeHumidity/100*saturationPressure,humidityRatio=calculateHumidityRatio(dryBulbTemp,relativeHumidity,pressure),dewPointTemp=calculateDewPoint(dryBulbTemp,relativeHumidity),wetBulbTemp=calculateWetBulbTemperature(dryBulbTemp,relativeHumidity,pressure),enthalpy=calculateEnthalpy(dryBulbTemp,humidityRatio),specificVolume=function calculateSpecificVolume(temperature,humidityRatio,pressure=101325){return 287.042*(temperature+273.15)/pressure*(1+1.607858*humidityRatio)}(dryBulbTemp,humidityRatio,pressure);return{dryBulbTemp:dryBulbTemp,wetBulbTemp:wetBulbTemp,dewPointTemp:dewPointTemp,relativeHumidity:relativeHumidity,humidityRatio:humidityRatio,enthalpy:enthalpy,specificVolume:specificVolume,density:1/specificVolume,vaporPressure:vaporPressure,saturationPressure:saturationPressure}}function calculateASHRAE55Comfort(ta,tr,vel,rh,met,clo){const pmv=function calculatePMV(ta,tr,vel,rh,met,clo){const M=58.15*met,fcl=clo&lt;=.078?1+1.29*clo:1.05+.645*clo,hc=Math.max(2.38*Math.pow(Math.abs(ta-tr),.25),12.1*Math.sqrt(vel));let tcl=ta+(35.5-ta)/(3.5*(6.45*clo+.1));for(let i=0;i&lt;10;i++){const tclNew=35.7-.028*(M-0)-3.96e-8*fcl*(Math.pow(tcl+273,4)-Math.pow(tr+273,4))-fcl*hc*(tcl-ta);if(Math.abs(tclNew-tcl)&lt;.01)break;tcl=tclNew}const pa=10*rh*Math.exp(16.6536-4030.183/(ta+235));return(.303*Math.exp(-.036*M)+.028)*(M-0-3.05*(5.733-.007*(M-0)-pa)-.42*(M-0-58.15)-.0173*M*(5.867-pa)-.0014*M*(34-ta)-3.96e-8*fcl*(Math.pow(tcl+273,4)-Math.pow(tr+273,4))-fcl*hc*(tcl-ta))}(ta,tr,vel,rh,met,clo),ppd=function calculatePPD(pmv){return 100-95*Math.exp(-.03353*Math.pow(pmv,4)-.2179*Math.pow(pmv,2))}(pmv);let comfortCategory,withinComfortZone;return Math.abs(pmv)&lt;=.2&amp;&amp;ppd&lt;=6?(comfortCategory="I",withinComfortZone=!0):Math.abs(pmv)&lt;=.5&amp;&amp;ppd&lt;=10?(comfortCategory="II",withinComfortZone=!0):Math.abs(pmv)&lt;=.7&amp;&amp;ppd&lt;=15?(comfortCategory="III",withinComfortZone=!0):(comfortCategory="III",withinComfortZone=!1),{pmv:pmv,ppd:ppd,comfortCategory:comfortCategory,withinComfortZone:withinComfortZone}}function generateASHRAE55ComfortZone(season,clo=("summer"===season?.5:1),met=1.2,vel=.1){const boundary=[],tempRange="summer"===season?[20,28]:[18,26],humidityRange=[20,80];for(let temp=tempRange[0];temp&lt;=tempRange[1];temp+=.5)for(let rh=humidityRange[0];rh&lt;=humidityRange[1];rh+=5){const comfort=calculateASHRAE55Comfort(temp,temp,vel,rh,met,clo);comfort.withinComfortZone&amp;&amp;"III"!==comfort.comfortCategory&amp;&amp;boundary.push({temperature:temp,humidity:rh})}return function convexHull(points){if(points.length&lt;=3)return points;const sorted=[...points].sort((a,b)=&gt;a.temperature-b.temperature||a.humidity-b.humidity),lower=[];for(const point of sorted){for(;lower.length&gt;=2&amp;&amp;crossProduct(lower[lower.length-2],lower[lower.length-1],point)&lt;=0;)lower.pop();lower.push(point)}const upper=[];for(let i=sorted.length-1;i&gt;=0;i--){const point=sorted[i];for(;upper.length&gt;=2&amp;&amp;crossProduct(upper[upper.length-2],upper[upper.length-1],point)&lt;=0;)upper.pop();upper.push(point)}return upper.pop(),lower.pop(),lower.concat(upper)}(boundary)}function crossProduct(p1,p2,p3){return(p2.temperature-p1.temperature)*(p3.humidity-p1.humidity)-(p2.humidity-p1.humidity)*(p3.temperature-p1.temperature)}function generateConstantEnthalpyLines(enthalpyValues,tempRange,pressure=101325){const lines=[];return enthalpyValues.forEach(enthalpy=&gt;{const lineData=[];for(let temp=tempRange[0];temp&lt;=tempRange[1];temp+=1){const humidityRatio=(enthalpy-1.006*temp)/(2501+1.86*temp);if(humidityRatio&gt;=0&amp;&amp;humidityRatio&lt;=.03){const rh=pressure*humidityRatio/(.621945+humidityRatio)/calculateSaturationPressure(temp)*100;rh&lt;=100&amp;&amp;rh&gt;=0&amp;&amp;lineData.push([temp,rh])}}lineData.length&gt;0&amp;&amp;lines.push({name:`${enthalpy} kJ/kg`,data:lineData})}),lines}function generateConstantWetBulbLines(wetBulbValues,tempRange,pressure=101325){const lines=[];return wetBulbValues.forEach(wetBulb=&gt;{const lineData=[];for(let temp=wetBulb;temp&lt;=tempRange[1];temp+=.5){const w=((2501-2.326*wetBulb)*calculateHumidityRatio(wetBulb,100,pressure)-1.006*(temp-wetBulb))/(2501+1.86*temp-4.186*wetBulb);if(w&gt;=0&amp;&amp;w&lt;=.03){const rh=pressure*w/(.621945+w)/calculateSaturationPressure(temp)*100;rh&lt;=100&amp;&amp;rh&gt;=0&amp;&amp;lineData.push([temp,rh])}}lineData.length&gt;0&amp;&amp;lines.push({name:`${wetBulb}°C WB`,data:lineData})}),lines}function interpolateValue(series,targetTimestamp,method="linear"){if(!series||0===series.length)return null;const sortedSeries=[...series].sort((a,b)=&gt;a[0]-b[0]),exactMatch=sortedSeries.find(p=&gt;p[0]===targetTimestamp);if(exactMatch)return exactMatch[1];let before=null,after=null;for(let i=0;i&lt;sortedSeries.length;i++)if(sortedSeries[i][0]&lt;targetTimestamp)before=sortedSeries[i];else if(sortedSeries[i][0]&gt;targetTimestamp){after=sortedSeries[i];break}if(!before&amp;&amp;!after)return null;if(!before)return after[1];if(!after)return before[1];switch(method){case"nearest":return Math.abs(before[0]-targetTimestamp)&lt;Math.abs(after[0]-targetTimestamp)?before[1]:after[1];case"step":return before[1];default:return linearInterpolate(before,after,targetTimestamp)}}function linearInterpolate(before,after,targetTimestamp){const timeDiff=after[0]-before[0];if(0===timeDiff)return before[1];const ratio=(targetTimestamp-before[0])/timeDiff;return before[1]+(after[1]-before[1])*ratio}function getAllTimestamps(...series){const timestampSet=new Set;return series.forEach(s=&gt;{s&amp;&amp;Array.isArray(s)&amp;&amp;s.forEach(point=&gt;{Array.isArray(point)&amp;&amp;"number"==typeof point[0]&amp;&amp;timestampSet.add(point[0])})}),Array.from(timestampSet).sort((a,b)=&gt;a-b)}function generateSamplingTimestamps(startTime,endTime,strategy,existingTimestamps,interval){switch(strategy){case"all":case"changes":case"union":default:return existingTimestamps;case"periodic":{const samplingInterval=interval||6e4,timestamps=[];for(let t=startTime;t&lt;=endTime;t+=samplingInterval)timestamps.push(t);return timestamps}}}function validateSeriesForInterpolation(series,minPoints=2){return!(!series||!Array.isArray(series))&amp;&amp;(!(series.length&lt;minPoints)&amp;&amp;series.every(point=&gt;Array.isArray(point)&amp;&amp;point.length&gt;=2&amp;&amp;"number"==typeof point[0]&amp;&amp;"number"==typeof point[1]&amp;&amp;!isNaN(point[0])&amp;&amp;!isNaN(point[1])))}const ChartTimeFormatter={tooltip:function formatTooltipTime(timestamp){if(!timestamp)return"No timestamp";try{return formatDate(timestamp,!0)}catch(error){return console.warn("Failed to format tooltip time:",error),"Invalid time"}},axis:function formatAxisLabel(timestamp,timeRange){if(!timestamp)return"";try{const date=new Date(timestamp);if(timeRange){const duration=timeRange.end-timeRange.start,dayInMs=24*36e5,weekInMs=7*dayInMs;return duration&lt;dayInMs?date.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0}):duration&lt;weekInMs?date.toLocaleDateString("en-US",{weekday:"short",hour:"numeric",minute:"2-digit",hour12:!0}):duration&lt;30*dayInMs?date.toLocaleDateString("en-US",{month:"short",day:"numeric"}):date.toLocaleDateString("en-US",{month:"short",year:"numeric"})}return formatDate(timestamp,!1)}catch(error){return console.warn("Failed to format axis label:",error),""}},calendar:function formatCalendarDate(timestamp){if(!timestamp)return"";try{return formatDate(timestamp,!1)}catch(error){return console.warn("Failed to format calendar date:",error),""}},table:function formatTableTime(timestamp,includeSeconds=!1){if(!timestamp)return"N/A";try{const date=new Date(timestamp);return includeSeconds?date.toLocaleString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"numeric",minute:"2-digit",second:"2-digit",hour12:!0}):formatDate(timestamp,!0)}catch(error){return console.warn("Failed to format table time:",error),"Invalid time"}},relative:function formatRelativeTime(timestamp){if(!timestamp)return"";try{const date=new Date(timestamp),diffMs=(new Date).getTime()-date.getTime(),seconds=Math.floor(diffMs/1e3),minutes=Math.floor(seconds/60),hours=Math.floor(minutes/60),days=Math.floor(hours/24);return seconds&lt;60?"Just now":minutes&lt;60?`${minutes} minute${1!==minutes?"s":""} ago`:hours&lt;24?`${hours} hour${1!==hours?"s":""} ago`:days&lt;7?`${days} day${1!==days?"s":""} ago`:formatDate(timestamp,!1)}catch(error){return console.warn("Failed to format relative time:",error),""}},duration:function formatDuration(startTimestamp,endTimestamp){try{const durationMs=Math.abs(endTimestamp-startTimestamp),seconds=Math.floor(durationMs/1e3),minutes=Math.floor(seconds/60),hours=Math.floor(minutes/60),days=Math.floor(hours/24),parts=[];return days&gt;0&amp;&amp;parts.push(`${days} day${1!==days?"s":""}`),hours%24&gt;0&amp;&amp;parts.push(`${hours%24} hour${hours%24!=1?"s":""}`),minutes%60&gt;0&amp;&amp;0===days&amp;&amp;parts.push(`${minutes%60} minute${minutes%60!=1?"s":""}`),seconds%60&gt;0&amp;&amp;0===hours&amp;&amp;0===days&amp;&amp;parts.push(`${seconds%60} second${seconds%60!=1?"s":""}`),parts.length&gt;0?parts.join(" "):"Less than a second"}catch(error){return console.warn("Failed to format duration:",error),"Unknown duration"}},echartsFormat:function getEChartsTimeFormat(timeRange){if(!timeRange)return"{MM}-{dd} {HH}:{mm}";const duration=timeRange.end-timeRange.start;return duration&lt;864e5?"{HH}:{mm}":duration&lt;6048e5?"{MM}-{dd} {HH}:{mm}":duration&lt;2592e6?"{MM}-{dd}":"{yyyy}-{MM}"},isValid:function isValidTimestamp(timestamp){if(!timestamp)return!1;try{const date=new Date(timestamp);return!isNaN(date.getTime())}catch{return!1}}},DEFAULT_OPTIONS={method:"nearest",maxGap:3e5,tolerance:3e4,requireAllSeries:!1,minSeriesRequired:1,fillGaps:!0};function alignTimeSeries(series,options={}){const config={...DEFAULT_OPTIONS,...options};if(!series||0===series.length)return[];const allTimestamps=new Set,timestampGroups=new Map;series.forEach(s=&gt;{s.data.forEach(([ts])=&gt;{let foundGroup=!1;for(const[groupTs]of timestampGroups)if(Math.abs(ts-groupTs)&lt;=config.tolerance){timestampGroups.get(groupTs).push(ts),foundGroup=!0;break}foundGroup||(timestampGroups.set(ts,[ts]),allTimestamps.add(ts))})});const representativeTimestamps=new Map;timestampGroups.forEach((group,originalTs)=&gt;{const sorted=group.sort((a,b)=&gt;a-b),median=sorted[Math.floor(sorted.length/2)];representativeTimestamps.set(originalTs,median)});const lastKnownValues=new Array(series.length).fill(null),alignedData=[];return Array.from(allTimestamps).sort((a,b)=&gt;a-b).forEach(timestamp=&gt;{const representativeTs=representativeTimestamps.get(timestamp)||timestamp,values=[];let foundCount=0;for(let i=0;i&lt;series.length;i++){let value=findValueAtTimestamp(series[i].data,representativeTs,config);null===value&amp;&amp;config.fillGaps&amp;&amp;null!==lastKnownValues[i]&amp;&amp;(value=lastKnownValues[i]),null!==value&amp;&amp;null!==findValueAtTimestamp(series[i].data,representativeTs,{...config})&amp;&amp;(lastKnownValues[i]=value),null!==value&amp;&amp;foundCount++,values.push(value)}const minRequired=config.minSeriesRequired??series.length;if(config.requireAllSeries?foundCount===series.length:foundCount&gt;=Math.min(minRequired,series.length)){const finalValues=values.map(v=&gt;null===v?NaN:v);alignedData.push({timestamp:representativeTs,values:finalValues})}}),alignedData}function findValueAtTimestamp(data,targetTimestamp,config){if(!data||0===data.length)return null;const sorted=[...data].sort((a,b)=&gt;a[0]-b[0]);let closest=null,minDiff=1/0;for(const point of sorted){const diff=Math.abs(point[0]-targetTimestamp);diff&lt;=config.tolerance&amp;&amp;diff&lt;minDiff&amp;&amp;(minDiff=diff,closest=point)}if(closest)return closest[1];switch(config.method){case"nearest":return findNearestValue(sorted,targetTimestamp,config.maxGap);case"linear":return function interpolateLinear(data,timestamp,maxGap){let before=null,after=null;for(let i=0;i&lt;data.length;i++)if(data[i][0]&lt;=timestamp&amp;&amp;(before=data[i]),data[i][0]&gt;=timestamp&amp;&amp;!after){after=data[i];break}if(!before||!after)return findNearestValue(data,timestamp,maxGap);if(after[0]-before[0]&gt;maxGap)return null;const ratio=(timestamp-before[0])/(after[0]-before[0]);return before[1]+ratio*(after[1]-before[1])}(sorted,targetTimestamp,config.maxGap);case"previous":return function findPreviousValue(data,timestamp,maxGap){let previous=null;for(const point of data){if(!(point[0]&lt;=timestamp))break;previous=point}if(previous&amp;&amp;timestamp-previous[0]&lt;=maxGap)return previous[1];return null}(sorted,targetTimestamp,config.maxGap);case"next":return function findNextValue(data,timestamp,maxGap){for(const point of data)if(point[0]&gt;=timestamp){if(point[0]-timestamp&lt;=maxGap)return point[1];break}return null}(sorted,targetTimestamp,config.maxGap);default:return null}}function findNearestValue(data,timestamp,maxGap){let nearest=null,minDiff=1/0;for(const point of data){const diff=Math.abs(point[0]-timestamp);diff&lt;minDiff&amp;&amp;diff&lt;=maxGap&amp;&amp;(minDiff=diff,nearest=point)}return nearest?nearest[1]:null}function detectSamplingInterval(data){if(!data||data.length&lt;2)return null;const sorted=[...data].sort((a,b)=&gt;a[0]-b[0]),intervals=[];for(let i=1;i&lt;sorted.length;i++)intervals.push(sorted[i][0]-sorted[i-1][0]);return intervals.sort((a,b)=&gt;a-b),intervals[Math.floor(intervals.length/2)]}function analyzeAlignmentQuality(series){const allTimestamps=new Set;series.forEach(s=&gt;{s.data.forEach(([ts])=&gt;allTimestamps.add(ts))});const aligned=alignTimeSeries(series),samplingIntervals=series.map(s=&gt;({name:s.name,interval:detectSamplingInterval(s.data)})),alignmentRate=aligned.length/allTimestamps.size;let recommendation="";return recommendation=alignmentRate&gt;.9?"Excellent alignment - data points are well synchronized":alignmentRate&gt;.7?"Good alignment - minor timestamp differences detected":alignmentRate&gt;.5?"Fair alignment - consider adjusting sensor sampling rates":"Poor alignment - significant timestamp mismatches. Check sensor configurations and time synchronization",{totalPoints:allTimestamps.size,alignedPoints:aligned.length,alignmentRate:alignmentRate,samplingIntervals:samplingIntervals,recommendation:recommendation}}function getRenderingStrategy(options){const days=function parseDateRangeToDays(dateRange){const match=dateRange.match(/^(\d+)([hdmyMY])$/);if(!match)return"today"===dateRange||"yesterday"===dateRange?1:"custom"===dateRange?30:7;const[,value,unit]=match,num=parseInt(value,10);switch(unit){case"h":return num/24;case"d":return num;case"m":case"M":return 30*num;case"y":case"Y":return 365*num;default:return 7}}(options.dateRange),totalPoints=function calculateTotalDataPoints(pointsPerSeries,seriesCount=1){return pointsPerSeries*seriesCount}(options.dataPointsPerSeries,options.seriesCount||1);return days&lt;=7?{level:"full",smooth:!0,sampling:"none",lineWidth:1.5,showArea:!0,animation:!0,large:!1,largeThreshold:5e3,aggregation:"none",dataReduction:0,message:void 0,faultDetection:{mode:"realtime",accuracy:"full",notice:void 0}}:days&lt;=30?{level:"light",smooth:!0,sampling:"none",lineWidth:1.5,showArea:!0,animation:!0,large:totalPoints&gt;1e4,largeThreshold:1e4,aggregation:"none",dataReduction:0,message:void 0,faultDetection:{mode:"realtime",accuracy:"full",notice:void 0}}:days&lt;=180?{level:"moderate",smooth:!1,sampling:"average",lineWidth:1.2,showArea:!1,animation:!1,large:!0,largeThreshold:2e3,progressive:5e3,progressiveThreshold:1e4,aggregation:"none",dataReduction:0,message:"Optimized for performance",faultDetection:{mode:"realtime",accuracy:"full",notice:void 0}}:days&lt;=365?{level:"heavy",smooth:!1,sampling:"lttb",lineWidth:.8,showArea:!1,animation:!1,large:!0,largeThreshold:1e3,progressive:2e3,progressiveThreshold:5e3,hoverLayerThreshold:3e3,aggregation:"hourly",dataReduction:92,message:"Showing hourly averages for performance",faultDetection:{mode:"statistical",accuracy:"reduced",notice:"Fault detection using statistical analysis. Zoom in for detailed diagnostics."}}:{level:"extreme",smooth:!1,sampling:"max",lineWidth:.5,showArea:!1,animation:!1,large:!0,largeThreshold:500,progressive:1e3,progressiveThreshold:2e3,aggregation:"daily",dataReduction:99.7,message:"Showing daily aggregates for yearly view",faultDetection:{mode:"disabled",accuracy:"minimal",notice:"Fault detection disabled in yearly view. Shows trends only."}}}function getHeatmapRenderingStrategy(startDate,endDate,deviceCount){const validStartDate=startDate&amp;&amp;!isNaN(startDate.getTime())?startDate:new Date(Date.now()-864e5),validEndDate=endDate&amp;&amp;!isNaN(endDate.getTime())?endDate:new Date,days=Math.ceil((validEndDate.getTime()-validStartDate.getTime())/864e5);let dateRangeStr;dateRangeStr=days&lt;=1?"24h":days&lt;=7?"7d":days&lt;=30?"30d":days&lt;=180?"6m":days&lt;=365?"1y":`${Math.ceil(days/365)}y`;const baseStrategy=getRenderingStrategy({dateRange:dateRangeStr,dataPointsPerSeries:deviceCount*days*288,seriesCount:deviceCount});return days&lt;=7&amp;&amp;deviceCount*days*288&lt;=1e5?{...baseStrategy,cellResolution:"5min",preserveAnomalies:!0,anomalyThreshold:2,aggregationMethod:"max"}:days&lt;=30?{...baseStrategy,cellResolution:"15min",preserveAnomalies:!0,anomalyThreshold:2,aggregationMethod:"max",dataReduction:66}:days&lt;=60?{...baseStrategy,cellResolution:"30min",preserveAnomalies:!0,anomalyThreshold:1.5,aggregationMethod:"max",dataReduction:83}:days&lt;=90?{...baseStrategy,cellResolution:"1hour",preserveAnomalies:!0,anomalyThreshold:1.5,aggregationMethod:"max",dataReduction:92}:days&lt;=180?{...baseStrategy,cellResolution:"2hour",preserveAnomalies:!0,anomalyThreshold:1.5,aggregationMethod:"max",dataReduction:96}:days&lt;=365?{...baseStrategy,cellResolution:"4hour",preserveAnomalies:!0,anomalyThreshold:1.5,aggregationMethod:"max",dataReduction:98}:{...baseStrategy,cellResolution:"8hour",preserveAnomalies:!0,anomalyThreshold:1,aggregationMethod:"max",dataReduction:99.3}}function optimizeHeatmapForECharts(data,strategy){const devices2=[...new Set(data.map(d=&gt;d.device))].sort();let timestamps=[...new Set(data.map(d=&gt;d.timestamp))].sort((a,b)=&gt;a-b);if(timestamps.length&gt;200){const step=Math.ceil(timestamps.length/200),sampledTimestamps=[];for(let i=0;i&lt;timestamps.length;i+=step)sampledTimestamps.push(timestamps[i]);timestamps=sampledTimestamps,data=data.filter(d=&gt;timestamps.includes(d.timestamp))}const deviceIndex=new Map(devices2.map((d,i)=&gt;[d,i])),timeIndex=new Map(timestamps.map((t,i)=&gt;[t,i])),chartData=data.map(cell=&gt;[timeIndex.get(cell.timestamp),deviceIndex.get(cell.device),cell.maxDeviation]),timeLabels=timestamps.map(t=&gt;{const date=new Date(t);switch(strategy.cellResolution){case"5min":case"15min":case"30min":return date.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"});case"1hour":case"2hour":case"4hour":case"8hour":return date.toLocaleString("en-US",{month:"short",day:"numeric",hour:"2-digit"});case"1day":return date.toLocaleDateString("en-US",{month:"short",day:"numeric"})}}),allValues=data.map(d=&gt;Math.abs(d.maxDeviation));return Math.max(...allValues),{data:chartData,xAxis:timeLabels,yAxis:devices2,visualMap:{type:"continuous",min:-2,max:2,calculable:!0,realtime:!0,orient:"horizontal",left:"center",bottom:"5%",precision:2,text:["Above Target","Below Target"],textGap:10,dimension:2,seriesIndex:0,inRange:{color:["#1565c0","#42a5f5","#81c784","#66bb6a","#4caf50","#66bb6a","#ffcc80","#ff7043","#d32f2f"]},formatter:value=&gt;{const percentage=(100*value).toFixed(0);return Math.abs(value)&lt;.01?"On Target":value&gt;0?`+${percentage}%`:`${percentage}%`}}}}const chartActionDispatcher=new class ChartActionDispatcher{constructor(){__publicField(this,"charts",new Map),__publicField(this,"actionHistory",[]),__publicField(this,"maxHistorySize",100)}registerChart(chartId,chart){this.charts.set(chartId,chart)}unregisterChart(chartId){this.charts.delete(chartId)}dispatchAction(chartId,action){const chart=this.charts.get(chartId);if(chart)try{chart.dispatchAction(action),this.addToHistory(chartId,action)}catch(error){}}zoomToTimeRange(chartId,startTime,endTime){this.dispatchAction(chartId,{type:"dataZoom",startValue:startTime,endValue:endTime})}zoomToPercentage(chartId,start,end){this.dispatchAction(chartId,{type:"dataZoom",start:start,end:end})}resetZoom(chartId){this.zoomToPercentage(chartId,0,100)}highlightDataPoint(chartId,seriesIndex,dataIndex){this.dispatchAction(chartId,{type:"highlight",seriesIndex:seriesIndex,dataIndex:dataIndex})}highlightSeries(chartId,seriesName){this.dispatchAction(chartId,{type:"highlight",seriesName:seriesName})}clearHighlights(chartId){this.dispatchAction(chartId,{type:"downplay"})}showTooltipAtPosition(chartId,x,y){this.dispatchAction(chartId,{type:"showTip",x:x,y:y})}showTooltipAtDataPoint(chartId,seriesIndex,dataIndex){this.dispatchAction(chartId,{type:"showTip",seriesIndex:seriesIndex,dataIndex:dataIndex})}hideTooltip(chartId){this.dispatchAction(chartId,{type:"hideTip"})}toggleLegend(chartId,seriesName){this.dispatchAction(chartId,{type:"legendToggleSelect",name:seriesName})}showOnlySeries(chartId,seriesNames){const chart=this.charts.get(chartId);if(!chart)return;(chart.getOption().series||[]).forEach(series=&gt;{series.name&amp;&amp;!seriesNames.includes(series.name)&amp;&amp;this.dispatchAction(chartId,{type:"legendUnSelect",name:series.name})}),seriesNames.forEach(name=&gt;{this.dispatchAction(chartId,{type:"legendSelect",name:name})})}controlTimeline(chartId,play){this.dispatchAction(chartId,{type:"timelinePlayChange",playState:play})}setTimelineIndex(chartId,index){this.dispatchAction(chartId,{type:"timelineChange",currentIndex:index})}zoomToAlert(chartId,alertTime,windowMinutes=30){const windowMs=60*windowMinutes*1e3;this.zoomToTimeRange(chartId,alertTime-windowMs,alertTime+windowMs);const chart=this.charts.get(chartId);if(chart){const option=chart.getOption();if(option.series&amp;&amp;option.series.length&gt;0){const series=option.series[0];if(series.data&amp;&amp;Array.isArray(series.data)){let closestIndex=0,closestDiff=1/0;series.data.forEach((point,index)=&gt;{var _a;const timestamp=Array.isArray(point)?point[0]:null==(_a=point.value)?void 0:_a[0];if(timestamp){const diff=Math.abs(timestamp-alertTime);diff&lt;closestDiff&amp;&amp;(closestDiff=diff,closestIndex=index)}}),this.highlightDataPoint(chartId,0,closestIndex),this.showTooltipAtDataPoint(chartId,0,closestIndex)}}}}createSnapshot(chartId){const chart=this.charts.get(chartId);return chart?chart.getOption():null}restoreSnapshot(chartId,snapshot){const chart=this.charts.get(chartId);chart&amp;&amp;chart.setOption(snapshot,!0)}getActionHistory(chartId){return chartId?this.actionHistory.filter(entry=&gt;entry.chartId===chartId):[...this.actionHistory]}addToHistory(chartId,action){this.actionHistory.push({chartId:chartId,action:action,timestamp:new Date}),this.actionHistory.length&gt;this.maxHistorySize&amp;&amp;this.actionHistory.shift()}clearHistory(){this.actionHistory=[]}},registerChartForActions=(chartId,chart)=&gt;chartActionDispatcher.registerChart(chartId,chart);const chartConnectionManager=new class ChartConnectionManager{constructor(){__publicField(this,"groups",new Map),__publicField(this,"chartToGroup",new Map)}createGroup(groupId,description){this.groups.has(groupId)||this.groups.set(groupId,{id:groupId,charts:new Set,description:description})}addToGroup(chart,groupId){this.groups.has(groupId)||this.createGroup(groupId);const previousGroup=this.chartToGroup.get(chart);previousGroup&amp;&amp;this.removeFromGroup(chart,previousGroup);this.groups.get(groupId).charts.add(chart),this.chartToGroup.set(chart,groupId),this.updateGroupConnections(groupId)}removeFromGroup(chart,groupId){const actualGroupId=groupId||this.chartToGroup.get(chart);if(!actualGroupId)return;const group=this.groups.get(actualGroupId);group&amp;&amp;(group.charts.delete(chart),this.chartToGroup.delete(chart),this.updateGroupConnections(actualGroupId),0===group.charts.size&amp;&amp;this.groups.delete(actualGroupId))}updateGroupConnections(groupId){const group=this.groups.get(groupId);if(!group||group.charts.size&lt;2)return;const chartsArray=Array.from(group.charts);connect(chartsArray)}disconnectGroup(groupId){const group=this.groups.get(groupId);group&amp;&amp;(Array.from(group.charts),disconnect(groupId))}getGroupCharts(groupId){const group=this.groups.get(groupId);return group?Array.from(group.charts):[]}getChartGroup(chart){return this.chartToGroup.get(chart)}dispatchGroupAction(groupId,action){this.getGroupCharts(groupId).forEach(chart=&gt;{chart.dispatchAction(action)})}syncDataZoom(groupId,start,end){this.dispatchGroupAction(groupId,{type:"dataZoom",start:start,end:end})}highlightSeries(groupId,seriesName){this.dispatchGroupAction(groupId,{type:"highlight",seriesName:seriesName})}showTooltip(groupId,x,y){this.dispatchGroupAction(groupId,{type:"showTip",x:x,y:y})}dispose(){this.groups.forEach((group,groupId)=&gt;{this.disconnectGroup(groupId)}),this.groups.clear(),this.chartToGroup.clear()}getAllGroups(){return new Map(this.groups)}},addChartToGroup=(chart,groupId)=&gt;chartConnectionManager.addToGroup(chart,groupId);function detectLowAirflowAlarm(measuredAirflow,setpointAirflow,hasImportanceMultiplier=!1){const alarms=[];if(hasImportanceMultiplier)return alarms;const tenMinutesAgo=Date.now()-6e5,recentData=measuredAirflow.filter(p=&gt;p.timestamp&gt;tenMinutesAgo),recentSetpoints=setpointAirflow.filter(p=&gt;p.timestamp&gt;tenMinutesAgo);if(0===recentData.length||0===recentSetpoints.length)return alarms;let below70Count=0,below50Count=0;recentData.forEach((point,i)=&gt;{var _a;const setpoint=(null==(_a=recentSetpoints[i])?void 0:_a.value)||recentSetpoints[recentSetpoints.length-1].value;if(setpoint&gt;0){const percentOfSetpoint=point.value/setpoint*100;percentOfSetpoint&lt;50?below50Count++:percentOfSetpoint&lt;70&amp;&amp;below70Count++}});const percentBelow50=below50Count/recentData.length*100,percentBelow70=below70Count/recentData.length*100;return percentBelow50&gt;90?alarms.push({level:3,type:"LOW_AIRFLOW_CRITICAL",message:"Measured airflow is less than 50% of setpoint",timestamp:Date.now(),duration:10,value:recentData[recentData.length-1].value,threshold:.5*recentSetpoints[recentSetpoints.length-1].value}):percentBelow70&gt;90&amp;&amp;alarms.push({level:4,type:"LOW_AIRFLOW_WARNING",message:"Measured airflow is less than 70% of setpoint",timestamp:Date.now(),duration:10,value:recentData[recentData.length-1].value,threshold:.7*recentSetpoints[recentSetpoints.length-1].value}),alarms}function calculateCoolingSATResetRequests(zoneTemp,coolingSetpoint,coolingLoopOutput,suppressionActive=!1){if(suppressionActive)return 0;const tempDeviation=zoneTemp-coolingSetpoint;return tempDeviation&gt;=5?3:tempDeviation&gt;=3?2:coolingLoopOutput&gt;95?1:0}function calculateStaticPressureResetRequests(measuredAirflow,setpointAirflow,damperPosition){if(setpointAirflow&lt;=0)return 0;const percentOfSetpoint=measuredAirflow/setpointAirflow*100;return percentOfSetpoint&lt;50&amp;&amp;damperPosition&gt;95?3:percentOfSetpoint&lt;70&amp;&amp;damperPosition&gt;95?2:damperPosition&gt;95?1:0}function calculateHotWaterResetRequests(measuredDAT,setpointDAT,valvePosition){const datDeviation=setpointDAT-measuredDAT;return datDeviation&gt;=30?3:datDeviation&gt;=15?2:valvePosition&gt;95?1:0}function detectComprehensiveFaults(data,config={}){const faults=[],fc1=function detectLowAirflowFault(data,persistenceTime){const{airflow:airflow,airflowSp:airflowSp,timestamps:timestamps}=data;let faultStart=null,faultDuration=0;for(let i=0;i&lt;airflow.length;i++)airflowSp[i]&gt;0&amp;&amp;airflow[i]&lt;.7*airflowSp[i]?(faultStart||(faultStart=timestamps[i]),faultDuration=timestamps[i]-(faultStart||timestamps[i])):(faultStart=null,faultDuration=0);return{code:"FC1",name:"Low Airflow",severity:faultDuration&gt;persistenceTime?"high":"medium",detected:faultDuration&gt;persistenceTime,persistenceTime:faultDuration,requiredPersistence:persistenceTime,currentValue:airflow[airflow.length-1]||0,threshold:.7*(airflowSp[airflowSp.length-1]||0),rootCauses:["Damper actuator failure","Duct obstruction or collapse","Airflow sensor calibration error","Insufficient static pressure","VAV controller failure"],recommendations:[],energyImpact:75,timestamp:Date.now()}}(data,3e5);fc1.detected&amp;&amp;(fc1.recommendations=[{priority:"high",action:"Check damper actuator operation",detail:"Verify actuator receives control signal (0-10V or 4-20mA). Check for binding or mechanical failure.",estimatedCost:"$150-300",estimatedSavings:"$50-100/month",technicalLevel:"technician",tools:["Multimeter","Actuator stroke tool"],safetyNotes:["Lock out controls before testing"]},{priority:"medium",action:"Calibrate airflow sensor",detail:"Zero the sensor with damper closed. Verify K-factor matches duct size.",estimatedCost:"$200",estimatedSavings:"$30-50/month",technicalLevel:"technician",tools:["Pitot tube","Manometer","BAS laptop"]},{priority:"medium",action:"Check for duct obstructions",detail:"Inspect for collapsed flex duct, closed fire dampers, or debris.",estimatedCost:"$100-500",estimatedSavings:"$40-80/month",technicalLevel:"operator",tools:["Inspection camera","Flashlight"]}],faults.push(fc1));const fc2=function detectStuckDamperFault(data,persistenceTime){const{damper:damper,timestamps:timestamps}=data;let faultStart=null,faultDuration=0;const windowSize=10;for(let i=windowSize;i&lt;damper.length;i++){const recentValues=damper.slice(i-windowSize,i);Math.max(...recentValues)-Math.min(...recentValues)&lt;2?(faultStart||(faultStart=timestamps[i-windowSize]),faultDuration=timestamps[i]-(faultStart||timestamps[i])):(faultStart=null,faultDuration=0)}return{code:"FC2",name:"Stuck Damper",severity:faultDuration&gt;persistenceTime?"high":"low",detected:faultDuration&gt;persistenceTime,persistenceTime:faultDuration,requiredPersistence:persistenceTime,currentValue:damper[damper.length-1]||0,threshold:2,rootCauses:["Actuator mechanical failure","Control signal loss","Damper blade binding","Linkage disconnected","Power failure to actuator"],recommendations:[],energyImpact:100,timestamp:Date.now()}}(data,6e5);fc2.detected&amp;&amp;(fc2.recommendations=[{priority:"immediate",action:"Manually exercise damper",detail:"Disconnect actuator and manually move damper through full range. Check for binding.",estimatedCost:"$100",estimatedSavings:"$60-120/month",technicalLevel:"technician",tools:["Screwdriver","Wrench set"],safetyNotes:["Ensure system is in manual mode"]},{priority:"high",action:"Replace damper actuator",detail:"If manual operation is smooth, replace actuator. Match torque rating to damper size.",estimatedCost:"$400-800",estimatedSavings:"$80-150/month",technicalLevel:"technician",tools:["Replacement actuator","Wiring tools"]}],faults.push(fc2));const fc3=function detectLeakingDamperFault(data,VcoolMax){const{airflow:airflow,damper:damper}=data,threshold=Math.max(.1*VcoolMax,50);let detected=!1;const recentData=Math.min(10,airflow.length);let leakCount=0;for(let i=airflow.length-recentData;i&lt;airflow.length;i++)damper[i]&lt;5&amp;&amp;airflow[i]&gt;threshold&amp;&amp;leakCount++;return detected=leakCount&gt;.8*recentData,{code:"FC3",name:"Leaking Damper",severity:detected?"medium":"low",detected:detected,persistenceTime:0,requiredPersistence:0,currentValue:airflow[airflow.length-1]||0,threshold:threshold,rootCauses:["Worn damper blade seals","Damaged jamb seals","Blade misalignment","Frame distortion","Improper damper sizing"],recommendations:[],energyImpact:150,timestamp:Date.now()}}(data,config.VcoolMax||1e3);fc3.detected&amp;&amp;(fc3.recommendations=[{priority:"high",action:"Inspect damper blade seals",detail:"Check for worn, missing, or damaged blade and jamb seals. Look for light leakage.",estimatedCost:"$200-400",estimatedSavings:"$100-200/month",technicalLevel:"technician",tools:["Flashlight","Smoke pencil"]},{priority:"medium",action:"Adjust damper blade alignment",detail:"Ensure blades close completely and evenly. Adjust linkage if necessary.",estimatedCost:"$150",estimatedSavings:"$50-100/month",technicalLevel:"technician",tools:["Allen keys","Level"]},{priority:"low",action:"Replace damper assembly",detail:"If seals cannot be repaired, replace entire damper with low-leakage model.",estimatedCost:"$800-1500",estimatedSavings:"$150-300/month",technicalLevel:"engineer",tools:["New damper","Duct tools","Sealant"]}],faults.push(fc3));const fc4=function detectHuntingFault(data){const{damper:damper,timestamps:timestamps}=data;let lastDirection=0;const oscillationTimes=[];let lastOscillationTime=timestamps[0];for(let i=1;i&lt;damper.length;i++){const change=damper[i]-damper[i-1],direction=change&gt;0?1:change&lt;0?-1:0;0!==direction&amp;&amp;direction!==lastDirection&amp;&amp;0!==lastDirection&amp;&amp;(oscillationTimes.push(timestamps[i]-lastOscillationTime),lastOscillationTime=timestamps[i]),lastDirection=direction}const avgPeriod=oscillationTimes.length&gt;0?oscillationTimes.reduce((a,b)=&gt;a+b,0)/oscillationTimes.length:1/0,frequency=avgPeriod&gt;0?6e4/avgPeriod:0,detected=frequency&gt;4;return{code:"FC4",name:"Control Loop Hunting",severity:detected?"medium":"low",detected:detected,persistenceTime:0,requiredPersistence:0,currentValue:frequency,threshold:4,rootCauses:["PID loop tuning issues","Insufficient deadband","Actuator hysteresis","Sensor noise","Oversized equipment"],recommendations:[],energyImpact:50,timestamp:Date.now()}}(data);fc4.detected&amp;&amp;(fc4.recommendations=[{priority:"immediate",action:"Increase control deadband",detail:"Increase temperature deadband from 2°F to 4°F to reduce cycling.",estimatedCost:"$0",estimatedSavings:"$30-60/month",technicalLevel:"operator",tools:["BAS interface"]},{priority:"high",action:"Tune PID control loops",detail:"Reduce integral gain, increase derivative time. Use auto-tuning if available.",estimatedCost:"$200",estimatedSavings:"$40-80/month",technicalLevel:"engineer",tools:["BAS laptop","Trending software"]},{priority:"medium",action:"Check actuator hysteresis",detail:"Verify actuator moves smoothly without sticking. Replace if excessive play.",estimatedCost:"$400-600",estimatedSavings:"$50-100/month",technicalLevel:"technician",tools:["Actuator tester"]}],faults.push(fc4));const fc5=function detectSimultaneousHCFault(data,persistenceTime){const{heating:heating,damper:damper,timestamps:timestamps}=data;let faultStart=null,faultDuration=0;for(let i=0;i&lt;Math.min(heating.length,damper.length);i++)heating[i]&gt;10&amp;&amp;damper[i]&gt;70?(faultStart||(faultStart=timestamps[i]),faultDuration=timestamps[i]-(faultStart||timestamps[i])):(faultStart=null,faultDuration=0);return{code:"FC5",name:"Simultaneous Heating/Cooling",severity:faultDuration&gt;persistenceTime?"high":"medium",detected:faultDuration&gt;persistenceTime,persistenceTime:faultDuration,requiredPersistence:persistenceTime,currentValue:heating[heating.length-1]||0,threshold:10,rootCauses:["Incorrect control sequencing","Leaking heating valve","Missing deadband","Sensor error","Programming error"],recommendations:[],energyImpact:250,timestamp:Date.now()}}(data,3e5);fc5.detected&amp;&amp;(fc5.recommendations=[{priority:"immediate",action:"Verify sequencing logic",detail:"Ensure heating and cooling are properly sequenced with adequate deadband.",estimatedCost:"$100",estimatedSavings:"$200-400/month",technicalLevel:"engineer",tools:["BAS laptop","Logic documentation"]},{priority:"high",action:"Check valve leakage",detail:"Verify heating valve closes completely. Check for internal bypass.",estimatedCost:"$300-500",estimatedSavings:"$150-300/month",technicalLevel:"technician",tools:["Infrared thermometer","Valve wrench"]},{priority:"medium",action:"Implement supply air temperature reset",detail:"Reset AHU discharge temperature based on zone demands to minimize reheat.",estimatedCost:"$500",estimatedSavings:"$100-200/month",technicalLevel:"engineer",tools:["BAS programming"]}],faults.push(fc5));const fc6=function detectPoorTempControlFault(data,persistenceTime){const{roomTemp:roomTemp}=data,temps=roomTemp.slice(-20),avgTemp=temps.reduce((a,b)=&gt;a+b,0)/temps.length,variance=temps.reduce((sum,t)=&gt;sum+Math.pow(t-avgTemp,2),0)/temps.length,stdDev=Math.sqrt(variance),detected=stdDev&gt;3;return{code:"FC6",name:"Poor Temperature Control",severity:detected?"medium":"low",detected:detected,persistenceTime:0,requiredPersistence:persistenceTime,currentValue:stdDev,threshold:3,rootCauses:["Sensor location issues","Load variations","Poor air distribution","Undersized equipment","Control loop tuning"],recommendations:[],energyImpact:60,timestamp:Date.now()}}(data,6e5);return fc6.detected&amp;&amp;(fc6.recommendations=[{priority:"high",action:"Relocate or shield temperature sensor",detail:"Move sensor away from supply diffusers, windows, and heat sources.",estimatedCost:"$150-300",estimatedSavings:"$40-80/month",technicalLevel:"technician",tools:["Temperature sensor","Shielding material"]},{priority:"medium",action:"Balance air distribution",detail:"Adjust diffuser pattern and throw. Check for short-circuiting airflow.",estimatedCost:"$200",estimatedSavings:"$30-60/month",technicalLevel:"technician",tools:["Anemometer","Smoke pencil"]}],faults.push(fc6)),faults}function analyzeSensorReliability(sensorData,sensorName,expectedRange){const issues={noise:!1,drift:!1,stuck:!1,outOfRange:!1,intermittent:!1},differences=[];for(let i=1;i&lt;sensorData.length;i++)differences.push(Math.abs(sensorData[i]-sensorData[i-1]));const avgDiff=differences.reduce((a,b)=&gt;a+b,0)/differences.length,maxDiff=Math.max(...differences);issues.noise=maxDiff&gt;10*avgDiff;const uniqueValues=new Set(sensorData);if(issues.stuck=uniqueValues.size&lt;.1*sensorData.length,issues.outOfRange=sensorData.some(v=&gt;v&lt;expectedRange.min||v&gt;expectedRange.max),sensorData.length&gt;20){const firstHalf=sensorData.slice(0,sensorData.length/2),secondHalf=sensorData.slice(sensorData.length/2),firstAvg=firstHalf.reduce((a,b)=&gt;a+b,0)/firstHalf.length,secondAvg=secondHalf.reduce((a,b)=&gt;a+b,0)/secondHalf.length,drift=Math.abs(secondAvg-firstAvg);issues.drift=drift&gt;.1*(expectedRange.max-expectedRange.min)}const nullCount=sensorData.filter(v=&gt;null==v||isNaN(v)).length;issues.intermittent=nullCount&gt;.05*sensorData.length;const issueCount=Object.values(issues).filter(v=&gt;v).length,reliability=Math.max(0,100-20*issueCount);let recommendation="Sensor operating normally";return issues.stuck?recommendation="Replace sensor - appears to be stuck":issues.outOfRange?recommendation="Recalibrate sensor - reading out of expected range":issues.noise?recommendation="Check sensor wiring and shielding - excessive noise detected":issues.drift?recommendation="Schedule sensor calibration - drift detected":issues.intermittent&amp;&amp;(recommendation="Check sensor connection - intermittent signal"),{sensorName:sensorName,reliability:reliability,issues:issues,recommendation:recommendation}}function generateSystemHealthReport(faults,sensorReliability){const activeFaults=faults.filter(f=&gt;f.detected),criticalCount=activeFaults.filter(f=&gt;"critical"===f.severity).length,highCount=activeFaults.filter(f=&gt;"high"===f.severity).length,mediumCount=activeFaults.filter(f=&gt;"medium"===f.severity).length,faultScore=100-(25*criticalCount+15*highCount+5*mediumCount),sensorScore=sensorReliability.reduce((sum,s)=&gt;sum+s.reliability,0)/sensorReliability.length,overallHealth=Math.max(0,Math.min(100,.7*faultScore+.3*sensorScore)),estimatedMonthlyCost=activeFaults.reduce((sum,f)=&gt;sum+f.energyImpact,0),topPriorities=activeFaults.filter(f=&gt;"critical"===f.severity||"high"===f.severity).map(f=&gt;{var _a;return`${f.code}: ${f.name} - ${(null==(_a=f.recommendations[0])?void 0:_a.action)||"Investigate"}`}).slice(0,3),maintenanceSchedule=[];return criticalCount&gt;0&amp;&amp;maintenanceSchedule.push("Immediate: Address critical faults"),highCount&gt;0&amp;&amp;maintenanceSchedule.push("This week: Fix high-priority issues"),mediumCount&gt;0&amp;&amp;maintenanceSchedule.push("This month: Schedule medium-priority repairs"),maintenanceSchedule.push("Quarterly: Sensor calibration and system tune-up"),{overallHealth:overallHealth,criticalIssues:criticalCount,estimatedMonthlyCost:estimatedMonthlyCost,topPriorities:topPriorities,maintenanceSchedule:maintenanceSchedule}}const transformPointData=rawPoints=&gt;rawPoints.map(point=&gt;{const id=point.id||point.pointId||point.point_id||"",name=point.name||point.pointName||point.point_name||`Point ${id}`;return{id:String(id),name:name,displayName:point.displayName||point.display_name||name,description:point.description||point.desc||"",unit:point.unit||point.units||point.engineering_units||"",type:point.type||point.pointType||point.point_type||"analog",deviceId:String(point.deviceId||point.device_id||""),siteId:String(point.siteId||point.site_id||""),tags:point.tags||[],marker_tags:point.marker_tags||point.markerTags||[],metadata:point.metadata||{},lastValue:point.lastValue||point.last_value||point.presentValue,lastTimestamp:point.lastTimestamp||point.last_timestamp,collect_enabled:point.collect_enabled??point.collectEnabled??!0,write_enabled:point.write_enabled??point.writeEnabled??!1,alarm_enabled:point.alarm_enabled??point.alarmEnabled??!1,trending_enabled:point.trending_enabled??point.trendingEnabled??!0,cov_enabled:point.cov_enabled??point.covEnabled??!1,history_enabled:point.history_enabled??point.historyEnabled??!0,protocol:point.protocol||"bacnet",address:point.address||"",scaling_factor:point.scaling_factor??point.scalingFactor??1,offset:point.offset??0,min_value:point.min_value??point.minValue,max_value:point.max_value??point.maxValue,precision:point.precision??2}}),organizePointsHierarchically=points=&gt;{const siteMap=new Map;points.forEach(point=&gt;{const siteId=point.siteId||"unknown",deviceId=point.deviceId||"unknown";siteMap.has(siteId)||siteMap.set(siteId,new Map);const deviceMap=siteMap.get(siteId);deviceMap.has(deviceId)||deviceMap.set(deviceId,[]),deviceMap.get(deviceId).push(point)});const tree=[];return siteMap.forEach((deviceMap,siteId)=&gt;{const siteNode={id:`site-${siteId}`,name:`Site ${siteId}`,type:"site",children:[],expanded:!0};deviceMap.forEach((devicePoints,deviceId)=&gt;{const deviceNode={id:`device-${deviceId}`,name:`Device ${deviceId}`,type:"device",children:[],expanded:!1};devicePoints.sort((a,b)=&gt;a.name.localeCompare(b.name,void 0,{numeric:!0})).forEach(point=&gt;{deviceNode.children.push({id:`point-${point.id}`,name:point.displayName||point.name,type:"point",pointData:point,metadata:{unit:point.unit,description:point.description,tags:point.marker_tags}})}),deviceNode.children.length&gt;0&amp;&amp;siteNode.children.push(deviceNode)}),siteNode.children.length&gt;0&amp;&amp;tree.push(siteNode)}),tree};function validateChartConfig(config){var _a;return!!config&amp;&amp;(console.log("[validateChartConfig] Validating config:",{hasChartType:!!config.chartType,hasSelectedChartType:!!config.selectedChartType,hasSelectedSite:!!config.selectedSite,hasSiteId:!!config.siteId,chartType:config.chartType,selectedChartType:config.selectedChartType,selectedSite:config.selectedSite,siteId:config.siteId,selectedPointsIsArray:Array.isArray(config.selectedPoints),selectedPointsLength:(null==(_a=config.selectedPoints)?void 0:_a.length)||0}),!(!config.chartType&amp;&amp;!config.selectedChartType)&amp;&amp;(!(!config.selectedSite&amp;&amp;!config.siteId)&amp;&amp;!(config.selectedPoints&amp;&amp;!Array.isArray(config.selectedPoints))))}async function exportDashboardData(monitors,startTime,endTime,dashboardName,options={format:"csv"}){try{console.log(`[EXPORT] Exporting dashboard '${dashboardName}'`,{monitorCount:monitors.length,format:options.format});const updatedOptions={...options,customPrefix:options.customPrefix?`${options.customPrefix}_${dashboardName}`:dashboardName};await async function exportMultipleMonitors(monitors,startTime,endTime,options={format:"csv"}){var _a;try{if(0===monitors.length)return void console.warn("[EXPORT] No monitors selected for export");if(console.log(`[EXPORT] Bulk exporting ${monitors.length} monitors`,{format:options.format,groupBySite:options.groupBySite}),options.groupBySite){const monitorsBySite=new Map;monitors.forEach(monitor=&gt;{const siteKey=monitor.siteName||"unknown";monitorsBySite.has(siteKey)||monitorsBySite.set(siteKey,[]),monitorsBySite.get(siteKey).push(monitor)});for(const[siteName,siteMonitors]of monitorsBySite){const allPointNames=siteMonitors.flatMap(m=&gt;m.selectedPoints.map(p=&gt;p.name));await aceIotApiClient.exportData(allPointNames,startTime,endTime,options.format,siteName)}}else{const allPointNames=monitors.flatMap(monitor=&gt;monitor.selectedPoints.map(point=&gt;point.name));await aceIotApiClient.exportData(allPointNames,startTime,endTime,options.format,null==(_a=monitors[0])?void 0:_a.siteName)}console.log(`[EXPORT] Bulk export completed for ${monitors.length} monitors`)}catch(error){throw console.error("[EXPORT] Bulk export failed:",error),console.error(`[EXPORT] Bulk export failed: ${error.message}`),error}}(monitors,startTime,endTime,updatedOptions),console.log(`[EXPORT] Dashboard '${dashboardName}' exported successfully`)}catch(error){throw console.error("[EXPORT] Dashboard export failed:",error),console.error(`[EXPORT] Dashboard export failed: ${error.message}`),error}}function getExportFormatRecommendation(pointCount,timeRangeHours){return pointCount*(12*timeRangeHours)&gt;1e5?{recommended:"parquet",reason:"Large dataset detected. Parquet format provides better compression and faster loading.",alternativeFormats:[{format:"parquet",pros:["Smaller file size","Faster loading","Better for analytics"],cons:["Requires specialized tools to view"]},{format:"csv",pros:["Human readable","Works with Excel"],cons:["Larger file size","Slower for large datasets"]}]}:{recommended:"csv",reason:"Small to medium dataset. CSV format is more accessible and human-readable.",alternativeFormats:[{format:"csv",pros:["Human readable","Works with Excel","Universal compatibility"],cons:["Larger file size for big datasets"]},{format:"parquet",pros:["Smaller file size","Better performance"],cons:["Requires specialized tools"]}]}}const logger=createLogger("BatchStateUpdates");class DebouncedStateUpdater{constructor(updateFn,delay=16){__publicField(this,"updateQueue",[]),__publicField(this,"timeoutId",null),__publicField(this,"delay"),__publicField(this,"updateFn"),this.updateFn=updateFn,this.delay=delay}enqueue(updater){this.updateQueue.push(updater),this.timeoutId&amp;&amp;clearTimeout(this.timeoutId),this.timeoutId=setTimeout(()=&gt;{this.flush()},this.delay)}flush(){if(0===this.updateQueue.length)return;const updates=[...this.updateQueue];var callback;this.updateQueue=[],this.timeoutId=null,callback=()=&gt;{this.updateFn(prevState=&gt;updates.reduce((state,updater)=&gt;updater(state),prevState))},reactDomExports.unstable_batchedUpdates(callback),logger.debug("Batched state updates",{count:updates.length})}clear(){this.updateQueue=[],this.timeoutId&amp;&amp;(clearTimeout(this.timeoutId),this.timeoutId=null)}}const useBatchedUpdates=(initialState,delay)=&gt;{const[state,setState]=React.useState(initialState),updaterRef=React.useRef();React.useEffect(()=&gt;(updaterRef.current=new DebouncedStateUpdater(setState,delay),()=&gt;{var _a;return null==(_a=updaterRef.current)?void 0:_a.clear()}),[delay]);return[state,React.useCallback(updater=&gt;{var _a;null==(_a=updaterRef.current)||_a.enqueue(updater)},[]),React.useCallback(()=&gt;{var _a;null==(_a=updaterRef.current)||_a.flush()},[])]};function handleNumberInputBlur(value,onChange){const parsed=function parseNumberInput(value){if(""===value||"-"===value||"."===value||"-."===value||value.endsWith("."))return null;if(!/^-?\d+(\.\d+)?$/.test(value))return NaN;const parsed=parseFloat(value);return isNaN(parsed)?NaN:parsed}(value);null===parsed||isNaN(parsed)?onChange(value):onChange(parsed)}function createNumericInputProps(value,onChange){return{value:value??"",onChange:e=&gt;{!function handleNumberInputChange(value,onChange){(function isValidNumberInput(value){return""===value||"-"===value||"."===value||"-."===value||/^-?(\d*\.?\d*|\.?\d+)$/.test(value)})(value)&amp;&amp;onChange(value)}(e.target.value,onChange)},onBlur:e=&gt;{handleNumberInputBlur(e.target.value,onChange)}}}const EQUIPMENT_PATTERNS={ahu:{pattern:/^AHU[-_:]?(\d+)/i,getName:match=&gt;`Air Handler ${match[1]}`,tags:["ahu","equip","hvac"]},vav:{pattern:/^VAV[-_:]?(\d+[-_]?\d*)/i,getName:match=&gt;`VAV Box ${match[1]}`,tags:["vav","equip","hvac","terminal"]},chiller:{pattern:/^(CH|CHILLER)[-_:]?(\d*)/i,getName:match=&gt;`Chiller ${match[2]||"1"}`,tags:["chiller","equip","hvac","plant"]},boiler:{pattern:/^(BLR|BOILER|HW)[-_:]?(\d*)/i,getName:match=&gt;`Boiler ${match[2]||"1"}`,tags:["boiler","equip","hvac","plant"]},pump:{pattern:/^(PUMP|P)[-_:]?(\d+)/i,getName:match=&gt;`Pump ${match[2]}`,tags:["pump","equip","hvac"]},fan:{pattern:/^(FAN|EF|SF|RF)[-_:]?(\d*)/i,getName:match=&gt;`Fan ${match[2]||"1"}`,tags:["fan","equip","hvac"]},rtu:{pattern:/^RTU[-_:]?(\d+)/i,getName:match=&gt;`Rooftop Unit ${match[1]}`,tags:["rtu","equip","hvac","rooftop"]},fcu:{pattern:/^FCU[-_:]?(\d+)/i,getName:match=&gt;`Fan Coil Unit ${match[1]}`,tags:["fcu","equip","hvac","terminal"]},ct:{pattern:/^CT[-_:]?(\d+)/i,getName:match=&gt;`Cooling Tower ${match[1]}`,tags:["cooling-tower","equip","hvac","plant"]},meter:{pattern:/^(METER|MTR)[-_:]?(\d*)[-_:]?(ELEC|GAS|WATER)?/i,getName:match=&gt;{const type=match[3]?` ${match[3]}`:"";return`Meter ${match[2]||"1"}${type}`},tags:["meter","equip"]}},POINT_TYPE_PATTERNS={Temperature:{patterns:[/[-_:]T[-_]?$/i,/TEMP/i],unit:"°F",tags:["temp","sensor"]},"Temperature Setpoint":{patterns:[/[-_:]T[-_:]?SP$/i,/TEMP.*SP/i],unit:"°F",tags:["temp","sp","writable"]},Pressure:{patterns:[/[-_:]P[-_]?$/i,/PRESS/i],unit:name=&gt;/CHW|HW|CW/i.test(name)?"psi":"in.w.c.",tags:["pressure","sensor"]},Flow:{patterns:[/FLOW/i,/[-_:]F[-_]?$/i],unit:name=&gt;/CHW|HW|CW/i.test(name)?"GPM":"CFM",tags:["flow","sensor"]},"Damper Position":{patterns:[/DMP.*POS/i,/DAMPER/i],unit:"%",tags:["damper","position","sensor"]},"Valve Position":{patterns:[/VLV.*POS/i,/VALVE/i],unit:"%",tags:["valve","position","sensor"]},"Fan Speed":{patterns:[/FAN.*SPD/i,/.*SPD$/i],unit:"%",tags:["fan","speed","sensor"]},"Fan Status":{patterns:[/FAN.*STS/i,/FAN.*RUN/i],unit:"bool",tags:["fan","run","sensor"]},Power:{patterns:[/KW$/i,/POWER/i],unit:"kW",tags:["elec","power","sensor"]},Energy:{patterns:[/KWH/i,/ENERGY/i],unit:"kWh",tags:["elec","energy","sensor"]},Humidity:{patterns:[/RH/i,/HUM/i],unit:"%RH",tags:["humidity","sensor"]},CO2:{patterns:[/CO2/i],unit:"ppm",tags:["co2","air","quality","sensor"]},Occupancy:{patterns:[/OCC/i],unit:"bool",tags:["occupied","sensor"]},Status:{patterns:[/STS/i,/STATUS/i],unit:"bool",tags:["status","sensor"]},Command:{patterns:[/CMD/i,/COMMAND/i],unit:"bool",tags:["cmd","writable"]},Setpoint:{patterns:[/SP$/i,/SETPOINT/i],unit:"",tags:["sp","writable"]}},ABBREVIATIONS={T:"Temperature",SP:"Setpoint",P:"Pressure",F:"Flow",H:"Humidity",VLV:"Valve",DMP:"Damper",POS:"Position",STS:"Status",CMD:"Command",ZN:"Zone",OA:"Outside Air",RA:"Return Air",SA:"Supply Air",MA:"Mixed Air",EA:"Exhaust Air",CHW:"Chilled Water",HW:"Hot Water",CW:"Condenser Water",CHWST:"Chilled Water Supply Temp",CHWRT:"Chilled Water Return Temp",HWST:"Hot Water Supply Temp",HWRT:"Hot Water Return Temp",VFD:"Variable Frequency Drive",RTU:"Rooftop Unit",AHU:"Air Handler",VAV:"Variable Air Volume",FCU:"Fan Coil Unit",CT:"Cooling Tower"};function parseEquipment(name){for(const[type,config]of Object.entries(EQUIPMENT_PATTERNS)){const match=name.match(config.pattern);if(match)return{type:type,id:match[1]||match[2]||"1",name:config.getName(match),tags:config.tags}}return null}function detectPointType(name){for(const[type,config]of Object.entries(POINT_TYPE_PATTERNS))for(const pattern of config.patterns)if(pattern.test(name)){return{type:type,unit:"function"==typeof config.unit?config.unit(name):config.unit,tags:config.tags}}return null}function enhancePoint(point){if(point._enhanced)return point;const enhanced={...point};enhanced.display_name=function generateDisplayName(name){let displayName="";const equipment=parseEquipment(name);equipment&amp;&amp;(displayName=equipment.name+" ");let cleanName=name;return equipment&amp;&amp;(cleanName=name.replace(EQUIPMENT_PATTERNS[equipment.type].pattern,"")),displayName+=cleanName.split(/[-_:]/).filter(p=&gt;p).map(part=&gt;{const upper=part.toUpperCase();return ABBREVIATIONS[upper]||part}).join(" ").trim(),displayName=displayName.replace(/\s+/g," ").trim(),displayName||name}(point.name);const equipment=parseEquipment(point.name);equipment&amp;&amp;(enhanced.equipment=equipment.type,enhanced.equipmentId=equipment.id,enhanced.equipmentName=equipment.name);const pointType=detectPointType(point.name);return pointType&amp;&amp;!enhanced.unit&amp;&amp;(enhanced.unit=pointType.unit),enhanced.marker_tags=function generateMarkerTags(name){const tags=new Set(["point","his"]),equipment=parseEquipment(name);equipment&amp;&amp;equipment.tags.forEach(tag=&gt;tags.add(tag));const pointType=detectPointType(name);return pointType&amp;&amp;pointType.tags.forEach(tag=&gt;tags.add(tag)),/OA[-_:]/i.test(name)&amp;&amp;(tags.add("outside"),tags.add("air")),/RA[-_:]/i.test(name)&amp;&amp;(tags.add("return"),tags.add("air")),/SA[-_:]/i.test(name)&amp;&amp;(tags.add("supply"),tags.add("air")),/MA[-_:]/i.test(name)&amp;&amp;(tags.add("mixed"),tags.add("air")),/EA[-_:]/i.test(name)&amp;&amp;(tags.add("exhaust"),tags.add("air")),/ZN[-_:]/i.test(name)&amp;&amp;(tags.add("zone"),tags.add("air")),/CHW/i.test(name)&amp;&amp;(tags.add("chilled"),tags.add("water")),/HW/i.test(name)&amp;&amp;(tags.add("hot"),tags.add("water")),/CW/i.test(name)&amp;&amp;(tags.add("condenser"),tags.add("water")),Array.from(tags)}(point.name),enhanced.ai_insights=function generateAIInsights(point){var _a,_b,_c,_d,_e,_f,_g,_h,_i;const insights={recommendations:[],patterns:{},anomalies:[]};return(null==(_a=point.marker_tags)?void 0:_a.includes("temp"))&amp;&amp;(point.marker_tags.includes("zone")&amp;&amp;(insights.recommendations.push("Monitor for ASHRAE 55 comfort compliance (68-76°F)"),insights.patterns.comfort_zone={min:68,max:76,unit:"°F"}),point.marker_tags.includes("supply")&amp;&amp;insights.recommendations.push("Typical supply air: 55-60°F cooling, 90-110°F heating"),point.marker_tags.includes("chilled")&amp;&amp;point.marker_tags.includes("water")&amp;&amp;insights.recommendations.push("Standard chilled water supply: 42-45°F")),(null==(_b=point.marker_tags)?void 0:_b.includes("co2"))&amp;&amp;(insights.recommendations.push("ASHRAE 62.1 recommends &lt; 1000 ppm for acceptable IAQ"),insights.patterns.threshold={warning:800,critical:1e3,unit:"ppm"}),(null==(_c=point.marker_tags)?void 0:_c.includes("humidity"))&amp;&amp;(insights.recommendations.push("ASHRAE 55 recommends 30-60% RH for comfort"),insights.patterns.comfort_zone={min:30,max:60,unit:"%RH"}),((null==(_d=point.marker_tags)?void 0:_d.includes("power"))||(null==(_e=point.marker_tags)?void 0:_e.includes("energy")))&amp;&amp;(insights.recommendations.push("Track for demand response opportunities"),insights.recommendations.push("Monitor for peak demand charges"),insights.patterns.energy_monitoring=!0),((null==(_f=point.marker_tags)?void 0:_f.includes("damper"))||(null==(_g=point.marker_tags)?void 0:_g.includes("valve")))&amp;&amp;(insights.recommendations.push("Monitor for hunting or oscillation"),"%"===point.unit&amp;&amp;(insights.patterns.position_limits={min:0,max:100,unit:"%"})),(null==(_h=point.marker_tags)?void 0:_h.includes("vav"))&amp;&amp;point.marker_tags.includes("damper")&amp;&amp;insights.recommendations.push("Check minimum ventilation position"),(null==(_i=point.marker_tags)?void 0:_i.includes("ahu"))&amp;&amp;point.marker_tags.includes("filter")&amp;&amp;point.marker_tags.includes("pressure")&amp;&amp;insights.recommendations.push("Monitor filter ΔP for maintenance scheduling"),insights}(enhanced),enhanced.quality_score=function calculateQualityScore(point){var _a;let score=0;return point.display_name&amp;&amp;point.display_name!==point.name&amp;&amp;(score+=25),point.unit&amp;&amp;"bool"!==point.unit&amp;&amp;(score+=20),(point.equipment||point.equipmentName)&amp;&amp;(score+=20),point.marker_tags&amp;&amp;point.marker_tags.length&gt;5&amp;&amp;(score+=20),(null==(_a=point.ai_insights)?void 0:_a.recommendations)&amp;&amp;point.ai_insights.recommendations.length&gt;0&amp;&amp;(score+=15),score}(enhanced),enhanced._enhanced=!0,enhanced._enhancedAt=(new Date).toISOString(),enhanced}function needsEnhancement(point){const p=point;return!(p._enhanced||p.display_name&amp;&amp;p.unit&amp;&amp;p.marker_tags)}export{getRecommendedSettings as $,isSeriesArray as A,createSafeEChartsOption as B,CHART_DESIGN_TOKENS as C,createEnhancedTooltip as D,handleEmptyChartData as E,addChartErrorBoundaries as F,optimizeChartPerformance as G,applyResponsiveConfig as H,applyLargeDataOptimizations as I,generateDeviationBands as J,generateDeviationZones as K,calculateDeviation as L,createRangeZones as M,getRangeComplianceColor as N,enhanceChartWithProfessionalTheme as O,fixChartInteractions as P,exportTimeseriesAsJSON as Q,exportChartWithCalculations as R,SPACING as S,TYPOGRAPHY as T,exportTimeseriesAsCSV as U,exportChartAsImage as V,applyVisualEnhancements as W,GRADIENT_PRESETS as X,formatNumberForDisplay as Y,Z_INDEX_CONFIG as Z,getOptimizedChartOptions as _,calculateGridBottom as a,generateSystemHealthReport as a$,createKeyboardNavState as a0,generateDataPointAnnouncement as a1,handleKeyboardNav as a2,HIGH_CONTRAST_COLORS as a3,buildChartTitle as a4,buildXAxis as a5,buildYAxis as a6,combineOptions as a7,transformToTimeSeries as a8,formatPointWithTags as a9,generateSamplingTimestamps as aA,interpolateValue as aB,calculatePsychrometricProperties as aC,generateConstantEnthalpyLines as aD,generateConstantWetBulbLines as aE,calculateDewPoint as aF,calculateWetBulbTemperature as aG,generateASHRAE55ComfortZone as aH,getComfortColor as aI,transformToEconomizer as aJ,getHVACModeColor as aK,getTooltipBorder as aL,getTooltipBackground as aM,analyzeAlignmentQuality as aN,alignTimeSeries as aO,ChartTimeFormatter as aP,getHeatmapRenderingStrategy as aQ,optimizeHeatmapForECharts as aR,DEVIATION_COLORS as aS,transformToRadar as aT,DataValidation as aU,registerChartForActions as aV,addChartToGroup as aW,DEVIATION_COLOR_SCHEMES as aX,chartActionDispatcher as aY,detectComprehensiveFaults as aZ,analyzeSensorReliability as a_,getAdaptiveSymbolSize as aa,getAdaptiveLineWidth as ab,createThresholdLine as ac,createThresholdZones as ad,buildTooltip as ae,buildLegend as af,createEChartsAriaConfig as ag,enhanceChart as ah,srOnlyStyles as ai,chartFocusStyles as aj,generateChartAriaLabel as ak,DARK_THEME_COLORS as al,getDistinctColors as am,HEATMAP_COLOR_SCALES as an,ChartStatistics as ao,buildVisualMap as ap,generateColorScale as aq,SeriesBuilders as ar,TimeAggregation as as,DeviationCalculations as at,transformToGauge as au,createGaugeThresholds as av,transformToScatter as aw,getTimeAxisConfig as ax,validateSeriesForInterpolation as ay,getAllTimestamps as az,TokenSyncService as b,detectLowAirflowAlarm as b0,calculateCoolingSATResetRequests as b1,calculateStaticPressureResetRequests as b2,calculateHotWaterResetRequests as b3,getStatColor as b4,createNumericInputProps as b5,getExportFormatRecommendation as b6,exportDashboardData as b7,useBatchedUpdates as b8,API_ENDPOINTS as b9,getBrowserTimezone as ba,createLazyRoute as bb,setupGlobalErrorHandlers$1 as bc,preloadCriticalIcons as bd,retryFirestoreOperation as be,cleanupStuckOverlays as bf,handleFirestorePersistenceError as bg,enableChartDebugMode as bh,initializeConsoleEnhancer as bi,setupGlobalErrorHandlers as bj,fixIndexedDB as bk,firestoreRecovery as bl,calculateGridTop as c,convertTemperatureData as d,formatLocalTimeForAPI as e,formatErrorForUser as f,getPointDisplayLabel as g,hasKvTags as h,isWeatherTemperaturePoint as i,enhancePointWithKvTags as j,enhancePoint as k,fixInvalidChartTypes as l,cleanupInvalidMonitors as m,needsEnhancement as n,organizePointsHierarchically as o,enhancedErrorHandler as p,getCircuitBreakerState as q,reportError as r,getCircuitBreakerStats as s,transformPointData as t,CircuitState as u,validateChartConfig as v,withErrorHandling as w,resetCircuitBreaker as x,getAuthErrorMessage as y,chartResizeDebugger as z};</span>
&nbsp;</pre></td></tr></table></pre>

                <div class='push'></div><!-- for sticky footer -->
            </div><!-- /wrapper -->
            <div class='footer quiet pad2 space-top1 center small'>
                Code coverage generated by
                <a href="https://istanbul.js.org/" target="_blank" rel="noopener noreferrer">istanbul</a>
                at 2025-10-16T12:41:31.984Z
            </div>
        <script src="../../../../prettify.js"></script>
        <script>
            window.onload = function () {
                prettyPrint();
            };
        </script>
        <script src="../../../../sorter.js"></script>
        <script src="../../../../block-navigation.js"></script>
    </body>
</html>
    